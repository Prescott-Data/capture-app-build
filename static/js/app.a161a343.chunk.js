(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[3524],{59349:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Jte}});r(20579),r(65016);var n=r(77852),a=JSON.parse('{"ERROR":"ERROR","Loading...":"Loading...","Choose one or more dates...":"Choose one or more dates...","Choose a date...":"Choose a date...","Today":"Today","A possible reason for this is that the browser or mode (e.g. privacy mode) is not supported. See log for details.":"A possible reason for this is that the browser or mode (e.g. privacy mode) is not supported. See log for details.","You opened another version of the Capture App in the same domain. Currently, the Capture App only supports running one version concurrently (in the same domain). Please refresh this page if you would like to use this version again, but be aware that this will close other versions.":"You opened another version of the Capture App in the same domain. Currently, the Capture App only supports running one version concurrently (in the same domain). Please refresh this page if you would like to use this version again, but be aware that this will close other versions.","Enrollment dashboard":"Enrollment dashboard","View event":"View event","Edit event":"Edit event","New event":"New event","Active enrollments":"Active enrollments","Completed enrollments":"Completed enrollments","Cancelled enrollments":"Cancelled enrollments","{{trackedEntityName}} list":"{{trackedEntityName}} list","Search":"Search","Working List":"Working List","Event list":"Event list","More":"More","View {{programName}} dashboard":"View {{programName}} dashboard","View dashboard":"View dashboard","View active enrollment":"View active enrollment","Re-enroll":"Re-enroll","in":"in","Enrolled":"Enrolled","Previously enrolled":"Previously enrolled","Organisation unit":"Organisation unit","Date of enrollment":"Date of enrollment","Last updated":"Last updated","error encountered during field validation":"error encountered during field validation","error":"error","This value is validating":"This value is validating","Async field update failed":"Async field update failed","A value is required":"A value is required","Please provide a valid number":"Please provide a valid number","Please provide a valid integer":"Please provide a valid integer","Please provide a positive integer":"Please provide a positive integer","Please provide zero or a positive integer":"Please provide zero or a positive integer","Please provide a negative integer":"Please provide a negative integer","Please provide a valid date":"Please provide a valid date","A date in the future is not allowed":"A date in the future is not allowed","Please provide a valid date and time":"Please provide a valid date and time","Please provide a valid time":"Please provide a valid time","Please provide an integer between 0 and 100":"Please provide an integer between 0 and 100","Please provide a valid url":"Please provide a valid url","Please provide a valid email address":"Please provide a valid email address","Please provide a valid age":"Please provide a valid age","Please provide a valid phone number":"Please provide a valid phone number","Please provide a valid organisation unit":"Please provide a valid organisation unit","Please provide valid coordinates":"Please provide valid coordinates","This value already exists":"This value already exists","\\"From\\" cannot be greater than \\"To\\"":"\\"From\\" cannot be greater than \\"To\\"","Checking...":"Checking...","Area":"Area","Coordinate":"Coordinate","Enrollment":"Enrollment","Complete event":"Complete event","{{ stageName }} - Basic info":"{{ stageName }} - Basic info","{{ stageName }} - Assignee":"{{ stageName }} - Assignee","{{ stageName }} - Status":"{{ stageName }} - Status","Please select {{categoryName}}":"Please select {{categoryName}}","A future date is not allowed":"A future date is not allowed","Saving a new enrollment in {{programName}} in {{orgUnitName}}.":"Saving a new enrollment in {{programName}} in {{orgUnitName}}.","Saving a {{trackedEntityName}} in {{programName}} in {{orgUnitName}}.":"Saving a {{trackedEntityName}} in {{programName}} in {{orgUnitName}}.","Cancel":"Cancel","Metadata error. see log for details":"Metadata error. see log for details","{{ stageName }} - Details":"{{ stageName }} - Details","{{ stageName }} - {{ sectionName }}":"{{ stageName }} - {{ sectionName }}","Assigned user":"Assigned user","Search for user":"Search for user","Notes":"Notes","Basic info":"Basic info","Status":"Status","Relationships":"Relationships","Assignee":"Assignee","Saving to {{programName}} in {{orgUnitName}}":"Saving to {{programName}} in {{orgUnitName}}","This is not an event program or the metadata is corrupt. See log for details.":"This is not an event program or the metadata is corrupt. See log for details.","This event":"This event","Relationship of type {{relationshipTypeName}} to {{entityName}} already exists":"Relationship of type {{relationshipTypeName}} to {{entityName}} already exists","Active":"Active","Completed":"Completed","Please add or cancel note before saving the event":"Please add or cancel note before saving the event","Save and add another":"Save and add another","Save and exit":"Save and exit","Finish":"Finish","Save without completing":"Save without completing","Complete":"Complete","No write access":"No write access","New {{titleText}}":"New {{titleText}}","Switch to form view":"Switch to form view","Switch to row view":"Switch to row view","events added":"events added","No events added":"No events added","New event relationship":"New event relationship","Adding relationship to event.":"Adding relationship to event.","Go back to event without saving relationship":"Go back to event without saving relationship","Discard unsaved changes?":"Discard unsaved changes?","Leaving this page will discard the selections you made for a new relationship":"Leaving this page will discard the selections you made for a new relationship","Yes, discard changes":"Yes, discard changes","No, cancel":"No, cancel","You don\'t have access to create an event in the current selections":"You don\'t have access to create an event in the current selections","Save":"Save","Saving a {{trackedEntityName}}":"Saving a {{trackedEntityName}}","without":"without","enrollment":"enrollment","Enroll in a program by selecting a program from the top bar.":"Enroll in a program by selecting a program from the top bar.","An error has occurred. See log for details":"An error has occurred. See log for details","{{programStageName}} completed":"{{programStageName}} completed","Would you like to complete the enrollment and all active events as well?":"Would you like to complete the enrollment and all active events as well?","{{count}} event in {{programStageName}}":"{{count}} event in {{programStageName}}","{{count}} event in {{programStageName}}_plural":"{{count}} events in {{programStageName}}","Yes, complete enrollment and events":"Yes, complete enrollment and events","Complete enrollment only":"Complete enrollment only","Would you like to complete the enrollment?":"Would you like to complete the enrollment?","Complete enrollment":"Complete enrollment","A duplicate exists (but there were some errors, see log for details":"A duplicate exists (but there were some errors, see log for details","An item with this {{attributeName}} is already registered, but you don\'t have access to it":"An item with this {{attributeName}} is already registered, but you don\'t have access to it","You have already registered this {{attributeName}}":"You have already registered this {{attributeName}}","A {{trackedEntityTypeName}} with this {{attributeName}} is already registered":"A {{trackedEntityTypeName}} with this {{attributeName}} is already registered","Show registered {{trackedEntityTypeName}}":"Show registered {{trackedEntityTypeName}}","Registered person":"Registered person","validation failed":"validation failed","No feedback for this event yet":"No feedback for this event yet","No indicator output for this event yet":"No indicator output for this event yet","Generate new event":"Generate new event","Do you want to create another event?":"Do you want to create another event?","Yes, create new event":"Yes, create new event","Back to form":"Back to form","Save anyway":"Save anyway","Validation errors and warnings":"Validation errors and warnings","Validation errors":"Validation errors","Validation warnings":"Validation warnings","Some operations are still runnning. Please wait..":"Some operations are still runnning. Please wait..","Operations running":"Operations running","This event has unsaved changes. Leaving this page without saving will lose these changes. Are you sure you want to discard unsaved changes?":"This event has unsaved changes. Leaving this page without saving will lose these changes. Are you sure you want to discard unsaved changes?","No events to display":"No events to display","Data for offline list not present":"Data for offline list not present","Close":"Close","Please select the user":"Please select the user","Me":"Me","Anyone":"Anyone","None":"None","Select user":"Select user","to":"to","Days in the future":"Days in the future","From":"From","Days in the past":"Days in the past","To":"To","This week":"This week","This month":"This month","This Year":"This Year","Last week":"Last week","Last month":"Last month","Last 3 months":"Last 3 months","Absolute range":"Absolute range","Relative range":"Relative range","Max":"Max","Min":"Min","Contains text":"Contains text","Yes":"Yes","Uploading file":"Uploading file","selected":"selected","Delete":"Delete","Select file":"Select file","No":"No","Uploading image":"Uploading image","Select image":"Select image","Type to filter options":"Type to filter options","No match found":"No match found","Clear":"Clear","No results":"No results","Description":"Description","URL":"URL","Icon for {{field}}":"Icon for {{field}}","start typing to search":"start typing to search","suggestions could not be retrieved":"suggestions could not be retrieved","No results found":"No results found","No items to display":"No items to display","Select columns":"Select columns","Columns to show in table":"Columns to show in table","Column":"Column","Visible":"Visible","Update":"Update","Reset filter":"Reset filter","Remove filter":"Remove filter","{{fromDate}} to {{toDate}}":"{{fromDate}} to {{toDate}}","after or equal to {{date}}":"after or equal to {{date}}","before or equal to {{date}}":"before or equal to {{date}}","greater than or equal to":"greater than or equal to","less than or equal to":"less than or equal to","More filters":"More filters","Stage filters":"Stage filters","Rows per page":"Rows per page","Could not get organisation unit":"Could not get organisation unit","Program doesn\'t exist":"Program doesn\'t exist","Selected program is invalid for selected organisation unit":"Selected program is invalid for selected organisation unit","Add note":"Add note","You don\'t have access to write notes":"You don\'t have access to write notes","Write note":"Write note","was blanked out and hidden by your last action":"was blanked out and hidden by your last action","Notice":"Notice","Close the notice":"Close the notice","Enrollment with id \\"{{enrollmentId}}\\" does not exist":"Enrollment with id \\"{{enrollmentId}}\\" does not exist","Tracked entity instance with id \\"{{teiId}}\\" does not exist":"Tracked entity instance with id \\"{{teiId}}\\" does not exist","Program with id \\"{{programId}}\\" does not exist":"Program with id \\"{{programId}}\\" does not exist","An error occurred while fetching enrollments. Please enter a valid url.":"An error occurred while fetching enrollments. Please enter a valid url.","No feedback for this enrollment yet":"No feedback for this enrollment yet","No indicator output for this enrollment yet":"No indicator output for this enrollment yet","Quick actions":"Quick actions","New Event":"New Event","Schedule an event":"Schedule an event","Make referral":"Make referral","No available program stages":"No available program stages","Program stage not found":"Program stage not found","Choose a program to add new or see existing enrollments for {{teiDisplayName}}":"Choose a program to add new or see existing enrollments for {{teiDisplayName}}","{{programName}} has categories. Choose all categories to view dashboard.":"{{programName}} has categories. Choose all categories to view dashboard.","Invalid enrollment id {{enrollmentId}}.":"Invalid enrollment id {{enrollmentId}}.","Choose an enrollment to view the dashboard.":"Choose an enrollment to view the dashboard.","There are no active enrollments.":"There are no active enrollments.","Add new enrollment for {{teiDisplayName}} in this program.":"Add new enrollment for {{teiDisplayName}} in this program.","You do not have permissions to access to this program, registering unit or record, contact your administrator for more information.":"You do not have permissions to access to this program, registering unit or record, contact your administrator for more information.","{{teiDisplayName}} is not enrolled in this program.":"{{teiDisplayName}} is not enrolled in this program.","Enroll {{teiDisplayName}} in this program.":"Enroll {{teiDisplayName}} in this program.","{{teiDisplayName}} is a {{tetName}} and cannot be enrolled in the {{programName}}. Choose another program that allows {{tetName}} enrollment. ":"{{teiDisplayName}} is a {{tetName}} and cannot be enrolled in the {{programName}}. Choose another program that allows {{tetName}} enrollment. ","Enroll a new {{selectedTetName}} in this program.":"Enroll a new {{selectedTetName}} in this program.","{{programName}} is an event program and does not have enrollments.":"{{programName}} is an event program and does not have enrollments.","Create a new event in this program.":"Create a new event in this program.","View working list in this program.":"View working list in this program.","Page is missing required values from URL":"Page is missing required values from URL","Org unit is not valid with current program":"Org unit is not valid with current program","There was an error opening the Page":"There was an error opening the Page","There was an error loading the page":"There was an error loading the page","Choose an organisation unit to start reporting":"Choose an organisation unit to start reporting","Program stage is invalid":"Program stage is invalid","Report":"Report","Schedule":"Schedule","Refer":"Refer","You can\'t add any more {{ programStageName }} events":"You can\'t add any more {{ programStageName }} events","Cancel without saving":"Cancel without saving","Choose a stage for a new event":"Choose a stage for a new event","Program Stages could not be loaded":"Program Stages could not be loaded","Stage":"Stage","Registered events":"Registered events","The category option is not valid for the selected organisation unit. Please select a valid combination.":"The category option is not valid for the selected organisation unit. Please select a valid combination.","Please select {{category}}.":"Please select {{category}}.","Or see all records accessible to you in {{program}} ":"Or see all records accessible to you in {{program}} ","Or see all events accessible to you in {{program}}":"Or see all events accessible to you in {{program}}","Please select an organisation unit.":"Please select an organisation unit.","You don\'t have access to create a {{trackedEntityName}} in the current selections":"You don\'t have access to create a {{trackedEntityName}} in the current selections","Choose the {{missingCategories}} to start reporting":"Choose the {{missingCategories}} to start reporting","Save as new":"Save as new","New":"New","Create for":"Create for","You can also choose a program from the top bar and create in that program":"You can also choose a program from the top bar and create in that program","New Enrollment in program{{escape}} {{programName}}":"New Enrollment in program{{escape}} {{programName}}","Save {{trackedEntityTypeName}}":"Save {{trackedEntityTypeName}}","Save {{trackedEntityName}}":"Save {{trackedEntityName}}","Save new {{trackedEntityTypeName}} and link":"Save new {{trackedEntityTypeName}} and link","Link":"Link","Save as new {{trackedEntityName}}":"Save as new {{trackedEntityName}}","Some programs are being filtered.":"Some programs are being filtered.","Show all":"Show all","Program":"Program","Organisation Unit":"Organisation Unit","Registration":"Registration","Search results":"Search results","No {{trackedEntityTypeName}} found.":"No {{trackedEntityTypeName}} found.","New search":"New search","Edit search":"Edit search","Link to an existing {{trackedEntityType}}":"Link to an existing {{trackedEntityType}}","Create new {{trackedEntityType}}":"Create new {{trackedEntityType}}","Register":"Register","Back":"Back","events":"events","event":"event","You don\'t have access to edit this event":"You don\'t have access to edit this event","View changelog":"View changelog","Event details":"Event details","Leaving this page will discard any selections you made for a new relationship":"Leaving this page will discard any selections you made for a new relationship","Errors":"Errors","Feedback":"Feedback","Indicators":"Indicators","Warnings":"Warnings","Show all events":"Show all events","Event could not be loaded. Are you sure it exists?":"Event could not be loaded. Are you sure it exists?","Event could not be loaded":"Event could not be loaded","Organisation unit could not be loaded":"Organisation unit could not be loaded","Selected program":"Selected program","Search {{uniqueAttrName}}":"Search {{uniqueAttrName}}","Search by attributes":"Search by attributes","Fill in at least {{count}} attribute to search":"Fill in at least {{count}} attribute to search","Fill in at least {{count}} attribute to search_plural":"Fill in at least {{count}} attributes to search","Could not retrieve metadata. Please try again later.":"Could not retrieve metadata. Please try again later.","The enrollment event data could not be found":"The enrollment event data could not be found","Loading":"Loading","An error occurred while loading the form":"An error occurred while loading the form","Possible duplicates found":"Possible duplicates found","An error occurred loading possible duplicates":"An error occurred loading possible duplicates","You don\'t have access to delete this relationship":"You don\'t have access to delete this relationship","You don\'t have access to create any relationships":"You don\'t have access to create any relationships","Add relationship":"Add relationship","No results found for ":"No results found for ","Choose an organisation unit":"Choose an organisation unit","Clear selection":"Clear selection","No programs available.":"No programs available.","Search for a program":"Search for a program","Some programs are being filtered by the chosen organisation unit":"Some programs are being filtered by the chosen organisation unit","Show all programs":"Show all programs","Choose a program":"Choose a program","Search for {{titleText}}":"Search for {{titleText}}","Search for":"Search for","You can also choose a program from the top bar and search in that program":"You can also choose a program from the top bar and search in that program","Choose a type to start searching":"Choose a type to start searching","Search {{name}}":"Search {{name}}","Search by {{name}}":"Search by {{name}}","all programs":"all programs","Not finding the results you were looking for? Try to search all programs that use type ":"Not finding the results you were looking for? Try to search all programs that use type ","Search in all programs":"Search in all programs","If none of search results match, you can create a new ":"If none of search results match, you can create a new ","Create new":"Create new","Fill in these fields to search{{escape}} {{ searchableAttributes }}":"Fill in these fields to search{{escape}} {{ searchableAttributes }}","Fill in at least {{minAttributesRequiredToSearch}} of these fields to search{{escape}} {{searchableAttributes}}":"Fill in at least {{minAttributesRequiredToSearch}} of these fields to search{{escape}} {{searchableAttributes}}","Fill in this field to search{{escape}} {{searchableAttributes}}":"Fill in this field to search{{escape}} {{searchableAttributes}}","You can change your search terms and search again to find what you are looking for.":"You can change your search terms and search again to find what you are looking for.","Back to search":"Back to search","An error has occurred":"An error has occurred","Too many results":"Too many results","Cannot search in all programs":"Cannot search in all programs","Missing search criteria":"Missing search criteria","Results found":"Results found","Saved lists in this program":"Saved lists in this program","Saved lists offer quick access to your most used views in a program.":"Saved lists offer quick access to your most used views in a program.","There are no saved lists in this program yet, create one using the button below.":"There are no saved lists in this program yet, create one using the button below.","Create saved list":"Create saved list","Create new in another program":"Create new in another program","Create new event":"Create new event","Search for a {{trackedEntityName}} in {{programName}}":"Search for a {{trackedEntityName}} in {{programName}}","No tracked entity types available":"No tracked entity types available","Assigned to":"Assigned to","You don\'t have access to edit the assigned user":"You don\'t have access to edit the assigned user","Edit":"Edit","No one is assigned to this event":"No one is assigned to this event","You don\'t have access to assign a user to this event":"You don\'t have access to assign a user to this event","Assign":"Assign","This program is protected":"This program is protected","Reason to check for enrollments":"Reason to check for enrollments","Describe the reason you are checking for enrollments in this protected program":"Describe the reason you are checking for enrollments in this protected program","Check for enrollments":"Check for enrollments","You must provide a reason to check for enrollments in this protected program. All activity will be logged.":"You must provide a reason to check for enrollments in this protected program. All activity will be logged.","Enrollment actions":"Enrollment actions","We are processing your request.":"We are processing your request.","Only one enrollment per {{tetName}} is allowed in this program":"Only one enrollment per {{tetName}} is allowed in this program","Add new":"Add new","Reactivate":"Reactivate","Mark as cancelled":"Mark as cancelled","Mark incomplete":"Mark incomplete","You do not have access to delete this enrollment":"You do not have access to delete this enrollment","Delete enrollment":"Delete enrollment","Are you sure you want to delete this enrollment? This will permanently remove the current enrollment.":"Are you sure you want to delete this enrollment? This will permanently remove the current enrollment.","Yes, delete enrollment.":"Yes, delete enrollment.","Remove mark for follow-up":"Remove mark for follow-up","Mark for follow-up":"Mark for follow-up","Transfer":"Transfer","An error occurred while transferring ownership":"An error occurred while transferring ownership","Existing dates for auto-generated events will not be updated.":"Existing dates for auto-generated events will not be updated.","Latitude":"Latitude","Longitude":"Longitude","Set coordinates":"Set coordinates","Coordinates":"Coordinates","Delete polygon":"Delete polygon","Close without saving":"Close without saving","Finish drawing before saving":"Finish drawing before saving","Set area":"Set area","Transferring enrollment ownership from {{ownerOrgUnit}} to {{newOrgUnit}}{{escape}}":"Transferring enrollment ownership from {{ownerOrgUnit}} to {{newOrgUnit}}{{escape}}","You will lose access to the enrollment when transferring ownership to {{organisationUnit}}.":"You will lose access to the enrollment when transferring ownership to {{organisationUnit}}.","Transfer Ownership":"Transfer Ownership","Choose the organisation unit to which enrollment ownership should be transferred.":"Choose the organisation unit to which enrollment ownership should be transferred.","Enrollment date":"Enrollment date","Incident date":"Incident date","Enrollment widget could not be loaded. Please try again later":"Enrollment widget could not be loaded. Please try again later","Follow-up":"Follow-up","Started at{{escape}}":"Started at{{escape}}","Owned by{{escape}}":"Owned by{{escape}}","Cancelled":"Cancelled","Add coordinates":"Add coordinates","Add area":"Add area","Please add or cancel the note before saving the event":"Please add or cancel the note before saving the event","organisation unit could not be retrieved. Please try again later.":"organisation unit could not be retrieved. Please try again later.","Saving to {{stageName}} for {{programName}} in {{orgUnitName}}":"Saving to {{stageName}} for {{programName}} in {{orgUnitName}}","program or stage is invalid":"program or stage is invalid","Notes about this enrollment":"Notes about this enrollment","Write a note about this enrollment":"Write a note about this enrollment","This enrollment doesn\'t have any notes":"This enrollment doesn\'t have any notes","Error":"Error","Warning":"Warning","stage not found in rules execution":"stage not found in rules execution","Delete event":"Delete event","Yes, delete event":"Yes, delete event","Go to \u201cSchedule\u201d tab to reschedule this event":"Go to \u201cSchedule\u201d tab to reschedule this event","Scheduled date cannot be changed for {{ eventStatus }} events":"Scheduled date cannot be changed for {{ eventStatus }} events","Event completed":"Event completed","The event cannot be edited after it has been completed":"The event cannot be edited after it has been completed","Back to all stages and events":"Back to all stages and events","Notes about this event":"Notes about this event","Write a note about this event":"Write a note about this event","This event doesn\'t have any notes":"This event doesn\'t have any notes","Schedule date info":"Schedule date info","Scheduled automatically for {{suggestedScheduleDate}}":"Scheduled automatically for {{suggestedScheduleDate}}","The scheduled date matches the suggested date, but can be changed if needed.":"The scheduled date matches the suggested date, but can be changed if needed.","The scheduled date is {{count}} days {{position}} the suggested date.":"The scheduled date is {{count}} day {{position}} the suggested date.","The scheduled date is {{count}} days {{position}} the suggested date._plural":"The scheduled date is {{count}} days {{position}} the suggested date.","after":"after","before":"before","There are {{count}} scheduled event in {{orgUnitName}} on this day.":"There are {{count}} scheduled event in {{orgUnitName}} on this day.","There are {{count}} scheduled event in {{orgUnitName}} on this day._plural":"There are {{count}} scheduled events in {{orgUnitName}} on this day.","Scheduling an event in {{stageName}} for {{programName}} in {{orgUnitName}}":"Scheduling an event in {{stageName}} for {{programName}} in {{orgUnitName}}","Schedule info":"Schedule info","Schedule date / Due date":"Schedule date / Due date","Event notes":"Event notes","Write a note about this scheduled event":"Write a note about this scheduled event","Save note":"Save note","Change information about this {{trackedEntityName}} here. To change information about this enrollment, use the Edit button in the in the Enrollment box on this dashboard":"Change information about this {{trackedEntityName}} here. To change information about this enrollment, use the Edit button in the in the Enrollment box on this dashboard"," Loading...":" Loading...","Save changes":"Save changes","Profile":"Profile","There is a problem with this form":"There is a problem with this form","There are warnings in this form":"There are warnings in this form","There was a problem saving changes":"There was a problem saving changes","Try again or contact your system administrator for support":"Try again or contact your system administrator for support","Fix errors in the form to continue.":"Fix errors in the form to continue.","You do not have access to delete this {{trackedEntityTypeName}}":"You do not have access to delete this {{trackedEntityTypeName}}","Delete {{trackedEntityTypeName}}":"Delete {{trackedEntityTypeName}}","Are you sure you want to delete this {{trackedEntityTypeName}}? This will permanently remove the {{trackedEntityTypeName}} and all its associated enrollments and events in all programs.":"Are you sure you want to delete this {{trackedEntityTypeName}}? This will permanently remove the {{trackedEntityTypeName}} and all its associated enrollments and events in all programs.","There was a problem deleting the {{trackedEntityTypeName}}":"There was a problem deleting the {{trackedEntityTypeName}}","Yes, delete {{trackedEntityTypeName}}":"Yes, delete {{trackedEntityTypeName}}","Profile widget could not be loaded. Please try again later":"Profile widget could not be loaded. Please try again later","{{trackedEntityTypeName}} profile":"{{trackedEntityTypeName}} profile","tracked entity instance":"tracked entity instance","Link to an existing {{linkableStageLabel}}":"Link to an existing {{linkableStageLabel}}","Choose a {{linkableStageLabel}}":"Choose a {{linkableStageLabel}}","{{ linkableStageLabel }} is not repeatable":"{{ linkableStageLabel }} is not repeatable","{{ linkableStageLabel }} has no linkable events":"{{ linkableStageLabel }} has no linkable events","Ambiguous relationships, contact system administrator":"Ambiguous relationships, contact system administrator","Enter details now":"Enter details now","Link to an existing":"Link to an existing","Scheduled date":"Scheduled date","Report date":"Report date","Please select a valid event":"Please select a valid event","You do not have access to create events in this stage":"You do not have access to create events in this stage","This stage can only have one event":"This stage can only have one event","New {{ eventName }} event":"New {{ eventName }} event","An error occurred while deleting the event":"An error occurred while deleting the event","Deleting an event is permanent and cannot be undone. Are you sure you want to delete this event?":"Deleting an event is permanent and cannot be undone. Are you sure you want to delete this event?","An error occurred when updating event status":"An error occurred when updating event status","Unskip":"Unskip","Skip":"Skip","To open this event, please wait until saving is complete":"To open this event, please wait until saving is complete","Show {{ rest }} more":"Show {{ rest }} more","Go to full {{ eventName }}":"Go to full {{ eventName }}","Events could not be retrieved. Please try again later.":"Events could not be retrieved. Please try again later.","{{ count }} event":"{{ count }} event","{{ count }} event_plural":"{{count}} events","{{ overdueEvents }} overdue":"{{ overdueEvents }} overdue","{{ scheduledEvents }} scheduled":"{{ scheduledEvents }} scheduled","Stages and Events":"Stages and Events","An error occurred while loading the widget.":"An error occurred while loading the widget.","View linked event":"View linked event","Scheduled":"Scheduled","Changelog":"Changelog","No changes to display":"No changes to display","Updated":"Updated","Created":"Created","Deleted":"Deleted","Date":"Date","User":"User","Data item":"Data item","Change":"Change","Value":"Value","New {{trackedEntityTypeName}} relationship":"New {{trackedEntityTypeName}} relationship","Missing implementation step":"Missing implementation step","Go back without saving relationship":"Go back without saving relationship","New Relationship":"New Relationship","Link to an existing {{tetName}}":"Link to an existing {{tetName}}","An error occurred while adding the relationship":"An error occurred while adding the relationship","Something went wrong while loading relationships. Please try again later.":"Something went wrong while loading relationships. Please try again later.","{{trackedEntityTypeName}} relationships":"{{trackedEntityTypeName}} relationships","Delete relationship":"Delete relationship","Deleting the relationship is permanent and cannot be undone. Are you sure you want to delete this relationship?":"Deleting the relationship is permanent and cannot be undone. Are you sure you want to delete this relationship?","Yes, delete relationship":"Yes, delete relationship","An error occurred while deleting the relationship.":"An error occurred while deleting the relationship.","To open this relationship, please wait until saving is complete":"To open this relationship, please wait until saving is complete","Type":"Type","Created date":"Created date","Program stage name":"Program stage name","Working list could not be loaded":"Working list could not be loaded","Download data...":"Download data...","an error occurred loading working lists":"an error occurred loading working lists","You do not have access to complete events":"You do not have access to complete events","Complete events":"Complete events","Are you sure you want to complete all active events in selection?":"Are you sure you want to complete all active events in selection?","There are no active events to complete in the current selection.":"There are no active events to complete in the current selection.","Error completing events":"Error completing events","There was an error completing the events.":"There was an error completing the events.","Details (Advanced)":"Details (Advanced)","An unknown error occurred.":"An unknown error occurred.","An error occurred while completing events":"An error occurred while completing events","An error occurred while deleting the events":"An error occurred while deleting the events","You do not have access to delete events":"You do not have access to delete events","Delete events":"Delete events","This cannot be undone. Are you sure you want to delete the selected events?":"This cannot be undone. Are you sure you want to delete the selected events?","Registration Date":"Registration Date","Inactive":"Inactive","Enrollment status":"Enrollment status","Follow up":"Follow up","Choose a program stage to filter by {{label}}":"Choose a program stage to filter by {{label}}","Some enrollments were completed successfully, but there was an error while completing the rest. Please see the details below.":"Some enrollments were completed successfully, but there was an error while completing the rest. Please see the details below.","There was an error while completing the enrollments. Please see the details below.":"There was an error while completing the enrollments. Please see the details below.","An unexpected error occurred while fetching the enrollments. Please try again.":"An unexpected error occurred while fetching the enrollments. Please try again.","There are currently no active enrollments in the selection. All enrollments are already completed or cancelled.":"There are currently no active enrollments in the selection. All enrollments are already completed or cancelled.","This action will complete {{count}} active enrollment in your selection.":"This action will complete {{count}} active enrollment in your selection.","This action will complete {{count}} active enrollment in your selection._plural":"This action will complete {{count}} active enrollments in your selection.","{{count}} enrollment already marked as completed will not be changed.":"{{count}} enrollment already marked as completed will not be changed.","{{count}} enrollment already marked as completed will not be changed._plural":"{{count}} enrollments already marked as completed will not be changed.","Mark all events within enrollments as complete":"Mark all events within enrollments as complete","You do not have access to bulk complete enrollments":"You do not have access to bulk complete enrollments","Complete enrollments":"Complete enrollments","Error completing enrollments":"Error completing enrollments","No active enrollments to complete":"No active enrollments to complete","Complete {{count}} enrollment":"Complete {{count}} enrollment","Complete {{count}} enrollment_plural":"Complete {{count}} enrollments","An error occurred when completing the enrollments":"An error occurred when completing the enrollments","An unknown error occurred when completing enrollments":"An unknown error occurred when completing enrollments","You do not have access to delete enrollments":"You do not have access to delete enrollments","Delete enrollments":"Delete enrollments","Delete selected enrollments":"Delete selected enrollments","An error occurred while loading the selected enrollments. Please try again.":"An error occurred while loading the selected enrollments. Please try again.","This action will permanently delete the selected enrollments, including all associated data and events.":"This action will permanently delete the selected enrollments, including all associated data and events.","Active enrollments ({{count}})":"Active enrollments ({{count}})","Active enrollments ({{count}})_plural":"Active enrollments ({{count}})","Completed enrollments ({{count}})":"Completed enrollments ({{count}})","Completed enrollments ({{count}})_plural":"Completed enrollments ({{count}})","Cancelled enrollments ({{count}})":"Cancelled enrollments ({{count}})","Cancelled enrollments ({{count}})_plural":"Cancelled enrollments ({{count}})","Delete {{count}} enrollment":"Delete {{count}} enrollment","Delete {{count}} enrollment_plural":"Delete {{count}} enrollments","An error occurred when deleting enrollments":"An error occurred when deleting enrollments","Delete {{ trackedEntityName }} with all enrollments":"Delete {{ trackedEntityName }} with all enrollments","Delete {{count}} {{ trackedEntityName }}":"Delete {{count}} {{ trackedEntityName }}","Delete {{count}} {{ trackedEntityName }}_plural":"Delete {{count}} {{ trackedEntityName }}","Deleting records will also delete any associated enrollments and events. This cannot be undone. Are you sure you want to delete?":"Deleting records will also delete any associated enrollments and events. This cannot be undone. Are you sure you want to delete?","An error occurred while deleting the records":"An error occurred while deleting the records","Working list could not be updated":"Working list could not be updated","an error occurred loading the working lists":"an error occurred loading the working lists","an error occurred loading Tracked entity instance lists":"an error occurred loading Tracked entity instance lists","{{count}} selected":"{{count}} selected","{{count}} selected_plural":"{{count}} selected","Deselect all":"Deselect all","Update view":"Update view","Save current view...":"Save current view...","Save current view as...":"Save current view as...","Delete view":"Delete view","Share view...":"Share view...","Do you really want to delete the \'{{templateName}}\' view?":"Do you really want to delete the \'{{templateName}}\' view?","Confirm":"Confirm","Save As view":"Save As view","View name":"View name","Show Less":"Show Less","Show All":"Show All","Download as JSON":"Download as JSON","Download as CSV":"Download as CSV","Download with current filters":"Download with current filters","An error has occured. See log for details":"An error has occured. See log for details","Scheduled{{ escape }} due {{ time }}":"Scheduled{{ escape }} due {{ time }}","Overdue{{ escape }} due {{ time }}":"Overdue{{ escape }} due {{ time }}","Overdue":"Overdue","Skipped":"Skipped","Visited":"Visited","{{trackedEntityName}} in program{{escape}} {{programName}}":"{{trackedEntityName}} in program{{escape}} {{programName}}","Program not found":"Program not found","Program is not a tracker program":"Program is not a tracker program","Error saving event":"Error saving event","Could not save event":"Could not save event","Could not delete event":"Could not delete event","Could not save working list":"Could not save working list","Could not add working list":"Could not add working list","Could not delete working list":"Could not delete working list","Organisation unit search failed.":"Organisation unit search failed.","Error saving tracked entity instance":"Error saving tracked entity instance","Error saving enrollment":"Error saving enrollment","Error saving the enrollment event":"Error saving the enrollment event","Error deleting the enrollment event":"Error deleting the enrollment event","Error editing the event, the changes made were not saved":"Error editing the event, the changes made were not saved","Error updating the Assignee":"Error updating the Assignee","Set coordinate":"Set coordinate","Time":"Time","From date":"From date","From time":"From time","To date":"To date","To time":"To time","Page {{currentPage}}":"Page {{currentPage}}","Area on map saved":"Area on map saved","Compatibility mode":"Compatibility mode"}');n.A.addResources("en","default",a);var o=n.A,i=r(53595),s=r(80460);function l(e){return(t,r,n)=>({type:e,payload:t,meta:r,error:n})}function d(e){return t=>({...e,payload:{...e.payload,...t}})}const c="CoreLoad",u="OrgUnitCaptureRootsLoadSuccess",p="OrgUnitSearchRootsLoadSuccess",m="SetCurrentOrgUnitRoot",g="AppLoad",h="AppLoadSuccess",E="AppLoadFailed";var y=r(50016),v=r(89764),f=r(92820),I=r(54306),b=(r(91750),r(26517)),S=r.n(b),T=r(78676),A=r(60898),C=r(98189);const O=(0,I.withStyles)((()=>({container:{left:"50%",position:"fixed",top:"50%",transform:"translate(-50%, -50%)"}})))((e=>y.createElement("div",{className:e.classes.container},y.createElement(C.F,null))));var N=r(29915),R=r(83557);class w extends y.Component{render(){return y.createElement(N.a,{hide:!1},y.createElement(R.$,null,y.createElement(C.F,null)))}}const _=(0,I.withStyles)((()=>({container:{display:"flex",alignItems:"center",justifyContent:"center",height:"calc(100vh - 48px)"}})))((e=>{const{containerStyle:t,classes:r}=e;return y.createElement("div",{className:r.container,style:t},y.createElement(C.F,null))})),P=()=>y.createElement(C.F,{small:!0});function k(e,t){this.message=e,this.innerError=t,this.toString=()=>this.message}const D=e=>async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={[t.resource]:t},{[t.resource]:a}=await e(n,{variables:r});return a},U=Object.freeze({events:"events",trackedEntities:"trackedEntities",relationships:"relationships"}),L=(e,t)=>t&&(t[e]||t.instances)||[],F={prod:"production",dev:"development",test:"test",devDebug:"dev-debug"},x={POINT:"FEATURETYPE_POINT",POLYGON:"FEATURETYPE_POLYGON"},M=Object.freeze({SINGLE_EVENT:"singleEvent",ENROLLMENT_EVENT:"enrollmentEvent"}),V=Object.freeze({EDIT:"editEvent",VIEW:"viewEvent"});var j=r(5947),G=r(51079),B=r(74161),$=r.n(B);class W{static set(e){W.currentData=e}static get(){return W.currentData}}const H={USER_CACHES:"userCaches",STATUS:"status",SYSTEM_SETTINGS:"systemSettings"},z={CONSTANTS:"constants",ORGANISATION_UNIT_LEVELS:"organisationUnitLevels",ORGANISATION_UNIT_GROUPS:"organisationUnitGroups",RELATIONSHIP_TYPES:"relationshipTypes",TRACKED_ENTITY_TYPES:"trackedEntityTypes",PROGRAMS:"programs",ORGANISATION_UNITS_BY_PROGRAM:"organisationUnitsByProgram",PROGRAM_RULES:"programRules",PROGRAM_RULES_VARIABLES:"programRulesVariables",PROGRAM_INDICATORS:"programIndicators",TRACKED_ENTITY_ATTRIBUTES:"trackedEntityAttributes",DATA_ELEMENTS:"dataElements",OPTION_SETS:"optionSets",CATEGORIES:"categories",CATEGORY_OPTIONS_BY_CATEGORY:"categoryOptionsByCategory",CATEGORY_OPTIONS:"categoryOptions",REDUX_PERSIST:"reduxPersist"};var Y,q,K,Q=r(43348),X=r(96092);function J(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Z{static isSupported(){return Z.indexedDB&&Z.iDBKeyRange&&Z.iDBTransaction}static closeDB(e){e.close()}static destroyDB(e){return new Promise(((t,r)=>{const n=Z.indexedDB.deleteDatabase(e);let a=!1;n.onsuccess=e=>{a||t(e)},n.onerror=e=>{r((0,X.p)(Z.errorMessages.DESTROY_FAILED)({error:e}))},n.onblocked=e=>{a=!0,r((0,X.p)(Z.errorMessages.DESTROY_BLOCKED)({error:e}))}}))}static get(e,t,r,n,a){return new Promise(((o,i)=>{let s,l;try{let d;s=n.transaction([e],Z.transactionMode.READ_ONLY),s.oncomplete=()=>{o(d)},s.onerror=e=>{i((0,X.p)(Z.errorMessages.GET_FAILED)({error:e}))},s.onabort=()=>{i((0,X.p)(Z.errorMessages.GET_FAILED)({aborted:!0,error:l}))};const c=s.objectStore(e);c.get(t).onsuccess=e=>{const n=e.target.result,{project:o}=r||{};(0,Q.A)(n)&&(n[a]=t),d=o?o(n):n}}catch(d){s&&(e=>{l=e,s.abort()})(d),i((0,X.p)(Z.errorMessages.GET_FAILED)({error:d}))}}))}constructor(e){this.name=e.name,this.version=e.version,this.objectStoreNames=e.objectStores,this.keyPath=e.keyPath,this.onCacheExpired=e.onCacheExpired}_upgrade(e){if(this.db.objectStoreNames){Array.from(this.db.objectStoreNames).forEach((e=>{this.db.deleteObjectStore(e)}))}this.objectStoreNames.forEach((t=>{const r=this.db.createObjectStore(t);e&&e(r,Z)}))}static facilitateDowngradeIfApplicable(e,t,r,n){const a=Z.indexedDB.open(e);return new Promise(((o,i)=>{a.onsuccess=a=>{const s=a.target.result.version,l=a.target.result;l.onversionchange=()=>{l.close()},s>t?Promise.resolve().then((()=>n&&n({get:(e,t)=>l.objectStoreNames.contains(e)?Z.get(e,t,l,r):Promise.resolve(null),isDowngrade:!0}))).then((()=>{Z.closeDB(l),Z.destroyDB(e).then((()=>{o(!0)})).catch((e=>{S().error((0,X.p)(Z.errorMessages.OPEN_FAILED)({error:e})),i(Z.errorMessages.OPEN_FAILED)}))})):(Z.closeDB(l),o(!1))},a.onerror=e=>{S().error((0,X.p)(Z.errorMessages.OPEN_FAILED)({error:e})),i(Z.errorMessages.OPEN_FAILED)}}))}async open(e,t,r){const n=await Z.facilitateDowngradeIfApplicable(this.name,this.version,this.keyPath,e),a=Z.indexedDB.open(this.name,this.version);let o=!1;await new Promise(((i,s)=>{a.onsuccess=e=>{this.db=e.target.result,this.db.onversionchange=()=>{this.db.close(),this.db=void 0,this.onCacheExpired&&this.onCacheExpired()},i()},a.onerror=e=>{s((0,X.p)(Z.errorMessages.OPEN_FAILED)({adapter:this,error:e}))},a.onblocked=e=>{o=!0,s((0,X.p)(Z.errorMessages.OPEN_BLOCKED)({adapter:this,error:e}))},a.onupgradeneeded=a=>{const i=a.target.transaction;if(!o)return this.db=a.target.result,this.db.onversionchange=()=>{this.db.close(),this.db=void 0},Promise.resolve().then((()=>!n&&e&&e({get:(e,t)=>this.db.objectStoreNames.contains(e)?this.getForUpgrade(e,t,i):Promise.resolve(null)}))).then((()=>(this._upgrade(r),Promise.resolve()))).then((()=>t&&t({set:(e,t)=>this.setForUpgrade(e,t,i)})));i.abort()}}))}setForUpgrade(e,t,r){return new Promise(((n,a)=>{const o=JSON.parse(JSON.stringify(t)),i=o[this.keyPath],s=r.objectStore(e).put(o,i);s.onsuccess=()=>{n(o)},s.onerror=e=>{a((0,X.p)(Z.errorMessages.SET_FAILED)({adapter:this,error:e}))}}))}set(e,t){return new Promise(((r,n)=>{let a,o;try{const i=JSON.parse(JSON.stringify(t)),s=i[this.keyPath];a=this.db.transaction([e],Z.transactionMode.READ_WRITE),a.oncomplete=()=>{r(i)},a.onerror=e=>{n((0,X.p)(Z.errorMessages.SET_FAILED)({adapter:this,error:e}))},a.onabort=()=>{n((0,X.p)(Z.errorMessages.SET_FAILED)({adapter:this,aborted:!0,error:o}))};a.objectStore(e).put(i,s)}catch(i){a?(e=>{o=e,a.abort()})(i):n((0,X.p)(Z.errorMessages.SET_FAILED)({adapter:this,error:i}))}}))}setAll(e,t){return new Promise(((r,n)=>{let a,o;const i=e=>{o=e,a.abort()};try{a=this.db.transaction([e],Z.transactionMode.READ_WRITE),a.oncomplete=()=>{r()},a.onerror=e=>{n((0,X.p)(Z.errorMessages.SET_FAILED)({adapter:this,error:e}))},a.onabort=()=>{n((0,X.p)(Z.errorMessages.SET_FAILED)({adapter:this,aborted:!0,error:o}))};const s=a.objectStore(e);let l=0;const d=()=>{if(l<t.length){const e=t[l],r=JSON.parse(JSON.stringify(e));(0,Q.A)(r)&&(0,Q.A)(r[this.keyPath])||i((0,X.p)(Z.errorMessages.INVALID_STORAGE_OBJECT)({adapter:this}));const n=r[this.keyPath];s.put(r,n).onsuccess=()=>{l+=1,d()}}};d()}catch(s){a&&i(s),n((0,X.p)(Z.errorMessages.SET_FAILED)({adapter:this,error:s}))}}))}getForUpgrade(e,t,r){return new Promise(((n,a)=>{const o=r.objectStore(e).get(t);o.onsuccess=e=>{const r=e.target.result;(0,Q.A)(r)&&(r[this.keyPath]=t),n(r)},o.onerror=e=>{a((0,X.p)(Z.errorMessages.GET_FAILED)({adapter:this,error:e}))}}))}get(e,t,r){return Z.get(e,t,r,this.db,this.keyPath)}async _getAllInBatches(e,t,r){const{predicate:n,project:a,onIDBGetRequest:o,batchSize:i}=t||{},s=t=>new Promise((s=>{const l=o?o(e,Z):e.getAll(t,i);l.onsuccess=()=>{const e=l.result,t=e?e.length:0;let o;t>0&&(e.forEach((e=>{this._processGetAllItem(e,n,a,r)})),o=e[t-1].id),s({count:t,lastId:o})}}));let l,d=!1;do{const{count:e,lastId:t}=await s(l);e<i?d=!0:l=IDBKeyRange.lowerBound(t,!0)}while(!d)}_getAllWithCursor(e,t,r,n){const{predicate:a,project:o,onIsAborted:i,onIDBGetRequest:s}=t||{};(s?s(e,Z):e.openCursor()).onsuccess=e=>{if(!!i&&i())n();else{const t=e.target.result;if(t){t.value[this.keyPath]=t.primaryKey||t.key;const e=t.value;this._processGetAllItem(e,a,o,r),t.continue()}}}}_processGetAllItem(e,t,r,n){if(!t||t(e)){const t=r?r(e):e;n.push(t)}}getAll(e,t){return new Promise(((r,n)=>{let a,o;const i=e=>{o=e,a.abort()},{batchSize:s,isAborted:l}=t||{};try{const d=[];a=this.db.transaction([e],Z.transactionMode.READ_ONLY);const c=a.objectStore(e);s?this._getAllInBatches(c,t,d,i):this._getAllWithCursor(c,t,d,i),a.oncomplete=()=>{l&&l()?n((0,X.p)(Z.errorMessages.GET_ALL_FAILED)({adapter:this,aborted:!0,error:o})):r(d)},a.onerror=e=>{l&&l()?n((0,X.p)(Z.errorMessages.GET_ALL_FAILED)({adapter:this,aborted:!0,error:o})):n((0,X.p)(Z.errorMessages.GET_ALL_FAILED)({adapter:this,error:e}))},a.onabort=()=>{n((0,X.p)(Z.errorMessages.GET_ALL_FAILED)({adapter:this,aborted:!0,error:o}))}}catch(d){a&&i(d),n((0,X.p)(Z.errorMessages.GET_ALL_FAILED)({adapter:this,error:d}))}}))}getKeys(e){return new Promise(((t,r)=>{let n,a;try{const o=[];n=this.db.transaction([e],Z.transactionMode.READ_ONLY),n.oncomplete=()=>{t(o)},n.onerror=e=>{r((0,X.p)(Z.errorMessages.GET_KEYS_FAILED)({adapter:this,error:e}))},n.onabort=()=>{r((0,X.p)(Z.errorMessages.GET_KEYS_FAILED)({adapter:this,aborted:!0,error:a}))};const i=n.objectStore(e);i.openCursor().onsuccess=e=>{const t=e.target.result;t&&(o.push(t.key),t.continue())}}catch(o){n&&(e=>{a=e,n.abort()})(o),r((0,X.p)(Z.errorMessages.GET_KEYS_FAILED)({adapter:this,error:o}))}}))}remove(e,t){return new Promise(((r,n)=>{let a,o;try{a=this.db.transaction([e],Z.transactionMode.READ_WRITE),a.oncomplete=()=>{r()},a.onerror=e=>{n((0,X.p)(Z.errorMessages.REMOVE_FAILED)({adapter:this,error:e}))},a.onabort=()=>{n((0,X.p)(Z.errorMessages.REMOVE_FAILED)({adapter:this,aborted:!0,error:o}))};const i=a.objectStore(e);Array.isArray(t)?t.forEach((e=>{i.delete(e)})):i.delete(t)}catch(i){a&&(e=>{o=e,a.abort()})(i),n((0,X.p)(Z.errorMessages.REMOVE_FAILED)({adapter:this,error:i}))}}))}removeAll(e){return new Promise(((t,r)=>{let n,a;try{n=this.db.transaction([e],Z.transactionMode.READ_WRITE),n.oncomplete=()=>{t()},n.onerror=e=>{r((0,X.p)(Z.errorMessages.REMOVE_ALL_FAILED)({adapter:this,error:e}))},n.onabort=()=>{r((0,X.p)(Z.errorMessages.REMOVE_ALL_FAILED)({adapter:this,aborted:!0,error:a}))};n.objectStore(e).clear()}catch(o){n&&(e=>{a=e,n.abort()})(o),r((0,X.p)(Z.errorMessages.REMOVE_ALL_FAILED)({adapter:this,error:o}))}}))}contains(e,t){return new Promise(((r,n)=>{let a,o;try{let i;a=this.db.transaction([e],Z.transactionMode.READ_ONLY),a.oncomplete=()=>{r(i)},a.onerror=e=>{n((0,X.p)(Z.errorMessages.CONTAINS_FAILED)({adapter:this,error:e}))},a.onabort=()=>{n((0,X.p)(Z.errorMessages.CONTAINS_FAILED)({adapter:this,aborted:!0,error:o}))};const s=a.objectStore(e);s.get(t).onsuccess=e=>{const t=e.target.result;i=!!t}}catch(i){a&&(e=>{o=e,a.abort()})(i),n((0,X.p)(Z.errorMessages.CONTAINS_FAILED)({adapter:this,error:i}))}}))}count(e,t){return new Promise(((r,n)=>{const{onIDBGetRequest:a,query:o}=t||{};let i,s;try{let t;i=this.db.transaction([e],Z.transactionMode.READ_ONLY),i.oncomplete=()=>{r(t)},i.onerror=e=>{n((0,X.p)(Z.errorMessages.COUNT_FAILED)({adapter:this,error:e}))},i.onabort=()=>{n((0,X.p)(Z.errorMessages.COUNT_FAILED)({adapter:this,aborted:!0,error:s}))};const l=i.objectStore(e);(a?a(l):l.count(o)).onsuccess=e=>{t=e.target.result}}catch(l){i&&(e=>{s=e,i.abort()})(l),n((0,X.p)(Z.errorMessages.COUNT_FAILED)({adapter:this,error:l}))}}))}close(){return new Promise(((e,t)=>{if(this.db)try{const t=this.db;Z.closeDB(t),this.db=null,e()}catch(r){t((0,X.p)(Z.errorMessages.CLOSE_FAILED)({adapter:this,error:r}))}else e()}))}async destroy(){await new Promise(((e,t)=>{this.close().then((()=>{e()})).catch((e=>{t((0,X.p)(Z.errorMessages.CLOSE_FAILED_FROM_DESTROY)({adapter:this,error:e}))}))})),await Z.destroyDB(this.name)}isOpen(){return!!this.db}}function ee(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}J(Z,"errorMessages",{OPEN_FAILED:"open indexedDB failed",OPEN_BLOCKED:"indexedDB blocked",OPEN_DATABASE_FIRST:"Open database first",INVALID_STORAGE_OBJECT:"Invalid storage object",STORAGE_ARRAY_NOT_PROVIDED:"An array must be provided",SET_FAILED:"Save to indexedDB failed",INVALID_KEY:"Key is invalid",GET_FAILED:"Get from indexedDB failed",GET_ALL_FAILED:"Get All from indexedDB failed",GET_KEYS_FAILED:"Get Keys from indexedDB failed",REMOVE_FAILED:"Remove from indexedDB failed",REMOVE_ALL_FAILED:"Remove all from indexedDB failed",CONTAINS_FAILED:"Contains check from indexedDB failed",COUNT_FAILED:"Count from indexedDB failed",CLOSE_FAILED:"Close indexedDB failed",DESTROY_FAILED:"Destroy indexedDB failed",DESTROY_BLOCKED:"Destroy indexedDB blocked",CLOSE_FAILED_FROM_DESTROY:"Close indexedDB failed from destroy"}),J(Z,"transactionMode",{READ_WRITE:"readwrite",READ_ONLY:"readonly"}),J(Z,"adapterName","IndexedDBAdapter"),J(Z,"indexedDB",window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB),J(Z,"iDBKeyRange",(()=>{const e=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;return e?e.bind(window):null})()),J(Z,"iDBTransaction",(()=>{const e=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;return e?e.bind(window):null})());class te{constructor(e,t,r){this.key=`${e}.${t}.**index**`,this.storage=r}all(){let e=this.storage.getItem(this.key);if(e)try{e=JSON.parse(e)}catch(t){e=null}return e||this.storage.setItem(this.key,JSON.stringify([])),JSON.parse(this.storage.getItem(this.key))}add(e){const t=this.all();t.push(e),this.storage.setItem(this.key,JSON.stringify(t))}remove(e){const t=this.all();t.includes(e)&&(t.splice(t.indexOf(e),1),this.storage.setItem(this.key,JSON.stringify(t)))}find(e){return this.all().indexOf(e)}exists(e){return-1!==this.all().indexOf(e)}destroy(){this.storage.removeItem(this.key)}}class re{static isSupported(){return!!re.storage}constructor(e){this.name=e.name,this.version=e.version||1,this.objectStoreNames=e.objectStores,this.keyPath=e.keyPath,this.opened=!1}open(e,t){this.indexer=this.objectStoreNames.reduce(((e,t)=>(e[t]=new te(this.name,t,re.storage),e)),{});const r=`${this.name}.${re.CACHEVERSIONKEY}`,n=re.storage.getItem(r),a=n&&JSON.parse(n);return this.opened=!0,this.version!==a?Promise.resolve().then((()=>e&&e({get:this.get.bind(this)}))).then((()=>(this._executeDestroy(),re.storage.setItem(r,JSON.stringify(this.version)),Promise.resolve()))).then((()=>t&&t({set:this.set.bind(this)}))):Promise.resolve()}_executeSet(e,t){const r=JSON.parse(JSON.stringify(t)),n=r[this.keyPath];delete r[this.keyPath];const a=this.getStoreKey(e,n);this.indexer[e].exists(a)||this.indexer[e].add(a),re.storage.setItem(a,JSON.stringify(r))}set(e,t){return new Promise(((r,n)=>{try{this._executeSet(e,t),r()}catch(a){n((0,X.p)(re.errorMessages.SET_FAILED)({adapter:this,error:a}))}}))}setAll(e,t){try{return t.forEach((t=>{this._executeSet(e,t)})),Promise.resolve()}catch(r){return Promise.reject(r)}}get(e,t){return new Promise((r=>{const n=re.storage.getItem(this.getStoreKey(e,t));let a;n&&(a=JSON.parse(n),a[this.keyPath]=t),r(a)}))}getAll(e,t){const{predicate:r,project:n}=t||{},a=this.indexer[e].all().reduce(((t,a)=>{const o=re.storage.getItem(a);if(o&&(!r||r(o))){const r=JSON.parse(o);r[this.keyPath]=this.mainKeyFromStoreKey(a,e);const i=n?n(r):r;t.push(i)}return t}),[]);return Promise.resolve(a)}_executeGetKeys(e){return this.indexer[e].all().map((t=>this.mainKeyFromStoreKey(t,e)))}getKeys(e){return Promise.resolve(this._executeGetKeys(e))}_executeRemove(e,t){const r=this.getStoreKey(e,t);this.indexer[e].remove(r),re.storage.removeItem(r)}remove(e,t){return this._executeRemove(e,t),Promise.resolve()}_executeRemoveAll(e){this._executeGetKeys(e).forEach((t=>{this._executeRemove(e,t)}))}removeAll(e){return Promise.resolve(this._executeRemoveAll(e))}contains(e,t){const r=this.getStoreKey(e,t);return Promise.resolve(this.indexer[e].exists(r))}count(e,t){return t&&Promise.reject((0,X.p)(re.errorMessages.KEY_BASED_COUNT_IS_NOT_SUPPORTED)({adapter:this})),Promise.resolve(this.indexer[e].all().length)}close(){return this.opened=!1,Promise.resolve()}_executeDestroy(){this.objectStoreNames.forEach((e=>{this._executeRemoveAll(e),this.indexer[e].destroy()}))}destroy(){return this.opened=!1,this._executeDestroy(),Promise.resolve()}isOpen(){return this.opened}getStoreKey(e,t){return`${this.name}.${e}.${t}`}mainKeyFromStoreKey(e,t){return e.replace(`${this.name}.${t}.`,"")}}ee(re,"storage",window.localStorage),ee(re,"adapterName","DomLocalStorageAdapter"),ee(re,"CACHEVERSIONKEY","__VERSION__"),ee(re,"errorMessages",{INVALID_STORAGE_OBJECT:"Invalid storage object",SET_FAILED:"Save to localStorage failed",INVALID_KEY:"Key is invalid",KEY_BASED_COUNT_IS_NOT_SUPPORTED:"Key based count is not supported by DomLocalStorageAdapter",STORAGE_NOT_OPENED:"Please call open first in the DomLocalStorageAdapter"});class ne{static isSupported(){return!0}constructor(e){this.name=e.name,this.version=e.version||1,this.objectStoreNames=e.objectStores,this.keyPath=e.keyPath,this.opened=!1}open(){this.storage=this.objectStoreNames.reduce(((e,t)=>(e[t]=new Map,e)),{}),this.opened=!0}_executeSet(e,t){const r=t[this.keyPath];e.set(r,t)}set(e,t){const r=this.storage[e];this._executeSet(r,t)}setAll(e,t){const r=this.storage[e];t.forEach((e=>{this._executeSet(r,e)}))}get(e,t){return this.storage[e].get(t)}getAll(e,t){const r=this.storage[e],n=Array.from(r.values()),{predicate:a,project:o,onEditSource:i}=t||{},s=i?i(n,ne):n,l=a?s.filter(a):s;return o?l.map(o):l}getKeys(e){const t=this.storage[e];return Array.from(t.keys())}contains(e,t){return this.storage[e].has(t)}count(e,t){if(t)throw Error((0,X.p)(ne.errorMessages.KEY_BASED_COUNT_IS_NOT_SUPPORTED)({adapter:this}));return this.storage[e].size}remove(e,t){this.storage[e].delete(t)}removeAll(e){this.storage[e]=new Map}close(){this.opened=!1}destroy(){this.opened=!1,this.storage=this.objectStoreNames.reduce(((e,t)=>(e[t]=new Map,e)),{})}isOpen(){return this.opened}}Y=ne,K={INVALID_STORE_NAME:"Invalid store name",KEY_BASED_COUNT_IS_NOT_SUPPORTED:"Key based count is not supported by DomLocalStorageAdapter"},(q=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(q="errorMessages"))in Y?Object.defineProperty(Y,q,{value:K,enumerable:!0,configurable:!0,writable:!0}):Y[q]=K;const ae={INDEXED_DB:Z,LOCAL_STORAGE:re,MEMORY:ne};var oe=r(61964);class ie extends Error{constructor(e){super(e.message),this.error=e}}function se(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class le{static isAdapterValid(e){if(!"isSupported".split(" ").every((t=>e[t])))return!1;return"open set setAll get getAll getKeys count contains remove removeAll close destroy isOpen".split(" ").every((t=>e.prototype[t]))}constructor(e,t,r){let{Adapters:n,objectStores:a,onCacheExpired:o}=r;if(se(this,"throwIfDataObjectError",(e=>{if(!e||!e[this.adapter.keyPath])throw new ie((0,X.p)(le.errorMessages.INVALID_STORAGE_OBJECT)({adapter:this.adapter}))})),!e)throw new Error(le.errorMessages.INVALID_NAME);if(!n||!(0,oe.default)(n)||0===n.length)throw new Error(le.errorMessages.NO_ADAPTERS_DEFINED);const i=n.filter((e=>{if(!le.isAdapterValid(e))throw new ie((0,X.p)(le.errorMessages.INVALID_ADAPTER_PROVIDED)({Adapter:e}));return e.isSupported()}));if(i.length<=0)throw new Error(le.errorMessages.NO_VALID_ADAPTERS_FOUND);this.name=e,this.version=t,this.Adapters=n,this.AvailableAdapters=i;const s=i[0];this.adapter=new s({name:e,version:t,objectStores:a,keyPath:"id",onCacheExpired:o}),this.adapterType=s}getOpenStatusError(){return this.adapter.isOpen()?null:(0,X.p)(le.errorMessages.STORAGE_NOT_OPEN)({adapter:this.adapter})}throwIfNotOpen(){if(this.getOpenStatusError())throw new ie((0,X.p)(le.errorMessages.STORAGE_NOT_OPEN)({adapter:this.adapter}))}throwIfStoreNotFound(e,t){if(!e||!this.adapter.objectStoreNames.includes(e))throw new ie((0,X.p)(le.errorMessages.INVALID_OBJECTSTORE)({storageContainer:this,adapter:this.adapter,method:t}))}throwIfDataArrayError(e){if(!e)throw new ie((0,X.p)(le.errorMessages.INVALID_STORAGE_ARRAY)({adapter:this.adapter}));e.forEach(this.throwIfDataObjectError)}async _openFallbackAdapter(){const e=this.AvailableAdapters.findIndex((e=>e===this.adapterType))+1;if(this.AvailableAdapters.length<=e)throw new ie(le.errorMessages.OPEN_FAILED);const t=this.AvailableAdapters[e],r=new t({name:this.adapter.name,version:this.adapter.version,objectStores:this.adapter.objectStoreNames,keyPath:"id"});this.adapter=r,this.adapterType=t,await this.open(...arguments)}async open(){if(this.adapter.isOpen())throw new ie((0,X.p)(le.errorMessages.STORAGE_ALREADY_OPEN)({adapter:this.adapter}));const e=this.adapter.objectStoreNames;if(!e||!(0,oe.default)(e)||0===e.length)throw new ie(le.errorMessages.NO_OBJECTSTORES_DEFINED);try{await this.adapter.open(...arguments)}catch(t){await this._openFallbackAdapter(...arguments)}}async setWithoutFallback(e,t){return this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"set"),this.throwIfDataObjectError(t),this.adapter.set(e,t)}async set(e,t){return this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"set"),this.throwIfDataObjectError(t),Promise.resolve().then((()=>this.adapter.set(e,t))).catch((r=>(S().error((0,X.p)(le.errorMessages.SET_FAILED)({adapter:this.adapter,store:e,dataObject:t,error:r})),Promise.reject(le.errorMessages.SET_FAILED))))}async setAll(e,t){return this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"setAll"),this.throwIfDataArrayError(t),Promise.resolve().then((()=>this.adapter.setAll(e,t))).catch((r=>(S().error((0,X.p)(le.errorMessages.SET_ALL_FAILED)({adapter:this.adapter,store:e,dataArray:t,error:r})),Promise.reject(le.errorMessages.SET_ALL_FAILED))))}async get(e,t,r){if(this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"get"),!t)throw Error((0,X.p)(le.errorMessages.MISSING_KEY)({adapter:this.adapter,key:t,method:"get"}));return this.adapter.get(e,t,r)}async getAll(e,t){return this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"getAll"),this.adapter.getAll(e,t)}async getKeys(e){return this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"getKeys"),this.adapter.getKeys(e)}async remove(e,t){if(this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"remove"),!t)throw Error((0,X.p)(le.errorMessages.MISSING_KEY)({adapter:this.adapter,key:t,method:"remove"}));return this.adapter.remove(e,t)}async removeAll(e){return this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"removeAll"),this.adapter.removeAll(e)}async contains(e,t){if(this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"contains"),!t)throw Error((0,X.p)(le.errorMessages.MISSING_KEY)({adapter:this.adapter,key:t,method:"contains"}));return this.adapter.contains(e,t)}async count(e,t){return this.throwIfNotOpen(),this.throwIfStoreNotFound(e,"count"),this.adapter.count(e,t)}async close(){return this.adapter.close(...arguments)}async destroy(){return this.adapter.destroy(...arguments)}}function de(e,t){const r=e.name+t.id;const n=e.version,a=function(){const e=Object.keys(z).map((e=>z[e]));return e}();return new le(r,n,{Adapters:[e.adapterType],objectStores:a})}se(le,"errorMessages",{INVALID_NAME:"A valid database name must be provided",NO_OBJECTSTORES_DEFINED:"no objectStores defined",NO_ADAPTERS_PROVIDED:"no adapters provided",NO_VALID_ADAPTERS_FOUND:"no valid adapters found",INVALID_ADAPTER_PROVIDED:"An invalid adapter was provided",INVALID_OBJECTSTORE:"Specify a valid objectStore",STORAGE_NOT_OPEN:"Please open storage first",STORAGE_ALREADY_OPEN:"Storage is already open",INVALID_STORAGE_OBJECT:"Invalid storage object",INVALID_STORAGE_ARRAY:"Invalid storage array",MISSING_KEY:"Please specifiy key",OPEN_FAILED:"Open storage failed",SET_FAILED:"Could not save to cache",SET_ALL_FAILED:"Could not save all to cache"});const ce={[z.CATEGORY_OPTIONS]:e=>{e.createIndex("categoryId","categories",{multiEntry:!0})},[z.PROGRAM_RULES]:e=>{e.createIndex("programId","programId")},[z.PROGRAM_RULES_VARIABLES]:e=>{e.createIndex("programId","programId")},[z.PROGRAM_INDICATORS]:e=>{e.createIndex("programId","programId")},[z.ORGANISATION_UNIT_GROUPS]:e=>{e.createIndex("organisationUnitId","organisationUnitIds",{multiEntry:!0})}};const ue="dhis2ca";function pe(){return 1e3*(Number("38")-30)+Number("7")}async function me(e,t){const r=function(e,t,r){const n=pe(),a=new le(e,n,{Adapters:t,objectStores:Object.keys(H).map((e=>H[e])),onCacheExpired:r});return a}(ue,e,t);let n;return await r.open((e=>e.get(H.USER_CACHES,"accessHistory").then((e=>{n=e}))),(e=>n?e.set(H.USER_CACHES,n):null)),r}const ge=[ae.INDEXED_DB],he={};async function Ee(e,t){he.main=await me(ge,e),he.user=await async function(e,t){const r=de(e,t);let n;return await r.open((e=>e.get(z.REDUX_PERSIST,"reduxPersist:offline").then((e=>{n=e}))),(e=>n?e.set(z.REDUX_PERSIST,n):null),((e,t)=>{t===Z&&ce[e.name]&&ce[e.name](e)})),r}(he.main,t)}function ye(){return he.main}function ve(){return he.user}let fe;const Ie=()=>{if(!fe)throw Error("metadata loader context not set");return fe},be=(e,t)=>{const{onQueryApi:r}=Ie();return r(e,t)},Se=async function(e){let{query:t,storeName:r,convertQueryResponse:n}=e,{queryVariables:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{storageController:o}=Ie(),i=await be(t,a),s=n(i);return s&&s.length>0&&await o.setAll(r,s),{rawResponse:i,convertedData:s}},Te=(e,t,r)=>{const n=async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const o=await(async(e,t,r)=>{let{convertQueryResponse:n,queryVariables:a}=r;const{rawResponse:o}=await Se({query:e,storeName:t,convertQueryResponse:n},{queryVariables:a});return!(o&&o.pager&&o.pager.nextPage)})(e,t,{convertQueryResponse:r,queryVariables:{iteration:a}});o||await n(a+1)};return n()},Ae=function(e){let{query:t,storeName:r,convertQueryResponse:n}=e,{iterationSize:a=500}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=((e,t)=>({...e,params:r=>({...e.params,pageSize:t,page:r.iteration})}))(t,a);return Te(o,r,n)},Ce=()=>Ae({query:{resource:"constants",params:{fields:"id,displayName,value"}},storeName:Ie().storeNames.CONSTANTS,convertQueryResponse:e=>e&&e.constants}),Oe=()=>Ae({query:{resource:"organisationUnitLevels",params:{fields:"id,displayName,level",filter:"level:gt:1"}},storeName:Ie().storeNames.ORGANISATION_UNIT_LEVELS,convertQueryResponse:e=>e&&e.organisationUnitLevels}),Ne=()=>Ae({query:{resource:"relationshipTypes",params:{fields:"id,displayName,bidirectional,fromToName,toFromName,fromConstraint[relationshipEntity,trackerDataView,trackedEntityType[id,name],program[id,name],programStage[id,name,program[id]]],toConstraint[relationshipEntity,trackerDataView,trackedEntityType[id,name],program[id,name],programStage[id,name,program[id]]],access[*],referral"}},storeName:Ie().storeNames.RELATIONSHIP_TYPES,convertQueryResponse:e=>e&&e.relationshipTypes}),Re=e=>e&&e.organisationUnitGroups&&e.organisationUnitGroups.map((e=>({...e,organisationUnits:void 0,organisationUnitIds:(e.organisationUnits||[]).map((e=>e.id))}))),we=()=>Ae({query:{resource:"organisationUnitGroups",params:{fields:"id,name,code,organisationUnits[id]"}},storeName:Ie().storeNames.ORGANISATION_UNIT_GROUPS,convertQueryResponse:Re},{iterationSize:100}),_e=function(e){let{pageSize:t=500,convertQueryResponse:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=((e,t)=>({...e,params:r=>({...e.params,pageSize:t,page:r.page})}))(e,t);return((e,t)=>{const r=async function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const a=await be(e,{page:n}),o=t?t(a):a;return a&&a.pager&&a.pager.nextPage?[o,...await r(n+1)]:[o]};return r()})(n,r)},Pe=(()=>{const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sortOrder";return e.sort(((e,r)=>null==e[t]?null==r[t]?0:1:null==r[t]?-1:e[t]-r[t])),e},t=t=>{const r=(t||[]).map((t=>{return{...t,programStageDataElements:(n=t.programStageDataElements,(n||[]).filter((e=>{var t;return null===(t=e.dataElement)||void 0===t?void 0:t.id})).map((e=>{const{dataElement:t,...r}=e;return{...r,dataElementId:t.id}}))),programStageSections:(r=t.programStageSections,r?e(r):[])};var r,n}));return e(r),r};return e=>(e&&e.programs||[]).map((e=>{return{...e,trackedEntityType:void 0,trackedEntityTypeId:e.trackedEntityType&&e.trackedEntityType.id,programStages:t(e.programStages),programSections:(n=e.programSections,(n||[]).map((e=>({...e,trackedEntityAttributes:e.trackedEntityAttributes.map((e=>e.id))}))).sort(((e,t)=>e.sortOrder-t.sortOrder))),programTrackedEntityAttributes:(r=e.programTrackedEntityAttributes,(r||[]).filter((e=>{let{trackedEntityAttribute:t}=e;return null===t||void 0===t?void 0:t.id})).map((e=>(e=>({...e,trackedEntityAttribute:void 0,trackedEntityAttributeId:e.trackedEntityAttribute.id}))(e))))};var r,n}))})(),ke=e=>Object.keys(e).map((t=>({id:t,organisationUnits:e[t].reduce(((e,t)=>(e[t]=!0,e)),{})}))),De=(()=>{const e=e=>{const t={programStageSection:void 0,programStage:void 0,dataElement:void 0,trackedEntityAttribute:void 0,optionGroup:void 0,option:void 0},r=e=>e.programStage&&e.programStage.id,n=e=>e.dataElement&&e.dataElement.id,a=e=>e.trackedEntityAttribute&&e.trackedEntityAttribute.id,o=e=>e.optionGroup&&e.optionGroup.id,i=e=>e.option&&e.option.id;return e.map((e=>{return{...e,...t,programStageSectionId:(s=e,s.programStageSection&&s.programStageSection.id),programStageId:r(e),dataElementId:n(e),trackedEntityAttributeId:a(e),optionGroupId:o(e),optionId:i(e)};var s}))};return t=>(t&&t.programRules||[]).map((t=>({...t,program:void 0,programStage:void 0,programId:t.program&&t.program.id,programStageId:t.programStage&&t.programStage.id,programRuleActions:e(t.programRuleActions)})))})(),Ue=async e=>{const t={resource:"programRules",params:{fields:"id,displayName,condition,description,program[id],programStage[id],priority,programRuleActions[id,content,displayContent,location,data,programRuleActionType,programStageSection[id],dataElement[id],trackedEntityAttribute[id],programStage[id],optionGroup[id],option[id]]",filter:`program.id:in:[${e.join(",")}]`}};let r=[];return await Ae({query:t,storeName:Ie().storeNames.PROGRAM_RULES,convertQueryResponse:e=>{const t=De(e);return r=r.concat(t.map((e=>e.id))),t}}),r},Le=(()=>{const e={dataElement:void 0,trackedEntityAttribute:void 0,program:void 0,programStage:void 0,useCodeForOptionSet:void 0},t=e=>({dataElementId:e.dataElement&&e.dataElement.id,trackedEntityAttributeId:e.trackedEntityAttribute&&e.trackedEntityAttribute.id,programId:e.program&&e.program.id,programStageId:e.programStage&&e.programStage.id});return r=>(r&&r.programRuleVariables||[]).map((r=>({...r,...e,...t(r),useNameForOptionSet:null!=r.useCodeForOptionSet&&!r.useCodeForOptionSet})))})(),Fe=async e=>{const t={resource:"programRuleVariables",params:{fields:"id,displayName,programRuleVariableSourceType,valueType,program[id],programStage[id],dataElement[id],trackedEntityAttribute[id],useCodeForOptionSet",filter:`program.id:in:[${e.join(",")}]`}};let r=[];return await Ae({query:t,storeName:Ie().storeNames.PROGRAM_RULES_VARIABLES,convertQueryResponse:e=>{const t=Le(e);return r=r.concat(t.map((e=>e.id))),t}}),r},xe=async e=>{const t={resource:"programIndicators",params:{fields:"id,name,displayName,code,shortName,style,expression,displayDescription,description,filter,program[id]",filter:["displayInForm:eq:true",`program.id:in:[${e.join(",")}]`]}};let r=[];return await Ae({query:t,storeName:Ie().storeNames.PROGRAM_INDICATORS,convertQueryResponse:e=>{const t=(e=>(e&&e.programIndicators||[]).map((e=>({...e,program:void 0,programId:e.program&&e.program.id}))))(e);return r=r.concat(t.map((e=>e.id))),t}}),r},Me=e=>{const{storageController:t,storeNames:r}=Ie();return Promise.all([{storeName:r.PROGRAM_RULES_VARIABLES,storeFn:Fe},{storeName:r.PROGRAM_RULES,storeFn:Ue},{storeName:r.PROGRAM_INDICATORS,storeFn:xe}].map((async r=>{let{storeName:n,storeFn:a}=r;const o=await a(e),i=await(async r=>(await Promise.all(e.map((e=>t.getAll(r,{project:e=>e.id,onIDBGetRequest:t=>t.index("programId").openCursor(window.IDBKeyRange.only(e))}))))).flat(1))(n);await(async(e,r,n)=>{const a=e.reduce(((e,t)=>(e[t]=t,e)),{}),o=r.filter((e=>!a[e]));o.length>0&&await t.remove(n,o)})(o,i,n)})))},Ve=(()=>{const e=e=>e.flatMap((e=>{let{programStageDataElements:t}=e;return t.map((e=>{let{dataElementId:t}=e;return t}))})),t=e=>e.map((e=>e.trackedEntityAttributeId));return async r=>{await(e=>{const t={resource:"programs/orgUnits",params:{programs:e.join(",")}};return Se({query:t,storeName:Ie().storeNames.ORGANISATION_UNITS_BY_PROGRAM,convertQueryResponse:ke})})(r);const{convertedData:n=[]}=await(e=>{const t={resource:"programs",params:{fields:"id,displayName,displayShortName,description,programType,style,displayFrontPageList,useFirstStageDuringRegistration,onlyEnrollOnce,displayIncidentDateLabel,displayEnrollmentDateLabel,minAttributesRequiredToSearch,featureType,selectEnrollmentDatesInFuture,selectIncidentDatesInFuture,displayIncidentDate,dataEntryForm[id,htmlCode],access[*],trackedEntityType[id],categoryCombo[id,displayName,isDefault,categories[id,displayName]],userRoles[id,displayName],programStages[id,access,autoGenerateEvent,openAfterEnrollment,hideDueDate,allowGenerateNextVisit,remindCompleted,repeatable,generatedByEnrollmentDate,reportDateToUse,blockEntryForm,minDaysFromStart,name,displayName,description,displayExecutionDateLabel,displayDueDateLabel,formType,featureType,validationStrategy,enableUserAssignment,style,dataEntryForm[id,htmlCode]programStageSections[id,displayName,displayDescription,sortOrder,dataElements[id]],programStageDataElements[compulsory,displayInReports,renderOptionsAsRadio,allowFutureDate,renderType[*],dataElement[id]]]programSections[id, displayDescription, displayFormName, sortOrder, trackedEntityAttributes],programTrackedEntityAttributes[trackedEntityAttribute[id],displayInList,searchable,mandatory,renderOptionsAsRadio,allowFutureDate]",filter:`id:in:[${e.join(",")}]`,pageSize:e.length}};return Se({query:t,storeName:Ie().storeNames.PROGRAMS,convertQueryResponse:Pe})})(r);return await Me(r),n.map((r=>{let{programTrackedEntityAttributes:n,categoryCombo:a,trackedEntityTypeId:o,programStages:i}=r;return{trackedEntityAttributeIds:t(n),dataElementIds:e(i),categoryCombo:a,trackedEntityTypeId:o}}))}})(),je=(()=>{const e=e=>e.flatMap((e=>(e=>{return[...(r=e.programStages,(r||[]).flatMap((e=>(e.programStageDataElements||[]).map((e=>e.dataElement&&e.dataElement.optionSet)).filter((e=>e))))),...(t=e.programTrackedEntityAttributes,(t||[]).map((e=>e.trackedEntityAttribute&&e.trackedEntityAttribute.optionSet)).filter((e=>e)))];var t,r})(e))),t=e=>(0,j.Fs)((()=>e.flatMap((e=>{let{trackedEntityAttributeIds:t}=e;return t}))),(e=>[...new Set(e).values()]))(),r=e=>(0,j.Fs)((()=>e.flatMap((e=>{let{dataElementIds:t}=e;return t}))),(e=>[...new Set(e).values()]))(),n=e=>(0,j.Fs)((()=>e.flatMap((e=>e.categoryCombo&&e.categoryCombo.categories||[]))),(e=>[...new Map(e.map((e=>[e.id,e]))).values()]))(),a=e=>(0,j.Fs)((()=>e.reduce(((e,t)=>(t.trackedEntityTypeId&&e.add(t.trackedEntityTypeId),e)),new Set)),(e=>[...e.values()]))();return(o,i)=>({optionSetsOutline:e(o),trackedEntityAttributeIds:t(i),dataElementIds:r(i),categories:n(i),trackedEntityTypeIds:a(i),changesDetected:i.length>0})})(),Ge=async()=>{const e=await(async()=>(await _e({resource:"programs",params:{fields:"id,version,programTrackedEntityAttributes[trackedEntityAttribute[id,optionSet[id,version]]],programStages[id,programStageDataElements[dataElement[id,optionSet[id,version]]]]"}},{pageSize:1e3})).flatMap((e=>e&&e.programs||[])))(),t=await(()=>{const{storageController:e,storeNames:t}=Ie();return e.getAll(t.PROGRAMS,{project:e=>({id:e.id,version:e.version})})})();await(async(e,t)=>{const r=e.reduce(((e,t)=>(e[t.id]=t,e)),{}),n=t.filter((e=>!r[e.id])).map((e=>e.id));if(n.length>0){const{storageController:e,storeNames:t}=Ie();await e.remove(t.PROGRAMS,n),await e.remove(t.ORGANISATION_UNITS_BY_PROGRAM,n)}})(e,t);const r=((e,t)=>{const r=t.reduce(((e,t)=>(e[t.id]=t,e)),{});return e.filter((e=>{const t=r[e.id];return!t||t.version!==e.version})).map((e=>{let{id:t,version:r}=e;return{id:t,version:r}}))})(e,t),n=r.map((e=>{let{id:t}=e;return t})),a=(0,j.iv)(n,50),o=(await Promise.all(a.map(Ve))).flat(1);return{...je(e,o),stalePrograms:r}},Be=e=>(e&&e.trackedEntityTypes||[]).map((e=>{return{...e,trackedEntityTypeAttributes:(t=e.trackedEntityTypeAttributes,(t||[]).filter((e=>{let{trackedEntityAttribute:t}=e;return null===t||void 0===t?void 0:t.id})).map((e=>(e=>{const{trackedEntityAttribute:t,...r}=e;return{...r,trackedEntityAttributeId:t.id}})(e))))};var t})),$e=async e=>{const{convertedData:t=[]}=await(e=>{const t={resource:"trackedEntityTypes",params:{fields:"id,access,displayName,minAttributesRequiredToSearch,featureType,trackedEntityTypeAttributes[trackedEntityAttribute[id],displayInList,mandatory,searchable],translations[property,locale,value]",filter:`id:in:[${e.join(",")}]`,pageSize:e.length}};return Se({query:t,storeName:Ie().storeNames.TRACKED_ENTITY_TYPES,convertQueryResponse:Be})})(e);return t.map((e=>({trackedEntityTypeAttributes:e.trackedEntityTypeAttributes})))},We=(()=>{const e=e=>e.flatMap((e=>e.trackedEntityTypeAttributes.map((e=>e.trackedEntityAttribute&&e.trackedEntityAttribute.optionSet)).filter((e=>e)))),t=e=>e.flatMap((e=>(e.trackedEntityTypeAttributes||[]).map((e=>e.trackedEntityAttributeId)).filter((e=>e))));return async r=>{const n=await(async()=>(await _e({resource:"trackedEntityTypes",params:{fields:"id, trackedEntityTypeAttributes[trackedEntityAttribute[optionSet[id,version]]]"}},{pageSize:1e3})).flatMap((e=>e&&e.trackedEntityTypes||[])))();return{trackedEntityAttributeIds:t(r),optionSetsOutline:e(n)}}})();async function He(e){const t=(0,j.iv)([...new Set(e).values()],100);await Promise.all(t.map((e=>(e=>{const t={resource:"trackedEntityAttributes",params:{fields:"id,displayName,displayShortName,displayFormName,description,valueType,optionSetValue,unique,orgunitScope,pattern,code,attributeValues,inherit,translations[property,locale,value],optionSet[id]",filter:`id:in:[${e.join(",")}]`,pageSize:e.length}};return Se({query:t,storeName:Ie().storeNames.TRACKED_ENTITY_ATTRIBUTES,convertQueryResponse:e=>e.trackedEntityAttributes})})(e))))}const ze=e=>{var t;return null===e||void 0===e||null===(t=e.dataElements)||void 0===t?void 0:t.map((e=>(e.translations=(e.translations||[]).reduce(((e,t)=>(e[t.locale]||(e[t.locale]={}),e[t.locale][t.property]=t.value,e)),{}),e)))};async function Ye(e){const t=(0,j.iv)(e,100);await Promise.all(t.map((e=>(e=>{const t={resource:"dataElements",params:{fields:"id,displayName,code,displayShortName,displayFormName,valueType,translations[*],description,url,optionSetValue,style,optionSet[id]",filter:`id:in:[${e.join(",")}]`,pageSize:e.length}};return Se({query:t,storeName:Ie().storeNames.DATA_ELEMENTS,convertQueryResponse:ze})})(e))))}async function qe(e,t,r,n,a){const{categoryOptions:o,hasNextPage:i}=await async function(e,t,r){const n=await be(e,{page:t,pageSize:r});return{hasNextPage:!!(n&&n.pager&&n.pager.nextPage),categoryOptions:n&&n.categoryOptions||[]}}(t,e,n),s=function(e,t,r){return e.reduce(((e,r)=>r.categories.filter((e=>t.includes(e))).reduce(((e,t)=>{const n=e[t]||{};return n[r.id]=!0,e[t]=n,e}),e)),r)}(o,r,a),l=function(e){return e.map((e=>{const t=e.organisationUnits&&e.organisationUnits.length>0?e.organisationUnits.reduce(((e,t)=>(e[t]=!0,e)),{}):null;return e.organisationUnits=t,e}))}(o),{storageController:d,storeNames:c}=Ie();return await d.setAll(c.CATEGORY_OPTIONS,l),{hasNextPage:i,optionsByCategory:s}}async function Ke(e){await async function(e){const{storageController:t,storeNames:r}=Ie();return t.setAll(r.CATEGORIES,e)}(e);const t=e.map((e=>e.id)),r=(0,j.iv)(t,50);await r.asyncForEach((e=>async function(e){const t=function(e){return{resource:"categoryOptions",params:t=>({fields:"id,displayName,categories~pluck, organisationUnits~pluck, access[*]",filter:[`categories.id:in:[${e.join(",")}]`,"access.data.read:in:[true]"],page:t.page,pageSize:t.pageSize})}}(e);let r,n=0,a={};do{n+=1,({hasNextPage:r,optionsByCategory:a}=await qe(n,t,e,5e3,a))}while(r);const{storageController:o,storeNames:i}=Ie(),s=Object.keys(a).map((e=>({id:e,options:a[e]})));await o.setAll(i.CATEGORY_OPTIONS_BY_CATEGORY,s)}(e)))}const Qe={resource:"optionGroups",params:e=>({fields:"id,displayName,options[id],optionSet[id]",filter:`optionSet.id:in:[${e.ids.join(",")}]`,page:e.page,pageSize:e.pageSize})},Xe=e=>{const t=async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const{optionGroups:n,hasNextPage:a}=await(async(e,t,r)=>{const n=await be(Qe,{ids:e,page:t,pageSize:r});return{optionGroups:n&&n.optionGroups||[],hasNextPage:!!(n&&n.pager&&n.pager.nextPage)}})(e,r,1e3);if(a){const e=await t(r+=1);return[...n,...e]}return n||[]};return t()};async function Je(e){const t=e.reduce(((e,t)=>(e.find((e=>e.id===t.id))||e.push(t),e)),[]),r=await async function(e){const t=[],{storageController:r,storeNames:n}=Ie();return await e.asyncForEach((async e=>{const a=await r.get(n.OPTION_SETS,e.id);a&&a.version===e.version||t.push(e.id)})),t}(t),n=(0,j.iv)(r,100),a=await Promise.all(n.map((e=>(async e=>{const t={resource:"optionSets",params:{fields:"id,displayName,code,attributeValues,version,valueType,options[id,displayName,attributeValues,code,style, translations]",filter:`id:in:[${e.join(",")}]`,pageSize:e.length}},r=await be(t);return r&&r.optionSets||[]})(e)))),o=await Promise.all(n.map((e=>Xe(e)))),i=(e=>e.reduce(((e,t)=>[...e,...t]),[]))(a),s=(e=>e.reduce(((e,t)=>{return r=e,t.reduce(((e,t)=>(e[t.optionSet.id]=[...e[t.optionSet.id]||[],t],e)),r);var r}),{}))(o),l=((e,t)=>e.map((e=>({id:e.id,displayName:e.displayName,version:e.version,valueType:e.valueType,translations:e.translations,attributeValues:e.attributeValues,options:e.options&&[...e.options.values()].filter((e=>e)).map((e=>({id:e.id,displayName:e.displayName,attributeValues:e.attributeValues,code:e.code,style:e.style,translations:e.translations}))),optionGroups:t[e.id]&&t[e.id].map((e=>({id:e.id,displayName:e.displayName,options:e.options&&[...e.options.values()].map((e=>e.id))})))}))))(i,s),{storageController:d,storeNames:c}=Ie();await d.setAll(c.OPTION_SETS,l)}const Ze=async()=>{const{optionSetsOutline:e,trackedEntityAttributeIds:t,dataElementIds:r,categories:n,trackedEntityTypeIds:a,changesDetected:o,stalePrograms:i}=await Ge();o&&await Promise.all([Ce,Oe,Ne,we].map((e=>e())));const{trackedEntityAttributeIds:s,optionSetsOutline:l}=await(async e=>{const t=(0,j.iv)(e,150),r=(await Promise.all(t.map($e))).flat(1);return We(r)})(a);await He([...t,...s]),await Ye(r),await Ke(n),await Je([...e,...l]),await(async e=>{const{storageController:t,storeNames:r}=Ie();await Promise.all(e.map((async e=>{let{id:n,version:a}=e;const o={...await t.get(r.PROGRAMS,n),version:a};await t.set(r.PROGRAMS,o)})))})(i)},et="accessHistory",tt={LOCAL_STORAGE:1,INDEXED_DB:5},rt={DESTROY_FAILED:"Could not delete user storage"};async function nt(){const e=ye(),t=await async function(e){const{name:t}=ve(),r=await e.get(H.USER_CACHES,et),n=r&&r.values;let a;a=n?n.filter((e=>e!==t)):[];const o=[t,...a];return await e.set(H.USER_CACHES,{id:et,values:o}),o}(e);await async function(e,t){const r=t.adapterType,n=r===re?tt.LOCAL_STORAGE:tt.INDEXED_DB;if(e.length>n){const a=e.slice(n),o=e.slice(0,n);await a.asyncForEach((async e=>{const t=new le(e,1,{Adapters:[r]});try{await t.destroy()}catch(n){S().warn((0,X.p)(rt.DESTROY_FAILED)({cache:e,error:n}))}})),await t.set(H.USER_CACHES,{id:et,values:o})}}(t,e)}const at=async e=>{await nt(),await(async(e,t)=>{let{onQueryApi:r,storageController:n,storeNames:a}=e;fe={onQueryApi:r,storageController:n,storeNames:a},await t(),fe=null})({onQueryApi:e,storageController:ve(),storeNames:z},Ze)};function ot(e){const t=["ar","fa","ur"],r=t.map((e=>`${e}-`));return t.includes(e)||r.filter((t=>e.startsWith(t))).length>0}var it=r(661);function st(e){return e.toLowerCase().replace(/_(.)/g,((e,t)=>t.toUpperCase()))}const lt=e=>({momentDate:e,isValid:!!e&&e.isValid()});function dt(e,t,r){const n=t.match(r),a=n&&n[0],o=e.replace(r,a),i=t.replace(r,a),s=$()(o,i,!0);if(s.isValid())return lt(s);const l=function(e,t,r){const n=e.split(r),a=t.split(r);if(n.length===a.length){const t=a.map(((e,t)=>{let r="";const a=n[t];if(e&&a){const t=e.charAt(0);"M"===t?1===a.length?r="M":2===a.length&&(r="MM"):"D"===t?1===a.length?r="D":2===a.length&&(r="DD"):"Y"===t&&(2===a.length?r="YY":4===a.length&&(r="YYYY"))}return r||e})).join(r),o=$()(e,t,!0);return lt(o)}return lt(null)}(o,i,a);return l}function ct(e,t){const r=/[.,\-_/\\]/g;return r.test(e)&&r.test(t)?dt(e,t,r):function(e,t,r){const n=e.replace(r,""),a=t.replace(r,""),o=$()(n,a,!0);return o.isValid()?lt(o):lt(null)}(e,t,r)}function ut(e){e=(e=(e=e.replace(/[ ]/g,"")).replace(",",".")).replace(/^[+]$/,"");return Number(e)}function pt(e){const t=$()(e,["HH:mm","H:mm","HH.mm","H.mm"],!0);return{isValid:t.isValid(),momentTime:t}}const mt={[it.CO.NUMBER]:ut,[it.CO.INTEGER]:ut,[it.CO.INTEGER_POSITIVE]:ut,[it.CO.INTEGER_ZERO_OR_POSITIVE]:ut,[it.CO.INTEGER_NEGATIVE]:ut,[it.CO.PERCENTAGE]:ut,[it.CO.DATE]:e=>$()(e,"YYYY-MM-DD").toISOString(),[it.CO.DATETIME]:e=>$()(e,"YYYY-MM-DD HH:mm").toISOString(),[it.CO.TIME]:function(e){const t=pt(e);return t.isValid?t.momentTime:null},[it.CO.TRUE_ONLY]:e=>"true"===e||null,[it.CO.BOOLEAN]:e=>"true"===e};function gt(e,t){return null==e?null:mt[t]?mt[t](e):e}const ht={[it.CO.NUMBER]:ut,[it.CO.INTEGER]:ut,[it.CO.INTEGER_POSITIVE]:ut,[it.CO.INTEGER_ZERO_OR_POSITIVE]:ut,[it.CO.INTEGER_NEGATIVE]:ut,[it.CO.PERCENTAGE]:ut,[it.CO.DATE]:e=>$()(e,"YYYY-MM-DD").toISOString(),[it.CO.DATETIME]:e=>$()(e).toISOString(),[it.CO.TRUE_ONLY]:e=>"true"===e||null,[it.CO.BOOLEAN]:e=>"true"===e,[it.CO.COORDINATE]:e=>{const t="string"===typeof e?JSON.parse(e):e;return{latitude:t[1],longitude:t[0]}},[it.CO.POLYGON]:e=>e,[it.CO.ASSIGNEE]:e=>e&&e.uid?{id:e.uid,name:e.displayName||`${e.firstName} ${e.surname}`,username:e.username,firstName:e.firstName,surname:e.surname}:null};function Et(e,t){return null==e?null:ht[t]?ht[t](e):e}const yt=e=>{const{color:t,icon:r}=e||{};if(t||r)return new it.In((e=>{e.color=t||void 0,e.name=r||void 0}))};var vt=r(69983);function ft(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class It{static getRenderType(e){return e&&st(e)}constructor(e,t){this.cachedOptionSets=e,this.locale=t}_getTranslation(e,t){if(this.locale){const r=e.find((e=>e.property===t&&e.locale===this.locale));return r&&r.value}return null}async build(e,t,r,n,a){const o=this.cachedOptionSets.get(t);if(!o)return S().warn((0,j.px)(It.OPTION_SET_NOT_FOUND)({id:t})),null;e.type=a(e.type||o.valueType);const i=o.options.map((async e=>{const t=yt(e.style);return new it.c$((r=>{r.id=e.id,r.value=e.code,r.code=e.code,r.attributeValues=e.attributeValues,r.text=this._getTranslation(e.translations,It.translationPropertyNames.NAME)||e.displayName,r.icon=t}))})),s=await Promise.all(i),l=o.optionGroups&&new Map(o.optionGroups.map((e=>[e.id,new vt.z((t=>{t.id=e.id,t.optionIds=new Map(e.options.map((e=>[e,e])))}))]))),d=new it.G2(o.id,s,l,e,gt,o.attributeValues);return d.inputType=It.getRenderType(n)||(r?it.P$.VERTICAL_RADIOBUTTONS:null),d}}ft(It,"OPTION_SET_NOT_FOUND","Optionset not found"),ft(It,"translationPropertyNames",{NAME:"NAME",DESCRIPTION:"DESCRIPTION",SHORT_NAME:"SHORT_NAME"});const bt="NAME",St="DESCRIPTION",Tt="SHORT_NAME",At={[it.CO.NUMBER]:it.CO.NUMBER_RANGE,[it.CO.INTEGER]:it.CO.INTEGER_RANGE,[it.CO.INTEGER_POSITIVE]:it.CO.INTEGER_POSITIVE_RANGE,[it.CO.INTEGER_ZERO_OR_POSITIVE]:it.CO.INTEGER_ZERO_OR_POSITIVE_RANGE,[it.CO.INTEGER_NEGATIVE]:it.CO.INTEGER_NEGATIVE_RANGE,[it.CO.DATE]:it.CO.DATE_RANGE,[it.CO.DATETIME]:it.CO.DATETIME_RANGE,[it.CO.TIME]:it.CO.TIME_RANGE,[it.CO.MULTI_TEXT]:it.CO.TEXT};class Ct{static _getSearchAttributeValueType(e,t){const r=At[e];return!t&&r?r:e}constructor(e){let{cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:n}=e;this.cachedTrackedEntityAttributes=t,this.locale=n,this.optionSetFactory=new It(r,n)}_getAttributeTranslation(e,t){if(this.locale){const r=e.find((e=>e.property===t&&e.locale===this.locale));return r&&r.value}return null}async _buildElement(e){const t=new it.fq((t=>{const{id:r,translations:n,displayName:a,displayShortName:o,description:i,unique:s,valueType:l}=e.trackedEntityAttribute;t.id=r,t.name=this._getAttributeTranslation(n,bt)||a,t.shortName=this._getAttributeTranslation(n,Tt)||o,t.formName=this._getAttributeTranslation(n,bt)||a,t.description=this._getAttributeTranslation(n,St)||i,t.displayInForms=!0,t.displayInReports=e.displayInList,t.disabled=!1,t.type=Ct._getSearchAttributeValueType(l,s)})),{optionSetValue:r,optionSet:n}=e.trackedEntityAttribute;return r&&n.id&&(t.optionSet=await this.optionSetFactory.build(t,n.id,e.renderOptionsAsRadio,null,(e=>e))),t}async _buildSection(e){const t=new it.wn((e=>{e.id=it.wn.MAIN_SECTION_ID,e.showContainer=!1}));return await e.asyncForEach((async e=>{const r=await this._buildElement(e);r&&t.addElement(r)})),t}async _buildRenderFoundation(e){const t=new it.k3;return t.addSection(await this._buildSection(e)),t}async _buildSearchGroup(e,t,r){const n=new it.UZ;return n.searchForm=await this._buildRenderFoundation(t),"main"===e?(n.minAttributesRequiredToSearch=r,n.id="main"):(n.unique=!0,n.id="unique"),n}getTrackedEntityAttribute(e){const t=e.trackedEntityAttributeId,r=t?this.cachedTrackedEntityAttributes.get(t):null;return r||S().error((0,j.px)("Tried to create a searchAttribute where trackedEntityAttributeId was not specified or the trackedEntityAttribute could not be retrieved from the cache")({attribute:e})),r}build(e,t){const r=e.map((e=>({...e,trackedEntityAttribute:this.getTrackedEntityAttribute(e)}))).filter((e=>e.trackedEntityAttribute&&(e.searchable||e.trackedEntityAttribute.unique))).reduce(((e,t)=>(t.trackedEntityAttribute.unique?e[t.trackedEntityAttribute.id]=[t]:e.main=e.main?[...e.main,t]:[t],e)),{}),n=Object.keys(r).map((e=>this._buildSearchGroup(e,r[e],t)));return Promise.all(n).then((e=>e.sort(((e,t)=>{let{unique:r}=e,{unique:n}=t;return r===n?0:r?-1:1}))))}}function Ot(e){return e.charAt(0).toLocaleUpperCase()+e.slice(1)}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Ct,"errorMessages",{TRACKED_ENTITY_ATTRIBUTE_NOT_FOUND:"Tracked entity attribute not found"});var Nt=r(52417);function Rt(e){return ct(e,Nt.sI.get().dateFormat)}function wt(e){const t=Nt.sI.get().dateFormat;return $()(e).format(t)}function _t(e){const t=Nt.sI.get().dateFormat;return e.format(t)}function Pt(e){if(!e||!e.length)return"";const t=Nt.sI.get().dateFormat;return $()(e,t).format(t)}function kt(e){return e.toString()}function Dt(e){const t=$()(e);return{date:_t(t),time:t.format("HH:mm")}}function Ut(e){return $()(e,"HH:mm",!0).format("HH:mm")}function Lt(e,t){return e(t.from)}const Ft={[it.CO.NUMBER]:kt,[it.CO.INTEGER]:kt,[it.CO.INTEGER_POSITIVE]:kt,[it.CO.INTEGER_ZERO_OR_POSITIVE]:kt,[it.CO.INTEGER_NEGATIVE]:kt,[it.CO.PERCENTAGE]:kt,[it.CO.DATE]:function(e){return _t($()(e))},[it.CO.DATETIME]:Dt,[it.CO.TIME]:Ut,[it.CO.TRUE_ONLY]:()=>"true",[it.CO.BOOLEAN]:e=>e?"true":"false",[it.CO.AGE]:function(e){const t=$()(),r=$()(e),n=t.diff(r,"years");r.add(n,"years");const a=t.diff(r,"months");r.add(a,"months");const o=t.diff(r,"days");return{date:_t($()(e)),years:n.toString(),months:a.toString(),days:o.toString()}},[it.CO.NUMBER_RANGE]:function(e){return e.to},[it.CO.DATE_RANGE]:function(e){return e.to},[it.CO.INTEGER_RANGE]:e=>Lt(kt,e),[it.CO.INTEGER_POSITIVE_RANGE]:e=>Lt(kt,e),[it.CO.INTEGER_ZERO_OR_POSITIVE_RANGE]:e=>Lt(kt,e),[it.CO.INTEGER_NEGATIVE_RANGE]:e=>Lt(kt,e),[it.CO.TIME_RANGE]:e=>Lt(Ut,e),[it.CO.DATETIME_RANGE]:e=>Lt(Dt,e)};function xt(e,t){return(e||0===e||!1===e)&&Ft[t]?Ft[t](e):e}var Mt=r(97475);function Vt(e){return Boolean(e)||0===e||!1===e}function jt(e,t){return ct(e,t).isValid}function Gt(e){return pt(e).isValid}const Bt=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,$t=e=>{if(isNaN(e))return!1;const t=Number(e);return Number.isSafeInteger(t)},Wt=e=>{if(isNaN(e))return!1;const t=Number(e);return Number.isSafeInteger(t)&&t>0},Ht=e=>{if(isNaN(e))return!1;const t=Number(e);return Number.isSafeInteger(t)&&t<0},zt=e=>"0"===e||Wt(e),Yt=e=>!(isNaN(e)||Number(e)===1/0),qt={date:"Please provide a valid date",years:"Please provide a valid positive integer",months:"Please provide a valid positive integer",days:"Please provide a valid positive integer"};function Kt(e){return!e||zt(e)}function Qt(e,t){if(function(e){return!e.date&&!e.years&&!e.months&&!e.days}(e))return!1;const r=function(e,t,r){const n=[];return Kt(e)||n.push({years:qt.years}),Kt(t)||n.push({months:qt.months}),Kt(r)||n.push({days:qt.days}),n.length>0?{valid:!1,errorMessage:n.reduce(((e,t)=>({...e,...t})),{})}:{valid:!0}}(e.years,e.months,e.days);return r.valid?function(e,t){return!e||jt(e,t)?{valid:!0}:{valid:!1,errorMessage:{date:qt.date}}}(e.date,t):r}const Xt=e=>!!(e&&e.id&&e.name);function Jt(e){return"number"===typeof e||"string"===typeof e&&null===e.match(/[^0-9.,-]+/)}var Zt=r(47312),er=r.n(Zt),tr=r(97093),rr={input:"textInput_input__UP93k",textArea:"textInput_textArea__Yedgy"};function nr(){return nr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nr.apply(this,arguments)}const ar=e=>{const{multiLine:t,classes:r,inputRef:n,style:a,...o}=e;return y.createElement(y.Fragment,null,t?y.createElement("textarea",nr({"data-test":"capture-ui-textarea",ref:n,className:er()(rr.textArea,r.input)},o)):y.createElement("input",nr({"data-test":"capture-ui-input",ref:n,className:er()(rr.input,r.input)},o)))};ar.defaultProps={classes:{}};var or="shrinkLabel_label__R9NS+",ir="shrinkLabel_labelUnshrinked__Ln42Y",sr="shrinkLabel_labelShrinked__Lrjus";function lr(e){const{children:t,shrink:r}=e,n=er()(or,r?sr:ir);return y.createElement("div",{className:n},t)}var dr="withShrinkLabel_container__18CCo";function cr(){return cr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cr.apply(this,arguments)}function ur(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const pr=()=>e=>class extends y.Component{constructor(){super(...arguments),ur(this,"renderDisabled",(t=>y.createElement(e,cr({placeholder:this.props.label},t))))}render(){const{shrinkDisabled:t,...r}=this.props,n=!!this.props.inFocus||!!this.props.value;return t?this.renderDisabled(r):y.createElement("div",{className:dr},y.createElement(lr,{shrink:n},this.props.label),y.createElement(e,r))}};function mr(){return mr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mr.apply(this,arguments)}function gr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const hr=()=>e=>class extends y.Component{constructor(e){super(e),gr(this,"setFocus",(()=>{this.setState({inFocus:!0}),this.props.onSetFocus&&this.props.onSetFocus()})),gr(this,"removeFocus",(()=>{this.setState({inFocus:!1}),this.props.onRemoveFocus&&this.props.onRemoveFocus()})),this.state={inFocus:!1}}render(){const{inFocus:t}=this.state,{inFocus:r,onSetFocus:n,onRemoveFocus:a,...o}=this.props;return y.createElement(e,mr({inFocus:t,onSetFocus:this.setFocus,onRemoveFocus:this.removeFocus},o))}};function Er(){return Er=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Er.apply(this,arguments)}function yr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const vr=()=>e=>class extends y.Component{constructor(){super(...arguments),yr(this,"handleBlur",(e=>{this.props.onRemoveFocus(),this.props.onBlur&&this.props.onBlur(e)})),yr(this,"handleFocus",(()=>{this.props.onSetFocus(),this.props.onFocus&&this.props.onFocus()}))}render(){const{onSetFocus:t,onRemoveFocus:r,onFocus:n,inFocus:a,onBlur:o,classes:i,...s}=this.props,{inputWrapperFocused:l,inputWrapperUnfocused:d,...c}=i,u=a?l:d;return y.createElement("div",{className:er()(rr.inputWrapper,u)},y.createElement(e,Er({onFocus:this.handleFocus,onBlur:this.handleBlur},s,{classes:c})))}};function fr(){return fr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fr.apply(this,arguments)}function Ir(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class br extends y.Component{constructor(){super(...arguments),Ir(this,"handleBlur",(e=>{this.props.onBlur(e.currentTarget.value)})),Ir(this,"handleChange",(e=>{this.props.onChange&&this.props.onChange(e.currentTarget.value)})),Ir(this,"handleFocus",(()=>{}))}render(){const{onBlur:e,onChange:t,value:r,classes:n,...a}=this.props;return y.createElement(ar,fr({classes:{},onBlur:this.handleBlur,onChange:this.handleChange,onFocus:this.handleFocus,value:r||""},a))}}const Sr=hr()(pr()(vr()(br))),Tr="right",Ar="center",Cr="up",Or="inline";var Nr={containerAbsolute:"datePopup_containerAbsolute__em6G1",calendarAbsolute:"datePopup_calendarAbsolute__sWMj8"};function Rr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class wr extends y.Component{constructor(){super(...arguments),Rr(this,"getRightCalendarStyle",(e=>e===Or?{marginLeft:`-${this.calculateMarginLeftInline()}px`}:{...this.getAbsoluteVerticalPosition(),right:0})),Rr(this,"getLeftCalendarStyle",(e=>e===Or?{}:{...this.getAbsoluteVerticalPosition(),left:0})),Rr(this,"getCenterCalendarStyle",(e=>e===Or?{marginLeft:`-${this.calculateMarginLeftInline()/2}px`}:{...this.getAbsoluteVerticalPosition(),left:"50%",transform:"translate(-50%, 0)"}))}getAbsoluteBottom(){return this.props.inputUsesFloatingLabel?60:40}getAbsoluteVerticalPosition(){return this.props.absoluteDirection===Cr?{bottom:this.getAbsoluteBottom()}:{top:0}}calculateMarginLeftInline(){const{inputWidth:e,calendarWidth:t}=this.props;return t-e}getPopupStyle(){const{anchorPosition:e,mode:t}=this.props;let r;return r=e===Tr?this.getRightCalendarStyle(t):e===Ar?this.getCenterCalendarStyle(t):this.getLeftCalendarStyle(t),r}render(){const{open:e,mode:t,children:r}=this.props;if(!e)return null;const n=t===Or?Nr.containerInline:Nr.containerAbsolute,a=t===Or?Nr.calendarInline:Nr.calendarAbsolute,o=this.getPopupStyle();return y.createElement("div",{className:n},y.createElement("div",{className:a,style:o},r))}}var _r=r(73197);r(91143);function Pr(){return Pr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pr.apply(this,arguments)}class kr extends y.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this),this.displayOptions={...kr.displayOptions,...this.props.displayOptions}}shouldComponentUpdate(){return!1}handleChange(e){const t=this.props.onConvertValueOut(e);this.props.onDateSelected(t)}getValue(e){return this.props.onConvertValueIn(e)}getMinMaxProps(){const{minMoment:e=$()("1900-01-01"),maxMoment:t=$()("2099-12-31")}=this.props,r=e.toDate(),n=t.toDate();return{min:r,minDate:r,max:n,maxDate:n}}render(){const{value:e,classes:t,currentWidth:r,height:n,minMoment:a,maxMoment:o,onDateSelected:i,displayOptions:s,...l}=this.props;return y.createElement("div",null,y.createElement(_r.Ay,Pr({},this.getMinMaxProps(),{selected:this.getValue(e),onSelect:this.handleChange,width:r,height:n,autoFocus:!1,displayOptions:this.displayOptions},l)))}}function Dr(){return Dr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dr.apply(this,arguments)}function Ur(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(kr,"displayOptions",{showHeader:!0,showMonthsForYears:!1});class Lr extends y.Component{constructor(){super(...arguments),Ur(this,"handleBlur",(e=>{this.props.onBlur(e)})),Ur(this,"handleChange",(e=>{this.props.onChange&&this.props.onChange(e.currentTarget.value)}))}render(){const{onBlur:e,onChange:t,value:r,...n}=this.props;return y.createElement(ar,Dr({value:r||"",onBlur:this.handleBlur,onChange:this.handleChange},n))}}const Fr=vr()(Lr);function xr(){return xr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xr.apply(this,arguments)}class Mr extends y.Component{static splitPassOnProps(e){const t={input:{},popup:{},calendar:{}};return e?Object.keys(e).reduce(((t,r)=>{let n;n=r.startsWith(Mr.propContainers.CALENDAR)?Mr.propContainers.CALENDAR:r.startsWith(Mr.propContainers.POPUP)?Mr.propContainers.POPUP:Mr.propContainers.INPUT;const a=(o=r.replace(n,"")).charAt(0).toLocaleLowerCase()+o.slice(1);var o;return t[n][a]=e[r],t}),t):t}constructor(e){super(e),this.state={popoverOpen:!1},this.handleTextFieldFocus=this.handleTextFieldFocus.bind(this),this.handleDateSelected=this.handleDateSelected.bind(this),this.handleTextFieldBlur=this.handleTextFieldBlur.bind(this),this.hidePopover=this.hidePopover.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this),this.calendarWrapperDOMElementRef=(0,y.createRef)()}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick)}handleTextFieldFocus(){document.removeEventListener("click",this.handleDocumentClick),this.setState({popoverOpen:!0}),this.props.onFocus&&this.props.onFocus()}handleDateSelected(e){this.props.onBlur(e),this.hidePopover(),this.props.onDateSelectedFromCalendar&&this.props.onDateSelectedFromCalendar(),document.removeEventListener("click",this.handleDocumentClick)}handleDocumentClick(e){let{target:t}=e;const r=this.calendarWrapperDOMElementRef.current;if(!r)throw Error("calendar wrapper DOM element not found");t===r||t instanceof Node&&r.contains(t)||(this.hidePopover(),document.removeEventListener("click",this.handleDocumentClick))}handleTextFieldBlur(e){let{relatedTarget:t,currentTarget:r}=e;const n=this.calendarWrapperDOMElementRef.current;if(!n)throw Error("calendar wrapper DOM element not found");t===n||t instanceof Node&&n.contains(t)?document.addEventListener("click",this.handleDocumentClick):(this.props.onBlur(r.value),this.hidePopover())}hidePopover(){this.setState({popoverOpen:!1})}render(){const{width:e,maxWidth:t,calendarWidth:r,calendarHeight:n,inputWidth:a,onBlur:o,onFocus:i,onDateSelectedFromCalendar:s,...l}=this.props,{popoverOpen:d}=this.state,c=a||e,u=r||e,p=Mr.splitPassOnProps(l),m=n||350;return y.createElement("div",{ref:e=>{this.containerInstance=e},style:{width:e,maxWidth:t}},y.createElement(Fr,xr({onFocus:this.handleTextFieldFocus,onBlur:this.handleTextFieldBlur,width:c},p.input)),y.createElement("div",{"data-test":"date-calendar-wrapper",ref:this.calendarWrapperDOMElementRef},y.createElement(wr,xr({open:d,onClose:this.hidePopover,width:u,height:m,inputWidth:c,inputUsesFloatingLabel:!!p.input.label},p.popup),y.createElement(kr,xr({onDateSelected:this.handleDateSelected,value:this.props.value,currentWidth:u,height:m},p.calendar)))))}}function Vr(){return Vr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Vr.apply(this,arguments)}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Mr,"propContainers",{CALENDAR:"calendar",POPUP:"popup",INPUT:"input"});class jr extends y.Component{render(){const{value:e,orientation:t,...r}=this.props;return y.createElement(Mr,Vr({value:e||"",calendarMaxMoment:$()(),width:150,calendarWidth:350},r))}}const Gr=hr()(jr);var Br="ageField_containerVertical__S-4sF",$r="ageField_containerHorizontal__uA8hn",Wr="ageField_ageNumberInputContainer__jPrX9",Hr="ageField_ageDateInputContainerHorizontal__VXHA4",zr="ageField_ageClearHorizontal__hC-cK";const Yr="horizontal",qr="vertical";function Kr(){return Kr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Kr.apply(this,arguments)}const Qr=()=>e=>class extends y.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this);const t=this.props.value;this.state={value:t}}UNSAFE_componentWillReceiveProps(e){e.value!==this.props.value&&this.setState({value:e.value})}handleChange(e){this.setState({value:e})}render(){const{onChange:t,value:r,...n}=this.props,a=this.state.value;return y.createElement(e,Kr({onChange:this.handleChange,value:a},n))}};function Xr(){return Xr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xr.apply(this,arguments)}function Jr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zr(e,t,r,n){const a=e&&t(e);if(!a||!a.isValid)return{date:e,years:"",months:"",days:""};const o=n(),i=n(a.momentDate),s=o.diff(i,"years");i.add(s,"years");const l=o.diff(i,"months");i.add(l,"months");const d=o.diff(i,"days");return{date:r(a.momentDate),years:s.toString(),months:l.toString(),days:d.toString()}}const en={error:"innerInputError",info:"innerInputInfo",warning:"innerInputWarning",validating:"innerInputValidating"};class tn extends y.Component{constructor(){super(...arguments),Jr(this,"onClear",(()=>{this.props.onBlur(null)})),Jr(this,"handleNumberBlur",(e=>{const{onParseDate:t,onGetFormattedDateStringFromMoment:r,onRemoveFocus:n,moment:a}=this.props;if(n&&n(),tn.isEmptyNumbers(e))return void this.props.onBlur(e.date?{date:e.date}:null);if(!tn.isValidNumbers(e))return void this.props.onBlur({...e,date:""});const o=a(void 0,void 0,!0);o.subtract(tn.getNumberOrZero(e.years),"years"),o.subtract(tn.getNumberOrZero(e.months),"months"),o.subtract(tn.getNumberOrZero(e.days),"days");const i=Zr(r(o),t,r,a);this.props.onBlur(i)})),Jr(this,"handleDateBlur",(e=>{const{onParseDate:t,onGetFormattedDateStringFromMoment:r,onRemoveFocus:n,moment:a}=this.props;n&&n();const o=e?Zr(e,t,r,a):null;this.props.onBlur(o)})),Jr(this,"renderMessage",(e=>{const{classes:t,innerMessage:r}=this.props;if(r){const n=r.message&&r.message[e],a=t&&t[en[r.messageType]]||"";return n&&y.createElement("div",{className:a},n)}return null})),Jr(this,"renderNumberInput",((e,t,r)=>{const{innerMessage:a,onChange:o,inFocus:i,value:s,onBlur:l,dateCalendarOnConvertValueIn:d,dateCalendarOnConvertValueOut:c,dateCalendarWidth:u,datePopupAnchorPosition:p,dateCalendarTheme:m,dateCalendarLocale:g,moment:h,onParseDate:E,...v}=this.props;return y.createElement("div",{className:Wr},y.createElement(Sr,Xr({label:n.A.t(r),value:e[t],onBlur:r=>this.handleNumberBlur({...e,[t]:r}),onChange:r=>o({...e,[t]:r})},v)),a&&this.renderMessage(t))})),Jr(this,"renderDateInput",((e,t)=>{const{onChange:r,innerMessage:n,inFocus:a,value:o,onBlur:i,shrinkDisabled:s,dateCalendarOnConvertValueIn:l,dateCalendarOnConvertValueOut:d,dateCalendarWidth:c,datePopupAnchorPosition:u,dateCalendarTheme:p,dateCalendarLocale:m,datePlaceholder:g,moment:h,onParseDate:E,...v}=this.props,f=er()({[Hr]:!t});return y.createElement("div",{className:f},y.createElement(Gr,Xr({onBlur:this.handleDateBlur,value:e.date,onChange:t=>r({...e,date:t}),calendarWidth:c,popupAnchorPosition:u,calendarTheme:p,calendarLocale:m,calendarOnConvertValueIn:l,calendarOnConvertValueOut:d,placeholder:g},v)),n&&this.renderMessage("date"))}))}static isEmptyNumbers(e){return!e.years&&!e.months&&!e.days}static isPositiveOrZeroNumber(e){return Wt(e)||0===Number(e)}static isValidNumbers(e){return tn.isPositiveOrZeroNumber(e.years||"0")&&tn.isPositiveOrZeroNumber(e.months||"0")&&tn.isPositiveOrZeroNumber(e.days||"0")}static getNumberOrZero(e){return e||0}render(){const{value:e,orientation:t,disabled:r}=this.props,n=e||{},a=t===qr,o=a?Br:$r,i=a?null:zr;return y.createElement("div",{className:o},this.renderDateInput(n,a),this.renderNumberInput(n,"years","Years"),this.renderNumberInput(n,"months","Months"),this.renderNumberInput(n,"days","Days"),y.createElement("div",{className:i},y.createElement(Bo,{disabled:!!r,onClick:this.onClear},y.createElement(tr.A,null))))}}const rn=Qr()(tn);class nn extends y.Component{render(){return y.createElement("div",null,"Multi")}}var an="svgIcon_icon__OU7Uy";function on(){return on=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},on.apply(this,arguments)}const sn=e=>{const{className:t,...r}=e;return y.createElement("svg",on({className:er()(an,e.className)},r))},ln=e=>y.createElement(sn,e,y.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),y.createElement("path",{d:"M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7zm4 8h-3v3h-2v-3H8V8h3V5h2v3h3v2z"})),dn=e=>y.createElement(sn,e,y.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),cn=e=>y.createElement(sn,e,y.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})),un=e=>y.createElement(sn,e,y.createElement("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),pn=e=>y.createElement(sn,e,y.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}));function mn(){return mn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mn.apply(this,arguments)}const gn=e=>y.createElement(sn,mn({},e,{viewBox:"0 0 32 32",fill:"none"}),y.createElement("g",{clipPath:"url(#clip0_402_6066)"},y.createElement("path",{d:"M24 16V26.7515L16.9038 23.1621L16 22.7051L15.0991 23.1611L8 26.748V4H18V2H8C7.46957 2 6.96086 2.21071 6.58579 2.58579C6.21071 2.96086 6 3.46957 6 4V30L16 24.9463L26 30V16H24Z",fill:"#A0ADBA"}),y.createElement("path",{d:"M26 6V2H24V6H20V8H24V12H26V8H30V6H26Z",fill:"#42A5F5"})),y.createElement("defs",null,y.createElement("clipPath",{id:"clip0_402_6066"},y.createElement("rect",{width:"32",height:"32",fill:"white"}))));function hn(e){let{className:t}=e;return y.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",className:t,style:{fill:"inherit",height:"12px",width:"12px",verticalAlign:"middle",pointerEvents:"none"}},y.createElement("path",{d:"m5.29289 8.7071c.39053.3905 1.02369.3905 1.41422 0l2.99999-2.99999c.3905-.39053.3905-1.02369 0-1.41422-.3905-.39052-1.0237-.39052-1.4142 0l-2.2929 2.2929-2.29289-2.2929c-.39053-.39052-1.02369-.39052-1.41422 0-.39052.39053-.39052 1.02369 0 1.41422z"}))}function En(e){let{className:t}=e;return y.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",className:t,style:{fill:"inherit",height:"12px",width:"12px",verticalAlign:"middle",pointerEvents:"none"}},y.createElement("path",{d:"m5.29289 8.7071c.39053.3905 1.02369.3905 1.41422 0l2.99999-2.99999c.3905-.39053.3905-1.02369 0-1.41422-.3905-.39052-1.0237-.39052-1.4142 0l-2.2929 2.2929-2.29289-2.2929c-.39053-.39052-1.02369-.39052-1.41422 0-.39052.39053-.39052 1.02369 0 1.41422z",transform:"matrix(1 0 0 -1 0 12.999974)"}))}var yn=r(89223),vn=r(3004),fn=r(7187);const In={toggleButton:{margin:`0 0 0 ${yn.U.dp4}px`,height:"24px",borderRadius:"3px",color:vn.T.grey600,"&:hover":{background:vn.T.grey200,color:vn.T.grey800},"&.open":{animation:"flipOpen 200ms normal forwards linear"},"&.close":{animation:"flipClose 200ms normal forwards linear"},"&.closeinit":{transform:"rotateX(180deg)"},"&.disabled":{color:vn.T.grey400,cursor:"not-allowed"}},"@keyframes flipOpen":{from:{transform:"rotateX(180deg)"},to:{transform:"rotateX(0)"}},"@keyframes flipClose":{from:{transform:"rotateX(0)"},to:{transform:"rotateX(180deg)"}}},bn=(0,I.withStyles)(In)((e=>{let{open:t,onOpen:r,onClose:n,dataTest:a,disabled:o,classes:i}=e;const[s,l]=(0,y.useState)(t),[d,c]=(0,y.useState)(!1);return(0,y.useEffect)((()=>{d||c(!0),l(t)}),[t,d]),y.createElement(Bo,{dataTest:a,className:er()(i.toggleButton,{closeinit:!d&&!s,open:d&&s,close:d&&!s,disabled:o}),onClick:()=>o?null:t?n():r(),disabled:o},y.createElement(fn.A,null))}));var Sn="singleSelectBox_input__wRavl",Tn="singleSelectBox_iconContainer__1TCSH",An="singleSelectBox_iconFocusContainer__1C8UW",Cn="singleSelectBox_label__SfOG0",On="singleSelectBox_name__QGQH8",Nn="singleSelectBox_inFocus__do7tq",Rn="singleSelectBox_labelDisabled__hM2nq";function wn(){return wn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wn.apply(this,arguments)}function _n(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Pn={TAB:"Tab",SPACE:" ",ENTER:"Enter",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown"};let kn=!1;class Dn extends y.Component{constructor(){super(...arguments),_n(this,"handleSelect",(()=>{const{onSelect:e,optionData:t,isSelected:r}=this.props;kn?kn=!1:e(r?null:t.value)})),_n(this,"handleKeyDown",(e=>{const{keyboardManager:t}=this.props;if(!t.managedKeys.includes(e.key))return;if(t.keyDown(e.key))if(e.key===Pn.TAB)t.clear(),kn=!1;else if([Pn.SPACE,Pn.ENTER].includes(e.key)){const{onSelect:t,optionData:r,isSelected:n}=this.props;t(n?null:r.value),e.key===Pn.SPACE&&(kn=!0)}else kn=!0;else e.preventDefault()})),_n(this,"handleKeyUp",(e=>{this.props.keyboardManager.keyUp(e.key)})),_n(this,"handleBlur",(e=>{const{isSelected:t,optionData:r}=this.props;this.props.onBlur(e,t?r.value:null)}))}render(){const{optionData:e,isSelected:t,groupId:r,children:n,inFocus:a,inputRef:o,focusClass:i,unFocusClass:s,onSelect:l,onBlur:d,disabled:c,...u}=this.props,p=r+(e.id||e.name);return y.createElement("div",null,y.createElement("label",{htmlFor:p,className:er()(Cn,{[Rn]:c})},y.createElement("input",wn({ref:o,type:"radio",className:Sn,name:r,id:p,checked:t,value:e.value,onClick:this.handleSelect,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onChange:()=>{},disabled:c},u)),y.createElement("div",{className:An},y.createElement("div",{className:a?er()(Nn,i):er()(s)}),y.createElement("div",{className:Tn},n)),y.createElement("span",{className:On},e.name)))}}function Un(){return Un=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Un.apply(this,arguments)}function Ln(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Fn="singleSelectionBoxes_containerHorizontal__I4ziO",xn="singleSelectionBoxes_containerVertical__EiwEq",Mn="singleSelectionBoxes_optionContainerHorizontal__huf56",Vn="singleSelectionBoxes_optionContainerVertical__u2vT-";function jn(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Gn=(Bn=Dn,class extends y.Component{constructor(e){super(e),Ln(this,"handleInputMouseDown",(()=>{this.isMouseClick=!0})),Ln(this,"handleInputFocus",(()=>{this.props.onSetFocus&&this.props.onSetFocus(),this.isMouseClick?this.isMouseClick=!1:this.setState({inFocus:!0})})),Ln(this,"handleInputBlur",(()=>{this.props.onRemoveFocus&&this.props.onRemoveFocus(),this.state.inFocus&&this.setState({inFocus:!1}),this.isMouseClick=!1})),Ln(this,"setInputInstance",(e=>{this.inputInstance=e,this.props.setInputRef(e)})),this.state={inFocus:!1,isMouseClick:!1}}componentDidMount(){this.inputInstance.addEventListener("mousedown",this.handleInputMouseDown),this.inputInstance.addEventListener("focus",this.handleInputFocus),this.inputInstance.addEventListener("blur",this.handleInputBlur)}componentWillUnmount(){this.inputInstance.removeEventListener("mousedown",this.handleInputMouseDown),this.inputInstance.removeEventListener("focus",this.handleInputFocus),this.inputInstance.removeEventListener("blur",this.handleInputBlur)}render(){const{setInputRef:e,onSetFocus:t,onRemoveFocus:r,inFocus:n,...a}=this.props;return y.createElement(Bn,Un({inputRef:this.setInputInstance,inFocus:this.state.inFocus},a))}});var Bn;class $n extends y.Component{static getFocusClass(e,t){return t?e.focusSelected:e.focusUnselected}constructor(e){super(e),jn(this,"onBlur",(e=>{if(!this.state.refList.includes(e.relatedTarget)){this.props.keyboardManager.clear();const e=this.state.refList.find((e=>e.checked));this.props.onSelect(e?e.value:null)}})),jn(this,"getCheckedClass",((e,t,r)=>er()(e,t&&{[t]:r}))),jn(this,"getUncheckedClass",((e,t,r)=>er()(e,t&&{[t]:r}))),this.state={refList:[]}}getCheckedIcon(){const{classes:e,disabled:t}=this.props,{iconDisabled:r,iconSelected:n}=e||{};return y.createElement(un,{className:this.getCheckedClass(n,r,t)})}getUncheckedIcon(){const{classes:e,disabled:t}=this.props,{iconDisabled:r,iconDeselected:n}=e||{};return y.createElement(pn,{className:this.getUncheckedClass(n,r,t)})}getPostProcessedCustomIcon(e,t){const{classes:r,disabled:n}=this.props,{iconSelected:a,iconDeselected:o,iconDisabled:i}=r||{};return y.cloneElement(e,t?{className:this.getCheckedClass(a,i,n)}:{className:this.getUncheckedClass(o,i,n)},null)}getIconElement(e,t){const{children:r}=this.props,n=r?r(e,t):null;return n?this.getPostProcessedCustomIcon(n,t):t?this.getCheckedIcon():this.getUncheckedIcon()}getOption(e,t,r){const{orientation:n,id:a,value:o,onSelect:i,classes:s,onSetFocus:l,onRemoveFocus:d,keyboardManager:c,disabled:u}=this.props,p=n===Yr?Mn:Vn,m=t||0===r&&!o&&!1!==o&&0!==o?0:-1,g=this.getIconElement(e,t);return y.createElement("div",{className:p,key:e.id||e.name},y.createElement(Gn,{setInputRef:e=>{this.setState((t=>{t.refList[r]=e}))},optionData:e,isSelected:t,tabIndex:m,groupId:a,onSelect:i,onBlur:this.onBlur,focusClass:s&&$n.getFocusClass(s,t),unFocusClass:s&&s.unFocus,onSetFocus:l,onRemoveFocus:d,keyboardManager:c,disabled:u},g))}getSelectionOptions(){const{options:e,onGetOptionData:t,value:r}=this.props;return e.map(((e,n)=>{const a=t?t(e):e,o=a.value===r;return this.getOption(a,o,n)}))}render(){const{orientation:e}=this.props,t=e===Yr?Fn:xn;return y.createElement("div",{className:t},this.getSelectionOptions())}}function Wn(){return Wn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Wn.apply(this,arguments)}const Hn=["Tab"," ","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];function zn(){return zn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zn.apply(this,arguments)}const Yn=(e=>t=>{const r=(0,y.useRef)(new Set),n=(0,y.useMemo)((()=>({managedKeys:Hn,keyDown:e=>{const t=r.current.size;return r.current.add(e),0===t},keyUp:e=>{r.current.delete(e)},clear:()=>{r.current.clear()}})),[r]);return y.createElement(e,Wn({keyboardManager:n},t))})((e=>{const{multiSelect:t,...r}=e;return t?y.createElement(nn,zn({orientation:Yr},r)):y.createElement($n,zn({orientation:Yr},r))}));function qn(){return qn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qn.apply(this,arguments)}class Kn extends y.Component{static getOptions(e){return[{name:n.A.t("Yes"),value:!!e||"true"},{name:n.A.t("No"),value:!e&&"false"}]}constructor(e){super(e),this.options=Kn.getOptions(!!this.props.useRealBooleanValues)}render(){const{allowMultiple:e,useRealBooleanValues:t,...r}=this.props;return y.createElement("div",null,y.createElement(Yn,qn({options:this.options,multiSelect:e},r)))}}var Qn=r(52626),Xn=r(29367),Jn=r(11060),Zn=r(59883),ea=r(23351),ta=r(63161),ra=r(83005);function na(){return na=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},na.apply(this,arguments)}function aa(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class oa extends y.Component{constructor(){super(...arguments),aa(this,"handleBlur",(e=>{this.props.onBlur(e.currentTarget.value)})),aa(this,"handleChange",(e=>{this.props.onChange&&this.props.onChange(e.currentTarget.value)}))}render(){const{onBlur:e,onChange:t,value:r,classes:n,className:a,...o}=this.props;return y.createElement(ar,na({classes:{input:a},onBlur:this.handleBlur,onChange:this.handleChange,value:r||""},o))}}const ia=hr()(pr()(vr()(oa)));var sa={coordinateField:"coordinateField_coordinateField__1xe3n",coordinateFieldsHorizontal:"coordinateField_coordinateFieldsHorizontal__2ab+N",coordinateFieldsVertical:"coordinateField_coordinateFieldsVertical__rOqQR",mapIconContainer:"coordinateField_mapIconContainer__yxEda",mapIconContainerWithMargin:"coordinateField_mapIconContainerWithMargin__dPpta",inputContainer:"coordinateField_inputContainer__XMuhR",latitudeTextInput:"coordinateField_latitudeTextInput__FiumI",longitudeTextInput:"coordinateField_longitudeTextInput__iHcBu",dialogActionOuterContainer:"coordinateField_dialogActionOuterContainer__ZZchw",dialogActionInnerContainer:"coordinateField_dialogActionInnerContainer__qn1y8",mapContainer:"coordinateField_mapContainer__0y59a",leafletContainer:"coordinateField_leafletContainer__OO7To",dialogContent:"coordinateField_dialogContent__uUScL",buttonsContainerVertical:"coordinateField_buttonsContainerVertical__ACpWR"};function la(){return la=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},la.apply(this,arguments)}function da(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ca=(0,Qn.k0)(ea.h),ua="latitude",pa="longitude";class ma extends y.Component{constructor(e){super(e),da(this,"toSixDecimal",(e=>parseFloat(e)?parseFloat(e).toFixed(6):null)),da(this,"handleBlur",((e,t)=>{const r={...this.props.value,[e]:this.toSixDecimal(t)};r.latitude||r.longitude?this.props.onBlur(r):this.props.onBlur(null)})),da(this,"handleChange",((e,t)=>{this.props.onChange&&this.props.onChange({...this.props.value,[e]:t})})),da(this,"handleClear",(()=>{this.props.onBlur(null)})),da(this,"getPosition",(()=>{const{value:e}=this.props;let t=null;return e&&e.latitude&&e.longitude&&!isNaN(parseFloat(e.latitude))&&!isNaN(parseFloat(e.longitude))&&(t=[parseFloat(e.latitude),parseFloat(e.longitude)]),t})),da(this,"closeMap",(()=>{this.setState({showMap:!1})})),da(this,"openMap",(()=>{this.props.onOpenMap(Boolean(this.props.value)),this.setState({showMap:!0,position:this.getPosition()})})),da(this,"onMapPositionChange",(e=>{const{lat:t,lng:r}=e.latlng;this.setMapPosition([this.toSixDecimal(t),this.toSixDecimal(r)],e.target.getZoom())})),da(this,"setMapPosition",((e,t)=>{this.setState({position:e,zoom:t})})),da(this,"onSetCoordinate",(()=>{const e=this.state.position,t=e&&2===e.length?{latitude:e[0],longitude:e[1]}:null;this.props.onBlur(t),this.setState({showMap:!1})})),da(this,"renderMapIcon",(()=>{const{classes:e,shrinkDisabled:t,disabled:r}=this.props,{mapIconContainer:n,mapIcon:a,mapIconContainerDisabled:o}=e||{},i=er()({[sa.mapIconContainer]:t},{[sa.mapIconContainerWithMargin]:!t},n,{[o]:r});return y.createElement("div",{className:i},y.createElement(Bo,{disabled:!!r,dataTest:"mapIconButton",style:{height:42,width:42,borderRadius:0,padding:0},className:er()(sa.mapIcon,a),onClick:this.openMap},y.createElement(ln,null)))})),da(this,"renderMapDialog",(()=>y.cloneElement(this.props.mapDialog,{hide:!this.state.showMap,onClose:this.closeMap},[...y.Children.toArray(this.props.mapDialog.props.children),y.createElement(y.Fragment,null,y.createElement(R.$,{className:sa.dialogContent,key:"dialogContent"},this.renderMap()),this.renderDialogActions())]))),da(this,"setMapInstance",(e=>{this.mapInstance=e})),da(this,"search",(e=>{const t=this.mapInstance&&this.mapInstance.leafletElement?this.mapInstance.leafletElement.getZoom():13;this.setMapPosition([...e],t)})),da(this,"renderMap",(()=>{const{position:e,zoom:t}=this.state,r=e||this.props.center;return y.createElement("div",{className:sa.mapContainer},y.createElement(Xn.A,{center:r,zoom:t,onClick:this.onMapPositionChange,className:sa.leafletContainer,key:"map",ref:e=>{this.setMapInstance(e)}},y.createElement(ca,{position:"topleft",inputPlaceholder:"Search",closeResultsOnClick:!0,search:null,mapStateModifier:this.search,showMarker:!1}),y.createElement(Jn.A,{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),e&&y.createElement(Zn.A,{position:e})))})),da(this,"renderDialogActions",(()=>y.createElement(ta.N,{className:sa.dialogActionOuterContainer},y.createElement("div",{className:sa.dialogActionInnerContainer},y.createElement(ra.$,{kind:"basic",onClick:this.closeMap},n.A.t("Cancel"))),y.createElement("div",{className:sa.dialogActionInnerContainer},y.createElement(ra.$,{kind:"primary",onClick:this.onSetCoordinate},n.A.t("Set coordinate")))))),da(this,"renderLatitude",(()=>{const{center:e,onBlur:t,onChange:r,value:n,orientation:a,shrinkDisabled:o,classes:i,mapDialog:s,disabled:l,...d}=this.props,{mapIconContainer:c,mapIcon:u,...p}=i||{};return y.createElement(ia,la({shrinkDisabled:o,label:"Latitude",value:n&&n.latitude,classes:p,className:sa.latitudeTextInput,onBlur:e=>this.handleBlur(ua,e),onChange:e=>this.handleChange(ua,e),disabled:l},d))})),da(this,"renderLongitude",(()=>{const{center:e,onBlur:t,onChange:r,value:n,orientation:a,shrinkDisabled:o,classes:i,mapDialog:s,disabled:l,...d}=this.props,{mapIconContainer:c,mapIcon:u,...p}=i||{};return y.createElement(ia,la({shrinkDisabled:o,label:"Longitude",value:n&&n.longitude,className:sa.longitudeTextInput,classes:p,onBlur:e=>this.handleBlur(pa,e),onChange:e=>this.handleChange(pa,e),disabled:l},d))})),da(this,"renderClearButton",(()=>{const{shrinkDisabled:e,disabled:t}=this.props,r=e?sa.clearIcon:sa.clearIconWithMargin;return y.createElement("div",{className:r},y.createElement(Bo,{style:{height:42,width:42,borderRadius:0,padding:0},disabled:!!t,onClick:this.handleClear},y.createElement(tr.A,null)))})),da(this,"renderVertical",(()=>y.createElement("div",null,y.createElement("div",{className:sa.coordinateFieldsVertical},this.renderMapDialog(),y.createElement("div",{className:sa.buttonsContainerVertical},this.renderMapIcon(),this.renderClearButton()),y.createElement("div",{className:sa.inputContainer},this.renderLatitude()),y.createElement("div",{className:sa.inputContainer},this.renderLongitude()))))),da(this,"renderHorizontal",(()=>y.createElement("div",null,y.createElement("div",{className:sa.coordinateFieldsHorizontal},this.renderMapDialog(),this.renderMapIcon(),y.createElement("div",{className:sa.inputContainer},this.renderLatitude()),y.createElement("div",{className:sa.inputContainer},this.renderLongitude()),this.renderClearButton())))),this.state={showMap:!1,zoom:13}}componentDidUpdate(){this.mapInstance&&this.state.showMap&&this.mapInstance.leafletElement.invalidateSize()}render(){return this.props.orientation===qr?this.renderVertical():this.renderHorizontal()}}var ga="dateTime_fieldsContainer__g6fVs",ha="dateTime_fieldsContainerVertical__dj0zO",Ea="dateTime_root__7WxXO";function ya(){return ya=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ya.apply(this,arguments)}const va=hr()(pr()((function(e){const{value:t,...r}=e;return y.createElement(Mr,ya({value:t||""},r))})));function fa(){return fa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fa.apply(this,arguments)}function Ia(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ba extends y.Component{constructor(){super(...arguments),Ia(this,"handleBlur",(e=>{this.props.onBlur(e.currentTarget.value)})),Ia(this,"handleChange",(e=>{this.props.onChange&&this.props.onChange(e.currentTarget.value)}))}render(){const{onBlur:e,onChange:t,value:r,...n}=this.props;return y.createElement(ar,fa({value:r||"",onBlur:this.handleBlur,onChange:this.handleChange},n))}}const Sa=hr()(pr()(vr()(ba)));function Ta(){return Ta=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ta.apply(this,arguments)}function Aa(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ca extends y.Component{constructor(e){super(e),Aa(this,"getValue",(()=>this.props.value||{})),this.handleTimeChange=this.handleTimeChange.bind(this),this.handleDateChange=this.handleDateChange.bind(this),this.handleTimeBlur=this.handleTimeBlur.bind(this),this.handleDateBlur=this.handleDateBlur.bind(this),this.touchedFields=new Set}handleTimeChange(e){this.props.onChange({time:e,date:this.getValue().date})}handleDateChange(e){this.props.onChange({time:this.getValue().time,date:e})}handleTimeBlur(e){this.touchedFields.add("timeTouched");const t=this.getValue();this.handleBlur({time:e,date:t.date},!!t.date)}handleDateBlur(e){this.touchedFields.add("dateTouched");const t=this.getValue();this.handleBlur({time:t.time,date:e},!!t.time)}handleBlur(e,t){const r=this.props.onBlur,n=2===this.touchedFields.size;e.date||e.time?r(e,{touched:n||t}):r(void 0,{touched:n})}render(){const{value:e,dateMaxWidth:t,dateWidth:r,calendarWidth:n,popupAnchorPosition:a,calendarTheme:o,calendarLocale:i,calendarOnConvertValueIn:s,calendarOnConvertValueOut:l,classes:d,orientation:c,onBlur:u,dateLabel:p,timeLabel:m,onChange:g,...h}=this.props,E=c===qr,v=this.getValue(),f=v.date,I=v.time,b={width:r,maxWidth:t};return y.createElement("div",{className:Ea},y.createElement("div",{className:er()(ga,{[ha]:E})},y.createElement("div",{style:b},y.createElement(va,Ta({value:f,maxWidth:t,width:r,calendarWidth:n,onChange:this.handleDateChange,onBlur:this.handleDateBlur,label:p,calendarTheme:o,popupAnchorPosition:a,calendarLocale:i,calendarOnConvertValueIn:s,calendarOnConvertValueOut:l,classes:d},h))),y.createElement(Sa,Ta({value:I,onChange:this.handleTimeChange,onBlur:this.handleTimeBlur,label:m,classes:d},h))))}}Aa(Ca,"defaultProps",{dateLabel:n.A.t("Date"),timeLabel:n.A.t("Time")});var Oa=r(69094),Na=r(56687),Ra=r(31661),wa=r.n(Ra),_a=r(24248),Pa=r(37708),ka={container:"polygonField_container__CKxIl",statusContainer:"polygonField_statusContainer__lASev",statusText:"polygonField_statusText__x3iSp",dialogActionOuterContainer:"polygonField_dialogActionOuterContainer__ygFCT",dialogActionInnerContainer:"polygonField_dialogActionInnerContainer__tdIOT",mapContainer:"polygonField_mapContainer__rHoUo",map:"polygonField_map__abx3O",dialogContent:"polygonField_dialogContent__deXJx"},Da=r(39013),Ua=r(97598);function La(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Fa extends Ua.A{constructor(){super(...arguments),La(this,"onClick",(()=>{this.props.disabled||this.props.onClick()}))}UNSAFE_componentWillMount(){const e=wa().control({position:"topright"}),t=n.A.t("Delete polygon"),r=y.createElement("div",{className:"leaflet-draw-toolbar leaflet-bar"},y.createElement("a",{className:er()("leaflet-draw-edit-remove",{"leaflet-disabled":this.props.disabled}),onClick:this.onClick,title:t,role:"button",tabIndex:"0"}));e.onAdd=()=>{const e=wa().DomUtil.create("div","");return Da.render(r,e),e},this.leafletElement=e}createLeafletElement(){return this.leafletElement}updateLeafletElement(e,t){if(t.position!==e.position&&this.leafletElement.setPosition(t.position),t.disabled!==e.disabled){const e=this.leafletElement.getContainer().getElementsByClassName("leaflet-draw-edit-remove");e&&e.length>0&&(e[0].className=er()("leaflet-draw-edit-remove",{"leaflet-disabled":t.disabled}))}}}const xa=(0,Qn.k0)(Fa);function Ma(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Va=(0,Qn.k0)(ea.h);class ja extends y.Component{constructor(e){super(e),Ma(this,"onFeatureGroupReady",((e,t)=>{if(t){const r=new(wa().GeoJSON)(t);if(e){const n=e.leafletElement;n.clearLayers(),r.eachLayer((e=>{n.addLayer(e)}));const{map:a}=e.contextValue,o=t.features[0].geometry.coordinates[0].map((e=>[e[1],e[0]]));a.fitBounds(o)}}else if(e){e.leafletElement.clearLayers()}})),Ma(this,"getCenter",(e=>{if(!e)return this.props.center;const t=e.features[0].geometry.coordinates[0],{lat:r,lng:n}=wa().latLngBounds(t.map((e=>[e[0],e[1]]))).getCenter();return[n,r]})),Ma(this,"getFeatureCollection",(e=>Array.isArray(e)?function(e){return e?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[e[0].map((e=>[...e,0]))]}}]}:null}(e):null)),Ma(this,"closeMap",(()=>{this.setState({showMap:!1})})),Ma(this,"openMap",(()=>{this.props.onOpenMap(Boolean(this.props.value)),this.setState({showMap:!0,mapCoordinates:this.props.value})})),Ma(this,"onMapPolygonCreated",(e=>{const t=e.layer.toGeoJSON().geometry.coordinates;this.setState({mapCoordinates:t,zoom:e.target.getZoom()})})),Ma(this,"onMapPolygonEdited",(e=>{const t=e.layers.getLayers()[0].toGeoJSON().geometry.coordinates;this.setState({mapCoordinates:t,zoom:e.target.getZoom()})})),Ma(this,"onMapPolygonDelete",(()=>{this.setState({mapCoordinates:null})})),Ma(this,"onSetPolygon",(()=>{this.props.onBlur(this.state.mapCoordinates),this.closeMap()})),Ma(this,"setMapInstance",(e=>{this.mapInstance=e})),Ma(this,"renderMapDialog",(()=>y.cloneElement(this.props.mapDialog,{hide:!this.state.showMap,onClose:this.closeMap},[...y.Children.toArray(this.props.mapDialog.props.children),y.createElement(y.Fragment,null,y.createElement(R.$,{className:ka.dialogContent,key:"dialogContent"},this.renderMap()),this.renderDialogActions())]))),Ma(this,"renderMap",(()=>{const{zoom:e}=this.state,t=this.getFeatureCollection(this.state.mapCoordinates),r=!!t,n=this.getCenter(t);return y.createElement("div",{className:ka.mapContainer},y.createElement(Xn.A,{zoom:e,center:n,className:ka.map,key:"map",ref:e=>{this.setMapInstance(e)}},y.createElement(Va,{position:"topleft",inputPlaceholder:"Search",closeResultsOnClick:!0}),y.createElement(Jn.A,{url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),y.createElement(_a.A,{ref:e=>{this.onFeatureGroupReady(e,t)}},y.createElement(Pa.M,{position:"topright",onEdited:this.onMapPolygonEdited,onCreated:this.onMapPolygonCreated,onDeleted:this.onMapPolygonDelete,draw:{rectangle:!1,polyline:!1,circle:!1,marker:!1,circlemarker:!1},edit:{remove:!1}}),y.createElement(xa,{onClick:this.onMapPolygonDelete,disabled:!r}))))})),Ma(this,"renderDialogActions",(()=>y.createElement(ta.N,{className:ka.dialogActionOuterContainer},y.createElement("div",{className:ka.dialogActionInnerContainer},y.createElement(ra.$,{secondary:!0,onClick:this.closeMap},n.A.t("Cancel"))),y.createElement("div",{className:ka.dialogActionInnerContainer},y.createElement(ra.$,{primary:!0,onClick:this.onSetPolygon},n.A.t("Set area")))))),this.state={showMap:!1,zoom:13}}componentDidUpdate(){this.mapInstance&&this.state.showMap&&this.mapInstance.leafletElement.invalidateSize()}render(){const e=!!this.props.value;return y.createElement("div",{className:ka.container},y.createElement("div",{className:ka.statusContainer},e&&y.createElement(y.Fragment,null,y.createElement("span",{className:ka.checkIcon},y.createElement(Oa.A,{color:vn.T.blue600})),y.createElement("div",{className:ka.statusText},n.A.t("Area on map saved"))),y.createElement(ra.$,{onClick:this.openMap,icon:y.createElement(Na.A,null),small:!0},e?"Edit area on map":"Choose area on map")),this.renderMapDialog())}}var Ga="textField_container__COw7g";function Ba(){return Ba=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ba.apply(this,arguments)}class $a extends y.Component{render(){const{classes:e,...t}=this.props,r=e||{};return y.createElement("div",{className:Ga},y.createElement(ar,Ba({classes:r},t)))}}const Wa=vr()($a);function Ha(){return Ha=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ha.apply(this,arguments)}class za extends y.Component{static getOptions(e){return[{name:n.A.t("Yes"),value:!!e||"true"}]}constructor(e){super(e),this.options=za.getOptions(!!this.props.useRealTrueValue)}render(){const{useRealTrueValue:e,...t}=this.props;return y.createElement("div",null,y.createElement(Yn,Ha({options:this.options},t),((e,t)=>t?y.createElement(dn,null):y.createElement(cn,null))))}}var Ya=r(59435);function qa(){return qa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qa.apply(this,arguments)}function Ka(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Qa extends y.Component{constructor(e){super(e),Ka(this,"handleDebounced",(e=>{this.props.onDebounced(e)})),Ka(this,"handleChange",(e=>{this.setState({value:e.currentTarget.value}),this.debouncer({...e})})),this.state={value:this.props.value||""},this.debouncer=(0,Ya.debounce)(this.handleDebounced,500)}UNSAFE_componentWillReceiveProps(e){e.value!==this.props.value&&this.setState({value:e.value||""})}componentWillUnmount(){this.debouncer.cancel()}render(){const{onDebounced:e,value:t,...r}=this.props,{value:n}=this.state;return y.createElement(ar,qa({onChange:this.handleChange,value:n},r))}}var Xa={container:"textRangeField_container__ictb0"};const Ja={error:"innerInputError",info:"innerInputInfo",warning:"innerInputWarning",validating:"innerInputValidating"};function Za(e){const{innerMessage:t,messageKey:r,classes:n}=e;if(t){const e=t.message&&t.message[r],a=n&&n[Ja[t.messageType]]||"";return e?y.createElement("div",{className:a},e):null}return null}function eo(){return eo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},eo.apply(this,arguments)}function to(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ro=hr()(pr()(vr()(ar))),no="from",ao="to";class oo extends y.Component{constructor(e){super(e),to(this,"getValue",(()=>this.props.value||{})),to(this,"getNewValue",((e,t)=>{const r={...this.getValue(),[e]:t};return r.from||r.to?r:null})),to(this,"handleFromChange",(e=>{this.props.onChange({from:e.currentTarget.value,to:this.getValue().to})})),to(this,"handleToChange",(e=>{this.props.onChange({from:this.getValue().from,to:e.currentTarget.value})})),to(this,"handleFromBlur",(e=>{this.touchedFields.add("fromTouched");const t=this.getValue();this.handleBlur({from:e.currentTarget.value,to:t.to},!!t.to)})),to(this,"handleToBlur",(e=>{this.touchedFields.add("toTouched");const t=this.getValue();this.handleBlur({from:t.from,to:e.currentTarget.value},!!t.from)})),to(this,"handleBlur",((e,t)=>{const r=2===this.touchedFields.size;e.from||e.to?this.props.onBlur(e,{touched:r||t}):this.props.onBlur(void 0,{touched:r})})),to(this,"getInnerMessage",(e=>{const{classes:t,innerMessage:r}=this.props;return y.createElement(Za,{classes:t,messageKey:e,innerMessage:r})})),this.touchedFields=new Set}render(){const{value:e,onChange:t,onBlur:r,...a}=this.props,o=e&&e.from?e.from:"",i=e&&e.to?e.to:"";return y.createElement("div",{className:Xa.container},y.createElement("div",{className:Xa.inputContainer},y.createElement(ro,eo({label:n.A.t("From"),onChange:this.handleFromChange,onBlur:this.handleFromBlur,value:o},a)),this.getInnerMessage(no)),y.createElement("div",{className:Xa.inputContainer},y.createElement(ro,eo({label:n.A.t("To"),onChange:this.handleToChange,onBlur:this.handleToBlur,value:i},a)),this.getInnerMessage(ao)))}}var io="dateRangeField_container__V10F4";function so(){return so=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},so.apply(this,arguments)}function lo(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const co=hr()(pr()(Mr)),uo="from",po="to";class mo extends y.Component{constructor(e){super(e),lo(this,"getValue",(()=>this.props.value||{})),lo(this,"handleFromChange",(e=>{this.props.onChange({from:e,to:this.getValue().to})})),lo(this,"handleToChange",(e=>{this.props.onChange({from:this.getValue().from,to:e})})),lo(this,"handleFromBlur",(e=>{this.touchedFields.add("fromTouched");const t=this.getValue();this.handleBlur({from:e,to:t.to},!!t.to)})),lo(this,"handleToBlur",(e=>{this.touchedFields.add("toTouched");const t=this.getValue();this.handleBlur({from:t.from,to:e},!!t.from)})),lo(this,"handleBlur",((e,t)=>{const r=2===this.touchedFields.size;e.from||e.to?this.props.onBlur(e,{touched:r||t}):this.props.onBlur(void 0,{touched:r})})),lo(this,"getInnerMessage",(e=>{const{classes:t,innerMessage:r}=this.props;return y.createElement(Za,{classes:t,innerMessage:r,messageKey:e})})),this.touchedFields=new Set}render(){const{onBlur:e,onChange:t,value:r,innerMessage:a,...o}=this.props,i=r&&r.from?r.from:"",s=r&&r.to?r.to:"";return y.createElement("div",{className:io},y.createElement(co,so({label:n.A.t("From"),value:i,onBlur:this.handleFromBlur,onChange:this.handleFromChange},o)),this.getInnerMessage(uo),y.createElement(co,so({label:n.A.t("To"),value:s,onBlur:this.handleToBlur,onChange:this.handleToChange},o)),this.getInnerMessage(po))}}var go={};function ho(){return ho=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ho.apply(this,arguments)}function Eo(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const yo=hr()(Ca),vo="from",fo="to";class Io extends y.Component{constructor(e){super(e),Eo(this,"getValue",(()=>this.props.value||{})),Eo(this,"getNewValue",((e,t)=>{const r={...this.getValue(),[e]:t};return r.from||r.to?r:null})),Eo(this,"handleFromChange",(e=>{this.props.onChange({from:e,to:this.getValue().to})})),Eo(this,"handleToChange",(e=>{this.props.onChange({from:this.getValue().from,to:e})})),Eo(this,"toHasValue",(()=>{const e=this.getValue();return!!(e.to&&e.to.date&&e.to.time)})),Eo(this,"fromHasValue",(()=>{const e=this.getValue();return!!(e.to&&e.to.date&&e.to.time)})),Eo(this,"handleFromBlur",((e,t)=>{t&&t.touched&&this.touchedFields.add("fromTouched"),this.handleBlur({from:e,to:this.getValue().to},this.toHasValue())})),Eo(this,"handleToBlur",((e,t)=>{t&&t.touched&&this.touchedFields.add("toTouched"),this.handleBlur({from:this.getValue().from,to:e},this.fromHasValue())})),Eo(this,"handleBlur",((e,t)=>{const r=2===this.touchedFields.size;e.from||e.to?this.props.onBlur(e,{touched:r||t}):this.props.onBlur(void 0,{touched:r})})),Eo(this,"getInnerMessage",(e=>{const{classes:t,innerMessage:r}=this.props;return y.createElement(Za,{classes:t,innerMessage:r,messageKey:e})})),this.touchedFields=new Set}render(){const{onBlur:e,onChange:t,value:r,...a}=this.props,o=r&&r.from?r.from:"",i=r&&r.to?r.to:"";return y.createElement("div",{className:go.container},y.createElement("div",{className:go.inputContainer},y.createElement(yo,ho({dateLabel:n.A.t("From date"),timeLabel:n.A.t("From time"),value:o,onBlur:this.handleFromBlur,onChange:this.handleFromChange},a)),this.getInnerMessage(vo)),y.createElement("div",{className:go.inputContainer},y.createElement(yo,ho({dateLabel:n.A.t("To date"),timeLabel:n.A.t("To time"),value:i,onBlur:this.handleToBlur,onChange:this.handleToChange},a)),this.getInnerMessage(fo)))}}var bo="label_labelContainer__xTbRt",So="label_labelContainerVertical__39LdP";function To(){return To=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},To.apply(this,arguments)}class Ao extends y.PureComponent{render(){const{classes:e,children:t,labelRef:r,useVerticalOrientation:n,...a}=this.props,o=n?So:bo;return y.createElement("div",To({ref:r,className:er()(o,e.label)},a),t)}}var Co="withLabel_container__2GaWB",Oo="withLabel_containerVertical__ljjbt",No="withLabel_labelContainer__+rtMW",Ro="withLabel_labelContainerVertical__9HMUG",wo="withLabel_inputContainer__v2rVB";function _o(){return _o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_o.apply(this,arguments)}const Po=e=>t=>class extends y.Component{constructor(e){super(e),this.setClasses(e.classes)}UNSAFE_componentWillReceiveProps(e){const t=e.classes||{},r=this.props.classes||{};(Object.keys(t).length!==Object.keys(r).length||Object.keys(t).some((e=>t[e]!==r[e])))&&this.setClasses(t)}setClasses(t){if(!t)return;if(!e||!e.onSplitClasses)return void(this.passOnClasses=t);const r=e.onSplitClasses(t,this.props);this.labelContainerClass=r.labelContainerClass,this.labelClasses=r.labelClasses,this.passOnClasses=r.passOnClasses}getLabelElement(e,t,r){return y.createElement(Ao,{labelRef:t,classes:this.labelClasses||{},useVerticalOrientation:r},e)}render(){const{label:r,labelRef:n,classes:a,styles:o,...i}=this.props,s=e&&e.onGetUseVerticalOrientation&&e.onGetUseVerticalOrientation(this.props),l=this.getLabelElement(r,n,s),d=s?Ro:No,c=o||{};return y.createElement("div",{className:s?Oo:Co},y.createElement("div",{className:er()(d,this.labelContainerClass),style:c.labelContainerStyle},l),y.createElement("div",{className:wo,style:c.inputContainerStyle},y.createElement(t,_o({},this.passOnClasses,i))))}};var ko="table_pagination__De1Yn",Do="table_paginationRowsPerPageElementContainer__GkVTX",Uo="table_paginationRowsPerPageElement__3St3y",Lo="table_paginationDisplayRowsContainer__0+3OV";class Fo extends y.Component{static getRowsCountElement(e,t){return t?e?y.createElement("div",{className:Do},e,":",y.createElement("span",{className:Uo},t)):t:null}render(){const{currentPage:e,rowsCountSelector:t,rowsCountSelectorLabel:r,navigationElements:a}=this.props,o=Fo.getRowsCountElement(r,t);return y.createElement("div",{"data-test":"pagination",className:ko},o,e&&y.createElement("div",{className:Lo},n.A.t("Page {{currentPage}}",{currentPage:e})),a)}}var xo="divider_horizontal__i17Ld";function Mo(){return Mo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mo.apply(this,arguments)}const Vo=e=>{const{className:t,...r}=e,n=er()(xo,e.className);return y.createElement("div",Mo({className:n},r))};function jo(){return jo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jo.apply(this,arguments)}const Go={button:{cursor:"pointer",borderRadius:"3px",border:"none",background:"transparent",display:"flex",alignItems:"center",padding:"2px",justifyContent:"center",color:vn.T.grey700,"&:hover":{background:vn.T.grey200,color:vn.T.grey800},"&:focus":{outline:"solid",background:vn.T.grey200,color:vn.T.grey800},"&.disabled":{color:vn.T.grey500,cursor:"not-allowed"}}},Bo=(0,I.withStyles)(Go)((e=>{let{children:t,className:r,dataTest:n,onClick:a,disabled:o,classes:i,...s}=e;return y.createElement("button",jo({},s,{onClick:a,disabled:o,"data-test":n,className:er()(i.button,{disabled:o,...r?{[r]:!0}:{}}),type:"button",tabIndex:"0"}),t)}));var $o="nonBundledIcon_image__pAYhU";const Wo=e=>{let{source:t,color:r,width:n,height:a,alternativeText:o,cornerRadius:i}=e;const s=(0,y.useMemo)((()=>({backgroundColor:r,width:n,height:a,borderRadius:i})),[r,n,a,i]);return y.createElement("div",{style:s},t&&y.createElement("img",{className:$o,src:t,title:o,alt:""}))},Ho={overflow:"hidden",wordWrap:"break-word",textOverflow:"ellipsis",hyphens:"auto"},zo={itemRow:{borderBottom:`1px solid ${vn.T.grey300}`,display:"flex",fontSize:"14px",lineHeight:"19px",padding:`${yn.U.dp12}px 0`,"&.isLastItem":{borderBottomWidth:0}},itemKey:{flex:"0 0 auto",width:"128px",color:vn.T.grey600,marginRight:"20px",...Ho},itemValue:{flex:1,...Ho}},Yo=(0,I.withStyles)(zo)((e=>{var t;let{list:r,classes:n,dataTest:a}=e;const o=null===(t=r[r.length-1])||void 0===t?void 0:t.reactKey;return y.createElement("div",{"data-test":a},r.map((e=>(e=>y.createElement("div",{key:e.reactKey,className:er()(n.itemRow,{isLastItem:e.reactKey===o})},y.createElement("div",{className:n.itemKey},e.key,":"),y.createElement("div",{className:n.itemValue},e.value)))(e))))})),qo=(0,I.withStyles)((()=>({container:{width:120,height:80},imageContainer:{position:"relative",display:"inline-block","&:hover $image":{opacity:.5},"&:hover $icon":{visibility:"visible"}},image:{maxWidth:120,height:80,objectFit:"contain"},icon:{position:"absolute",padding:"4px 4px 2px 4px",left:"50%",bottom:"50%",transform:"translate(-50%, 50%)",background:"rgba(255, 255, 255, 0.5)",cursor:"pointer",visibility:"hidden"}})))((e=>{const{url:t,previewUrl:r,alignLeft:n,classes:a}=e,o=n?void 0:120;return y.createElement("div",{className:a.container},y.createElement("div",{className:a.imageContainer},y.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer",onClick:e=>{e.stopPropagation()}},y.createElement("img",{src:r,className:a.image,width:o}),y.createElement("div",{className:a.icon},y.createElement("svg",{width:"27",height:"27",viewBox:"0 0 27 27",fill:"none",xmlns:"http://www.w3.org/2000/svg"},y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22 11C22.0017 13.5613 21.0978 16.0408 19.4479 18L27 25.5859L25.5859 27L18 19.4479C16.0408 21.0978 13.5613 22.0017 11 22C8.82441 22 6.69767 21.3549 4.88873 20.1462C3.07979 18.9375 1.66989 17.2195 0.83733 15.2095C0.00476616 13.1995 -0.213071 10.9878 0.211367 8.85401C0.635804 6.72022 1.68345 4.76021 3.22183 3.22183C4.76021 1.68345 6.72022 0.635804 8.85401 0.211367C10.9878 -0.213071 13.1995 0.00476616 15.2095 0.83733C17.2195 1.66989 18.9375 3.07979 20.1462 4.88873C21.3549 6.69767 22 8.82441 22 11ZM5.99987 18.4832C7.47992 19.4722 9.21997 20 11 20C13.3861 19.9974 15.6738 19.0483 17.361 17.361C19.0483 15.6738 19.9974 13.3861 20 11C20 9.21997 19.4722 7.47992 18.4832 5.99987C17.4943 4.51983 16.0887 3.36628 14.4442 2.68509C12.7996 2.0039 10.99 1.82567 9.24419 2.17294C7.49836 2.5202 5.89472 3.37737 4.63604 4.63604C3.37737 5.89472 2.5202 7.49836 2.17294 9.24419C1.82567 10.99 2.0039 12.7996 2.68509 14.4442C3.36628 16.0887 4.51983 17.4943 5.99987 18.4832ZM12 10H16V12H12V16H10V12H6V10H10V6H12V10Z",fill:"#212934"}))))))})),Ko=e=>parseFloat(e)?parseFloat(e).toFixed(6):null,Qo=e=>{let{latitude:t,longitude:r}=e;return y.createElement("div",null,"lat: ",Ko(t)," ",y.createElement("br",null),"long: ",Ko(r))};var Xo=r(57603);const Jo=(e,t)=>{const[r,n]=(0,y.useState)(),[a,o]=(0,y.useState)(),[i,s]=(0,y.useState)(!1),{error:l,data:d,loading:c,refetch:u}=(0,A.iO)((0,y.useMemo)((()=>({organisationUnits:{resource:"organisationUnits",id:e=>{let{variables:{orgUnitId:t}}=e;return t},params:{fields:t}}})),[t]),{lazy:!0});return(0,y.useEffect)((()=>{!i&&e&&e!==a&&(s(!0),o(e),n(void 0),u({variables:{orgUnitId:e}}))}),[i,e,a,s,o,u]),(0,y.useEffect)((()=>{l&&S().error((0,j.px)("could not retrieve organisation unit name")({error:l}))}),[l]),(0,y.useEffect)((()=>{i&&!c&&(s(!1),e!==a||l||n({id:e,...d.organisationUnits}))}),[d,c,l,i,s,e,a]),e&&e===a?{error:l,orgUnit:r}:{}};var Zo=r(66650);const ei="capture",ti=(e,t,r)=>(0,Zo.useQuery)([ei,...e],t,{staleTime:1/0,...r}),ri=(e,t,r)=>ti(["indexedDB",...e],t,{cacheTime:0,...r,onError:e=>{(null===r||void 0===r?void 0:r.onError)&&r.onError(e),(e=>{throw e instanceof ie?S().error(e.error):e instanceof Error?S().error(e.message):S().error(e),Error("There was an error fetching metadata")})(e)}}),ni=(e,t,r)=>{const n=(0,A.ow)();return ti(e,(()=>n.query({theQuerykey:t}).then((e=>e.theQuerykey))),{cacheTime:1/0,staleTime:1/0,...r})},ai=(e,t,r)=>{const n=(0,A.ow)();return(0,Zo.useQuery)([ei,...e],(()=>n.query({theQuerykey:t}).then((e=>e.theQuerykey))),{refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,staleTime:12e4,cacheTime:3e5,...r})},oi=e=>{const t={select:e=>{let{organisationUnits:t}=e;return t},...e},{data:r,isLoading:n}=ni(["organisationUnits"],{resource:"organisationUnits",params:{fields:["id, displayName~rename(name), path"],withinUserHierarchy:!0,pageSize:2}},t);return{isLoading:n,data:r}},ii={},si={organisationUnits:{resource:"organisationUnits",params:e=>{let{filter:t}=e;return{fields:"id,displayName,ancestors[id,displayName]",filter:`id:in:[${t}]`,pageSize:50}}}},li=e=>{e.forEach((e=>{let{id:t,displayName:r,ancestors:n}=e;n.length>0?(ii[t]={displayName:r,ancestor:n[n.length-1].id},n.findLast(((e,t)=>!!ii[e.id]||(t>0?(ii[e.id]={displayName:e.displayName,ancestor:n[t-1].id},!1):(ii[e.id]={displayName:e.displayName},!0))))):ii[t]={displayName:r}}))},di=e=>{const t=Array.from(e.filter((e=>e)).reduce(((e,t)=>(ii[t]||e.add(t),e)),new Set)),r=[];for(let n=0;n<t.length;n+=50)r.push(t.slice(n,n+50));return r},ci=e=>{const t=ii[e];if(!t)return[];const r=ci(t.ancestor);return r.push(t.displayName),r},ui=e=>{const[t,r]=(0,y.useState)(!1),[n,a]=(0,y.useState)(!1),[o,i]=(0,y.useState)(),[s,l]=(0,y.useState)([]),[d,c]=(0,y.useState)(0),[u,p]=(0,y.useState)(),m=!t&&e===o,g=(0,y.useMemo)((()=>di(e)),[e]),h=(0,y.useMemo)((()=>t?s[d].join(","):""),[t,s,d]),E=(0,y.useMemo)((()=>m?e.reduce(((e,t)=>(e[t]=ii[t]?ii[t].displayName:null,e)),{}):null),[m,e]),v=(0,y.useCallback)((e=>{let{organisationUnits:t}=e;li(t.organisationUnits);const n=d+1;c(n),n===s.length?r(!1):a(!0)}),[d,c,s,r,a]),f=(0,y.useCallback)((e=>{r(!1),p(e)}),[r,p]),{refetch:I}=(0,A.iO)(si,{variables:{filter:h},onComplete:v,onError:f,lazy:!0});return(0,y.useEffect)((()=>{t||e===o||(i(e),g.length>0&&(r(!0),p(void 0),a(!0),l(g),c(0)))}),[t,e,o,g]),(0,y.useEffect)((()=>{n&&(a(!1),d<s.length&&I({filter:h}))}),[n,d,s,I,h]),{loading:!m&&!u,orgUnitNames:m&&!u?E:void 0,error:u}};async function pi(e,t){return await Promise.all(di(e).map((e=>t(si.organisationUnits,{filter:e.join(",")}).then((e=>{let{organisationUnits:t}=e;li(t)}))))),e.reduce(((e,t)=>{var r;return e[t]={id:t,name:null===(r=ii[t])||void 0===r?void 0:r.displayName},e}),{})}const mi=e=>{const t=e&&ii[e],r=t?void 0:e,{orgUnit:n,error:a}=Jo(r,"displayName,ancestors[id,displayName]");if(e&&t){const e=ci(t.ancestor);return{displayName:t.displayName,ancestors:e,error:a}}if(n&&r){li([n]);const e=n.ancestors.map((e=>e.displayName));return{displayName:n.displayName,ancestors:e,error:a}}return{error:a}},gi=e=>{let{orgUnitId:t}=e;const{displayName:r,ancestors:n=[]}=mi(t),a=[...n,r].join(" / ");return y.createElement(Xo.m,{content:a,openDelay:600,maxWidth:900},y.createElement("span",{style:{textDecoration:"underline dotted"}},r))};function hi(e){return _t($()(e))}function Ei(e){const t=$()(e);return`${_t(t)} ${t.format("HH:mm")}`}function yi(e){return $()(e,"HH:mm",!0).format("HH:mm")}function vi(e,t){return y.createElement("span",null,e(t.from)," ","->"," ",e(t.to))}const fi={[it.CO.NUMBER]:kt,[it.CO.INTEGER]:kt,[it.CO.INTEGER_POSITIVE]:kt,[it.CO.INTEGER_ZERO_OR_POSITIVE]:kt,[it.CO.INTEGER_NEGATIVE]:kt,[it.CO.INTEGER_RANGE]:e=>vi(kt,e),[it.CO.INTEGER_POSITIVE_RANGE]:e=>vi(kt,e),[it.CO.INTEGER_ZERO_OR_POSITIVE_RANGE]:e=>vi(kt,e),[it.CO.INTEGER_NEGATIVE_RANGE]:e=>vi(kt,e),[it.CO.PERCENTAGE]:e=>`${kt(e)} %`,[it.CO.DATE]:hi,[it.CO.DATE_RANGE]:e=>vi(hi,e),[it.CO.DATETIME]:Ei,[it.CO.DATETIME_RANGE]:e=>vi(Ei,e),[it.CO.TIME]:yi,[it.CO.TIME_RANGE]:e=>vi(yi,e),[it.CO.TRUE_ONLY]:()=>n.A.t("Yes"),[it.CO.BOOLEAN]:e=>e?n.A.t("Yes"):n.A.t("No"),[it.CO.COORDINATE]:Qo,[it.CO.AGE]:hi,[it.CO.FILE_RESOURCE]:function(e){return"string"===typeof e||e instanceof String?e:y.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onClick:e=>{e.stopPropagation()}},e.name)},[it.CO.IMAGE]:function(e){return"string"===typeof e||e instanceof String?e:y.createElement(qo,{url:e.url,previewUrl:e.previewUrl})},[it.CO.ORGANISATION_UNIT]:function(e){const t="string"===typeof e?e:e.id;return y.createElement(gi,{orgUnitId:t})},[it.CO.ASSIGNEE]:e=>`${e.name} (${e.username})`,[it.CO.NUMBER_RANGE]:function(e){return y.createElement("span",null,e.from," ","->"," ",e.to)},[it.CO.STATUS]:function(e){const{isNegative:t,isPositive:r,text:n}=e;return y.createElement(Mt.v,{negative:t,positive:r},n)}};function Ii(e,t,r){return e||0===e||!1===e?r&&r.optionSet?r.type===it.CO.MULTI_TEXT?r.optionSet.getMultiOptionsText(e):r.optionSet.getOptionText(e):fi[t]?fi[t](e):e:e}function bi(e,t,r){return e||0===e||!1===e?r?t===it.CO.MULTI_TEXT?r.filter((t=>e.includes(t.code))).map((e=>e.name)).join(", "):null!==(n=null===(a=r.find((t=>t.code===e)))||void 0===a?void 0:a.name)&&void 0!==n?n:e:fi[t]?fi[t](e):e:e;var n,a}function Si(e){return _t($()(e))}function Ti(e){const t=$()(e);return`${_t(t)} ${t.format("HH:mm")}`}const Ai={[it.CO.NUMBER]:kt,[it.CO.INTEGER]:kt,[it.CO.INTEGER_POSITIVE]:kt,[it.CO.INTEGER_ZERO_OR_POSITIVE]:kt,[it.CO.INTEGER_NEGATIVE]:kt,[it.CO.PERCENTAGE]:e=>`${kt(e)} %`,[it.CO.DATE]:Si,[it.CO.DATETIME]:Ti,[it.CO.TIME]:function(e){return $()(e,"HH:mm",!0).format("HH:mm")},[it.CO.TRUE_ONLY]:()=>n.A.t("Yes"),[it.CO.BOOLEAN]:e=>e?n.A.t("Yes"):n.A.t("No"),[it.CO.COORDINATE]:Qo,[it.CO.AGE]:Si,[it.CO.FILE_RESOURCE]:function(e){return y.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onClick:e=>{e.stopPropagation()}},e.name)},[it.CO.IMAGE]:function(e){return y.createElement(qo,{url:e.url,previewUrl:e.previewUrl,alignLeft:!0})},[it.CO.ORGANISATION_UNIT]:function(e){return y.createElement(gi,{orgUnitId:e.id})},[it.CO.POLYGON]:()=>"Polygon"};function Ci(e,t,r){return e||0===e||!1===e?r&&r.optionSet?r.type===it.CO.MULTI_TEXT?r.optionSet.getMultiOptionsText(e):r.optionSet.getOptionText(e):Ai[t]?Ai[t](e):e:e}function Oi(e){return e?$()(e).hours()||$()(e).minutes()?Ti(e):Si(e):""}function Ni(e){const t=e,r=$()(t);return r.locale("en"),r.format("YYYY-MM-DD")}function Ri(e,t){return{from:e(t.from),to:e(t.to)}}const wi={[it.CO.NUMBER]:kt,[it.CO.NUMBER_RANGE]:e=>Ri(kt,e),[it.CO.INTEGER]:kt,[it.CO.INTEGER_RANGE]:e=>Ri(kt,e),[it.CO.INTEGER_POSITIVE]:kt,[it.CO.INTEGER_POSITIVE_RANGE]:e=>Ri(kt,e),[it.CO.INTEGER_ZERO_OR_POSITIVE]:kt,[it.CO.INTEGER_ZERO_OR_POSITIVE_RANGE]:e=>Ri(kt,e),[it.CO.INTEGER_NEGATIVE]:kt,[it.CO.INTEGER_NEGATIVE_RANGE]:e=>Ri(kt,e),[it.CO.PERCENTAGE]:kt,[it.CO.DATE]:Ni,[it.CO.DATE_RANGE]:e=>Ri(Ni,e),[it.CO.TRUE_ONLY]:()=>"true",[it.CO.BOOLEAN]:e=>e?"true":"false",[it.CO.FILE_RESOURCE]:e=>e.value,[it.CO.IMAGE]:e=>e.value,[it.CO.COORDINATE]:e=>`[${e.longitude},${e.latitude}]`,[it.CO.ORGANISATION_UNIT]:e=>e.id,[it.CO.AGE]:e=>Ni(e),[it.CO.ASSIGNEE]:e=>e?{uid:e.id,displayName:e.name,username:e.username,firstName:e.firstName,surname:e.surname}:null};function _i(e,t){return(e||0===e||!1===e)&&wi[t]?wi[t](e):e}function Pi(e,t){if("object"===typeof e){const r=e;return Object.keys(r).reduce(((t,r)=>(e[r]&&t.push(e[r]),t)),[]).join((0,j.L8)(t,j.Gv.newAocApiSeparator)?",":";")}return e}var ki=r(65028);function Di(e){const t=e.date,r=pt(e.time);if(!r.isValid)return null;const n=r.momentTime,a=n.hour(),o=n.minute(),i=Rt(t);if(!i.isValid)return null;const s=i.momentDate;return s.hour(a),s.minute(o),s.toISOString()}function Ui(e){const t=Rt(e);return t.isValid?t.momentDate.toISOString():null}function Li(e){const t=pt(e);if(!t.isValid)return null;const r=t.momentTime;return r.locale("en"),r.format("HH:mm")}function Fi(e,t){return{from:e(t.from),to:e(t.to)}}const xi={[it.CO.NUMBER]:ut,[it.CO.NUMBER_RANGE]:e=>Fi(ut,e),[it.CO.INTEGER]:ut,[it.CO.INTEGER_RANGE]:e=>Fi(ut,e),[it.CO.INTEGER_POSITIVE]:ut,[it.CO.INTEGER_POSITIVE_RANGE]:e=>Fi(ut,e),[it.CO.INTEGER_ZERO_OR_POSITIVE]:ut,[it.CO.INTEGER_ZERO_OR_POSITIVE_RANGE]:e=>Fi(ut,e),[it.CO.INTEGER_NEGATIVE]:ut,[it.CO.INTEGER_NEGATIVE_RANGE]:e=>Fi(ut,e),[it.CO.PERCENTAGE]:e=>ut(e.replace("%","")),[it.CO.DATE]:Ui,[it.CO.DATE_RANGE]:e=>Fi(Ui,e),[it.CO.DATETIME]:Di,[it.CO.DATETIME_RANGE]:e=>Fi(Di,e),[it.CO.TIME]:Li,[it.CO.TIME_RANGE]:e=>Fi(Li,e),[it.CO.TRUE_ONLY]:e=>"true"===e||null,[it.CO.BOOLEAN]:e=>"true"===e,[it.CO.AGE]:function(e){return Ui(e.date)}};function Mi(e,t){if(null==e)return null;let r;if((0,ki.A)(e)){if(r=e.trim(),!r)return null}else r=e;return xi[t]?xi[t](r):r}const Vi=(e,t)=>e===it.CO.MULTI_TEXT&&!t,ji=(e,t)=>(((e,t)=>e===it.CO.MULTI_TEXT&&!(0,j.L8)(t,j.Gv.multiText))(e.type,t)&&(S().error((0,j.px)(`MULTI_TEXT is only supported from version 41. You are currently on version ${t}.`)({dataElement:e})),e.type=it.CO.TEXT),e),Gi=(e,t)=>Vi(e.type,e.optionSet)?(S().error((0,j.px)("MULTI_TEXT without optionset is not supported")({dataElement:e})),null):ji(e,t),Bi=Object.freeze({COLON:":",COMMA:",",SLASH:"/"}),$i=e=>e.replace(new RegExp(Bi.SLASH,"g"),`/${Bi.SLASH}`).replace(new RegExp(Bi.COLON,"g"),`/${Bi.COLON}`).replace(new RegExp(Bi.COMMA,"g"),`/${Bi.COMMA}`);function Wi(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Hi{static onValidateOnScopeTrackedEntityType(e,t,r){let n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0;if(e.scope===it.w$.ORGANISATION_UNIT){const e=a.orgUnitId;n=o({resource:"tracker/trackedEntities",params:{trackedEntityType:a.trackedEntityTypeId,orgUnit:e,filter:`${t.id}:EQ:${$i(r)}`}})}else n=o({resource:"tracker/trackedEntities",params:{trackedEntityType:a.trackedEntityTypeId,ouMode:"ACCESSIBLE",filter:`${t.id}:EQ:${$i(r)}`}});return n.then((e=>{const t=L(U.trackedEntities,e).filter((e=>e.trackedEntity!==a.trackedEntityInstanceId)),r=t&&t[0]||{},n={id:r.trackedEntity,tetId:r.trackedEntityType};return{valid:0===t.length,data:n}}))}static buildtetFeatureType(e,t){return new it.fq((r=>{r.section=t,r.id=`FEATURETYPE_${e}`,r.name="POINT"===e?n.A.t("Coordinate"):n.A.t("Area"),r.formName=r.name,r.compulsory=!1,r.displayInForms=!0,r.disabled=!1,r.type="POINT"===e?it.CO.COORDINATE:it.CO.POLYGON}))}static _buildDataElementUnique(e,t){var r=this;return new it.Ow((n=>{n.scope=t.orgunitScope?it.w$.ORGANISATION_UNIT:it.w$.ENTIRE_SYSTEM,n.onValidate=function(a){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const s=(0,j.Fs)(Mi,_i)(a,t.valueType);if(o.onGetUnsavedAttributeValues){const t=o.onGetUnsavedAttributeValues(e.id);if(t){if(t.find((e=>e===s)))return{valid:!1,data:{attributeValueExistsUnsaved:!0}}}}let l;if(n.scope===it.w$.ORGANISATION_UNIT){const t=o.orgUnitId;l=i({resource:"tracker/trackedEntities",params:{program:o.programId,orgUnit:t,filter:`${e.id}:EQ:${$i(s)}`}})}else l=i({resource:"tracker/trackedEntities",params:{program:o.programId,ouMode:"ACCESSIBLE",filter:`${e.id}:EQ:${$i(s)}`}});return l.then((t=>{const a=L(U.trackedEntities,t).filter((e=>e.trackedEntity!==o.trackedEntityInstanceId));if(0===a.length)return r.onValidateOnScopeTrackedEntityType(n,e,s,o,i);const l=a&&a[0]||{},d={id:l.trackedEntity,tetId:l.trackedEntityType};return{valid:0===a.length,data:d}}))},t.pattern&&(n.generatable=!!t.pattern)}))}constructor(e){let{cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:n,minorServerVersion:a}=e;this.cachedTrackedEntityAttributes=t,this.locale=n,this.optionSetFactory=new It(r,n),this.minorServerVersion=a}_getAttributeTranslation(e,t){if(this.locale){const r=e.find((e=>e.property===t&&e.locale===this.locale));return r&&r.value}return null}async _setBaseProperties(e,t,r){e.id=r.id,e.compulsory=t.mandatory,e.code=r.code,e.attributeValues=r.attributeValues,e.inherit=r.inherit,e.name=this._getAttributeTranslation(r.translations,Hi.translationPropertyNames.NAME)||r.displayName,e.shortName=this._getAttributeTranslation(r.translations,Hi.translationPropertyNames.SHORT_NAME)||r.displayShortName,e.formName=this._getAttributeTranslation(r.translations,Hi.translationPropertyNames.FORM_NAME)||r.displayFormName,e.description=this._getAttributeTranslation(r.translations,Hi.translationPropertyNames.DESCRIPTION)||r.description,e.displayInForms=!0,e.displayInReports=t.displayInList,e.disabled=!1,e.type=r.valueType,e.searchable=t.searchable,r.unique&&(e.unique=Hi._buildDataElementUnique(e,r)),r.optionSet&&r.optionSet.id&&(e.optionSet=await this.optionSetFactory.build(e,r.optionSet.id,t.renderOptionsAsRadio,null,(e=>e)))}async _buildBaseDataElement(e,t,r){const n=new it.fq;return n.section=r,n.type=t.valueType,await this._setBaseProperties(n,e,t),Gi(n,this.minorServerVersion)}async _buildDateDataElement(e,t,r){const n=new it.H;return n.type=it.CO.DATE,n.allowFutureDate=e.allowFutureDate,n.section=r,await this._setBaseProperties(n,e,t),n}build(e,t){const r=e.trackedEntityAttributeId&&this.cachedTrackedEntityAttributes.get(e.trackedEntityAttributeId);return r?r.valueType===it.CO.DATE?this._buildDateDataElement(e,r,t):this._buildBaseDataElement(e,r,t):(S().error((0,j.px)(Hi.errorMessages.TRACKED_ENTITY_ATTRIBUTE_NOT_FOUND)({cachedProgramTrackedEntityAttribute:e})),null)}}Wi(Hi,"translationPropertyNames",{NAME:"NAME",DESCRIPTION:"DESCRIPTION",SHORT_NAME:"SHORT_NAME",FORM_NAME:"FORM_NAME"}),Wi(Hi,"errorMessages",{TRACKED_ENTITY_ATTRIBUTE_NOT_FOUND:"TrackedEntityAttributeId missing from programTrackedEntityAttribute or trackedEntityAttribute not found",MULIT_TEXT_WITH_NO_OPTIONS_SET:"could not create the metadata because a MULIT_TEXT without associated option sets was found"});const zi=(e,t,r)=>{if("input"===e.name){var n;const i=null===(n=e.attribs)||void 0===n?void 0:n.attributeid;if(i){var a,o;const n=r(e,t),s={id:i,style:null===(a=n.props)||void 0===a?void 0:a.style,className:null===(o=n.props)||void 0===o?void 0:o.className};return y.createElement("FormField",{customFormElementProps:s,id:i})}}},Yi=(e,t,r)=>{if("input"===e.name){const o=e.attribs&&e.attribs.id,i=o&&/-[^-]+/.exec(o);if(i){var n,a;const s=i[0].replace("-",""),l=r(e,t),d={id:o,style:null===(n=l.props)||void 0===n?void 0:n.style,className:null===(a=l.props)||void 0===a?void 0:a.className};return y.createElement("FormField",{customFormElementProps:d,id:s})}}};var qi=r(35236);const Ki=Object.freeze({SET_FIELD_VALUE_MISSING_ID:"setFieldValue: missing required fieldId",SET_FIELD_VALUE_ID_NOT_ALLOWED:"setFieldValue: fieldId must be one of the configured plugin ids",SET_CONTEXT_FIELD_VALUE_MISSING_ID:"setContextFieldValue: tried to set value for a field that does not exist in the plugin context"}),Qi=Object.freeze({DATA_ELEMENT:"dataElement",PLUGIN:"plugin"}),Xi=e=>{let{attributes:t,selectedScopeId:r}=e;const{data:n}=ri(["optionSets",r],(()=>{var e,r;return r=null!==(e=null===t||void 0===t?void 0:t.reduce(((e,t)=>(t.optionSet&&e.push(t.optionSet.id),e)),[]))&&void 0!==e?e:[],ve().getAll(z.OPTION_SETS,{predicate:e=>r.includes(e.id)})}),{enabled:!!t});return{optionSets:n}},Ji=(e,t)=>{const r=ve(),{enabled:n=!0}=null!==t&&void 0!==t?t:{},{data:a,isLoading:o,isError:i}=ri(["programs",e],(()=>r.get(z.PROGRAMS,e)),{enabled:n});return{program:a,isLoading:o,isError:i}};var Zi=r(12813);function es(e){const t=(0,y.useMemo)((()=>(0,it.WB)(e)),[e]);return(0,Zi.q)(t)}function ts(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class rs{static buildtetFeatureType(e){return new it.fq((t=>{t.id=`FEATURETYPE_${e}`,t.name="POINT"===e?n.A.t("Coordinate"):n.A.t("Area"),t.formName=t.name,t.compulsory=!1,t.displayInForms=!0,t.disabled=!1,t.type="POINT"===e?it.CO.COORDINATE:it.CO.POLYGON}))}constructor(e){let{cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:n,minorServerVersion:a}=e;this.cachedTrackedEntityAttributes=t,this.locale=n,this.optionSetFactory=new It(r,n),this.minorServerVersion=a}_getAttributeTranslation(e,t){if(this.locale){const r=e.find((e=>e.property===t&&e.locale===this.locale));return r&&r.value}return null}async build(e){const t=e.trackedEntityAttributeId&&this.cachedTrackedEntityAttributes.get(e.trackedEntityAttributeId);if(!t)return S().error((0,j.px)(rs.errorMessages.TRACKED_ENTITY_ATTRIBUTE_NOT_FOUND)({cachedTrackedEntityTypeAttribute:e})),null;const r=new it.fq((r=>{r.id=t.id,r.compulsory=e.mandatory,r.code=t.code,r.name=this._getAttributeTranslation(t.translations,rs.translationPropertyNames.NAME)||t.displayName,r.shortName=this._getAttributeTranslation(t.translations,rs.translationPropertyNames.SHORT_NAME)||t.displayShortName,r.formName=this._getAttributeTranslation(t.translations,rs.translationPropertyNames.FORM_NAME)||t.displayFormName,r.description=this._getAttributeTranslation(t.translations,rs.translationPropertyNames.DESCRIPTION)||t.description,r.displayInForms=!0,r.inherit=t.inherit,r.displayInReports=e.displayInList,r.disabled=!1,r.type=t.valueType}));return t.unique&&(r.unique=new it.Ow((e=>{e.scope=t.orgunitScope?it.w$.ORGANISATION_UNIT:it.w$.ENTIRE_SYSTEM,e.onValidate=function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const i=(0,j.Fs)(Mi,_i)(n,t.valueType);if(a.onGetUnsavedAttributeValues){const e=a.onGetUnsavedAttributeValues(r.id);if(e){if(e.find((e=>e===i)))return{valid:!1,data:{attributeValueExistsUnsaved:!0}}}}let s;if(e.scope===it.w$.ORGANISATION_UNIT){const e=a.orgUnitId;s=o({resource:"tracker/trackedEntities",params:{trackedEntityType:a.trackedEntityTypeId,orgUnit:e,filter:`${r.id}:EQ:${$i(i)}`}})}else s=o({resource:"tracker/trackedEntities",params:{trackedEntityType:a.trackedEntityTypeId,ouMode:"ACCESSIBLE",filter:`${r.id}:EQ:${$i(i)}`}});return s.then((e=>{const t=L(U.trackedEntities,e),r=t[0]||{},n={id:r.trackedEntity,tetId:r.trackedEntityType};return{valid:0===t.length,data:n}}))},t.pattern&&(e.generatable=!!t.pattern)}))),t.optionSet&&t.optionSet.id&&(r.optionSet=await this.optionSetFactory.build(r,t.optionSet.id,null,null,(e=>e))),Gi(r,this.minorServerVersion)}}ts(rs,"translationPropertyNames",{NAME:"NAME",DESCRIPTION:"DESCRIPTION",SHORT_NAME:"SHORT_NAME",FORM_NAME:"FORM_NAME"}),ts(rs,"errorMessages",{TRACKED_ENTITY_ATTRIBUTE_NOT_FOUND:"TrackedEntityAttributeId missing from trackedEntityTypeAttribute or trackedEntityAttribute not found",MULIT_TEXT_WITH_NO_OPTIONS_SET:"could not create the metadata because a MULIT_TEXT without associated option sets was found"});class ns{static _buildSearchGroupElement(e,t){return new it.fq((r=>{r.id=e.id,r.name=e.name,r.shortName=e.shortName,r.formName=e.formName,r.description=e.description,r.displayInForms=!0,r.displayInReports=e.displayInReports,r.compulsory=e.compulsory,r.disabled=e.disabled,r.type=t.valueType,r.optionSet=e.optionSet}))}static _buildTetFeatureTypeField(e){const t=e.featureType;return t&&["POINT","POLYGON"].includes(t)?rs.buildtetFeatureType(t):null}constructor(e){let{cachedTrackedEntityAttributes:t,cachedOptionSets:r,dataEntryFormConfig:n,locale:a,minorServerVersion:o}=e;this.cachedTrackedEntityAttributes=t,this.dataElementFactory=new rs({cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:a,minorServerVersion:o}),this.dataEntryFormConfig=n}async _buildSection(e){const t=ns._buildTetFeatureTypeField(e),r=e.trackedEntityTypeAttributes;if((!r||r.length<=0)&&!t)return null;const a=new it.wn((e=>{e.id=it.wn.MAIN_SECTION_ID,e.name=n.A.t("Profile")}));if(t&&a.addElement(t),this.dataEntryFormConfig&&r){const e=r.reduce(((e,t)=>(t.trackedEntityAttributeId&&(e[t.trackedEntityAttributeId]=t),e)),{});return this.dataEntryFormConfig.asyncForEach((async t=>{const r=t.elements.reduce(((t,r)=>{if(r.type===Qi.PLUGIN){var n;const a=null===(n=r.fieldMap)||void 0===n?void 0:n.map((t=>({...t,...e[t.IdFromApp]})));return t.push({...r,fieldMap:a}),t}const a=e[r.id];return a&&t.push(a),t}),[]);await r.asyncForEach((async e=>{if((null===e||void 0===e?void 0:e.type)===Qi.PLUGIN){const t=e.fieldMap.filter((e=>"Attribute"===e.objectType)).reduce(((e,t)=>(e[t.IdFromApp]=t,e)),{}),r=new qi.g((r=>{r.id=e.id,r.name=e.name,r.pluginSource=e.pluginSource,r.fields=new Map,r.customAttributes=t}));await e.fieldMap.asyncForEach((async e=>{if(e.objectType===yd.TRACKED_ENTITY_ATTRIBUTE){const t=await this.dataElementFactory.build(e);if(!t)return;r.addField(e.IdFromPlugin,t)}})),r&&a.addElement(r)}else{const t=await this.dataElementFactory.build(e);t&&a.addElement(t)}}))})),a}return r&&r.length>0&&await r.asyncForEach((async e=>{const t=await this.dataElementFactory.build(e);t&&a.addElement(t)})),a}async _buildFoundation(e){const t=new it.k3((t=>{t.name=e.displayName,t.id=e.id})),r=await this._buildSection(e);return r&&t.addSection(r),t}_buildInputSearchGroupFoundation(e,t){const r=(e.trackedEntityTypeAttributes||[]).reduce(((e,t)=>{if(!t.trackedEntityAttributeId)return S().error((0,j.px)("TrackedEntityAttributeId missing from trackedEntityTypeAttribute")({typeTeiAttribute:t})),e;const r=this.cachedTrackedEntityAttributes.get(t.trackedEntityAttributeId);return r?e[r.id]=r:S().error((0,j.px)("could not retrieve tei attribute")({typeTeiAttribute:t})),e}),{}),n=t.searchForm,a=new it.k3,o=new it.wn((e=>{e.id=it.wn.MAIN_SECTION_ID}));return Array.from(n.getSection(it.wn.MAIN_SECTION_ID).elements.entries()).map((e=>e[1])).forEach((e=>{const t=ns._buildSearchGroupElement(e,r[e.id]);t&&o.addElement(t)})),a.addSection(o),a}_buildInputSearchGroups(e,t){return t.filter((e=>!e.unique)).map((t=>new it.Me((r=>{r.id=t.id,r.minAttributesRequiredToSearch=t.minAttributesRequiredToSearch,r.searchFoundation=this._buildInputSearchGroupFoundation(e,t)}))))}async build(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;const n=await this._buildFoundation(e),a=this._buildInputSearchGroups(e,t);return new it.kR((e=>{e.form=n,e.inputSearchGroups=a,e.trackedEntityType=r}))}}class as{constructor(e){let{cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:n,dataEntryFormConfig:a,minorServerVersion:o}=e;this.locale=n,this.dataElementFactory=new rs({cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:n,minorServerVersion:o}),this.searchGroupFactory=new Ct({cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:n}),this.teiRegistrationFactory=new ns({cachedTrackedEntityAttributes:t,cachedOptionSets:r,dataEntryFormConfig:a,locale:n,minorServerVersion:o})}_getTranslation(e,t){if(this.locale){const r=e.find((e=>e.property===t&&e.locale===this.locale));return r&&r.value}return null}async _buildAttributes(e){const t=e.map((async e=>await this.dataElementFactory.build(e)));return(await Promise.all(t)).filter((e=>e))}async build(e){const t=new it.UC((t=>{t.id=e.id,t.access=e.access,t.name=this._getTranslation(e.translations,as.translationPropertyNames.NAME)||e.displayName}));return e.trackedEntityTypeAttributes&&(t.searchGroups=await this.searchGroupFactory.build(e.trackedEntityTypeAttributes,e.minAttributesRequiredToSearch),t.attributes=await this._buildAttributes(e.trackedEntityTypeAttributes)),t.teiRegistration=await this.teiRegistrationFactory.build(e,t.searchGroups,t),t}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(as,"translationPropertyNames",{NAME:"NAME",SHORT_NAME:"SHORT_NAME",DESCRIPTION:"DESCRIPTION"});const os=e=>ve().getAll(z.TRACKED_ENTITY_ATTRIBUTES,{predicate:t=>e.includes(t.id)}),is=e=>{let{trackedEntityType:t,optionSets:r,dataEntryFormConfig:n,configIsFetched:a,locale:o}=e;const{data:i}=ri(["trackedEntityAttributes",null===t||void 0===t?void 0:t.id],(()=>{var e,r;return os(null!==(e=null===t||void 0===t||null===(r=t.trackedEntityTypeAttributes)||void 0===r?void 0:r.reduce(((e,t)=>{let{trackedEntityAttributeId:r}=t;return r&&e.push(r),e}),[]))&&void 0!==e?e:[])}),{enabled:!!t}),{serverVersion:{minor:s}}=(0,A.UK)(),{data:l}=ri(["trackedEntityTypeCollection",null===t||void 0===t?void 0:t.id],(()=>(async e=>{let{cachedTrackedEntityAttributes:t,cachedOptionSets:r,cachedTrackedEntityType:n,dataEntryFormConfig:a,locale:o,minorServerVersion:i}=e;return new as({cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:o,dataEntryFormConfig:a,minorServerVersion:i}).build(n)})({cachedTrackedEntityType:t,cachedTrackedEntityAttributes:new Map(null===i||void 0===i?void 0:i.map((e=>[e.id,e]))),cachedOptionSets:new Map(null===r||void 0===r?void 0:r.map((e=>[e.id,e]))),dataEntryFormConfig:n,locale:o,minorServerVersion:s})),{enabled:!!t&&!!r&&!!i&&!!o&&a});return{trackedEntityTypeCollection:l}},ss=async(e,t)=>{let{minAttributesRequiredToSearch:r,programTrackedEntityAttributes:n,trackedEntityTypeAttributes:a}=e;const o=ve(),i=null!==n&&void 0!==n?n:a,s=await o.getAll(z.TRACKED_ENTITY_ATTRIBUTES,{predicate:e=>i.some((t=>t.trackedEntityAttributeId===e.id))}),l=await o.getAll(z.OPTION_SETS,{predicate:e=>null===s||void 0===s?void 0:s.some((t=>{var r;return(null===(r=t.optionSet)||void 0===r?void 0:r.id)===e.trackedEntityAttributeId}))}),d=new Ct({cachedTrackedEntityAttributes:new Map(s.map((e=>[e.id,e]))),cachedOptionSets:new Map(l.map((e=>[e.id,e]))),locale:t});return await d.build(i,r)},ls=()=>(0,y.useMemo)((()=>[...Nt.Jj.values()].filter((e=>e instanceof it.rr)).reduce(((e,t)=>{let{id:r,name:n,trackedEntityType:{id:a,access:o,name:i,searchGroups:s,teiRegistration:{form:l,inputSearchGroups:d}},searchGroups:c,enrollment:u}=t;const p=e[a]?e[a].programs:[];return{...e,[a]:{trackedEntityTypeId:a,trackedEntityTypeAccess:o,trackedEntityTypeName:i,trackedEntityTypeSearchGroups:s,trackedEntityTypeTeiRegistration:{form:l,inputSearchGroups:d},programs:[...p,{programId:r,programName:n,searchGroups:c,enrollment:u}]}}}),{})),[]),ds=(e,t,r,n,a)=>({searchOptionId:e,searchOptionName:t,TETypeName:a,searchGroups:[...r.values()].map(((t,r)=>{let{unique:a,searchForm:o,minAttributesRequiredToSearch:i}=t;return{unique:a,searchForm:o,formId:`searchDomainForm-${e}-${r}`,searchScope:n,minAttributesRequiredToSearch:i}}))}),cs=(e,t)=>{let{enabled:r}=t;const n=ve(),{data:a,isLoading:o,isError:i}=ri(["trackedEntityType",e],(()=>n.get(z.TRACKED_ENTITY_TYPES,e)),{enabled:r});return{trackedEntityType:a,isLoading:o,isError:i}},us=()=>{var e,t;const r=(0,A.ow)(),{data:n,isLoading:a,isError:o,error:i}=(0,Zo.useQuery)(["userLocale"],(()=>r.query({userSettings:{resource:"me",params:{fields:"settings[keyUiLocale]"}}})));return{locale:null===n||void 0===n||null===(e=n.userSettings)||void 0===e||null===(t=e.settings)||void 0===t?void 0:t.keyUiLocale,isLoading:a,isError:o,error:i}},ps="PROGRAM",ms="TRACKED_ENTITY_TYPE";var gs=r(51668);const hs=()=>(0,gs.d4)((e=>{let{currentSelections:t}=e;return t.trackedEntityTypeId})),Es={ACTIVE:"ACTIVE",SCHEDULE:"SCHEDULE",COMPLETED:"COMPLETED",OVERDUE:"OVERDUE",SKIPPED:"SKIPPED",VISITED:"VISITED"},ys=e=>({[Es.ACTIVE]:n.A.t("Active"),[Es.SCHEDULE]:e?n.A.t("Scheduled{{ escape }} due {{ time }}",{time:e,escape:":",interpolation:{escapeValue:!1}}):n.A.t("Scheduled"),[Es.COMPLETED]:n.A.t("Completed"),[Es.OVERDUE]:e?n.A.t("Overdue{{ escape }} due {{ time }}",{time:e,escape:":",interpolation:{escapeValue:!1}}):n.A.t("Overdue"),[Es.SKIPPED]:n.A.t("Skipped"),[Es.VISITED]:n.A.t("Visited")}),vs=()=>{const e=(0,T.zy)().search;return(0,y.useMemo)((()=>[...new URLSearchParams(e).entries()].reduce(((e,t)=>(e[t[0]]=t[1],e)),{})),[e])},fs=()=>{const e=window.location.hash.split("?")[1];return[...new URLSearchParams(e).entries()].reduce(((e,t)=>{let[r,n]=t;return e[r]=n,e}),{})},Is=e=>Object.entries(e).filter((e=>{let[,t]=e;return null!=t})).sort(((e,t)=>{let[r]=e,[n]=t;return r.localeCompare(n,"en")})).reduce(((e,t)=>{let[r,n]=t;return n&&e.append(r,n),e}),new URLSearchParams).toString(),bs=e=>{const t=(0,gs.d4)((e=>{var t;let{viewEventPage:r}=e;return null===r||void 0===r||null===(t=r.eventDetailsSection)||void 0===t?void 0:t.showEditEvent})),{initMode:r}=vs();return(0,y.useMemo)((()=>r?{currentPageMode:r}:e===Es.SCHEDULE||e===Es.OVERDUE?{currentPageMode:V.EDIT}:{currentPageMode:t?V.EDIT:V.VIEW}),[r,t,e])},Ss={COMMON_ENROLLMENT_SITE_DATA_SET:"EnrollmentSite.SetCommonData",UPDATE_ENROLLMENT_DATE:"Enrollment.UpdateEnrollmentDate",UPDATE_INCIDENT_DATE:"Enrollment.UpdateIncidentDate",UPDATE_ENROLLMENT_EVENT:"Enrollment.UpdateEnrollmentEvent",UPDATE_OR_ADD_ENROLLMENT_EVENTS:"Enrollment.UpdateOrAddEnrollmentEvents",UPDATE_ENROLLMENT_EVENT_WITHOUT_ID:"Enrollment.UpdateEnrollmentEventWithoutId",UPDATE_ENROLLMENT_ATTRIBUTE_VALUES:"Enrollment.UpdateEnrollmentAttributeValues",ROLLBACK_ENROLLMENT_EVENT:"Enrollment.RollbackEnrollmentEvent",ROLLBACK_ENROLLMENT_EVENTS:"Enrollment.RollbackEnrollmentEvents",DELETE_ENROLLMENT_EVENT:"Enrollment.DeleteEnrollmentEvent",UPDATE_ENROLLMENT_EVENT_STATUS:"Enrollment.UpdateEnrollmentEventStatus",COMMIT_ENROLLMENT_EVENT:"Enrollment.CommitEnrollmentEvent",COMMIT_ENROLLMENT_EVENTS:"Enrollment.CommitEnrollmentEvents",SAVE_FAILED:"Enrollment.SaveFailed",ERROR_ENROLLMENT:"Enrollment.ErrorEnrollment",ADD_PERSISTED_ENROLLMENT_EVENTS:"Enrollment.AddPersistedEnrollmentEvents",UPDATE_ENROLLMENT_AND_EVENTS:"Enrollment.UpdateEnrollmentAndEvents",ROLLBACK_ENROLLMENT_AND_EVENTS:"Enrollment.RollbackEnrollmentAndEvents",COMMIT_ENROLLMENT_AND_EVENTS:"Enrollment.CommitEnrollmentAndEvents",SET_EXTERNAL_ENROLLMENT_STATUS:"Enrollment.SetExternalEnrollmentStatus"},Ts=(e,t)=>l(Ss.UPDATE_ENROLLMENT_EVENT)({eventId:e,eventData:t}),As=e=>l(Ss.ROLLBACK_ENROLLMENT_EVENT)({eventId:e}),Cs=e=>l(Ss.COMMIT_ENROLLMENT_EVENT)({eventId:e}),Os=e=>{let{events:t}=e;return l(Ss.ROLLBACK_ENROLLMENT_EVENTS)({events:t})},Ns=()=>l(Ss.SAVE_FAILED)(),Rs=e=>{let{message:t}=e;return l(Ss.ERROR_ENROLLMENT)({message:t})},ws=e=>l(Ss.UPDATE_ENROLLMENT_AND_EVENTS)({enrollment:e}),_s=e=>l(Ss.ROLLBACK_ENROLLMENT_AND_EVENTS)({uid:e}),Ps=(e,t)=>l(Ss.COMMIT_ENROLLMENT_AND_EVENTS)({uid:e,eventId:t}),ks=e=>l(Ss.SET_EXTERNAL_ENROLLMENT_STATUS)({status:e}),Ds=e=>{let{events:t}=e;return l(Ss.ADD_PERSISTED_ENROLLMENT_EVENTS)({events:t})},Us=(e,t,r)=>{var n;const a=(0,gs.wA)(),{enrollmentId:o,enrollment:i,attributeValues:s}=(0,gs.d4)((e=>{let{enrollmentDomain:t}=e;return t})),{data:d,error:c}=ai(["stages&event","enrollmentData",e,r,t],{resource:"tracker/trackedEntities",id:e,params:{program:r,fields:["enrollments[*,!attributes],attributes"]}},{enabled:!!e&&!!r&&!!t,staleTime:0,cacheTime:0}),u={reference:d,enrollment:null===d||void 0===d||null===(n=d.enrollments)||void 0===n?void 0:n.find((e=>e.enrollment===t)),attributeValues:null===d||void 0===d?void 0:d.attributes};(0,y.useEffect)((()=>{var e,t;u.reference&&a((e=u.enrollment,t=u.attributeValues.map((e=>{let{attribute:t,value:r}=e;return{id:t,value:r}})),l(Ss.COMMON_ENROLLMENT_SITE_DATA_SET)({enrollment:e,attributeValues:t})))}),[a,u.reference,u.enrollment,u.attributeValues]);return{error:c,...t===o?{enrollment:i,attributeValues:s}:{enrollment:void 0,attributeValues:void 0}}},Ls=Object.freeze({ASSIGN_VALUE:"ASSIGN",HIDE_FIELD:"HIDEFIELD",SHOW_ERROR:"SHOWERROR",SHOW_WARNING:"SHOWWARNING",SHOW_ERROR_ONCOMPLETE:"ERRORONCOMPLETE",SHOW_WARNING_ONCOMPLETE:"WARNINGONCOMPLETE",HIDE_PROGRAM_STAGE:"HIDEPROGRAMSTAGE",HIDE_SECTION:"HIDESECTION",MAKE_COMPULSORY:"SETMANDATORYFIELD",DISPLAY_TEXT:"DISPLAYTEXT",DISPLAY_KEY_VALUE_PAIR:"DISPLAYKEYVALUEPAIR",HIDE_OPTION_GROUP:"HIDEOPTIONGROUP",HIDE_OPTION:"HIDEOPTION",SHOW_OPTION_GROUP:"SHOWOPTIONGROUP",SCHEDULE_MESSAGE:"SCHEDULEMESSAGE",SEND_MESSAGE:"SENDMESSAGE"}),Fs="dataElement",xs="trackedEntityAttribute",Ms="dataElementId",Vs="trackedEntityAttributeId",js={TEXT:"TEXT",MULTI_TEXT:"MULTI_TEXT",LONG_TEXT:"LONG_TEXT",LETTER:"LETTER",PHONE_NUMBER:"PHONE_NUMBER",EMAIL:"EMAIL",BOOLEAN:"BOOLEAN",TRUE_ONLY:"TRUE_ONLY",DATE:"DATE",DATETIME:"DATETIME",TIME:"TIME",NUMBER:"NUMBER",PERCENTAGE:"PERCENTAGE",INTEGER:"INTEGER",INTEGER_POSITIVE:"INTEGER_POSITIVE",INTEGER_NEGATIVE:"INTEGER_NEGATIVE",INTEGER_ZERO_OR_POSITIVE:"INTEGER_ZERO_OR_POSITIVE",USERNAME:"USERNAME",COORDINATE:"COORDINATE",ORGANISATION_UNIT:"ORGANISATION_UNIT",AGE:"AGE",URL:"URL",FILE_RESOURCE:"FILE_RESOURCE",IMAGE:"IMAGE"},Gs={[js.TEXT]:"convertText",[js.MULTI_TEXT]:"convertMultiText",[js.LONG_TEXT]:"convertLongText",[js.LETTER]:"convertLetter",[js.PHONE_NUMBER]:"convertPhoneNumber",[js.EMAIL]:"convertEmail",[js.BOOLEAN]:"convertBoolean",[js.TRUE_ONLY]:"convertTrueOnly",[js.DATE]:"convertDate",[js.DATETIME]:"convertDateTime",[js.TIME]:"convertTime",[js.NUMBER]:"convertNumber",[js.INTEGER]:"convertInteger",[js.INTEGER_POSITIVE]:"convertIntegerPositive",[js.INTEGER_NEGATIVE]:"convertIntegerNegative",[js.INTEGER_ZERO_OR_POSITIVE]:"convertIntegerZeroOrPositive",[js.PERCENTAGE]:"convertPercentage",[js.URL]:"convertUrl",[js.AGE]:"convertAge",[js.FILE_RESOURCE]:"convertFile",[js.ORGANISATION_UNIT]:"convertOrganisationUnit",[js.IMAGE]:"convertImage",[js.USERNAME]:"convertUserName",[js.COORDINATE]:"convertCoordinate"},Bs=Object.freeze({WebClient:"WebClient",AndroidClient:"AndroidClient",Server:"Server"});class $s{static getName(e,t,r){if(e){if(r===js.MULTI_TEXT){const r=t.split(","),n=e.reduce(((e,t)=>r.includes(t.code)?e.concat(t.displayName):e),[]);return 0!==n.length?n.join(","):t}const n=e.find((e=>e.code===t));return n&&n.displayName||t}return t}}const Ws="#",Hs="A",zs="V",Ys="C",qs="#",Ks=Object.freeze({ACTIVE:"ACTIVE",COMPLETED:"COMPLETED",VISITED:"VISITED",SCHEDULE:"SCHEDULE",OVERDUE:"OVERDUE",SKIPPED:"SKIPPED"}),Qs=e=>(0,ki.A)(e)?isNaN(e)?(S().warn(`rule execution service could not convert ${e} to number`),null):Number(e):e,Xs=e=>(0,ki.A)(e)?"true"===e:e,Js=e=>e.toString(),Zs=(e,t)=>{const r={[js.BOOLEAN]:Xs,[js.TRUE_ONLY]:Xs,[js.PERCENTAGE]:Js,[js.INTEGER]:Qs,[js.INTEGER_NEGATIVE]:Qs,[js.INTEGER_POSITIVE]:Qs,[js.INTEGER_ZERO_OR_POSITIVE]:Qs,[js.NUMBER]:Qs,[js.AGE]:Js,[js.TEXT]:Js,[js.LONG_TEXT]:Js,[js.MULTI_TEXT]:Js};return e||0===e||!1===e?r[t]?r[t](e):e:null},el={[js.TEXT]:"",[js.LONG_TEXT]:"",[js.PHONE_NUMBER]:"",[js.EMAIL]:"",[js.BOOLEAN]:!1,[js.TRUE_ONLY]:!1,[js.DATE]:"",[js.DATETIME]:"",[js.TIME]:"",[js.NUMBER]:0,[js.PERCENTAGE]:0,[js.INTEGER]:0,[js.INTEGER_POSITIVE]:0,[js.INTEGER_NEGATIVE]:0,[js.INTEGER_ZERO_OR_POSITIVE]:0,[js.USERNAME]:"",[js.COORDINATE]:"",[js.ORGANISATION_UNIT]:"",[js.AGE]:"",[js.URL]:"",[js.FILE_RESOURCE]:"",[js.IMAGE]:""},tl={DATAELEMENT_CURRENT_EVENT:"DATAELEMENT_CURRENT_EVENT",DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE:"DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE",DATAELEMENT_NEWEST_EVENT_PROGRAM:"DATAELEMENT_NEWEST_EVENT_PROGRAM",DATAELEMENT_PREVIOUS_EVENT:"DATAELEMENT_PREVIOUS_EVENT"},rl={TEI_ATTRIBUTE:"TEI_ATTRIBUTE"},nl={...tl,...rl,CALCULATED_VALUE:"CALCULATED_VALUE"};class al{constructor(e,t,r){this.environment=r,this.onProcessValue=e,al.dateUtils=t,this.mapSourceTypeToGetterFn={[nl.DATAELEMENT_CURRENT_EVENT]:this.getVariableForCurrentEvent,[nl.DATAELEMENT_NEWEST_EVENT_PROGRAM]:this.getVariableForNewestEventProgram,[nl.DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE]:this.getVariableForNewestEventProgramStage,[nl.DATAELEMENT_PREVIOUS_EVENT]:this.getVariableForPreviousEventProgram,[nl.TEI_ATTRIBUTE]:this.getVariableForSelectedEntityAttributes,[nl.CALCULATED_VALUE]:this.getVariableForCalculatedValue},this.defaultValues=el,this.structureEvents=((e,t)=>{const r=(r,n)=>e(t(r.occurredAt,js.DATE),t(n.occurredAt,js.DATE))||e(t(r.createdAt,js.DATETIME),t(n.createdAt,js.DATETIME));return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).filter((t=>t.occurredAt&&[Ks.COMPLETED,Ks.ACTIVE,Ks.VISITED].includes(t.status)&&t.eventId!==e.eventId));return(e=>{const t=e.reduce(((e,t)=>(e[t.programStageId]=e[t.programStageId]||[],e[t.programStageId].push(t),e)),{});return{all:e,byStage:t}})((Object.keys(e).length?t.concat(e):t).sort(r))}})(t.compareDates,e)}getVariables(e){let{programRuleVariables:t,currentEvent:r,otherEvents:n,dataElements:a,selectedEntity:o,trackedEntityAttributes:i,selectedEnrollment:s,selectedOrgUnit:l,optionSets:d,constants:c}=e;const u={executingEvent:r,eventsContainer:this.structureEvents(r,n),dataElements:a,selectedEntity:o,trackedEntityAttributes:i,selectedEnrollment:s,optionSets:d,selectedOrgUnit:l};return{...{...(null!==t&&void 0!==t?t:[]).reduce(((e,t)=>{let r;const n=t.displayName,o=t.programRuleVariableSourceType,s=this.mapSourceTypeToGetterFn[o];return s?(tl[o]?r=this.preCheckDataElementSpecificSourceType(t,a):rl[o]&&(r=this.preCheckTrackedEntitySpecificSourceType(t,i)),r?(e[n]=r,e):(r=s.bind(this)(t,u),r||tl[o]&&(r=this.postGetVariableForDataElementSpecificSourceType(t,a)),r&&(e[n]=r),e)):(S().error(`Unknown programRuleVariableSourceType:${t.programRuleVariableSourceType}`),r=this.buildVariable(null,js.TEXT,{variablePrefix:Ws,useNameForOptionSet:t.useNameForOptionSet}),e[n]=r,e)}),{}),...this.getContextVariables(u)},...this.getConstantVariables(c)}}updateVariable(e,t,r){const n=e.replace("#{","").replace("A{","").replace(/}/g,""),a=r[n];if(a){const{variableType:e}=a,o=null===t?this.defaultValues[e]:Zs(t,e);r[n]={...a,variableValue:o,hasValue:null!==t,variableEventDate:"",variablePrefix:a.variablePrefix||"#",allValues:[o]}}else S().warn(`Variable ${n} was not defined.`)}buildVariable(e,t,r){let{variablePrefix:n,allValues:a,variableEventDate:o,useNameForOptionSet:i=!1}=r;return{variableValue:null!==e&&void 0!==e?e:this.defaultValues[t],useCodeForOptionSet:!i,variableType:t||js.TEXT,hasValue:null!==e,variableEventDate:o,variablePrefix:n,allValues:a}}preCheckDataElementSpecificSourceType(e,t){const r=e.dataElementId;return r&&t&&t[r]?null:(S().warn(`Variable id:${e.id} name:${e.displayName} contains an invalid dataelement id (id: ${r||""})`),this.buildVariable(null,js.TEXT,{variablePrefix:Ws,useNameForOptionSet:e.useNameForOptionSet}))}preCheckTrackedEntitySpecificSourceType(e,t){const r=e.trackedEntityAttributeId;return r&&t&&t[r]?null:(S().warn(`Variable id:${e.id} name:${e.displayName} contains an invalid trackedEntityAttribute id (id: ${r||""})`),this.buildVariable(null,js.TEXT,{variablePrefix:Hs,useNameForOptionSet:e.useNameForOptionSet}))}postGetVariableForDataElementSpecificSourceType(e,t){const r=t[e.dataElementId];return this.buildVariable(null,r.valueType,{variablePrefix:Ws,useNameForOptionSet:e.useNameForOptionSet})}getVariableValue(e,t,r,n,a,o){const i=this.onProcessValue(e,t);return null!==i&&n&&a&&a[r]&&a[r].optionSetId?$s.getName(o[a[r].optionSetId].options,i,a[r].valueType):i}getVariableForCalculatedValue(e){return this.buildVariable(null,e.valueType,{variablePrefix:qs,useNameForOptionSet:e.useNameForOptionSet})}getVariableForSelectedEntityAttributes(e,t){const r=e.trackedEntityAttributeId,n=t.trackedEntityAttributes[r],a=t.selectedEntity?t.selectedEntity[r]:null,o=e.useNameForOptionSet&&n.optionSetId?"TEXT":n.valueType,i=this.getVariableValue(a,o,r,e.useNameForOptionSet,t.trackedEntityAttributes,t.optionSets);return this.buildVariable(i,o,{variablePrefix:Hs,useNameForOptionSet:e.useNameForOptionSet})}getVariableForCurrentEvent(e,t){const r=e.dataElementId,n=t.dataElements[r],a=t.executingEvent;if(!a)return null;const o=a&&a[r],i=e.useNameForOptionSet&&n.optionSetId?"TEXT":n.valueType,s=this.getVariableValue(o,i,r,e.useNameForOptionSet,t.dataElements,t.optionSets);return this.buildVariable(s,i,{variablePrefix:Ws,variableEventDate:this.onProcessValue(a.occurredAt,js.DATE),useNameForOptionSet:e.useNameForOptionSet})}getVariableForNewestEventProgramStage(e,t){const r=e.programStageId;if(!r)return S().warn(`Variable id:${e.id} name:${e.displayName} does not have a programstage defined, despite that the variable has sourcetype${e.programRuleVariableSourceType}`),null;const n=t.eventsContainer&&t.eventsContainer.byStage[r];return n?this.getVariableContainingAllValues(e,t,n):null}getVariableForNewestEventProgram(e,t){const r=t.eventsContainer&&t.eventsContainer.all;return r&&0!==r.length?this.getVariableContainingAllValues(e,t,r):null}getVariableForPreviousEventProgram(e,t){const r=t.eventsContainer&&t.eventsContainer.all;if(!r||0===r.length)return null;const n=t.executingEvent;if(!n)return null;const a=r.findIndex((e=>e.eventId===n.eventId));return a-1<0?null:this.getVariableContainingAllValues(e,t,r.slice(0,a))}getVariableContainingAllValues(e,t,r){const n=e.dataElementId,a=t.dataElements[n],o=e.useNameForOptionSet&&a.optionSetId?"TEXT":a.valueType,i=r.map((r=>this.getVariableValue(r[n],o,n,e.useNameForOptionSet,t.dataElements,t.optionSets))).filter((e=>null!==e)),s=[...r].reverse().find((r=>null!==this.getVariableValue(r[n],o,n,e.useNameForOptionSet,t.dataElements,t.optionSets)));if(!s)return null;const l=this.getVariableValue(s[n],o,n,e.useNameForOptionSet,t.dataElements,t.optionSets);return this.buildVariable(l,o,{variablePrefix:Ws,variableEventDate:this.onProcessValue(s.occurredAt,js.DATE),useNameForOptionSet:e.useNameForOptionSet,allValues:i})}buildContextVariable(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.variablePrefix=zs,this.buildVariable(this.onProcessValue(e,t),t,r)}buildRawContextVariable(e,t){return this.buildVariable(e,t,{variablePrefix:zs})}getContextVariables(e){let t={};return t.environment=this.buildRawContextVariable(this.environment,js.TEXT),t.current_date=this.buildRawContextVariable(al.dateUtils.getToday(),js.DATE),t={...t,...this.getEventContextVariables(e.executingEvent,e.eventsContainer),...this.getEnrollmentContextVariables(e.selectedEnrollment),...this.getOrganisationContextVariables(e.selectedOrgUnit)},t}getEventContextVariables(e,t){const r={};return e&&(r.event_date=this.buildContextVariable(e.occurredAt,js.DATE),r.due_date=this.buildContextVariable(e.scheduledAt,js.DATE),r.completed_date=this.buildContextVariable(e.completedAt,js.DATE),r.event_id=this.buildContextVariable(e.eventId,js.TEXT,{variableEventDate:this.onProcessValue(e.occurredAt,js.DATE)}),r.event_status=this.buildContextVariable(e.status,js.TEXT),r.program_stage_id=this.buildContextVariable(e.programStageId,js.TEXT),r.program_stage_name=this.buildContextVariable(e.programStageName,js.TEXT)),t&&(r.event_count=this.buildRawContextVariable(t.all&&t.all.length||0,js.INTEGER)),r}getEnrollmentContextVariables(e){const t={};return e&&(t.enrollment_date=this.buildContextVariable(e.enrolledAt,js.DATE),t.enrollment_id=this.buildContextVariable(e.enrollmentId,js.TEXT),t.enrollment_count=this.buildRawContextVariable(1,js.INTEGER),t.tei_count=this.buildRawContextVariable(1,js.INTEGER),t.incident_date=this.buildContextVariable(e.occurredAt,js.DATE)),t}getOrganisationContextVariables(e){const t={};return t.orgunit_code=this.buildContextVariable(null===e||void 0===e?void 0:e.code,js.TEXT),t}getConstantVariables(e){return e?e.reduce(((e,t)=>(e[t.id]=this.buildVariable(t.value,js.INTEGER,{variablePrefix:Ys}),e)),{}):{}}}const ol=e=>t=>({...t,message:e});class il{constructor(e){this.converterObject=e,this.processValue=this.processValue.bind(this)}processValue(e,t){if(!js[t])return S().warn(il.errorMessages.TYPE_NOT_SUPPORTED),"";const r=Gs[t];if(!r)return S().warn(ol(il.errorMessages.CONVERTER_NOT_FOUND)({type:t})),e;const n=this.converterObject[r]?this.converterObject[r](e):e;return null!==n&&void 0!==n?n:null}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(il,"errorMessages",{TYPE_NOT_SUPPORTED:"value type not supported",CONVERTER_NOT_FOUND:"converter for type is missing"});const sl=["number","boolean"],ll=e=>{const t=null!=e?e:"",r=typeof t;return"string"===r?`"${t.replace(/"/g,"'")}"`:sl.includes(r)?t.toString():(!1).toString()},dl=(e,t)=>{if(!e.includes("{"))return e;const r=(e=>{const t=new RegExp(`(${["d2:hasValue","d2:lastEventDate","d2:count","d2:countIfZeroPos","d2:countIfValue"].join("|")})\\( *([A#CV]{[\\w -_]+})( *, *(([\\d/\\*\\+\\-%. ]+)|'[^']*'|"[^"]*"))* *\\)`,"g");return(e.match(t)||[]).reduce(((e,t)=>{const r=t.replace("#{","'").replace("A{","'").replace("C{","'").replace("V{","'").replace("}","'");return e.replace(t,r)}),e)})(e);if(!r.includes("{"))return r;return(r.match(/[A#CV]\{[\w -_]+}/g)||[]).reduce(((e,r)=>{const n=r.replace("#{","").replace("A{","").replace("C{","").replace("V{","").replace("}",""),a=t[n];return a?e.replace(r,ll(a.variableValue)):(o=e,i=n,S().warn(`Expression ${o} contains context variable ${i} \n- but this variable is not defined.`),e.replace(r,ll("")));var o,i}),r)};function cl(e){return new Function(`"use strict";return ${e.replace(/\n/g,"\\n")}`)()}const ul=(e,t,r)=>{let{dhisFunctionsObject:n,applicableDhisFunctions:a}=e,{expression:o,expressionModuloStrings:i}=t;const s="d2:",l=a.filter((e=>{let{name:t}=e;return i.includes(`${s+t}(`)}));if(!l.length)return cl(o);const d=l.map((e=>{let{name:t}=e;return t})).join("|"),c=new RegExp(`\\b${s}(?:${d})\\(`,"g"),u=[...o.matchAll(c)],{accExpression:p,currentExpressionIndex:m}=u.reduce(((e,t)=>{let{accExpression:a,currentExpressionIndex:d}=e;if(t.index<d)return{accExpression:a,currentExpressionIndex:d};a+=o.substring(d,t.index);const{args:c,closingIndex:u}=((e,t,r)=>{const{argIndexes:n,closingIndex:a}=((e,t,r)=>{let n=t.indexOf("(",r)+1,a=n,o=1;const i=[];for(;n<e.length;n+=1)if("("===t[n])o+=1;else if(")"===t[n]){if(o-=1,0===o){i.push([a,n]);break}}else 1===o&&","===t[n]&&(i.push([a,n]),a=n+1);return{argIndexes:i,closingIndex:n}})(e,t,r);return{args:n.map((r=>{let[n,a]=r;return{argument:e.substring(n,a),argumentModuloStrings:t.substring(n,a)}})),closingIndex:a}})(o,i,t.index),p=c.map((e=>{let{argument:t,argumentModuloStrings:a}=e;return ul({dhisFunctionsObject:n,applicableDhisFunctions:l},{expression:t,expressionModuloStrings:a},r)})),m=((e,t)=>e.substring(t.length,e.length-1))(t[0],s),g=n[m];if(((e,t)=>{if(e){const r=t.length||0;return"number"===typeof e?r!==e:r<e.min||e.max<r}return!1})(g.parameters,p))r(`${m} was not passed valid arguments`,o),a+="false";else{const e=g.execute(p);a+=ll(e)}return{accExpression:a,currentExpressionIndex:u+1}}),{accExpression:"",currentExpressionIndex:0});return cl(p+o.substring(m,o.length))},pl=e=>{let{expression:t,dhisFunctions:r,variablesHash:n,flags:a={},onError:o,onVerboseLog:i}=e;const s=dl(t,n);let l=!1;try{const e=s.replace(/'[^']*'|"[^"]*"/g,(e=>" ".repeat(e.length))),t=Object.entries(r).map((e=>{let[t,r]=e;return{...r,name:t}}));l=ul({dhisFunctionsObject:r,applicableDhisFunctions:t},((e,t)=>{const r=t.split(/\n+/g);return{expression:r.reduce(((e,t)=>{let{reducedExpression:r,remainder:n}=e;return n=n.replace(/^\n*/,""),r+=n.substring(0,t.length),{reducedExpression:r,remainder:n.substring(t.length)}}),{reducedExpression:"",remainder:e}).reducedExpression,expressionModuloStrings:r.join("")}})(s,e),o),a.verbose&&i(s,l)}catch(d){o(d.message,s,l)}return l},ml={male:1,MALE:1,Male:1,ma:1,m:1,M:1,0:1,false:1},gl={0:[2,2.4,2.8,3.2,3.7,4.2,4.8],1:[2.7,3.2,3.6,4.2,4.8,5.5,6.2],2:[3.4,3.9,4.5,5.1,5.8,6.6,7.5],3:[4,4.5,5.2,5.8,6.6,7.5,8.5],4:[4.4,5,5.7,6.4,7.3,8.2,9.3],5:[4.8,5.4,6.1,6.9,7.8,8.8,10],6:[5.1,5.7,6.5,7.3,8.2,9.3,10.6],7:[5.3,6,6.8,7.6,8.6,9.8,11.1],8:[5.6,6.3,7,7.9,9,10.2,11.6],9:[5.8,6.5,7.3,8.2,9.3,10.5,12],10:[5.9,6.7,7.5,8.5,9.6,10.9,12.4],11:[6.1,6.9,7.7,8.7,9.9,11.2,12.8],12:[6.3,7,7.9,8.9,10.1,11.5,13.1],13:[6.4,7.2,8.1,9.2,10.4,11.8,13.5],14:[6.6,7.4,8.3,9.4,10.6,12.1,13.8],15:[6.7,7.6,8.5,9.6,10.9,12.4,14.1],16:[6.9,7.7,8.7,9.8,11.1,12.6,14.5],17:[7,7.9,8.9,10,11.4,12.9,14.8],18:[7.2,8.1,9.1,10.2,11.6,13.2,15.1],19:[7.3,8.2,9.2,10.4,11.8,13.5,15.4],20:[7.5,8.4,9.4,10.6,12.1,13.7,15.7],21:[7.6,8.6,9.6,10.9,12.3,14,16],22:[7.8,8.7,9.8,11.1,12.5,14.3,16.4],23:[7.9,8.9,10,11.3,12.8,14.6,16.7],24:[8.1,9,10.2,11.5,13,14.8,17],25:[8.2,9.2,10.3,11.7,13.3,15.1,17.3],26:[8.4,9.4,10.5,11.9,13.5,15.4,17.7],27:[8.5,9.5,10.7,12.1,13.7,15.7,18],28:[8.6,9.7,10.9,12.3,14,16,18.3],29:[8.8,9.8,11.1,12.5,14.2,16.2,18.7],30:[8.9,10,11.2,12.7,14.4,16.5,19],31:[9,10.1,11.4,12.9,14.7,16.8,19.3],32:[9.1,10.3,11.6,13.1,14.9,17.1,19.6],33:[9.3,10.4,11.7,13.3,15.1,17.3,20],34:[9.4,10.5,11.9,13.5,15.4,17.6,20.3],35:[9.5,10.7,12,13.7,15.6,17.9,20.6],36:[9.6,10.8,12.2,13.9,15.8,18.1,20.9],37:[9.7,10.9,12.4,14,16,18.4,21.3],38:[9.8,11.1,12.5,14.2,16.3,18.7,21.6],39:[9.9,11.2,12.7,14.4,16.5,19,22],40:[10.1,11.3,12.8,14.6,16.7,19.2,22.3],41:[10.2,11.5,13,14.8,16.9,19.5,22.7],42:[10.3,11.6,13.1,15,17.2,19.8,23],43:[10.4,11.7,13.3,15.2,17.4,20.1,23.4],44:[10.5,11.8,13.4,15.3,17.6,20.4,23.7],45:[10.6,12,13.6,15.5,17.8,20.7,24.1],46:[10.7,12.1,13.7,15.7,18.1,20.9,24.5],47:[10.8,12.2,13.9,15.9,18.3,21.2,24.8],48:[10.9,12.3,14,16.1,18.5,21.5,25.2],49:[11,12.4,14.2,16.3,18.8,21.8,25.5],50:[11.1,12.6,14.3,16.4,19,22.1,25.9],51:[11.2,12.7,14.5,16.6,19.2,22.4,26.3],52:[11.3,12.8,14.6,16.8,19.4,22.6,26.6],53:[11.4,12.9,14.8,17,19.7,22.9,27],54:[11.5,13,14.9,17.2,19.9,23.2,27.4],55:[11.6,13.2,15.1,17.3,20.1,23.5,27.7],56:[11.7,13.3,15.2,17.5,20.3,23.8,28.1],57:[11.8,13.4,15.3,17.7,20.6,24.1,28.5],58:[11.9,13.5,15.5,17.9,20.8,24.4,28.8],59:[12,13.6,15.6,18,21,24.6,29.2],60:[12.1,13.7,15.8,18.2,21.2,24.9,29.5]},hl={0:[2.1,2.5,2.9,3.3,3.9,4.4,5],1:[2.9,3.4,3.9,4.5,5.1,5.8,6.6],2:[3.8,4.3,4.9,5.6,6.3,7.1,8],3:[4.4,5,5.7,6.4,7.2,8,9],4:[4.9,5.6,6.2,7,7.8,8.7,9.7],5:[5.3,6,6.7,7.5,8.4,9.3,10.4],6:[5.7,6.4,7.1,7.9,8.8,9.8,10.9],7:[5.9,6.7,7.4,8.3,9.2,10.3,11.4],8:[6.2,6.9,7.7,8.6,9.6,10.7,11.9],9:[6.4,7.1,8,8.9,9.9,11,12.3],10:[6.6,7.4,8.2,9.2,10.2,11.4,12.7],11:[6.8,7.6,8.4,9.4,10.5,11.7,13],12:[6.9,7.7,8.6,9.6,10.8,12,13.3],13:[7.1,7.9,8.8,9.9,11,12.3,13.7],14:[7.2,8.1,9,10.1,11.3,12.6,14],15:[7.4,8.3,9.2,10.3,11.5,12.8,14.3],16:[7.5,8.4,9.4,10.5,11.7,13.1,14.6],17:[7.7,8.6,9.6,10.7,12,13.4,14.9],18:[7.8,8.8,9.8,10.9,12.2,13.7,15.3],19:[8,8.9,10,11.1,12.5,13.9,15.6],20:[8.1,9.1,10.1,11.3,12.7,14.2,15.9],21:[8.2,9.2,10.3,11.5,12.9,14.5,16.2],22:[8.4,9.4,10.5,11.8,13.2,14.7,16.5],23:[8.5,9.5,10.7,12,13.4,15,16.8],24:[8.6,9.7,10.8,12.2,13.6,15.3,17.1],25:[8.8,9.8,11,12.4,13.9,15.5,17.5],26:[8.9,10,11.2,12.5,14.1,15.8,17.8],27:[9,10.1,11.3,12.7,14.3,16.1,18.1],28:[9.1,10.2,11.5,12.9,14.5,16.3,18.4],29:[9.2,10.4,11.7,13.1,14.8,16.6,18.7],30:[9.4,10.5,11.8,13.3,15,16.9,19],31:[9.5,10.7,12,13.5,15.2,17.1,19.3],32:[9.6,10.8,12.1,13.7,15.4,17.4,19.6],33:[9.7,10.9,12.3,13.8,15.6,17.6,19.9],34:[9.8,11,12.4,14,15.8,17.8,20.2],35:[9.9,11.2,12.6,14.2,16,18.1,20.4],36:[10,11.3,12.7,14.3,16.2,18.3,20.7],37:[10.1,11.4,12.9,14.5,16.4,18.6,21],38:[10.2,11.5,13,14.7,16.6,18.8,21.3],39:[10.3,11.6,13.1,14.8,16.8,19,21.6],40:[10.4,11.8,13.3,15,17,19.3,21.9],41:[10.5,11.9,13.4,15.2,17.2,19.5,22.1],42:[10.6,12,13.6,15.3,17.4,19.7,22.4],43:[10.7,12.1,13.7,15.5,17.6,20,22.7],44:[10.8,12.2,13.8,15.7,17.8,20.2,23],45:[10.9,12.4,14,15.8,18,20.5,23.3],46:[11,12.5,14.1,16,18.2,20.7,23.6],47:[11.1,12.6,14.3,16.2,18.4,20.9,23.9],48:[11.2,12.7,14.4,16.3,18.6,21.2,24.2],49:[11.3,12.8,14.5,16.5,18.8,21.4,24.5],50:[11.4,12.9,14.7,16.7,19,21.7,24.8],51:[11.5,13.1,14.8,16.8,19.2,21.9,25.1],52:[11.6,13.2,15,17,19.4,22.2,25.4],53:[11.7,13.3,15.1,17.2,19.6,22.4,25.7],54:[11.8,13.4,15.2,17.3,19.8,22.7,26],55:[11.9,13.5,15.4,17.5,20,22.9,26.3],56:[12,13.6,15.5,17.7,20.2,23.2,26.6],57:[12.1,13.7,15.6,17.8,20.4,23.4,26.9],58:[12.2,13.8,15.8,18,20.6,23.7,27.2],59:[12.3,14,15.9,18.2,20.8,23.9,27.6],60:[12.4,14.1,16,18.3,21,24.2,27.9]},El={45:[1.902,2.066,2.252,2.461,2.698,2.967,3.275],45.5:[1.967,2.138,2.329,2.546,2.791,3.07,3.389],46:[2.033,2.209,2.407,2.631,2.884,3.172,3.502],46.5:[2.098,2.28,2.485,2.716,2.977,3.275,3.616],47:[2.164,2.351,2.562,2.801,3.071,3.378,3.73],47.5:[2.23,2.423,2.641,2.887,3.165,3.482,3.845],48:[2.297,2.497,2.721,2.974,3.261,3.588,3.962],48.5:[2.366,2.571,2.803,3.064,3.359,3.696,4.082],49:[2.437,2.649,2.887,3.156,3.461,3.808,4.205],49.5:[2.511,2.729,2.975,3.252,3.566,3.924,4.334],50:[2.588,2.813,3.066,3.352,3.676,4.045,4.467],50.5:[2.668,2.9,3.161,3.456,3.79,4.171,4.606],51:[2.75,2.99,3.259,3.564,3.908,4.301,4.751],51.5:[2.836,3.084,3.362,3.675,4.031,4.437,4.901],52:[2.925,3.18,3.467,3.791,4.158,4.577,5.056],52.5:[3.017,3.28,3.576,3.91,4.29,4.721,5.216],53:[3.112,3.383,3.688,4.033,4.424,4.87,5.38],53.5:[3.208,3.488,3.803,4.159,4.563,5.022,5.549],54:[3.307,3.596,3.921,4.288,4.704,5.178,5.721],54.5:[3.407,3.705,4.04,4.418,4.847,5.336,5.896],55:[3.508,3.815,4.16,4.55,4.992,5.496,6.073],55.5:[3.611,3.926,4.281,4.683,5.138,5.657,6.251],56:[3.713,4.038,4.403,4.816,5.285,5.818,6.43],56.5:[3.816,4.15,4.526,4.95,5.432,5.98,6.609],57:[3.919,4.262,4.648,5.084,5.579,6.143,6.789],57.5:[4.021,4.373,4.77,5.217,5.725,6.304,6.968],58:[4.124,4.485,4.891,5.351,5.872,6.466,7.146],58.5:[4.226,4.596,5.013,5.483,6.018,6.626,7.324],59:[4.327,4.706,5.133,5.615,6.162,6.786,7.5],59.5:[4.427,4.815,5.252,5.745,6.305,6.944,7.675],60:[4.527,4.923,5.37,5.874,6.447,7.099,7.847],60.5:[4.624,5.03,5.486,6.001,6.586,7.253,8.017],61:[4.721,5.135,5.601,6.127,6.724,7.405,8.185],61.5:[4.817,5.239,5.714,6.251,6.86,7.555,8.351],62:[4.912,5.342,5.826,6.374,6.995,7.703,8.514],62.5:[5.005,5.444,5.937,6.495,7.128,7.849,8.675],63:[5.098,5.544,6.047,6.614,7.259,7.993,8.834],63.5:[5.189,5.644,6.155,6.733,7.388,8.136,8.992],64:[5.28,5.742,6.262,6.85,7.517,8.277,9.148],64.5:[5.37,5.84,6.369,6.966,7.644,8.417,9.302],65:[5.459,5.937,6.474,7.081,7.77,8.555,9.454],65.5:[5.547,6.033,6.578,7.195,7.895,8.692,9.605],66:[5.635,6.128,6.682,7.308,8.018,8.827,9.753],66.5:[5.721,6.221,6.784,7.419,8.139,8.96,9.901],67:[5.807,6.314,6.885,7.529,8.26,9.092,10.046],67.5:[5.892,6.406,6.984,7.638,8.378,9.222,10.189],68:[5.975,6.497,7.083,7.745,8.496,9.351,10.33],68.5:[6.058,6.586,7.18,7.851,8.611,9.478,10.47],69:[6.14,6.675,7.277,7.956,8.726,9.603,10.608],69.5:[6.221,6.763,7.372,8.06,8.84,9.728,10.745],70:[6.302,6.85,7.467,8.163,8.952,9.851,10.88],70.5:[6.382,6.937,7.561,8.265,9.064,9.973,11.014],71:[6.461,7.023,7.654,8.367,9.174,10.094,11.147],71.5:[6.54,7.108,7.747,8.468,9.285,10.215,11.279],72:[6.619,7.193,7.839,8.568,9.394,10.334,11.41],72.5:[6.697,7.278,7.931,8.667,9.502,10.453,11.54],73:[6.774,7.361,8.021,8.766,9.61,10.571,11.669],73.5:[6.851,7.444,8.111,8.864,9.716,10.687,11.797],74:[6.927,7.526,8.2,8.96,9.821,10.801,11.922],74.5:[7.001,7.607,8.287,9.055,9.925,10.915,12.046],75:[7.075,7.687,8.374,9.149,10.027,11.026,12.168],75.5:[7.148,7.766,8.459,9.242,10.128,11.136,12.289],76:[7.221,7.844,8.544,9.334,10.228,11.246,12.408],76.5:[7.293,7.922,8.628,9.425,10.328,11.354,12.527],77:[7.365,7.999,8.712,9.517,10.427,11.463,12.646],77.5:[7.437,8.078,8.797,9.609,10.527,11.572,12.765],78:[7.511,8.157,8.883,9.702,10.628,11.682,12.886],78.5:[7.585,8.237,8.97,9.796,10.731,11.794,13.008],79:[7.66,8.319,9.058,9.892,10.835,11.907,13.132],79.5:[7.737,8.402,9.148,9.989,10.941,12.023,13.26],80:[7.816,8.487,9.24,10.089,11.05,12.142,13.389],80.5:[7.897,8.574,9.335,10.192,11.161,12.264,13.523],81:[7.979,8.663,9.431,10.296,11.276,12.388,13.659],81.5:[8.064,8.755,9.53,10.404,11.393,12.517,13.8],82:[8.15,8.848,9.631,10.514,11.513,12.647,13.943],82.5:[8.238,8.943,9.735,10.626,11.635,12.781,14.09],83:[8.328,9.04,9.84,10.741,11.76,12.918,14.24],83.5:[8.419,9.139,9.947,10.858,11.888,13.058,14.393],84:[8.512,9.24,10.057,10.977,12.017,13.2,14.549],84.5:[8.606,9.342,10.167,11.097,12.149,13.344,14.708],85:[8.702,9.445,10.28,11.22,12.283,13.491,14.869],85.5:[8.798,9.55,10.393,11.344,12.418,13.639,15.033],86:[8.895,9.655,10.508,11.468,12.555,13.789,15.197],86.5:[8.993,9.761,10.623,11.594,12.692,13.94,15.363],87:[9.227,10.015,10.9,11.896,13.024,14.304,15.765],87.5:[9.324,10.121,11.015,12.022,13.161,14.455,15.932],88:[9.421,10.226,11.13,12.148,13.299,14.607,16.099],88.5:[9.518,10.331,11.244,12.273,13.436,14.758,16.266],89:[9.614,10.436,11.358,12.398,13.573,14.909,16.433],89.5:[9.709,10.54,11.472,12.522,13.71,15.059,16.6],90:[9.805,10.644,11.585,12.646,13.846,15.21,16.767],90.5:[9.9,10.747,11.698,12.77,13.983,15.36,16.933],91:[9.994,10.85,11.811,12.894,14.119,15.511,17.1],91.5:[10.089,10.953,11.924,13.018,14.255,15.662,17.267],92:[10.183,11.056,12.037,13.142,14.392,15.813,17.435],92.5:[10.277,11.159,12.149,13.265,14.528,15.964,17.603],93:[10.372,11.262,12.262,13.39,14.665,16.116,17.772],93.5:[10.466,11.366,12.376,13.514,14.803,16.268,17.942],94:[10.561,11.469,12.489,13.639,14.941,16.421,18.112],94.5:[10.656,11.573,12.603,13.765,15.08,16.576,18.284],95:[10.751,11.678,12.718,13.891,15.22,16.731,18.457],95.5:[10.847,11.783,12.833,14.019,15.361,16.887,18.632],96:[10.943,11.888,12.949,14.147,15.502,17.045,18.808],96.5:[11.04,11.994,13.066,14.276,15.646,17.204,18.986],97:[11.137,12.101,13.184,14.406,15.79,17.365,19.166],97.5:[11.236,12.209,13.303,14.538,15.936,17.528,19.349],98:[11.336,12.319,13.424,14.671,16.084,17.693,19.533],98.5:[11.436,12.429,13.546,14.806,16.235,17.861,19.721],99:[11.538,12.542,13.67,14.943,16.387,18.031,19.913],99.5:[11.642,12.655,13.796,15.083,16.542,18.205,20.107],100:[11.747,12.771,13.924,15.225,16.7,18.381,20.305],100.5:[11.854,12.889,14.053,15.369,16.861,18.561,20.507],101:[11.962,13.008,14.186,15.515,17.024,18.743,20.712],101.5:[12.072,13.13,14.32,15.665,17.19,18.93,20.922],102:[12.184,13.253,14.457,15.816,17.36,19.119,21.136],102.5:[12.298,13.379,14.596,15.971,17.532,19.312,21.352],103:[12.414,13.506,14.737,16.128,17.707,19.508,21.574],103.5:[12.531,13.636,14.88,16.287,17.885,19.708,21.799],104:[12.65,13.767,15.026,16.449,18.066,19.911,22.027],104.5:[12.77,13.9,15.173,16.613,18.249,20.117,22.26],105:[12.893,14.035,15.323,16.78,18.436,20.326,22.496],105.5:[13.017,14.173,15.475,16.95,18.626,20.54,22.737],106:[13.143,14.312,15.63,17.122,18.818,20.756,22.982],106.5:[13.271,14.454,15.787,17.297,19.015,20.977,23.231],107:[13.401,14.598,15.947,17.476,19.214,21.202,23.485],107.5:[13.533,14.744,16.11,17.657,19.417,21.43,23.743],108:[13.667,14.892,16.275,17.841,19.623,21.662,24.006],108.5:[13.803,15.043,16.442,18.028,19.833,21.898,24.273],109:[13.942,15.196,16.612,18.217,20.046,22.138,24.544],109.5:[14.081,15.351,16.784,18.41,20.261,22.38,24.819],110:[14.223,15.508,16.959,18.604,20.479,22.626,25.098],110.5:[14.366,15.666,17.135,18.802,20.701,22.876,25.381],111:[14.511,15.827,17.314,19.001,20.924,23.128,25.666],111.5:[14.657,15.989,17.494,19.202,21.151,23.383,25.956],112:[14.804,16.152,17.676,19.406,21.379,23.642,26.249],112.5:[14.953,16.317,17.86,19.612,21.61,23.902,26.545],113:[15.103,16.484,18.045,19.819,21.843,24.165,26.843],113.5:[15.254,16.652,18.232,20.028,22.078,24.43,27.144],114:[15.406,16.82,18.42,20.238,22.315,24.698,27.448],114.5:[15.559,16.99,18.609,20.45,22.553,24.967,27.754],115:[15.712,17.16,18.799,20.663,22.792,25.238,28.061],115.5:[15.866,17.331,18.99,20.877,23.033,25.51,28.371],116:[16.021,17.503,19.181,21.091,23.274,25.783,28.681],116.5:[16.175,17.674,19.373,21.306,23.516,26.057,28.993],117:[16.329,17.846,19.565,21.521,23.759,26.332,29.307],117.5:[16.484,18.018,19.757,21.737,24.002,26.607,29.621],118:[16.639,18.19,19.95,21.953,24.246,26.883,29.935],118.5:[16.794,18.363,20.142,22.169,24.489,27.16,30.25],119:[16.948,18.534,20.334,22.385,24.734,27.437,30.567],119.5:[17.102,18.706,20.527,22.601,24.977,27.714,30.883],120:[17.256,18.878,20.719,22.817,25.222,27.991,31.199]},yl={45:[1.877,2.043,2.23,2.441,2.68,2.951,3.261],45.5:[1.942,2.114,2.307,2.524,2.771,3.05,3.37],46:[2.008,2.185,2.384,2.608,2.861,3.149,3.477],46.5:[2.074,2.256,2.461,2.691,2.952,3.248,3.585],47:[2.141,2.328,2.539,2.776,3.043,3.347,3.694],47.5:[2.208,2.401,2.617,2.861,3.136,3.448,3.804],48:[2.277,2.476,2.698,2.948,3.231,3.551,3.916],48.5:[2.349,2.552,2.781,3.038,3.328,3.657,4.031],49:[2.422,2.632,2.867,3.131,3.429,3.766,4.151],49.5:[2.499,2.715,2.956,3.228,3.534,3.881,4.275],50:[2.579,2.801,3.049,3.328,3.642,3.999,4.403],50.5:[2.661,2.889,3.144,3.431,3.754,4.12,4.536],51:[2.746,2.981,3.243,3.538,3.87,4.245,4.672],51.5:[2.834,3.075,3.345,3.648,3.989,4.375,4.813],52:[2.925,3.173,3.451,3.762,4.113,4.509,4.958],52.5:[3.02,3.276,3.561,3.881,4.242,4.649,5.111],53:[3.12,3.383,3.677,4.006,4.377,4.795,5.27],53.5:[3.223,3.494,3.796,4.135,4.517,4.947,5.434],54:[3.33,3.609,3.921,4.269,4.661,5.104,5.605],54.5:[3.44,3.727,4.048,4.407,4.81,5.264,5.779],55:[3.553,3.848,4.178,4.547,4.961,5.428,5.957],55.5:[3.667,3.971,4.31,4.689,5.115,5.595,6.138],56:[3.783,4.095,4.444,4.834,5.271,5.764,6.322],56.5:[3.9,4.221,4.579,4.98,5.429,5.935,6.506],57:[4.017,4.347,4.715,5.126,5.587,6.106,6.692],57.5:[4.135,4.474,4.851,5.272,5.745,6.276,6.877],58:[4.252,4.599,4.986,5.418,5.902,6.447,7.061],58.5:[4.369,4.725,5.121,5.563,6.059,6.616,7.245],59:[4.485,4.849,5.255,5.707,6.214,6.784,7.427],59.5:[4.6,4.973,5.387,5.85,6.368,6.951,7.607],60:[4.713,5.094,5.518,5.991,6.52,7.115,7.785],60.5:[4.824,5.213,5.646,6.128,6.669,7.275,7.959],61:[4.932,5.329,5.771,6.263,6.814,7.433,8.13],61.5:[5.039,5.443,5.893,6.395,6.957,7.587,8.297],62:[5.143,5.555,6.014,6.525,7.097,7.739,8.462],62.5:[5.245,5.665,6.132,6.653,7.235,7.888,8.624],63:[5.346,5.774,6.249,6.779,7.371,8.035,8.784],63.5:[5.445,5.88,6.364,6.903,7.505,8.181,8.942],64:[5.544,5.986,6.478,7.026,7.638,8.325,9.098],64.5:[5.64,6.09,6.59,7.147,7.769,8.467,9.253],65:[5.736,6.193,6.701,7.267,7.899,8.608,9.406],65.5:[5.83,6.295,6.811,7.385,8.028,8.748,9.558],66:[5.924,6.396,6.92,7.503,8.156,8.887,9.71],66.5:[6.017,6.496,7.028,7.621,8.283,9.026,9.861],67:[6.109,6.595,7.135,7.737,8.409,9.163,10.011],67.5:[6.2,6.694,7.242,7.853,8.535,9.3,10.161],68:[6.291,6.791,7.348,7.967,8.66,9.436,10.31],68.5:[6.38,6.888,7.453,8.082,8.784,9.572,10.459],69:[6.47,6.985,7.558,8.196,8.908,9.708,10.607],69.5:[6.559,7.081,7.662,8.309,9.032,9.843,10.756],70:[6.647,7.177,7.766,8.423,9.156,9.979,10.905],70.5:[6.735,7.273,7.87,8.536,9.28,10.114,11.053],71:[6.823,7.368,7.973,8.648,9.402,10.248,11.201],71.5:[6.909,7.462,8.075,8.759,9.524,10.382,11.348],72:[6.995,7.555,8.177,8.87,9.645,10.514,11.493],72.5:[7.08,7.647,8.277,8.979,9.764,10.645,11.637],73:[7.163,7.737,8.375,9.086,9.882,10.774,11.78],73.5:[7.246,7.827,8.473,9.193,9.998,10.902,11.92],74:[7.327,7.915,8.568,9.297,10.113,11.028,12.059],74.5:[7.407,8.002,8.663,9.401,10.226,11.152,12.195],75:[7.486,8.088,8.757,9.503,10.338,11.275,12.33],75.5:[7.565,8.173,8.85,9.604,10.448,11.396,12.464],76:[7.641,8.257,8.94,9.703,10.557,11.515,12.595],76.5:[7.717,8.339,9.03,9.801,10.663,11.632,12.723],77:[7.792,8.42,9.118,9.896,10.768,11.746,12.848],77.5:[7.865,8.499,9.204,9.99,10.87,11.858,12.972],78:[7.938,8.578,9.289,10.083,10.971,11.968,13.092],78.5:[8.01,8.655,9.373,10.174,11.07,12.077,13.211],79:[8.082,8.733,9.457,10.265,11.169,12.184,13.328],79.5:[8.154,8.811,9.541,10.356,11.267,12.291,13.445],80:[8.227,8.89,9.626,10.448,11.367,12.399,13.561],80.5:[8.302,8.97,9.712,10.54,11.467,12.507,13.679],81:[8.379,9.052,9.8,10.635,11.569,12.617,13.798],81.5:[8.457,9.136,9.891,10.732,11.673,12.73,13.92],82:[8.538,9.223,9.984,10.832,11.781,12.845,14.044],82.5:[8.623,9.313,10.08,10.935,11.891,12.964,14.172],83:[8.71,9.406,10.179,11.042,12.005,13.086,14.303],83.5:[8.8,9.503,10.282,11.152,12.123,13.213,14.439],84:[8.894,9.602,10.389,11.265,12.244,13.342,14.578],84.5:[8.99,9.705,10.498,11.382,12.369,13.476,14.721],85:[9.088,9.809,10.61,11.501,12.496,13.612,14.866],85.5:[9.189,9.916,10.723,11.622,12.625,13.75,15.014],86:[9.29,10.024,10.838,11.744,12.756,13.89,15.163],86.5:[9.392,10.133,10.954,11.868,12.888,14.03,15.314],87:[9.637,10.393,11.232,12.164,13.205,14.37,15.677],87.5:[9.738,10.501,11.347,12.287,13.336,14.51,15.828],88:[9.838,10.607,11.46,12.409,13.467,14.65,15.979],88.5:[9.937,10.713,11.573,12.53,13.597,14.79,16.129],89:[10.034,10.817,11.685,12.65,13.725,14.928,16.278],89.5:[10.13,10.92,11.795,12.768,13.853,15.066,16.428],90:[10.226,11.022,11.905,12.886,13.98,15.204,16.576],90.5:[10.32,11.123,12.014,13.004,14.107,15.341,16.725],91:[10.414,11.224,12.123,13.121,14.234,15.478,16.874],91.5:[10.507,11.324,12.231,13.238,14.36,15.615,17.024],92:[10.599,11.424,12.338,13.354,14.487,15.753,17.174],92.5:[10.691,11.523,12.445,13.47,14.613,15.891,17.325],93:[10.782,11.622,12.552,13.587,14.74,16.03,17.477],93.5:[10.873,11.721,12.66,13.704,14.868,16.17,17.63],94:[10.964,11.82,12.768,13.822,14.997,16.311,17.786],94.5:[11.056,11.919,12.876,13.94,15.127,16.454,17.943],95:[11.148,12.02,12.986,14.06,15.258,16.598,18.103],95.5:[11.241,12.121,13.096,14.181,15.391,16.745,18.265],96:[11.334,12.223,13.208,14.304,15.526,16.894,18.43],96.5:[11.428,12.326,13.321,14.428,15.663,17.046,18.599],97:[11.524,12.43,13.436,14.555,15.803,17.201,18.771],97.5:[11.62,12.536,13.552,14.683,15.946,17.359,18.948],98:[11.718,12.644,13.671,14.814,16.09,17.52,19.127],98.5:[11.817,12.752,13.791,14.947,16.238,17.684,19.311],99:[11.917,12.863,13.913,15.082,16.388,17.852,19.498],99.5:[12.018,12.974,14.036,15.219,16.54,18.022,19.688],100:[12.12,13.087,14.161,15.358,16.695,18.195,19.883],100.5:[12.224,13.201,14.288,15.498,16.852,18.371,20.081],101:[12.328,13.317,14.416,15.641,17.012,18.55,20.282],101.5:[12.433,13.433,14.545,15.786,17.173,18.731,20.487],102:[12.539,13.551,14.676,15.932,17.337,18.915,20.694],102.5:[12.647,13.67,14.809,16.08,17.503,19.102,20.904],103:[12.755,13.791,14.943,16.23,17.671,19.291,21.118],103.5:[12.865,13.912,15.079,16.381,17.841,19.482,21.334],104:[12.975,14.035,15.215,16.534,18.013,19.675,21.553],104.5:[13.086,14.159,15.353,16.689,18.186,19.871,21.775],105:[13.198,14.283,15.493,16.845,18.362,20.07,22],105.5:[13.312,14.41,15.634,17.004,18.54,20.271,22.227],106:[13.426,14.537,15.777,17.164,18.721,20.475,22.458],106.5:[13.542,14.667,15.921,17.326,18.903,20.68,22.692],107:[13.658,14.797,16.067,17.489,19.088,20.89,22.93],107.5:[13.776,14.928,16.214,17.655,19.274,21.101,23.17],108:[13.895,15.061,16.363,17.823,19.464,21.316,23.415],108.5:[14.015,15.195,16.514,17.992,19.655,21.533,23.662],109:[14.137,15.332,16.667,18.164,19.85,21.754,23.913],109.5:[14.26,15.47,16.822,18.339,20.047,21.978,24.169],110:[14.385,15.609,16.979,18.516,20.247,22.205,24.428],110.5:[14.511,15.751,17.138,18.695,20.45,22.435,24.69],111:[14.639,15.894,17.298,18.876,20.655,22.668,24.955],111.5:[14.768,16.038,17.461,19.059,20.862,22.903,25.224],112:[14.898,16.184,17.624,19.244,21.071,23.141,25.496],112.5:[15.029,16.331,17.79,19.43,21.282,23.381,25.77],113:[15.162,16.479,17.957,19.618,21.495,23.623,26.047],113.5:[15.296,16.629,18.125,19.808,21.71,23.868,26.325],114:[15.429,16.779,18.294,19.999,21.927,24.114,26.607],114.5:[15.565,16.931,18.464,20.191,22.144,24.362,26.891],115:[15.7,17.083,18.635,20.385,22.364,24.612,27.176],115.5:[15.836,17.236,18.807,20.579,22.584,24.863,27.463],116:[15.974,17.389,18.98,20.774,22.805,25.115,27.752],116.5:[16.111,17.543,19.153,20.97,23.028,25.368,28.042],117:[16.248,17.697,19.327,21.167,23.251,25.623,28.334],117.5:[16.385,17.852,19.501,21.364,23.475,25.879,28.627],118:[16.523,18.006,19.676,21.561,23.699,26.135,28.921],118.5:[16.66,18.161,19.85,21.759,23.924,26.392,29.216],119:[16.798,18.316,20.025,21.957,24.15,26.65,29.512],119.5:[16.935,18.47,20.199,22.155,24.375,26.908,29.81],120:[17.072,18.624,20.374,22.353,24.601,27.167,30.107]},vl={0:[43.6,45.4,47.3,49.1,51,52.9,54.7],1:[47.8,49.8,51.7,53.7,55.6,57.6,59.5],2:[51,53,55,57.1,59.1,61.1,63.2],3:[53.5,55.6,57.7,59.8,61.9,64,66.1],4:[55.6,57.8,59.9,62.1,64.3,66.4,68.6],5:[57.4,59.6,61.8,64,66.2,68.5,70.7],6:[58.9,61.2,63.5,65.7,68,70.3,72.5],7:[60.3,62.7,65,67.3,69.6,71.9,74.2],8:[61.7,64,66.4,68.7,71.1,73.5,75.8],9:[62.9,65.3,67.7,70.1,72.6,75,77.4],10:[64.1,66.5,69,71.5,73.9,76.4,78.9],11:[65.2,67.7,70.3,72.8,75.3,77.8,80.3],12:[66.3,68.9,71.4,74,76.6,79.2,81.7],13:[67.3,70,72.6,75.2,77.8,80.5,83.1],14:[68.3,71,73.7,76.4,79.1,81.7,84.4],15:[69.3,72,74.8,77.5,80.2,83,85.7],16:[70.2,73,75.8,78.6,81.4,84.2,87],17:[71.1,74,76.8,79.7,82.5,85.4,88.2],18:[72,74.9,77.8,80.7,83.6,86.5,89.4],19:[72.8,75.8,78.8,81.7,84.7,87.6,90.6],20:[73.7,76.7,79.7,82.7,85.7,88.7,91.7],21:[74.5,77.5,80.6,83.7,86.7,89.8,92.9],22:[75.2,78.4,81.5,84.6,87.7,90.8,94],23:[76,79.2,82.3,85.5,88.7,91.9,95],24:[76.7,80,83.2,86.4,89.6,92.9,96.1],25:[76.8,80,83.3,86.6,89.9,93.1,96.4],26:[77.5,80.8,84.1,87.4,90.8,94.1,97.4],27:[78.1,81.5,84.9,88.3,91.7,95,98.4],28:[78.8,82.2,85.7,89.1,92.5,96,99.4],29:[79.5,82.9,86.4,89.9,93.4,96.9,100.3],30:[80.1,83.6,87.1,90.7,94.2,97.7,101.3],31:[80.7,84.3,87.9,91.4,95,98.6,102.2],32:[81.3,84.9,88.6,92.2,95.8,99.4,103.1],33:[81.9,85.6,89.3,92.9,96.6,100.3,103.9],34:[82.5,86.2,89.9,93.6,97.4,101.1,104.8],35:[83.1,86.8,90.6,94.4,98.1,101.9,105.6],36:[83.6,87.4,91.2,95.1,98.9,102.7,106.5],37:[84.2,88,91.9,95.7,99.6,103.4,107.3],38:[84.7,88.6,92.5,96.4,100.3,104.2,108.1],39:[85.3,89.2,93.1,97.1,101,105,108.9],40:[85.8,89.8,93.8,97.7,101.7,105.7,109.7],41:[86.3,90.4,94.4,98.4,102.4,106.4,110.5],42:[86.8,90.9,95,99,103.1,107.2,111.2],43:[87.4,91.5,95.6,99.7,103.8,107.9,112],44:[87.9,92,96.2,100.3,104.5,108.6,112.7],45:[88.4,92.5,96.7,100.9,105.1,109.3,113.5],46:[88.9,93.1,97.3,101.5,105.8,110,114.2],47:[89.3,93.6,97.9,102.1,106.4,110.7,114.9],48:[89.8,94.1,98.4,102.7,107,111.3,115.7],49:[90.3,94.6,99,103.3,107.7,112,116.4],50:[90.7,95.1,99.5,103.9,108.3,112.7,117.1],51:[91.2,95.6,100.1,104.5,108.9,113.3,117.7],52:[91.7,96.1,100.6,105,109.5,114,118.4],53:[92.1,96.6,101.1,105.6,110.1,114.6,119.1],54:[92.6,97.1,101.6,106.2,110.7,115.2,119.8],55:[93,97.6,102.2,106.7,111.3,115.9,120.4],56:[93.4,98.1,102.7,107.3,111.9,116.5,121.1],57:[93.9,98.5,103.2,107.8,112.5,117.1,121.8],58:[94.3,99,103.7,108.4,113,117.7,122.4],59:[94.7,99.5,104.2,108.9,113.6,118.3,123.1],60:[95.2,99.9,104.7,109.4,114.2,118.9,123.7]},fl={0:[44.2,46.1,48,49.9,51.8,53.7,55.6],1:[48.9,50.8,52.8,54.7,56.7,58.6,60.6],2:[52.4,54.4,56.4,58.4,60.4,62.4,64.4],3:[55.3,57.3,59.4,61.4,63.5,65.5,67.6],4:[57.6,59.7,61.8,63.9,66,68,70.1],5:[59.6,61.7,63.8,65.9,68,70.1,72.2],6:[61.2,63.3,65.5,67.6,69.8,71.9,74],7:[62.7,64.8,67,69.2,71.3,73.5,75.7],8:[64,66.2,68.4,70.6,72.8,75,77.2],9:[65.2,67.5,69.7,72,74.2,76.5,78.7],10:[66.4,68.7,71,73.3,75.6,77.9,80.1],11:[67.6,69.9,72.2,74.5,76.9,79.2,81.5],12:[68.6,71,73.4,75.7,78.1,80.5,82.9],13:[69.6,72.1,74.5,76.9,79.3,81.8,84.2],14:[70.6,73.1,75.6,78,80.5,83,85.5],15:[71.6,74.1,76.6,79.1,81.7,84.2,86.7],16:[72.5,75,77.6,80.2,82.8,85.4,88],17:[73.3,76,78.6,81.2,83.9,86.5,89.2],18:[74.2,76.9,79.6,82.3,85,87.7,90.4],19:[75,77.7,80.5,83.2,86,88.8,91.5],20:[75.8,78.6,81.4,84.2,87,89.8,92.6],21:[76.5,79.4,82.3,85.1,88,90.9,93.8],22:[77.2,80.2,83.1,86,89,91.9,94.9],23:[78,81,83.9,86.9,89.9,92.9,95.9],24:[78,81,84.1,87.1,90.2,93.2,96.3],25:[78.6,81.7,84.9,88,91.1,94.2,97.3],26:[79.3,82.5,85.6,88.8,92,95.2,98.3],27:[79.9,83.1,86.4,89.6,92.9,96.1,99.3],28:[80.5,83.8,87.1,90.4,93.7,97,100.3],29:[81.1,84.5,87.8,91.2,94.5,97.9,101.2],30:[81.7,85.1,88.5,91.9,95.3,98.7,102.1],31:[82.3,85.7,89.2,92.7,96.1,99.6,103],32:[82.8,86.4,89.9,93.4,96.9,100.4,103.9],33:[83.4,86.9,90.5,94.1,97.6,101.2,104.8],34:[83.9,87.5,91.1,94.8,98.4,102,105.6],35:[84.4,88.1,91.8,95.4,99.1,102.7,106.4],36:[85,88.7,92.4,96.1,99.8,103.5,107.2],37:[85.5,89.2,93,96.7,100.5,104.2,108],38:[86,89.8,93.6,97.4,101.2,105,108.8],39:[86.5,90.3,94.2,98,101.8,105.7,109.5],40:[87,90.9,94.7,98.6,102.5,106.4,110.3],41:[87.5,91.4,95.3,99.2,103.2,107.1,111],42:[88,91.9,95.9,99.9,103.8,107.8,111.7],43:[88.4,92.4,96.4,100.4,104.5,108.5,112.5],44:[88.9,93,97,101,105.1,109.1,113.2],45:[89.4,93.5,97.5,101.6,105.7,109.8,113.9],46:[89.8,94,98.1,102.2,106.3,110.4,114.6],47:[90.3,94.4,98.6,102.8,106.9,111.1,115.2],48:[90.7,94.9,99.1,103.3,107.5,111.7,115.9],49:[91.2,95.4,99.7,103.9,108.1,112.4,116.6],50:[91.6,95.9,100.2,104.4,108.7,113,117.3],51:[92.1,96.4,100.7,105,109.3,113.6,117.9],52:[92.5,96.9,101.2,105.6,109.9,114.2,118.6],53:[93,97.4,101.7,106.1,110.5,114.9,119.2],54:[93.4,97.8,102.3,106.7,111.1,115.5,119.9],55:[93.9,98.3,102.8,107.2,111.7,116.1,120.6],56:[94.3,98.8,103.3,107.8,112.3,116.7,121.2],57:[94.7,99.3,103.8,108.3,112.8,117.4,121.9],58:[95.2,99.7,104.3,108.9,113.4,118,122.6],59:[95.6,100.2,104.8,109.4,114,118.6,123.2],60:[96.1,100.7,105.3,110,114.6,119.2,123.9]},Il=(e,t,r)=>{const n=r[Number(e)];if(t<n[0])return-3.5;if(t>n[6])return 3.5;const a=((e,t)=>{let r,n;for(let a=0;a<7;a++)if(!(e>=t[a]&&(r=a,e>t[a]))){n=a;break}return{lowerLimitIn:r,higherLimitIn:n}})(t,n),o=a.higherLimitIn,i=a.lowerLimitIn,s=n[o]-n[i],l=n[o]-t;return(o-3-(s>0?l/s:0)).toFixed(2)},bl=new Map;bl.set("GS1_E0_IDENTIFIER","]E0"),bl.set("GS1_E1_IDENTIFIER","]E1"),bl.set("GS1_E2_IDENTIFIER","]E2"),bl.set("GS1_E3_IDENTIFIER","]E3"),bl.set("GS1_E4_IDENTIFIER","]E4"),bl.set("GS1_I1_IDENTIFIER","]I1"),bl.set("GS1_C1_IDENTIFIER","]C1"),bl.set("GS1_e0_IDENTIFIER","]e0"),bl.set("GS1_e1_IDENTIFIER","]e1"),bl.set("GS1_e2_IDENTIFIER","]e2"),bl.set("GS1_d2_IDENTIFIER","]d2"),bl.set("GS1_Q3_IDENTIFIER","]Q3"),bl.set("GS1_J1_IDENTIFIER","]J1"),bl.set("GS1_d1_IDENTIFIER","]d1"),bl.set("GS1_Q1_IDENTIFIER","]Q1"),bl.set("GS1_GROUP_SEPARATOR","\x1d"),bl.set("SSCC","00"),bl.set("GTIN","01"),bl.set("CONTENT","02"),bl.set("LOT_NUMBER","10"),bl.set("PROD_DATE","11"),bl.set("DUE_DATE","12"),bl.set("PACK_DATE","13"),bl.set("BEST_BEFORE_DATE","15"),bl.set("SELL_BY","16"),bl.set("EXP_DATE","17"),bl.set("VARIANT","20"),bl.set("SERIAL_NUMBER","21"),bl.set("CPV","22"),bl.set("TPX","235"),bl.set("ADDITIONAL_ID","240"),bl.set("CUSTOMER_PART_NUMBER","241"),bl.set("MTO_VARIANT_NUMBER","242"),bl.set("PCN","243"),bl.set("SECONDARY_SERIAL","250"),bl.set("REF_TO_SOURCE","251"),bl.set("GDTI","253"),bl.set("GLN_EXTENSION_COMPONENT","254"),bl.set("GCN","255"),bl.set("VAR_COUNT","30"),bl.set("NET_WEIGHT_KG","310*"),bl.set("LENGTH_M","311*"),bl.set("WIDTH_M","312*"),bl.set("HEIGHT_M","313*"),bl.set("AREA_M2","314*"),bl.set("NET_VOLUME_L","315*"),bl.set("NET_VOLUME_M3","316*"),bl.set("NET_WEIGHT_LB","320*"),bl.set("LENGTH_I","321*"),bl.set("LENGTH_F","322*"),bl.set("LENGTH_Y","323*"),bl.set("WIDTH_I","324*"),bl.set("WIDTH_F","325*"),bl.set("WIDTH_Y","326*"),bl.set("HEIGHT_I","327*"),bl.set("HEIGHT_F","328*"),bl.set("HEIGHT_Y","329*"),bl.set("GROSS_WEIGHT_GF","330*"),bl.set("LENGTH_M_LOG","331*"),bl.set("WIDTH_M_LOG","332*"),bl.set("HEIGHT_M_LOG","333*"),bl.set("AREA_M2_LOG","334*"),bl.set("VOLUME_L_LOG","335*"),bl.set("VOLUME_M3_LOG","336*"),bl.set("KG_PER_M2","337*"),bl.set("GROSS_WHEIGHT_LB","340*"),bl.set("LENGTH_I_LOG","341*"),bl.set("LENGTH_F_LOG","342*"),bl.set("LENGTH_Y_LOG","343*"),bl.set("WIDTH_I_LOG","344*"),bl.set("WIDTH_F_LOG","345*"),bl.set("WIDTH_Y_LOG","346*"),bl.set("HEIGHT_I_LOG","347*"),bl.set("HEIGHT_F_LOG","348*"),bl.set("HEIGHT_Y_LOG","349*"),bl.set("AREA_I2","350*"),bl.set("AREA_F2","351*"),bl.set("AREA_Y2","352*"),bl.set("AREA_I2_LOG","353*"),bl.set("AREA_F2_LOG","354*"),bl.set("AREA_Y2_LOG","355*"),bl.set("NET_WEIGHT_T","356*"),bl.set("NET_VOLUME_OZ","357*"),bl.set("NET_VOLUME_Q","360*"),bl.set("NET_VOLUME_G","361*"),bl.set("VOLUME_Q_LOG","362*"),bl.set("VOLUME_G_LOG","363*"),bl.set("VOLUME_I3","364*"),bl.set("VOLUME_F3","365*"),bl.set("VOLUME_Y3","366*"),bl.set("VOLUME_I3_LOG","367*"),bl.set("VOLUME_F3_LOG","368*"),bl.set("VOLUME_Y3_LOG","369*"),bl.set("COUNT","37"),bl.set("AMOUNT","390*"),bl.set("AMOUNT_ISO","391*"),bl.set("PRICE","392*"),bl.set("PRICE_ISO","393*"),bl.set("PRCNT_OFF","394*"),bl.set("PRICE_UOM","395*"),bl.set("ORDER_NUMBER","400"),bl.set("GINC","401"),bl.set("ROUTE","403"),bl.set("SHIP_TO_GLOB_LOC","410"),bl.set("BILL_TO_LOC","411"),bl.set("PURCHASED_FROM","412"),bl.set("SHIP_FOR_LOG","413"),bl.set("LOC_NUMBER","414"),bl.set("PAY_TO","415"),bl.set("PROD_SERV_LOC","416"),bl.set("PARTY","417"),bl.set("SHIP_TO_POST","420"),bl.set("SHIP_TO_POST_ISO","421"),bl.set("ORIGIN","422"),bl.set("COUNTRY_INITIAL_PROCESS","423"),bl.set("COUNTRY_PROCESS","424"),bl.set("COUNTRY_DISASSEMBLY","425"),bl.set("COUNTRY_FULL_PROCESS","426"),bl.set("ORIGIN_SUBDIVISION","427"),bl.set("SHIP_TO_COMP","4300"),bl.set("SHIP_TO_NAME","4301"),bl.set("SHIP_TO_ADD1","4302"),bl.set("SHIP_TO_ADD2","4303"),bl.set("SHIP_TO_SUB","4304"),bl.set("SHIP_TO_LOCALITY","4305"),bl.set("SHIP_TO_REG","4306"),bl.set("SHIP_TO_COUNTRY","4307"),bl.set("SHIP_TO_PHONE","4308"),bl.set("RTN_TO_COMP","4310"),bl.set("RTN_TO_NAME","4311"),bl.set("RTN_TO_ADD1","4312"),bl.set("RTN_TO_ADD2","4313"),bl.set("RTN_TO_SUB","4314"),bl.set("RTN_TO_LOCALITY","4315"),bl.set("RTN_TO_REG","4316"),bl.set("RTN_TO_COUNTRY","4317"),bl.set("RTN_TO_POST","4318"),bl.set("RTN_TO_PHONE","4319"),bl.set("SRV_DESCRIPTION","4320"),bl.set("DANGEROUS_GOODS","4321"),bl.set("AUTH_LEAV","4322"),bl.set("SIG_REQUIRED","4323"),bl.set("NBEF_DEL_DT","4324"),bl.set("NAFT_DEL_DT","4325"),bl.set("REL_DATE","4326"),bl.set("NSN","7001"),bl.set("MEAT_CUT","7002"),bl.set("EXP_TIME","7003"),bl.set("ACTIVE_POTENCY","7004"),bl.set("CATCH_AREA","7005"),bl.set("FIRST_FREEZE_DATE","7006"),bl.set("HARVEST_DATE","7007"),bl.set("AQUATIC_SPECIES","7008"),bl.set("FISHING_GEAR_TYPE","7009"),bl.set("PROD_METHID","7010"),bl.set("REFURB_LOT","7020"),bl.set("FUNC_STAT","7021"),bl.set("REV_STAT","7022"),bl.set("GIAI_ASSEMBLY","7023"),bl.set("PROCESSOR_NUMBER","703*"),bl.set("UIC_EXT","7040"),bl.set("NHRN_PZN","710"),bl.set("NHRN_CIP","711"),bl.set("NHRN_CN","712"),bl.set("NHRN_DRN","713"),bl.set("NHRN_AIM","714"),bl.set("CERT_NUMBER","723*"),bl.set("PROTOCOL","7240"),bl.set("DIMENSIONS","8001"),bl.set("CMT_NUMBER","8002"),bl.set("GRAI","8003"),bl.set("GIAI","8004"),bl.set("PRICE_PER_UNIT","8005"),bl.set("ITIP","8006"),bl.set("IBAN","8007"),bl.set("PROD_TIME","8008"),bl.set("OPTSEN","8009"),bl.set("CPID","8010"),bl.set("CPID_SERIAL","8011"),bl.set("VERSION","8012"),bl.set("GMN","8013"),bl.set("GSRN_PROVIDER","8017"),bl.set("GSRN_RECIPIENT","8018"),bl.set("SRIN","8019"),bl.set("REF_NUMBER","8020"),bl.set("ITIP_CONTENT","8026"),bl.set("COUPON_USA","8110"),bl.set("POINTS","8111"),bl.set("POSITIVE_OFFER_COUPON_USA","8121"),bl.set("PRODUCT_URL","8200"),bl.set("AGREEMENT_INTERNAL","90"),bl.set("COMPANY_INTERNAL_1","91"),bl.set("COMPANY_INTERNAL_2","92"),bl.set("COMPANY_INTERNAL_3","93"),bl.set("COMPANY_INTERNAL_4","94"),bl.set("COMPANY_INTERNAL_5","95"),bl.set("COMPANY_INTERNAL_6","96"),bl.set("COMPANY_INTERNAL_7","97"),bl.set("COMPANY_INTERNAL_8","98"),bl.set("COMPANY_INTERNAL_9","99");const Sl={[bl.get("SSCC")]:20,[bl.get("GTIN")]:16,[bl.get("CONTENT")]:16,"03":16,"04":18,[bl.get("PROD_DATE")]:8,[bl.get("DUE_DATE")]:8,[bl.get("PACK_DATE")]:8,14:8,[bl.get("BEST_BEFORE_DATE")]:8,[bl.get("SELL_BY")]:8,[bl.get("EXP_DATE")]:8,18:8,19:8,[bl.get("VARIANT")]:4,31:10,32:10,33:10,34:10,35:10,36:10,41:16};let Tl;const Al=e=>{if(e){const t=e.length,r=(e=>{for(let t of bl.values()){if(t.endsWith("*")&&(t=t.substring(0,t.length-1)),e.startsWith(t)&&t.endsWith("*"))return e.substring(0,t.length+1);if(e.startsWith(t))return t}return!1})(e);let n=Sl[r.substring(0,2)];null==n&&(n=t),Tl.set(r,e.substring(r.length,n)),Al(e.substring(n))}},Cl={},Ol=(e,t)=>{if(t&&t.length>=3){const r=t.substring(0,3);if(bl.get("GS1_d2_IDENTIFIER")===r||bl.get("GS1_Q3_IDENTIFIER")===r){const r=((e,t)=>{const r=(e=>{switch(e){case"gtin":return"GTIN";case"lot number":case"batch number":return"LOT_NUMBER";case"production date":return"PROD_DATE";case"best before date":return"BEST_BEFORE_DATE";case"expiration date":return"EXP_DATE";case"serial number":return"SERIAL_NUMBER";default:return e}})(e),n=bl.get(r);if(Cl[t])return Cl[t].get(n);Tl=new Map;const a=(e=>e.substring(3))(t).split(bl.get("GS1_GROUP_SEPARATOR"));return a.forEach((e=>{Al(e)})),Cl[t]=Tl,Tl.get(n)})(e,t);return r}return"Unsupported GS1 identifier: {gs1Identifier}"}return"Incomplete DataMatrix input"},Nl=e=>{let{dateUtils:t,variablesHash:r,selectedOrgUnit:n,selectedUserRoles:a}=e;return{ceil:{parameters:1,execute:e=>Math.ceil(e[0])},floor:{parameters:1,execute:e=>Math.floor(e[0])},round:{parameters:{min:1,max:2},execute:e=>{if(e[1]){const t=10**Math.round(e[1]);return Math.round((e[0]+Number.EPSILON)*t)/t}return Math.round(e[0])}},modulus:{parameters:2,execute:e=>Number(e[0])%Number(e[1])},zing:{parameters:1,execute:e=>{const t=e[0];return t<0?0:t}},oizp:{parameters:1,execute:e=>e[0]<0?0:1},concatenate:{execute:e=>e.join("")},daysBetween:{parameters:2,execute:e=>t.daysBetween(e[0],e[1])},weeksBetween:{parameters:2,execute:e=>t.weeksBetween(e[0],e[1])},monthsBetween:{parameters:2,execute:e=>t.monthsBetween(e[0],e[1])},yearsBetween:{parameters:2,execute:e=>t.yearsBetween(e[0],e[1])},addDays:{parameters:2,execute:e=>{const r=e[0],n=e[1];return t.addDays(r,n)}},count:{parameters:1,execute:e=>{var t,n;const a=e[0],o=r[a];return o?o.hasValue?null!==(t=null===(n=o.allValues)||void 0===n?void 0:n.length)&&void 0!==t?t:1:0:(S().warn(`could not find variable to count: ${a}`),0)}},countIfValue:{parameters:2,execute:e=>{const t=e[0],n=r[t];if(!n)return S().warn(`could not find variable to countIfValue: ${t}`),0;if(!n.hasValue)return 0;const a=e[1];return(n.allValues||[n.variableValue]).reduce(((e,t)=>t===a?e+1:e),0)}},countIfZeroPos:{parameters:1,execute:()=>(S().warn("countIfZeroPos not implemented yet"),0)},hasValue:{parameters:1,execute:e=>{const t=e[0],n=r[t];return n?n.hasValue:(S().warn(`could not find variable to check if has value: ${t}`),!1)}},validatePattern:{parameters:2,execute:e=>{const t=e[0].toString(),r=e[1],n=new RegExp(r,"g"),a=t.match(n);let o=!1;return null!==a&&t===a[0]&&(o=!0),o}},left:{parameters:2,execute:e=>{const t=String(e[0]),r=t.length<e[1]?t.length:e[1];return t.substring(0,r)}},right:{parameters:2,execute:e=>{const t=String(e[0]),r=t.length<e[1]?t.length:e[1];return t.substring(t.length-r,t.length)}},substring:{parameters:3,execute:e=>{const t=String(e[0]),r=t.length<e[1]-1?-1:e[1],n=t.length<e[2]?-1:e[2];return r<0||n<0?"":t.substring(r,n)}},split:{parameters:3,execute:e=>{const t=String(e[0]).split(e[1]);let r="";return t.length>e[2]&&(r=t[e[2]]),r}},length:{parameters:1,execute:e=>String(e[0]).length},inOrgUnitGroup:{parameters:1,execute:e=>{const t=e[0],r=n&&n.groups||[];return Boolean(r.find((e=>e.id===t||e.code===t)))}},hasUserRole:{parameters:1,execute:e=>{const t=e[0];return a.includes(t)}},zScoreWFA:{parameters:3,execute:e=>((e,t,r)=>{let n=gl;return 1===ml[r]&&(n=hl),Il(Math.round(e),t,n)})(e[0],e[1],e[2])},zScoreHFA:{parameters:3,execute:e=>((e,t,r)=>{let n=vl;return 1===ml[r]&&(n=fl),Il(Math.round(e),t,n)})(e[0],e[1],e[2])},zScoreWFH:{parameters:3,execute:e=>((e,t,r)=>{let n=El;return 1===ml[r]&&(n=yl),Il(Math.round(2*e)/2,t,n)})(e[0],e[1],e[2])},extractDataMatrixValue:{parameters:2,execute:e=>Ol(e[0],e[1])},lastEventDate:{parameters:1,execute:e=>{const t=e[0],n=r[t];return n?n.variableEventDate?n.variableEventDate:(S().warn(`no last event date found for variable: ${t}`),""):(S().warn(`could not find variable to check last event date: ${t}`),"")}},addControlDigits:{parameters:1,execute:e=>{const t=e[0],r=t.split("");let n=0,a=0;if(r&&r.length<10){let e=0;const t=r.length,o=[3,7,6,1,8,9,4,5,2];for(let n=0;n<t;n++)e+=parseInt(r[n],10)*o[n];n=e%11,r.push(n);const i=[5,4,3,2,7,6,5,4,3,2];let s=0;for(let n=0;n<t+1;n++)s+=parseInt(r[n],10)*i[n];a=s%11,10===n&&(S().warn("First control digit became 10, replacing with 0"),n=0),10===a&&(S().warn("Second control digit became 10, replacing with 0"),a=0)}else S().warn(`Base number not well formed(${r.length} digits): ${t}`);return t+n+a}},checkControlDigits:{parameters:1,execute:e=>(S().warn("checkControlDigits not implemented yet"),e[0])},multiTextContains:{parameters:2,execute:e=>(S().warn("multiTextContains not implemented yet"),e[0])},condition:{parameters:3,execute:e=>{const o=Nl({dateUtils:t,variablesHash:r,selectedOrgUnit:n,selectedUserRoles:a});return pl({expression:e[0],dhisFunctions:o,variablesHash:r,onError:()=>S().error(`Evaluation of d2:condition expression ${e[0]} failed`),onVerboseLog:()=>{}})?e[1]:e[2]}}}},Rl=Object.freeze({[Fs]:e=>{let{dataElementId:t,dataElements:r}=e;if(t&&r&&r[t]){const e=r[t];return{name:e.name,valueType:e.valueType}}return null},[xs]:e=>{let{trackedEntityAttributeId:t,trackedEntityAttributes:r}=e;if(t&&r&&r[t]){const e=r[t];return{name:e.displayFormName||e.displayName,valueType:e.valueType}}return null}}),wl=e=>e||(0===e?0:"");function _l(e){const t=[Ms,Vs];function r(e,r){return t.filter((t=>e[t])).map((t=>{const n=r();return n.id=e[t],n.targetDataType=t===Ms?Fs:xs,n}))}function n(e,t){const n=r(e,(()=>({type:t,message:`${e.displayContent||""} ${wl(e.data)}`})));return 0!==n.length?n:{type:t,id:"general"}}function a(e,t){const r=n(e,t);return Array.isArray(r)||(r.warning={id:e.id,message:`${e.displayContent||""} ${wl(e.data)}`}),r}function o(e,t){const r=n(e,t);return Array.isArray(r)||(r.error={id:e.id,message:`${e.displayContent||""} ${wl(e.data)}`}),r}function i(t,r,n){const a=function(t,r){let n;if(t||0===t||!1===t){const a=Gs[r],o=e[a];if(!a||!o)return S().warn(ol("converter for valueType is missing")({valueType:r})),"";n=o(t)}else n=t;return n}(Zs(t.data,r.valueType),r.valueType);return{type:Ls.ASSIGN_VALUE,id:r.id,value:a,targetDataType:n}}const s={[Ls.ASSIGN_VALUE]:function(e,t,r){const n=[];return t&&e.dataElementId&&t[e.dataElementId]&&n.push(i(e,t[e.dataElementId],Fs)),r&&e.trackedEntityAttributeId&&r[e.trackedEntityAttributeId]&&n.push(i(e,r[e.trackedEntityAttributeId],xs)),n},[Ls.HIDE_FIELD]:function(e,t,n,a,o){return(e=>{let{outputEffects:t,formValues:r,dataElementId:n,trackedEntityAttributeId:a,dataElements:o,trackedEntityAttributes:i,onProcessValue:s}=e;return t.reduce(((e,t)=>{if(r&&0!==Object.keys(r).length&&t.targetDataType){const l=r[t.id],d=Rl[t.targetDataType]({dataElementId:n,trackedEntityAttributeId:a,dataElements:o,trackedEntityAttributes:i});if(d){const{valueType:r,name:n}=d;if(null!=s(l,r))return[...e,{...t,hadValue:!0,name:n}]}return[...e,t]}return[...e,t]}),[])})({outputEffects:r(e,(()=>({type:Ls.HIDE_FIELD,content:e.content}))),formValues:a,dataElementId:e.dataElementId,trackedEntityAttributeId:e.trackedEntityAttributeId,dataElements:t,trackedEntityAttributes:n,onProcessValue:o})},[Ls.SHOW_ERROR]:function(e){return o(e,Ls.SHOW_ERROR)},[Ls.SHOW_WARNING]:function(e){return a(e,Ls.SHOW_WARNING)},[Ls.SHOW_ERROR_ONCOMPLETE]:function(e){return o(e,Ls.SHOW_ERROR_ONCOMPLETE)},[Ls.SHOW_WARNING_ONCOMPLETE]:function(e){return a(e,Ls.SHOW_WARNING_ONCOMPLETE)},[Ls.HIDE_PROGRAM_STAGE]:function(e){return e.programStageId?{type:Ls.HIDE_PROGRAM_STAGE,id:e.programStageId}:null},[Ls.HIDE_SECTION]:function(e){return e.programStageSectionId?{type:Ls.HIDE_SECTION,id:e.programStageSectionId}:null},[Ls.MAKE_COMPULSORY]:function(e){return r(e,(()=>({type:Ls.MAKE_COMPULSORY})))},[Ls.DISPLAY_TEXT]:function(e){const t=e.displayContent||"";return{type:Ls.DISPLAY_TEXT,id:e.location,displayText:{id:e.id,message:`${t} ${wl(e.data)}`,...e.style}}},[Ls.DISPLAY_KEY_VALUE_PAIR]:function(e){const t=void 0!==e.data?e.data:"";return{type:Ls.DISPLAY_KEY_VALUE_PAIR,id:e.location,displayKeyValuePair:{id:e.id,key:e.displayContent,value:"number"===typeof t?(r=t,isNaN(r)||r===1/0?"":String(r)):String(t),...e.style}};var r},[Ls.HIDE_OPTION_GROUP]:function(e){return r(e,(()=>({type:Ls.HIDE_OPTION_GROUP,optionGroupId:e.optionGroupId})))},[Ls.HIDE_OPTION]:function(e){return r(e,(()=>({type:Ls.HIDE_OPTION,optionId:e.optionId})))},[Ls.SHOW_OPTION_GROUP]:function(e){return r(e,(()=>({type:Ls.SHOW_OPTION_GROUP,optionGroupId:e.optionGroupId})))}};return function(e){let{effects:t,dataElements:r,trackedEntityAttributes:n,formValues:a,onProcessValue:o}=e;return t.filter((e=>{let{action:t}=e;return s[t]})).flatMap((e=>s[e.action](e,r,n,a,o))).filter((e=>e))}}const Pl=e=>e||null,kl=e=>"number"===typeof e?e:null,Dl=e=>e?e.name:null,Ul={convertText:Pl,convertMultiText:Pl,convertLongText:Pl,convertLetter:Pl,convertPhoneNumber:Pl,convertEmail:Pl,convertBoolean:e=>e||!1===e?e:null,convertTrueOnly:e=>e||null,convertDate:e=>{if(!e)return null;const t=$()(e);return t.locale("en"),t.format("YYYY-MM-DD")},convertDateTime:Pl,convertTime:Pl,convertNumber:kl,convertUnitInterval:kl,convertPercentage:kl,convertInteger:kl,convertIntegerPositive:kl,convertIntegerNegative:kl,convertIntegerZeroOrPositive:kl,convertTrackerAssociate:e=>(S().warn("convertTrackerAssociate not implemented",e),null),convertUserName:Pl,convertCoordinate:e=>e&&e.latitude&&e.longitude?`[${e.latitude},${e.longitude}]`:null,convertOrganisationUnit:Dl,convertAge:e=>Ul.convertDate(e),convertUrl:Pl,convertFile:Dl,convertImage:Dl},Ll="YYYY-MM-DD",Fl={convertText:e=>e,convertMultiText:e=>[...new Set(e.split(","))].join(","),convertLongText:e=>e,convertLetter:e=>e,convertPhoneNumber:e=>e,convertEmail:e=>e,convertBoolean:e=>e?"true":"false",convertTrueOnly:e=>e?"true":"false",convertDate:e=>_t($()(e,Ll)),convertDateTime:e=>{const t=$()(e);return{date:_t(t),time:t.format("HH:mm")}},convertTime:e=>e,convertNumber:e=>e.toString(),convertUnitInterval:e=>e.toString(),convertPercentage:e=>e.toString(),convertInteger:e=>e.toString(),convertIntegerPositive:e=>e.toString(),convertIntegerNegative:e=>e.toString(),convertIntegerZeroOrPositive:e=>e.toString(),convertTrackerAssociate:e=>(S().warn("convertTrackerAssociate not implemented",e),""),convertUserName:e=>(S().warn("convertUserName not implemented",e),""),convertCoordinate:e=>{const t=e.trim(),r=t.substring(1,t.length-1).split(",");return{latitude:Number(r[0]),longitude:Number(r[1])}},convertOrganisationUnit:e=>(S().warn("convertOrganisationUnit not implemented",e),""),convertAge:e=>{const t=$()(),r=$()(e,Ll),n=t.diff(r,"years");r.add(n,"years");const a=t.diff(r,"months");r.add(a,"months");const o=t.diff(r,"days");return{date:_t($()(e,Ll)),years:n.toString(),months:a.toString(),days:o.toString()}},convertUrl:e=>e,convertFile:e=>(S().warn("convertFile not implemented",e),""),convertImage:e=>(S().warn("convertImage not implemented",e),"")};function xl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD";return e.clone().locale("en").format(t)}const Ml="YYYY-MM-DD",Vl=/^\d{4}-\d{2}-\d{2}$/g;function jl(e){return Vl.lastIndex=0,e&&Vl.test(e)}function Gl(e){return $()(e,Ml)}function Bl(e){return xl(e)}function $l(e,t,r){const n=Gl(t);return Gl(r).diff(n,e)}const Wl={getToday:()=>Bl($()()),daysBetween:(e,t)=>jl(e)&&jl(t)?$l("days",e,t):null,weeksBetween:(e,t)=>jl(e)&&jl(t)?$l("weeks",e,t):null,monthsBetween:(e,t)=>jl(e)&&jl(t)?$l("months",e,t):null,yearsBetween:(e,t)=>jl(e)&&jl(t)?$l("years",e,t):null,addDays:(e,t)=>{if(!jl(e))return null;return Bl(Gl(e).add(t,"days"))},compareDates:(e,t)=>(e?$()(e).valueOf():Number.MAX_SAFE_INTEGER)-(t?$()(t).valueOf():Number.MAX_SAFE_INTEGER)},Hl=new class{constructor(e,t,r,n,a){this.inputConverter=e,this.outputConverter=t,this.valueProcessor=new il(e),this.variableService=new al(this.valueProcessor.processValue,r,n),this.dateUtils=r,this.flags=null!==a&&void 0!==a?a:{}}getProgramRuleEffects(e){let{programRulesContainer:{programRules:t,programRuleVariables:r,constants:n},currentEvent:a,otherEvents:o,dataElements:i,trackedEntityAttributes:s,selectedEntity:l,selectedEnrollment:d,selectedOrgUnit:c,selectedUserRoles:u,optionSets:p}=e;const m=this.variableService.getVariables({programRuleVariables:r,currentEvent:null!==a&&void 0!==a?a:void 0,otherEvents:null!==o&&void 0!==o?o:void 0,dataElements:i,selectedEntity:l,trackedEntityAttributes:s,selectedEnrollment:d,selectedOrgUnit:c,optionSets:p,constants:n}),g=Nl({dateUtils:this.dateUtils,variablesHash:m,selectedOrgUnit:c,selectedUserRoles:null!==u&&void 0!==u?u:this.userRoles});if(!t)return[];const h=t.sort(((e,t)=>e.priority||t.priority?e.priority?t.priority?e.priority-t.priority:-1:1:0)).flatMap((e=>{let t=!1;const{condition:r}=e;r?t=pl({expression:r,dhisFunctions:g,variablesHash:m,flags:this.flags,onError:(t,n,a)=>S().error(`Expression with rule id: ${e.id} could not be run. Original condition was: ${r} - Evaluation ended up as: ${n} - Result of evaluation was: ${null===a||void 0===a?void 0:a.toString()} - error message: ${t}`),onVerboseLog:(t,n)=>console.log(`Expression with rule id: ${e.id} was run. Original condition was: ${r} - Evaluation ended up as: ${t} - Result of evaluation was: ${null===n||void 0===n?void 0:n.toString()}`)}):S().warn(`Rule id:'${e.id}' and name:'${e.displayName}' had no condition specified. Please check rule configuration.`);let n=[];return t&&(n=e.programRuleActions.map((e=>{let t,{data:r,programRuleActionType:n,id:a,location:o,dataElementId:i,trackedEntityAttributeId:s,programStageId:l,programStageSectionId:d,optionGroupId:c,optionId:u,content:p,displayContent:h,style:E,name:y}=e;return r&&(t=pl({expression:r,dhisFunctions:g,variablesHash:m,flags:this.flags,onError:(e,t,n)=>S().error(`Expression with action id: action:${a} could not be run. Original condition was: ${r} - Evaluation ended up as:${t} - Result of evaluation was: ${null===n||void 0===n?void 0:n.toString()} - Error message:${e}`),onVerboseLog:(e,t)=>console.log(`Expression with action id: action:${a} was run. Original condition was: ${r} - Evaluation ended up as: ${e} - Result of evaluation was: ${null===t||void 0===t?void 0:t.toString()}`)})),n===Ls.ASSIGN_VALUE&&p&&this.variableService.updateVariable(p,t,m),{data:t,id:a,location:o,action:n,dataElementId:i,trackedEntityAttributeId:s,programStageId:l,programStageSectionId:d,optionGroupId:c,optionId:u,content:p,displayContent:h,style:E,name:y}}))),n})).filter((e=>e));return _l(this.outputConverter)({effects:h,dataElements:i,trackedEntityAttributes:s,formValues:{...l,...a},onProcessValue:this.valueProcessor.processValue})}setSelectedUserRoles(e){this.userRoles=e}setFlags(e){this.flags=e}getFlags(){return this.flags}}(Ul,Fl,Wl,Bs.WebClient);var zl=r(61554),Yl=r(13612);const ql=e=>[...new Map(e.map((e=>[e.id,e]))).values()],Kl=e=>{let{foundation:t,assignValueEffects:r,hideFieldEffects:n}=e;const a=t.getElements().filter((e=>{let{optionSet:t}=e;return t})).reduce(((e,t)=>{let{id:r,optionSet:n}=t;return e[r]={options:n.options,dataElementType:n.dataElement.type},e}),{});return r.map((e=>{var t,r;return!a[e.id]||(t=a[e.id],r=e.value,t.options&&null!==r&&""!==r&&(t.dataElementType===it.CO.MULTI_TEXT?r.split(",").every((e=>t.options.some((t=>t.value==e)))):t.options.some((e=>e.value==r))))||(e.value=null),e})),ql([...(o=n,o.map((e=>{let{id:t}=e;return{id:t,value:null,type:Ls.ASSIGN_VALUE}}))),...r]);var o};function Ql(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const r=t.getElementsById(),n=e.filter((e=>{let{targetDataType:t,id:n}=e;return!t||r[n]})),{[Ls.HIDE_FIELD]:a,[Ls.HIDE_SECTION]:o,[Ls.ASSIGN_VALUE]:i,rest:s}=n.reduce(((e,t)=>{const{type:r}=t;return[Ls.HIDE_FIELD,Ls.HIDE_SECTION,Ls.ASSIGN_VALUE].includes(r)?e[r].push(t):e.rest.push(t),e}),{[Ls.HIDE_FIELD]:[],[Ls.HIDE_SECTION]:[],[Ls.ASSIGN_VALUE]:[],rest:[]}),l=n.reduce(((e,t)=>(t.type===Ls.MAKE_COMPULSORY&&(e[t.id]=t),e)),{}),d=((e,t)=>e.flatMap((e=>{let{id:r}=e;const n=t.getSection(r);return n?[...n.elements.values()].map((e=>{let{id:t}=e;return{id:t,type:Ls.HIDE_FIELD}})):[]})))(o,t),c=((e,t,r)=>{const n=r.getElements().filter((e=>{let{compulsory:t}=e;return t})).reduce(((e,t)=>{let{id:r}=t;return e[r]=!0,e}),{}),a=e.filter((e=>{let{id:r}=e;return!(n[r]||t[r])}));return ql(a)})([...a,...d],l,t);return[...s,...c,...Kl({foundation:t,assignValueEffects:i,hideFieldEffects:a})]}const Xl=e=>e.reduce(((e,t)=>{const{type:r,id:n}=t;return e[r]=e[r]||{},e[r][n]=e[r][n]||[],e[r][n].push(t),e}),{}),Jl=e=>{let{program:t,orgUnit:r,currentEvent:n}=e;const{programRules:a,programRuleVariables:o}=t;return a.length?(n&&(n.programStageName=t.stage.untranslatedName),Xl(ed({orgUnit:r,currentEvent:n,programRules:a,programRuleVariables:o,stages:t.stages,foundationForPostProcessing:t.stage.stageForm}))):[]},Zl=function(e){let{program:t,stage:r,orgUnit:n,currentEvent:a,otherEvents:o,attributeValues:i,enrollmentData:s,formFoundation:l}=e,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{programRules:c,programRuleVariables:u}=((e,t,r)=>({programRuleVariables:e,programRules:[...t,...r||[]]}))(t.programRuleVariables,t.programRules,null===r||void 0===r?void 0:r.programRules),p=l||(r?r.stageForm:t.enrollment.enrollmentForm);if(!c.length)return[];var m;a&&(!a.programStageId&&r&&(a.programStageId=r.id),a.programStageName=null===(m=t.stages.get(a.programStageId))||void 0===m?void 0:m.untranslatedName);const g=ed({orgUnit:n,currentEvent:a,otherEvents:o,attributeValues:i,enrollmentData:s,stages:t.stages,programRules:c,programRuleVariables:u,trackedEntityAttributes:(h=t.attributes,h.reduce(((e,t)=>(e[t.id]={id:t.id,valueType:t.type,optionSetId:t.optionSet&&t.optionSet.id},e)),{})),foundationForPostProcessing:p});var h;return d?g:Xl(g)},ed=e=>{let{orgUnit:t,currentEvent:r,otherEvents:n,attributeValues:a,enrollmentData:o,stages:i,programRules:s,programRuleVariables:l,trackedEntityAttributes:d,foundationForPostProcessing:c}=e;const u=(e=>[...e.values()].flatMap((e=>e.stageForm.getElements())).reduce(((e,t)=>(e[t.id]={id:t.id,valueType:t.type,optionSetId:t.optionSet&&t.optionSet.id,name:t.formName||t.name},e)),{}))(i),p=zl.n.get(),m=function(e){const t={};return Object.keys(e).forEach((r=>{t[r]=function(e){const t=e.options.map((e=>({id:e.id,code:e.code,displayName:e.displayName})));return{id:e.id,displayName:e.displayName,options:t}}(e[r])})),t}(Yl.t.get());return Ql(Hl.getProgramRuleEffects({programRulesContainer:{programRuleVariables:l,programRules:s,constants:p},currentEvent:r,otherEvents:n,dataElements:u,trackedEntityAttributes:d,selectedEnrollment:o,selectedEntity:a,selectedOrgUnit:t,optionSets:m}),c)};var td=r(40701);function rd(e,t){return t.convertValues(e,Mi)}const nd=e=>Function(`return ${e}`)();function ad(e,t,r){if(!e)return;const n=Object.keys(e).reduce(((n,a)=>{const{type:o,onConvertOut:i,clientIgnore:s,featureType:l}=t[a]||{};if(s)return n;if(o){const t=e[a];n[a]=Mi(t,o)}else if(i){const o=t[a].clientId,s=e[a],d=nd(i);n[o]=d(s,r,l)}else n[a]=e[a];return n}),{});return n}function od(e,t,r,n){const a=e.formsValues[r]||{},o=n?{...a,[n.elementId]:n.value}:a,i=function(e,t){const r=Object.keys(e).filter((e=>e.startsWith(t))).reduce(((t,r)=>({...t,...e[r]})),{}),n=Object.keys(r).reduce(((e,t)=>(e[t]=r[t].valid,e)),{});return n}(e.formsSectionsFieldsUI,r),s=n?{...i,[n.elementId]:n.valid}:i,l=(d=o,c=s,Object.keys(d).filter((e=>c[e])).reduce(((e,t)=>({...e,[t]:d[t]})),{}));var d,c;const u=function(e,t){return rd(e,t)}(l,t);return u}function id(e,t,r,n){const a=`${r}-${t}`,o=e.dataEntriesFieldsUI[a],i=(s=o,Object.keys(s).reduce(((e,t)=>(e[t]=s[t].isValid,e)),{}));var s;const l=function(e,t){return Object.keys(e).reduce(((r,n)=>(r[n]=t[n]?e[n]:null,r)),{})}(e.dataEntriesFieldsValue[a],i);return ad(l,e.dataEntriesFieldsMeta[a],n)}const sd="UpdateRulesEffects",ld=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return l(sd)({rulesEffects:e,formId:t})},dd=e=>Et(e,it.CO.DATE),cd=(e,t)=>e.reduce(((e,r)=>{let{dataElement:n,value:a}=r;return t[n]&&(e[n]=Et(a,t[n].type)),e}),{}),ud=e=>{let{orgUnit:t,program:r,apiEnrollment:n,apiAttributeValues:a}=e;const[o,i]=(0,y.useState)(void 0),s=(0,y.useMemo)((()=>r.attributes.reduce(((e,t)=>(e[t.id]=t,e)),{})),[r.attributes]),l=(0,y.useMemo)((()=>a&&a.reduce(((e,t)=>{var r;let{id:n,value:a}=t;return e[n]=Et(a,null===(r=s[n])||void 0===r?void 0:r.type),e}),{})),[a,s]),d=(c=n,(0,y.useMemo)((()=>{if(!c)return;const{enrollment:e,enrolledAt:t,occurredAt:r}=c;return{enrolledAt:dd(t),occurredAt:r?dd(r):void 0,enrollmentId:e}}),[c]));var c;const u=((e,t)=>{const r=(0,y.useMemo)((()=>(e=>[...e.stages.values()].reduce(((e,t)=>{let{stageForm:r}=t;return{...e,...r.getElementsById()}}),{}))(t)),[t]);return(0,y.useMemo)((()=>e&&e.events.map((e=>({eventId:e.event,programId:e.program,programStageId:e.programStage,orgUnitId:e.orgUnit,trackedEntityInstanceId:e.trackedEntity,enrollmentId:e.enrollment,enrollmentStatus:e.enrollmentStatus,status:e.status,occurredAt:dd(e.occurredAt),scheduledAt:dd(e.scheduledAt),...cd(e.dataValues,r)})))),[r,e])})(n,r);return(0,y.useEffect)((()=>{if(t&&l&&d&&u){const e=Zl({program:r,orgUnit:t,otherEvents:u,attributeValues:l,enrollmentData:d},!0);Array.isArray(e)&&i(e)}}),[l,d,t,u,r]),o},pd=(e,t,r,n)=>{const{error:a,enrollment:o}=Us(t,r,n),{isLoading:i,isError:s,program:l}=Ji(n);(a||s)&&S().error((0,j.px)("Widget Event Edit could not be loaded")({enrollmentsError:a,programError:s}));const d=(0,y.useMemo)((()=>{var t;return e.allowGenerateNextVisit&&!i&&(null===l||void 0===l||null===(t=l.programStages)||void 0===t?void 0:t.map((t=>{var r,n;const a=null===o||void 0===o||null===(r=o.events)||void 0===r||null===(n=r.filter((e=>e.programStage===t.id)))||void 0===n?void 0:n.length,i=t.repeatable||e.id!==t.id&&0===a;return{id:t.id,isAvailableStage:i,eventCount:a,currentStage:t}})))}),[null===o||void 0===o?void 0:o.events,null===l||void 0===l?void 0:l.programStages,i,e.allowGenerateNextVisit,e.id]);return d?d.filter((e=>e.isAvailableStage)):[]},md=e=>{const{trackedEntityName:t,programName:r,scopeType:a}=es(e),o={[it.m2.EVENT_PROGRAM]:r,[it.m2.TRACKER_PROGRAM]:n.A.t("{{trackedEntityName}} in program{{escape}} {{programName}}",{trackedEntityName:t,escape:":",programName:r,interpolation:{escapeValue:!1}}),[it.m2.TRACKED_ENTITY_TYPE]:t};return a?o[a]:""},gd=e=>{let{optionSets:t,scopeType:r,trackedEntityType:n,trackedEntityTypeCollection:a,cachedTrackedEntityAttributes:o,dataEntryFormConfig:i,configIsFetched:s,program:l,locale:d}=e;const{serverVersion:{minor:c}}=(0,A.UK)(),{data:u,isLoading:p,error:m}=ri(["enrollmentForm",null===l||void 0===l?void 0:l.id],(()=>(async e=>{let{cachedOptionSets:t,cachedTrackedEntityType:r,trackedEntityTypeCollection:n,cachedProgram:a,cachedTrackedEntityAttributes:o,dataEntryFormConfig:i,locale:s,minorServerVersion:l}=e;const d=await ss(a,s);return new fd({cachedTrackedEntityAttributes:new Map(o.map((e=>[e.id,e]))),cachedOptionSets:new Map(t.map((e=>[e.id,e]))),cachedTrackedEntityTypes:new Map([[r.id,r]]),trackedEntityTypeCollection:new Map([[n.id,n]]),locale:s,dataEntryFormConfig:i,minorServerVersion:l}).build(a,d)})({cachedProgram:l,cachedTrackedEntityType:n,trackedEntityTypeCollection:a,cachedTrackedEntityAttributes:o,cachedOptionSets:t,dataEntryFormConfig:i,locale:d,minorServerVersion:c})),{enabled:r===it.m2.TRACKER_PROGRAM&&!!t&&!!n&&!!a&&!!l&&s});return{enrollment:u,isLoading:p,error:m}},hd={resource:"dataStore/capture/dataEntryForms"},Ed=e=>{let{selectedScopeId:t}=e;const{data:r,isFetched:n}=ni(["dataEntryFormConfig",t],hd,{enabled:!!t,select:e=>e[t]});return{dataEntryFormConfig:r,configIsFetched:n}},yd=Object.freeze({TRACKED_ENTITY_ATTRIBUTE:"TrackedEntityAttribute",ATTRIBUTE:"Attribute"}),vd=e=>{let{selectedScopeId:t}=e;const{program:r}=Ji(t,{enabled:!!t}),{locale:n}=us(),{scopeType:a,tetId:o}=es(t),{trackedEntityType:i}=cs(o,{enabled:!!o}),s=(0,y.useMemo)((()=>a===it.m2.TRACKER_PROGRAM&&r?r.programTrackedEntityAttributes.map((e=>{let{trackedEntityAttributeId:t}=e;return t})):a===it.m2.TRACKED_ENTITY_TYPE&&i?i.trackedEntityTypeAttributes.map((e=>{let{trackedEntityAttributeId:t}=e;return t})):void 0),[r,a,i]),{cachedTrackedEntityAttributes:l}=(e=>{let{selectedScopeId:t,attributeIds:r}=e;const{data:n,isLoading:a,isError:o}=ri(["cachedTrackedEntityAttributes",t],(()=>os(r)),{enabled:!!r});return{cachedTrackedEntityAttributes:n,isLoading:a,isError:o}})({selectedScopeId:t,attributeIds:s}),{optionSets:d}=Xi({selectedScopeId:t,attributes:l}),{dataEntryFormConfig:c,configIsFetched:u}=Ed({selectedScopeId:t}),{trackedEntityTypeCollection:p}=is({trackedEntityType:i,optionSets:d,dataEntryFormConfig:c,configIsFetched:u,locale:n}),{enrollment:m}=gd({program:r,optionSets:d,scopeType:a,trackedEntityType:i,trackedEntityTypeCollection:p,cachedTrackedEntityAttributes:l,selectedScopeId:t,dataEntryFormConfig:c,configIsFetched:u,locale:n});var g;return a===it.m2.TRACKED_ENTITY_TYPE&&p&&o?{name:p.name,formFoundation:null===p||void 0===p||null===(g=p.teiRegistration)||void 0===g?void 0:g.form,registrationMetaData:null===p||void 0===p?void 0:p.teiRegistration,formId:`registrationPageForm-${o}`}:a===it.m2.TRACKER_PROGRAM&&m&&r?{name:r.name,formFoundation:m.enrollmentForm,registrationMetaData:m,formId:`registrationPageForm-${r.id}`}:{formFoundation:null,formId:null,registrationMetaData:null}};class fd{static _addLabels(e,t){t.displayEnrollmentDateLabel&&(e.enrollmentDateLabel=t.displayEnrollmentDateLabel),t.displayIncidentDateLabel&&(e.incidentDateLabel=t.displayIncidentDateLabel)}static _addFlags(e,t){e.allowFutureEnrollmentDate=t.selectEnrollmentDatesInFuture,e.allowFutureIncidentDate=t.selectIncidentDatesInFuture,e.showIncidentDate=t.displayIncidentDate}static _getFeatureType(e){return e?Ot(e.toLowerCase()):"None"}constructor(e){let{cachedTrackedEntityAttributes:t,cachedOptionSets:r,cachedTrackedEntityTypes:n,trackedEntityTypeCollection:a,locale:o,dataEntryFormConfig:i,minorServerVersion:s}=e;this.locale=o,this.trackedEntityTypeCollection=a,this.cachedTrackedEntityAttributes=t,this.cachedTrackedEntityTypes=n,this.dataEntryFormConfig=i,this.dataElementFactory=new Hi({cachedTrackedEntityAttributes:t,cachedOptionSets:r,locale:o,minorServerVersion:s})}_buildTetFeatureTypeField(e,t){const r=e&&this.cachedTrackedEntityTypes.get(e);if(!r)return null;const n=r.featureType;return n&&["POINT","POLYGON"].includes(n)?Hi.buildtetFeatureType(n,t):null}async _buildTetFeatureTypeSection(e){const t=this.cachedTrackedEntityTypes.get(e),r=new it.wn((r=>{r.id=e,r.name=(null===t||void 0===t?void 0:t.displayName)||"",r.group=it.wn.groups.ENROLLMENT})),n=this._buildTetFeatureTypeField(e,r);return n?(n&&r.addElement(n),r):null}async _buildMainSection(e,t){const r=new it.wn((e=>{e.id=it.wn.MAIN_SECTION_ID,e.name=n.A.t("Profile"),e.group=it.wn.groups.ENROLLMENT}));if(null===e||void 0===e||!e.length)return null;if(t){const e=this._buildTetFeatureTypeField(t,r);e&&r.addElement(e)}return await this._buildElementsForSection(e,r),r}async _buildElementsForSection(e,t){return await e.asyncForEach((async e=>{if((null===e||void 0===e?void 0:e.type)===Qi.PLUGIN){const r=e.fieldMap.filter((e=>e.objectType===yd.ATTRIBUTE)).reduce(((e,t)=>(e[t.IdFromApp]=t,e)),{}),n=new qi.g((t=>{t.id=e.id,t.name=e.name,t.pluginSource=e.pluginSource,t.fields=new Map,t.customAttributes=r}));await e.fieldMap.asyncForEach((async e=>{if(e.objectType&&e.objectType===yd.TRACKED_ENTITY_ATTRIBUTE){const r=await this.dataElementFactory.build(e,t);if(!r)return;n.addField(e.IdFromPlugin,r)}})),n&&t.addElement(n)}else{const r=await this.dataElementFactory.build(e,t);r&&t.addElement(r)}})),t}async _buildSection(e,t,r,n){if(null===e||void 0===e||!e.length)return null;const a=new it.wn((e=>{e.id=r,e.name=t,e.displayDescription=n,e.group=it.wn.groups.ENROLLMENT}));return await this._buildElementsForSection(e,a),a}async _buildCustomEnrollmentForm(e,t,r){if(!r)return null;let n=new it.wn((e=>{e.id=it.wn.MAIN_SECTION_ID,e.group=it.wn.groups.ENROLLMENT}));n.showContainer=!1,n=await this._buildElementsForSection(r,n),n&&e.addSection(n);try{n.customForm=new it.ii((e=>{e.id=t.id})),n.customForm.setData(t.htmlCode,zi)}catch(a){S().error((0,j.px)(fd.errorMessages.CUSTOM_FORM_TEMPLATE_ERROR)({template:t.htmlCode,error:a,method:"buildEnrollment"}))}return e}async _buildEnrollmentForm(e,t){const r=null===e||void 0===e?void 0:e.programTrackedEntityAttributes,a=new it.k3((t=>{t.featureType=fd._getFeatureType(e.featureType),t.name=e.displayName}));let o;if(e.dataEntryForm)e.trackedEntityTypeId&&(o=await this._buildTetFeatureTypeSection(e.trackedEntityTypeId),o&&a.addSection(o)),await this._buildCustomEnrollmentForm(a,e.dataEntryForm,r);else if(null!==t&&void 0!==t&&t.length||this.dataEntryFormConfig){if(e.trackedEntityTypeId&&(o=await this._buildTetFeatureTypeSection(e.trackedEntityTypeId),o&&a.addSection(o)),r){const e=r.reduce(((e,t)=>(t.trackedEntityAttributeId&&(e[t.trackedEntityAttributeId]=t),e)),{});this.dataEntryFormConfig?this.dataEntryFormConfig.asyncForEach((async r=>{var i,s,l;const d=r.elements.reduce(((t,r)=>{if(r.type===Qi.PLUGIN){var n;const a=null===(n=r.fieldMap)||void 0===n?void 0:n.map((t=>({...t,...e[t.IdFromApp]})));return t.push({...r,fieldMap:a}),t}const a=e[r.id];return a&&t.push(a),t}),[]),c=null===t||void 0===t?void 0:t.find((e=>e.id===r.id));!c&&t&&t.length>0&&S().warn((0,j.px)("Could not find metadata for section. This could indicate that your form configuration may be out of sync with your metadata.")({sectionId:r.id})),o=await this._buildSection(d,null!==(i=null!==(s=r.name)&&void 0!==s?s:null===c||void 0===c?void 0:c.displayFormName)&&void 0!==i?i:n.A.t("Profile"),r.id,null!==(l=null===c||void 0===c?void 0:c.displayDescription)&&void 0!==l?l:""),o&&a.addSection(o)})):t&&t.asyncForEach((async t=>{o=await this._buildSection(t.trackedEntityAttributes.map((t=>e[t])),t.displayFormName,t.id,t.displayDescription),o&&a.addSection(o)}))}}else o=await this._buildMainSection(r,e.trackedEntityTypeId),o&&a.addSection(o);return a}static _buildSearchGroupElement(e,t){return new it.fq((r=>{r.id=e.id,r.name=e.name,r.shortName=e.shortName,r.formName=e.formName,r.description=e.description,r.displayInForms=!0,r.displayInReports=e.displayInReports,r.compulsory=e.compulsory,r.disabled=e.disabled,r.type=t.valueType,r.optionSet=e.optionSet}))}_buildInputSearchGroupFoundation(e,t){const r=(e.programTrackedEntityAttributes||[]).reduce(((e,t)=>{if(!t.trackedEntityAttributeId)return S().error((0,j.px)("TrackedEntityAttributeId missing from programTrackedEntityAttribute")({programTeiAttribute:t})),e;const r=this.cachedTrackedEntityAttributes.get(t.trackedEntityAttributeId);return r?e[r.id]=r:S().error((0,j.px)("could not retrieve tei attribute")({programTeiAttribute:t})),e}),{}),n=t.searchForm,a=new it.k3,o=new it.wn((e=>{e.id=it.wn.MAIN_SECTION_ID,e.group=it.wn.groups.ENROLLMENT}));return Array.from(n.getSection(it.wn.MAIN_SECTION_ID).elements.entries()).map((e=>e[1])).forEach((e=>{const t=fd._buildSearchGroupElement(e,r[e.id]);t&&o.addElement(t)})),a.addSection(o),a}_buildInputSearchGroups(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).filter((e=>!e.unique)).map((t=>new it.Me((r=>{r.id=t.id,r.minAttributesRequiredToSearch=t.minAttributesRequiredToSearch,r.searchFoundation=this._buildInputSearchGroupFoundation(e,t)}))))}async build(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=new it.RQ((r=>{if(fd._addLabels(r,e),fd._addFlags(r,e),e.trackedEntityTypeId){const t=this.trackedEntityTypeCollection.get(e.trackedEntityTypeId);t&&(r.trackedEntityType=t)}r.inputSearchGroups=this._buildInputSearchGroups(e,t)}));return r.enrollmentForm=await this._buildEnrollmentForm(e,e.programSections),r}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(fd,"errorMessages",{CUSTOM_FORM_TEMPLATE_ERROR:"Error in custom form template"});var Id=r(51001);function bd(e){return!!e&&(0,Id.A)(e)&&e.length>0}function Sd(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Td{static _getDataElementType(e){return{}[e]||e}constructor(e,t,r){this.locale=t,this.minorServerVersion=r,this.optionSetFactory=new It(e,t)}_getDataElementTranslation(e,t){return this.locale&&e.translations[this.locale]&&e.translations[this.locale][t]}async _setBaseProperties(e,t,r){e.id=r.id,e.name=this._getDataElementTranslation(r,Td.propertyNames.NAME)||r.displayName,e.code=r.code,e.shortName=this._getDataElementTranslation(r,Td.propertyNames.SHORT_NAME)||r.displayShortName,e.formName=this._getDataElementTranslation(r,Td.propertyNames.FORM_NAME)||r.displayFormName,e.description=this._getDataElementTranslation(r,Td.propertyNames.DESCRIPTION)||r.description,e.displayInForms=!0,e.displayInReports=t.displayInReports,e.compulsory=t.compulsory,e.disabled=!1,e.icon=yt(r.style),e.url=r.url,r.optionSet&&r.optionSet.id&&(e.optionSet=await this.optionSetFactory.build(e,r.optionSet.id,t.renderOptionsAsRadio,t.renderType&&t.renderType.DESKTOP&&t.renderType.DESKTOP.type,Td._getDataElementType))}async _buildBaseDataElement(e,t,r,n){const a=new it.fq;return a.section=n,a.type=r,await this._setBaseProperties(a,e,t),Gi(a,this.minorServerVersion)}async _buildDateDataElement(e,t){const r=new it.H;return r.type=it.CO.DATE,r.allowFutureDate=e.allowFutureDate,await this._setBaseProperties(r,e,t),r}async build(e,t,r){const n=r||await ve().get(z.DATA_ELEMENTS,e.dataElementId);if(!n)return S().error((0,j.px)("could not find underlying dataElement for programStageDataElement")({programStageDataElement:e})),null;const a=Td._getDataElementType(n.valueType);return a===it.CO.DATE?this._buildDateDataElement(e,n):this._buildBaseDataElement(e,n,a,t)}}Sd(Td,"propertyNames",{NAME:"NAME",DESCRIPTION:"DESCRIPTION",SHORT_NAME:"SHORT_NAME",FORM_NAME:"FORM_NAME"}),Sd(Td,"errorMessages",{MULIT_TEXT_WITH_NO_OPTIONS_SET:"could not create the metadata because a MULIT_TEXT without associated option sets was found"});class Ad{constructor(e){this.cachedRelationshipTypes=e}_relationshipConstraintIsStage(e){return e.relationshipEntity===Ad.RELATIONSHIP_ENTITY_NAME&&(!e.programStage&&e.program&&e.program.id===this.currentProgramId||e.programStage&&e.programStage.id===this.currentProgramStageId)}_convertConstraint(e){const t={entity:e.relationshipEntity,programId:e.program?e.program.id:null,programStageId:e.programStage?e.programStage.id:null,trackedEntityTypeId:e.trackedEntityType?e.trackedEntityType.id:null};return!t.programStageId&&this._relationshipConstraintIsStage(e)&&(t.programStageId=this.currentProgramStageId),t}_buildRelationshipType(e){return new it.FF((t=>{t.id=e.id,t.name=e.displayName,t.from=this._convertConstraint(e.fromConstraint),t.to=this._convertConstraint(e.toConstraint),t.access=e.access}))}build(e,t){this.currentProgramId=e,this.currentProgramStageId=t;return this.cachedRelationshipTypes.filter((e=>e.access.data.read&&(this._relationshipConstraintIsStage(e.fromConstraint)||this._relationshipConstraintIsStage(e.toConstraint)))).map((e=>this._buildRelationshipType(e)))}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Ad,"RELATIONSHIP_ENTITY_NAME","PROGRAM_STAGE_INSTANCE");class Cd{constructor(e){let{cachedOptionSets:t,cachedRelationshipTypes:r,cachedDataElements:n,locale:a,minorServerVersion:o,dataEntryFormConfig:i}=e;this.cachedOptionSets=t,this.locale=a,this.relationshipTypesFactory=new Ad(r),this.cachedDataElements=n,this.dataElementFactory=new Td(t,a,o),this.dataEntryFormConfig=i}async _buildSection(e,t){const r=new it.wn((e=>{e.id=t.id,e.name=t.displayName,e.displayDescription=t.displayDescription}));return t.dataElements&&await t.dataElements.asyncForEach((async t=>{if(t.type===Qi.PLUGIN){const n=t.fieldMap.filter((e=>e.objectType===yd.ATTRIBUTE)).reduce(((e,t)=>(e[t.IdFromApp]=t,e)),{}),a=new qi.g((e=>{e.id=t.id,e.name=t.name,e.pluginSource=t.pluginSource,e.fields=new Map,e.customAttributes=n}));await t.fieldMap.asyncForEach((async n=>{if(n.objectType&&n.objectType===yd.TRACKED_ENTITY_ATTRIBUTE){const o=n.dataElementId,i=e[o];if(!i)return void S().error((0,j.px)("could not find programStageDataElement")({sectionDataElement:t}));const s=await this.dataElementFactory.build(i,r);s&&a.addField(n.IdFromPlugin,s)}})),a&&r.addElement(a)}else{var n;const a=t.id,o=e[a],i=null===(n=this.cachedDataElements)||void 0===n?void 0:n.get(o.dataElementId);if(!o)return void S().error((0,j.px)("could not find programStageDataElement")({sectionDataElement:t}));const s=await this.dataElementFactory.build(o,r,i);s&&r.addElement(s)}})),r}async _buildMainSection(e){const t=new it.wn((e=>{e.id=it.wn.MAIN_SECTION_ID}));return e&&await e.asyncForEach((async e=>{var r;const n=null===(r=this.cachedDataElements)||void 0===r?void 0:r.get(e.dataElementId),a=await this.dataElementFactory.build(e,t,n);a&&t.addElement(a)})),t}static _convertProgramStageDataElementsToObject(e){return e?e.reduce(((e,t)=>(e[t.dataElementId]=t,e)),{}):{}}static _getFeatureType(e){return e.featureType?Ot(e.featureType.toLowerCase()):"None"}async build(e,t){const r=new it.BN((r=>{r.id=e.id,r.name=e.displayName,r.untranslatedName=e.name,r.relationshipTypes=this.relationshipTypesFactory.build(t,e.id),r.enableUserAssignment=!!e.enableUserAssignment,r.autoGenerateEvent=!!e.autoGenerateEvent,r.allowGenerateNextVisit=!!e.allowGenerateNextVisit,r.askCompleteEnrollmentOnEventComplete=!!e.remindCompleted,r.access=e.access,r.hideDueDate=!!e.hideDueDate,r.openAfterEnrollment=!!e.openAfterEnrollment,r.generatedByEnrollmentDate=!!e.generatedByEnrollmentDate,r.reportDateToUse=e.reportDateToUse,r.minDaysFromStart=e.minDaysFromStart,r.blockEntryForm=!!e.blockEntryForm,r.repeatable=e.repeatable,r.stageForm=new it.k3((t=>{t.id=e.id,t.name=e.displayName,t.description=e.description,t.featureType=Cd._getFeatureType(e),t.access=e.access,t.addLabel({id:"occurredAt",label:e.displayExecutionDateLabel||"Report date"}),t.addLabel({id:"scheduledAt",label:e.displayDueDateLabel||"Scheduled date"}),t.validationStrategy=e.validationStrategy&&st(e.validationStrategy)})),r.icon=yt(e.style)})),n=r.stageForm;if("CUSTOM"===e.formType&&e.dataEntryForm){const t=await this._buildMainSection(e.programStageDataElements);t.showContainer=!1,n.addSection(t);const r=e.dataEntryForm;try{t.customForm=new it.ii((e=>{e.id=r.id})),t.customForm.setData(r.htmlCode,Yi)}catch(a){S().error((0,j.px)(Cd.CUSTOM_FORM_TEMPLATE_ERROR)({template:r.htmlCode,error:a}))}}else if(this.dataEntryFormConfig){const t=e.programStageDataElements.reduce(((e,t)=>(e[t.dataElementId]=t,e)),{});await this.dataEntryFormConfig.asyncForEach((async r=>{const a=r.elements.reduce(((e,r)=>{if(r.type===Qi.PLUGIN){var n;const a=null===(n=r.fieldMap)||void 0===n?void 0:n.map((e=>({...e,...t[e.IdFromApp]})));return e.push({...r,fieldMap:a}),e}const a=t[r.id];return a&&e.push({...a,id:r.id}),e}),[]);if(bd(a)){var o;const t=Cd._convertProgramStageDataElementsToObject(e.programStageDataElements),i=null===(o=e.programStageSections)||void 0===o?void 0:o.find((e=>e.id===r.id)),s=await this._buildSection(t,{id:r.id,displayName:(null===i||void 0===i?void 0:i.displayName)||r.name,displayDescription:(null===i||void 0===i?void 0:i.displayDescription)||"",dataElements:a});n.addSection(s)}}))}else if(bd(e.programStageSections)){const t=Cd._convertProgramStageDataElementsToObject(e.programStageDataElements);await e.programStageSections.asyncForEach((async e=>{n.addSection(await this._buildSection(t,{id:e.id,displayName:e.displayName,displayDescription:e.displayDescription,dataElements:e.dataElements}))}))}else n.addSection(await this._buildMainSection(e.programStageDataElements));return r}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Cd,"CUSTOM_FORM_TEMPLATE_ERROR","Error in custom form template");class Od{constructor(e){this.cachedCategories=e}build(e){return new it.b7((t=>{const r=e.id;t.id=r;const n=this.cachedCategories[r];n?t.name=n.displayName:S().error((0,j.px)("Could not retrieve cachedCategory")({id:r}))}))}}async function Nd(e,t,r){const{predicate:n,project:a}=r;if(ve().adapterType===ne)return function(e,t,r){const n=ve(),a=e.map((e=>n.get(z.CATEGORY_OPTIONS,e).then((e=>t(e)?r(e):null))));return Promise.all(a).then((e=>e.filter((e=>e))))}(t,n,a);const o=await async function(e,t,r){let{predicate:n,project:a,onIsAborted:o}=r;const i=ve();return await i.getAll(z.CATEGORY_OPTIONS,{predicate:e=>!!t[e.id]&&n(e),project:a,onIsAborted:o,onIDBGetRequest:t=>t.index("categoryId").openCursor(IDBKeyRange.only(e))})}(e,t,r);return o}async function Rd(e,t){const r=await async function(e){const t=ve();return(await t.get(z.CATEGORY_OPTIONS_BY_CATEGORY,e)).options}(e);return Nd(e,r,t)}class wd{constructor(e,t,r,n,a,o,i,s){this.trackedEntityTypeCollection=o,this.programStageFactory=new Cd({cachedOptionSets:e,cachedRelationshipTypes:t,locale:i,minorServerVersion:s}),this.enrollmentFactory=new fd({cachedTrackedEntityAttributes:r,cachedOptionSets:e,cachedTrackedEntityTypes:n,trackedEntityTypeCollection:o,locale:i,minorServerVersion:s}),this.searchGroupFactory=new Ct({cachedTrackedEntityAttributes:r,cachedOptionSets:e,locale:i}),this.dataElementFactory=new Hi({cachedTrackedEntityAttributes:r,cachedOptionSets:e,locale:i,minorServerVersion:s}),this.categoryFactory=new Od(a)}_buildCategories(e){return new Map(e.map((e=>[e.id,this.categoryFactory.build(e)])))}_buildCategoryCombination(e){return e&&!e.isDefault&&e.categories&&e.categories.length>0?new it.C((t=>{t.name=e.displayName,t.id=e.id,t.categories=this._buildCategories(e.categories,this.cachedCategories)})):null}async _buildProgramAttributes(e){const t=e.map((async e=>await this.dataElementFactory.build(e)));return(await Promise.all(t)).filter((e=>e))}async build(e){var t;let r;if("WITHOUT_REGISTRATION"===e.programType){r=new it.jV((t=>{t.id=e.id,t.access=e.access,t.name=e.displayName,t.shortName=e.displayShortName,t.categoryCombination=this._buildCategoryCombination(e.categoryCombo)}));const t=e.programStages&&e.programStages[0];r.stage=await this.programStageFactory.build(t,r.id)}else r=new it.rr((t=>{t.id=e.id,t.access=e.access,t.name=e.displayName,t.shortName=e.displayShortName,t.trackedEntityType=this.trackedEntityTypeCollection.get(e.trackedEntityTypeId)})),e.programTrackedEntityAttributes&&(r.searchGroups=await this.searchGroupFactory.build(e.programTrackedEntityAttributes,e.minAttributesRequiredToSearch),r.attributes=await this._buildProgramAttributes(e.programTrackedEntityAttributes)),await e.programStages.asyncForEach((async e=>{r.addStage(await this.programStageFactory.build(e,r.id))})),r.enrollment=await this.enrollmentFactory.build(e,r.searchGroups);return r.organisationUnits=null===(t=await ve().get(z.ORGANISATION_UNITS_BY_PROGRAM,r.id))||void 0===t?void 0:t.organisationUnits,r.icon=yt(e.style),r.displayFrontPageList=e.displayFrontPageList,r.onlyEnrollOnce=e.onlyEnrollOnce,r.useFirstStageDuringRegistration=e.useFirstStageDuringRegistration,r}}const _d=[{regExp:new RegExp("([^\\w\\d])(and)([^\\w\\d])","gi"),replacement:"$1&&$3"},{regExp:new RegExp("([^\\w\\d])(or)([^\\w\\d])","gi"),replacement:"$1||$3"},{regExp:new RegExp("V{execution_date}","g"),replacement:"V{event_date}"}];function Pd(e){return _d.reduce(((e,t)=>e=e.replace(t.regExp,t.replacement)),e)}function kd(e){return e.match(/[A#]{\w+.?\w*}/g)||[]}function Dd(e,t){const r=function(e){return e&&(0,ki.A)(e)?e.replace(/^[#VCAvca]{/,"").replace(/}$/,""):e}(e),n=r.split(".");let a;return a=2===n.length?{id:r,displayName:r,programRuleVariableSourceType:nl.DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE,valueType:"TEXT",programStageId:n[0],dataElementId:n[1],programId:t}:{id:r,displayName:r,programRuleVariableSourceType:nl.TEI_ATTRIBUTE,valueType:"TEXT",trackedEntityAttributeId:n[0],programId:t},a}function Ud(e,t,r){const n=function(e,t){return e.condition.indexOf("V{value_count}")>=0||t.data.indexOf("V{value_count}")>=0}(e,t);n&&function(e,t,r){let n=r.reduce(((e,t,r)=>{const n=`d2:count('${t.displayName}')`;return e+(0!==r?` + ${n}`:`${n}`)}),"");n=`(${n})`,e.condition=e.condition.replace(new RegExp("V{value_count}","g"),n),t.data=t.data.replace(new RegExp("V{value_count}","g"),n)}(e,t,r)}function Ld(e,t,r){const n=function(e,t){return e.condition.indexOf("V{zero_pos_value_count}")>=0||t.data.indexOf("V{zero_pos_value_count}")>=0}(e,t);n&&function(e,t,r){let n=r.reduce(((e,t,r)=>{const n=`d2:countifzeropos('${t.displayName}')`;return e+(0!==r?` + ${n}`:`${n}`)}),"");n=`(${n})`,e.condition=e.condition.replace(new RegExp("V{zero_pos_value_count}","g"),n),t.data=t.data.replace(new RegExp("V{zero_pos_value_count}","g"),n)}(e,t,r)}function Fd(e,t){const r={id:e.id,content:e.name,displayContent:e.displayName,data:e.expression,programRuleActionType:"DISPLAYKEYVALUEPAIR",location:"indicators",style:e.style||null},n={id:e.id,condition:e.filter?e.filter:"true",description:e.description,name:e.name,displayName:e.displayName,programId:e.programId,programRuleActions:[r]},{variables:a,variableObjectsCurrentExpression:o}=function(e,t,r){const n=kd(t.condition),a=kd(e.data),o=n.map((e=>Dd(e,r))),i=a.map((e=>Dd(e,r)));return{variables:[...o,...i],variableObjectsCurrentExpression:i}}(r,n,t);return Ud(n,r,o),Ld(n,r,o),r.data=Pd(r.data),n.condition=Pd(n.condition),{rule:n,variables:a}}function xd(e,t){return e.map((e=>Fd(e,t))).filter((e=>e)).reduce(((e,t)=>(e.rules=e.rules||[],e.rules.push(t.rule),e.variables=e.variables?[...e.variables,...t.variables]:t.variables,e)),{rules:null,variables:null})}function Md(e,t,r,n){null!=e&&(function(e){return e.sort(((e,t)=>e.name===t.name?0:e.name>t.name?1:-1)),e}(e).forEach((e=>{Nt.Jj.set(e.id,e)})),t&&function(e){const t=e.reduce(((e,t)=>{const r=t.programId;return e[r]=e[r]||[],e[r].push(t),e}),{});Object.keys(t).forEach((e=>{const r=t[e],n=Nt.Jj.get(e);n&&(n.programRuleVariables=r)}))}(t),r&&function(e){const t=e.reduce(((e,t)=>{const r=t.programId;return e[r]=e[r]||[],e[r].push(t),e}),{});Object.keys(t).forEach((e=>{const r=t[e],n=Nt.Jj.get(e);if(n){const e=r.filter((e=>!e.programStageId)),t=r.filter((e=>e.programStageId)).reduce(((e,t)=>(e[t.programStageId]=e[t.programStageId]||[],e[t.programStageId].push(t),e)),{});n.programRules=e,Object.keys(t).forEach((e=>{const r=t[e],a=n.getStage(e);a&&(a.programRules=r)}))}}))}(r),n&&function(e){const t=e.reduce(((e,t)=>{const r=t.programId;return e[r]=e[r]||[],e[r].push(t),e}),{});Object.keys(t).forEach((e=>{const r=t[e],n=Nt.Jj.get(e);if(n){const{rules:t,variables:a}=xd(r,e);t&&n.addProgramRules(t),a&&n.addProgramRuleVariables(a)}}))}(n))}async function Vd(e){let{cachedOptionSets:t,cachedTrackedEntityAttributes:r,cachedTrackedEntityTypes:n,trackedEntityTypeCollection:a,locale:o,minorServerVersion:i}=e;const[s,l,d,c,u,p]=await async function(){const e=ve(),t=function(e,t){return e.getAll(t)}(e,z.PROGRAMS),r=function(e,t){return e.getAll(t)}(e,z.PROGRAM_RULES_VARIABLES),n=function(e,t){return e.getAll(t)}(e,z.PROGRAM_RULES),a=function(e,t){return e.getAll(t)}(e,z.PROGRAM_INDICATORS),o=function(e,t){return e.getAll(t)}(e,z.RELATIONSHIP_TYPES),i=function(e,t){return e.getAll(t).then((e=>e.reduce(((e,t)=>(e[t.id]=t,e)),{})))}(e,z.CATEGORIES);return Promise.all([t,r,n,a,o,i])}(),m=await function(e,t,r,n,a,o,i,s,l){const d=new wd(t,r,n,a,o,i,s,l),c=e.filter((e=>{var t,r;if("WITHOUT_REGISTRATION"===e.programType)return!0;if(!e.trackedEntityTypeId)return!1;const{read:n}=(null===(t=i.get(e.trackedEntityTypeId))||void 0===t||null===(r=t.access)||void 0===r?void 0:r.data)||{};return n})).map((e=>d.build(e)));return Promise.all(c)}(s,t,u,r,n,p,a,o,i);Md(m,l,d,c)}async function jd(e){const t=await async function(e){return ve().getAll(e)}(e);zl.n.set(t)}function Gd(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=ve(),a=t.map((e=>n.getAll(e)));return Promise.all(a).then((e=>e.reduce(((e,r,n)=>(e[t[n]]=r.reduce(((e,t)=>(e.set(t.id,t),e)),new Map),e)),{})))}async function Bd(e,t){const{[z.TRACKED_ENTITY_TYPES]:r,[z.TRACKED_ENTITY_ATTRIBUTES]:n,[z.OPTION_SETS]:a}=await Gd(z.TRACKED_ENTITY_ATTRIBUTES,z.OPTION_SETS,z.TRACKED_ENTITY_TYPES),o=await async function(e){let{cachedTrackedEntityTypes:t,cachedTrackedEntityAttributes:r,cachedOptionSets:n,locale:a,minorServerVersion:o}=e;const i=new as({cachedTrackedEntityAttributes:r,cachedOptionSets:n,locale:a,minorServerVersion:o});return await[...t.values()].asyncForEach((async e=>{const t=await i.build(e);Nt.zK.set(t.id,t)})),Nt.zK}({cachedTrackedEntityTypes:r,cachedTrackedEntityAttributes:n,cachedOptionSets:a,locale:e,minorServerVersion:t}),i=Vd({cachedTrackedEntityTypes:r,cachedTrackedEntityAttributes:n,cachedOptionSets:a,trackedEntityTypeCollection:o,locale:e,minorServerVersion:t}),s=jd(z.CONSTANTS);!function(e){Yl.t.set(e)}(a),await Promise.all([i,s])}async function $d(e){const t=e||await async function(){return ye().getAll(H.SYSTEM_SETTINGS)}(),r=new it.Xl;t.forEach((e=>{r[e.id]=e.value})),r.trackerAppRelativePath="dhis-web-tracker-capture",Nt.sI.set(r)}function Wd(e){!function(e){n.A.changeLanguage(e)}(e),n.A.setDefaultNamespace("default")}async function Hd(e){const t=e;await function(e){return"en"===e?($().locale(e),Promise.resolve()):new Promise((t=>{r(97535)(`./${e}`).then((()=>{$().locale(e),S().info(`got moment locale config for ${e}`),t()})).catch((()=>{$().locale("en"),S().error(`could not get moment locale config for ${e}`),t()}))}))}(t);const a=$().weekdays(),o=$().weekdaysShort(),i=$().localeData()._week.dow;await function(e,t,a,o){return new Promise(((i,s)=>{r(45455)(`./${e}/index.js`).then((r=>{const s={dateFnsLocale:r,weekDays:t,weekDaysShort:a,calendarFormatHeaderLong:"dddd D MMM",calendarFormatHeaderShort:"D MMM",selectDatesText:n.A.t("Choose one or more dates..."),selectDateText:n.A.t("Choose a date..."),todayLabelShort:n.A.t("Today"),todayLabelLong:n.A.t("Today"),weekStartsOn:o};S().info(`got date-fns locale for ${e}`),W.set(s),i()})).catch((()=>{S().error(`could not get date-fns locale config for ${e}, fallback to en`),Promise.resolve().then(r.t.bind(r,5566,23)).then((e=>{const r={dateFnsLocale:e,weekDays:t,weekDaysShort:a,calendarFormatHeaderLong:"dddd D MMM",calendarFormatHeaderShort:"D MMM",selectDatesText:n.A.t("Choose one or more dates..."),selectDateText:n.A.t("Choose a date..."),todayLabelShort:n.A.t("Today"),todayLabelLong:n.A.t("Today"),weekStartsOn:o};W.set(r),i()})).catch((()=>{S().error(`could not get the fallback date-fns locale for ${e}`),s()}))}))}))}(t,a,o,i),Wd(t)}async function zd(e,t){const r=await async function(e,t){const r=[{id:"dateFormat",value:t.dateFormat.toUpperCase()},{id:"dir",value:ot(e)?"rtl":"ltr"},{id:"serverTimeZoneId",value:t.serverTimeZoneId}],n=ye();return await n.setAll(H.SYSTEM_SETTINGS,r),r}(e,t);await $d(r)}async function Yd(e,t,r){!function(){let e={[F.dev]:S().levels.DEBUG,[F.devDebug]:S().levels.TRACE,[F.test]:S().levels.INFO,[F.prod]:S().levels.ERROR}.production;e||0===e||(e=S().levels.ERROR),S().setLevel(e)}();const a=await t({resource:"userSettings"}),o=await t({resource:"me",params:{fields:"id,userRoles"}});Hl.setSelectedUserRoles(o.userRoles.map((e=>{let{id:t}=e;return t})));const i=await t({resource:"system/info",params:{fields:"dateFormat,serverTimeZoneId"}});try{await Ee(e,o)}catch(d){throw new k(n.A.t("A possible reason for this is that the browser or mode (e.g. privacy mode) is not supported. See log for details."),d)}const s=a.keyUiLocale,l=a.keyDbLocale;await Hd(s),await zd(s,i),await async function(e,t,r){await at(t),await Bd(e,r)}(l,t,r)}var qd=r(28100),Kd=r(33996),Qd=r(8325),Xd=r(52086),Jd=r(30436);const Zd=e=>(t,r)=>function(e,t,r,n){if((0,Q.A)(e)&&null!==e||(e=n),r[t.type])return r[t.type](e,t);return e}(t,r,e.updaters,e.initValue),ec=e=>{const t=(e=>(t,r)=>{S().trace(`Updater for ${r.type} started in ${e.name}. \n                Starting state is: ${JSON.stringify(t)}`)})(e),r=(e=>(t,r)=>{S().trace(`Updater for ${r.type} executed in ${e.name}. \n                New state is: ${JSON.stringify(t)}`)})(e);return(n,a)=>{const o=(e=>{const t=e.meta&&e.meta.skipLogging&&e.meta.skipLogging.reduce(((e,t)=>(e[t]=null,e)),{});return{...e,payload:{...e.payload,...t}}})(a);S().trace(`reducer ${e.name} starting. Action is: ${JSON.stringify(o)}`);const i=function(e,t,r,n,a,o){if((0,Q.A)(e)&&null!==e||(e=n),r[t.type]){a(e,t);const n=r[t.type](e,t);return o(e,t),n}return e}(n,a,e.updaters,e.initValue,t,r);return S().trace(`reducer ${e.name} finished`),i}};function tc(e){let t="production"===F.prod?Zd(e):ec(e);return e.reducerWrappers&&(t=function(e,t){return(0,oe.default)(t)?t.reduceRight(((e,t)=>t(e)),e):t(e)}(t,e.reducerWrappers)),t}function rc(e,t){return{initValue:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},name:t,updaters:e,reducerWrappers:arguments.length>3?arguments[3]:void 0}}var nc=r(42362),ac=r(67309);const oc="post",ic="update",sc="delete",lc=(()=>{const e={[oc]:"create",[ic]:"replace",[sc]:"delete"};return t=>r=>{let{url:n,method:a,data:o}=r;return t({resource:n,type:e[a],data:o})}})();var dc=r(49074);function cc(e){return e&&e.meta&&e.meta.offline&&e.meta.offline.effect?e.meta.offline.effect:{}}const uc={...dc.default,enqueue(e,t){const r=cc(t);if(r.clientId){return[...e.filter((e=>{const t=cc(e);return!(t.clientId===r.clientId&&t.method===r.method)})),t]}return[...e,t]},dequeue(e,t){const[r,...n]=e,a=cc(r);return a.method===oc?n.map((e=>{const n=cc(e);if(n.clientId===a.clientId&&n.updateOnDequeueCallback){return(o=n.updateOnDequeueCallback,Function(`return ${o}`)())(e,r,t)}var o;return e})).filter((e=>e)):n}},pc="network",mc="access",gc="unknown",hc=e=>{if(null===e||void 0===e||!e.type)return!1;switch(e.type){case pc:return!1;case mc:return(e=>{let{details:{httpStatusCode:t}}=e;return 401!==t})(e);case gc:return(e=>{let{message:t}=e;const r=t.match(/\(\d*\)$/);if(r){const e=r[0].replace(/[()]/g,"");return Boolean(e)&&![408,429,502,503,504].includes(e)}return!1})(e);default:return!1}};function Ec(){const e=z.REDUX_PERSIST,t=ve();return{setItem:(r,n)=>t.set(e,{id:r,value:n}),getItem:(r,n)=>{t.get(e,r).then((e=>{n(null,e&&e.value)})).catch((e=>{n(e,null)}))},removeItem:r=>t.remove(e,r),getAllKeys:r=>{t.getKeys(e).then((e=>{r(null,e)})).catch((e=>{r(e,null)}))}}}var yc=r(93582);const vc="FieldsValidated",fc="FieldIsValidating",Ic="StartUpdateFieldAsync",bc="UpdateFieldFromAsync",Sc="AsyncUpdateFieldFailed";function Tc(){return Tc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tc.apply(this,arguments)}function Ac(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Cc=e=>class extends y.Component{constructor(){var e;super(...arguments),e=this,Ac(this,"handleIsValidating",(function(){const{id:t}=e.props;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];e.props.onIsValidating(...n,t)})),Ac(this,"handleFieldsValidated",(function(){const{id:t}=e.props;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];e.props.onFieldsValidated(...n,t)})),Ac(this,"handleUpdateFieldAsyncInner",(function(){const{onUpdateFieldAsyncInner:t,onUpdateFieldAsync:r}=e.props;for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];t(...a,r)}))}render(){const{onIsValidating:t,onFieldsValidated:r,onUpdateFieldAsyncInner:n,onUpdateFieldAsync:a,...o}=this.props;return y.createElement(e,Tc({onIsValidating:this.handleIsValidating,onFieldsValidated:this.handleFieldsValidated,onUpdateFieldAsync:this.handleUpdateFieldAsyncInner},o))}},Oc=()=>({}),Nc=e=>({onIsValidating:(t,r,a,o,i,s)=>{const d=((e,t,r,a,o,i)=>l(fc)({fieldId:e,formBuilderId:t,formId:r,message:a||n.A.t("This value is validating"),fieldUIUpdates:o,validatingUid:i}))(t,r,s,o,i,a);e(d)},onFieldsValidated:(t,r,n,a)=>{const o=((e,t,r,n)=>l(vc)({fieldsUI:e,formBuilderId:t,formId:r,validatingUids:n}))(t,r,a,n);e(o)},onUpdateFieldAsyncInner:(t,r,n,a,o,i)=>{const s=((e,t,r,n,a,o)=>l(Ic)({elementId:e,fieldLabel:t,formBuilderId:r,formId:n,uid:a,callback:o}))(t,r,n,a,(0,yc.A)(),o);i?i(s):e(s)}});var Rc=r(86596),wc=r(2086);function _c(e){if(!e)return{message:null,details:null};return{message:(0,ki.A)(e)?e:e.message,details:(0,wc.A)(e)?e:null}}class Pc extends y.Component{getHeader(){const e=this.props.header;if(e&&e.type&&"SectionHeaderSimple"===e.type.name&&this.props.onChangeCollapseState){return y.cloneElement(e,{onChangeCollapseState:this.props.onChangeCollapseState,isCollapsed:this.props.isCollapsed,extendedCollapsibility:this.props.extendedCollapsibility})}return e}renderContents(){const{isCollapsed:e,contentStyle:t,mainActionButton:r,classes:n}=this.props,a=!e,o=Object.assign({},t,e?{display:"none"}:null),i=r?y.createElement("div",{className:n.mainActionButton},r):null;return y.createElement("div",null,this.getHeader(),this.props.description,y.createElement("div",{style:o},i,(()=>a?this.props.children:null)()))}render(){const{style:e,className:t}=this.props,r=er()(this.props.classes.container,t);return y.createElement("div",{className:r,style:e},this.renderContents())}}const kc=(0,I.withStyles)((()=>({container:{flexGrow:1,display:"flex",flexDirection:"column",position:"relative",border:`1px solid ${vn.T.grey300}`},mainActionButton:{position:"absolute",right:15,top:30}})))(Pc);function Dc(){return Dc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dc.apply(this,arguments)}class Uc extends y.Component{constructor(e){super(e),this.handleChangeCollapse=this.handleChangeCollapse.bind(this)}handleChangeCollapse(){this.props.onChangeCollapseState()}render(){const{titleStyle:e,extendedCollapsibility:t,containerStyle:r,classes:n,secondary:a,onChangeCollapseState:o}=this.props,i=t?{onClick:this.handleChangeCollapse}:null,s=t?{...r,cursor:"pointer"}:r;return y.createElement("div",Dc({className:a?n.containerSecondary:n.container,style:s},i),y.createElement("div",null,y.createElement("div",{className:n.title,style:e},this.props.title)),y.createElement("div",{className:n.children},this.props.children,(()=>o?y.createElement(bn,{open:!this.props.isCollapsed,onOpen:this.handleChangeCollapse,onClose:this.handleChangeCollapse,disabled:!this.props.isCollapseButtonEnabled,dataTest:"collapsible-button"}):null)()))}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Uc,"defaultProps",{isCollapseButtonEnabled:!0});const Lc=(0,I.withStyles)((()=>({container:{display:"flex"},containerSecondary:{display:"flex"},title:{color:vn.T.grey900,fontSize:14,fontWeight:500,backgroundColor:vn.T.grey300,padding:"4px 8px",marginBottom:"8px"},children:{flexGrow:1,display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:5}})))(Uc);var Fc="formBuilder_fieldOuterContainer__1AfyY";function xc(e){return jt(e,Nt.sI.get().dateFormat)}function Mc(e){return function(e,t){if(!e)return!1;const r=e.date,n=e.time;return!(!r||!n)&&jt(r,t)&&Gt(n)}(e,Nt.sI.get().dateFormat)}function Vc(e){return e&&xc(e)}function jc(e){return e&&Mc(e)}const Gc=e=>{const t=e.date,r=e.time;let n,a;/[:.]/.test(r)?[n,a]=r.split(/[:.]/):3===r.length?(n=r.substring(0,1),a=r.substring(2,3)):(n=r.substring(0,2),a=r.substring(3,4));const o=Rt(t).momentDate;return o.hour(n),o.minute(a),o};function Bc(e,t){return e&&t.validator(e)}const $c=e=>t=>{const r=[];return Bc(t.from,e)||r.push({from:e.message}),Bc(t.to,e)||r.push({to:e.message}),r.length>0?{valid:!1,errorMessage:r.reduce(((e,t)=>({...e,...t})),{})}:ut(t.from)<=ut(t.to)};function Wc(e){return e&&Gt(e)}const Hc=(e,t)=>{let r,n;/[:.]/.test(e)?[r,n]=e.split(/[:.]/):3===e.length?(r=e.substring(0,1),n=e.substring(2,3)):(r=e.substring(0,2),n=e.substring(3,4));const a=$()(t);return a.hour(r),a.minute(n),a},zc="typeBase",Yc="typeExtended",qc="unique",Kc={COMPULSORY:n.A.t("A value is required"),NUMBER:n.A.t("Please provide a valid number"),INTEGER:n.A.t("Please provide a valid integer"),POSITIVE_INTEGER:n.A.t("Please provide a positive integer"),ZERO_OR_POSITIVE_INTEGER:n.A.t("Please provide zero or a positive integer"),NEGATIVE_INTEGER:n.A.t("Please provide a negative integer"),DATE:n.A.t("Please provide a valid date"),DATE_FUTURE_NOT_ALLOWED:n.A.t("A date in the future is not allowed"),DATETIME:n.A.t("Please provide a valid date and time"),TIME:n.A.t("Please provide a valid time"),PERCENTAGE:n.A.t("Please provide an integer between 0 and 100"),URL:n.A.t("Please provide a valid url"),EMAIL:n.A.t("Please provide a valid email address"),AGE:n.A.t("Please provide a valid age"),PHONE_NUMBER:n.A.t("Please provide a valid phone number"),ORGANISATION_UNIT:n.A.t("Please provide a valid organisation unit"),COORDINATE:n.A.t("Please provide valid coordinates"),UNIQUENESS:n.A.t("This value already exists"),RANGE:n.A.t('"From" cannot be greater than "To"')},Qc={UNIQUENESS:n.A.t("Checking...")},Xc=e=>Vt(e&&(0,ki.A)(e)?e.trim():e),Jc={validator:$t,message:Kc.INTEGER,type:zc},Zc={validator:Wt,message:Kc.POSITIVE_INTEGER,type:zc},eu={validator:zt,message:Kc.ZERO_OR_POSITIVE_INTEGER,type:zc},tu={validator:Ht,message:Kc.NEGATIVE_INTEGER,type:zc},ru={validator:Yt,message:Kc.NUMBER,type:zc},nu={[it.CO.NUMBER]:[ru],[it.CO.INTEGER]:[Jc],[it.CO.INTEGER_POSITIVE]:[Zc],[it.CO.INTEGER_ZERO_OR_POSITIVE]:[eu],[it.CO.INTEGER_NEGATIVE]:[tu],[it.CO.TIME]:[{validator:Gt,message:Kc.TIME,type:zc}],[it.CO.DATE]:[{validator:xc,message:Kc.DATE,type:zc},{validator:(e,t)=>!!t||(e=>{const{isValid:t,momentDate:r}=Rt(e);return t?{valid:r.isSameOrBefore($()()),message:n.A.t("A future date is not allowed")}:t})(e),type:Yc,message:Kc.DATE_FUTURE_NOT_ALLOWED}],[it.CO.DATETIME]:[{validator:Mc,message:Kc.DATETIME,type:zc}],[it.CO.EMAIL]:[{validator:e=>Bt.test(e),message:Kc.EMAIL,type:zc}],[it.CO.PERCENTAGE]:[{validator:e=>/^(100|\d\d|\d)([,.]0*)?( *)?%?$/.test(e),message:Kc.PERCENTAGE,type:zc}],[it.CO.URL]:[{validator:e=>null!==e.match(/^(http|https):\/\/[a-z0-9]+([-.]{1}[a-z0-9]+)*\.[a-z]{2,6}(:[0-9]{1,5})?(\/.*)?$/),message:Kc.URL,type:zc}],[it.CO.AGE]:[{validator:function(e){return Qt(e,Nt.sI.get().dateFormat)},message:Kc.AGE,type:zc}],[it.CO.PHONE_NUMBER]:[{validator:e=>/^[^a-zA-Z]+$/.test(e),message:Kc.PHONE_NUMBER,type:zc}],[it.CO.ORGANISATION_UNIT]:[{validator:Xt,message:Kc.ORGANISATION_UNIT,type:zc}],[it.CO.COORDINATE]:[{validator:e=>{if(!e)return!1;const{longitude:t,latitude:r}=e;if(!Jt(r)||!Jt(t))return!1;const n=parseInt(t,10),a=parseInt(r,10);return n>=-180&&n<=180&&a>=-90&&a<=90},message:Kc.COORDINATE,type:zc}],[it.CO.DATE_RANGE]:[{validator:(iu=Kc.DATE,e=>{const t=[];return Vc(e.from)||t.push({from:iu}),Vc(e.to)||t.push({to:iu}),t.length>0?{valid:!1,errorMessage:t.reduce(((e,t)=>({...e,...t})),{})}:Rt(e.from).momentDate<=Rt(e.to).momentDate}),message:Kc.RANGE,type:zc}],[it.CO.DATETIME_RANGE]:[{validator:(ou=Kc.DATETIME,e=>{const t=[];return jc(e.from)||t.push({from:ou}),jc(e.to)||t.push({to:ou}),t.length>0?{valid:!1,errorMessage:t.reduce(((e,t)=>({...e,...t})),{})}:Gc(e.from)<=Gc(e.to)}),message:Kc.RANGE,type:zc}],[it.CO.TIME_RANGE]:[{validator:(au=Kc.TIME,e=>{const t=[];if(Wc(e.from)||t.push({from:au}),Wc(e.to)||t.push({to:au}),t.length>0)return{valid:!1,errorMessage:t.reduce(((e,t)=>({...e,...t})),{})};const r=$()();return Hc(e.from,r)<=Hc(e.to,r)}),message:Kc.RANGE,type:zc}],[it.CO.NUMBER_RANGE]:[{validator:$c(ru),message:Kc.RANGE,type:zc}],[it.CO.INTEGER_RANGE]:[{validator:$c(Jc),message:Kc.RANGE,type:zc}],[it.CO.INTEGER_POSITIVE_RANGE]:[{validator:$c(Zc),message:Kc.RANGE,type:zc}],[it.CO.INTEGER_ZERO_OR_POSITIVE_RANGE]:[{validator:$c(eu),message:Kc.RANGE,type:zc}],[it.CO.INTEGER_NEGATIVE_RANGE]:[{validator:$c(tu),message:Kc.RANGE,type:zc}]};var au,ou,iu;function su(e){let t=nu[e.type]?nu[e.type]:[];return t=t.map((t=>({...t,validator:r=>{if(!r&&0!==r&&!1!==r)return!0;const n=(0,ki.A)(r)?r.trim():r;return t.validator(n,e.allowFutureDate)}}))),t}function lu(e){return e.compulsory?[{validator:Xc,message:Kc.COMPULSORY}]:[]}function du(e,t){return e.unique?[{validator:(r,n)=>!r&&0!==r&&!1!==r||e.unique.onValidate(r,n,t),message:Kc.UNIQUENESS,validatingMessage:Qc.UNIQUENESS,type:qc}]:[]}const cu=(e,t)=>[lu,su,du].flatMap((r=>r(e,t)));function uu(){return uu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uu.apply(this,arguments)}function pu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class mu extends y.Component{static async validateField(e,t,r,n){let{validators:a}=e;if(!a||0===a.length)return{valid:!0};const o=await a.reduce((async(e,a)=>{const o=await e;if(!0===o){let e=a.validator(t,r);return e instanceof Promise&&(e=n?n(a.validatingMessage,e):e,e=await e),!!(!0===e||e&&e.valid)||{message:e&&e.errorMessage||a.message,type:a.type,data:e&&e.data}}return o}),Promise.resolve(!0));return!0!==o?{valid:!1,errorMessage:o.message,errorType:o.type,errorData:o.data}:{valid:!0}}static getAsyncUIState(e){return Object.keys(e).reduce(((t,r)=>{const n=e[r];return t[r]=mu.getFieldAsyncUIState(n),t}),{})}static getFieldAsyncUIState(e){const t=["valid","errorMessage","touched"];return Object.keys(e).reduce(((r,n)=>(t.includes(n)||(r[n]=e[n]),r)),{})}static updateAsyncUIState(e,t,r){return Object.keys(t).reduce(((r,n)=>{const a=t[n];return a!==e[n]&&(r[n]=mu.getFieldAsyncUIState(a)),r}),r)}static executeValidateAllFields(e,t){const{id:r,fields:a,values:o,onGetValidationContext:i,onIsValidating:s}=e,l=i&&i(),d=a.map((async e=>{const a=e.id,i=t[a]||{};t[a]=i,i.validatingCompleteUid||(i.validatingCompleteUid=(0,yc.A)()),i.cancelableValidatingPromise&&i.cancelableValidatingPromise.cancel();const d=(t,n)=>(i.cancelableValidatingPromise=(0,j.gI)(n),s&&s(e.id,r,i.validatingCompleteUid,t,null),i.cancelableValidatingPromise.promise);let c;try{c=await mu.validateField(e,o[e.id],l,d)}catch(u){u&&(0,wc.A)(u)&&u.isCanceled?c=null:(c={valid:!1,errorMessage:[n.A.t("error encountered during field validation")],errorType:n.A.t("error")},S().error({reason:u,field:e}))}return{id:e.id,validationData:c}}));return Promise.all(d).then((e=>e.filter((e=>!!e.validationData))))}constructor(e){super(e),pu(this,"handleUpdateAsyncState",((e,t)=>{this.props.onUpdateFieldUIOnly(t,e,this.props.id)})),pu(this,"handleCommitAsync",((e,t,r)=>{this.props.onUpdateFieldAsync(e,t,this.props.id,r)})),pu(this,"renderPlugin",(e=>{const{pluginContext:t}=this.props,{pluginId:r,pluginSource:n,fieldsMetadata:a,customAttributes:o,name:i,formId:s,viewMode:l}=e.props;return y.createElement(e.component,{name:i,pluginId:r,customAttributes:o,pluginSource:n,fieldsMetadata:a,formId:s,viewMode:l,onUpdateField:this.commitFieldUpdateFromPlugin.bind(this),pluginContext:t})})),pu(this,"renderField",((e,t,r,n)=>{const{fields:a,values:o,fieldsUI:i,validationAttempted:s,id:l,onFieldsValidated:d,onUpdateField:c,onUpdateFieldAsync:u,onUpdateFieldUIOnly:p,validateIfNoUIData:m,children:g,onRenderDivider:h,onGetContainerProps:E,onIsValidating:v,onGetValidationContext:f,loadNr:I,onPostProcessErrorMessage:b,...S}=this.props,T=e.props||{},A=i[e.id]||{},C=o[e.id],O=this.commitFieldUpdateFromDataElement.bind(this,e.id),N={[e.commitEvent||"onBlur"]:O},R={};T.async&&(R.onCommitAsync=t=>this.handleCommitAsync(e.id,T.label,t),R.asyncUIState=this.asyncUIState[e.id]);const w=b&&A.errorMessage?b({errorMessage:A.errorMessage,errorType:A.errorType,errorData:A.errorData,id:`${l}-${e.id}`,fieldId:e.id,fieldLabel:T.label}):A.errorMessage;return y.createElement("div",{key:e.id,className:Fc,"data-test":"form-field"},y.createElement("div",uu({},n&&n(t,a.length,e),{"data-test":`form-field-${e.id}`}),y.createElement(e.component,uu({ref:t=>{this.setFieldInstance(t,e.id)},value:C,errorMessage:w,touched:A.touched,validationAttempted:s,validatingMessage:A.validatingMessage},N,T,S,R))),r&&r(t,a.length,e))})),this.fieldInstances=new Map,this.asyncUIState=mu.getAsyncUIState(this.props.fieldsUI),this.fieldsValidatingPromiseContainer={},this.commitUpdateTriggeredForFields={},this.props.validateIfNoUIData&&this.validateAllFields(this.props)}UNSAFE_componentWillReceiveProps(e){e.id!==this.props.id||e.loadNr!==this.props.loadNr?(this.asyncUIState=mu.getAsyncUIState(this.props.fieldsUI),this.commitUpdateTriggeredForFields={},this.props.validateIfNoUIData&&this.validateAllFields(e)):this.asyncUIState=mu.updateAsyncUIState(this.props.fieldsUI,e.fieldsUI,this.asyncUIState)}getCleanUpData(){const e=Object.keys(this.fieldsValidatingPromiseContainer).map((e=>{const{cancelableValidatingPromise:t,validatingCompleteUid:r}=this.fieldsValidatingPromiseContainer[e]||{};return t&&t.cancel(),r})).filter((e=>!!e));return this.fieldsValidatingPromiseContainer={},e}validateAllFields(e){this.validateAllCancelablePromise&&this.validateAllCancelablePromise.cancel(),this.validateAllCancelablePromise=(0,j.gI)(mu.executeValidateAllFields(e,this.fieldsValidatingPromiseContainer)),this.validateAllCancelablePromise.promise.then((t=>{const r=t.reduce(((e,t)=>(e[t.id]=t.validationData,e)),{}),n=t.map((e=>({promises:this.fieldsValidatingPromiseContainer[e.id],id:e.id,commitUpdateTriggeredForField:this.commitUpdateTriggeredForFields[e.id]}))).filter((e=>!e.commitUpdateTriggeredForField));e.onFieldsValidated&&e.onFieldsValidated(r,e.id,n.map((e=>e.promises.validatingCompleteUid))),n.forEach((e=>{this.fieldsValidatingPromiseContainer[e.id]=null})),this.validateAllCancelablePromise=null})).catch((e=>{e&&(0,wc.A)(e)&&e.isCanceled||S().error({reason:e,message:"formBuilder validate all fields failed"})}))}getFieldProp(e){return this.props.fields.find((t=>t.id===e))}hasCommitedValueChanged(e,t){let{onIsEqual:r,fieldId:n}=e,a=!0;const o=this.props.values[n];return(0,wc.A)(t)?r&&r(t,o)&&(a=!1):(t||"")===(o||"")&&(a=!1),a}commitFieldUpdateFromDataElement(e,t,r){const{validators:n,onIsEqual:a}=this.getFieldProp(e);this.commitFieldUpdate({fieldId:e,validators:n,onIsEqual:a},t,r)}commitFieldUpdateFromPlugin(e,t,r){const{id:n}=e,{querySingleResource:a}=this.props,o=cu(e,a);this.commitFieldUpdate({fieldId:n,validators:o},t,r)}async commitFieldUpdate(e,t,r){let{fieldId:a,validators:o,onIsEqual:i}=e;const{onUpdateFieldUIOnly:s,onUpdateField:l,onGetValidationContext:d,id:c,onIsValidating:u}=this.props,p=!r||!(0,Q.A)(r.touched)||r.touched;if(!this.hasCommitedValueChanged({fieldId:a,onIsEqual:i},t))return void s({touched:p},a,c);const m=this.fieldsValidatingPromiseContainer[a]||{};this.fieldsValidatingPromiseContainer[a]=m,m.validatingCompleteUid||(m.validatingCompleteUid=(0,yc.A)()),m.cancelableValidatingPromise&&m.cancelableValidatingPromise.cancel();this.commitUpdateTriggeredForFields[a]=!0;const g=mu.validateField({validators:o},t,d&&d(),((e,t)=>(m.cancelableValidatingPromise=(0,j.gI)(t),u&&u(a,c,m.validatingCompleteUid,e,{touched:!0}),m.cancelableValidatingPromise.promise))).then((e=>{var n,o;let{valid:i,errorMessage:s,errorType:d,errorData:u}=e;l(t,{valid:null!==(n=null===r||void 0===r?void 0:r.valid)&&void 0!==n?n:i,touched:p,errorMessage:null!==(o=null===r||void 0===r?void 0:r.error)&&void 0!==o?o:s,errorType:d,errorData:u},a,c,m.validatingCompleteUid),this.fieldsValidatingPromiseContainer[a]=null})).catch((e=>{e&&(0,wc.A)(e)&&e.isCanceled||(S().error({reason:e,fieldId:a,value:t}),l(t,{valid:!1,touched:!0,errorMessage:n.A.t("error encountered during field validation"),errorType:n.A.t("error")},a,c,m.validatingCompleteUid),this.fieldsValidatingPromiseContainer[a]=null)}));await g}setFieldInstance(e,t){e?this.fieldInstances.set(t,e):this.fieldInstances.has(t)&&this.fieldInstances.delete(t)}isValid(e){return Object.keys(this.props.fieldsUI).every((t=>{const r=this.props.fieldsUI[t];if(e){if(!e.includes(r.errorType))return!0}return r.valid}))}getInvalidFields(e){return this.props.fields.reduce(((t,r)=>{const n=this.props.fieldsUI[r.id];return n.valid?e&&e[r.id]&&t.push({prop:r,instance:this.fieldInstances.get(r.id),uiState:n}):t.push({prop:r,instance:this.fieldInstances.get(r.id),uiState:n}),t}),[])}renderFields(){const{fields:e,children:t,onRenderDivider:r,onGetContainerProps:n}=this.props;return t?t(this.renderField,e):e.map(((e,t)=>e.plugin&&e.props?this.renderPlugin(e):this.renderField(e,t,r,n)))}render(){return y.createElement(y.Fragment,null,this.renderFields())}}const gu="UpdateFieldUIOnly";function hu(){return hu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hu.apply(this,arguments)}const Eu=(0,gs.Ng)(((e,t)=>({fieldsUI:e.formsSectionsFieldsUI[t.id]||{}})),(e=>({onUpdateFieldUIOnly:(t,r,n)=>{e(((e,t,r)=>l(gu)({uiState:e,elementId:t,sectionId:r}))(t,r,n))}})))((e=>{const{formBuilderRef:t,...r}=e;return y.createElement(mu,hu({ref:t},r))}));function yu(){return yu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yu.apply(this,arguments)}function vu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const fu=()=>({dividerContainer:{},divider:{backgroundColor:vn.T.grey300}});function Iu(){return Iu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Iu.apply(this,arguments)}function bu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Su=()=>({evenNumbers:{backgroundColor:vn.T.grey050}});var Tu=r(68449);function Au(){return Au=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Au.apply(this,arguments)}function Cu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ou extends y.Component{constructor(){super(...arguments),Cu(this,"handleChange",(e=>{this.props.onChange&&this.props.onChange(e.currentTarget.value,e)})),Cu(this,"handleBlur",(e=>{this.props.onBlur&&this.props.onBlur(e.currentTarget.value,e)}))}render(){const{value:e,onBlur:t,onChange:r,classes:n,...a}=this.props;return y.createElement(Wa,Au({value:e||"",onChange:this.handleChange,onBlur:this.handleBlur,classes:n},a))}}const Nu=(0,I.withStyles)((()=>({})))(Ou);function Ru(){return Ru=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ru.apply(this,arguments)}class wu extends y.Component{render(){const{onBlur:e,...t}=this.props;return y.createElement(Kn,Ru({onSelect:e},t))}}const _u=(0,I.withStyles)((e=>({iconSelected:{fill:e.palette.secondary.main},iconDeselected:{fill:vn.T.grey700},iconDisabled:{fill:"rgba(0,0,0,0.30)"},focusSelected:{backgroundColor:"rgba(0, 121, 107, 0.4)"}})))(wu);function Pu(e){return e.charAt(0).toLocaleLowerCase()+e.slice(1)}function ku(){return ku=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ku.apply(this,arguments)}const Du=()=>e=>class t extends y.Component{static convertValueIntoCalendar(e){if(!e)return new Date;const t=Rt(e);return t.isValid?t.momentDate.toDate():new Date}static convertValueOutFromCalendar(e){return wt(e)}constructor(e){super(e),this.calendarTheme=(e=>({accentColor:e.palette.secondary.main,floatingNav:{background:"rgba(0, 30, 64, 0.8)",chevron:"rgb(145, 203, 193)",color:"white"},headerColor:e.palette.primary.main,todayColor:e.palette.secondary.main,selectionColor:e.palette.primary.main,weekdayColor:e.palette.primary.main}))(this.props.theme);const t=W.get(),r=this.props.calendarWidth||this.props.width;this.calendarLocaleData={locale:t.dateFnsLocale,headerFormat:r>=400?t.calendarFormatHeaderLong:t.calendarFormatHeaderShort,weekdays:t.weekDaysShort.map((e=>Ot(e))),blank:t.selectDatesText,todayLabel:{long:t.todayLabelLong,short:t.todayLabelShort},weekStartsOn:t.weekStartsOn}}render(){const{theme:r,...n}=this.props;return y.createElement(e,ku({calendarTheme:this.calendarTheme,calendarLocale:this.calendarLocaleData,calendarOnConvertValueIn:t.convertValueIntoCalendar,calendarOnConvertValueOut:t.convertValueOutFromCalendar},n))}};function Uu(){return Uu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uu.apply(this,arguments)}const Lu=(0,I.withTheme)()(Du()((0,I.withStyles)((e=>({innerInputError:{color:e.palette.error.main,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputWarning:{color:e.palette.warning.dark,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputInfo:{color:"green",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputValidating:{color:"orange",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)}})))((e=>{const{calendarTheme:t,calendarLocale:r,calendarOnConvertValueIn:n,calendarOnConvertValueOut:a,...o}=e;return y.createElement(rn,Uu({onParseDate:Rt,onGetFormattedDateStringFromMoment:_t,moment:$(),dateCalendarTheme:t,dateCalendarLocale:r,dateCalendarOnConvertValueIn:n,dateCalendarOnConvertValueOut:a,datePlaceholder:Nt.sI.get().dateFormat.toLowerCase()},o))}))));function Fu(){return Fu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fu.apply(this,arguments)}class xu extends y.Component{render(){const{onBlur:e,...t}=this.props;return y.createElement(za,Fu({onSelect:e},t))}}const Mu=(0,I.withStyles)((e=>({iconSelected:{fill:e.palette.secondary.main},iconDeselected:{fill:vn.T.grey700},iconDisabled:{fill:"rgba(0,0,0,0.30)"},focusSelected:{backgroundColor:"rgba(0, 121, 107, 0.4)"}})))(xu);var Vu=r(45975);r(54168),r(92720),r(23083);function ju(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Gu extends y.Component{render(){const{option:e,style:t,onSelect:r,currentlySelectedValues:n,classes:a,inFocus:o,onFocusOption:i}=this.props,{label:s,icon:l}=e,d=!!n&&n.includes(e),c=Object.assign({},Bu.defaultContainerStyle,t,n&&n.includes(e)?Bu.selectedStyle:null,o?Bu.inFocusStyle:null);return y.createElement(Xo.m,{content:e.label,placement:"bottom",openDelay:800},y.createElement("div",{className:"virtualized-select-option",style:c,onClick:()=>{r(e)},role:"option","aria-selected":d,tabIndex:-1,onMouseOver:()=>i(e)},y.createElement("div",null,s),l?y.createElement("div",{className:a.iconContainer},l):null))}}ju(Gu,"defaultContainerStyle",{display:"flex",alignItems:"center",cursor:"default",paddingLeft:8,overflow:"hidden",paddingTop:4,paddingBottom:2,whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:14}),ju(Gu,"selectedStyle",{fontWeight:"600",backgroundColor:"#fbfcfd"}),ju(Gu,"inFocusStyle",{backgroundColor:"#f3f5f7"});const Bu=(0,I.withStyles)((()=>({popper:{zIndex:9999},iconContainer:{paddingLeft:5}})))(Gu);function $u(){return $u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$u.apply(this,arguments)}function Wu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Hu extends y.Component{static getFilteredOptions(e,t){const r=t.normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase();return e&&e.filter((e=>e.label.normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().indexOf(r)>-1))||[]}constructor(e){super(e),Wu(this,"filterOptions",(()=>this.state.filterValue?(this.prevFilterValue===this.state.filterValue||(this.state.filterValue&&this.prevFilterValue&&this.state.filterValue.indexOf(this.prevFilterValue)>-1&&(this.prevFilteredOptions=zu.getFilteredOptions(this.prevFilteredOptions,this.state.filterValue)),this.prevFilteredOptions=zu.getFilteredOptions(this.props.options,this.state.filterValue),this.prevFilterValue=this.state.filterValue),this.prevFilteredOptions):this.props.options)),Wu(this,"handleInputChange",(e=>{this.isUnmounted||this.setState({filterValue:e})})),Wu(this,"renderValue",(e=>{const{classes:t}=this.props,{icon:r,label:n}=e;return y.createElement("div",{className:t.selectedOptionContainer},y.createElement("div",null,n),r?y.createElement("div",{className:t.selectedIconContainer},r):null)})),Wu(this,"onBlur",(()=>{this.props.onSelect(this.props.value)})),this.handleChange=this.handleChange.bind(this),this.renderOption=this.renderOption.bind(this),this.handleInputChange=(0,Ya.debounce)(this.handleInputChange,500),this.prevFilteredOptions=[],this.state={},this.isUnmounted=!1}UNSAFE_componentWillReceiveProps(e){e.options!==this.props.options&&(this.prevFilterValue=null)}componentWillUnmount(){this.isUnmounted=!0}handleChange(e){const t=e&&e.value;t!==this.props.value&&this.props.onSelect(""===t?null:t)}getValue(){const e=this.props.options,t=this.props.value;return e&&t?e.find((e=>e.value===t)):null}renderOption(e){const t=e.option===e.focusedOption;return y.createElement(Bu,{key:e.option.value,option:e.option,inFocus:t,onFocusOption:e.focusOption,style:e.style,onSelect:e.selectValue,currentlySelectedValues:e.valueArray})}render(){const{options:e,label:t,value:r,nullable:n,style:a,menuStyle:o,maxHeight:i,disabled:s,required:l,useHintLabel:d,translations:c,withoutUnderline:u,classes:p,dataTest:m,...g}=this.props,h=g.multi?r:this.getValue(),E={...zu.defaultSelectStyle,...a},v={...zu.defaultMenuContainerStyle,...o};return y.createElement("div",{"data-test":"virtualized-select",ref:e=>{this.materialUIContainerInstance=e}},y.createElement("div",{"data-test":m,onBlur:this.onBlur},y.createElement(Vu.A,$u({disabled:s,options:e,onChange:this.handleChange,value:h,valueRenderer:this.renderValue,clearable:n,style:E,menuContainerStyle:v,className:"virtualized-select",placeholder:d?t:"",maxHeight:i||200,optionRenderer:this.renderOption,clearValueText:c.clearText,noResultsText:c.noResults,filterOptions:this.filterOptions,onInputChange:this.handleInputChange},g)),y.createElement("div",null)))}}Wu(Hu,"defaultProps",{translations:{clearText:"",noResults:""}}),Wu(Hu,"defaultSelectStyle",{}),Wu(Hu,"defaultMenuContainerStyle",{});const zu=(0,I.withStyles)((()=>({selectedOptionContainer:{display:"flex",alignItems:"center"},selectedIconContainer:{paddingLeft:5}})))(Hu);var Yu="selectField_inputWrapper__fD1HV";function qu(){return qu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qu.apply(this,arguments)}function Ku(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qu(){return Qu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qu.apply(this,arguments)}function Xu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ju=(Zu=zu,class extends y.Component{constructor(){super(...arguments),Ku(this,"handleBlur",(e=>{this.props.onRemoveFocus(),this.props.onBlur&&this.props.onBlur(e)})),Ku(this,"handleFocus",(()=>{this.props.onSetFocus(),this.props.onFocus&&this.props.onFocus()}))}render(){const{onSetFocus:e,onRemoveFocus:t,onFocus:r,inFocus:n,onBlur:a,classes:o,...i}=this.props,{inputWrapperFocused:s,inputWrapperUnfocused:l,...d}=o,c=n?s:l;return y.createElement("div",{className:er()(Yu,c)},y.createElement(Zu,qu({onFocus:this.handleFocus,onBlur:this.handleBlur},i,{classes:d})))}});var Zu;class ep extends y.Component{constructor(){super(...arguments),Xu(this,"handleSelect",(e=>{this.props.onBlur&&this.props.onBlur(e)}))}render(){const{value:e,onBlur:t,onChange:r,classes:n,...a}=this.props;return y.createElement(Ju,Qu({value:e||"",onSelect:this.handleSelect,classes:n},a))}}const tp=(0,I.withStyles)((()=>({})))(ep);var rp=r(93321),np=r(9e3),ap="selectField_inputWrapper__4dSmz";function op(){return op=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},op.apply(this,arguments)}function ip(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const sp=(0,qd.compose)((0,I.withStyles)((e=>({label:{display:"flex",alignItems:"center"},inputWrapperFocused:{border:`2px solid ${e.palette.primary.light}`,borderRadius:"5px"},inputWrapperUnfocused:{padding:2}}))),(e=>class extends y.Component{constructor(){super(...arguments),ip(this,"handleRemoveFocus",(e=>{this.props.onRemoveFocus(),this.props.onBlur&&this.props.onBlur(e)})),ip(this,"handleFocus",(()=>{this.props.onSetFocus(),this.props.onFocus&&this.props.onFocus()})),ip(this,"handleSelect",(e=>{this.props.onBlur&&this.props.onBlur(e)}))}render(){const{onSetFocus:t,onRemoveFocus:r,onFocus:n,inFocus:a,onBlur:o,classes:i,...s}=this.props,{inputWrapperFocused:l,inputWrapperUnfocused:d,...c}=i,u=a?l:d;return y.createElement("div",{className:er()(ap,u)},y.createElement(e,op({onFocus:this.handleFocus,onBlur:this.handleRemoveFocus,onSelect:this.handleSelect},s,{classes:c})))}}))((e=>{const{onSelect:t,options:r,value:n="",translations:a,onFocus:o,onBlur:i,disabled:s}=e,[l,d]=(0,y.useState)([]);(0,y.useEffect)((()=>{const e=null===n||""===n?[]:n.split(",");d(e)}),[n]);return y.createElement("div",{onBlur:()=>{i(l?l.join(","):null)}},y.createElement(rp.A,{dataTest:"multi-select-field",onChange:e=>{const{selected:r}=e;d(r),t(r.join(","))},onFocus:o,onKeyDown:o,selected:l,filterable:!0,filterPlaceholder:a.filterPlaceholder,noMatchText:a.noMatchText,disabled:s},r.map((e=>y.createElement(np.f,{key:e.id,label:e.label,value:e.value})))))}));function lp(){return lp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lp.apply(this,arguments)}const dp=()=>e=>class extends y.Component{constructor(e){super(e),this.translations={clearText:n.A.t("Clear"),noResults:n.A.t("No results")}}render(){const{...t}=this.props;return y.createElement(e,lp({translations:this.translations},t))}};function cp(){return cp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cp.apply(this,arguments)}const up=()=>e=>class extends y.Component{constructor(e){super(e),this.translations={filterPlaceholder:n.A.t("Type to filter options"),noMatchText:n.A.t("No match found")}}render(){const{...t}=this.props;return y.createElement(e,cp({translations:this.translations},t))}};class pp extends y.Component{render(){const{...e}=this.props;return y.createElement(Yn,e)}}const mp=(0,I.withStyles)((e=>({iconSelected:{fill:e.palette.secondary.main},iconDisabled:{fill:"rgba(0,0,0,0.30)"},iconDeselected:{fill:vn.T.grey700},focusSelected:{backgroundColor:"rgba(0, 121, 107, 0.4)"}})))(pp);function gp(){return gp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gp.apply(this,arguments)}class hp extends y.Component{render(){const{...e}=this.props;return y.createElement(Mr,gp({placeholder:Nt.sI.get().dateFormat.toLowerCase()},e))}}const Ep=(0,I.withTheme)()(Du()((0,I.withStyles)((e=>({innerInputError:{color:e.palette.error.main,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputWarning:{color:e.palette.warning.dark,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputInfo:{color:"green",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputValidating:{color:"orange",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)}})))(hp)));class yp extends y.Component{render(){const{...e}=this.props;return y.createElement(Ca,e)}}const vp=(0,I.withTheme)()(Du()((0,I.withStyles)((e=>({innerInputError:{color:e.palette.error.main,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputWarning:{color:e.palette.warning.dark,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputInfo:{color:"green",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputValidating:{color:"orange",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)}})))(yp)));var fp=r(63622),Ip=r(81809);function bp(){return bp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},bp.apply(this,arguments)}const Sp=[51.505,-.09],Tp=e=>t=>{const{orgUnit:r,...n}=t,[a,o]=(0,y.useState)(r.id),[i,s]=(0,y.useState)(!1),l=["organisationUnit","geometry",a],d={resource:"organisationUnits",id:()=>a,params:{fields:"geometry,parent"}},c=(0,y.useMemo)((()=>({enabled:Boolean(r.id)&&i})),[i,r.id]),{data:u}=ni(l,d,c),p=(0,y.useMemo)((()=>{if(u){const{geometry:e,parent:t}=u;return e?(e=>{let{coordinates:t,type:r}=e;switch(r){case"Point":return[t[1],t[0]];case"Polygon":return t[0][0];default:return Sp}})(e):(null!==t&&void 0!==t&&t.id&&o(t.id),Sp)}}),[u]);return y.createElement(e,bp({},n,{center:p,onOpenMap:e=>{s(!e)}}))},Ap=()=>e=>Tp(e);function Cp(){return Cp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Cp.apply(this,arguments)}class Op extends y.Component{constructor(e){super(e);const{dialogPaper:t,...r}=e.classes;this.passOnClasses=r,this.dialogClasses={paper:e.classes.dialogPaper}}render(){const{classes:e,dialogLabel:t,...r}=this.props;return y.createElement(ma,Cp({mapDialog:y.createElement(N.a,{className:this.dialogClasses,large:!0},y.createElement(Ip.w,null,t))},r,{classes:this.passOnClasses}))}}const Np=(0,fp.default)((e=>({inputWrapperFocused:{position:"relative",zIndex:10},innerInputError:{color:e.palette.error.main,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputWarning:{color:e.palette.warning.dark,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputInfo:{color:"green",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputValidating:{color:"orange",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},mapIconContainer:{fill:e.palette.primary.dark},mapIconContainerDisabled:{fill:"rgba(0,0,0,0.30)"},dialogPaper:{maxWidth:"none",width:"75%",height:"75%"}})))(Ap()(Op));function Rp(){return Rp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rp.apply(this,arguments)}class wp extends y.Component{constructor(e){super(e);const{dialogPaper:t,...r}=e.classes;this.passOnClasses=r,this.dialogClasses={paper:e.classes.dialogPaper}}render(){const{classes:e,dialogLabel:t,...r}=this.props;return y.createElement(ja,Rp({mapDialog:y.createElement(N.a,{classes:this.dialogClasses,large:!0},y.createElement(Ip.w,{key:"title"},t))},r))}}const _p=(0,fp.default)((()=>({dialogPaper:{maxWidth:"none",width:"75%",height:"75%"}})))(Ap()(wp));var Pp=r(43253);function kp(){return kp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kp.apply(this,arguments)}const Dp=(e,t,r)=>n=>a=>{const{ready:o,...i}=a;if(!(r?r(a):o)){const r=e?e(a):null,n=t?t(a):null;return y.createElement(_,kp({containerStyle:r},n))}return y.createElement(n,i)},Up=(0,I.withStyles)((()=>({orgunitTree:{padding:4,minHeight:42,paddingTop:8,backgroundColor:"white",display:"flex",maxWidth:"100vw"}})))(Dp((()=>({margin:4})),(()=>({size:20})))((e=>{const{roots:t,classes:r,treeKey:n,previousOrgUnitId:a,onSelectClick:o}=e,i=(e=>{var t,r,n;const{data:a,refetch:o}=(0,A.iO)((0,y.useMemo)((()=>({organisationUnits:{resource:"organisationUnits",id:e=>{let{variables:{previousOrgUnitId:t}}=e;return t},params:{fields:["displayName,path"]}}})),[]),{lazy:!0});(0,y.useEffect)((()=>{e&&o({variables:{previousOrgUnitId:e}})}),[e,o]);const i=(0,y.useMemo)((()=>{var e;const t=null===a||void 0===a||null===(e=a.organisationUnits)||void 0===e?void 0:e.path.split("/").filter((e=>e));return null===t||void 0===t?void 0:t.map(((e,r)=>`/${t.slice(0,r+1).join("/")}`))}),[null===a||void 0===a||null===(t=a.organisationUnits)||void 0===t?void 0:t.path]);return{id:e,displayName:null===a||void 0===a||null===(r=a.organisationUnits)||void 0===r?void 0:r.displayName,path:null===a||void 0===a||null===(n=a.organisationUnits)||void 0===n?void 0:n.path,expandedPaths:i}})(a),s=t&&1===t.length?[`/${t[0].id}`]:(null===t||void 0===t?void 0:t.length)>1?t.map((e=>e.path)):void 0,[l,d]=y.useState(s);y.useEffect((()=>{null!==i&&void 0!==i&&i.expandedPaths&&d(i.expandedPaths)}),[null===i||void 0===i?void 0:i.expandedPaths]);return t?y.createElement("div",{className:r.orgunitTree},y.createElement(Pp.f,{key:n,roots:t.map((e=>e.id)),expanded:l,handleExpand:e=>{let{path:t}=e;l&&!l.includes(t)&&d([...l,t])},handleCollapse:e=>{let{path:t}=e;const r=null===l||void 0===l?void 0:l.indexOf(t);if(r&&-1!==r&&l){const e=0===r?l.slice(1):[...l.slice(0,r),...l.slice(r+1)];d(e)}},singleSelection:!0,selected:(()=>{if(null!==i&&void 0!==i&&i.path)return[null===i||void 0===i?void 0:i.path]})(),onChange:o})):null}))),Lp=(0,I.withStyles)((()=>({container:{border:"1px solid",borderColor:vn.T.grey300,borderRadius:"3px",height:"100%",width:"100%",zIndex:0,backgroundColor:"white"},searchField:{height:"40px",overflow:"hidden",borderBottomLeftRadius:0,borderBottomRightRadius:0,boxShadow:"none",border:"none"},debounceFieldContainer:{padding:8,background:vn.T.grey100,borderTopLeftRadius:3,borderTopRightRadius:3},orgUnitTreeContainer:{borderBottomLeftRadius:3,borderBottomRightRadius:3,overflow:"auto"}})))((e=>{const{onSelectClick:t,onBlur:r,classes:a,selected:o,maxTreeHeight:i,disabled:s,previousOrgUnitId:l}=e,[d,c]=y.useState(void 0),[u,p]=y.useState(void 0),{loading:m,data:g}=(0,A.iO)(y.useMemo((()=>({orgUnits:{resource:"me",params:{fields:["organisationUnits[id,path]"]}}})),[])),{loading:h,data:E,refetch:v}=(0,A.iO)(y.useMemo((()=>({orgUnits:{resource:"organisationUnits",params:e=>{let{variables:{searchText:t}}=e;return{fields:["id,displayName,path,publicAccess,access,lastUpdated","children[id,displayName,publicAccess,access,path,children::isNotEmpty]"].join(","),paging:!0,query:t,withinUserSearchHierarchy:!0,pageSize:15}}}})),[]),{lazy:!0}),f=null!==d&&void 0!==d&&d.length?!h:!m;y.useEffect((()=>{null!==d&&void 0!==d&&d.length&&(v({variables:{searchText:d}}),p(`${d}-${(new Date).getTime()}`))}),[v,d]);const I=i?{maxHeight:i,overflowY:"auto"}:null;return y.createElement("div",{className:a.container,onBlur:()=>{r&&r(null)}},y.createElement("div",{className:a.debounceFieldContainer},y.createElement(Qa,{onDebounced:e=>{c(e.currentTarget.value)},value:d,placeholder:n.A.t("Search"),classes:a,disabled:s})),!s&&y.createElement("div",{className:a.orgUnitTreeContainer,style:I},(()=>{var e,r;return null!==d&&void 0!==d&&d.length?y.createElement(Up,{roots:null===E||void 0===E||null===(r=E.orgUnits)||void 0===r?void 0:r.organisationUnits,onSelectClick:t,ready:f,treeKey:u,selected:o}):y.createElement(Up,{roots:null===g||void 0===g||null===(e=g.orgUnits)||void 0===e?void 0:e.organisationUnits,onSelectClick:t,ready:f,treeKey:"initial",selected:o,previousOrgUnitId:l})})()))}));var Fp=r(41308);function xp(){return xp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xp.apply(this,arguments)}function Mp(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Vp extends y.Component{constructor(e){super(e),Mp(this,"renderSelectedOrgUnit",(e=>{const{classes:t}=this.props;return y.createElement("div",{className:t.selectedOrgUnitContainer},y.createElement(Fp.v,{onRemove:this.onDeselectOrgUnit,className:t.chip},y.createElement(gi,{orgUnitId:e.id})))})),Mp(this,"onSelectOrgUnit",(e=>{this.props.onBlur({id:e.id,name:e.displayName,path:e.path})})),Mp(this,"onDeselectOrgUnit",(()=>{this.props.value&&this.setState({previousOrgUnitId:this.props.value.id}),this.props.onBlur(null)})),Mp(this,"renderOrgUnitField",(()=>{const{classes:e,...t}=this.props;return y.createElement(Lp,xp({onSelectClick:this.onSelectOrgUnit,previousOrgUnitId:this.state.previousOrgUnitId},t))})),this.state={previousOrgUnitId:null}}render(){const{value:e}=this.props;return e?this.renderSelectedOrgUnit(e):this.renderOrgUnitField()}}const jp=(0,I.withStyles)((()=>({selectedOrgUnitContainer:{display:"flex",alignItems:"center"},chip:{cursor:"text !important","&:hover":{backgroundColor:`${vn.T.grey200} !important`}}})))(Vp),Gp=(0,I.withTheme)()((0,I.withStyles)((e=>({innerInputError:{color:e.palette.error.main,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputWarning:{color:e.palette.warning.dark,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputInfo:{color:"green",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputValidating:{color:"orange",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)}})))((e=>{const{...t}=e;return y.createElement(oo,t)}))),Bp=(0,I.withTheme)()(Du()((0,I.withStyles)((e=>({innerInputError:{color:e.palette.error.main,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputWarning:{color:e.palette.warning.dark,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputInfo:{color:"green",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputValidating:{color:"orange",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)}})))((e=>{const{...t}=e;return y.createElement(mo,t)}))));class $p extends y.Component{render(){const{value:e,valueConverter:t,classes:r}=this.props,n=t?t(e):e;return y.createElement("div",{className:r.container},n)}}const Wp=(0,I.withStyles)((()=>({container:{width:"100%",fontWeight:500,fontSize:14,color:vn.T.grey900}})))($p);class Hp extends y.Component{render(){const{...e}=this.props;return y.createElement(Io,e)}}const zp=(0,I.withTheme)()(Du()((0,I.withStyles)((e=>({innerInputError:{color:e.palette.error.main,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputWarning:{color:e.palette.warning.dark,padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputInfo:{color:"green",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)},innerInputValidating:{color:"orange",padding:e.typography.pxToRem(3),fontSize:e.typography.pxToRem(12)}})))(Hp)));function Yp(){return Yp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Yp.apply(this,arguments)}function qp(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Kp="validatingMessage",Qp="errorMessage",Xp="warningMessage",Jp="infoMessage",Zp="errorMessage",em="warningMessage",tm="infoMessage",rm="validatingMessage",nm=e=>t=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return class r extends y.Component{constructor(){super(...arguments),qp(this,"getMessage",(e=>t[e]?this.props[t[e]]:this.props[e]))}static getMessage(e,t,r,n){let a,o;return n?(a=n,o=Kp):e?(a=e,o=Qp):t?(a=t,o=Xp):r&&(a=r,o=Jp),{message:a,typeKey:o}}static getRulesMessage(e,t,r,n,a,o,i){let s,l;return e?(s=e,l=Qp):r&&i?(s=r,l=Qp):t?(s=t,l=Xp):n&&i?(s=n,l=Xp):a&&(o||i)&&(s=a,l=Qp),{message:s,typeKey:l}}render(){const{errorMessage:t,warningMessage:n,infoMessage:a,validatingMessage:o,rulesErrorMessage:i,rulesWarningMessage:s,rulesErrorMessageOnComplete:l,rulesWarningMessageOnComplete:d,rulesCompulsoryError:c,touched:u,validationAttempted:p,...m}=this.props;let g=u||p?r.getMessage(this.getMessage(Zp),this.getMessage(em),this.getMessage(tm),this.getMessage(rm)):{};g.message||(g=r.getRulesMessage(i,s,l,d,c,u,p));const h=g.message?{[g.typeKey]:g.message}:null;return y.createElement("div",null,y.createElement(e,Yp({},h,m)))}}}(t,e);function am(){return am=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},am.apply(this,arguments)}function om(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const im=e=>({base:{paddingTop:10,marginLeft:0,paddingLeft:0},error:{color:vn.T.red600,fontSize:e.typography.pxToRem(14)},warning:{color:vn.T.yellow800,fontSize:e.typography.pxToRem(14)},info:{color:vn.T.green700,fontSize:e.typography.pxToRem(14)},validating:{color:vn.T.grey700,fontSize:e.typography.pxToRem(14)},validatingContainer:{display:"flex",alignItems:"center",color:vn.T.grey700},validatingIndicator:{fontSize:12,marginTop:1,marginRight:4},listItem:{listStylePosition:"inside"}}),sm="error",lm="warning",dm="info",cm="validating",um=e=>class t extends y.Component{constructor(){super(...arguments),om(this,"convertMessage",((e,r)=>{if((0,wc.A)(e)&&!y.isValidElement(e))return{innerMessage:{message:e,messageType:r}};const{classes:n}=this.props;return{element:t.createMessageElement(e,n.base,n[r],{container:n.validatingContainer,indicator:n.validatingIndicator},n.listItem,r)}}))}static createMessageElement(e,t,r,n,a,o){return o===cm?y.createElement("div",{className:t},y.createElement("div",{className:n.container},y.createElement("div",{className:n.indicator},y.createElement(C.F,{small:!0})),y.createElement("div",{className:r},e))):y.createElement("ul",{"data-test":"error-message",className:er()(t,r)},Array.isArray(e)?null===e||void 0===e?void 0:e.map((e=>y.createElement("li",{className:a},e,y.createElement("br",null)))):e)}getMessage(e,t,r,n){let a={};return n?a=this.convertMessage(n,cm):e?a=this.convertMessage(e,sm):t?a=this.convertMessage(t,lm):r&&(a=this.convertMessage(r,dm)),a}render(){const{classes:t,errorMessage:r,warningMessage:n,infoMessage:a,validatingMessage:o,...i}=this.props,s=this.getMessage(r,n,a,o),l=s.innerMessage?{innerMessage:s.innerMessage}:null;return y.createElement("div",null,y.createElement(e,am({},l,i)),s.element)}},pm=()=>e=>(0,I.withStyles)(im)(um(e)),mm=()=>({container:{padding:"8px 8px 8px 12px"},activeContainer:{backgroundColor:vn.T.blue100},validatingContainer:{},errorContainer:{backgroundColor:vn.T.red100},warningContainer:{backgroundColor:vn.T.yellow100},infoContainer:{}}),gm=(e,t)=>class extends y.Component{render(){const{classes:r,...n}=this.props,a=er()(r.container,{[r.activeContainer]:n.inFocus,[r.validatingContainer]:n.validatingMessage&&!n.inFocus,[r.errorContainer]:n.errorMessage&&!n.inFocus&&!n.validatingMessage,[r.warningContainer]:n.warningMessage&&!n.inFocus&&!n.validatingMessage&&!n.errorMessage,[r.infoContainer]:n.infoMessage&&!n.inFocus&&!n.validatingMessage&&!n.errorMessage&&!n.warningMessage});return y.createElement("div",{className:a,style:t},y.createElement(e,n))}},hm=e=>t=>(0,I.withStyles)(mm)(gm(t,e));var Em=r(53685);const ym=()=>e=>class extends y.Component{shouldComponentUpdate(e){return Object.keys(e).some((t=>e[t]!==this.props[t]&&!(0,Em.A)(e[t])))}render(){return y.createElement(e,this.props)}},vm=e=>t=>r=>{const n=e(r);return y.createElement(t,n)},fm=()=>e=>class extends y.Component{goto(){if(this.gotoInstance){this.gotoInstance.scrollIntoView();const e=window.scrollY;e&&window.scroll(0,e-48)}}render(){return y.createElement("div",{ref:e=>{this.gotoInstance=e}},y.createElement(e,this.props))}},Im=()=>e=>class extends y.Component{render(){const{hidden:t,...r}=this.props;return t?null:y.createElement(e,r)}};var bm=r(94164);function Sm(){return Sm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sm.apply(this,arguments)}const Tm=e=>{let{name:t,alternativeText:r=t,...n}=e;const a=(0,j.iT)(j.Gv.customIcons),{baseUrl:o,apiVersion:i}=(0,A.UK)();let s;return t&&(s=(0,j.c$)(o,`api/${i}/icons/${t}/icon`),s=a?s:`${s}.svg`),y.createElement(Wo,Sm({},n,{source:s,alternativeText:r}))};var Am=r(44568);function Cm(){return Cm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Cm.apply(this,arguments)}const Om=()=>({iconContainer:{display:"flex",alignItems:"center",marginLeft:yn.Q.dp4,padding:2,borderRadius:3,background:"transparent",color:vn.T.grey700,"&:hover":{cursor:"pointer",background:vn.T.grey200,color:vn.T.grey900}},iconContainerActive:{background:vn.T.grey300,color:vn.T.grey900},popOverContainer:{padding:`${yn.Q.dp12} ${yn.Q.dp12}`,wordBreak:"break-word","& + &":{paddingTop:0}},label:{fontWeight:500,fontSize:14,color:vn.T.grey900,paddingBottom:4,margin:0},content:{fontSize:"14px",lineHeight:"18px",color:vn.T.grey900,margin:0},url:{fontSize:14}}),Nm=()=>e=>(0,I.withStyles)(Om)(class extends y.Component{constructor(e){super(e),this.iconRef=y.createRef(),this.state={popOverOpen:!1}}renderDescription(e,t){const{classes:r}=this.props;return y.createElement("div",null,y.createElement("div",{role:"button",tabIndex:-1,ref:this.iconRef,className:`${r.iconContainer} ${this.state.popOverOpen?r.iconContainerActive:""}`,onClick:()=>{this.setState({popOverOpen:!0})}},y.createElement(bm.A,null)),this.state.popOverOpen&&y.createElement(Am.A,{reference:this.iconRef.current,onClickOutside:()=>this.setState({popOverOpen:!1})},e?y.createElement("div",{className:r.popOverContainer},y.createElement("p",{className:r.label},n.A.t("Description")),y.createElement("p",{className:r.content},e)):null,t?y.createElement("div",{className:r.popOverContainer},y.createElement("p",{className:r.label},n.A.t("URL")),y.createElement("a",{className:r.url,href:t,target:"_blank",rel:"noreferrer"},t)):null))}render(){const{description:t,url:r,classes:n,...a}=this.props;return t||r?y.createElement(e,Cm({},a,{dataElementDescription:this.renderDescription(t,r)})):y.createElement(e,a)}});function Rm(){return Rm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rm.apply(this,arguments)}const wm=e=>({label:{color:e.palette.text.primary,paddingBottom:4},labelVertical:{color:e.palette.text.primary}}),_m=e=>({container:{display:"flex",alignItems:"center"},required:{color:e.palette.required},iconContainer:{paddingLeft:5,display:"flex",alignItems:"center"},tooltipIcon:{display:"flex",alignItems:"center",paddingLeft:yn.Q.dp8,cursor:"pointer"}}),Pm=e=>t=>{const r=e&&e.onGetUseVerticalOrientation,a=e&&e.onGetCustomFieldLabeClass,o=e&&e.customTooltip,i=Po({onGetUseVerticalOrientation:e=>r&&r(e),onSplitClasses:(e,t)=>{const{label:n,labelVertical:o,...i}=e;return{labelContainer:null,labelClasses:{label:r&&r(t)?o:er()(n,a&&a(t))},passOnClasses:i}}})(t),s=e=>y.createElement("span",null,e.label,y.createElement("span",{className:e.requiredClass},"\xa0*")),l=e=>{const{icon:t,label:r}=e;return t?y.createElement(Tm,{name:t.name,color:t.color,alternativeText:n.A.t("Icon for {{field}}",{field:r||"",interpolation:{escapeValue:!1}}),cornerRadius:2,width:22,height:22}):null},d=e=>{const{label:t,required:r}=e;return r&&t?y.createElement(s,e):t},c=Nm()((0,I.withStyles)(_m)((e=>{const{label:t,required:r,icon:n,classes:a,dataElementDescription:i}=e;return y.createElement("div",{className:a.container},y.createElement("div",{className:a.iconContainer},y.createElement(l,{icon:n,label:t})),y.createElement(d,{label:t||"",required:r,requiredClass:a.required}),o?y.createElement(Xo.m,{content:o()},y.createElement("div",{className:a.tooltipIcon},y.createElement(bm.A,{color:vn.T.grey600}))):i)})));return(0,I.withStyles)(wm)((e=>{const{label:t,required:r,icon:n,...a}=e,{classes:o,...s}=e;return y.createElement(i,Rm({label:y.createElement(c,s)},a))}))},km=(e,t)=>class extends y.Component{render(){const{...r}=this.props;return y.createElement("div",{style:t(this.props)},y.createElement(e,r))}};function Dm(){return Dm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dm.apply(this,arguments)}const Um=()=>({iconContainer:{display:"flex",alignItems:"center",paddingRight:5},icon:{width:22,height:22,borderRadius:2}}),Lm=()=>e=>(0,I.withStyles)(Um)(class extends y.Component{constructor(e){super(e),this.options=this.getOptions()}getIcon(e){const{label:t,classes:r}=this.props;return e?y.createElement("div",{className:r.iconContainer},y.createElement(Tm,{name:e.name,color:e.color,width:22,height:22,cornerRadius:2,alternativeText:t||void 0})):null}getOptions(){const{options:e}=this.props;return e.map((e=>({...e,icon:this.getIcon(e.icon)})))}render(){const{options:t,classes:r,...n}=this.props;return y.createElement(e,Dm({options:this.options},n))}}),Fm="USER_CAPTURE",xm="USER_SEARCH";function Mm(){return Mm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mm.apply(this,arguments)}function Vm(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const jm=()=>e=>{var t;return t=class t extends y.Component{constructor(e){super(e),Vm(this,"handleFilterChange",(e=>{e?this.filterOrgUnits(e):this.resetOrgUnits()})),this.state={filteredRoots:null,filterText:null,inProgress:!1,treeKey:t.INITIAL_TREE_KEY},this.cancelablePromise=null}componentWillUnmount(){this.cancelablePromise&&this.cancelablePromise.cancel()}filterOrgUnits(e){const{scope:t,onSearchError:r,querySingleResource:n}=this.props,a=t===Fm?{withinUserHierarchy:!0}:{withinUserSearchHierarchy:!0};this.setState({inProgress:!0}),this.cancelablePromise&&this.cancelablePromise.cancel();const o=(0,j.gI)(n({resource:"organisationUnits",params:{fields:["id,displayName,path,publicAccess,access,lastUpdated","children[id,displayName,publicAccess,access,path,children::isNotEmpty]"].join(","),paging:!1,query:e,...a}}));o.promise.then((t=>{this.setState({filteredRoots:t.toArray(),filterText:e,inProgress:!1,treeKey:e}),this.cancelablePromise=null})).catch((e=>{S().error((0,j.px)("There was an error retrieving organisation unit roots")({error:e})),r&&r(e)})),this.cancelablePromise=o}resetOrgUnits(){this.setState({filteredRoots:null,filterText:null,treeKey:t.INITIAL_TREE_KEY})}render(){const{defaultRoots:t,onSearchError:r,onSelect:n,scope:a,...o}=this.props,{filteredRoots:i,filterText:s,treeKey:l,inProgress:d}=this.state;return y.createElement(e,Mm({roots:i||t,treeKey:l,searchText:s,ready:!d,onSearch:this.handleFilterChange,onBlur:n},o))}},Vm(t,"INITIAL_TREE_KEY","initial"),t},Gm={};function Bm(e,t){Gm[e]=t}function $m(e){return Gm[e]}function Wm(){return Wm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Wm.apply(this,arguments)}const Hm=e=>t=>r=>{const[n,a]=e,o={[a]:r[n]},i={...r};return i[n]&&delete i[n],y.createElement(t,Wm({},i,o))};var zm=r(9127);const Ym=()=>({errorContainer:{margin:20}}),qm=()=>e=>(0,I.withStyles)(Ym)((t=>{const{error:r,classes:n,...a}=t;return r?y.createElement(zm.I,{error:!0,dataTest:"error-message-handler",className:n.errorContainer},y.createElement("div",null,r)):y.createElement(e,a)})),Km=(e,t,r)=>n=>{const a=(0,gs.Ng)(((t,r)=>({ready:e(t,r)})),null,((e,t,r)=>Object.assign({},r,e,t,{InnerComponent:n})))(((e,t)=>r=>{const{ready:n,InnerComponent:a,...o}=r;if(!n){if(t)return y.createElement(O,null);const n=e?e(r):null;return y.createElement(_,{containerStyle:n})}return y.createElement(a,o)})(t,r));return a};function Qm(){return Qm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qm.apply(this,arguments)}const Xm=e=>t=>{const r=(0,A.ow)(),{querySingleResource:n,mutate:a}=(0,y.useMemo)((()=>({querySingleResource:D(r.query.bind(r)),mutate:r.mutate.bind(r)})),[r]);return y.createElement(e,Qm({},t,{querySingleResource:n,mutate:a}))};function Jm(){return Jm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Jm.apply(this,arguments)}function Zm(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const eg=()=>e=>{const t=Xm(jm()(e));class r extends y.Component{constructor(e){super(e);const{scope:t}=this.props;this.defaultRoots=$m(r.DEFAULT_ROOTS_DATA[t])||[]}render(){const{...e}=this.props;return y.createElement(t,Jm({defaultRoots:this.defaultRoots},e))}}return Zm(r,"DEFAULT_ROOTS_DATA",{[Fm]:"captureRoots",[xm]:"search"}),r},tg=(e,t)=>{const r=e&&e.theme&&e.theme.typography.pxToRem;return r?r(t):t},rg="onBlur",ng=(e,t)=>({id:e.id,validators:cu(e,t),commitEvent:rg}),ag={labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}},og={labelContainerStyle:{width:150},inputContainerStyle:{width:150}},ig=e=>{let{formName:t,compulsory:r,disabled:n,unique:a,icon:o,description:i,url:s}=e;return{description:i,url:s,styles:ag,label:t,metaCompulsory:r,metaDisabled:n||a&&a.generatable,icon:o?{name:o.name,color:o.color}:null}},sg=e=>({style:{width:tg(e,150)},styles:og}),lg=(e,t,r)=>({...ig(r),...t&&t.formHorizontal?sg(t):{},...e}),dg=(e,t,r)=>({...ng(t,r),...e});function cg(){return cg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cg.apply(this,arguments)}const ug=()=>e=>class extends y.Component{render(){const{metaCompulsory:t,rulesCompulsory:r,...n}=this.props;return y.createElement(e,cg({required:!(!t&&!r)},n))}};function pg(){return pg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pg.apply(this,arguments)}const mg=()=>e=>class extends y.Component{render(){const{metaDisabled:t,rulesDisabled:r,...n}=this.props;return y.createElement(e,pg({disabled:!(!t&&!r)},n))}};var gg={booleanLabel:"buildField_booleanLabel__d5Thg",trueOnlyLabel:"buildField_trueOnlyLabel__wmdl5",textLabel:"buildField_textLabel__BVgia",ageLabel:"buildField_ageLabel__a4jJB",coordinateLabel:"buildField_coordinateLabel__X6uDk",polygonLabel:"buildField_polygonLabel__3PeW0",dateLabel:"buildField_dateLabel__hdKLu",dateTimeLabel:"buildField_dateTimeLabel__+CXg9",imageLabel:"buildField_imageLabel__D26aE",fileLabel:"buildField_fileLabel__f6n0N",orgUnitLabel:"buildField_orgUnitLabel__4Sm4A",optionSetBoxesLabel:"buildField_optionSetBoxesLabel__n60Hw"};const hg=e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n},Eg=()=>e=>fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.textLabel}`})(pm()(vm(hg)(Qr()(e))))))))))));function yg(){return yg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yg.apply(this,arguments)}const vg=e=>t=>class extends y.Component{constructor(t){super(t),this.defaultClass=e&&e(this.props)}render(){const{customFormElementProps:e,...r}=this.props,n=er()(e.className,this.defaultClass);return y.createElement("div",yg({},e,{className:n}),y.createElement(t,r))}};var fg=r(53541),Ig=r(85102);const bg=(0,fg.Ad)(Ig.UI,((e,t)=>Object.keys(t).every((r=>t[r]===e[r])))),Sg=(e,t)=>{const r=e.rulesEffectsOptionsVisibility[t.formId]||{};return{hideOptions:r.hideOptions&&r.hideOptions[t.id],hideOptionGroups:r.hideOptionGroups&&r.hideOptionGroups[t.id],showOptionGroups:r.showOptionGroups&&r.showOptionGroups[t.id]}};function Tg(){return Tg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tg.apply(this,arguments)}function Ag(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Cg=[{key:"showOptionGroups",createFilter:(e,t)=>{const r=e.map((e=>t.get(e.optionGroupId)));return e=>r.some((t=>t&&!!t.optionIds.get(e.id)))}},{key:"hideOptionGroups",createFilter:(e,t)=>{const r=e.map((e=>t.get(e.optionGroupId)));return e=>!r.some((t=>t&&!!t.optionIds.get(e.id)))}},{key:"hideOptions",createFilter:e=>t=>!e.some((e=>e.optionId===t.id))}],Og=e=>{var t;return Ag(t=class t extends y.Component{constructor(e){super(e),this.filteredOptions=t.getFilteredOptions(e)}UNSAFE_componentWillReceiveProps(e){e.rulesOptionsVisibility!==this.props.rulesOptionsVisibility&&(this.filteredOptions=t.getFilteredOptions(e))}render(){const{options:t,...r}=this.props;return y.createElement(e,Tg({options:this.filteredOptions},r))}},"getFilteredOptions",(e=>{const{options:t,rulesOptionsVisibility:r,optionGroups:n}=e,a=Cg.filter((e=>r[e.key]&&r[e.key].length>0)).map((e=>e.createFilter(r[e.key],n)));return t.filter((e=>a.every((t=>t(e)))))})),t},Ng=()=>{const e=bg(Sg,(e=>e));return(t,r)=>({rulesOptionsVisibility:e(t,r)})},Rg=()=>e=>(0,gs.Ng)(Ng,(()=>({})))(Og(e)),wg=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.ageLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Qr()(Lu)))))))))))),_g=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.booleanLabel}`})(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(pm()(_u))))))))))),Pg=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.coordinateLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Qr()(Np)))))))))))),kg=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.dateLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Qr()(Ep)))))))))))),Dg=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.dateTimeLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Qr()(vp))))))))))));var Ug=r(50504);function Lg(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Fg=new class{constructor(){Lg(this,"get",(e=>this.fileUrls[e])),Lg(this,"set",((e,t)=>{this.fileUrls[e]=URL.createObjectURL(t)})),Lg(this,"clear",(()=>{this.fileUrls=Object.keys(this.fileUrls).reduce(((e,t)=>(URL.revokeObjectURL(this.fileUrls[t]),e)),{})})),this.fileUrls={}}};function xg(){return xg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xg.apply(this,arguments)}const Mg=(0,I.withStyles)((e=>({button:{border:"none",fontSize:e.typography.pxToRem(16),display:"inline-block",textDecoration:"underline",cursor:"pointer","&:disabled":{color:"rgba(0, 0, 0, 0.26)",cursor:"default"}}})))((e=>{const{classes:t,children:r,muiClasses:n,muiButtonRef:a,className:o,...i}=e;return y.createElement("button",xg({className:er()(t.button,o)},i),r)}));function Vg(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class jg extends y.Component{constructor(e){super(e),Vg(this,"handleFileChange",(e=>{this.setState((e=>{e.fileSelectorOpen=!1})),e.preventDefault();const t=e.target.files[0];e.target.value=null,t&&this.props.onCommitAsync((()=>this.props.mutate({resource:"fileResources",type:"create",data:{file:t}}).then((e=>{const r=e&&e.response&&e.response.fileResource;return r?(Fg.set(r.id,t),{name:r.name,value:r.id}):null}))))})),Vg(this,"handleButtonClick",(()=>{this.hiddenFileSelectorRef.click(),this.setState((e=>{e.fileSelectorOpen=!0}))})),Vg(this,"handleCancel",(()=>{this.setState((e=>{e.fileSelectorOpen=!1}))})),Vg(this,"handleRemoveClick",(()=>{this.props.onBlur(null)})),Vg(this,"handleBlur",(()=>{this.state.fileSelectorOpen||this.props.onBlur(this.getFileUrl())})),Vg(this,"getFileUrl",(()=>{const e=this.props.value;return e?e.url||Fg.get(e.value):null})),this.state={fileSelectorOpen:!1}}render(){const{value:e,classes:t,asyncUIState:r,orientation:a,disabled:o}=this.props,i=r&&r.loading,s=this.getFileUrl(),l=a===qr,d=l?t.verticalContainer:t.horizontalContainer,c=l?t.verticalSelectedFileTextContainer:t.horizontalSelectedFileTextContainer;return y.createElement("div",{onBlur:this.handleBlur},y.createElement("input",{className:t.input,type:"file",ref:e=>{this.hiddenFileSelectorRef=e},onChange:e=>this.handleFileChange(e),onCancel:this.handleCancel}),(()=>i?y.createElement("div",{className:d},y.createElement("div",{className:t.innerContainer},y.createElement(C.F,null)),y.createElement("div",{className:t.innerContainer},n.A.t("Uploading file"))):e?y.createElement("div",{className:d},y.createElement("div",{className:c},y.createElement(Ug.A,{color:vn.T.green600}),y.createElement("a",{className:!l&&t.horizontalLink,target:"_blank",href:s,rel:"noopener noreferrer",onBlur:e=>{e.stopPropagation()}},e.name),` ${n.A.t("selected")}.`),y.createElement("div",{className:t.innerContainer},y.createElement(Mg,{disabled:o,onClick:this.handleRemoveClick,className:t.deleteButton},n.A.t("Delete")))):y.createElement("div",null,y.createElement(ra.$,{onClick:this.handleButtonClick,color:"primary",disabled:o},n.A.t("Select file"))))())}}const Gg=(0,I.withStyles)((e=>({horizontalContainer:{display:"flex",alignItems:"center",flexWrap:"wrap"},verticalContainer:{display:"flex",flexWrap:"wrap",flexDirection:"column",alignItems:"flex-start"},innerContainer:{padding:e.typography.pxToRem(2),paddingRight:e.typography.pxToRem(10)},horizontalSelectedFileTextContainer:{padding:e.typography.pxToRem(2),paddingRight:e.typography.pxToRem(10),display:"flex",alignItems:"center",flexWrap:"wrap",wordBreak:"break-word"},verticalSelectedFileTextContainer:{padding:e.typography.pxToRem(2),paddingRight:e.typography.pxToRem(10),display:"flex",flexWrap:"wrap",flexDirection:"column",alignItems:"flex-start",wordBreak:"break-word"},deleteButton:{color:e.palette.error.main,textDecoration:"underline",cursor:"pointer"},input:{display:"none"},horizontalLink:{paddingRight:e.typography.pxToRem(5)}})))(Xm(jg)),Bg=Eg()(Gg);function $g(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Wg extends y.Component{constructor(e){super(e),$g(this,"handleImageChange",(e=>{this.setState((e=>{e.imageSelectorOpen=!1})),e.preventDefault();const t=e.target.files[0];e.target.value=null,t&&this.props.onCommitAsync((()=>this.props.mutate({resource:"fileResources",type:"create",data:{file:t}}).then((e=>{const r=e&&e.response&&e.response.fileResource;if(r){Fg.set(r.id,t);const e=Fg.get(r.id);return{name:r.name,value:r.id,url:e,previewUrl:e}}return null}))))})),$g(this,"handleButtonClick",(()=>{this.hiddenimageSelectorRef.click(),this.setState((e=>{e.imageSelectorOpen=!0}))})),$g(this,"handleCancel",(()=>{this.setState((e=>{e.imageSelectorOpen=!1}))})),$g(this,"handleRemoveClick",(()=>{this.props.onBlur(null)})),$g(this,"handleBlur",(()=>{this.state.imageSelectorOpen||this.props.onBlur(this.getImageUrl())})),$g(this,"getImageUrl",(()=>{const e=this.props.value;return e?e.url||Fg.get(e.value):null})),$g(this,"getPreviewUrl",(()=>{const e=this.props.value;return e?e.previewUrl||Fg.get(e.value):null})),$g(this,"render",(()=>{const{value:e,classes:t,asyncUIState:r,orientation:a,disabled:o}=this.props,i=a===qr,s=r&&r.loading,l=this.getImageUrl(),d=this.getPreviewUrl(),c=i?t.verticalContainer:t.horizontalContainer,u=i?t.verticalSelectedImageTextContainer:t.horizontalSelectedImageTextContainer;return y.createElement("div",{onBlur:this.handleBlur},y.createElement("input",{className:t.input,type:"file",accept:"image/*",ref:e=>{this.hiddenimageSelectorRef=e},onChange:e=>this.handleImageChange(e),onCancel:this.handleCancel}),(()=>s?y.createElement("div",{className:c},y.createElement("div",{className:t.innerContainer},y.createElement(C.F,null)),y.createElement("div",{className:t.innerContainer},n.A.t("Uploading image"))):e?y.createElement("div",{className:c},!i&&y.createElement("div",{className:t.innerContainer},y.createElement("a",{target:"_blank",href:l,rel:"noopener noreferrer",onBlur:e=>{e.stopPropagation()}},y.createElement("img",{src:d,alt:"",className:t.image}))),y.createElement("div",{className:u},y.createElement(Ug.A,{color:vn.T.green600}),i?y.createElement("a",{target:"_blank",href:l,rel:"noopener noreferrer"},e.name):e.name,` ${n.A.t("selected")}.`),y.createElement("div",{className:t.innerContainer},y.createElement(Mg,{disabled:o,className:t.deleteButton,onClick:this.handleRemoveClick},n.A.t("Delete")))):y.createElement("div",null,y.createElement(ra.$,{disabled:o,onClick:this.handleButtonClick,color:"primary"},n.A.t("Select image"))))())})),this.state={imageSelectorOpen:!1}}}const Hg=(0,I.withStyles)((e=>({horizontalContainer:{display:"flex",alignItems:"center",flexWrap:"wrap"},verticalContainer:{display:"flex",flexWrap:"wrap",flexDirection:"column",alignItems:"flex-start"},innerContainer:{padding:e.typography.pxToRem(2),paddingRight:e.typography.pxToRem(10)},horizontalSelectedImageTextContainer:{padding:e.typography.pxToRem(2),paddingRight:e.typography.pxToRem(10),display:"flex",alignItems:"center",flexWrap:"wrap",wordBreak:"break-word"},verticalSelectedImageTextContainer:{padding:e.typography.pxToRem(2),paddingRight:e.typography.pxToRem(10),display:"flex",flexWrap:"wrap",flexDirection:"column",alignItems:"flex-start",wordBreak:"break-word"},deleteButton:{color:e.palette.error.main},input:{display:"none"},image:{maxHeight:e.typography.pxToRem(52),maxWidth:e.typography.pxToRem(70)}})))(Xm(Wg)),zg=Eg()(Hg),Yg=fm()(Im()(ym()(mg()(ug()(hr()(nm()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.textLabel}`})(pm()(Lm()(Rg()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(dp()(tp)))))))))))))),qg=fm()(Im()(ym()(mg()(ug()(hr()(nm()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.textLabel}`})(pm()(Lm()(Rg()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(up()(sp)))))))))))))),Kg=fm()(Im()(ym()(mg()(ug()(hr()(nm()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.optionSetBoxesLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Rg()(mp)))))))))))),Qg="RequestFilterFormFieldOrgUnits",Xg="FilteredFormFieldOrgUnitsRetrieved",Jg="FilterFormFieldOrgUnitsFailed",Zg="ResetFormFieldOrgUnitsFilter",eh=(e,t)=>[e,t].join("-");function th(){return th=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},th.apply(this,arguments)}function rh(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const nh=e=>class extends y.Component{constructor(){super(...arguments),rh(this,"handleFilterOrgUnits",(e=>{e?this.props.filterOrgUnits(this.props.formId,this.props.elementId,e):this.props.resetOrgUnits(this.props.formId,this.props.elementId)}))}componentWillUnmount(){const{formId:e,elementId:t}=this.props;Bm(eh(e,t),null)}render(){const{formId:t,elementId:r,filterOrgUnits:n,resetOrgUnits:a,...o}=this.props;return y.createElement(e,th({onSearch:this.handleFilterOrgUnits},o))}},ah=(e,t)=>{const r=eh(t.formId,t.elementId),n=e.formsFieldsMisc[t.formId][t.elementId]||{},a=$m(r)||$m("searchRoots");return{searchText:n.orgUnitsSearchText,ready:!n.orgUnitsLoading,treeKey:n.orgUnitsSearchText||"initial",roots:a}},oh=e=>({filterOrgUnits:(t,r,n)=>{e(((e,t,r)=>l(Qg)({formId:e,elementId:t,searchText:r}))(t,r,n))},resetOrgUnits:(t,r)=>{e(((e,t)=>l(Zg)({formId:e,elementId:t}))(t,r))}}),ih=fm()(Im()(ym()(mg()(ug()(nm()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.orgUnitLabel}`})(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(pm()(Qr()((e=>(0,gs.Ng)(ah,oh)(nh(e)))(jp)))))))))))),sh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()((e=>t=>km(t,e))((()=>({paddingTop:10,paddingBottom:10})))(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.polygonLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Qr()(_p))))))))))))),lh=fm()(Im()(ym()(mg()(ug()(hr()(nm()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.textLabel}`})(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(pm()(Qr()(Nu)))))))))))),dh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.trueOnlyLabel}`})(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(pm()(Mu))))))))))),ch=(0,y.createContext)({inputName:"userfield_input",suggestionName:"userfield_search_suggestion"});function uh(){return uh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uh.apply(this,arguments)}const ph=hr()(vr()(Qa)),mh=e=>{const{onUpdateValue:t,onHighlightSuggestion:r,onSelectSuggestion:a,onResetDisplayedHighlight:o,onExitSearch:i,inputWrapperClasses:s,inputDomRef:l,useUpwardList:d,placeholder:c,...u}=e,{inputName:p,suggestionName:m}=y.useContext(ch),g=y.useCallback((e=>t(e.currentTarget.value)),[t]),h=y.useCallback((e=>{40===e.keyCode&&!d||38===e.keyCode&&d?(r(),e.stopPropagation(),e.preventDefault()):13===e.keyCode&&a()}),[r,a,d]),E=y.useCallback((e=>{e.relatedTarget&&((e,t)=>{if(e.getAttribute("name")===t)return!0;const r=e.parentElement;return!!r&&r.getAttribute("name")===t})(e.relatedTarget,m)||i()}),[i,m]);return y.createElement(ph,uh({name:p,inputRef:l,onDebounced:g,onFocus:o,onKeyDown:h,onBlur:E,classes:s,placeholder:void 0!==c?c:n.A.t("start typing to search")},u))};var gh="searchSuggestions_container__EWqe3",hh="searchSuggestions_list__U-v9G",Eh="searchSuggestionsUp_listUp__QGwva",yh="searchSuggestionsUp_listUpInner__n-7HQ";const vh=e=>{const{children:t,onHighlightNext:r,onHighlightPrev:n}=e,a=y.useRef(null);y.useLayoutEffect((()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)}),[]);const{suggestionName:o}=y.useContext(ch),i=y.useCallback((e=>{38===e.keyCode?(r(),e.stopPropagation(),e.preventDefault()):40===e.keyCode&&(n(),e.stopPropagation(),e.preventDefault())}),[r,n]);return y.createElement("div",{name:o,tabIndex:-1,onKeyDown:i,role:"none"},y.createElement("div",{ref:a,className:Eh},y.createElement("div",{name:o,className:yh},t)))};var fh=r(73689),Ih=r.n(fh),bh=r(65210),Sh="searchSuggestion_suggestion__Q-y+m",Th="searchSuggestion_suggestionInUpList__K6SGZ";const Ah=e=>{const{user:t,query:r,isHighlighted:n,onHighlightNext:a,onHighlightPrev:o,suggestionRef:i,onSelect:s,onExitSearch:l,useUpwardList:d}=e,{inputName:c,suggestionName:u}=y.useContext(ch),p=`${t.name} (${t.username})`,m=function(e,t){const r=e.toLocaleLowerCase(),n=t.toLocaleLowerCase(),a=r.indexOf(n);return a<=-1?[]:[[a,a+t.length]]}(p,r),g=Ih()(p,m),h=y.useCallback((e=>{40===e.keyCode&&!d||38===e.keyCode&&d?a(t):38===e.keyCode&&!d||40===e.keyCode&&d?o(t):13===e.keyCode&&s(t),e.stopPropagation(),e.preventDefault()}),[a,o,s,t,d]),E=y.useCallback((e=>{i(e,t)}),[i,t]),v=y.useCallback((e=>{s(t),e.stopPropagation()}),[s,t]),f=y.useCallback((e=>{e.relatedTarget&&function(e,t,r){if(e.getAttribute("name")===t||e.getAttribute("name")===r)return!0;const n=e.parentElement;return!!n&&n.getAttribute("name")===t}(e.relatedTarget,u,c)||l()}),[l,u,c]);return y.createElement("div",{name:u,role:"button",tabIndex:-1,ref:E,className:d?er()(Sh,Th):Sh,onKeyDown:h,onClick:v,onBlur:f},y.createElement(bh.D,{active:n,label:y.createElement("div",null,g.map(((e,t)=>e.highlight?y.createElement("span",{key:String(t),style:{fontWeight:500}},e.text):y.createElement("strong",{key:String(t),style:{fontWeight:300}},e.text))))}))};function Ch(){return Ch=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ch.apply(this,arguments)}class Oh extends y.Component{static renderSuggestions(e,t,r,n){const a=e.map((e=>y.createElement(Ah,Ch({key:e.id,user:e,query:t,isHighlighted:r===e},n))));return n.useUpwardList?y.createElement(vh,{key:t,onHighlightNext:n.onHighlightNext,onHighlightPrev:n.onHighlightPrev},a):y.createElement("div",null,y.createElement("div",{className:hh},a))}static renderEmpty(){return null}render(){const{suggestions:e,query:t,highlighted:r,...n}=this.props;return y.createElement("div",{className:gh},e.length>0?Oh.renderSuggestions(e,t,r,n):Oh.renderEmpty())}}function Nh(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Rh="selectBestChoice",wh="clear";class _h extends y.Component{constructor(e){super(e),Nh(this,"resetHighlighted",(()=>{this.setState({highlightedSuggestion:void 0})})),Nh(this,"search",(e=>this.props.querySingleResource({resource:"userLookup",params:{query:e}}).then((e=>(e&&e.users||[]).map((e=>({id:e.id,name:e.displayName,username:e.username,firstName:e.firstName,surname:e.surname}))))))),Nh(this,"handleInputChange",(e=>{if(this.cancelablePromise&&this.cancelablePromise.cancel(),this.setState({noMatch:!1}),e.length>1){const t=this.search(e),r=(0,j.gI)(t);this.cancelablePromise=r,r.promise.then((t=>{this.setSuggestions(t,e)})).catch((e=>{e&&e.isCanceled||this.setSuggestionsError(n.A.t("suggestions could not be retrieved"))}))}else this.resetSuggestions()})),Nh(this,"handleHighlightFirstSuggestion",(()=>{const{suggestions:e}=this.state;e.length>0&&this.highlightSuggestion(e[0])})),Nh(this,"handleSelectFirstSuggestion",(()=>{const{suggestions:e}=this.state;e.length>0&&this.props.onSet(e[0])})),Nh(this,"handleExitSearchFromInput",(()=>{const{exitBehaviour:e}=this.props,{suggestions:t}=this.state;switch(e){case Rh:t.length>0?this.props.onSet(t[0]):(this.clearInput(),this.cancelablePromise&&this.cancelablePromise.cancel());break;case wh:this.clear(),this.cancelablePromise&&this.cancelablePromise.cancel()}})),Nh(this,"handleExitSearchFromSuggestions",(()=>{const{exitBehaviour:e}=this.props,{highlightedSuggestion:t}=this.state;switch(e){case Rh:this.props.onSet(t);break;case wh:this.clear(),this.cancelablePromise&&this.cancelablePromise.cancel()}})),Nh(this,"handleHighlightNextSuggestion",(()=>{const{suggestions:e,highlightedSuggestion:t}=this.state,r=e.findIndex((e=>e===t));r<e.length-1&&this.highlightSuggestion(e[r+1])})),Nh(this,"handleHighlightPrevSuggestion",(()=>{const{suggestions:e,highlightedSuggestion:t}=this.state,r=e.findIndex((e=>e===t));r>0?this.highlightSuggestion(e[r-1]):0===r&&this.highlightInput()})),Nh(this,"handleSuggestionRef",((e,t)=>{e?this.suggestionElements.set(t.id,e):this.suggestionElements.has(t.id)&&this.suggestionElements.delete(t.id)})),Nh(this,"handleInputDomRef",(e=>{this.inputDomElement=e})),Nh(this,"handleSuggestionSelect",(e=>{this.props.onSet(e)})),this.suggestionElements=new Map,this.state={suggestions:[],searchValue:"",inputKey:0,noMatch:!1},this.domNames={inputName:`userfield_input${(0,yc.A)()}`,suggestionName:"userfield_search_suggestion"}}componentDidMount(){const{focusInputOnMount:e}=this.props;e&&this.inputDomElement&&this.inputDomElement.focus()}componentWillUnmount(){this.cancelablePromise&&this.cancelablePromise.cancel()}clearInput(){const e=this.state.inputKey;this.setState({inputKey:(e+1)%2})}clear(){this.clearInput(),this.resetSuggestions()}setSuggestions(e,t){this.setState({suggestions:e,highlightedSuggestion:void 0,searchValue:t,noMatch:0===e.length})}resetSuggestions(){this.setState({suggestions:[],highlightedSuggestion:void 0,searchValue:"",noMatch:!1})}setSuggestionsError(e){this.setState({suggestionsError:e})}highlightSuggestion(e){this.setState({highlightedSuggestion:e});const t=this.suggestionElements.get(e.id);t&&t.focus()}highlightInput(){this.setState({highlightedSuggestion:void 0}),this.inputDomElement&&this.inputDomElement.focus()}renderInput(){const{inputKey:e}=this.state,{inputWrapperClasses:t,inputPlaceholderText:r,useUpwardList:n}=this.props;return y.createElement(mh,{key:e,inputDomRef:this.handleInputDomRef,onUpdateValue:this.handleInputChange,onHighlightSuggestion:this.handleHighlightFirstSuggestion,onSelectSuggestion:this.handleSelectFirstSuggestion,onResetDisplayedHighlight:this.resetHighlighted,onExitSearch:this.handleExitSearchFromInput,inputWrapperClasses:t,placeholder:r,useUpwardList:n})}renderSuggestions(){const{suggestions:e,searchValue:t,highlightedSuggestion:r}=this.state,{useUpwardList:n}=this.props;return y.createElement(Oh,{suggestionRef:this.handleSuggestionRef,suggestions:e,query:t,highlighted:r,onHighlightNext:this.handleHighlightNextSuggestion,onHighlightPrev:this.handleHighlightPrevSuggestion,onSelect:this.handleSuggestionSelect,onExitSearch:this.handleExitSearchFromSuggestions,useUpwardList:n})}renderNoMatchFound(){const{noMatch:e}=this.state,{classes:t}=this.props;return e?y.createElement("span",{className:t.noMatchFound},n.A.t("No results found")):null}render(){return y.createElement("div",null,y.createElement(ch.Provider,{value:this.domNames},this.renderInput(),this.renderNoMatchFound(),this.renderSuggestions()))}}const Ph=(0,I.withStyles)((e=>({noMatchFound:{color:vn.T.red600,fontSize:e.typography.pxToRem(14)}})))(Xm(_h));var kh={container:"selected_container__5guKi",chipContainer:"selected_chipContainer__rA+e4",input:"selected_input__yTcY+",inputContainer:"selected_inputContainer__TwYem"};const Dh=e=>{const{text:t,onClear:r,focusInputOnMount:n}=e,a=y.useRef();y.useEffect((()=>{n&&a.current&&a.current.focus()}),[n]);return y.createElement("div",{className:kh.container},y.createElement("div",{ref:e=>{a.current=e},role:"button",className:kh.inputContainer,tabIndex:0,onKeyDown:e=>{[8,46].includes(e.keyCode)&&r()}},y.createElement(Wa,{classes:kh,value:"",disabled:!0})),y.createElement("div",{className:kh.chipContainer},y.createElement(Fp.v,{onRemove:()=>{r()},onClick:()=>{r()}},t)))},Uh=(0,I.withStyles)((()=>({})))((e=>{const{classes:t,value:r,onSet:n,useUpwardSuggestions:a,focusOnMount:o=!1,inputPlaceholderText:i,usernameOnlyMode:s}=e,l=y.useRef(o),d=y.useRef(o);y.useEffect((()=>{l&&(l.current=!1)})),y.useEffect((()=>{d&&(d.current=!1)}));const c=()=>{n(),l.current=!0};return r?y.createElement(Dh,{text:s?r:r.name,onClear:c,focusInputOnMount:d.current}):y.createElement("div",{onBlur:()=>{n(r)}},y.createElement(Ph,{onSet:e=>{n(s?e.username:e),d.current=!0},inputWrapperClasses:t,focusInputOnMount:l.current,useUpwardList:a,inputPlaceholderText:i,exitBehaviour:"selectBestChoice"}))})),Lh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.textLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Hm(["onBlur","onSet"])(Qr()(Uh))))))))))))),Fh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.ageLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Qr()(Gp)))))))))))),xh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.dateLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Qr()(Bp)))))))))))),Mh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.dateTimeLabel}`})(pm()(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Qr()(zp)))))))))))),Vh=Im()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldLabelMediaBasedClass} ${gg.viewModeLabel}`})(vm((e=>{const{formHorizontal:t,fieldLabelMediaBasedClass:r,...n}=e;return n}))(Wp)))),jh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg()(Qr()(Lu)))))))))),Gh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg()(_u)))))))));var Bh="coordinateFieldCustomForm_defaultCustomContainer__VeWdI";const $h=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg((()=>Bh))(Qr()(Np)))))))))),Wh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg()(Qr()(Ep)))))))))),Hh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg()(Qr()(vp)))))))))),zh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg()(Qr()(Gg)))))))))),Yh=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg()(Qr()(Hg))))))))));var qh="optionSetSelectFieldForCustomForm_defaultCustomContainer__Vpn3J";const Kh=fm()(Im()(ym()(mg()(ug()(hr()(nm()(pm()(dp()(vg((()=>qh))(Lm()(Rg()(tp))))))))))));var Qh="optionSetSelectFieldForCustomForm_defaultCustomContainer__R30zN";const Xh=fm()(Im()(ym()(mg()(ug()(hr()(nm()(pm()(up()(vg((()=>Qh))(Lm()(Rg()(sp)))))))))))),Jh=fm()(Im()(ym()(mg()(ug()(hr()(nm()(pm()(Rg()(mp))))))))),Zh=(e,t)=>e.localeCompare(t,n.A.language);function eE(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tE(e){let{label:t,value:r,open:n,depth:a,isSelected:o,children:i,onClick:s,onIconClick:l}=e;const d=i&&Array.isArray(i);let c=20*a;return d||(c+=7),y.createElement("div",null,y.createElement("div",{role:"button",tabIndex:-1,className:er()("label",{selected:o}),onClick:()=>s(r)},y.createElement("div",{style:{minWidth:c}}),d?y.createElement("div",{role:"button",tabIndex:-1,className:"icon",onClick:e=>l(e,!n,r)},n?"\u2212":"+"):y.createElement("div",{className:"icon"}),y.createElement("div",{className:"text"},t)),n&&i&&y.createElement("div",{className:"children"},i))}class rE extends y.Component{constructor(){super(...arguments),eE(this,"onIconClick",((e,t,r)=>{e&&e.stopPropagation();const n=this.updateState(this.props.list,t,r);this.props.onIconClick(r,t,[...n])})),eE(this,"onClick",(e=>{const{multiple:t,selectable:r}=this.props;if(!r)return;let{selected:n}=this.props;const a=!!n&&n.includes(e);"undefined"!==typeof t&&t?(a?n=n.filter((t=>t!==e)):(n=n.slice(0),n.push(e)),this.props.setSelected(n,!a,e)):this.props.setSelected(a?[]:[e],!a,e)}))}updateState(e,t,r){if(!Array.isArray(e))return e;let n=!1;for(let a=0;a<e.length;a+=1)e[a].value===r&&(e[a].open=t,n=!0),n||"undefined"===typeof e[a].children||this.updateState(e[a].children,t,r);return e}node(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.isArray(e)?e.map((e=>{let{open:r,label:n,value:a,children:o}=e;return y.createElement(tE,{key:`node-${a}`,depth:t,open:r,label:n,value:a,onClick:this.onClick,onIconClick:this.onIconClick,isSelected:!!this.props.selected&&this.props.selected.includes(a)},o?this.node(o,t+1):null)})):null}view(){return this.node(this.props.list)}render(){return 0===this.props.list.length?null:y.createElement("div",{className:"ou-tree-container"},y.createElement("div",{className:"ou-tree"},this.view()))}}function nE(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class aE extends y.Component{constructor(){var e;super(...arguments),e=this,nE(this,"state",{list:[],selected:this.props.value}),nE(this,"setSelected",(e=>{this.setState({selected:e}),Array.isArray(e)&&e.length>0?this.props.onBlur(e[0]):this.props.onBlur(null)})),nE(this,"onIconClick",(async(e,t,r)=>{this.setState({list:r}),t&&await this.fetchNode(e)})),nE(this,"fetchRoot",(async()=>{this.props.querySingleResource({resource:"organisationUnits",params:{level:1,paging:!1,fields:"id,path,displayName,children::isNotEmpty"}}).then((e=>{const{value:t}=this.props,r=e.organisationUnits;this.setState({list:r.map((e=>{const{path:r,displayName:n}=e,a=t&&t.startsWith(r)&&t!==r;return a&&this.fetchNode(r,!0),{open:a,value:r,label:n,children:[]}}))})})).catch((()=>{console.log("OrgUnitTree root fetch failed")}))})),nE(this,"fetchNode",(async function(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=t.substr(t.lastIndexOf("/")+1);e.props.querySingleResource({resource:"organisationUnits",params:{paging:!1,filter:`id:in:[${n}]`,fields:":all,displayName,path,children[id,displayName,path,children]"}}).then((n=>{const a=n.organisationUnits[0].children,o=[];for(const t of a){const{value:n}=e.props,a=t.children.length>0?[]:null;let i=null!==a&&n&&n.startsWith(t.path);i&&r&&n.substr(t.path.length).indexOf("/")>-1?e.fetchNode(t.path,r):i=!1,o.push({open:i,children:a,value:t.path,label:t.displayName})}o.sort(((e,t)=>{let{label:r}=e,{label:n}=t;return Zh(r,n)}));const{list:i}=e.state;e.setChildren(t,o,i),e.setState({list:[...i]})})).catch((e=>{console.log("OrgUnitTree fetchNode failed"),console.log(e)}))}))}async UNSAFE_componentWillMount(){await this.fetchRoot()}UNSAFE_componentWillReceiveProps(e){let{value:t}=e;this.setState({selected:t})}setChildren(e,t,r){if(Array.isArray(r))for(let n=0;n<r.length;n+=1){if(r[n].value===e)return void(r[n].children=t.slice(0));r[n].children&&r[n].children.length>0&&this.setChildren(e,t,r[n].children)}}render(){const{label:e,selectable:t,required:r}=this.props,{list:n,selected:a}=this.state;return y.createElement(rE,{required:r,label:e,multiple:!1,selectable:"undefined"===typeof t||t,list:n,selected:a,onIconClick:this.onIconClick,setSelected:this.setSelected})}}const oE=fm()(Im()(ym()(mg()(ug()(nm()(pm()(vg()(Qr()(aE)))))))));var iE="polygonFieldCustomForm_defaultCustomContainer__IyGX3";const sE=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg((()=>iE))(Qr()(_p))))))))));var lE="textFieldCustomForm_defaultCustomContainer__NLl00";const dE=fm()(Im()(ym()(mg()(ug()(hr()(nm()(pm()(vg((()=>lE))(Qr()(Nu)))))))))),cE=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg()(Mu)))))))));var uE="userNameFieldCustomForm_defaultCustomContainer__fIuDr";const pE=fm()(Im()(ym()(mg()(ug()(nm()(hr()(pm()(vg((()=>uE))(Hm(["onBlur","onSet"])(Qr()(Uh)))))))))));var mE="ViewModeFieldCustomForm_defaultCustomContainer__LMQ3k";const gE=Im()(vg((()=>mE))(Wp)),hE="DataElement missing",EE=e=>e.dataElement?e.dataElement.getConvertedOptionSet(xt):(S().error((0,j.px)(hE)({clientOptionSet:e})),null),yE=e=>e.options.map((e=>({id:e.id,name:e.text,value:e.value}))),vE=e=>e.options.map((e=>{let{id:t,text:r,value:n,icon:a}=e;return{id:t,label:r,value:n,icon:a?{name:a.name,color:a.color}:null}})),fE=e=>(0,j.Fs)(EE,yE)(e),IE=e=>(0,j.Fs)(EE,vE)(e);var bE=r(40145);const SE={[bE.UB.DROPDOWN]:e=>({options:IE(e.optionSet),nullable:!e.compulsory,style:{width:"100%"}}),[bE.UB.HORIZONTAL_RADIOBUTTONS]:e=>({options:fE(e.optionSet)}),[bE.UB.VERTICAL_RADIOBUTTONS]:e=>({orientation:qr,options:fE(e.optionSet)})},TE={[bE.UB.DROPDOWN]:Yg,[bE.UB.HORIZONTAL_RADIOBUTTONS]:Kg,[bE.UB.VERTICAL_RADIOBUTTONS]:Kg},AE=(e,t,r)=>{const n=e.optionSet,a=n.inputType,o=SE[a](e),i=lg({id:e.id,formId:t.formId,formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,optionGroups:n.optionGroups,...o},t,e);return dg({component:TE[a],props:i,commitEvent:a===bE.UB.DROPDOWN?"onBlur":"onSelect"},e,r)},CE="DataElement missing",OE=e=>e.dataElement?e.dataElement.getConvertedOptionSet(xt):(S().error((0,j.px)(CE)({clientOptionSet:e})),null),NE=e=>e.options.map((e=>{let{id:t,text:r,value:n,icon:a}=e;return{id:t,label:r,value:n,icon:a?{name:a.name,color:a.color}:null}})),RE=e=>(0,j.Fs)(OE,NE)(e),wE=(e,t,r,n)=>{const a=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,multiLine:n&&n.multiLine},t,e);return dg({component:lh,props:a},e,r)},_E=(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass},t,e);return dg({component:Fh,props:n},e,r)},PE=(0,j.Fs)(Mi,Ci),kE={labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}},DE=(e,t)=>{const r={valueConverter:t=>e.convertValue(t,PE),styles:kE,label:e.formName,dataElement:e,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass};return{id:e.id,component:Vh,props:r}},UE=e=>{let{compulsory:t,disabled:r,unique:n}=e;return{metaCompulsory:t,metaDisabled:r||(null===n||void 0===n?void 0:n.generatable)}},LE=(e,t)=>({...UE(t),...e}),FE=(e,t,r)=>({...ng(t,r),...e}),xE={[bE.UB.DROPDOWN]:e=>({options:IE(e.optionSet),nullable:!e.compulsory}),[bE.UB.HORIZONTAL_RADIOBUTTONS]:e=>({options:fE(e.optionSet)}),[bE.UB.VERTICAL_RADIOBUTTONS]:e=>({orientation:qr,options:fE(e.optionSet)})},ME={[bE.UB.DROPDOWN]:Kh,[bE.UB.HORIZONTAL_RADIOBUTTONS]:Jh,[bE.UB.VERTICAL_RADIOBUTTONS]:Jh},VE=(e,t,r)=>{const n=e.optionSet,a=n.inputType,o=xE[a](e),i=LE({id:e.id,formId:t.formId,optionGroups:n.optionGroups,...o},e);return FE({component:ME[a],props:i,commitEvent:a===bE.UB.DROPDOWN?"onBlur":"onSelect"},e,r)},jE=(e,t,r,n)=>{const a=LE({multiLine:n&&n.multiLine},e);return FE({component:dE,props:a},e,r)},GE=(0,j.Fs)(Mi,Ci),BE=(e,t)=>{const r={valueConverter:t=>e.convertValue(t,GE),label:e.formName,dataElement:e,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass};return{id:e.id,component:gE,props:r}},$E={NO_FORMFIELD_FOR_TYPE:"Formfield component not specified for type"},WE={[it.CO.EMAIL]:wE,[it.CO.TEXT]:wE,[it.CO.MULTI_TEXT]:(e,t,r)=>{const n=e.optionSet,a=lg({id:e.id,formId:t.formId,formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,optionGroups:n.optionGroups,options:RE(e.optionSet),nullable:!e.compulsory,style:{width:"100%"}},t,e);return dg({component:qg,props:a,commitEvent:"onBlur"},e,r)},[it.CO.PHONE_NUMBER]:wE,[it.CO.LONG_TEXT]:(e,t,r)=>wE(e,t,r,{multiLine:!0}),[it.CO.NUMBER]:wE,[it.CO.NUMBER_RANGE]:_E,[it.CO.INTEGER]:wE,[it.CO.INTEGER_RANGE]:_E,[it.CO.INTEGER_POSITIVE]:wE,[it.CO.INTEGER_POSITIVE_RANGE]:_E,[it.CO.INTEGER_NEGATIVE]:wE,[it.CO.INTEGER_NEGATIVE_RANGE]:_E,[it.CO.INTEGER_ZERO_OR_POSITIVE]:wE,[it.CO.INTEGER_ZERO_OR_POSITIVE_RANGE]:_E,[it.CO.BOOLEAN]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,orientation:t.formHorizontal?qr:Yr,id:e.id},t,e);return dg({component:_g,props:n},e,r)},[it.CO.TRUE_ONLY]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,orientation:t.formHorizontal?qr:Yr,id:e.id},t,e);return dg({component:dh,props:n},e,r)},[it.CO.DATE]:(e,t,r)=>((e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,width:t.formHorizontal?150:"100%",maxWidth:t.formHorizontal?150:350,calendarWidth:t.formHorizontal?250:350,popupAnchorPosition:(a=t.formHorizontal,a?"center":"left"),calendarMaxMoment:e.allowFutureDate?void 0:$()()},t,e);var a;return dg({component:kg,props:n},e,r)})(e,t,r),[it.CO.DATE_RANGE]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,width:t.formHorizontal?150:"100%",maxWidth:t.formHorizontal?150:350,calendarWidth:t.formHorizontal?250:350,popupAnchorPosition:(a=t.formHorizontal,a?"center":"left")},t,e);var a;return dg({component:xh,props:n},e,r)},[it.CO.DATETIME]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,dateWidth:t.formHorizontal?150:"100%",dateMaxWidth:t.formHorizontal?150:350,orientation:t.formHorizontal?qr:Yr,shrinkDisabled:t.formHorizontal,calendarWidth:t.formHorizontal?250:350,popupAnchorPosition:(a=t.formHorizontal,a?"center":"left")},t,e);var a;return dg({component:Dg,props:n},e,r)},[it.CO.DATETIME_RANGE]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,dateWidth:t.formHorizontal?150:"100%",dateMaxWidth:t.formHorizontal?150:350,orientation:t.formHorizontal?qr:Yr,shrinkDisabled:t.formHorizontal,calendarWidth:t.formHorizontal?250:350,popupAnchorPosition:(a=t.formHorizontal,a?"center":"left")},t,e);var a;return dg({component:Mh,props:n},e,r)},[it.CO.TIME]:wE,[it.CO.TIME_RANGE]:_E,[it.CO.PERCENTAGE]:wE,[it.CO.URL]:wE,[it.CO.AGE]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,orientation:t.formHorizontal?qr:Yr,shrinkDisabled:t.formHorizontal,dateCalendarWidth:t.formHorizontal?250:350,datePopupAnchorPosition:(a=t.formHorizontal,a?"center":"left")},t,e);var a;return dg({component:wg,props:n},e,r)},[it.CO.ORGANISATION_UNIT]:(e,t,r)=>{const n=lg({formId:t.formId,elementId:e.id,formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,maxTreeHeight:200},t,e);return dg({component:ih,props:n},e,r)},[it.CO.COORDINATE]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,orientation:t.formHorizontal?qr:Yr,shrinkDisabled:t.formHorizontal,dialogLabel:e.formName},t,e);return dg({component:Pg,props:n},e,r)},[it.CO.POLYGON]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,orientation:t.formHorizontal?qr:Yr,shrinkDisabled:t.formHorizontal,dialogLabel:e.formName},t,e);return dg({component:sh,props:n},e,r)},[it.CO.USERNAME]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,usernameOnlyMode:!0},t,e);return dg({component:Lh,props:n},e,r)},[it.CO.FILE_RESOURCE]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,async:!0,orientation:t.formHorizontal?qr:Yr},t,e);return dg({component:Bg,props:n},e,r)},[it.CO.IMAGE]:(e,t,r)=>{const n=lg({formHorizontal:t.formHorizontal,fieldLabelMediaBasedClass:t.fieldLabelMediaBasedClass,async:!0,orientation:t.formHorizontal?qr:Yr},t,e);return dg({component:zg,props:n},e,r)},[it.CO.UNKNOWN]:()=>null};const HE={NO_FORMFIELD_FOR_TYPE:"Formfield component not specified for type"},zE={[it.CO.EMAIL]:jE,[it.CO.TEXT]:jE,[it.CO.MULTI_TEXT]:(e,t,r)=>{const n=e.optionSet,a=LE({id:e.id,formId:t.formId,optionGroups:n.optionGroups,options:RE(e.optionSet),nullable:!e.compulsory},e);return FE({component:Xh,props:a,commitEvent:"onBlur"},e,r)},[it.CO.PHONE_NUMBER]:jE,[it.CO.LONG_TEXT]:(e,t,r)=>jE(e,0,r,{multiLine:!0}),[it.CO.NUMBER]:jE,[it.CO.INTEGER]:jE,[it.CO.INTEGER_POSITIVE]:jE,[it.CO.INTEGER_NEGATIVE]:jE,[it.CO.INTEGER_ZERO_OR_POSITIVE]:jE,[it.CO.BOOLEAN]:(e,t,r)=>{const n=LE({orientation:Yr,id:e.id},e);return FE({component:Gh,props:n},e,r)},[it.CO.TRUE_ONLY]:(e,t,r)=>{const n=LE({orientation:Yr,id:e.id},e);return FE({component:cE,props:n},e,r)},[it.CO.DATE]:(e,t,r)=>{const n=LE({width:350,maxWidth:350,calendarWidth:350,calendarMaxMoment:e.allowFutureDate?void 0:$()()},e);return FE({component:Wh,props:n},e,r)},[it.CO.DATETIME]:(e,t,r)=>{const n=LE({dateWidth:"100%",dateMaxWidth:350,calendarWidth:350,orientation:Yr,shrinkDisabled:!1},e);return FE({component:Hh,props:n},e,r)},[it.CO.TIME]:jE,[it.CO.PERCENTAGE]:jE,[it.CO.URL]:jE,[it.CO.AGE]:(e,t,r)=>{const n=LE({orientation:Yr,shrinkDisabled:!1},e);return FE({component:jh,props:n},e,r)},[it.CO.ORGANISATION_UNIT]:(e,t,r)=>{const n=LE({},e);return FE({component:oE,props:n},e,r)},[it.CO.COORDINATE]:(e,t,r)=>{const n=LE({orientation:Yr,shrinkDisabled:!1},e);return FE({component:$h,props:n},e,r)},[it.CO.POLYGON]:(e,t,r)=>{const n=LE({orientation:Yr,shrinkDisabled:!1},e);return FE({component:sE,props:n},e,r)},[it.CO.USERNAME]:(e,t,r)=>{const n=LE({},e);return FE({component:pE,props:n},e,r)},[it.CO.FILE_RESOURCE]:(e,t,r)=>{const n=LE({async:!0,orientation:Yr},e);return FE({component:zh,props:n},e,r)},[it.CO.IMAGE]:(e,t,r)=>{const n=LE({async:!0,orientation:Yr},e);return FE({component:Yh,props:n},e,r)},[it.CO.UNKNOWN]:()=>null};function YE(e,t,r,n){return r?function(e,t,r){if(t.viewMode)return BE(e,t);const n=e.type;return zE[n]?e.optionSet&&e.type!==it.CO.MULTI_TEXT?VE(e,t,r):zE[n](e,t,r):(S().warn((0,j.px)(HE.NO_FORMFIELD_FOR_TYPE)({metaData:e})),zE[it.CO.UNKNOWN](e,t,r))}(e,t,n):function(e,t,r){if(t.viewMode)return DE(e,t);const n=e.type;return WE[n]?e.optionSet&&e.type!==it.CO.MULTI_TEXT?AE(e,t,r):WE[n](e,t,r):(S().warn((0,j.px)($E.NO_FORMFIELD_FOR_TYPE)({metaData:e})),WE[it.CO.UNKNOWN](e,t,r))}(e,t,n)}var qE=r(38085);const KE={ERROR:"error",WARNING:"warning",ERROR_ON_COMPLETE:"errorOnComplete",WARNING_ON_COMPLETE:"warningOnComplete"},QE=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.HIDE_FIELD];return r[t.payload.formId]=n?Object.keys(n).reduce(((e,t)=>{const[r]=n[t];return e[t]={content:r.content,name:r.name,hadValue:r.hadValue},e}),{}):null,r}},"rulesEffectsHiddenFields"),XE=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.MAKE_COMPULSORY];return r[t.payload.formId]=n?Object.keys(n).reduce(((e,t)=>(e[t]=!0,e)),{}):null,r}},"rulesEffectsCompulsoryFields"),JE=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.HIDE_SECTION];return r[t.payload.formId]=n?Object.keys(n).reduce(((e,t)=>(e[t]=!0,e)),{}):null,r}},"rulesEffectsHiddenSections"),ZE=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.HIDE_PROGRAM_STAGE];return r[t.payload.formId]=n?Object.keys(n).reduce(((e,t)=>(e[t]=!0,e)),{}):null,r}},"rulesEffectsHiddenProgramStageDesc"),ey={[Ls.SHOW_ERROR]:KE.ERROR,[Ls.SHOW_WARNING]:KE.WARNING,[Ls.SHOW_ERROR_ONCOMPLETE]:KE.ERROR_ON_COMPLETE,[Ls.SHOW_WARNING_ONCOMPLETE]:KE.WARNING_ON_COMPLETE},ty=rc({[sd]:(e,t)=>{const r={...e},n=[t.payload.rulesEffects&&t.payload.rulesEffects[Ls.SHOW_ERROR],t.payload.rulesEffects&&t.payload.rulesEffects[Ls.SHOW_WARNING],t.payload.rulesEffects&&t.payload.rulesEffects[Ls.SHOW_ERROR_ONCOMPLETE],t.payload.rulesEffects&&t.payload.rulesEffects[Ls.SHOW_WARNING_ONCOMPLETE]];return r[t.payload.formId]=n.reduce(((e,t)=>t?Object.keys(t).reduce(((e,r)=>{e[r]=e[r]||{};const n=t[r],a=ey[n[0].type];return e[r][a]=n.map((e=>e.error?e.error.message:e.warning?e.warning.message:e.message)),e}),e):e),{}),r}},"rulesEffectsMessages"),ry=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.DISPLAY_TEXT],a=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.DISPLAY_KEY_VALUE_PAIR];return r[t.payload.formId]={displayTexts:n&&n.feedback?n.feedback.map((e=>e.displayText)):null,displayKeyValuePairs:a&&a.feedback?a.feedback.map((e=>e.displayKeyValuePair)):null},r}},"rulesEffectsFeedback",{}),ny=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.DISPLAY_TEXT],a=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.DISPLAY_KEY_VALUE_PAIR];return r[t.payload.formId]={displayTexts:n&&n.indicators?n.indicators.map((e=>e.displayText)):null,displayKeyValuePairs:a&&a.indicators?a.indicators.map((e=>e.displayKeyValuePair)):null},r}},"rulesEffectsIndicators",{}),ay=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.SHOW_ERROR],a=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.SHOW_ERROR_ONCOMPLETE],o=n&&n.general?n.general.map((e=>e.error)):null,i=a&&a.general?a.general.map((e=>e.error)):null;return r[t.payload.formId]={[ey[Ls.SHOW_ERROR]]:o,[ey[Ls.SHOW_ERROR_ONCOMPLETE]]:i},r}},"rulesEffectsGeneralErrors",{}),oy=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.SHOW_WARNING],a=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.SHOW_WARNING_ONCOMPLETE],o=n&&n.general?n.general.map((e=>e.warning)):null,i=a&&a.general?a.general.map((e=>e.warning)):null;return r[t.payload.formId]={[ey[Ls.SHOW_WARNING]]:o,[ey[Ls.SHOW_WARNING_ONCOMPLETE]]:i},r}},"rulesEffectsGeneralWarnings",{}),iy=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.ASSIGN_VALUE];return r[t.payload.formId]=n?Object.keys(n).reduce(((e,t)=>(e[t]=!0,e)),{}):null,r}},"rulesEffectsDisabledFields"),sy=rc({[sd]:(e,t)=>{const r={...e},n=t.payload.rulesEffects;return t.payload.rulesEffects&&(r[t.payload.formId]={hideOptions:n[Ls.HIDE_OPTION],hideOptionGroups:n[Ls.HIDE_OPTION_GROUP],showOptionGroups:n[Ls.SHOW_OPTION_GROUP]}),r}},"rulesEffectsOptionsVisibility");var ly=r(66085);function dy(){return dy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dy.apply(this,arguments)}const cy=e=>{const{pluginSource:t,...r}=e,n=(0,y.useRef)(null),[a,o]=(0,y.useState)(0);return(0,y.useEffect)((()=>{const{current:e}=n;if(!e)return()=>{};const t=new ResizeObserver((e=>{e.forEach((e=>o(e.contentRect.width)))}));return t.observe(e),()=>{t.unobserve(e),t.disconnect()}}),[n]),y.createElement("div",{ref:n},y.createElement(ly.k,dy({pluginSource:t,width:a},r)))},uy=Object.freeze({attributeValues:(e,t)=>{if(Array.isArray(e)){const r=e.reduce(((e,r)=>{const n=t&&t[r.attribute.id];return n?(e[n.IdFromPlugin]=r.value,e):e}),{});if(Object.keys(r).length>0)return{key:"attributes",value:r}}return null}}),py=e=>{const{pluginSource:t,fieldsMetadata:r,formId:n,onUpdateField:a,customAttributes:o,pluginContext:i,viewMode:s=!1}=e,l=(0,y.useMemo)((()=>Object.fromEntries(r)),[r]),d=(0,y.useMemo)((()=>Object.keys(l)),[l]),{orgUnitId:c}=vs(),{pluginValues:u}=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=(0,gs.d4)((t=>{let{formsValues:r}=t;return r[e]})),a=(0,y.useMemo)((()=>n?Object.entries(t).reduce(((e,t)=>{let[r,a]=t;const o=n[a.id];return o&&(e[r]=o),e}),{}):{}),[n,t]),o=(0,y.useMemo)((()=>Object.entries(r).reduce(((e,t)=>{let[r,n]=t;return e[r]=n.value,e}),{})),[r]);return{pluginValues:{...a,...o}}}(n,l,i),{errors:p,warnings:m,formSubmitted:g}=((e,t)=>{const r=(0,gs.d4)((t=>{let{rulesEffectsMessages:r}=t;return r[e]})),n=(0,gs.d4)((t=>{let{formsSectionsFieldsUI:r}=t;return r[e]})),a=(0,gs.d4)((t=>{var r,n;let{dataEntriesUI:a}=t;return null!==(r=null===(n=a[e])||void 0===n?void 0:n.saveAttempted)&&void 0!==r&&r})),{errors:o,warnings:i}=(0,y.useMemo)((()=>t?Object.entries(t).reduce(((e,t)=>{const[o,i]=t,s=i.id;if(r){var l;const{error:t,warning:n,errorOnComplete:i}=null!==(l=r[s])&&void 0!==l?l:{};var d;t&&(e.errors[o]=[...t]),n&&(e.warnings[o]=[...n]),a&&i&&(e.errors[o]=[...null!==(d=e.errors[o])&&void 0!==d?d:[],...i])}if(n){var c;const{errorMessage:t}=null!==(c=n[s])&&void 0!==c?c:{};var u;t&&(e.errors[o]=[...null!==(u=e.errors[o])&&void 0!==u?u:[],t])}return e}),{errors:{},warnings:{}}):{errors:{},warnings:{}}),[n,t,r,a]);return{formSubmitted:a,errors:o,warnings:i}})(n,l),{setFieldValue:h,setContextFieldValue:E}=(e=>{let{configuredPluginIds:t,metadataByPluginId:r,onUpdateField:n,pluginContext:a}=e;const o=(0,y.useCallback)((e=>{let{fieldId:a,value:o,options:i={}}=e;if(!a)return void S().error((0,j.px)(Ki.SET_FIELD_VALUE_MISSING_ID)({fieldId:a,value:o,options:i}));if(!t.includes(a))return void S().error((0,j.px)(Ki.SET_FIELD_VALUE_ID_NOT_ALLOWED)({fieldId:a,value:o,options:i}));const s=r[a];n&&n(s,o,i)}),[t,r,n]),i=(0,y.useCallback)((e=>{let{fieldId:t,value:r}=e;const n=a[t];n?null===n||void 0===n||n.setDataEntryFieldValue(r):S().error((0,j.px)(Ki.SET_CONTEXT_FIELD_VALUE_MISSING_ID)({fieldId:t,value:r}))}),[a]);return{setFieldValue:o,setContextFieldValue:i}})({configuredPluginIds:d,onUpdateField:a,metadataByPluginId:l,pluginContext:i}),v=(0,y.useMemo)((()=>[...r.entries()].reduce(((e,t)=>{let[r,n]=t;const a=function(e){let{attributes:t,keysToOmit:r=["dataElement","optionGroups"]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e=>Object.entries(e).reduce(((e,a)=>{let[o,i]=a;const s=o.replace(/^_/,"");if(r.includes(s))return e;if(uy[s]){const r=uy[s](i,t);return r&&(e[r.key]=r.value),e}return null!==i&&("object"===typeof i?Array.isArray(i)?e[s]=i.map(n).filter(Boolean):e[s]=n(i):e[s]=i),e}),{});return n(e)}(n,{attributes:o,keysToOmit:["id","dataElement","section"]});return{...e,[r]:a}}),{})),[o,r]);return y.createElement(cy,{orgUnitId:c,pluginSource:t,fieldsMetadata:v,values:u,setFieldValue:h,formSubmitted:g,setContextFieldValue:E,errors:p,warnings:m,viewMode:s})};function my(){return my=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},my.apply(this,arguments)}function gy(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const hy=(e=>class extends y.Component{render(){const{customForm:t,...r}=this.props;return y.createElement(e,r,t?(e,r)=>y.createElement(Tu.y,{onRenderField:e,fields:r,specs:t}):null)}})((e=>(0,I.withStyles)(fu)(class extends y.Component{constructor(){super(...arguments),vu(this,"renderDivider",((e,t,r)=>{if(r.props&&r.props.hidden||e+1>=t)return null;const n=this.props.classes;return y.createElement("div",{className:n.dividerContainer},y.createElement(Vo,{className:n.divider}))}))}render(){const{classes:t,...r}=this.props,n=this.props.formHorizontal?null:{onRenderDivider:this.renderDivider};return y.createElement(e,yu({},n,r))}}))((e=>(0,I.withStyles)(Su)(class extends y.Component{constructor(){super(...arguments),bu(this,"getContainerProps",((e,t,r)=>{if(0===e&&(this.hiddenFieldsCount=0),r.props&&r.props.hidden)return this.hiddenFieldsCount+=1,{};const{classes:n}=this.props;return{className:(e-this.hiddenFieldsCount)%2===0?null:n.evenNumbers}}))}render(){const{formHorizontal:t,classes:r,...n}=this.props,a=t?null:{onGetContainerProps:this.getContainerProps};return y.createElement(e,Iu({},a,n))}}))(Eu))),Ey={horizontalSection:{display:"flex",flexWrap:"wrap",alignItems:"flex-start"}};class yy extends y.Component{static buildFormFields(e){const{fieldsMetaData:t,customForm:r,fieldOptions:n,querySingleResource:a}=e;return Array.from(t.entries()).map((e=>e[1])).map((t=>t instanceof qi.g?{id:t.id,component:py,plugin:!0,props:{pluginId:t.id,name:t.name,pluginSource:t.pluginSource,fieldsMetadata:t.fields,customAttributes:t.customAttributes,formId:e.formId,viewMode:e.viewMode}}:YE(t,{formHorizontal:e.formHorizontal,formId:e.formId,viewMode:e.viewMode,...n},!!r,a))).filter((e=>e))}static validateBaseOnly(e){return e.isValid([zc])}constructor(e){super(e),gy(this,"handleUpdateFieldAsync",((e,t,r,n)=>{this.props.onUpdateFieldAsync(e,t,r,this.props.formId,n)})),this.handleUpdateField=this.handleUpdateField.bind(this),this.formFields=yy.buildFormFields(this.props),this.rulesCompulsoryErrors={}}UNSAFE_componentWillReceiveProps(e){e.fieldsMetaData!==this.props.fieldsMetaData&&(this.formFields=yy.buildFormFields(e))}rulesIsValid(){const e=this.props.rulesMessages,t=Object.keys(e).map((t=>e[t]&&e[t][KE.ERROR])).filter((e=>e));return 0===t.length&&0===Object.keys(this.rulesCompulsoryErrors).length}validateFull(e){return!!e.isValid()&&this.rulesIsValid()}isValid(e){const t=this.formBuilderInstance;return t?this.validateBasedOnStrategy(e,t):(S().error((0,j.px)("could not get formbuilder instance")({method:"isValid",object:this})),!1)}validateBasedOnStrategy(e,t){const r=this.props.validationStrategy;if(r===qE.T.NONE)return yy.validateBaseOnly(t);if(r===qE.T.ON_COMPLETE){return e&&e.isCompleting?this.validateFull(t):yy.validateBaseOnly(t)}return this.validateFull(t)}getInvalidFields(){const e=Object.keys(this.props.rulesMessages).reduce(((e,t)=>(this.props.rulesMessages[t]&&(this.props.rulesMessages[t][KE.ERROR]||this.props.rulesMessages[t][KE.ERROR_ON_COMPLETE])&&(e[t]=!0),e)),{}),t=Object.keys(this.rulesCompulsoryErrors).reduce(((e,t)=>(e[t]=!0,e)),{}),r={...e,...t};return this.formBuilderInstance?this.formBuilderInstance.getInvalidFields(r):[]}handleUpdateField(e,t,r,n,a){this.props.onUpdateField(e,t,r,n,this.props.formId,a)}buildRulesCompulsoryErrors(){const e=this.props.rulesCompulsoryFields,t=this.props.values;this.rulesCompulsoryErrors=Object.keys(e).reduce(((r,n)=>{if(e[n]){const e=t[n];e||0===e||!1===e||(r[n]="This field is required")}return r}),{})}getFieldConfigWithRulesEffects(){return this.formFields.map((e=>({...e,props:{...e.props,hidden:this.props.rulesHiddenFields[e.id],rulesErrorMessage:this.props.rulesMessages[e.id]&&this.props.rulesMessages[e.id][KE.ERROR],rulesWarningMessage:this.props.rulesMessages[e.id]&&this.props.rulesMessages[e.id][KE.WARNING],rulesErrorMessageOnComplete:this.props.rulesMessages[e.id]&&this.props.rulesMessages[e.id][KE.ERROR_ON_COMPLETE],rulesWarningMessageOnComplete:this.props.rulesMessages[e.id]&&this.props.rulesMessages[e.id][KE.WARNING_ON_COMPLETE],rulesCompulsory:this.props.rulesCompulsoryFields[e.id],rulesCompulsoryError:this.rulesCompulsoryErrors[e.id],rulesDisabled:this.props.rulesDisabledFields[e.id]}})))}render(){const{fieldsMetaData:e,values:t,onUpdateField:r,formId:n,rulesCompulsoryFields:a,rulesDisabledFields:o,rulesHiddenFields:i,rulesMessages:s,onUpdateFieldAsync:l,fieldOptions:d,validationStrategy:c,loadNr:u,...p}=this.props;return this.buildRulesCompulsoryErrors(),y.createElement("div",{"data-test":"d2-section-fields",style:this.props.formHorizontal?Ey.horizontalSection:{}},y.createElement(hy,my({formBuilderRef:e=>{this.formBuilderInstance=e},id:n,fields:this.getFieldConfigWithRulesEffects(),dataElements:this.formFields,values:t,onUpdateField:this.handleUpdateField,onUpdateFieldAsync:this.handleUpdateFieldAsync,validateIfNoUIData:!0,loadNr:u},p)))}}gy(yy,"defaultProps",{values:{}});const vy="UpdateField",fy=(0,fg.Ad)(Ig.UI,((e,t)=>Object.keys(t).every((r=>t[r]===e[r])))),Iy=(e,t)=>{const r=t.fieldsMetaData,n=e.formsValues[t.formId]||{};return Array.from(r.entries()).map((e=>e[1])).reduce(((e,t)=>(e[t.id]=n[t.id],e)),{})},by=(e,t)=>{const r=t.fieldsMetaData,n=e.rulesEffectsCompulsoryFields[t.formId]||{};return Array.from(r.entries()).map((e=>e[1])).reduce(((e,t)=>(e[t.id]=n[t.id],e)),{})},Sy=(e,t)=>{const r=t.fieldsMetaData,n=e.rulesEffectsDisabledFields[t.formId]||{};return Array.from(r.entries()).map((e=>e[1])).reduce(((e,t)=>(e[t.id]=n[t.id],e)),{})},Ty=(e,t)=>{const r=t.fieldsMetaData,n=e.rulesEffectsHiddenFields[t.formId]||{};return Array.from(r.entries()).map((e=>e[1])).reduce(((e,t)=>(e[t.id]=!!n[t.id]||void 0,e)),{})},Ay=(0,fg.Ad)(Ig.UI,((e,t)=>Object.keys(t).every((r=>{const n=t[r]||{},a=e[r]||{};return[KE.ERROR,KE.WARNING,KE.ERROR_ON_COMPLETE,KE.WARNING_ON_COMPLETE].every((e=>n[e]===a[e]))})))),Cy=(e,t)=>{const r=t.fieldsMetaData,n=e.rulesEffectsMessages[t.formId]||{};return Array.from(r.entries()).map((e=>e[1])).reduce(((e,t)=>(e[t.id]=n[t.id],e)),{})},Oy=(0,gs.Ng)((()=>{const e=fy(Iy,(e=>e)),t=fy(Ty,(e=>e)),r=Ay(Cy,(e=>e)),n=fy(by,(e=>e)),a=fy(Sy,(e=>e));return(o,i)=>({values:e(o,i),rulesHiddenFields:t(o,i),rulesMessages:r(o,i),rulesCompulsoryFields:n(o,i),rulesDisabledFields:a(o,i),loadNr:o.forms[i.formId].loadNr})}),(e=>({onUpdateField:(t,r,n,a,o)=>{e(((e,t,r,n,a)=>l(vy)({value:e,uiState:t,formId:a,sectionId:n,elementId:r}))(t,r,n,a,o))}})),((e,t,r)=>{const n=Object.assign({},r,e,t);return r.onUpdateField?{...n,onUpdateField:r.onUpdateField}:n}),{forwardRef:!0})(yy),Ny={descriptionBox:{display:"flex",marginBottom:8,marginRight:15,color:vn.T.grey700},icon:{minWidth:16,marginLeft:10,marginRight:5,marginTop:1},description:{fontSize:13,lineHeight:"17px"}},Ry=(0,I.withStyles)(Ny)((e=>{const{classes:t,description:r}=e;return y.createElement("div",{className:t.descriptionBox},y.createElement("div",{className:t.icon},y.createElement(bm.A,null)),y.createElement("div",{className:t.description},r))}));function wy(){return wy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wy.apply(this,arguments)}class _y extends y.PureComponent{componentDidMount(){this.props.isHidden&&this.props.onFieldsValidated&&this.props.onFieldsValidated({},this.props.formBuilderId)}renderSectionHeader(){const e=this.props.sectionMetaData.name;return e?y.createElement(Lc,{title:e}):null}renderSectionDescription(){const e=this.props.sectionMetaData.displayDescription;return e?y.createElement(Ry,{description:e}):null}renderSection(e){const{sectionMetaData:t,classes:r,sectionId:n,...a}=e,o=y.createElement(Oy,wy({ref:e=>{this.sectionFieldsInstance=e},fieldsMetaData:t.elements,customForm:t.customForm},a));return t.showContainer&&!this.props.formHorizontal?y.createElement("div",null,y.createElement(kc,{header:this.renderSectionHeader(),description:this.renderSectionDescription(),elevation:2,className:r.section},o)):o}render(){const{isHidden:e,applyCustomFormClass:t,...r}=this.props;return e?null:y.createElement("div",{"data-test":"d2-section",className:t?this.props.classes.containerCustomForm:""},this.renderSection(r))}}const Py=(0,I.withStyles)((e=>({section:{backgroundColor:"white",maxWidth:e.typography.pxToRem(892)},containerCustomForm:{paddingTop:10,paddingBottom:10}})))(_y),ky=(0,gs.Ng)(((e,t)=>{const r=e.rulesEffectsHiddenFields[t.formId];if(r){return{isHidden:0==Array.from(t.sectionMetaData.elements.keys()).filter((e=>!r[e])).length}}return{isHidden:0==t.sectionMetaData.elements.size}}),(()=>({})))(Xm(Py));function Dy(){return Dy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dy.apply(this,arguments)}function Uy(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ly extends y.PureComponent{constructor(e){super(e),Uy(this,"renderHorizontal",((e,t)=>y.createElement(ky,Dy({key:e.id,innerRef:t=>{this.setSectionInstance(t,e.id)},sectionMetaData:e,validationStrategy:this.props.formFoundation.validationStrategy,formId:this.getFormId(),formBuilderId:this.getFormBuilderId(e.id),sectionId:e.id,applyCustomFormClass:!1},t)))),Uy(this,"renderVertical",((e,t)=>y.createElement(ky,Dy({key:e.id,innerRef:t=>{this.setSectionInstance(t,e.id)},sectionMetaData:e,validationStrategy:this.props.formFoundation.validationStrategy,formId:this.getFormId(),formBuilderId:this.getFormBuilderId(e.id),sectionId:e.id,applyCustomFormClass:!!e.customForm},t)))),this.name="D2Form",this.sectionInstances=new Map}validateFormIncludeSectionFailedFields(e){let t=[];return{isValid:Array.from(this.sectionInstances.entries()).map((e=>e[1])).every((r=>{if(r.props.isHidden)return!0;const n=r.sectionFieldsInstance;if(!n)return S().error((0,j.px)("could not get section fields instance")({method:"validateFormReturningFailedFields",object:this,sectionInstance:r})),!1;const a=n.isValid(e);return a||(t=[...t,...n.getInvalidFields()]),a})),failedFields:t}}validateFormScrollToFirstFailedField(e){const{isValid:t,failedFields:r}=this.validateFormIncludeSectionFailedFields(e);if(t)return!0;const n=r.length>0?r[0].instance:null;return n&&n.goto&&n.goto(),!1}setSectionInstance(e,t){e?this.sectionInstances.set(t,e):this.sectionInstances.has(t)&&this.sectionInstances.delete(t)}getFormId(){return this.props.id}getFormBuilderId(e){return`${this.props.id}-${e}`}render(){const{formFoundation:e,id:t,classes:r,isFormInReduxStore:n,getCustomContent:a,...o}=this.props,i=Array.from(e.sections.entries()).map((e=>e[1])).map((e=>o.formHorizontal?this.renderHorizontal(e,o):y.createElement(y.Fragment,null,a&&a(e.id),this.renderVertical(e,o))));return y.createElement(y.Fragment,null,n?i:S().error((0,j.px)('In order for the component to render you must add a form id in the redux store. The right reducer to do this is called "forms".')({method:"D2Form.component"})))}}const Fy=(0,qd.compose)((0,gs.Ng)(((e,t)=>{const{forms:r}=e;return{isFormInReduxStore:!!r[t.id]}}),(()=>({}))),(e=>(0,gs.Ng)(Oc,Nc)(Cc(e))))((e=>{const{formRef:t,...r}=e;return y.createElement(Ly,Dy({ref:e=>{t&&t(e)}},r))})),xy={FORM_DATA_ADD:"AddFormData",FORM_DATA_REMOVE:"RemoveFormData"};function My(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l(xy.FORM_DATA_ADD)({formValues:t,formId:e})}const Vy="CompleteDataEntryEvent",jy="CompleteDataEntryEventError",Gy="SaveDataEntryEvent",By="SaveValidationFailedForDataEntry",$y="SaveAbortedForDataEntry",Wy="UpdateDataEntryField",Hy="UpdateDataEntryFormField",zy="RulesExecutedPostUpdateFieldDataEntry",Yy="AddDataEntryNote",qy="RemoveDataEntryNote",Ky="SetCurrentDataEntry",Qy="StartRunRulesPostUpdateFieldDataEntry",Xy="RemoveDataEntryRelationship",Jy="AddDataEntryRelationship",Zy="DataEntryRelationshipAlreadyExists",ev="LoadEditDataEntry",tv="CleanUpDataEntry",rv=(e,t,r,n,a)=>l(Wy)({value:e,valueMeta:t,fieldId:r,dataEntryId:n,itemId:a}),nv=(e,t,r)=>l(Qy)({dataEntryId:e,itemId:t,uid:r}),av=(e,t,r)=>l(zy)({dataEntryId:e,itemId:t,uid:r}),ov=(e,t,r)=>l(Yy)({dataEntryId:e,itemId:t,note:r}),iv=(e,t,r)=>l(qy)({dataEntryId:e,itemId:t,noteClientId:r}),sv=(e,t,r)=>l(Ky)({dataEntryId:e,itemId:t,extraProps:r}),lv=(e,t,r,n)=>l(Jy)({dataEntryId:e,itemId:t,relationship:r,newToEntity:n}),dv=e=>l(ev)(e),cv=e=>l(tv)({dataEntryId:e}),uv="UpdateDataEntryFieldForNewSingleEventActionsBatch",pv="UpdateFieldForNewSingleEventActionsBatch",mv="RulesEffectsForNewSingleEventActionsBatch",gv="SaveNewEventAddAnotherBatch",hv="OpenNewEventInDataEntry",Ev="StartRunRulesOnUpdateForNewSingleEvent",yv="RequestSaveReturnToMainPageForNewSingleEvent",vv="StartSaveAfterReturnedToMainPage",fv="StartCancelSaveReturnToMainPageForNewSingleEvent",Iv="CancelSaveNoWorkingListUpdateNeededForSingleEvent",bv="CancelSaveUpdateWorkingListForSingleNewEvent",Sv="SingleNewEventSavedAfterReturnedToMainPage",Tv="SaveFailedForNewSingleEventAfterReturnedToMainPage",Av="NewEventInDataEntryOpeningCancel",Cv="RequestSaveNewEventAddAnother",Ov="startSaveNewEventAddAnother",Nv="NewEventSavedAddAnother",Rv="SaveFailedForNewEventAddAnother",wv="SetNewEventSaveTypes",_v="AddNewEventNote",Pv="NewEventOpenNewRelationship",kv="SaveNewEventRelationshipsIfExists",Dv="StartSaveNewEventRelationships",Uv="NewEventRelationshipsSaved",Lv="SaveFailedForNewEventRelationships",Fv="CancelSaveInitializeWorkingListsForSingleNewEvent",xv="StartSaveTeiForNewEventRelationships",Mv="TeiForNewEventRelationshipSaved",Vv="SaveFailedForNewEventRelationshipTei",jv="NewEventScrolledToRelationships",Gv="RequestSaveNewEventInStage",Bv="StartSaveNewEventAndReturnToList",$v="SaveFailedForNewEventInStage",Wv="NewEventSavedAfterReturnToList",Hv=e=>l(Ev)(e),zv=e=>l(Sv)(null,{selections:e}),Yv=()=>l(fv)(),qv=()=>l(Iv)(),Kv=()=>l(Fv)(),Qv=(e,t,r,n)=>{const a=Ov;return l(Ov)({selections:r},{offline:{effect:{url:"tracker?async=false",method:oc,data:e,clientId:n},commit:{type:kv,meta:{selections:r,relationshipData:t,triggerAction:a}},rollback:{type:Rv,meta:{selections:r,clientId:n}}}})},Xv=e=>l(Nv)(null,{selections:e}),Jv=e=>l(Wv)(null,{selections:e}),Zv="SetNewEventFormLayoutDirection",ef="NewEventCancelNewRelationship",tf="AddNewEventRelationship",rf="RecentlyAddedRelationship",nf="AddNewEventRelationshipBatch",af="complete",of=(e,t)=>{const r=Object.keys(e).filter((t=>t!==af&&e[t]&&("object"!==typeof e[t]||Object.keys(e[t]).length>0))),n=Object.keys(t).filter((e=>e!==af&&t[e]&&("object"!==typeof t[e]||Object.keys(t[e]).length>0)));return r.length===n.length&&r.every((r=>{const n=e[r],a=t[r];return"categories"===r?of(e.categories,t.categories):n===a}))},sf="setOrgUnitId",lf="setProgramId",df="resetProgramIdBase",cf="resetLocationChange",uf=()=>l(df)(),pf=()=>l(cf)();var mf=r(47058);const gf="top",hf="bottom",Ef="before_metadata_based_section";function yf(e,t){return`${e}-${t}`}function vf(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ff extends y.Component{constructor(){super(...arguments),vf(this,"isNearTop",(()=>window.pageYOffset+this.props.offsetTop>this.stickyContainer.parentElement.offsetTop)),vf(this,"isAtBottomOfContainer",(()=>{const e=this.stickyContainer.getBoundingClientRect(),t=this.stickyContainer.parentElement.getBoundingClientRect();return t.bottom<=e.bottom&&this.stickyContainer.offsetTop-Math.abs(t.top)<this.props.offsetTop})),vf(this,"stickyDisabled",(()=>{const e=document.documentElement?document.documentElement.clientWidth:0;return(document.documentElement?document.documentElement.clientHeight:0)-(this.props.offsetTop+this.stickyContainer.offsetHeight)<0||e<this.props.minViewpointWidth})),vf(this,"setStickyContainerInstance",(e=>{this.stickyContainer=e,this.setSticky()})),vf(this,"getRightMargin",(()=>{const e=this.stickyContainer.parentElement;return(document.documentElement?document.documentElement.clientWidth:0)-(this.stickyContainer.parentElement.offsetLeft+e.offsetWidth)})),vf(this,"setSticky",(()=>{const e=this.props.classes;return!this.stickyContainer||!this.stickyDisabled()&&this.isNearTop()?this.stickyContainer&&this.isAtBottomOfContainer()?(this.stickyContainer.className=e.stickyContainerAtBottom,this.stickyContainer.style.top="initial",void(this.stickyContainer.style.marginRight="initial")):void(this.stickyContainer&&(this.stickyContainer.className=e.stickyContainerFixed,this.stickyContainer.style.top=`${this.props.offsetTop}px`,this.stickyContainer.style.width=`${this.stickyContainer.parentElement.clientWidth}px`,this.stickyContainer.style.marginRight=`${this.getRightMargin()}px`)):(this.stickyContainer.className=e.stickyContainerAbsolute,this.stickyContainer.style.top="initial",this.stickyContainer.style.marginRight="initial",void(this.stickyContainer.style.width="initial"))})),vf(this,"onResize",(()=>{this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(this.setSticky,250)})),vf(this,"onScroll",(()=>{this.scrollTimer&&window.clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout(this.setSticky,10)}))}componentDidMount(){window.addEventListener("resize",this.onResize),window.addEventListener("scroll",this.onScroll)}componentWillUnmount(){window.removeEventListener("resize",this.onResize),window.removeEventListener("scroll",this.onScroll)}render(){const{classes:e,children:t,containerClass:r}=this.props;return y.createElement("div",{className:r||e.container},y.createElement("div",{ref:e=>{this.setStickyContainerInstance(e)}},t))}}vf(ff,"defaultProps",{offsetTop:0,minViewpointWidth:0});const If=(0,I.withStyles)((()=>({container:{position:"relative"},stickyContainerAbsolute:{position:"static"},stickyContainerFixed:{position:"fixed"},stickyContainerAtBottom:{position:"absolute",bottom:0}})))(ff),bf=(0,I.withStyles)((e=>({evenNumbers:{backgroundColor:e.palette.grey.lightest},divider:{backgroundColor:e.palette.dividerForm}})))((e=>{const{formHorizontal:t,index:r,fieldContainer:n,total:a,classes:o}=e,i=t?null:r%2!==0&&o.evenNumbers,s=t?null:r+1<a;return y.createElement("div",{className:i},n.field,s&&y.createElement(Vo,{className:o.divider}))}));function Sf(){return Sf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sf.apply(this,arguments)}function Tf(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Af extends y.Component{constructor(){var e;super(...arguments),e=this,Tf(this,"handleUpdateField",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.props.onUpdateFieldInner(e.props.id,e.props.itemId,e.props.onUpdateFormField,...r)})),Tf(this,"getClasses",(()=>{const{classes:e,formHorizontal:t}=this.props;return t?{formInnerContainer:e.horizontalFormInnerContainer}:{dataEntryContainer:e.verticalDataEntryContainer,formContainer:e.verticalFormContainer,formInnerContainer:e.verticalFormInnerContainer}})),Tf(this,"hasPlacement",((e,t,r)=>e.placement===t&&(e.placement!==Ef||e.placement===Ef&&e.beforeSectionId===r))),Tf(this,"handleUpdateFieldAsync",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.props.onUpdateFormFieldAsync(...r,e.props.id,e.props.itemId)})),Tf(this,"renderDataEntryFieldsByPlacement",((e,t)=>{const r=this.props.fields||[],n=this.props.formHorizontal?(e=>t=>t.placement===e)(e):(e=>t=>t.placement===e&&!t.section)(e),a=r?r.filter(n).map(((e,t,r)=>y.createElement(bf,{formHorizontal:this.props.formHorizontal,fieldContainer:e,index:t,total:r.length}))):[];return this.props.formHorizontal?a:[...a,...this.getSectionsWithPlacement(e,t)]})),Tf(this,"renderD2Form",(()=>{const{id:e,classes:t,itemId:r,completeButton:n,mainButton:a,cancelButton:o,deleteButton:i,notes:s,completionAttempted:l,saveAttempted:d,fields:c,dataEntrySections:u,onUpdateDataEntryField:p,onUpdateFormField:m,onUpdateFieldInner:g,onUpdateFormFieldAsync:h,dataEntryOutputs:E,onAddNote:v,onOpenAddRelationship:f,dataEntryFieldRef:I,...b}=this.props,S=y.createElement(Fy,Sf({id:yf(e,r),validationAttempted:l||d,onUpdateField:this.handleUpdateField,onUpdateFieldAsync:this.handleUpdateFieldAsync,getCustomContent:e=>this.renderDataEntryFieldsByPlacement(Ef,e)},b));return this.props.formHorizontal?S:y.createElement("div",{className:t.d2FormContainer},S)}))}getSectionsWithPlacement(e,t){const r=this.props.fields||[],n=this.props.dataEntrySections||{};return this.props.dataEntrySections?Object.keys(this.props.dataEntrySections).reduce(((a,o)=>{const i=n[o];if(this.hasPlacement(i,e,t)){const e=r.filter((e=>e.section===o)),t=e.map(((e,t,r)=>y.createElement(bf,{formHorizontal:this.props.formHorizontal,fieldContainer:e,index:t,total:r.length}))),n=e.length&&e[0].sectionName;e&&e.length>0&&a.push(y.createElement("div",{key:o,"data-test":`dataEntrySection-${o}`,className:this.props.classes.dataEntrySectionContainer},y.createElement(kc,{header:y.createElement(Lc,{title:null!==n&&void 0!==n?n:i.name})},t)))}return a}),[]):[]}render(){const{classes:e,itemId:t,formFoundation:r,completeButton:n,mainButton:a,cancelButton:o,deleteButton:i,notes:s,dataEntryOutputs:l}=this.props;if(!t)return y.createElement("div",null,Af.errorMessages.NO_ITEM_SELECTED);if(!r)return y.createElement("div",null,Af.errorMessages.FORM_FOUNDATION_MISSING);const d=this.getClasses();return y.createElement("div",{className:d.container},y.createElement("div",{className:d.dataEntryContainer},y.createElement("div",{className:d.formContainer},y.createElement("div",{className:d.formInnerContainer},this.renderDataEntryFieldsByPlacement(gf),this.renderD2Form(),this.renderDataEntryFieldsByPlacement(hf),s&&y.createElement("div",{className:e.notes},s))),!this.props.formHorizontal&&l?y.createElement(If,{offsetTop:50,minViewpointWidth:769,containerClass:e.stickyOnScroll},y.createElement("div",null,l)):y.createElement("div",{className:e.verticalOutputsContainer},l)),y.createElement("div",{className:e.footerBar},y.createElement("div",{className:e.footerLeft},n?y.createElement("div",{className:e.button},n):null,a?y.createElement("div",{className:e.button},a):null,o?y.createElement("div",{className:e.button},o):null),y.createElement("div",{className:e.footerRight},i?y.createElement("div",{className:e.button},i):null)))}}Tf(Af,"errorMessages",{NO_ITEM_SELECTED:"No item selected",FORM_FOUNDATION_MISSING:"form foundation missing. see log for details"});const Cf=(0,I.withStyles)((e=>({loadingContainer:{marginTop:12},d2FormContainer:{display:"flex",flexDirection:"column",gap:yn.Q.dp16,marginTop:yn.Q.dp12,marginBottom:yn.Q.dp12},footerBar:{display:"flex",justifyContent:"space-between"},footerLeft:{display:"flex"},footerRight:{display:"flex"},button:{marginTop:e.typography.pxToRem(2)},horizontalFormInnerContainer:{display:"flex",flexWrap:"wrap",alignItems:"flex-start"},verticalFormContainer:{flexGrow:10,maxWidth:"100%"},verticalFormInnerContainer:{maxWidth:e.typography.pxToRem(892)},verticalDataEntryContainer:{display:"flex",flexDirection:"row",flexWrap:"wrap"},verticalContainer:{display:"flex",flexDirection:"column",flexWrap:"wrap"},stickyOnScroll:{position:"relative",flexGrow:1,width:e.typography.pxToRem(300),"& > div > div > *:not(:first-child)":{marginTop:"10px"},marginRight:0},verticalOutputsContainer:{"& > *":{marginTop:"10px"},marginBottom:e.typography.pxToRem(10)},dataEntrySectionContainer:{marginBottom:yn.Q.dp16}})))(Af),Of=(0,qd.compose)((0,gs.Ng)(((e,t)=>({itemId:e.dataEntries[t.id]&&e.dataEntries[t.id].itemId,ready:!!e.dataEntries[t.id]})),(e=>({onUpdateFieldInner:(t,r,n,a,o,i,s,d,c)=>{const u=((e,t,r,n,a,o,i,s)=>l(Hy)({value:e,uiState:t,formId:a,formBuilderId:n,elementId:r,dataEntryId:o,itemId:i,updateCompleteUid:s}))(a,o,i,s,d,t,r,c);n?n(u):e(u)}})),null),Dp((()=>({height:"350px"}))))(Cf);var Nf=r(28128);const Rf=e=>{let{open:t,header:r,text:n,cancelText:a,onCancel:o,destructiveText:i,onDestroy:s}=e;return t?y.createElement(N.a,{hide:!t,onClose:o,small:!0},y.createElement(Ip.w,null,r),y.createElement(R.$,null,y.createElement("div",{style:{margin:"5px 0"}},n)),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:o,secondary:!0},a),y.createElement(ra.$,{onClick:s,destructive:!0},i)))):null},wf={header:n.A.t("Discard unsaved changes?"),text:n.A.t("This event has unsaved changes. Leaving this page without saving will lose these changes. Are you sure you want to discard unsaved changes?"),destructiveText:n.A.t("Yes, discard changes"),cancelText:n.A.t("No, cancel")};function _f(){return _f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_f.apply(this,arguments)}function Pf(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class kf extends y.Component{constructor(e){super(e),Pf(this,"handleCancel",(()=>{this.props.dataEntryHasChanges?this.setState({dialogOpen:!0}):this.props.onCancel()})),Pf(this,"handleCancelDiscard",(()=>{this.setState({dialogOpen:!1})})),this.state={dialogOpen:!1}}render(){return y.createElement("div",null,y.createElement(ra.$,{onClick:this.handleCancel,disabled:this.props.disabled,secondary:!0},n.A.t("Cancel")),y.createElement(Rf,_f({},wf,{onDestroy:this.props.onCancel,open:this.state.dialogOpen,onCancel:this.handleCancelDiscard})))}}const Df=(e,t)=>{if(Object.keys(e.formsSectionsFieldsUI).filter((e=>e.startsWith(t))).reduce(((t,r)=>[...t,...Object.keys(e.formsSectionsFieldsUI[r]).map((t=>e.formsSectionsFieldsUI[r][t]))]),[]).some((e=>e.modified)))return!0;const r=e.dataEntriesFieldsUI[t];return!!r&&Object.keys(r).some((e=>r[e].modified))},Uf=(0,gs.Ng)(((e,t)=>{const r=e.dataEntries&&e.dataEntries[t.id]&&e.dataEntries[t.id].itemId,n=yf(t.id,r);return{dataEntryHasChanges:!!Df(e,n)}}),(()=>({})),null,{forwardRef:!0})(kf);function Lf(){return Lf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lf.apply(this,arguments)}function Ff(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const xf=(e,t)=>class extends y.Component{constructor(){super(...arguments),Ff(this,"getWrappedInstance",(()=>this.innerInstance))}render(){const{onCancel:r,cancelButtonIsDisabled:n,cancelButtonRef:a,...o}=this.props,i=t&&t(this.props)||{};return y.createElement(e,Lf({innerRef:e=>{this.innerInstance=e},cancelButton:y.createElement(Uf,{id:this.props.id,onCancel:r,options:i,disabled:n})},o))}},Mf=e=>t=>xf(t,e);function Vf(e,t){if(!t)return null;let r;return t.some((t=>{const n=(0,t.validator)(e);return!(!0===n||n&&n.valid)&&(r=n&&n.message||t.message,!0)}))?r||n.A.t("validation failed"):null}function jf(){return jf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jf.apply(this,arguments)}function Gf(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Bf extends y.Component{constructor(){super(...arguments),Gf(this,"handleSet",((e,t)=>{const{validatorContainers:r,onUpdateFieldInner:n,onUpdateField:a}=this.props,o=Vf(e,r);n(e,{isValid:!o,validationError:o,touched:!t||null==t.touched||t.touched},this.props.propName,this.props.dataEntryId,this.props.itemId,a)}))}validateAndScrollToIfFailed(){const e=this.props.valueMeta&&this.props.valueMeta.isValid;return e||this.goto(),e}goto(){if(this.gotoInstance){this.gotoInstance.scrollIntoView();const e=window.scrollY;e&&window.scroll(0,e-48)}}render(){const{completionAttempted:e,saveAttempted:t,Component:r,validatorContainers:n,propName:a,onUpdateField:o,onUpdateFieldInner:i,valueMeta:s={},itemId:l,dataEntryId:d,componentProps:c,...u}=this.props,{isValid:p,type:m,...g}=s;return y.createElement("div",{ref:e=>{this.gotoInstance=e},key:a,"data-test":`dataentry-field-${a}`},y.createElement(r,jf({onBlur:this.handleSet,validationAttempted:!(!e&&!t)},g,u,c)))}}const $f=(0,gs.Ng)(((e,t)=>{const r=t.propName,n=e.dataEntries[t.dataEntryId].itemId,a=yf(t.dataEntryId,n);return{value:e.dataEntriesFieldsValue[a][r],valueMeta:e.dataEntriesFieldsUI[a][r],itemId:n,propName:r}}),(e=>({onUpdateFieldInner:(t,r,n,a,o,i)=>{const s=rv(t,r,n,a,o);i?i(s,{value:t,valueMeta:r,fieldId:n,dataEntryId:a,itemId:o}):e(rv(t,r,n,a,o))}})),null,{forwardRef:!0})(Bf),Wf=(0,fg.Ad)(Ig.UI,((e,t)=>{const r=Object.keys(t).every((r=>t[r]===e[r]));if(!r)return!1;const n=Object.keys(e).every((r=>e[r]===t[r]));return n})),Hf=e=>e||{},zf=()=>Wf(Hf,(e=>e));function Yf(){return Yf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Yf.apply(this,arguments)}function qf(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Kf=(e,t)=>{class r extends y.Component{constructor(t){super(t),qf(this,"handleRef",(t=>{if(this.props.dataEntryFieldRef){const{getPropName:r}=e,n=r(this.props);if(this.dataEntryFieldInstance=t,!n)return void S().error((0,j.px)("data entry field needs a key, but no propName was specified")({}));this.props.dataEntryFieldRef(t,n)}})),this.reselectComponentProps=zf()}getFieldElement(){const{id:t,completionAttempted:r,saveAttempted:n,onUpdateDataEntryField:a}=this.props,{getComponent:o,getComponentProps:i,getValidatorContainers:s,getPropName:l}=e,d=o(this.props),c=this.reselectComponentProps(i&&i(this.props)),u=s&&s(this.props)||[];return y.createElement($f,{ref:this.handleRef,dataEntryId:t,completionAttempted:r,saveAttempted:n,Component:d,validatorContainers:u,propName:l(this.props),onUpdateField:a,componentProps:c})}setField(e){this.dataEntryFieldInstance?this.dataEntryFieldInstance.handleSet(e):S().error((0,j.px)("No data entry field instance ")({}))}getFields(){const t=this.props.fields,{getMeta:r,getIsHidden:n}=e,a=r&&r(this.props);if(n&&n(this.props))return t?[...t]:[];const o={field:this.getFieldElement(),placement:a&&a.placement||gf,section:a&&a.section};return t?[...t,o]:[o]}render(){const{fields:r,pluginContext:n={},...a}=this.props,o=e.getPropName(this.props);return y.createElement("div",null,y.createElement(t,Yf({fields:this.getFields(),pluginContext:{[o]:{setDataEntryFieldValue:this.setField.bind(this),value:this.props[`${o}DataEntryFieldValue`]},...n}},a)))}}return r},Qf=e=>t=>(0,gs.Ng)((e=>(t,r)=>{let n;const{getPassOnFieldData:a,getPropName:o}=e;if(a&&a(r)){const e=o(r),a=t.dataEntries[r.id].itemId,i=yf(r.id,a);n={[`${e}DataEntryFieldValue`]:t.dataEntriesFieldsValue[i][e]}}return{...n}})(e),(()=>({})))(Kf(e,t));function Xf(){return Xf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xf.apply(this,arguments)}function Jf(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Zf=e=>class extends y.Component{constructor(){super(...arguments),Jf(this,"handleAddNote",(e=>{this.props.onAddNote(this.props.itemId,this.props.dataEntryId,e)}))}render(){const{onAddNote:t,itemId:r,dataEntryId:n,...a}=this.props;return y.createElement(e,Xf({},a,{onAddNote:this.handleAddNote}))}},eI=(e,t)=>{const r=e.dataEntries&&e.dataEntries[t.dataEntryId]&&e.dataEntries[t.dataEntryId].itemId,n=yf(t.dataEntryId,r);return{itemId:r,notes:e.dataEntriesNotes[n]||[]}},tI=()=>e=>(0,gs.Ng)(eI,(()=>({})))(Zf(e));var rI=r(34884),nI=r(9388);const aI=e=>{const{enabled:t,wrapperClassName:r,children:n,...a}=e;return t?y.createElement(Xo.m,a,(e=>{let{onMouseOver:t,onMouseOut:a,ref:o}=e;return y.createElement("span",{className:r,ref:e=>{e&&(e.onpointerenter=t,e.onpointerleave=a,o.current=e)}},n)})):n};function oI(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const iI=hr()(Nu);class sI extends y.Component{constructor(e){super(e),oI(this,"toggleIsOpen",(()=>{this.setState((e=>({addIsOpen:!e.addIsOpen})))})),oI(this,"onCancel",(()=>{this.props.onBlur(null,{touched:!1}),this.toggleIsOpen()})),oI(this,"onNewNoteEditorBlur",(e=>{this.props.onBlur(e,{touched:!1})})),oI(this,"handleAddNote",(()=>{this.props.value&&this.props.onAddNote(this.props.value),this.toggleIsOpen(),this.props.onBlur(null,{touched:!1})})),oI(this,"handleChange",(e=>{this.setState({value:e})})),oI(this,"renderInput",(()=>{const{classes:e}=this.props;return y.createElement("div",{className:e.newNoteFormContainer},y.createElement(rI.KE,{onEdit:this.handleChange},y.createElement(iI,{onBlur:this.onNewNoteEditorBlur,onChange:this.handleChange,value:this.state.value,multiLine:!0,"data-test":"note-textfield"})),y.createElement("div",{className:e.newNoteButtonsContainer,"data-test":"note-buttons-container"},y.createElement(ra.$,{onClick:this.handleAddNote,className:e.addNoteContainer,primary:!0,small:!0},n.A.t("Add note")),y.createElement(ra.$,{onClick:this.onCancel,secondary:!0,small:!0},n.A.t("Cancel"))))})),oI(this,"renderButton",(e=>{const{smallMainButton:t}=this.props;return y.createElement("div",{"data-test":"new-note-button"},y.createElement(aI,{content:n.A.t("You don't have access to write notes"),enabled:!e},y.createElement(ra.$,{onClick:this.toggleIsOpen,disabled:!e,small:t},n.A.t("Write note"))))})),oI(this,"render",(()=>{const{notes:e,classes:t,entityAccess:r}=this.props;return y.createElement("div",{className:t.notesContainer},y.createElement(nI.W,{dense:!0,className:t.notesList,"data-test":"notes-list"},e.map((e=>y.createElement(bh.D,{className:t.noteItem,key:e.clientId,"data-test":"note",label:y.createElement(y.Fragment,null,y.createElement("div",{className:t.noteItemHeader},y.createElement("div",{className:t.noteItemUser,"data-test":"note-user"},e.createdBy?`${e.createdBy.firstName} ${e.createdBy.surname}`:`${e.storedBy}`),y.createElement("div",{className:t.noteItemDate,"data-test":"note-date"},e.storedDate)),y.createElement("div",{"data-test":"note-text"},y.createElement(rI.iX,null,e.value)))})))),y.createElement("div",{className:t.newNoteContainer,"data-test":"new-note-container"},this.state.addIsOpen?this.renderInput():this.renderButton(r.write)))})),this.state={addIsOpen:!!this.props.value,value:this.props.value||null}}UNSAFE_componentWillReceiveProps(e){e.value===this.props.value&&this.props.value===this.state.value||this.setState({value:e.value})}}oI(sI,"defaultProps",{entityAccess:{read:!0,write:!0}});const lI=(0,I.withStyles)((e=>({noteItem:{display:"flex",flexDirection:"column",alignItems:"normal",cursor:"default !important",padding:yn.U.dp12,marginRight:yn.U.dp4,backgroundColor:"#f3f5f7 !important",borderRadius:"5px",fontSize:"14px",lineHeight:"19px",color:vn.T.grey900,marginBottom:yn.U.dp8},commandButton:{width:e.typography.pxToRem(30),height:e.typography.pxToRem(30)},borderBoxContent:{margin:e.typography.pxToRem(10)},newNoteButtonsContainer:{marginTop:yn.U.dp4},noteItemHeader:{display:"flex"},noteItemUser:{flexGrow:1,fontSize:"13px",fontWeight:500},noteItemDate:{color:"#4a5768"},notesList:{padding:0},addNoteContainer:{marginRight:5,marginLeft:2}})))(sI);function dI(){return dI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dI.apply(this,arguments)}function cI(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const uI=e=>class extends y.Component{constructor(){super(...arguments),cI(this,"handleOpenAddRelationship",(()=>{this.props.onOpenAddRelationship(this.props.itemId,this.props.dataEntryId)})),cI(this,"handleRemoveRelationship",(e=>{this.props.onRemoveRelationship(this.props.itemId,this.props.dataEntryId,e)}))}render(){const{onOpenAddRelationship:t,onRemoveRelationship:r,itemId:n,dataEntryId:a,...o}=this.props;return y.createElement(e,dI({},o,{onOpenAddRelationship:this.handleOpenAddRelationship,onRemoveRelationship:this.handleRemoveRelationship}))}},pI=(e,t)=>{const r=e.dataEntries&&e.dataEntries[t.dataEntryId]&&e.dataEntries[t.dataEntryId].itemId,n=yf(t.dataEntryId,r);return{relationships:e.dataEntriesRelationships[n],itemId:r}},mI=e=>({onRemoveRelationship:(t,r,n)=>{e(((e,t,r)=>l(Xy)({dataEntryId:e,itemId:t,relationshipClientId:r}))(r,t,n))}});var gI=r(54177),hI=r(82099);function EI(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const yI={PROGRAM_STAGE_INSTANCE:n.A.t("This event")};class vI extends y.Component{constructor(){super(...arguments),EI(this,"renderRelationships",(()=>this.props.relationships.map((e=>e&&this.renderRelationship(e))))),EI(this,"renderRelationship",(e=>{const{classes:t,onRemoveRelationship:r}=this.props,a=this.canDelete(e),o=er()(t.relationshipDetails,{[t.relationshipHighlight]:this.shouldHighlightRelationship(e)});return y.createElement("div",{className:t.relationship,key:e.clientId},y.createElement("div",{className:o},y.createElement("div",{className:t.relationshipTypeName},e.relationshipType.name),y.createElement("div",{className:t.relationshipEntities},this.getEntityName(e.from),y.createElement("span",{className:t.arrowIcon}," ",y.createElement(gI.A,null)," "),this.getEntityName(e.to))),y.createElement("div",{className:t.relationshipActions},y.createElement(aI,{content:n.A.t("You don't have access to delete this relationship"),enabled:!a,wrapperClassName:t.tooltip},y.createElement(Bo,{dataTest:"delete-relationship-button",onClick:()=>{r(e.clientId)},disabled:!a,secondary:!0},y.createElement(hI.A,null)))))})),EI(this,"shouldHighlightRelationship",(e=>{const t=this.props.highlightRelationshipId;return t&&t===e.clientId})),EI(this,"getEntityName",(e=>{const{onRenderConnectedEntity:t}=this.props;return e.id===this.props.currentEntityId?yI[e.type]:t?t(e):e.name})),EI(this,"canDelete",(e=>{const{entityAccess:t,writableRelationshipTypes:r}=this.props;return e.from.id===this.props.currentEntityId&&t.write&&r.some((t=>t.id===e.relationshipType.id&&t.access.data.write))}))}shouldComponentUpdate(e){const t=Object.keys(e).filter((t=>e[t]!==this.props[t])),r=t.length;return!(1===r&&"highlightRelationshipId"===t[0]&&!e.highlightRelationshipId)&&r>0}render(){const{classes:e,onOpenAddRelationship:t,entityAccess:r,writableRelationshipTypes:a,relationshipsRef:o,smallMainButton:i}=this.props,s=r.write&&a.length>0;return y.createElement("div",{className:e.container,ref:o},y.createElement("div",{className:e.relationshipsContainer},this.renderRelationships()),y.createElement("div",null,y.createElement("div",{className:e.addButtonContainer},y.createElement(aI,{content:n.A.t("You don't have access to create any relationships"),enabled:!s},y.createElement(ra.$,{onClick:t,disabled:!s,small:i,dataTest:"add-relationship-button",secondary:!0},n.A.t("Add relationship"))))))}}EI(vI,"defaultProps",{entityAccess:{read:!0,write:!0}});const fI=(0,I.withStyles)((e=>({relationship:{display:"flex",alignItems:"center",padding:5},relationshipDetails:{backgroundColor:e.palette.grey.lighter,padding:7,flexGrow:1},relationshipTypeName:{fontSize:14,fontWeight:600,color:vn.T.grey700},relationshipsContainer:{},container:{display:"flex",flexDirection:"column"},relationshipEntities:{marginTop:7,fontSize:15,display:"flex",alignItems:"center"},arrowIcon:{marginLeft:10,marginRight:10,fontSize:15},relationshipActions:{padding:7},addButtonContainer:{display:"inline-block"},"@keyframes background-fade":{"0%":{backgroundColor:e.palette.secondary.lightest},"70%":{backgroundColor:e.palette.secondary.lightest},"100%":{backgroundColor:e.palette.grey.lighter}},relationshipHighlight:{animation:"background-fade 2.5s forwards"},tooltip:{display:"inline-flex",borderRadius:"100%"}})))(vI),II=e=>!e||xc(e),bI=()=>[{validator:Vt,message:n.A.t("A value is required")},{validator:II,message:n.A.t("Please provide a valid date")}],SI={SAVEANDADDANOTHER:"SAVEANDADDANOTHER",SAVEANDEXIT:"SAVEANDEXIT",FINISH:"FINISH",SAVEWITHOUTCOMPLETING:"SAVEWITHOUTCOMPLETING",SAVEANDCOMPLETE:"SAVEANDCOMPLETE"};var TI=r(86232),AI=r(7329);function CI(){return CI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},CI.apply(this,arguments)}const OI=e=>{const{dropDownItems:t,...r}=e;return y.createElement(TI.f,CI({component:y.createElement(AI.n,null,t.map((e=>y.createElement(bh.D,{key:(0,yc.A)(),label:e.text,value:e.text,onClick:e.onClick}))))},r))};var NI=r(60937),RI=r(5651);const wI=e=>{let{label:t,primary:r,secondary:a,small:o,large:i,disabled:s,onClick:l,open:d,icon:c,dataTest:u,component:p}=e;const[m,g]=(0,y.useState)(!1),h=(0,y.useRef)(null),E=void 0!==d?d:m,v=()=>{void 0===d&&g((e=>!e)),l&&l()};return y.createElement("div",{ref:h},y.createElement(ra.$,{title:null!==t&&void 0!==t?t:n.A.t("More"),primary:r,secondary:a,dataTest:u,disabled:s,small:o,large:i,onClick:v,icon:c},t),E&&y.createElement(NI.W,{onBackdropClick:v,transparent:!0},y.createElement(RI.N,{reference:h,placement:"bottom-end"},p)))},_I=e=>{const t=e.formsValues["singleEvent-newEvent"]||{},r=Object.keys(t).some((e=>t[e]));if(r)return!0;const n=e.dataEntriesFieldsValue["singleEvent-newEvent"]||{},a=Object.keys(n).some((e=>n[e]));return a};function PI(){return PI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PI.apply(this,arguments)}function kI(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const DI={...SI,FINISH:"FINISH"},UI={[DI.SAVEANDADDANOTHER]:e=>({key:DI.SAVEANDADDANOTHER,text:n.A.t("Save and add another"),onClick:()=>{e.onSave(SI.SAVEANDADDANOTHER)}}),[DI.SAVEANDEXIT]:e=>({key:DI.SAVEANDEXIT,text:n.A.t("Save and exit"),onClick:()=>{e.onSave(SI.SAVEANDEXIT)}}),[DI.FINISH]:e=>({key:DI.FINISH,text:n.A.t("Finish"),onClick:()=>{e.onCancel()}}),[DI.SAVEWITHOUTCOMPLETING]:e=>({key:DI.SAVEWITHOUTCOMPLETING,text:n.A.t("Save without completing"),onClick:()=>{e.onSave(SI.SAVEWITHOUTCOMPLETING)}}),[DI.SAVEANDCOMPLETE]:e=>({key:DI.SAVEANDCOMPLETE,text:n.A.t("Complete"),onClick:()=>{e.onSave(SI.SAVEANDCOMPLETE)}})},LI=e=>class extends y.Component{constructor(){super(...arguments),kI(this,"getButtonDefinition",(e=>UI[e](this.props))),kI(this,"getFormHorizontalButtons",((e,t)=>{const r=[this.getButtonDefinition(DI.SAVEANDADDANOTHER),this.getButtonDefinition(DI.SAVEANDEXIT)];return e||!t?r:[this.getButtonDefinition(DI.FINISH),...r]})),kI(this,"getFormVerticalButtons",((e,t,r)=>{const n=r?r.map((e=>this.getButtonDefinition(e))):[this.getButtonDefinition(DI.SAVEANDEXIT),this.getButtonDefinition(DI.SAVEANDADDANOTHER)];return e||!t?n:[this.getButtonDefinition(DI.FINISH),...n]})),kI(this,"renderMultiButton",((e,t)=>{const r=e[0],a=e.slice(1);return y.createElement(aI,{content:n.A.t("No write access"),enabled:!t},y.createElement("div",{"data-test":"main-button"},y.createElement(OI,{primary:!0,disabled:!t,onClick:r.onClick,dropDownItems:a},r.text)))})),kI(this,"renderCreateNewButton",(()=>{const{text:e,...t}=this.getButtonDefinition(DI.SAVEWITHOUTCOMPLETING);return y.createElement("div",{"data-test":"creat-new-button"},y.createElement(ra.$,t,e))}))}render(){const{saveTypes:t,dataEntryHasChanges:r,hasRecentlyAddedEvents:n,formHorizontal:a,onSave:o,finalInProgress:i,...s}=this.props,l=this.props.formFoundation.access.data.write,d=a?this.getFormHorizontalButtons(r,n):this.getFormVerticalButtons(r,n,t),c=this.renderMultiButton(d,l);return y.createElement(e,PI({ref:e=>{this.innerInstance=e},mainButton:c,formHorizontal:a},s))}},FI=(e,t)=>{const r=e.dataEntries&&e.dataEntries[t.id]&&e.dataEntries[t.id].itemId,n=yf(t.id,r),a=_I(e),o=e.recentlyAddedEvents&&Object.keys(e.recentlyAddedEvents).length>0;return{saveTypes:e.newEventPage.saveTypes,finalInProgress:e.dataEntriesUI[n]&&e.dataEntriesUI[n].finalInProgress,dataEntryHasChanges:a,hasRecentlyAddedEvents:o}},xI=()=>({}),MI=e=>!e,VI=()=>[{validator:MI,message:n.A.t("Please add or cancel note before saving the event")}],jI=(e,t)=>class extends y.Component{constructor(r){super(r);const n=e.isApplicable(this.props);this.Component=n?Qf(e)(t):t}render(){const e=this.Component;return y.createElement(e,this.props)}},GI=e=>t=>jI(e,t);function BI(){return BI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},BI.apply(this,arguments)}function $I(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const WI=e=>class extends y.Component{constructor(e){super(e),$I(this,"handleDialogConfirm",(()=>{this.setState({dialogOpen:!1}),this.unblock()})),$I(this,"handleDialogCancel",(()=>{this.setState({dialogOpen:!1})})),this.state={dialogOpen:!1}}componentDidMount(){const{history:e}=this.props;this.unblock=e.block(((e,t)=>{const{dataEntryHasChanges:r}=this.props;return"POP"!==t||!r||(this.setState({dialogOpen:!0}),!1)}))}componentWillUnmount(){this.unblock&&this.unblock()}render(){const{dataEntryHasChanges:t,history:r,location:n,match:a,staticContext:o,...i}=this.props;return y.createElement(y.Fragment,null,y.createElement(e,i),y.createElement(Rf,BI({},wf,{onDestroy:this.handleDialogConfirm,open:this.state.dialogOpen,onCancel:this.handleDialogCancel})))}},HI=(e,t)=>{const r=e.dataEntries&&e.dataEntries[t.id]&&e.dataEntries[t.id].itemId,n=yf(t.id,r);return{dataEntryHasChanges:Df(e,n)}},zI=()=>({}),YI=()=>e=>(0,gs.Ng)(HI,zI)((0,T.y)(WI(e)));class qI extends y.Component{static getItemWithName(e,t){return y.createElement(y.Fragment,null,e,": ",t)}static getItemWithoutName(e){return y.createElement(y.Fragment,null,e)}getContents(){const{warnings:e,errors:t,classes:r}=this.props,a=e.map((e=>y.createElement("li",{key:e.key},e.name?KI.getItemWithName(e.name,e.warning):KI.getItemWithoutName(e.warning)))),o=t.map((e=>y.createElement("li",{key:e.key},e.name?KI.getItemWithName(e.name,e.error):KI.getItemWithoutName(e.error))));return y.createElement("div",null,y.createElement("div",null,o.length>1?n.A.t("The following errors were found:"):n.A.t("The following error was found:")),y.createElement("div",{className:r.errors},o),y.createElement("div",{className:r.warningsLabel},a.length>1?n.A.t("The following warnings were found:"):n.A.t("The following warning was found:")),y.createElement("div",{className:r.warnings},a))}getButtons(){const{onAbort:e,onSave:t,saveEnabled:r,classes:a}=this.props;return y.createElement("div",{style:{margin:"0 20px 12px 20px"}},y.createElement(ra.$,{onClick:e,color:"primary"},n.A.t("Back to form")),r?y.createElement(ra.$,{onClick:t,primary:!0,initialFocus:!0,className:a.marginLeft},n.A.t("Save anyway")):null)}render(){return y.createElement(y.Fragment,null,y.createElement(Ip.w,{id:"save-dialog-errors-and-warnings-title"},n.A.t("Validation errors and warnings")),y.createElement(R.$,null,this.getContents()),y.createElement(ta.N,null,this.getButtons()))}}const KI=(0,I.withStyles)((e=>({errors:{border:`1px solid ${e.palette.grey.light}`,borderRadius:e.typography.pxToRem(4),padding:5},warningsLabel:{paddingTop:20},warnings:{border:`1px solid ${e.palette.grey.light}`,borderRadius:e.typography.pxToRem(4),padding:5},marginLeft:{marginLeft:8}})))(qI);class QI extends y.Component{static getItemWithName(e,t){return y.createElement(y.Fragment,null,e,": ",t)}static getItemWithoutName(e){return y.createElement(y.Fragment,null,e)}getContents(){const{errors:e}=this.props;return e.map((e=>y.createElement("li",{key:e.key},e.name?XI.getItemWithName(e.name,e.error):XI.getItemWithoutName(e.error))))}getButtons(){const{onAbort:e,onSave:t,saveEnabled:r,classes:a}=this.props;return y.createElement("div",null,y.createElement(ra.$,{onClick:e,color:"primary"},n.A.t("Back to form")),r?y.createElement(ra.$,{onClick:t,primary:!0,initialFocus:!0,className:a.marginLeft},n.A.t("Save anyway")):null)}render(){return y.createElement(y.Fragment,null,y.createElement(Ip.w,{id:"save-dialog-errors-title"},n.A.t("Validation errors")),y.createElement(R.$,null,this.getContents()),y.createElement(ta.N,null,this.getButtons()))}}const XI=(0,I.withStyles)((()=>({marginLeft:{marginLeft:8}})))(QI);class JI extends y.Component{static getItemWithName(e,t){return y.createElement(y.Fragment,null,e,": ",t)}static getItemWithoutName(e){return y.createElement(y.Fragment,null,e)}getContents(){const{warnings:e}=this.props;return e.map((e=>y.createElement("li",{key:e.key},e.name?ZI.getItemWithName(e.name,e.warning):ZI.getItemWithoutName(e.warning))))}render(){const{onAbort:e,onSave:t,classes:r}=this.props;return y.createElement(y.Fragment,null,y.createElement(Ip.w,{id:"save-dialog-errors-and-warnings-title"},n.A.t("Validation warnings")),y.createElement(R.$,null,this.getContents()),y.createElement(ta.N,null,y.createElement("div",{style:{margin:"0 20px 12px 20px"}},y.createElement(ra.$,{onClick:e,color:"primary"},n.A.t("Back to form")),y.createElement(ra.$,{onClick:t,primary:!0,initialFocus:!0,className:r.marginLeft},n.A.t("Save anyway")))))}}const ZI=(0,I.withStyles)((()=>({marginLeft:{marginLeft:8}})))(JI);function eb(){return eb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},eb.apply(this,arguments)}function tb(e,t){return t===qE.T.NONE||t===qE.T.ON_COMPLETE&&!e}const rb=e=>{const{open:t,warnings:r,errors:n,isCompleting:a,validationStrategy:o,...i}=e;return t?r&&r.length>0&&n&&n.length>0?y.createElement(KI,eb({errors:n,warnings:r,saveEnabled:tb(a,o)},i)):n&&n.length>0?y.createElement(XI,eb({errors:n,saveEnabled:tb(a,o)},i)):y.createElement(ZI,eb({warnings:r},i)):null},nb=(e,t,r)=>r.foundation,ab=(e,t,r)=>e.rulesEffectsMessages[r.key],ob=(e,t,r)=>e.rulesEffectsGeneralWarnings[r.key]?e.rulesEffectsGeneralWarnings[r.key].warningOnComplete:void 0,ib=(e,t,r)=>e.rulesEffectsGeneralErrors[r.key]?e.rulesEffectsGeneralErrors[r.key].errorOnComplete:void 0,sb={COMPLETE:"COMPLETE",SAVE_WITHOUT_COMPLETING:"SAVE_WITHOUT_COMPLETING"};function lb(){return lb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lb.apply(this,arguments)}function db(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const cb=(e,t,r,a)=>{class o extends y.Component{constructor(e){super(e),db(this,"handleSaveAttempt",(e=>{const{inProgressList:t,sectionsInitialised:r}=this.props;t.length?this.setState({waitForPromisesDialogOpen:!0,saveType:e}):r?this.validateAndSave(e):this.setState({waitForFieldValidations:!0,saveType:e})})),db(this,"handleAbortDialog",(()=>{this.props.onSaveAbort(this.props.itemId,this.props.id),this.setState({messagesDialogOpen:!1})})),db(this,"handleSaveDialog",(()=>{this.handleSave(sb.SAVE_WITHOUT_COMPLETING),this.setState({messagesDialogOpen:!1})})),db(this,"handleSave",(e=>{const{onSave:t,itemId:r,id:n,calculatedFoundation:a,warnings:o,errors:i}=this.props;e===sb.COMPLETE&&(i&&i.length>0||o&&o.length>0)?this.showMessagesPopup(e):t(r,n,a,e)})),db(this,"getDialogWaitForUploadContents",(()=>y.createElement("div",null,n.A.t("Some operations are still runnning. Please wait..")))),db(this,"setFormInstance",(e=>{this.formInstance=e})),db(this,"setDataEntryFieldInstance",((e,t)=>{this.dataEntryFieldInstances.set(t,e)})),this.dataEntryFieldInstances=new Map,this.state={messagesDialogOpen:!1,waitForPromisesDialogOpen:!1,waitForFieldValidations:!1}}componentDidUpdate(e){this.state.waitForPromisesDialogOpen&&0===this.props.inProgressList.length&&e.inProgressList.length>0?(this.setState({waitForPromisesDialogOpen:!1,saveType:void 0}),this.validateAndSave(this.state.saveType)):this.state.waitForFieldValidations&&this.props.sectionsInitialised&&(this.setState({waitForFieldValidations:!1,saveType:void 0}),this.validateAndSave(this.state.saveType))}getDataEntryFieldInstances(){return Array.from(this.dataEntryFieldInstances.entries()).map((e=>e[1]))}validateDataEntryFields(){const e=this.getDataEntryFieldInstances();let t=!0,r=0;for(;e[r]&&t;)t=e[r].validateAndScrollToIfFailed(),r+=1;return t}showMessagesPopup(e){this.setState({messagesDialogOpen:!0,saveType:e})}validateGeneralErrorsFromRules(e){const t=this.props.calculatedFoundation.validationStrategy;return t===qE.T.NONE||(t===qE.T.ON_COMPLETE&&!e||!this.props.hasGeneralErrors)}shouldComplete(e){return t?t(this.props):[sb.COMPLETE,SI.SAVEANDCOMPLETE].includes(e)}validateForm(e){const t=this.formInstance;if(!t)return S().error((0,j.px)(o.errorMessages.FORM_INSTANCE_NOT_FOUND)({SaveButtonBuilder:this})),{error:!0,isValid:!1};const r=this.shouldComplete(e);return{isValid:t.validateFormScrollToFirstFailedField({isCompleting:r})&&this.validateGeneralErrorsFromRules(r),error:!1}}validateAndSave(e){if(!this.validateDataEntryFields())return void this.props.onSaveValidationFailed(this.props.itemId,this.props.id);const{error:t,isValid:r}=this.validateForm(e);t||this.handleSaveValidationOutcome(e,r)}handleSaveValidationOutcome(e,t){const{onSaveValidationFailed:r,itemId:n,id:a,warnings:o,errors:i}=this.props;t?this.isCompleting&&(i&&i.length>0||o&&o.length>0)?this.showMessagesPopup(e):this.handleSave(e):r(n,a)}render(){const{itemId:a,onSave:o,onSaveValidationFailed:i,onSaveAbort:s,warnings:l,errors:d,hasGeneralErrors:c,inProgressList:u,calculatedFoundation:p,sectionsInitialised:m,...g}=this.props,h=r?r(g):g;return this.isCompleting=!(!t||!t(this.props)),y.createElement("div",null,y.createElement(e,lb({formRef:this.setFormInstance,dataEntryFieldRef:this.setDataEntryFieldInstance,onSave:this.handleSaveAttempt},h)),this.state.messagesDialogOpen&&y.createElement(N.a,{hide:!this.state.messagesDialogOpen,onClose:this.handleAbortDialog},y.createElement(rb,{open:this.state.messagesDialogOpen,onAbort:this.handleAbortDialog,onSave:this.handleSaveDialog,errors:d,warnings:l,isCompleting:this.isCompleting,validationStrategy:p.validationStrategy})),this.state.waitForPromisesDialogOpen&&y.createElement(N.a,{hide:!this.state.waitForPromisesDialogOpen},y.createElement(Ip.w,null,n.A.t("Operations running")),y.createElement(R.$,null,this.getDialogWaitForUploadContents())))}}db(o,"errorMessages",{INNER_INSTANCE_NOT_FOUND:"Inner instance not found",FORM_INSTANCE_NOT_FOUND:"Form instance not found"});return(0,gs.Ng)((()=>{const e=(0,fg.Mz)(ab,ob,nb,((e,t,r)=>(e=e||{},t=t||[],[...Object.keys(e).map((t=>{const n=e[t][KE.WARNING_ON_COMPLETE];if(!n)return null;const a=r.getElement(t);return a?{key:t,name:a.name,warning:n}:null})).filter((e=>e)),...t.map((e=>({key:e.id,name:null,warning:e.message})))]))),t=(0,fg.Mz)(ab,ib,nb,((e,t,r)=>(e=e||{},t=t||[],[...Object.keys(e).map((t=>{const n=e[t][KE.ERROR_ON_COMPLETE];if(!n)return null;const a=r.getElement(t);return a?{key:t,name:a.name,error:n}:null})).filter((e=>e)),...t.map((e=>({key:e.id,name:null,error:e.message})))])));return(r,n)=>{const o=r.dataEntries&&r.dataEntries[n.id]&&r.dataEntries[n.id].itemId,i=yf(n.id,o),s=r.rulesEffectsGeneralErrors[i]&&r.rulesEffectsGeneralErrors[i].error,l=a?a(n):n.formFoundation,d=r.formsSectionsFieldsUI[i];return{itemId:o,saveAttempted:r.dataEntriesUI&&r.dataEntriesUI[i]&&r.dataEntriesUI[i].saveAttempted,warnings:e(r,n,{key:i,foundation:l}),errors:t(r,n,{key:i,foundation:l}),hasGeneralErrors:s&&s.length>0,inProgressList:r.dataEntriesInProgressList[i]||[],calculatedFoundation:l,sectionsInitialised:d&&Object.values(d).every((e=>{let{valid:t}=e;return void 0!==t}))}}}),(e=>({onSaveValidationFailed:(t,r)=>{e(((e,t)=>l(By)({itemId:e,id:t}))(t,r))},onSaveAbort:(t,r)=>{e(((e,t)=>l($y)({itemId:e,id:t}))(t,r))}})))(o)},ub=e=>t=>cb(t,e&&e.onIsCompleting,e&&e.onFilterProps,e&&e.onGetFormFoundation);function pb(){return pb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pb.apply(this,arguments)}function mb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const gb=(e,t)=>class extends y.Component{constructor(r){super(r),mb(this,"getDataEntryOutputs",(()=>{const e=this.props.dataEntryOutputs,t=this.getOutput(e?e.length:0);return e?[...e,t]:[t]})),mb(this,"getOutput",(e=>y.createElement("div",{key:e},y.createElement(t,pb({key:e},this.props))))),mb(this,"render",(()=>{const{dataEntryOutputs:t,...r}=this.props;return y.createElement("div",null,y.createElement(e,pb({ref:e=>{this.innerInstance=e},dataEntryOutputs:this.getDataEntryOutputs()},r)))})),this.name="DataEntryOutputBuilder"}},hb=()=>(e,t)=>gb(e,t),Eb={headerContainer:{borderRadius:3,borderStyle:"solid",borderColor:vn.T.grey400,borderWidth:1,"&.childrenVisible":{borderBottomWidth:0,borderBottomLeftRadius:0,borderBottomRightRadius:0},"&.borderless":{border:"none"}},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:yn.U.dp16,fontWeight:500,fontSize:16,color:vn.T.grey800},children:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:3,borderBottomRightRadius:3,borderStyle:"solid",borderColor:vn.T.grey400,borderWidth:1,borderTopWidth:0,"&.open":{animation:"slidein 200ms normal forwards ease-in-out",transformOrigin:"50% 0%"},"&.close":{animation:"slideout 200ms normal forwards ease-in-out",transformOrigin:"100% 0%"},"&.borderless":{border:"none"}},toggleButton:{margin:`0 0 0 ${yn.U.dp4}px`,height:"24px",borderRadius:"3px",color:vn.T.grey600,"&:hover":{background:vn.T.grey200,color:vn.T.grey800},"&.open":{animation:"flipOpen 200ms normal forwards linear"},"&.close":{animation:"flipClose 200ms normal forwards linear"},"&.closeinit":{transform:"rotateX(180deg)"}},"@keyframes slidein":{from:{transform:"scaleY(0)"},to:{transform:"scaleY(1)"}},"@keyframes slideout":{from:{transform:"scaleY(1)"},to:{transform:"scaleY(0)"}},"@keyframes flipOpen":{from:{transform:"rotateX(180deg)"},to:{transform:"rotateX(0)"}},"@keyframes flipClose":{from:{transform:"rotateX(0)"},to:{transform:"rotateX(180deg)"}}},yb=(0,I.withStyles)(Eb)((e=>{let{header:t,open:r,onOpen:n,onClose:a,color:o=vn.T.white,borderless:i=!1,children:s,classes:l}=e;const[d,c]=(0,y.useState)(r),[u,p]=(0,y.useState)(!1),[m,g]=(0,y.useState)(r),h=(0,y.useRef)(null),E=(0,y.useRef)(!0);return(0,y.useEffect)((()=>{E.current?E.current=!1:(u||p(!0),g(r),clearTimeout(h.current),r?c(!0):h.current=setTimeout((()=>{c(!1)}),200))}),[r,u]),y.createElement("div",{style:{backgroundColor:o,borderRadius:3}},y.createElement("div",{className:er()(l.headerContainer,{childrenVisible:d,borderless:i})},y.createElement("div",{className:l.header},t,y.createElement(Bo,{dataTest:"widget-open-close-toggle-button",className:er()(l.toggleButton,{closeinit:!u&&!m,open:u&&m,close:u&&!m}),onClick:r?a:n},y.createElement(fn.A,null)))),d?y.createElement("div",{"data-test":"widget-contents",className:er()(l.children,{open:u&&r,close:u&&!r,borderless:i})},s):null)})),vb={container:{borderRadius:3,borderStyle:"solid",borderColor:vn.T.grey400,borderWidth:1,"&.borderless":{border:"none"}},header:{display:"flex",alignItems:"center",padding:yn.U.dp16,fontWeight:500,fontSize:16,color:vn.T.grey800}},fb=(0,I.withStyles)(vb)((e=>{let{header:t,children:r,color:n=vn.T.white,borderless:a=!1,classes:o}=e;return y.createElement("div",{className:er()(o.container,{borderless:a}),style:{backgroundColor:n}},y.createElement("div",{className:o.header,"data-test":"widget-header"},t),y.createElement("div",{"data-test":"widget-contents"},r))})),Ib=e=>{let{noncollapsible:t=!1,...r}=e;return t?y.createElement("div",null,y.createElement(fb,r)):y.createElement("div",null,y.createElement(yb,r))},bb={container:{padding:`0px ${yn.U.dp16}px`},unorderedList:{paddingLeft:yn.U.dp16,marginTop:0,fontSize:"14px",lineHeight:"19px",color:vn.T.grey900},noFeedbackText:{color:vn.T.grey600,fontWeight:400,fontSize:"14px",lineHeight:"19px",marginTop:0},listItem:{"&::marker":{color:vn.T.grey500}}},Sb=(0,I.withStyles)(bb)((e=>{let{widgetData:t,emptyText:r,classes:n}=e;if(null===t||void 0===t||!t.length)return y.createElement("div",{"data-test":"widget-content",className:n.container},y.createElement("p",{className:n.noFeedbackText},r));return y.createElement("div",{"data-test":"widget-content",className:n.container},y.createElement("ul",{className:n.unorderedList},t.map(((e,t)=>{if("object"===typeof e){if(e.key||e.value)return r=e,y.createElement("li",{key:r.id,className:n.listItem},r.key,r.key&&r.value?": ":null,r.value);if(e.message)return(e=>y.createElement("li",{className:n.listItem,key:e.id},e.message))(e)}else if("string"===typeof e)return((e,t)=>y.createElement("li",{key:t,className:n.listItem},e))(e,t);var r;return null}))))})),Tb=e=>{let{feedback:t,emptyText:r}=e;const[a,o]=(0,y.useState)(!0);return y.createElement("div",{"data-test":"feedback-widget"},y.createElement(Ib,{header:n.A.t("Feedback"),onOpen:()=>o(!0),onClose:()=>o(!1),open:a},y.createElement(Sb,{widgetData:t,emptyText:r})))};function Ab(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Cb=()=>class extends y.Component{constructor(){super(...arguments),Ab(this,"getItems",(()=>{const{feedbackItems:e}=this.props;return[...(null===e||void 0===e?void 0:e.displayTexts)||[],...(null===e||void 0===e?void 0:e.displayKeyValuePairs)||[]]})),Ab(this,"render",(()=>{const e=this.getItems(),t=e.length>0;return y.createElement("div",null,t&&y.createElement(Tb,{feedback:e,emptyText:n.A.t("No feedback for this event yet")}))}))}},Ob=(e,t)=>{const r=e.dataEntries[t.id].itemId,n=yf(t.id,r);return{feedbackItems:e.rulesEffectsFeedback&&e.rulesEffectsFeedback[n]?e.rulesEffectsFeedback[n]:null}},Nb=()=>({}),Rb=Object.freeze({WARNING:"warning",ERROR:"error"}),wb={widgetWrapper:{padding:`0px ${yn.U.dp16}px`},unorderedList:{padding:`0px ${yn.Q.dp16}`,marginTop:"0px",lineHeight:"1.375",fontSize:yn.Q.dp16,fontWeight:400,color:vn.T.grey900,display:"flex",flexDirection:"column",gap:yn.Q.dp12},listItem:{"&.error":{listStyleType:'"!   "',"&::marker":{color:vn.T.red800,fontWeight:700}},"&.warning":{"&::marker":{color:vn.T.yellow900,fontWeight:700}}}},_b=e=>{let{rule:t,listItem:r}=e;return y.createElement("li",{key:t.id,className:r},t.message)},Pb=e=>{let{message:t,listItem:r}=e;return y.createElement("li",{className:r},t)},kb=(0,I.withStyles)(wb)((e=>{let{widgetData:t,type:r,classes:n}=e;const a=r===Rb.WARNING,o=r===Rb.ERROR;return y.createElement("div",{"data-test":"widget-content",className:n.widgetWrapper},y.createElement("ul",{className:n.unorderedList},null===t||void 0===t?void 0:t.map(((e,t)=>"string"===typeof e?y.createElement(Pb,{message:e,listItem:er()(n.listItem,{warning:a,error:o}),key:t}):"object"===typeof e?y.createElement(_b,{rule:e,key:e.id,listItem:er()(n.listItem,{warning:a,error:o})}):null))))}));var Db=r(82217);const Ub={container:{display:"flex",alignItems:"center",gap:yn.Q.dp8,color:vn.T.yellow900},label:{margin:0}},Lb=(0,I.withStyles)(Ub)((e=>{let{classes:t}=e;return y.createElement("span",{className:t.container},y.createElement(Db.A,null),y.createElement("p",{className:t.label},n.A.t("Warning")))})),Fb=e=>{let{warning:t}=e;const r=Rb.WARNING;return null!==t&&void 0!==t&&t.length?y.createElement("div",{"data-test":"error-widget"},y.createElement(Ib,{header:y.createElement(Lb,null),noncollapsible:!0,color:vn.T.yellow050},y.createElement(kb,{widgetData:t,type:r}))):null};function xb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Mb=()=>class extends y.Component{constructor(){super(...arguments),xb(this,"render",(()=>{const e=this.getVisibleWarningItems();return y.createElement(Fb,{warning:e})}))}getVisibleWarningItems(){const{warningItems:e,warningOnCompleteItems:t,saveAttempted:r}=this.props;if(r){return[...e||[],...t||[]]}return e||[]}},Vb=(e,t)=>{const r=e.dataEntries[t.id].itemId,n=yf(t.id,r);return{warningItems:e.rulesEffectsGeneralWarnings[n]?e.rulesEffectsGeneralWarnings[n].warning:null,warningOnCompleteItems:e.rulesEffectsGeneralWarnings[n]?e.rulesEffectsGeneralWarnings[n].warningOnComplete:null}},jb=()=>({});var Gb=r(54279);const Bb={container:{display:"flex",alignItems:"center",gap:yn.Q.dp8,color:vn.T.red800,fontWeight:500},label:{margin:0}},$b=(0,I.withStyles)(Bb)((e=>{let{classes:t}=e;return y.createElement("span",{className:t.container},y.createElement(Gb.A,null),y.createElement("p",{className:t.label},n.A.t("Error")))})),Wb=e=>{let{error:t,classes:r}=e;const n=Rb.ERROR;return null!==t&&void 0!==t&&t.length?y.createElement("div",{className:r,"data-test":"error-widget"},y.createElement(Ib,{header:y.createElement($b,null),noncollapsible:!0,color:vn.T.red100},y.createElement(kb,{widgetData:t,type:n}))):null};function Hb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const zb=()=>class extends y.Component{constructor(e){super(e),Hb(this,"render",(()=>{const e=this.getVisibleErrorItems();return y.createElement(Wb,{error:e})})),this.name="ErrorOutputBuilder"}getVisibleErrorItems(){const{errorItems:e,errorOnCompleteItems:t,saveAttempted:r}=this.props;if(r){return[...e||[],...t||[]]}return e||[]}},Yb=(e,t)=>{const r=e.dataEntries[t.id].itemId,n=yf(t.id,r);return{errorItems:e.rulesEffectsGeneralErrors[n]?e.rulesEffectsGeneralErrors[n].error:null,errorOnCompleteItems:e.rulesEffectsGeneralErrors[n]?e.rulesEffectsGeneralErrors[n].errorOnComplete:null}},qb=()=>({}),Kb=(e,t)=>"string"===typeof t?e.key&&Zh(e.key,t)||e.message&&Zh(e.message,t):t.message?e.key&&Zh(e.key,t.message)||e.message&&Zh(e.message,t.message):t.key?e.key&&Zh(e.key,t.key)||e.message&&Zh(e.message,t.key):1,Qb={container:{padding:`0 ${yn.Q.dp16}`,marginBottom:yn.Q.dp16,fontWeight:400},indicatorRow:{display:"flex",justifyContent:"space-between",gap:"4px",borderBottom:`1px solid ${vn.T.grey300}`,padding:`${yn.Q.dp12} 0`,color:vn.T.grey800,fontSize:"14px",lineHeight:"19px","&.isLastItem":{borderBottom:"none",paddingBottom:0}},indicatorValue:{color:vn.T.grey900,display:"flex",alignItems:"center",gap:"4px"},noIndicatorText:{margin:0,color:vn.T.grey600,fontSize:"14px",lineHeight:"19px"},legendBullet:{height:yn.Q.dp8,width:yn.Q.dp8,borderRadius:"10px"}},Xb=(0,I.withStyles)(Qb)((e=>{let{widgetData:t,emptyText:r,classes:n}=e;if(null===t||void 0===t||!t.length)return y.createElement("div",{className:n.container},y.createElement("p",{className:n.noIndicatorText},r));const a=t.sort(Kb),o=e=>y.createElement("div",{className:n.legendBullet,style:{backgroundColor:e}});return y.createElement("div",{className:n.container},a.map(((e,r)=>{const a=r+1===t.length;return e.key?(i=e,s=a,y.createElement("div",{key:i.id,className:er()(n.indicatorRow,{isLastItem:s})},y.createElement("div",null,i.key),(i.value||i.color)&&y.createElement("div",{className:n.indicatorValue},i.color?o(i.color):null,i.value))):e.message?((e,t)=>y.createElement("div",{key:e.id,className:er()(n.indicatorRow,{isLastItem:t})},y.createElement("div",null,e.message),e.color?y.createElement("div",{className:n.indicatorValue},o(e.color)):null))(e,a):"string"===typeof e?((e,t,r)=>y.createElement("div",{key:t,className:er()(n.indicatorRow,{isLastItem:r})},y.createElement("div",null,e)))(e,r,a):null;var i,s})))})),Jb=e=>{let{indicators:t,emptyText:r}=e;const[a,o]=(0,y.useState)(!0);return y.createElement("div",{"data-test":"indicator-widget"},y.createElement(Ib,{header:n.A.t("Indicators"),open:a,onClose:()=>o(!1),onOpen:()=>o(!0)},y.createElement(Xb,{widgetData:t,emptyText:r})))};function Zb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const eS=()=>class extends y.Component{constructor(){super(...arguments),Zb(this,"getItems",(()=>{const{indicatorItems:e}=this.props;return[...(null===e||void 0===e?void 0:e.displayTexts)||[],...(null===e||void 0===e?void 0:e.displayKeyValuePairs)||[]]})),Zb(this,"render",(()=>{const e=this.getItems(),t=e.length>0;return y.createElement("div",null,t&&y.createElement(Jb,{indicators:e,emptyText:n.A.t("No indicator output for this event yet")}))}))}},tS=(e,t)=>{const r=e.dataEntries[t.id].itemId,n=yf(t.id,r);return{indicatorItems:e.rulesEffectsIndicators&&e.rulesEffectsIndicators[n]?e.rulesEffectsIndicators[n]:null}},rS=()=>({}),nS=()=>e=>(e=>t=>{const{onSearchGroupResultCountRetrieved:r,onSearchGroupResultCountRetrievalFailed:n,...a}=t;return y.createElement(e,a)})(e);function aS(){return aS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},aS.apply(this,arguments)}function oS(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const iS=e=>class extends y.Component{constructor(e){super(e),oS(this,"renderAskToCreateNewModal",(()=>this.state.isOpen?y.createElement(N.a,{hide:!this.state.isOpen,dataTest:"modal-ask-to-create-new"},y.createElement(Ip.w,null,n.A.t("Generate new event")),y.createElement(R.$,null,n.A.t("Do you want to create another event?")),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:()=>{this.props.onCancelCreateNew(this.props.itemId),this.setState({isOpen:!1})},secondary:!0},n.A.t("No, cancel")),y.createElement(ra.$,{onClick:()=>{this.props.onConfirmCreateNew(this.props.itemId),this.setState({isOpen:!1})},primary:!0},n.A.t("Yes, create new event"))))):null)),this.state={isOpen:!1},this.handleOnSave=this.handleOnSave.bind(this)}getWrappedInstance(){return this.innerInstance}handleOnSave(e,t,r,n){this.props.allowGenerateNextVisit&&this.props.availableProgramStages&&this.props.availableProgramStages.length>0&&(this.props.isCompleted||n===sb.COMPLETE)&&!this.props.askCompleteEnrollmentOnEventComplete?this.setState({isOpen:!0}):this.props.onSave(e,t,r,n)}render(){const{onSave:t,...r}=this.props;return y.createElement(y.Fragment,null,y.createElement(e,aS({innerRef:e=>{this.innerInstance=e},onSave:this.handleOnSave},r)),this.renderAskToCreateNewModal())}},sS=()=>e=>iS(e);function lS(e){return e.reduce(((e,t)=>{let r;return r=t.type?{type:t.type}:t.onConvertOut?{onConvertOut:t.onConvertOut.toString(),clientId:t.clientId,featureType:t.featureType}:{},r.clientIgnore=t.clientIgnore,e[t.id||t.dataEntryId]=r,e}),{})}function dS(e){return(e.notes||[]).map(((e,t)=>({...e,storedAt:Ii(e.storedAt,it.CO.DATETIME),key:t})))}function cS(e,t){return t.reduce(((t,r)=>{const n=r.dataEntryId||r.id,a=Vf(e[n],r.validatorContainers);return t[n]={isValid:!a,validationError:a},t}),{})}const uS="LoadNewDataEntry";function pS(e,t,r,n,a){const o=n||{},i=a||{},s=r?lS(r):{},d=r?cS(o,r):{},c=yf(e,t);return[l(uS)({key:c,itemId:t,dataEntryId:e,dataEntryMeta:s,dataEntryUI:d,dataEntryValues:o}),My(c,i)]}function mS(){return mS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mS.apply(this,arguments)}const gS=(0,I.withStyles)((()=>({container:{display:"flex",alignItems:"baseline",padding:"8px 8px 8px 12px"},containerVertical:{display:"flex",flexDirection:"column",margin:8},label:{flexBasis:200,fontSize:14,paddingLeft:5,color:"rgba(0, 0, 0, 0.87)"},field:{flexBasis:150,flexGrow:1}})))((e=>{const{classes:t,orientation:r,...a}=e;return y.createElement("div",{className:"horizontal"===r?t.container:t.containerVertical},y.createElement("div",{className:"horizontal"===r&&t.label},n.A.t("Assigned user")),y.createElement("div",{className:"horizontal"===r&&t.field},y.createElement(Uh,mS({inputPlaceholderText:n.A.t("Search for user")},a))))}));var hS="dataEntryFieldLabels_trueOnlyLabel__JwQ9M",ES="dataEntryFieldLabels_coordinateLabel__dEmxL",yS="dataEntryFieldLabels_polygonLabel__lSpI1",vS="dataEntryFieldLabels_dateLabel__41jjw",fS="dataEntryFieldLabels_selectLabel__2Ajzt";const IS=e=>e.currentSelections.programId,bS=e=>e.stage,SS=(0,fp.default)((()=>({icon:{position:"relative",top:1},container:{marginTop:12,marginBottom:12,display:"flex",alignItems:"center"},text:{fontSize:14,fontWeight:"normal",color:vn.T.grey800,marginLeft:6}})))((e=>{let{classes:t,children:r}=e;return y.createElement("div",{className:t.container},y.createElement("span",{className:t.icon},y.createElement(bm.A,{color:vn.T.grey800})),y.createElement("span",{className:t.text},r))}));function TS(){return TS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},TS.apply(this,arguments)}const AS=(e,t)=>{class r extends y.Component{constructor(e){super(e),this.reselectComponentProps=zf()}getFieldElement(t){const{id:r,completionAttempted:n,saveAttempted:a,onUpdateDataEntryField:o}=this.props,{getComponent:i,getComponentProps:s,getValidatorContainers:l,getPropName:d}=e,c=i(this.props),u=this.reselectComponentProps(s&&s(this.props,t)),p=l&&l(this.props,t)||[],m=d(this.props,t);return y.createElement($f,{ref:e=>{if(this.props.dataEntryFieldRef){if(!m)return void S().error((0,j.px)("data entry field needs a key, but no propName was specified")({}));this.props.dataEntryFieldRef(e,m)}},dataEntryId:r,completionAttempted:n,saveAttempted:a,Component:c,validatorContainers:p,propName:m,onUpdateField:o,componentProps:{...u}})}getFieldElementFromProps(t){var r;const{getMeta:n}=e,a=n&&n(this.props);return{field:this.getFieldElement(t),...a?{placement:null!==(r=a.placement)&&void 0!==r?r:gf,section:a.section,sectionName:a.sectionName}:null}}getFields(){const{getIsHidden:t,getFieldIds:r}=e,{fields:n}=this.props,a=r?r(this.props):[];if(t&&t(this.props))return n?[...n]:[];const o=a?[...a.map((e=>this.getFieldElementFromProps(e)))]:[];return n?[...o,...n]:[...o]}render(){const{fields:e,...r}=this.props;return y.createElement("div",null,y.createElement(t,TS({fields:this.getFields()},r)))}}return r},CS=e=>t=>AS(e,t),OS="categorycombo",NS="attributeCategoryOptions",RS=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{program:n,isLoading:a}=Ji(e,{enabled:!r});return{isLoading:a,programCategory:a||null!==n&&void 0!==n&&null!==(t=n.categoryCombo)&&void 0!==t&&t.isDefault||null===n||void 0===n?void 0:n.categoryCombo}};function wS(){return wS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wS.apply(this,arguments)}const _S=(e,t)=>r=>{var n;const{programId:a,selectedOrgUnitId:o}=r,i=e&&(null===(n=e.hideAOC)||void 0===n?void 0:n.call(e,r)),[s,l]=(0,y.useState)(null),d=(0,y.useRef)(null),{programCategory:c,isLoading:u}=RS(a,i),p=(0,y.useMemo)((()=>!u&&c?c.categories:[]),[u,c]),m=(0,y.useCallback)((()=>{let e;l([]),d.current&&d.current.cancel();const t=()=>e&&d.current!==e;e=(0,j.gI)(Promise.all(p.map((e=>(async(e,t,r)=>{const n=await Rd(e.id,{predicate:e=>{if(!t)return!0;const r=e.organisationUnits;return!r||!!r[t]},project:e=>({label:e.displayName,value:e.id,writeAccess:e.access.data.write}),onIsAborted:r});return{id:e.id,label:e.displayName,options:n}})(e,o,t))))),e.promise.then((e=>{const t=e.map((e=>{let{options:t,...r}=e;return t.sort(((e,t)=>e.label===t.label?0:e.label<t.label?-1:1)),{options:t,...r}}));l(t),d.current=null})).catch((e=>{e&&(e.aborted||e.isCanceled)||(S().error((0,j.px)("An error occured loading category options")({error:e})),l([]))})),d.current=e}),[p,o]);return(0,y.useEffect)((()=>{i||m()}),[m,i]),(0,y.useEffect)((()=>()=>{d.current&&d.current.cancel(),d.current=null}),[]),i?y.createElement(t,r):!u&&s?y.createElement(t,wS({},r,{programCategory:c,categories:s})):y.createElement(_,null)},PS=e=>t=>_S(e,t),kS=(e,t)=>{const r=[{validator:r=>((e,t,r)=>{var a,o;const i=null===t||void 0===t||null===(a=t.categories)||void 0===a||null===(o=a.find((e=>e.id===r)))||void 0===o?void 0:o.label;return{valid:Vt(e),message:n.A.t("Please select {{categoryName}}",{categoryName:i})}})(r,e,t),message:""}];return r};function DS(){return DS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},DS.apply(this,arguments)}function US(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const LS="BASICINFO",FS="STATUS",xS="NOTES",MS="RELATIONSHIPS",VS="ASSIGNEE",jS={errorMessage:"validationError"},GS={labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}},BS={labelContainerStyle:{width:150},inputContainerStyle:{width:150}};function $S(e){const{formHorizontal:t,fieldOptions:r,validationError:n,modified:a,...o}=e;return o}const WS=e=>({fieldOptions:e.fieldOptions,formHorizontal:e.formHorizontal,styles:e.formHorizontal?BS:GS}),HS=(e,t)=>({...WS(e),...t}),zS=nm(jS)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${ES}`})(pm()(Qr()(vm($S)(Np)))))))),YS=nm(jS)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${yS}`})(pm()(Qr()(vm($S)(_p)))))))),qS=e=>e?qr:Yr,KS=nS()(vm((e=>{const{stage:t,onScrollToRelationships:r,recentlyAddedRelationshipId:n,relationshipsRef:a,...o}=e;return o}))(Of)),QS=GI((()=>{const e=Hm(["onBlur","onSet"])(hr()(vm((e=>{const t=$S(e),{validationAttempted:r,touched:n,...a}=t;return a}))(gS)));return{isApplicable:e=>!!(e.stage&&e.stage.enableUserAssignment),getComponent:()=>e,getComponentProps:e=>HS({},{orientation:qS(e.formHorizontal)}),getPropName:()=>"assignee",getValidatorContainers:()=>[],getMeta:()=>({section:VS})}})())(KS),XS=PS({})(CS((()=>{const e=nm(jS)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${fS}`})(pm()(Qr()(vm($S)(tp))))))));return{getComponent:()=>e,getComponentProps:(e,t)=>{var r,n;return HS(e,{...null!==(r=null===(n=e.categories)||void 0===n?void 0:n.find((e=>e.id===t)))&&void 0!==r?r:{},required:!0})},getPropName:(e,t)=>t?`${NS}-${t}`:NS,getFieldIds:e=>{var t;return null===(t=e.categories)||void 0===t?void 0:t.map((e=>e.id))},getValidatorContainers:(e,t)=>kS(e,t),getMeta:e=>{const{programCategory:t}=e;return{section:OS,placement:gf,sectionName:null===t||void 0===t?void 0:t.displayName}}}})())(QS)),JS=GI((()=>{const e=(0,fg.Mz)(bS,(e=>e?e.relationshipTypesWhereStageIsFrom.filter((e=>e.access.data.write)):[])),t=hm()(ym()(vm($S)((e=>(0,gs.Ng)(pI,mI)(uI(e)))(fI))));return{isApplicable:e=>e.stage&&e.stage.relationshipTypesWhereStageIsFrom.length>0,getComponent:()=>t,getComponentProps:t=>HS(t,{id:"relationship",dataEntryId:t.id,highlightRelationshipId:t.recentlyAddedRelationshipId,relationshipsRef:t.relationshipsRef,onOpenAddRelationship:t.onOpenAddRelationship,writableRelationshipTypes:e(t),fromEntity:"PROGRAM_STAGE_INSTANCE",currentEntityId:"newEvent"}),getValidatorContainers:()=>[],getPropName:()=>"relationship",getMeta:()=>({placement:hf,section:MS})}})())(XS),ZS=Qf((()=>{const e=nm(jS)(hm()(ym()(pm()(Qr()(vm($S)(tI()(lI)))))));return{getComponent:()=>e,getComponentProps:e=>HS(e,{label:n.A.t("Notes"),onAddNote:e.onAddNote,id:"notes",dataEntryId:e.id}),getPropName:()=>"note",getValidatorContainers:()=>VI(),getMeta:()=>({placement:hf,section:xS})}})())(JS),eT=GI({isApplicable:e=>{const t=e.formFoundation.featureType;return["Polygon","Point"].includes(t)},getComponent:e=>"Polygon"===e.formFoundation.featureType?YS:zS,getComponentProps:e=>{const t=e.formFoundation.featureType;return HS(e,"Polygon"===t?{width:e&&e.formHorizontal?150:350,label:n.A.t("Area"),dialogLabel:n.A.t("Area"),required:!1,orientation:qS(e.formHorizontal),orgUnit:e.orgUnit}:{width:e&&e.formHorizontal?150:350,label:n.A.t("Coordinate"),dialogLabel:n.A.t("Coordinate"),required:!1,orientation:qS(e.formHorizontal),shrinkDisabled:e.formHorizontal,orgUnit:e.orgUnit})},getPropName:()=>"geometry",getValidatorContainers:()=>[],getMeta:()=>({placement:gf,section:LS})})(ZS),tT=(e=>hb()(e,(0,gs.Ng)(Ob,Nb)(Cb())))(Qf((()=>{const e=nm(jS)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${vS}`})(pm()(Qr()(vm($S)(Ep))))))));return{getComponent:()=>e,getComponentProps:e=>{return HS(e,{width:e&&e.formHorizontal?150:"100%",label:e.formFoundation.getLabel("occurredAt"),required:!0,calendarWidth:e.formHorizontal?250:350,popupAnchorPosition:(t=e.formHorizontal,t?"center":"left")});var t},getPropName:()=>"occurredAt",getValidatorContainers:()=>bI(),getMeta:()=>({placement:gf,section:LS})}})())(eT)),rT=(e=>hb()(e,(0,gs.Ng)(tS,rS)(eS())))(tT),nT=(e=>hb()(e,(0,gs.Ng)(Vb,jb)(Mb())))(rT),aT=(e=>hb()(e,(0,gs.Ng)(Yb,qb)(zb())))(nT),oT=Mf((()=>({color:"primary"})))(aT),iT=ub({onIsCompleting:e=>e.completeDataEntryFieldValue,onFilterProps:e=>{const{completeDataEntryFieldValue:t,...r}=e;return r}})((e=>(0,gs.Ng)(FI,xI)(LI(e)))(oT)),sT=Qf((()=>{const e=nm(jS)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${hS}`})(pm()(Qr()(vm($S)(Mu))))))));return{getComponent:()=>e,getComponentProps:e=>HS(e,{label:n.A.t("Complete event"),id:"complete"}),getPropName:()=>"complete",getValidatorContainers:()=>[],getMeta:()=>({placement:hf,section:FS}),getPassOnFieldData:()=>!0}})())(iT),lT={[LS]:{placement:gf,name:n.A.t("Basic info")},[OS]:{placement:gf},[FS]:{placement:hf,name:n.A.t("Status")},[xS]:{placement:hf,name:n.A.t("Notes")},[MS]:{placement:hf,name:n.A.t("Relationships")},[VS]:{placement:hf,name:n.A.t("Assignee")}};class dT extends y.Component{constructor(e){super(e),US(this,"setRelationshipsInstance",(e=>{this.relationshipsInstance=e})),US(this,"handleSave",((e,t,r,n)=>{n===SI.SAVEANDADDANOTHER?(this.props.formHorizontal||this.props.onSetSaveTypes([SI.SAVEANDADDANOTHER,SI.SAVEANDEXIT]),this.props.onSaveAndAddAnother(e,t,r)):n===SI.SAVEANDEXIT?this.props.onSave(e,t,r):n===SI.SAVEWITHOUTCOMPLETING?this.props.onSaveEventInStage(e,t,r):n===SI.SAVEANDCOMPLETE&&this.props.onSaveEventInStage(e,t,r,!0)})),US(this,"renderHorizontal",(()=>{const e=this.props.classes;return y.createElement("div",{className:e.horizontal},this.renderContent())})),US(this,"renderVertical",(()=>y.createElement("div",null,this.renderContent()))),US(this,"renderContent",(()=>{const{onUpdateDataEntryField:e,onUpdateField:t,onStartAsyncUpdateField:r,programName:n,orgUnit:a,orgUnitName:o,classes:i,onSave:s,onSetSaveTypes:l,onSaveAndAddAnother:d,theme:c,...u}=this.props;return y.createElement("div",null,y.createElement("div",{"data-test":"data-entry-container"},y.createElement(sT,DS({id:"singleEvent",onUpdateDataEntryField:e(a),onUpdateFormField:t(a),onUpdateFormFieldAsync:r(a),selectedOrgUnitId:a.id,onSave:this.handleSave,fieldOptions:this.fieldOptions,dataEntrySections:this.dataEntrySections,relationshipsRef:this.setRelationshipsInstance,orgUnit:a},u))),y.createElement(SS,null,this.getSavingText()))})),this.fieldOptions={theme:e.theme,fieldLabelMediaBasedClass:e.classes.fieldLabelMediaBased},this.dataEntrySections=lT}UNSAFE_componentWillMount(){this.props.onSetSaveTypes(null)}componentDidMount(){this.relationshipsInstance&&this.props.recentlyAddedRelationshipId&&(this.relationshipsInstance.scrollIntoView(),this.props.onScrollToRelationships())}componentWillUnmount(){Fg.clear()}getSavingText(){const{orgUnitName:e,programName:t}=this.props;return y.createElement("span",null,n.A.t("Saving to {{programName}} in {{orgUnitName}}",{orgUnitName:e,programName:t,interpolation:{escapeValue:!1}}))}render(){return y.createElement("div",null,this.props.formHorizontal?this.renderHorizontal():this.renderVertical())}}const cT=(0,I.withStyles)((e=>({savingContextContainer:{paddingTop:e.typography.pxToRem(10),display:"flex",alignItems:"center",color:e.palette.grey.dark,fontSize:e.typography.pxToRem(13)},savingContextText:{paddingLeft:e.typography.pxToRem(10)},savingContextNames:{fontWeight:"bold"},topButtonsContainer:{display:"flex",flexFlow:"row-reverse"},horizontal:{padding:e.typography.pxToRem(10),paddingTop:e.typography.pxToRem(20),paddingBottom:e.typography.pxToRem(15)},fieldLabelMediaBased:{[e.breakpoints.down(523)]:{paddingTop:"0px !important"}}})))((0,I.withTheme)()(dT)),uT=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(IS,(e=>{const t=td.J.get(e);return t&&t.name||""}));return(t,r)=>({recentlyAddedRelationshipId:t.newEventPage.recentlyAddedRelationshipId,ready:!t.activePage.isDataEntryLoading,error:r.formFoundation?null:n.A.t("This is not an event program or the metadata is corrupt. See log for details."),programName:e(t),orgUnitName:t.organisationUnits[t.currentSelections.orgUnitId]&&t.organisationUnits[t.currentSelections.orgUnitId].name})}),(e=>({onUpdateDataEntryField:t=>r=>{const{dataEntryId:n,itemId:a}=r.payload,o=(0,yc.A)();e((0,Xd.OJ)([r,nv(n,a,o),Hv({...r.payload,uid:o,orgUnit:t})],uv))},onUpdateField:t=>r=>{const{dataEntryId:n,itemId:a}=r.payload,o=(0,yc.A)();e((0,Xd.OJ)([r,nv(n,a,o),Hv({...r.payload,uid:o,orgUnit:t})],pv))},onStartAsyncUpdateField:t=>(r,n,a)=>{e(((e,t,r)=>d(e)({onSuccess:t,onError:r}))(r,(e=>{const r=(0,yc.A)();return(0,Xd.OJ)([e,nv(n,a,r),Hv({...e.payload,dataEntryId:n,itemId:a,uid:r,orgUnit:t})],pv)}),(e=>e)))},onSave:(t,r,n)=>{window.scrollTo(0,0),e(((e,t,r)=>l(yv)({eventId:e,dataEntryId:t,formFoundation:r},{skipLogging:["formFoundation"]}))(t,r,n))},onAddNote:(t,r,n)=>{e(((e,t,r)=>l(_v)({itemId:e,dataEntryId:t,note:r}))(t,r,n))},onSetSaveTypes:t=>{e((e=>l(wv)({saveTypes:e}))(t))},onSaveAndAddAnother:(t,r,n)=>{e(((e,t,r)=>l(Cv)({eventId:e,dataEntryId:t,formFoundation:r},{skipLogging:["formFoundation"]}))(t,r,n))},onCancel:()=>{window.scrollTo(0,0),e(Yv())},onOpenAddRelationship:(t,r)=>{e(((e,t)=>l(Pv)({eventId:e,dataEntryId:t}))(t,r))},onScrollToRelationships:()=>{e(l(jv)())},onSaveEventInStage:(t,r,n,a)=>{window.scrollTo(0,0),e(((e,t,r,n)=>l(Gv)({eventId:e,dataEntryId:t,formFoundation:r,completed:n},{skipLogging:["formFoundation"]}))(t,r,n,a))}})))(Dp()(qm()(cT))),pT="StartRunRulesOnUpdateForNewEnrollment",mT=(e,t,r,n,a,o)=>l(pT)({innerPayload:e,uid:t,programId:r,orgUnit:n,stage:a,formFoundation:o}),gT="RulesExecutedPostUpdateFieldForEnrollment",hT="UpdateFieldNewEnrollmentActionBatch",ET="UpdateDataEntryFieldNewEnrollmentActionBatch";var yT="fieldLabels_coordinateLabel__eGSD7",vT="fieldLabels_polygonLabel__98cg9",fT="fieldLabels_dateLabel__7LXQs",IT="fieldLabels_selectLabel__jAfZq";const bT=e=>{const t=[{validator:Vt,message:n.A.t("A value is required")},{validator:t=>((e,t)=>{const r=Rt(e);if(!r.isValid)return!1;if(t)return!0;const a=r.momentDate,o=$()();return{valid:a.isSameOrBefore(o),message:n.A.t("A future date is not allowed")}})(t,e),message:n.A.t("Please provide a valid date")}];return t},ST=e=>{const t=[{validator:Vt,message:n.A.t("A value is required")},{validator:t=>((e,t)=>{const r=Rt(e);if(!r.isValid)return!1;if(t)return!0;const a=r.momentDate,o=$()();return{valid:a.isSameOrBefore(o),message:n.A.t("A future date is not allowed")}})(t,e),message:n.A.t("Please provide a valid date")}];return t},TT=(e,t)=>{const r=[{validator:r=>((e,t,r)=>{var a,o;const i=null===t||void 0===t||null===(a=t.categories)||void 0===a||null===(o=a.find((e=>e.id===r)))||void 0===o?void 0:o.displayName;return{valid:Vt(e),message:n.A.t("Please select {{categoryName}}",{categoryName:i})}})(r,e,t),message:""}];return r},AT="enrollment",CT="enrollment",OT="status",NT="stageBasicInfo",RT="assignee";var wT="fieldLabels_trueOnlyLabel__sYVIj",_T="fieldLabels_coordinateLabel__aBg-8",PT="fieldLabels_dateLabel__nYbhR";const kT=e=>!e||xc(e),DT=()=>[{validator:Vt,message:n.A.t("A value is required")},{validator:kT,message:n.A.t("Please provide a valid date")}];function UT(e,t,r){const n=r||t.featureType;if(!e||!["Polygon","Point"].includes(n))return null;let a=e;return"Point"===n&&(a=[e.longitude,e.latitude]),{type:n,coordinates:a}}function LT(e){return t=>t&&e&&t.type===e.featureType?"Point"===e.featureType?{latitude:t.coordinates[1],longitude:t.coordinates[0]}:t.coordinates:null}function FT(e){return"COMPLETED"===e?"true":null}function xT(e){return"true"===e?"COMPLETED":"ACTIVE"}const MT={OCCURRED_AT:"stageOccurredAt",COMPLETE:"stageComplete",GEOMETRY:"stageGeometry",ASSIGNEE:"assignee"},VT={OCCURRED_AT:"occurredAt",COMPLETE:"complete",GEOMETRY:"geometry"},jT=e=>VT[e],GT={errorMessage:"validationError"},BT={labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}},$T={labelContainerStyle:{width:150},inputContainerStyle:{width:150}};function WT(e){const{formHorizontal:t,fieldOptions:r,validationError:n,modified:a,...o}=e;return o}const HT=e=>({fieldOptions:e.fieldOptions,formHorizontal:e.formHorizontal,styles:e.formHorizontal?$T:BT}),zT=(e,t)=>({...HT(e),...t}),YT=e=>e?qr:Yr,qT=nm(GT)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${_T}`})(pm()(Qr()(vm(WT)(Np)))))))),KT=nm(GT)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${_T}`})(pm()(Qr()(vm(WT)(_p)))))))),QT=GI({isApplicable:e=>{var t,r,n;const a=null===(t=e.firstStageMetaData)||void 0===t||null===(r=t.stage)||void 0===r||null===(n=r.stageForm)||void 0===n?void 0:n.featureType;return["Polygon","Point"].includes(a)},getComponent:e=>{var t,r,n;return"Polygon"===(null===(t=e.firstStageMetaData)||void 0===t||null===(r=t.stage)||void 0===r||null===(n=r.stageForm)||void 0===n?void 0:n.featureType)?KT:qT},getComponentProps:e=>{var t,r,a;const o=null===(t=e.firstStageMetaData)||void 0===t||null===(r=t.stage)||void 0===r||null===(a=r.stageForm)||void 0===a?void 0:a.featureType;return zT(e,"Polygon"===o?{width:e&&e.formHorizontal?150:350,label:n.A.t("Area"),dialogLabel:n.A.t("Area"),required:!1,orientation:YT(e.formHorizontal),orgUnit:e.orgUnit}:{width:e&&e.formHorizontal?150:350,label:n.A.t("Coordinate"),dialogLabel:n.A.t("Coordinate"),required:!1,orientation:YT(e.formHorizontal),shrinkDisabled:e.formHorizontal,orgUnit:e.orgUnit})},getPropName:()=>MT.GEOMETRY,getValidatorContainers:()=>[],getMeta:()=>({section:NT})})((e=>(e=>t=>{const{dataEntryFieldRef:r,firstStageMetaData:n,...a}=t;return y.createElement(e,a)})(e))(Of)),XT=GI((()=>{const e=nm(GT)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${wT}`})(pm()(Qr()(vm(WT)(Mu))))))));return{isApplicable:e=>{var t;return e.firstStageMetaData&&(null===(t=e.firstStageMetaData.stage)||void 0===t?void 0:t.stageForm)},getComponent:()=>e,getComponentProps:e=>zT(e,{label:n.A.t("Complete event"),id:"complete"}),getPropName:()=>MT.COMPLETE,getValidatorContainers:()=>[],getMeta:()=>({placement:hf,section:OT}),getPassOnFieldData:()=>!0}})())(QT),JT=GI((()=>{const e=Hm(["onBlur","onSet"])(hr()(vm((e=>{const t=WT(e),{validationAttempted:r,touched:n,...a}=t;return a}))(gS)));return{isApplicable:e=>!!(e.firstStageMetaData&&e.firstStageMetaData.stage.enableUserAssignment),getComponent:()=>e,getComponentProps:e=>zT({},{orientation:YT(e.formHorizontal)}),getPropName:()=>"assignee",getValidatorContainers:()=>[],getMeta:()=>({section:RT})}})())(XT),ZT=GI((()=>{const e=nm(GT)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${PT}`})(pm()(Qr()(vm(WT)(Ep))))))));return{isApplicable:e=>{var t,r;return null===(t=e.firstStageMetaData)||void 0===t||null===(r=t.stage)||void 0===r?void 0:r.stageForm},getComponent:()=>e,getComponentProps:e=>{var t,r,n,a;return zT(e,{width:e&&e.formHorizontal?150:"100%",label:null===(t=e.firstStageMetaData)||void 0===t||null===(r=t.stage)||void 0===r||null===(n=r.stageForm)||void 0===n?void 0:n.getLabel("occurredAt"),required:!0,calendarWidth:e.formHorizontal?250:350,popupAnchorPosition:(a=e.formHorizontal,a?"center":"left")})},getPropName:()=>MT.OCCURRED_AT,getValidatorContainers:()=>DT(),getMeta:()=>({section:NT})}})())(JT);function eA(){return eA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},eA.apply(this,arguments)}const tA=e=>{const{firstStageMetaData:t,...r}=e,{stage:{stageForm:a,name:o}}=t,[[i]]=a.sections;var s;const l=((e,t)=>(0,y.useMemo)((()=>({[CT]:{placement:gf,name:n.A.t("Enrollment")},[NT]:{beforeSectionId:t,placement:Ef,name:n.A.t("{{ stageName }} - Basic info",{stageName:e})},[OS]:{beforeSectionId:t,placement:Ef},[RT]:{placement:hf,name:n.A.t("{{ stageName }} - Assignee",{stageName:e})},[OT]:{placement:hf,name:n.A.t("{{ stageName }} - Status",{stageName:e})}})),[e,t]))(o,(s=i)===it.wn.MAIN_SECTION_ID?`${it.wn.MAIN_SECTION_ID}-stage`:s);return y.createElement(ZT,eA({},r,{firstStageMetaData:t,dataEntrySections:l}))};function rA(){return rA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rA.apply(this,arguments)}function nA(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const aA={errorMessage:"validationError"},oA={labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}},iA={labelContainerStyle:{width:150},inputContainerStyle:{width:150}};function sA(e){const{formHorizontal:t,fieldOptions:r,validationError:n,modified:a,...o}=e;return o}const lA=e=>({fieldOptions:e.fieldOptions,formHorizontal:e.formHorizontal,styles:e.formHorizontal?iA:oA}),dA=(e,t)=>({...lA(e),...t}),cA=e=>e?"center":"left",uA=nm(aA)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${yT}`})(pm()(Qr()(vm(sA)(Np)))))))),pA=nm(aA)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${vT}`})(pm()(Qr()(vm(sA)(_p)))))))),mA=e=>e?qr:Yr;class gA extends y.Component{componentWillUnmount(){Fg.clear()}render(){const{enrollmentMetadata:e,firstStageMetaData:t,...r}=this.props;return t?y.createElement(tA,rA({},r,{firstStageMetaData:t})):y.createElement(Of,rA({},r,{dataEntrySections:gA.dataEntrySectionDefinitions}))}}nA(gA,"dataEntrySectionDefinitions",{[AT]:{placement:gf,name:n.A.t("Enrollment")},[OS]:{placement:hf}});const hA=PS({hideAOC:e=>{let{programId:t}=e;const{stages:r,useFirstStageDuringRegistration:n}=(0,it.Nd)(t);return!([...r.values()].some((e=>e.autoGenerateEvent))||n)}})(CS((()=>{const e=nm(aA)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${IT}`})(pm()(Qr()(vm(sA)(tp))))))));return{getComponent:()=>e,getComponentProps:(e,t)=>{var r,n;return dA(e,{...null!==(r=null===(n=e.categories)||void 0===n?void 0:n.find((e=>e.id===t)))&&void 0!==r?r:{},required:!0})},getPropName:(e,t)=>t?`${NS}-${t}`:NS,getFieldIds:e=>{var t;return null===(t=e.categories)||void 0===t?void 0:t.map((e=>e.id))},getValidatorContainers:(e,t)=>kS(e,t),getMeta:e=>{const{firstStageMetaData:t,programCategory:r}=e;return{section:OS,placement:hf,sectionName:t?`${t.stage.name} - ${null===r||void 0===r?void 0:r.displayName}`:null===r||void 0===r?void 0:r.displayName}}}})())(gA)),EA=GI({isApplicable:e=>{const t=e.enrollmentMetadata.enrollmentForm.featureType;return["Polygon","Point"].includes(t)},getComponent:e=>"Polygon"===e.enrollmentMetadata.enrollmentForm.featureType?pA:uA,getComponentProps:e=>{const t=e.enrollmentMetadata.enrollmentForm.featureType;return dA(e,"Polygon"===t?{width:e&&e.formHorizontal?150:350,label:n.A.t("Area"),dialogLabel:n.A.t("Area"),required:!1,orientation:mA(e.formHorizontal),orgUnit:e.orgUnit}:{width:e&&e.formHorizontal?150:350,label:n.A.t("Coordinate"),dialogLabel:n.A.t("Coordinate"),required:!1,orientation:mA(e.formHorizontal),shrinkDisabled:e.formHorizontal,orgUnit:e.orgUnit})},getPropName:()=>"geometry",getValidatorContainers:()=>[],getPassOnFieldData:()=>!0,getMeta:()=>({placement:gf,section:AT})})(hA),yA=GI((()=>{const e=nm(aA)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${fT}`})(pm()(Qr()(vm(sA)(Ep))))))));return{isApplicable:e=>e.enrollmentMetadata.showIncidentDate,getComponent:()=>e,getComponentProps:e=>dA(e,{width:e&&e.formHorizontal?150:"100%",label:e.enrollmentMetadata.incidentDateLabel,required:!0,calendarWidth:e.formHorizontal?250:350,popupAnchorPosition:cA(e.formHorizontal),calendarMaxMoment:e.enrollmentMetadata.allowFutureIncidentDate?void 0:$()()}),getPropName:()=>"occurredAt",getPassOnFieldData:()=>!0,getValidatorContainers:e=>ST(e.enrollmentMetadata.allowFutureIncidentDate),getMeta:()=>({placement:gf,section:AT})}})())(EA),vA=Qf((()=>{const e=nm(aA)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${fT}`})(pm()(Qr()(vm(sA)(Ep))))))));return{getComponent:()=>e,getComponentProps:e=>dA(e,{width:e&&e.formHorizontal?150:"100%",label:e.enrollmentMetadata.enrollmentDateLabel,required:!0,calendarWidth:e.formHorizontal?250:350,popupAnchorPosition:cA(e.formHorizontal),calendarMaxMoment:e.enrollmentMetadata.allowFutureEnrollmentDate?void 0:$()()}),getPropName:()=>"enrolledAt",getValidatorContainers:e=>bT(e.enrollmentMetadata.allowFutureEnrollmentDate),getPassOnFieldData:()=>!0,getMeta:()=>({placement:gf,section:AT})}})())(yA),fA=YI()(vA);class IA extends y.PureComponent{render(){return y.createElement(fA,this.props)}}class bA extends y.Component{constructor(){var e;super(...arguments),e=this,nA(this,"getValidationContext",(()=>{const{orgUnit:e,onGetUnsavedAttributeValues:t,programId:r,teiId:n}=this.props;return{programId:r,orgUnitId:e.id,trackedEntityInstanceId:n,trackedEntityTypeId:this.props.enrollmentMetadata.trackedEntityType.id,onGetUnsavedAttributeValues:t}})),nA(this,"handleUpdateField",(function(){const{programId:t,orgUnit:r,firstStageMetaData:n,formFoundation:a}=e.props;for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];e.props.onUpdateField(...i,t,r,null===n||void 0===n?void 0:n.stage,a)})),nA(this,"handleUpdateDataEntryField",(function(){const{programId:t,orgUnit:r,firstStageMetaData:n,formFoundation:a}=e.props;for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];e.props.onUpdateDataEntryField(...i,t,r,null===n||void 0===n?void 0:n.stage,a)})),nA(this,"handleStartAsyncUpdateField",(function(){const{programId:t,orgUnit:r,firstStageMetaData:n,formFoundation:a}=e.props;for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];e.props.onStartAsyncUpdateField(...i,t,r,null===n||void 0===n?void 0:n.stage,a)}))}render(){const{onUpdateField:e,onUpdateDataEntryField:t,onStartAsyncUpdateField:r,onGetUnsavedAttributeValues:n,...a}=this.props;return y.createElement(IA,rA({onGetValidationContext:this.getValidationContext,onUpdateFormField:this.handleUpdateField,onUpdateDataEntryField:this.handleUpdateDataEntryField,onUpdateFormFieldAsync:this.handleStartAsyncUpdateField},a))}}const SA=(0,gs.Ng)((()=>({})),(e=>({onUpdateDataEntryField:(t,r,n,a,o,i)=>{e(((e,t,r,n,a)=>{const{dataEntryId:o,itemId:i}=e.payload,s=(0,yc.A)();return(0,Xd.OJ)([e,nv(o,i,s),mT(e.payload,s,t,r,n,a)],ET)})(t,n,a,o,i))},onUpdateField:(t,r,n,a,o)=>{e(((e,t,r,n,a)=>{const{dataEntryId:o,itemId:i}=e.payload,s=(0,yc.A)();return(0,Xd.OJ)([e,nv(o,i,s),mT(e.payload,s,t,r,n,a)],hT)})(t,r,n,a,o))},onStartAsyncUpdateField:(t,r,n,a,o,i,s)=>{e(((e,t,r)=>d(e)({onSuccess:t,onError:r}))(t,(e=>((e,t,r,n,a,o,i)=>{const s=(0,yc.A)();return(0,Xd.OJ)([e,nv(t,r,s),mT({...e.payload,dataEntryId:t,itemId:r},s,n,a,o,i)],hT)})(e,r,n,a,o,i,s)),(e=>e)))}})))(bA),TA="OpenDataEntryForNewEnrollment",AA=(e,t)=>l(TA)({dataEntryId:e,generatedUniqueValues:t}),CA="newEnrollment",OA=[{id:"enrolledAt",type:"DATE",validatorContainers:bT()},{id:"occurredAt",type:"DATE",validatorContainers:ST()},{clientId:"geometry",dataEntryId:"geometry",onConvertOut:UT}],NA="OpenDataEntryForNewEnrollmentBatch",RA=async e=>{let{program:t,orgUnit:r,dataEntryId:n,extraActions:a=[],extraDataEntryProps:o=[],formValues:i,clientValues:s,firstStage:l,programCategory:d,formFoundation:c}=e;const u=yf(n,CA),p=My(`${n}-${CA}`,i),m=l&&(e=>[{id:MT.OCCURRED_AT,type:"DATE",validatorContainers:DT()},{clientId:MT.COMPLETE,dataEntryId:MT.COMPLETE,onConvertIn:FT,onConvertOut:xT},{clientId:MT.GEOMETRY,dataEntryId:MT.GEOMETRY,onConvertIn:LT(e.stageForm),onConvertOut:UT,featureType:e.stageForm.featureType},...e.enableUserAssignment?[{id:MT.ASSIGNEE,type:"ASSIGNEE"}]:[]])(l),g={enrolledAt:wt(new Date)},h=[...OA,...o,...m||[],...d&&d.categories?d.categories.map((e=>({id:`attributeCategoryOptions-${e.id}`,type:"TEXT",validatorContainers:TT({categories:d.categories},e.id)}))):[]],E=pS(n,CA,h,g),y=Zl({program:t,orgUnit:r,stage:l,attributeValues:s,enrollmentData:g,formFoundation:c});return(0,Xd.OJ)([AA(n),...E,p,ld(y,u),...a],NA)};const wA=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=e.value,{programId:o,dataEntryId:i,itemId:s,orgUnit:l,uid:d,stage:c,formFoundation:u}=t,p=yf(i,s),m=(0,it.x6)(o),g=a.formsValues[p]||{},h=u.convertAndGroupBySection(g,Mi),E=h[it.wn.groups.ENROLLMENT],y=h[it.wn.groups.EVENT]||{},v=id(a,s,i,u)||{},{currentEnrollmentValues:f,currentEventMainData:I}=((e,t)=>e?Object.keys(t).reduce(((e,r)=>{const n=Object.keys(MT).find((e=>MT[e]===r));return n?e.currentEventMainData={...e.currentEventMainData,[jT(n)]:t[r]}:e.currentEnrollmentValues={...e.currentEnrollmentValues,[r]:t[r]},e}),{currentEnrollmentValues:{},currentEventMainData:{}}):{currentEnrollmentValues:t,currentEventMainData:{}})(a,v);return(e=>{let{program:t,formId:r,dataEntryId:n,itemId:a,orgUnit:o,enrollmentData:i,attributeValues:s,extraActions:l=[],uid:d,stage:c,formFoundation:u,currentEvent:p}=e;const m=Zl({program:t,stage:c,orgUnit:o,currentEvent:p,enrollmentData:i,attributeValues:s,formFoundation:u});return(0,Xd.OJ)([ld(m,r),av(n,a,d),...l],gT)})({program:m,formId:p,dataEntryId:i,itemId:s,orgUnit:l,enrollmentData:f,attributeValues:E,currentEvent:c?{...y,...I,programStageId:c.id}:void 0,extraActions:n,uid:d,stage:c,formFoundation:c?u:void 0})},_A="NewTeiFieldUpdateBatch";function PA(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kA(){return kA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kA.apply(this,arguments)}class DA extends y.Component{componentWillUnmount(){Fg.clear()}render(){const{teiRegistrationMetadata:e,orgUnitId:t,...r}=this.props;return y.createElement(Of,kA({},r,{orgUnit:{id:t},formFoundation:e.form}))}}const UA=YI()(DA);class LA extends y.PureComponent{render(){return y.createElement(UA,this.props)}}class FA extends y.Component{constructor(){super(...arguments),PA(this,"getValidationContext",(()=>{const{orgUnitId:e,onGetUnsavedAttributeValues:t,trackedEntityTypeId:r}=this.props;return{trackedEntityTypeId:r,orgUnitId:e,onGetUnsavedAttributeValues:t}}))}render(){const{trackedEntityTypeId:e,onUpdateField:t,onStartAsyncUpdateField:r,teiRegistrationMetadata:a,onGetUnsavedAttributeValues:o,...i}=this.props;return a?y.createElement(LA,kA({onGetValidationContext:this.getValidationContext,onUpdateFormField:t,onUpdateFormFieldAsync:r,teiRegistrationMetadata:a},i)):y.createElement("div",null,n.A.t("An error has occurred. See log for details"))}}const xA=(0,gs.Ng)((()=>({})),(e=>({onUpdateField:t=>{e((e=>(0,Xd.OJ)([e],_A))(t))},onStartAsyncUpdateField:t=>{e(((e,t,r)=>d(e)({onSuccess:t,onError:r}))(t,(e=>(e=>(0,Xd.OJ)([e],_A))(e)),(e=>e)))}})))(FA),MA="OpenDataEntryForNewTEI",VA=(e,t)=>l(MA)({dataEntryId:e,generatedUniqueValues:t});function jA(e,t){return(0,j.Fs)(Et,xt)(e,t)}async function GA(e,t,r){const n=await r({resource:`trackedEntityAttributes/${e}/requiredValues`}).then((e=>e&&e.REQUIRED)).catch((t=>(S().error((0,j.px)("Could not retrieve required values")({teaId:e,error:t})),null))),a={...n&&n.includes("ORG_UNIT_CODE")?{ORG_UNIT_CODE:t.orgUnitCode}:null,expiration:"3"};return await r({resource:`trackedEntityAttributes/${e}/generate`,params:a}).then((e=>e&&e.value)).catch((t=>(S().error((0,j.px)("Could not generate unique id")({teaId:e,error:t})),null)))}function BA(e,t){const r=t[e];if(!r)return null;const n=$()().add(1,"days").unix();return r.expires>n?r:null}const $A=async(e,t,r,n)=>{if(!e)return{};const a=e.getElements().filter((e=>e.unique&&e.unique.generatable));if(a&&a.length>0){const e=a.reduce(((e,r)=>{const n=t.find((e=>e.attribute===r.id));return n?n.unique&&!n.value&&(e=[...e,r]):e=[...e,r],e}),[]);let o={};for(const t of e){const e=t.id,a=BA(e,{});if(a)o={...o,[e]:a.value};else{const t=await GA(e,r,n).then((t=>({[e]:t})));o={...o,...t}}}return o}return{}},WA=e=>Object.values(x).find((t=>t===e)),HA=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).find((e=>e.startsWith("FEATURETYPE_")))},zA=(e,t)=>{if(!t[e])return;var r;return{type:Ot(e.replace("FEATURETYPE_","").toLocaleLowerCase()),coordinates:(r=t[e],Array.isArray(r)?r:r.longitude&&r.latitude?[r.longitude,r.latitude]:void 0)}},YA="NewTeiDataEntryOpenBatch",qA=async e=>{let{foundation:t,orgUnit:r,dataEntryId:n,extraActions:a=[],generatedUniqueValuesCache:o={},formValues:i,querySingleResource:s}=e;const l=await function(e,t,r,n){if(!e)return Promise.resolve([]);const a=e.getElements().filter((e=>e.unique&&e.unique.generatable)).map((async e=>{const a=e.id,o=BA(a,t);return o?{id:a,item:o}:GA(a,r,n).then((t=>({id:a,item:{value:jA(t,e.type),expires:$()().add(3,"days").unix()}})))}));return Promise.all(a)}(t,o,{orgUnitCode:r.code},s),d=pS(n,"newTei",null,null,{...l.reduce(((e,t)=>(e[t.id]=t.item.value,e)),{}),...i});return(0,Xd.OJ)([VA(n,l.reduce(((e,t)=>(e[t.id]=t.item,e)),{})),...d,...a],YA)};function KA(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class QA extends y.Component{constructor(){super(...arguments),KA(this,"handleShowExisting",(()=>{this.props.onShowExisting()}))}static renderPrerequisitesError(){return y.createElement("div",null,n.A.t("A duplicate exists (but there were some errors, see log for details"))}static renderNoAccess(e){const t=e.toLowerCase();return y.createElement("div",null,n.A.t("An item with this {{attributeName}} is already registered, but you don't have access to it",{attributeName:t,interpolation:{escapeValue:!1}}))}static renderAttributeValueExistsUnsaved(e){const t=e.toLowerCase();return y.createElement("div",null,n.A.t("You have already registered this {{attributeName}}",{attributeName:t,interpolation:{escapeValue:!1}}))}renderDefault(e,t,r){const a=t.toLowerCase(),o=e.toLowerCase();return y.createElement(y.Fragment,null,y.createElement("div",null,n.A.t("A {{trackedEntityTypeName}} with this {{attributeName}} is already registered",{trackedEntityTypeName:a,attributeName:o,interpolation:{escapeValue:!1}})),y.createElement("div",null,y.createElement(Mg,{onClick:this.handleShowExisting,className:r},n.A.t("Show registered {{trackedEntityTypeName}}",{trackedEntityTypeName:a,interpolation:{escapeValue:!1}}))))}renderContents(){const{trackedEntityTypeName:e,attributeName:t,errorData:r,classes:n}=this.props;return e&&t?r?r.attributeValueExistsUnsaved?XA.renderAttributeValueExistsUnsaved(t):this.renderDefault(t,e,n.linkButton):XA.renderNoAccess(t):XA.renderPrerequisitesError()}render(){const{classes:e}=this.props;return y.createElement("div",{className:e.container},this.renderContents())}}const XA=(0,I.withStyles)((()=>({linkButton:{fontSize:"inherit",paddingLeft:0,paddingRight:3,backgroundColor:"inherit",textDecoration:"underline",cursor:"pointer",outline:"none"},container:{padding:2}})))(QA),JA={img:{borderRadius:"50%",objectFit:"cover"},extrasmall:{height:24,width:24},small:{height:36,width:36},medium:{height:48,width:48},large:{height:72,width:72},extralarge:{height:144,width:144}},ZA=(0,I.withStyles)(JA)((e=>{let{imageUrl:t,dataTest:r,classes:n,className:a,size:o}=e;return y.createElement("div",{className:a},y.createElement("img",{src:t,alt:"user avatar","data-test":r,className:`${n.img} ${n[o]} className`}))})),eC="SearchViaUniqueIdOnScopeProgram",tC="SearchViaUniqueIdOnScopeTrackedEntityType",rC="SearchViaAttributesOnScopeProgram",nC="SearchViaAttributesOnScopeTrackedEntityType",aC="SearchResultsLoadingView",oC="SearchResultsEmptyView",iC="SearchResultsSuccessView",sC="AddSearchResultsSuccessView",lC="SearchResultsErrorView",dC="SearchResultsTooManyView",cC="SearchResultsInitialView",uC="SaveCurrentSearchInfo",pC="StartFallbackSearch",mC="FallbackSearchTakesPlace",gC="FallbackNotEnoughAttributes",hC="FallbackWillPushToSearchDomainWithoutProgramSelected",EC="CleanSearchRelatedData",yC="CleanFallbackSearchRelatedData",vC="SearchWithEmptyUniqueValue",fC="NavigateToNewTrackedEntityPage",IC=e=>{let{trackedEntityTypeId:t,formId:r}=e;return l(tC)({trackedEntityTypeId:t,formId:r})},bC=e=>{let{trackedEntityTypeId:t,formId:r,page:n=1,pageSize:a,triggeredFrom:o}=e;return l(nC)({trackedEntityTypeId:t,formId:r,page:n,pageSize:a,triggeredFrom:o})},SC=e=>{let{programId:t,formId:r,page:n=1,pageSize:a,triggeredFrom:o}=e;return l(rC)({programId:t,formId:r,page:n,pageSize:a,triggeredFrom:o})},TC=()=>l(lC)(),AC=()=>l(aC)(),CC=()=>l(oC)(),OC=(e,t)=>l(iC)({searchResults:e,currentPage:t}),NC=e=>{let{searchableFields:t,minAttributesRequiredToSearch:r}=e;return l(gC)({searchableFields:t,minAttributesRequiredToSearch:r})},RC=()=>l(fC)(),wC="INITIAL",_C="LOADING",PC="NO_RESULTS",kC="SHOW_RESULTS",DC="ERROR",UC="TOO_MANY_RESULTS",LC="NOT_ENOUGH_ATTRIBUTES",FC="UNIQUE_SEARCH_VALUE_EMPTY",xC={searchStatus:wC,searchResults:[],currentPage:0,currentSearchInfo:{},keptFallbackSearchFormValues:{},otherCurrentPage:0},MC=rc({[cC]:e=>({...e,searchStatus:wC}),[iC]:(e,t)=>{let{payload:{searchResults:r,currentPage:n}}=t;return{...e,searchStatus:kC,searchResults:r,currentPage:n}},[sC]:(e,t)=>{let{payload:{otherResults:r,otherCurrentPage:n}}=t;return{...e,searchStatus:kC,otherResults:r,otherCurrentPage:n}},[aC]:e=>({...e,searchStatus:_C}),[oC]:e=>({...e,searchStatus:PC}),[lC]:e=>({...e,searchStatus:DC}),[dC]:e=>({...e,searchStatus:UC}),[gC]:(e,t)=>{let{payload:r}=t;return{...e,searchStatus:LC,searchableFields:r.searchableFields,minAttributesRequiredToSearch:r.minAttributesRequiredToSearch}},[uC]:(e,t)=>{let{payload:{searchScopeType:r,searchScopeId:n,formId:a,currentSearchTerms:o}}=t;return{...e,currentSearchInfo:{searchScopeType:r,searchScopeId:n,formId:a,currentSearchTerms:o},otherResults:void 0,otherCurrentPage:0}},[mC]:(e,t)=>{let{payload:{fallbackFormValues:r,trackedEntityTypeId:n}}=t;return{...e,keptFallbackSearchFormValues:{...r,trackedEntityTypeId:n}}},[EC]:()=>xC,[yC]:e=>({...e,keptFallbackSearchFormValues:{}}),[vC]:(e,t)=>{let{payload:r}=t;return{...e,searchStatus:FC,currentSearchInfo:{uniqueTEAName:r.uniqueTEAName}}}},"searchDomain",xC);var VC=r(36356);const jC="PROGRAM",GC="TRACKED_ENTITY_TYPE",BC="ALL_PROGRAMS",$C="PAGINATION",WC=(0,y.createContext)({resultsPageSize:5}),HC=(0,I.withStyles)((()=>({searchDomainsContainer:{display:"flex",flexDirection:"column",gap:yn.Q.dp16},searchRow:{display:"flex",alignItems:"center",justifyContent:"center"},searchRowSelectElement:{width:"100%"},searchButtonContainer:{padding:yn.Q.dp8,display:"flex",alignItems:"center"},textInfo:{textAlign:"right",fontSize:"14px",flexGrow:1,color:vn.T.grey700},textError:{textAlign:"right",fontSize:"14px",fontWeight:500,flexGrow:1,color:vn.T.red600}})))((e=>{let{searchViaUniqueIdOnScopeTrackedEntityType:t,searchViaUniqueIdOnScopeProgram:r,searchViaAttributesOnScopeProgram:a,searchViaAttributesOnScopeTrackedEntityType:o,saveCurrentFormData:i,addFormIdToReduxStore:s,removeFormDataFromReduxStore:l,selectedSearchScopeId:d,searchGroupsForSelectedScope:c,classes:u,formsValues:p,searchStatus:m,isSearchViaAttributesValid:g,isSearchViaUniqueIdValid:h,showUniqueSearchValueEmptyModal:E,keptFallbackSearchFormValues:v,fallbackTriggered:f}=e;const{resultsPageSize:I}=(0,y.useContext)(WC);((e,t,r,n)=>{(0,y.useEffect)((()=>(e.forEach((e=>{let{formId:r,searchForm:a}=e;const o=[...a.getElements().values()].reduce(((e,t)=>{let{id:r}=t;if(Object.keys(n).includes(r)){const t=n[r];return{...e,[r]:t}}return e}),{});t(r,o)})),()=>r())),[n,e,t,r])})(c,s,l,v);const[b,S]=(0,y.useState)(!1),[T,A]=(0,y.useState)(null);return(0,y.useEffect)((()=>{A(null)}),[d]),(0,y.useEffect)((()=>{f?((e,t,r)=>{e.filter((e=>!e.unique)).forEach(((e,n)=>{let{formId:a}=e;t||0!==n||r(a)}))})(c,T,A):((e,t,r)=>{e.forEach(((e,n)=>{let{formId:a}=e;t||0!==n||r(a)}))})(c,T,A)}),[f,c,T]),(0,y.useMemo)((()=>{const e={},s={},l=e=>{let{minAttributesRequiredToSearch:t}=e;return y.createElement("div",{className:b?u.textError:u.textInfo},n.A.t("Fill in at least {{count}} attribute to search",{count:t,defaultValue:"Fill in at least {{count}} attribute to search",defaultValue_plural:"Fill in at least {{count}} attributes to search"}))};return y.createElement("div",{tabIndex:-1,onKeyPress:e=>{if("Enter"===e.key&&T&&d){const e=s[T].children[0];e.focus(),setTimeout((()=>{e.click()}))}},role:"none",className:u.searchDomainsContainer},c.filter((e=>e.unique)).map((a=>{let{searchForm:o,formId:i,searchScope:l}=a;const c=!(T===i),p=o.getElements()[0].formName;return y.createElement("div",{key:i,"data-test":"form-unique"},y.createElement(kc,{isCollapsed:c,header:y.createElement(Lc,{containerStyle:{alignItems:"center"},title:n.A.t("Search {{name}}",{name:p,interpolation:{escapeValue:!1}}),titleStyle:{background:"transparent",paddingTop:8,fontSize:16},onChangeCollapseState:()=>{A(i)},isCollapseButtonEnabled:c,isCollapsed:c,extendedCollapsibility:!0})},y.createElement("div",{className:u.searchRow},y.createElement("div",{className:u.searchRowSelectElement},y.createElement(Fy,{formRef:t=>{e[i]=t},formFoundation:o,id:i}))),y.createElement("div",{className:u.searchButtonContainer,ref:e=>{s[i]=e}},y.createElement(ra.$,{disabled:m===_C,onClick:()=>d&&((n,a,o,i)=>{if(h(o)){if(e[o].validateFormScrollToFirstFailedField({}))switch(n){case jC:r({programId:a,formId:o});break;case GC:t({trackedEntityTypeId:a,formId:o})}}else E({uniqueTEAName:i})})(l,d,i,p)},n.A.t("Search by {{name}}",{name:p,interpolation:{escapeValue:!1}})))))})),c.filter((e=>!e.unique)).map((t=>{let{searchForm:r,formId:h,searchScope:E,minAttributesRequiredToSearch:v}=t;const f=n.A.t("Search by attributes"),b=!(T===h);return y.createElement("div",{key:h,"data-test":"form-attributes"},y.createElement(kc,{isCollapsed:b,header:y.createElement(Lc,{containerStyle:{alignItems:"center"},titleStyle:{background:"transparent",paddingTop:8,fontSize:16},title:f,onChangeCollapseState:()=>{A(h)},isCollapseButtonEnabled:b,isCollapsed:b,extendedCollapsibility:!0})},y.createElement("div",{className:u.searchRow},y.createElement("div",{className:u.searchRowSelectElement},y.createElement(Fy,{formRef:t=>{e[h]=t},formFoundation:r,id:h}))),y.createElement("div",{className:u.searchButtonContainer,ref:e=>{s[h]=e}},y.createElement(ra.$,{disabled:m===_C,onClick:()=>d&&((e,t,r,n)=>{if(g(n,r))switch(S(!1),i({searchScopeType:e,searchScopeId:t,formId:r,formsValues:p,searchGroupsForSelectedScope:c}),e){case jC:a({programId:t,formId:r,resultsPageSize:I});break;case GC:o({trackedEntityTypeId:t,formId:r,resultsPageSize:I})}else S(!0)})(E,d,h,v)},f),y.createElement(l,{minAttributesRequiredToSearch:v}))))})))}),[u.searchButtonContainer,u.searchDomainsContainer,u.searchRowSelectElement,u.searchRow,u.textInfo,u.textError,d,m,t,r,a,o,c,g,h,E,i,p,I,b,T])})),zC=e=>{if(!e)return!1;if((0,VC.Kg)(e))return Boolean(e.replace(/\s/g,"").length);if((0,VC.Gv)(e)){const t=Object.values(e).filter((e=>(0,VC.Kg)(e))).filter((e=>Boolean(e.replace(/\s/g,"").length))).length;return Boolean(t===Object.keys(e).length)}return!0},YC=(e,t)=>{const{searchForm:r,formId:n}=e.reduce(((e,t)=>t.unique?e:{accumulated:e,...t}),{}),a=t[n]||{};return Object.keys(a).reduce(((e,t)=>{const{name:n,id:o,type:i}=r.getElement(t),s=a[t];return zC(s)?[...e,{name:n,value:s,id:o,type:i}]:e}),[])},qC=(0,gs.Ng)(((e,t)=>{let{searchGroupsForSelectedScope:r}=t;const{formsValues:n,searchDomain:{searchStatus:a,keptFallbackSearchFormValues:o}}=e;return{keptFallbackSearchFormValues:o,formsValues:n,searchStatus:a,isSearchViaAttributesValid:e=>{const t=YC(r,n);return Object.values(t).length>=e},isSearchViaUniqueIdValid:e=>{const t=n[e]||{};return Object.values(t).some((e=>zC(e)))}}}),((e,t)=>{let{searchGroupsForSelectedScope:r}=t;return{searchViaUniqueIdOnScopeTrackedEntityType:t=>{let{trackedEntityTypeId:r,formId:n}=t;e(IC({trackedEntityTypeId:r,formId:n}))},searchViaUniqueIdOnScopeProgram:t=>{let{programId:r,formId:n}=t;e((e=>{let{programId:t,formId:r}=e;return l(eC)({programId:t,formId:r})})({programId:r,formId:n}))},searchViaAttributesOnScopeTrackedEntityType:t=>{let{trackedEntityTypeId:r,formId:n,resultsPageSize:a}=t;e(bC({trackedEntityTypeId:r,formId:n,pageSize:a}))},searchViaAttributesOnScopeProgram:t=>{let{programId:r,formId:n,resultsPageSize:a}=t;e(SC({programId:r,formId:n,pageSize:a}))},saveCurrentFormData:t=>{let{searchScopeType:n,searchScopeId:a,formId:o,formsValues:i}=t;const s=YC(r,i);e((e=>{let{searchScopeType:t,searchScopeId:r,formId:n,currentSearchTerms:a}=e;return l(uC)({searchScopeType:t,searchScopeId:r,formId:n,currentSearchTerms:a})})({searchScopeType:n,searchScopeId:a,formId:o,currentSearchTerms:s}))},addFormIdToReduxStore:(t,r)=>{e(My(t,r))},removeFormDataFromReduxStore:()=>{r.forEach((t=>{let{formId:r}=t;e(function(e){return l(xy.FORM_DATA_REMOVE)({formId:e})}(r))}))},showUniqueSearchValueEmptyModal:t=>{let{uniqueTEAName:r}=t;e((e=>{let{uniqueTEAName:t}=e;return l(vC)({uniqueTEAName:t})})({uniqueTEAName:r}))}}}))(HC);var KC=r(64865),QC=r(75114),XC=r(82635),JC=r(21884),ZC=r(32094),eO=r(54375),tO=r(21353);const rO={[it.CO.IMAGE]:e=>{let{teiId:t,attributeId:r,absoluteApiPath:n,programId:a}=e;const o=(0,j.UR)(j.Gv.trackerImageEndpoint)?`${n}/tracker/trackedEntities/${t}/attributes/${r}/image?dimension=small`:`${n}/trackedEntityInstances/${t}/${r}/image?dimension=SMALL`,i=a?`${o}&program=${a}`:o;return{previewUrl:i,url:i}},[it.CO.FILE_RESOURCE]:e=>{let{value:t,teiId:r,attributeId:n,absoluteApiPath:a,querySingleResource:o,programId:i}=e;return o({resource:`fileResources/${t}`}).then((e=>{const t=(0,j.UR)(j.Gv.trackerFileEndpoint)?`${a}/tracker/trackedEntities/${r}/attributes/${n}/file`:`${a}/trackedEntityInstances/${r}/${n}/file`,o=i?`${t}?program=${i}`:t;return{name:e.name,url:o}})).catch((e=>(S().warn((0,j.px)("Could not get subvalue")({value:t,teiId:r,attributeId:n,error:e})),null)))}};async function nO(e,t,r,n,a){const o=(i=e.attributes)?i.reduce(((e,t)=>(e[t.attribute]=t.value,e)),{}):i;var i;const s=(0,it.Li)(o,t,Et);return await async function(e){let{teiId:t,attributes:r,values:n,absoluteApiPath:a,querySingleResource:o,programId:i}=e;if(!n)return null;const s=r.toHashMap("id");return Object.keys(n).reduce((async(e,r)=>{const l=await e,d=n[r],c=s[r];if((0,Q.A)(d)&&c){const e=rO[c.type];if(e){const n=await e({value:d,teiId:t,attributeId:r,absoluteApiPath:a,querySingleResource:o,programId:i});l[r]=n}}return l}),Promise.resolve(n))}({teiId:e.trackedEntity,attributes:t,values:s,absoluteApiPath:r,querySingleResource:n,programId:a}),{id:e.trackedEntity,tei:e,values:s}}async function aO(e,t,r,n,a){const o=await n({resource:"tracker/trackedEntities",params:e}),i=L(U.trackedEntities,o);return{trackedEntityInstanceContainers:await i.reduce((async(e,o)=>{const i=await e,s=await nO(o,t,r,n,a);return s&&i.push(s),i}),Promise.resolve([])),pagingData:{rowsPerPage:e.pageSize,currentPage:e.page}}}const oO=Object.freeze({NAVIGATE_TO_ENROLLMENT_OVERVIEW:"enrollmentNavigation.navigateToEnrollmentOverview"}),iO=e=>{let{teiId:t,programId:r,orgUnitId:n,enrollmentId:a}=e;return l(oO.NAVIGATE_TO_ENROLLMENT_OVERVIEW)({teiId:t,programId:r,orgUnitId:n,enrollmentId:a})},sO=e=>e.optionSet&&e.type!==it.CO.MULTI_TEXT?"eq":"like",lO=(e,t)=>{const r=e.trim(),n=t.convertValue(r,(0,j.Fs)(Mi,_i));return`${t.id}:${sO(t)}:${$i(n)}`},dO=(e,t)=>{const{from:r,to:n}=e,a=r&&t.convertValue(r,(0,j.Fs)(Mi,_i)),o=n&&t.convertValue(n,(0,j.Fs)(Mi,_i));return r||n?`${t.id}${a?`:ge:${a}`:""}${o?`:le:${o}`:""}`:null},cO=(e,t)=>{const r=t.convertValue(e,(0,j.Fs)(Mi,_i));return`${t.id}:${sO(t)}:${$i(r)}`},uO=(e,t)=>{const r=t.convertValue(e,(0,j.Fs)(Mi,_i));return`${t.id}:eq:${r}`},pO=()=>null,mO={TEXT:lO,MULTI_TEXT:lO,LONG_TEXT:lO,NUMBER:dO,NUMBER_RANGE:dO,INTEGER:dO,INTEGER_RANGE:dO,INTEGER_POSITIVE:dO,INTEGER_POSITIVE_RANGE:dO,INTEGER_NEGATIVE:dO,INTEGER_NEGATIVE_RANGE:dO,INTEGER_ZERO_OR_POSITIVE:dO,INTEGER_ZERO_OR_POSITIVE_RANGE:dO,PERCENTAGE:lO,DATE:dO,DATE_RANGE:dO,DATETIME:dO,DATETIME_RANGE:pO,TIME:dO,TIME_RANGE:dO,TRUE_ONLY:uO,BOOLEAN:uO,PHONE_NUMBER:lO,EMAIL:lO,FILE_RESOURCE:cO,URL:lO,ORGANISATION_UNIT:(e,t)=>{const r=t.convertValue(e,(0,j.Fs)(Mi,_i));return`${t.id}:${sO(t)}:${r}`},IMAGE:cO,AGE:(e,t)=>{const r=e&&t.convertValue(e,(0,j.Fs)(Mi,_i));return`${t.id}:eq:${r}`},COORDINATE:pO,POLYGON:pO,STATUS:pO,USERNAME:lO,ASSIGNEE:lO,UNKNOWN:pO},gO=e=>{const t=Object.keys(e)[0];return[`${t}:eq:${$i(e[t])}`]},hO=e=>{let{queryArgs:t,attributes:r,programId:n,absoluteApiPath:a,querySingleResource:o,formId:i,programTETId:s}=e;return(0,ZC.H)(aO(t,r,a,o,n)).pipe((0,KC.q)((e=>{let{trackedEntityInstanceContainers:r}=e;const a=r;if(0===a.length&&t.program)return(0,eO.of)(IC({trackedEntityTypeId:s,formId:i}));if(a.length>0){const{id:e,tei:{orgUnit:t,enrollments:r}}=a[0],o=1!==(null===r||void 0===r?void 0:r.length)||n?n:r[0].program;return(0,eO.of)(iO({teiId:e,orgUnitId:t,programId:o}))}return(0,eO.of)(CC())})),(0,QC.Z)(AC()),(0,XC.W)((()=>(0,eO.of)(TC()))))},EO=(e,t)=>Object.keys(e).filter((t=>e[t])).filter((t=>"string"!==typeof e[t]||e[t].trim().length>0)).map((r=>{const n=t.find((e=>e.id===r));if(e[r]&&n){const t=it.CO[n.type];return mO[t](e[r],n)}return null})),yO=e=>{let{httpStatusCode:t,message:r}=e;return 409===t&&"maxteicountreached"===r?(0,eO.of)(l(dC)()):(0,eO.of)(TC())},vO=e=>{let{queryArgs:t,attributes:r,triggeredFrom:n,absoluteApiPath:a,querySingleResource:o,programId:i}=e;return(0,ZC.H)(aO(t,r,a,o,i)).pipe((0,s.T)((e=>{let{trackedEntityInstanceContainers:t,pagingData:r}=e;return t.length>0?OC(t,r.currentPage):0===t.length&&n===$C?OC([],r.currentPage):OC(t,1)})),(0,QC.Z)(AC()),(0,XC.W)(yO))},fO="OnUrlSetTrackedEntityTypeId";var IO=r(79556),bO=r(54572);const SO=(0,fp.default)((e=>{let{typography:t}=e;return{searchRow:{maxWidth:t.pxToRem(400),display:"flex",flexDirection:"column",justifyContent:"start",marginBottom:yn.Q.dp8},searchRowSelectElement:{width:"100%"},informativeIcon:{marginLeft:8},customEmpty:{textAlign:"center",padding:"8px 24px"}}}))((e=>{let{classes:t,onSelect:r,onSetTrackedEntityTypeIdOnUrl:a,accessNeeded:o,headerText:i,footerText:s}=e;const l=ls(),d=hs();return y.createElement(y.Fragment,null,y.createElement("div",{className:t.searchRow},y.createElement("div",{className:t.searchRowSelectElement},y.createElement(IO.l,{label:i,onChange:e=>{let{selected:t}=e;r(t,it.m2.TRACKED_ENTITY_TYPE),a({trackedEntityTypeId:t})},selected:d,empty:y.createElement("div",{className:t.customEmpty},n.A.t("No tracked entity types available"))},(0,y.useMemo)((()=>Object.values(l).filter((e=>{let{trackedEntityTypeAccess:t}=e;return"write"===o?t&&t.data&&t.data.write:"read"===o&&(t&&t.data&&t.data.read)})).map((e=>{let{trackedEntityTypeName:t,trackedEntityTypeId:r}=e;return y.createElement(bO.e,{key:r,value:r,label:t})}))),[o,l])))),!d&&y.createElement("div",{className:t.informativeIcon},y.createElement(SS,null,s)))})),TO=e=>{let{onSelect:t,accessNeeded:r="read",headerText:n,footerText:a}=e;const o=(0,gs.wA)(),i=(0,y.useCallback)((e=>{let{trackedEntityTypeId:t}=e;o((e=>{let{trackedEntityTypeId:t}=e;return l(fO)({trackedEntityTypeId:t})})({trackedEntityTypeId:t}))}),[o]);return y.createElement(SO,{accessNeeded:r,onSelect:t,onSetTrackedEntityTypeIdOnUrl:i,headerText:n,footerText:a})},AO={display:"flex",justifyContent:"center"},CO={alignItems:"center",background:vn.T.grey200,color:vn.T.grey700,padding:"12px 16px",borderRadius:"4px"},OO=e=>{let{children:t,dataTest:r="informative-paper"}=e;return y.createElement("div",{style:AO},y.createElement("div",{style:CO,"data-test":r},t))};var NO=r(72726),RO=r(55559);function wO(){return wO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wO.apply(this,arguments)}function _O(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const PO=e=>({root:{flexShrink:0,display:"flex",color:e.palette.text.secondary}}),kO=()=>y.createElement("svg",{className:"MuiSvgIcon-root-1474",focusable:"false",viewBox:"0 0 24 24","aria-hidden":"true",role:"presentation",width:"24",height:"24",fill:"currentColor"},y.createElement("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z",fill:"currentColor"}),y.createElement("path",{fill:"none",d:"M24 24H0V0h24v24z"})),DO=()=>y.createElement("svg",{className:"MuiSvgIcon-root-280",focusable:"false",viewBox:"0 0 24 24","aria-hidden":"true",role:"presentation",width:"24",height:"24",fill:"currentColor"},y.createElement("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),y.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"})),UO=e=>class extends y.Component{constructor(){super(...arguments),_O(this,"handleFirstPageButtonClick",(()=>{this.props.onChangePage(1)})),_O(this,"handleBackButtonClick",(()=>{this.props.onChangePage(this.props.currentPage-1)})),_O(this,"handleNextButtonClick",(()=>{this.props.onChangePage(this.props.currentPage+1)}))}renderNavigationElement(){const{currentPage:e,disabled:t,classes:r,theme:n,nextPageButtonDisabled:a}=this.props;return y.createElement("div",{className:r.root},y.createElement(Bo,{dataTest:"search-pagination-first-page",onClick:this.handleFirstPageButtonClick,disabled:t||e<=1,"aria-label":"First Page"},"rtl"===n.direction?y.createElement(DO,null):y.createElement(kO,null)),y.createElement(Bo,{dataTest:"search-pagination-previous-page",onClick:this.handleBackButtonClick,disabled:t||e<=1,"aria-label":"Previous Page"},"rtl"===n.direction?y.createElement(NO.A,null):y.createElement(RO.A,null)),y.createElement(Bo,{dataTest:"search-pagination-next-page",onClick:this.handleNextButtonClick,disabled:t||a,"aria-label":"Next Page"},"rtl"===n.direction?y.createElement(RO.A,null):y.createElement(NO.A,null)))}render(){const{classes:t,theme:r,...n}=this.props;return y.createElement(e,wO({navigationElements:this.renderNavigationElement()},n))}},LO=()=>e=>(0,I.withStyles)(PO,{withTheme:!0})(UO(e)),FO=(0,I.withStyles)((e=>({topSection:{marginTop:e.typography.pxToRem(20),marginLeft:e.typography.pxToRem(10),marginRight:e.typography.pxToRem(10),marginBottom:e.typography.pxToRem(10)}})))((e=>{let{currentSearchTerms:t,currentSearchScopeName:r,classes:a}=e;return y.createElement("div",{"data-test":"search-results-top",className:a.topSection},n.A.t("Results found")," ",r&&`${n.A.t("in")} ${r}`,t&&y.createElement("div",null,t.map(((e,t,r)=>{let{name:n,value:a,id:o,type:i}=e;return y.createElement("span",{key:o},y.createElement("i",null,n),": ",Ii(a,i),t!==r.length-1&&y.createElement("span",null,",\xa0"))}))))})),xO=LO()(Fo),MO=(0,I.withStyles)((e=>({pagination:{display:"flex",justifyContent:"flex-end",marginLeft:e.typography.pxToRem(8),width:e.typography.pxToRem(600)},bottom:{marginLeft:e.typography.pxToRem(8)},bottomText:{color:vn.T.grey800,marginTop:e.typography.pxToRem(12),marginBottom:e.typography.pxToRem(12)}})))((e=>{let{searchViaAttributesOnScopeProgram:t,searchViaAttributesOnScopeTrackedEntityType:r,startFallbackSearch:a,classes:o,searchResults:i,otherResults:s,otherCurrentPage:l,dataElements:d,currentPage:c,currentSearchScopeType:u,currentSearchScopeId:p,currentSearchScopeName:m,currentFormId:g,currentSearchTerms:h,fallbackTriggered:E,handleCreateNew:v,orgUnitId:f}=e;const{resultsPageSize:I}=(0,y.useContext)(WC),[b,S]=(0,y.useState)(!0),[T,A]=(0,y.useState)(!0),C=u===jC?p:"",{trackedEntityName:O}=es(p);return y.createElement(y.Fragment,null,y.createElement(Ib,{header:y.createElement(FO,{currentSearchTerms:h,currentSearchScopeName:m}),borderless:!0,open:b,onClose:()=>S(!1),onOpen:()=>S(!0)},y.createElement(eN,{noItemsText:n.A.t("No results found"),currentSearchScopeName:m,currentSearchScopeType:u,currentProgramId:C,items:i,dataElements:d,renderCustomCardActions:e=>{let{item:t,enrollmentType:r,programName:n}=e;return y.createElement(rN,{programName:n,currentSearchScopeId:p,currentSearchScopeType:u,id:t.id,orgUnitId:f,enrollmentType:r})}}),y.createElement("div",{className:o.pagination},y.createElement(xO,{nextPageButtonDisabled:i.length<I,onChangePage:e=>(e=>{switch(u){case jC:t({programId:p,formId:g,page:e,resultsPageSize:I});break;case GC:r({trackedEntityTypeId:p,formId:g,page:e,resultsPageSize:I})}})(e),currentPage:c}))),void 0!==s&&y.createElement(Ib,{header:y.createElement(FO,{currentSearchScopeName:n.A.t("all programs")}),borderless:!0,open:T,onClose:()=>A(!1),onOpen:()=>A(!0)},y.createElement(eN,{noItemsText:n.A.t("No results found"),currentSearchScopeName:m,currentSearchScopeType:BC,items:s,dataElements:d,renderCustomCardActions:e=>{let{item:t,enrollmentType:r,currentSearchScopeType:n,programName:a}=e;return y.createElement(rN,{programName:a,currentSearchScopeType:n,currentSearchScopeId:p,id:t.id,orgUnitId:f,enrollmentType:r})}}),y.createElement("div",{className:o.pagination},y.createElement(xO,{nextPageButtonDisabled:s.length<I,onChangePage:e=>{a({programId:p,formId:g,resultsPageSize:I,page:e})},currentPage:l}))),u===jC&&!E&&void 0===s&&y.createElement("div",{className:o.bottom},y.createElement("div",{className:o.bottomText},n.A.t("Not finding the results you were looking for? Try to search all programs that use type "),'"',O,'".'),y.createElement(ra.$,{onClick:()=>{a({programId:p,formId:g,resultsPageSize:I})},dataTest:"fallback-search-button"},n.A.t("Search in all programs"))),y.createElement("div",{className:o.bottom},y.createElement("div",{className:o.bottomText},n.A.t("If none of search results match, you can create a new "),'"',O,'".'),y.createElement(ra.$,{onClick:v,dataTest:"create-new-button"},n.A.t("Create new"))))}));var VO=r(60196);const jO=(0,qd.compose)((0,gs.Ng)((e=>{const{searchResults:t,otherResults:r,otherCurrentPage:n,currentPage:a,currentSearchInfo:{searchScopeType:o,searchScopeId:i,formId:s,currentSearchTerms:l}}=e.searchDomain,d=(u=o,(c=i)?u===jC?(0,VO.x6)(c):u===GC?(0,VO.mu)(c):null:null);var c,u;const p=(e=>e?e.name:"")(d),m=(e=>e?[...e.attributes.values()]:[])(d),g=m.filter((e=>{let{displayInReports:t}=e;return t})).map((e=>{let{id:t,name:r,type:n}=e;return{id:t,name:r,type:n}})),{orgUnitId:h}=e.currentSelections;return{currentPage:a,searchResults:t,otherResults:r,otherCurrentPage:n,currentSearchScopeType:o,currentSearchScopeId:i,currentSearchScopeName:p,currentFormId:s,currentSearchTerms:l,dataElements:g,orgUnitId:h}}),((e,t)=>{let{availableSearchOptions:r}=t;return{searchViaAttributesOnScopeTrackedEntityType:t=>{let{trackedEntityTypeId:r,formId:n,page:a,resultsPageSize:o}=t;e(bC({trackedEntityTypeId:r,formId:n,page:a,pageSize:o,triggeredFrom:$C}))},searchViaAttributesOnScopeProgram:t=>{let{programId:r,formId:n,page:a,resultsPageSize:o}=t;e(SC({programId:r,formId:n,page:a,pageSize:o,triggeredFrom:$C}))},startFallbackSearch:t=>{let{programId:n,formId:a,resultsPageSize:o,page:i}=t;e((e=>{let{programId:t,formId:r,page:n=1,pageSize:a,availableSearchOptions:o}=e;return l(pC)({programId:t,formId:r,page:n,pageSize:a,availableSearchOptions:o})})({programId:n,formId:a,availableSearchOptions:r,pageSize:o,page:i}))},handleCreateNew:()=>{e(RC())}}})))(MO),GO=e=>{var t;let{minAttributesRequiredToSearch:r,searchableFields:a}=e;const o=null===a||void 0===a||null===(t=a.map((e=>e.formName)))||void 0===t?void 0:t.join(", ");return r===a.length&&a.length>1?n.A.t("Fill in these fields to search{{escape}} {{ searchableAttributes }}",{escape:":",searchableAttributes:o,interpolation:{escapeValue:!1}}):a.length>1?n.A.t("Fill in at least {{minAttributesRequiredToSearch}} of these fields to search{{escape}} {{searchableAttributes}}",{escape:":",minAttributesRequiredToSearch:r,searchableAttributes:o,interpolation:{escapeValue:!1}}):n.A.t("Fill in this field to search{{escape}} {{searchableAttributes}}",{escape:":",searchableAttributes:o,interpolation:{escapeValue:!1}})},BO=(0,qd.compose)((0,fp.default)((e=>({informativeMessage:{marginLeft:e.typography.pxToRem(10),marginTop:e.typography.pxToRem(20),marginBottom:e.typography.pxToRem(28),marginRight:e.typography.pxToRem(10)},loadingMask:{display:"flex",justifyContent:"center"}}))))((e=>{let{searchStatus:t,availableSearchOption:r,minAttributesRequiredToSearch:a,searchableFields:o,navigateToRegisterTrackedEntity:i,showInitialSearchBox:s,fallbackTriggered:l,uniqueTEAName:d="",trackedEntityName:c,classes:u}=e;return t===kC?y.createElement(jO,{availableSearchOption:r,fallbackTriggered:l}):t===PC?y.createElement(N.a,{position:"middle"},y.createElement(Ip.w,null,n.A.t("No results found")),y.createElement(R.$,null,n.A.t("You can change your search terms and search again to find what you are looking for.")),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{type:"button",onClick:i},n.A.t(`Create new ${c}`)),y.createElement(ra.$,{disabled:t===_C,onClick:s,primary:!0},n.A.t("Back to search"))))):t===_C?y.createElement("div",{className:u.loadingMask},y.createElement(C.F,null)):t===DC?y.createElement("div",{"data-test":"general-purpose-error-mesage",className:u.informativeMessage},y.createElement(zm.I,{title:n.A.t("An error has occurred"),error:!0},n.A.t("There is a problem with this search, please change the search terms or try again later.For more details open the Console tab of the Developer tools "))):t===UC?y.createElement("div",{"data-test":"general-purpose-too-many-results-mesage",className:u.informativeMessage},y.createElement(zm.I,{title:n.A.t("Too many results"),warning:!0},n.A.t("This search returned too many results to show. Try changing search terms or searching by more attributes to narrow down the results."))):t===LC?y.createElement(N.a,{position:"middle"},y.createElement(Ip.w,null,n.A.t("Cannot search in all programs")),y.createElement(R.$,null,y.createElement(GO,{minAttributesRequiredToSearch:a,searchableFields:o})),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{disabled:t===_C,onClick:s,type:"button"},n.A.t("Back to search"))))):t===FC?y.createElement(N.a,{position:"middle",onClose:s},y.createElement(Ip.w,null,n.A.t("Missing search criteria")),y.createElement(R.$,null,n.A.t(`Please fill in ${d} to search`)),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{disabled:t===_C,onClick:s,primary:!0},n.A.t("Back to search"))))):null}));function $O(){return $O=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$O.apply(this,arguments)}const WO=e=>{const{uniqueTEAName:t}=(0,gs.d4)((e=>{let{searchDomain:t}=e;return{uniqueTEAName:t.currentSearchInfo.uniqueTEAName}}),gs.bN);return y.createElement(BO,$O({uniqueTEAName:t},e))},HO=(0,qd.compose)(Dp(),(0,fp.default)((()=>({half:{flex:1},title:{fontWeight:500,marginBottom:yn.Q.dp16},container:{color:vn.T.grey900},innerContainer:{display:"flex",flexWrap:"wrap",gap:yn.Q.dp16},searchFormContainer:{flex:1},emptySelectionPaperContent:{display:"flex",justifyContent:"center",alignItems:"center",paddingTop:50,paddingBottom:50}}))))((e=>{var t;let{showInitialSearchBox:r,cleanSearchRelatedInfo:a,classes:o,preselectedProgramId:i,searchStatus:s,trackedEntityTypeId:d,navigateToRegisterTrackedEntity:c,minAttributesRequiredToSearch:u,searchableFields:p}=e;const[m,g]=(0,y.useState)(i),[h,E]=(0,y.useState)(i?jC:null),{trackedEntityName:v}=es(m),f=md(m),I=(()=>{const e={fallback:!1},{state:{fallback:t}=e}=(0,T.zy)();return t})(),{searchOption:b}=(e=>{let{programId:t,trackedEntityTypeId:r}=e;const{locale:n}=us(),a=(0,y.useMemo)((()=>t?ps:r?ms:null),[t,r]),{program:o}=Ji(t,{enabled:!(a!==ps||!t)}),{trackedEntityType:i}=cs(r,{enabled:!(a!==ms||!r)}),s=null!==o&&void 0!==o?o:i,{id:l,displayName:d}=null!==s&&void 0!==s?s:{},{data:c,isLoading:u,isError:p,error:m}=ri(["searchGroup",l],(()=>ss(s,n)),{enabled:!!(l&&n&&s),select:e=>{if(d&&e&&a)return ds(l,d,e,a)}});return{searchOption:c,isLoading:u,isError:p,error:m}})({programId:i,trackedEntityTypeId:d});(0,y.useEffect)((()=>{g(i||d);E(i?jC:null)}),[d,i]),(0,y.useEffect)((()=>(I||(l(yC)(),r()),()=>{if(I)return a()})),[I,a,i,r]);const S=null!==(t=null===b||void 0===b?void 0:b.searchGroups)&&void 0!==t?t:[];return y.createElement(y.Fragment,null,y.createElement("div",{"data-test":"search-page-content",className:o.container},y.createElement("div",{className:o.innerContainer},y.createElement("div",{className:o.searchFormContainer},y.createElement("div",{className:o.title},n.A.t("Search for {{titleText}}",{titleText:f,interpolation:{escapeValue:!1}})),y.createElement("div",null,y.createElement("div",{className:o.half},h!==jC&&y.createElement(TO,{onSelect:(e,t)=>{r(),a(),g(e),E(t)},headerText:n.A.t("Search for"),footerText:n.A.t("You can also choose a program from the top bar and search in that program")}),S&&y.createElement(qC,{fallbackTriggered:I,selectedSearchScopeId:m,searchGroupsForSelectedScope:S}),y.createElement(WO,{searchStatus:s,availableSearchOption:b,minAttributesRequiredToSearch:u,searchableFields:p,navigateToRegisterTrackedEntity:c,showInitialSearchBox:r,fallbackTriggered:I,trackedEntityName:v})))))),s===wC&&!m&&y.createElement(OO,null,n.A.t("Choose a type to start searching")))})),zO=e=>{let{programId:t}=e;const r=(0,gs.wA)(),n=hs(),a=(e=>{const t=ls();return(0,y.useMemo)((()=>{const{programId:r}=Object.values(t).map((t=>{let{programs:r}=t;return r.find((t=>{let{programId:r}=t;return r===e}))})).filter((e=>e))[0]||{};return r}),[e,t])})(t),o=(0,y.useCallback)((()=>{r(l(cC)())}),[r]),i=(0,y.useCallback)((()=>{r(l(EC)())}),[r]),s=(0,y.useCallback)((()=>{r(RC())}),[r]),{searchStatus:d,searchableFields:c,minAttributesRequiredToSearch:u}=(0,gs.d4)((e=>{let{searchDomain:t}=e;return{searchStatus:t.searchStatus,searchableFields:t.searchableFields,minAttributesRequiredToSearch:t.minAttributesRequiredToSearch}}),gs.bN);return y.createElement(WC.Provider,{value:{resultsPageSize:5}},y.createElement(HO,{showInitialSearchBox:o,cleanSearchRelatedInfo:i,navigateToRegisterTrackedEntity:s,preselectedProgramId:a,trackedEntityTypeId:n,searchStatus:d,minAttributesRequiredToSearch:u,searchableFields:c,ready:d}))},YO={ACTIVE:"ACTIVE",COMPLETED:"COMPLETED",CANCELLED:"CANCELLED",DONT_SHOW_TAG:"DONT_SHOW_TAG"},qO="SHOW_VIEW_ACTIVE_ENROLLMENT_BUTTON",KO="SHOW_RE_ENROLLMENT_BUTTON",QO="DONT_SHOW_BUTTON",XO=(0,I.withStyles)((e=>({elementName:{fontSize:e.typography.pxToRem(13),color:vn.T.grey700},elementValue:{fontSize:e.typography.pxToRem(14),color:vn.T.grey900,fontWeight:500},entry:{paddingBottom:e.typography.pxToRem(4)}})))((e=>{let{name:t,value:r,classes:n,type:a=it.CO.TEXT}=e;return r?y.createElement("div",{className:n.entry},y.createElement("span",{className:n.elementName},t,":\xa0"),y.createElement("span",{className:n.elementValue},Ci(r,a))):null})),JO=(0,I.withStyles)((e=>({itemContainer:{maxWidth:e.typography.pxToRem(600),display:"flex",flexDirection:"column",margin:e.typography.pxToRem(8),padding:e.typography.pxToRem(8),borderRadius:e.typography.pxToRem(5),border:`1px solid ${vn.T.grey400}`,backgroundColor:vn.T.grey050,position:"relative"},itemDataContainer:{display:"flex"},smallerLetters:{fontSize:e.typography.pxToRem(12),color:vn.T.grey700,paddingBottom:e.typography.pxToRem(8),position:"absolute",top:e.typography.pxToRem(8),right:e.typography.pxToRem(8)},enrolled:{display:"flex",justifyContent:"flex-end",color:vn.T.grey700},itemValuesContainer:{display:"flex",flexWrap:"wrap",flexGrow:1},image:{width:e.typography.pxToRem(54),height:e.typography.pxToRem(54),marginRight:e.typography.pxToRem(8)},buttonMargin:{marginTop:e.typography.pxToRem(8)},checkIcon:{position:"relative",top:"-2px"}})))((e=>{let{item:t,classes:r,profileImageDataElement:a,renderCustomCardActions:o,dataElements:i,currentProgramId:s,currentSearchScopeName:l,currentSearchScopeType:d}=e;const c=t.tei?t.tei.enrollments:[],u=((e,t)=>{if(!t)return YO.DONT_SHOW_TAG;const r=e.filter((e=>{let{program:r}=e;return r===t})).map((e=>{let{status:t,lastUpdated:r}=e;return{status:t,lastUpdated:r}})),{ACTIVE:n,CANCELLED:a,COMPLETED:o}=YO;return r.find((e=>{let{status:t}=e;return t===n}))?n:r.find((e=>{let{status:t}=e;return t===o}))?o:r.find((e=>{let{status:t}=e;return t===a}))?a:YO.DONT_SHOW_TAG})(c,s),{orgUnitId:p,enrolledAt:m}=((e,t,r)=>{if(null===e||void 0===e||!e.length)return{};if(!r&&e.length){const{orgUnit:t,enrolledAt:r}=e[0];return{orgUnitId:t,enrolledAt:r}}const{orgUnit:n,enrolledAt:a}=e.filter((e=>{let{program:t}=e;return t===r})).filter((e=>{let{status:r}=e;return r===t})).sort(((e,t)=>$().utc(e.lastUpdated).diff($().utc(t.lastUpdated))))[0]||{};return{orgUnitId:n,enrolledAt:a}})(c,u,s),{displayName:g}=mi(p),h=c&&c.length?((e,t)=>{if(t===BC||t===jC)return(0,it.x6)(e[0].program)})(c,d):void 0,{fromServerDate:E}=(0,A.Bp)();return y.createElement("div",{"data-test":"card-list-item",className:r.itemContainer},y.createElement("div",{className:r.itemDataContainer},y.createElement("div",{className:r.itemValuesContainer},(e=>{if(!e)return null;const n=t.values[e.id];return y.createElement("div",null,n&&y.createElement(ZA,{imageUrl:n.url,className:r.image,size:"medium"}))})(a),y.createElement("div",null,i.map((e=>{let{id:r,name:n,type:a}=e;return y.createElement(XO,{key:r,name:n,value:t.values[r],type:a})})),(()=>{var e,t;return d===BC?null:y.createElement(y.Fragment,null,y.createElement(XO,{name:n.A.t("Organisation unit"),value:g}),"  ",y.createElement(XO,{name:null!==(e=null===h||void 0===h||null===(t=h.enrollment)||void 0===t?void 0:t.enrollmentDateLabel)&&void 0!==e?e:n.A.t("Date of enrollment"),value:m,type:it.CO.DATE}))})()),y.createElement("div",null,y.createElement("div",{className:r.enrolled},(()=>{switch(u){case YO.ACTIVE:return y.createElement(Mt.v,{dataTest:"dhis2-uicore-tag",positive:!0,icon:y.createElement("span",{className:r.checkIcon},y.createElement(Oa.A,null))},n.A.t("Enrolled"));case YO.CANCELLED:case YO.COMPLETED:return y.createElement(Mt.v,{dataTest:"dhis2-uicore-tag",neutral:!0,icon:y.createElement("span",{className:r.checkIcon},y.createElement(Oa.A,null))},n.A.t("Previously enrolled"));default:return null}})())))),t.tei&&t.tei.updatedAt&&y.createElement("div",{className:r.smallerLetters},n.A.t("Last updated")," ",t.tei&&y.createElement(Xo.m,{content:E(t.tei.updatedAt).toLocaleString()},$()(E(t.tei.updatedAt)).fromNow())),o&&y.createElement("div",{className:r.buttonMargin},o({item:t,programName:l,programId:s,currentSearchScopeType:d,enrollmentType:u})))})),ZO=e=>e,eN=(0,I.withStyles)((e=>({noItemsContainer:{fontStyle:"italic",padding:e.typography.pxToRem(10)}})))((e=>{let{classes:t,items:r,renderCustomCardActions:n,dataElements:a,noItemsText:o,currentProgramId:i,currentSearchScopeName:s,currentSearchScopeType:l}=e;const{profileImageDataElement:d,dataElementsExceptProfileImage:c}=(0,fg.Mz)(ZO,(e=>{const t=e.find((e=>e.type===it.CO.IMAGE)),r=[...e];return t&&r.splice(r.indexOf(t),1),{dataElementsExceptProfileImage:r,profileImageDataElement:t}}))(a);return y.createElement("div",{"data-test":"search-results-list"},r&&0!==r.length?r.map((e=>y.createElement(JO,{key:e.id,item:e,currentSearchScopeType:l,currentSearchScopeName:s,currentProgramId:i,renderCustomCardActions:n,profileImageDataElement:d,dataElements:c}))):y.createElement("div",{className:t.noItemsContainer},o))})),tN=(0,I.withStyles)((e=>({buttonMargin:{"&:not(:first-child)":{marginLeft:e.typography.pxToRem(8)}}})))((e=>{let{buttonProps:t,classes:r}=e;return y.createElement(y.Fragment,null,t.map((e=>!e.hide&&y.createElement(ra.$,{small:!0,className:r.buttonMargin,dataTest:e.dataTest,onClick:e.onClick},e.label))))})),rN=e=>{let{currentSearchScopeId:t,currentSearchScopeType:r,id:a,orgUnitId:o,enrollmentType:i,programName:s}=e;const l=(0,gs.wA)(),d=(e=>{switch(e){case YO.ACTIVE:return qO;case YO.CANCELLED:case YO.COMPLETED:return KO;default:return QO}})(i),c=()=>{switch(r){case BC:case jC:l(iO({teiId:a,programId:t,orgUnitId:o}));break;case GC:l(iO({teiId:a,orgUnitId:o}))}},u=[{dataTest:"view-dashboard-button",onClick:c,label:r===BC?n.A.t("View {{programName}} dashboard",{programName:s,interpolation:{escapeValue:!1}}):n.A.t("View dashboard")},{dataTest:"view-active-enrollment-button",onClick:c,label:n.A.t("View active enrollment"),hide:d!==qO},{dataTest:"re-enrollment-button",onClick:c,label:`${n.A.t("Re-enroll")} ${s?`${n.A.t("in")} ${s}`:""}`,hide:d!==KO}];return y.createElement(tN,{buttonProps:u})},nN=(0,I.withStyles)({customDialogActions:{marginLeft:4,marginRight:4}})((e=>{let{attributeValues:t,teiId:r,dataElements:a,onCancel:o,programId:i,ExistingUniqueValueDialogActions:s,classes:l}=e;const d=[{id:r,values:t}];return y.createElement(y.Fragment,null,y.createElement(R.$,null,y.createElement(Ip.w,null,n.A.t("Registered person")),y.createElement(eN,{currentProgramId:i,items:d,dataElements:a})),y.createElement(ta.N,null,y.createElement(ra.$,{onClick:o,secondary:!0},n.A.t("Cancel")),s&&y.createElement("div",{className:l.customDialogActions},y.createElement(s,{attributeValues:t,teiId:r}))))})),aN=e=>e.programId,oN=e=>e.tetAttributesOnly,iN=e=>e.errorData.tetId,sN=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(aN,oN,iN,((e,t,r)=>{if(t){let e;try{e=(0,it.mu)(r)}catch(a){return[]}return e.attributes.filter((e=>e.displayInReports))}let n;try{n=(0,it.x6)(e)}catch(a){return[]}return n.attributes.filter((e=>e.displayInReports))})),t=(0,fg.Mz)(((e,t)=>t),(e=>e.attributeValues),((e,t)=>e.reduce(((e,r)=>{const n=t[r.id];return(n||0===n||!1===n)&&(e[r.id]=r.convertValue(n,Et)),e}),{})));return(r,n)=>{const a=e(n),o=t(n,a);return{programId:r.newRelationshipRegisterTei.programId,dataElements:a,attributeValues:o}}}),(()=>({})),((e,t,r)=>{const{programId:n,tetAttributesOnly:a,errorData:o,...i}=r;return{...i,...e,...t,teiId:o.id}}))(nN);function lN(){return lN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lN.apply(this,arguments)}const dN=Dp()(sN);class cN extends y.Component{constructor(e){super(e),this.state={ready:!1,tetAttributesOnly:!1,attributeValues:null},this.requestTei()}componentWillUnmount(){this.cancelablePromise&&this.cancelablePromise.cancel()}requestTeiWithoutProgram(){const{errorData:e,querySingleResource:t}=this.props,{id:r}=e;if(r){const e=(0,j.gI)(t({resource:`tracker/trackedEntities/${r}`}));e.promise.then((e=>{const t=e&&e.attributes||[];this.setState({ready:!0,tetAttributesOnly:!0,attributeValues:t.reduce(((e,t)=>(e[t.attribute]=t.value,e)),{})})})).catch((e=>{e&&e.isCanceled||this.setState({ready:!0,tetAttributesOnly:!0,attributeValues:{}})})),this.cancelablePromise=e}}requestTeiInProgramContext(){const{errorData:e,programId:t,querySingleResource:r}=this.props,{id:n}=e;if(n){const e=(0,j.gI)(r({resource:`tracker/trackedEntities/${n}`,params:{program:t,fields:"*"}}));e.promise.then((e=>{e&&e.attributes?this.setState({ready:!0,attributeValues:e.attributes.reduce(((e,t)=>(e[t.attribute]=t.value,e)),{})}):this.requestTeiWithoutProgram()})).catch((e=>{e&&e.isCanceled||this.requestTeiWithoutProgram()})),this.cancelablePromise=e}}requestTei(){this.props.programId?this.requestTeiInProgramContext():this.requestTeiWithoutProgram()}render(){const{...e}=this.props;return y.createElement(dN,lN({},this.state,e))}}const uN=Xm(cN),pN=(0,gs.Ng)((e=>({programId:e.newRelationshipRegisterTei.programId})),(()=>({})))(uN),mN=e=>{const{open:t,...r}=e;return t?y.createElement(N.a,{hide:!t,onClose:e.onCancel},y.createElement(pN,r)):null};function gN(){return gN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gN.apply(this,arguments)}function hN(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class EN extends y.Component{constructor(e){super(e),hN(this,"openDialog",(()=>{this.setState({existingTeiDialogOpen:!0})})),hN(this,"closeDialog",(()=>{this.setState({existingTeiDialogOpen:!1})})),this.state={existingTeiDialogOpen:!1}}render(){const{attributeName:e,trackedEntityTypeName:t,...r}=this.props,{existingTeiDialogOpen:n}=this.state;return y.createElement(y.Fragment,null,y.createElement(XA,gN({onShowExisting:this.openDialog,trackedEntityTypeName:t,attributeName:e},r)),y.createElement(mN,gN({open:n,onCancel:this.closeDialog},r)))}}function yN(){return yN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yN.apply(this,arguments)}function vN(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const fN=e=>t=>class extends y.Component{constructor(t){super(t),vN(this,"postProcessErrorMessage",(t=>{let{errorMessage:r,errorType:n,errorData:a,id:o,fieldLabel:i}=t;if("unique"!==n)return r;const s=this.cache[o]||{};if(r===s.errorMessage&&a===s.errorData)return s.outputElement;const l=y.createElement(EN,{errorData:a,ExistingUniqueValueDialogActions:this.props.ExistingUniqueValueDialogActions,trackedEntityTypeName:e(this.props),attributeName:i});return this.cache[o]={errorMessage:r,errorData:a,outputElement:l},l})),this.cache={}}render(){const{ExistingUniqueValueDialogActions:e,...r}=this.props;return y.createElement(t,yN({onPostProcessErrorMessage:this.postProcessErrorMessage},r))}},IN=()=>(0,gs.d4)((e=>{let{currentSelections:{orgUnitId:t}}=e;return t})),bN="PossibleDuplicatesReview",SN="PossibleDuplicatesReviewRetrievalSuccess",TN="PossibleDuplicatesReviewRetrievalFailed",AN="PossibleDuplicatesReview.Skipped",CN="PossibleDuplicatesChangePage",ON="PossibleDuplicatesReset",NN=()=>l(TN)(),RN=(e,t)=>{const{resultsPageSize:r}=(0,y.useContext)(WC),n=(0,gs.wA)(),{scopeType:a}=es(t),o=IN();return{onReviewDuplicates:(0,y.useCallback)((()=>{n((e=>{let{pageSize:t,orgUnitId:r,selectedScopeId:n,scopeType:a,dataEntryId:o}=e;return l(bN)({pageSize:t,page:1,orgUnitId:r,selectedScopeId:n,scopeType:a,dataEntryId:o})})({pageSize:r,orgUnitId:o,selectedScopeId:t,scopeType:a,dataEntryId:e}))}),[n,o,t,a,e,r]),changePageOnReviewDuplicates:(0,y.useCallback)((i=>{n((e=>{let{pageSize:t,page:r,orgUnitId:n,selectedScopeId:a,scopeType:o,dataEntryId:i}=e;return l(CN)({page:r,pageSize:t,orgUnitId:n,selectedScopeId:a,scopeType:o,dataEntryId:i})})({page:i,pageSize:r,orgUnitId:o,selectedScopeId:t,scopeType:a,dataEntryId:e}))}),[n,o,t,a,e,r])}},wN=LO()(Fo),_N=(0,I.withStyles)((e=>({container:{display:"flex",justifyContent:"flex-end",marginLeft:e.typography.pxToRem(8),maxWidth:e.typography.pxToRem(600)}})))((e=>{let{currentPage:t,nextPageButtonDisabled:r,selectedScopeId:n,dataEntryId:a,classes:o}=e;const{changePageOnReviewDuplicates:i}=RN(a,n);return y.createElement("div",{className:o.container},y.createElement(wN,{currentPage:t,onChangePage:i,nextPageButtonDisabled:r}))})),PN=(0,gs.Ng)((e=>({currentPage:e.possibleDuplicates.currentPage})),(()=>({})))(_N),kN=(0,I.withStyles)((e=>({linkButtonContainer:{paddingTop:e.typography.pxToRem(10)},title:{margin:0,paddingLeft:e.typography.pxToRem(10)}})))((e=>{let{classes:t,dataElements:r,teis:a,selectedScopeId:o,dataEntryId:i,renderCardActions:s}=e;const{resultsPageSize:l}=(0,y.useContext)(WC);return y.createElement(y.Fragment,null,y.createElement(R.$,{"data-test":"duplicates-modal"},y.createElement(Ip.w,{className:t.title},n.A.t("Possible duplicates found")),y.createElement(eN,{noItemsText:n.A.t("No results found"),items:a,dataElements:r,renderCustomCardActions:s}),y.createElement(PN,{dataEntryId:i,selectedScopeId:o,nextPageButtonDisabled:a.length<l})))})),DN=(0,qd.compose)((0,gs.Ng)(((e,t)=>{let{possibleDuplicates:r}=e,{selectedScopeId:a}=t;return{ready:!r.isLoading,isUpdating:r.isUpdating,error:r.loadError?n.A.t("An error occurred loading possible duplicates"):null,teis:r.teis,dataElements:(o=a,(0,VO.Nn)(o).filter((e=>{let{displayInReports:t}=e;return t})).map((e=>{let{id:t,name:r,type:n}=e;return{id:t,name:r,type:n}})))};var o}),(()=>({}))),Dp((()=>({padding:"100px 0"})),null,(e=>!e.isUpdating&&e.ready)),qm())(kN);class UN extends y.Component{render(){const{open:e,onCancel:t,extraActions:r,selectedScopeId:n,dataEntryId:a,renderCardActions:o}=this.props;return e?y.createElement(N.a,{hide:!e,dataTest:"duplicates-modal",onClose:t},y.createElement(DN,{dataEntryId:a,selectedScopeId:n,renderCardActions:o}),y.createElement(ta.N,null,r)):null}}const LN=UN,FN=(e,t)=>{const r=(0,gs.wA)(),n=(0,y.useCallback)((()=>r(l(ON)())),[r]),a=(0,gs.d4)((e=>{let{possibleDuplicates:{isLoading:t,isUpdating:r,teis:n,currentPage:a}}=e;if(t||r)return null;return(null===n||void 0===n?void 0:n.length)>0||a>1})),{onReviewDuplicates:o}=RN(e,t);return{onResetPossibleDuplicates:n,hasDuplicate:a,onReviewDuplicates:o}};function xN(){return xN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xN.apply(this,arguments)}const MN=()=>e=>t=>{let{id:r,selectedScopeId:n,onSave:a,enrollmentMetadata:o,teiRegistrationMetadata:i,duplicatesReviewPageSize:s,renderDuplicatesCardActions:l,renderDuplicatesDialogActions:d,skipDuplicateCheck:c,...u}=t;const{metadata:p,passOnMetadata:m}=((e,t)=>e?{metadata:e,scopeType:it.m2.TRACKER_PROGRAM,passOnMetadata:{enrollmentMetadata:e}}:{metadata:t,scopeType:it.m2.TRACKED_ENTITY_TYPE,passOnMetadata:{teiRegistrationMetadata:t}})(o,i),{hasDuplicate:g,onResetPossibleDuplicates:h,onReviewDuplicates:E}=FN(r,n),{handleSaveAttempt:v,duplicatesVisible:f,closeDuplicates:I}=(e=>{let{onSave:t,hasDuplicate:r,onResetPossibleDuplicates:n,onReviewDuplicates:a,searchGroup:o,duplicatesReviewPageSize:i}=e;const[s,l]=(0,y.useState)(!1),d=(0,y.useRef)();return(0,y.useEffect)((()=>n),[n]),(0,y.useEffect)((()=>{r&&l(!0),!1===r&&(l(!1),d.current&&d.current())}),[r]),{handleSaveAttempt:(0,y.useCallback)((()=>{o?(d.current=t,a(i)):t()}),[o,t,i,a]),duplicatesVisible:s,closeDuplicates:()=>{l(!1)}}})({onSave:a,hasDuplicate:g,onResetPossibleDuplicates:h,onReviewDuplicates:E,searchGroup:(null===p||void 0===p?void 0:p.inputSearchGroups)&&p.inputSearchGroups[0],duplicatesReviewPageSize:s}),b=(0,y.useMemo)((()=>d&&d(I,a)),[d,I,a]);return y.createElement(y.Fragment,null,y.createElement(e,xN({},u,m,{onSave:c?a:v,id:r,selectedScopeId:n})),y.createElement(LN,{dataEntryId:r,selectedScopeId:n,open:f,onCancel:I,renderCardActions:l,extraActions:b}))};function VN(){return VN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},VN.apply(this,arguments)}const jN=(0,qd.compose)(fN((e=>{let{enrollmentMetadata:t}=e;return t.trackedEntityType.name})),Dp((()=>({height:"350px"}))),MN(),ub({onGetFormFoundation:e=>{let{enrollmentMetadata:t}=e;return t&&t.enrollmentForm},onIsCompleting:()=>!0}),(0,I.withStyles)((()=>({actions:{display:"flex",gap:yn.Q.dp8}}))))((e=>{let{id:t,selectedScopeId:r,formId:a,formFoundation:o,enrollmentMetadata:i,saveButtonText:s,classes:l,onSave:d,onCancel:c,onPostProcessErrorMessage:u,orgUnitId:p,orgUnit:m,teiId:g,isUserInteractionInProgress:h,isSavingInProgress:E,...v}=e;const[f,I]=(0,y.useState)(!1),{scopeType:b,trackedEntityName:S,programName:T}=es(r);return y.createElement(y.Fragment,null,b===it.m2.TRACKER_PROGRAM&&a&&m&&y.createElement(y.Fragment,null,y.createElement(SA,VN({teiId:g,orgUnit:m,programId:r,formFoundation:o,enrollmentMetadata:i,id:t,onPostProcessErrorMessage:u,onGetUnsavedAttributeValues:()=>console.log("onGetUnsavedAttributeValues will be here in the future"),onUpdateField:()=>console.log("onUpdateField will be here in the future"),onStartAsyncUpdateField:()=>console.log("onStartAsyncUpdateField will be here in the future")},v)),y.createElement("div",{className:l.actions},d&&y.createElement(ra.$,{dataTest:"create-and-link-button",primary:!0,onClick:()=>d(),loading:E},s),y.createElement(ra.$,{dataTest:"cancel-button",secondary:!0,onClick:()=>{h?I(!0):c()},disabled:E},n.A.t("Cancel"))),y.createElement(SS,null,((e,t,r,a)=>a?y.createElement("span",null,n.A.t("Saving a new enrollment in {{programName}} in {{orgUnitName}}.",{programName:t,orgUnitName:r,interpolation:{escapeValue:!1}})):y.createElement("span",null,n.A.t("Saving a {{trackedEntityName}} in {{programName}} in {{orgUnitName}}.",{trackedEntityName:e,programName:t,orgUnitName:r,interpolation:{escapeValue:!1}})))(S.toLowerCase(),T,m.name,g))),y.createElement(Rf,VN({},wf,{onDestroy:c,open:!!f,onCancel:()=>{I(!1)}})))})),GN=async(e,t)=>{const{id:r,displayName:n}=await t({resource:"fileResources",id:e});return{id:r,name:n}},BN={[it.CO.FILE_RESOURCE]:GN,[it.CO.IMAGE]:GN,[it.CO.ORGANISATION_UNIT]:async(e,t)=>(await pi([e],t))[e]},$N=e=>{let{program:t,trackedEntityInstanceAttributes:r,orgUnit:n,formFoundation:a,teiId:o,searchTerms:i}=e;const s=((e,t)=>{const r=(0,A.ow)(),[n,a]=(0,y.useState)(null),o=(0,y.useCallback)((async()=>{if(e&&t){const n=D(r.query.bind(r)),{attributes:o}=e,i=await(null===o||void 0===o?void 0:o.reduce((async(e,r)=>{const{id:a,formName:o,optionSet:i,type:s,unique:l}=r,d=null===t||void 0===t?void 0:t.find((e=>e.attribute===a));let c;return d&&(c=BN[s]?await BN[s](d.value,n):Et(d.value,s)),[...await e,{attribute:a,key:o,optionSet:i,value:c,unique:l,valueType:s}]}),Promise.resolve([])));a(i)}else a([])}),[e,t,r]);return(0,y.useEffect)((()=>{o()}),[o]),n})(t,r),l=(0,A.ow)(),d=(0,y.useRef)(!1),[c,u]=(0,y.useState)({}),[p,m]=(0,y.useState)({});return(0,y.useEffect)((()=>{d.current=!1}),[o]),(0,y.useEffect)((()=>{if(null!==n&&void 0!==n&&n.id&&a&&Object.entries(a).length>0&&!1===d.current&&s){const e={orgUnitCode:n.code},t=D(l.query.bind(l));(async e=>{let{foundation:t,clientAttributesWithSubvalues:r,staticPatternValues:n,setFormValues:a,setClientValues:o,formValuesReadyRef:i,searchTerms:s,querySingleResource:l}=e;const d=null===r||void 0===r?void 0:r.reduce(((e,t)=>({...e,[t.attribute]:t.value})),{}),c=null===r||void 0===r?void 0:r.reduce(((e,t)=>({...e,[t.attribute]:xt(t.value,t.valueType)})),{}),u=null===s||void 0===s?void 0:s.reduce(((e,t)=>({...e,[t.id]:t.value})),{}),p=null===s||void 0===s?void 0:s.reduce(((e,t)=>({...e,[t.id]:xt(t.value,t.type)})),{}),m=await $A(t,r,n,l);a&&a({...p,...c,...m}),o&&o({...u,...d,...m}),i.current=!0})({foundation:a,clientAttributesWithSubvalues:s,staticPatternValues:e,setFormValues:u,setClientValues:m,formValuesReadyRef:d,searchTerms:i,querySingleResource:t})}}),[a,s,d,n,i,l]),{formValues:c,clientValues:p,formValuesReadyRef:d}},WN="StartInitForEnrollmentRegistrationForm",HN=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{program:r,isLoading:n}=Ji(e,{enabled:!t}),a=(0,y.useMemo)((()=>{if(!n&&null!==r&&void 0!==r&&r.useFirstStageDuringRegistration){var e;const{programStages:t}=r;return null===(e=t.filter((e=>({read:e.access.data.read,write:e.access.data.write}.write))).sort(((e,t)=>e.sortOrder-t.sortOrder))[0])||void 0===e?void 0:e.id}return null}),[r,n]),o=(0,y.useMemo)((()=>a&&e?(0,it.RE)(e,a):null),[a,e]);return{loading:n,firstStageMetaData:o}},zN=(e,t)=>{const r=null===e||void 0===e?void 0:e.sections.size;return(0,y.useMemo)((()=>{var a,o;const i=null===t||void 0===t||null===(a=t.stage)||void 0===a?void 0:a.stageForm;if(!e)return{formFoundation:null};if(!i||0===r)return{formFoundation:e};const s=null===t||void 0===t||null===(o=t.stage)||void 0===o?void 0:o.name,{id:l,name:d,access:c,description:u,featureType:p,validationStrategy:m}=e,g=new it.k3((e=>{e.id=l,e.name=d,e.access=c,e.description=u,e.featureType=p,e.validationStrategy=m}));return e.sections.forEach((e=>g.addSection(e))),i.sections.forEach((e=>{const t=e.id===it.wn.MAIN_SECTION_ID,r=new it.wn((r=>{var a;r.id=(a=e.id)===it.wn.MAIN_SECTION_ID?`${it.wn.MAIN_SECTION_ID}-stage`:a,r.name=t?n.A.t("{{ stageName }} - Details",{stageName:s}):n.A.t("{{ stageName }} - {{ sectionName }}",{stageName:s,sectionName:e.name}),r.group=it.wn.groups.EVENT,r.customForm=e.customForm,r.showContainer=e.showContainer,r.open=e.open,r.visible=e.visible,r.displayDescription=e.displayDescription}));((e,t)=>{Array.from(e.elements.entries()).map((e=>e[1])).forEach((e=>{e.section=t,t.addElement(e)}))})(e,r),g.addSection(r)})),{formFoundation:g}}),[e,t,r])},YN=(e,t,r,n,a,o)=>{const i=(0,y.useRef)(!1),s=(0,gs.wA)(),d=o&&(0,it.Nd)(o),c=(0,gs.d4)((e=>{let{dataEntries:r}=e;return!!r[t]}))&&!!n,u=(0,gs.d4)((e=>{let{searchDomain:t}=e;return t.currentSearchInfo.currentSearchTerms})),{scopeType:p}=es(e),{firstStageMetaData:m}=HN(o,p!==it.m2.TRACKER_PROGRAM),{formId:g,registrationMetaData:h,formFoundation:E}=vd({selectedScopeId:e}),{formFoundation:v}=zN(E,m),{programCategory:f}=RS(o,p!==it.m2.TRACKER_PROGRAM),{formValues:I,clientValues:b,formValuesReadyRef:S}=$N({program:d,trackedEntityInstanceAttributes:r,orgUnit:n,formFoundation:v,teiId:a,searchTerms:u});return(0,y.useEffect)((()=>{i.current=!1}),[a,e]),(0,y.useEffect)((()=>{!1===i.current&&!0===S.current&&n&&p===it.m2.TRACKER_PROGRAM&&v&&(i.current=!0,s((e=>{let{selectedOrgUnit:t,selectedScopeId:r,dataEntryId:n,formValues:a,clientValues:o,programCategory:i,firstStage:s,formFoundation:d}=e;return l(WN)({selectedOrgUnit:t,selectedScopeId:r,dataEntryId:n,formValues:a,clientValues:o,programCategory:i,firstStage:s,formFoundation:d})})({selectedOrgUnit:n,selectedScopeId:e,dataEntryId:t,formValues:I,clientValues:b,programCategory:f,firstStage:null===m||void 0===m?void 0:m.stage,formFoundation:v})))}),[v,p,t,e,n,S,I,b,f,m,s]),{teiId:a,ready:c,skipDuplicateCheck:!!a,firstStageMetaData:m,formId:g,enrollmentMetadata:h,formFoundation:v}};async function qN(e){const t=ve();return await t.getAll("organisationUnitGroups",{project:e=>({id:e.id,code:e.code}),onIDBGetRequest:t=>t.index("organisationUnitId").openCursor(window.IDBKeyRange.only(e))})}const KN="organisationUnits.GetOrgUnit",QN="organisationUnits.OrgUnitFetched",XN=e=>l(KN)(e),JN=e=>l(QN)(e);function ZN(e){const t=(0,gs.wA)(),r=(0,gs.d4)((t=>{let{organisationUnits:r}=t;return r&&r[e]})),n=r?void 0:e,{orgUnit:a,error:o}=Jo(n,"displayName,code,path"),{orgUnitGroups:i,error:s}=function(e){const t=(0,y.useRef)({orgUnitId:void 0,requestId:0,fetching:!1}),[r,n]=(0,y.useState)(),[a,o]=(0,y.useState)();let i;return e&&e!==t.current.orgUnitId&&(i=t.current.requestId+1,t.current={orgUnitId:e,requestId:i,fetching:!0}),(0,y.useEffect)((()=>{e&&i===t.current.requestId&&(o(void 0),qN(e).then((e=>{i===t.current.requestId&&(t.current.fetching=!1,n(e))})).catch(o))}),[e,i]),t.current.fetching?{error:a}:{orgUnitGroups:r,error:a}}(n);if(r)return{orgUnit:r};if(o)return{error:{error:o,errorComponent:eR}};if(s)return{error:{groupError:s,errorComponent:eR}};if(e&&a&&i){const{displayName:e,...r}=a,n={...r,name:e,groups:i};return t(JN(n)),{orgUnit:n}}return{}}const eR=y.createElement("div",null,n.A.t("organisation unit could not be retrieved. Please try again later."));var tR=r(78939);const rR=()=>{const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t=`0123456789${e}`,r=t.length;let n;n=e.charAt(Math.random()*e.length);for(let a=1;a<11;++a)n+=t.charAt(Math.random()*r);return n},nR=e=>{if(e)return Array.isArray(e)?{type:"Polygon",coordinates:e}:e.longitude&&e.latitude?{type:"Point",coordinates:[e.longitude,e.latitude]}:void 0},aR=(0,j.Fs)(Mi,_i),oR="enrollmentEventNew",iR="enrollmentEventEdit",sR="enrollmentDashboard";const lR=e=>{let{programId:t,dataEntryId:r,itemId:n="newEnrollment",orgUnitId:a,teiId:o,trackedEntityTypeId:i}=e;const s=yf(r,n),{serverVersion:{minor:l}}=(0,A.UK)(),d=(0,gs.d4)((e=>{let{formsValues:t}=e;return t[s]})),c=(0,gs.d4)((e=>{let{dataEntriesFieldsValue:t}=e;return t[s]})),u=(0,gs.d4)((e=>{let{dataEntriesFieldsMeta:t}=e;return t[s]})),{formFoundation:p}=vd({selectedScopeId:t}),{firstStageMetaData:m}=HN(t),{formFoundation:g}=zN(p,m);return{buildTeiWithEnrollment:()=>{if(!g)throw Error("form foundation object not found");const e=m&&m.stage,r=function(e,t){return t.convertValues(e,Mi)}(d,g),n=g.convertAndGroupBySection(r,_i),s=function(e,t,r){const n=ad(e,t,r)||{},a=Object.keys(n).reduce(((e,r)=>{const a=n[r],o=t[r].type;return e[r]=_i(a,o),e}),{});return a}(c,u,g),{enrolledAt:p,occurredAt:h,assignee:E,geometry:y}=s,{stages:v}=(0,it.x6)(t),f=Object.keys(s).filter((e=>e.startsWith("attributeCategoryOptions"))).reduce(((e,t)=>(e[t.split("-")[1]]=s[t],e)),{}),I=n[it.wn.groups.ENROLLMENT],b=n[it.wn.groups.EVENT],S=(e=>{let{firstStageMetadata:t,programId:r,orgUnitId:n,currentEventValues:a,fieldsValue:o,attributeCategoryOptions:i,assignee:s,serverMinorVersion:l}=e;if(!t)return null;const{enrolledAt:d,stageComplete:c,stageOccurredAt:u,stageGeometry:p}=o,m=i?{attributeCategoryOptions:Pi(i,l)}:{},g={status:xT(c),geometry:nR(p),occurredAt:aR(u,it.CO.DATE),scheduledAt:aR(d,it.CO.DATE),programStage:t.id,program:r,orgUnit:n,...m},h=a?Object.keys(a).reduce(((e,t)=>(e.push({dataElement:t,value:a[t]}),e)),[]):void 0;return h&&(g.dataValues=h),s&&(g.assignedUser=s),g})({firstStageMetadata:e,programId:t,orgUnitId:a,currentEventValues:b,fieldsValue:c,attributeCategoryOptions:f,assignee:E,serverMinorVersion:l}),T=(e=>{let{stages:t,enrolledAt:r,occurredAt:n,programId:a,orgUnitId:o,firstStageMetadata:i,attributeCategoryOptions:s,serverMinorVersion:l}=e;const d=n||r;return[...t.values()].filter((e=>{let{autoGenerateEvent:t}=e;return t})).filter((e=>((e,t)=>!t||t.id!==e.id)(e,i))).map((e=>{let{id:t,reportDateToUse:n,generatedByEnrollmentDate:i,openAfterEnrollment:c,minDaysFromStart:u}=e;const p="enrolledAt"===n?r:d,m=i?r:d,g={};return s&&(g.attributeCategoryOptions=Pi(s,l)),{...c?{status:"ACTIVE",occurredAt:p,scheduledAt:p}:{status:"SCHEDULE",scheduledAt:_i($()(m).add(u,"days").format("YYYY-MM-DD"),it.CO.DATE)},...g,programStage:t,program:a,orgUnit:o}}))})({firstStageMetadata:e,stages:v,enrolledAt:p,occurredAt:h,programId:t,orgUnitId:a,attributeCategoryOptions:f,serverMinorVersion:l}),A=S?[S,...T]:T,C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).filter((e=>!WA(e))).map((t=>({attribute:t,value:e[t]})))}(I),O={program:t,status:"ACTIVE",orgUnit:a,occurredAt:h,enrolledAt:p,attributes:C,events:A,geometry:y},N=HA(I),R=N?zA(N,d):void 0;return{trackedEntity:o||rR(),orgUnit:a,trackedEntityType:i,attributes:C,geometry:R,enrollments:[O]}}}};function dR(){return dR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dR.apply(this,arguments)}const cR=e=>{var t,r,n;let{selectedScopeId:a,id:o,saveButtonText:i,trackedEntityInstanceAttributes:s,orgUnitId:l,teiId:d,onSave:c,onCancel:u,...p}=e;const{orgUnit:m,error:g}=ZN(l),{ready:h,skipDuplicateCheck:E,firstStageMetaData:v,formId:f,enrollmentMetadata:I,formFoundation:b}=YN(a,o,s,m,d,a),{buildTeiWithEnrollment:S}=lR({programId:a,dataEntryId:o,orgUnitId:l,teiId:d,trackedEntityTypeId:null===I||void 0===I||null===(t=I.trackedEntityType)||void 0===t?void 0:t.id}),T=(0,gs.d4)((e=>Df(e,"newPageDataEntryId-newEnrollment")||Df(e,"newPageDataEntryId-newTei")||Df(e,"relationship-newTei")||Df(e,"relationship-newEnrollment"))),A=null!==(r=null===I||void 0===I||null===(n=I.trackedEntityType)||void 0===n?void 0:n.name.toLocaleLowerCase())&&void 0!==r?r:"",C=(0,gs.d4)((e=>{let{possibleDuplicates:t,newPage:r}=e;return t.isLoading||t.isUpdating||!!r.uid}));if(g)return g.errorComponent;return y.createElement(jN,dR({},p,{firstStageMetaData:v,selectedScopeId:a,formId:f,formFoundation:b,id:o,onCancel:u,saveButtonText:i(A),ready:h&&!!I,teiId:d,enrollmentMetadata:I,skipDuplicateCheck:E,orgUnitId:l,orgUnit:m,isUserInteractionInProgress:T,isSavingInProgress:C,onSave:()=>{const e=S();c(e)}}))},uR="StartInitForTrackedEntityTypeRegistrationForm";function pR(){return pR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pR.apply(this,arguments)}const mR=(0,qd.compose)(fN((e=>{let{trackedEntityName:t}=e;return t})),MN(),ub({onGetFormFoundation:e=>{let{teiRegistrationMetadata:t}=e;return t&&t.form}}),(0,I.withStyles)((()=>({actions:{display:"flex",gap:yn.Q.dp8}}))))((e=>{let{id:t,selectedScopeId:r,onSave:a,saveButtonText:o,teiRegistrationMetadata:i,fieldOptions:s,classes:l,onPostProcessErrorMessage:d,trackedEntityName:c,isUserInteractionInProgress:u,isSavingInProgress:p,onCancel:m,...g}=e;const[h,E]=(0,y.useState)(!1),{scopeType:v}=es(r),{formId:f,formFoundation:I}=vd({selectedScopeId:r}),b=IN(),{displayName:S}=mi(b);return y.createElement(y.Fragment,null,v===it.m2.TRACKED_ENTITY_TYPE&&f&&y.createElement(y.Fragment,null,y.createElement(xA,pR({orgUnitId:b,formFoundation:I,trackedEntityTypeId:r,teiRegistrationMetadata:i,id:t,fieldOptions:s,onPostProcessErrorMessage:d,onGetUnsavedAttributeValues:()=>console.log("similar to the withErrorMessagePostProcessor this will come in the future")},g)),y.createElement("div",{className:l.actions},a&&y.createElement(ra.$,{dataTest:"create-and-link-button",primary:!0,onClick:a,loading:p},o),y.createElement(ra.$,{dataTest:"cancel-button",secondary:!0,onClick:()=>{u?E(!0):m()},disabled:p},n.A.t("Cancel"))),y.createElement(SS,null,((e,t)=>y.createElement(y.Fragment,null,n.A.t("Saving a {{trackedEntityName}}",{trackedEntityName:e,interpolation:{escapeValue:!1}})," ",y.createElement("b",null,n.A.t("without"))," ",n.A.t("enrollment"),t&&y.createElement(y.Fragment,null," ",n.A.t("in")," ",y.createElement("b",null,t)),"."," ",n.A.t("Enroll in a program by selecting a program from the top bar.")))(c.toLowerCase(),S)),y.createElement(Rf,pR({},wf,{onDestroy:m,open:!!h,onCancel:()=>{E(!1)}}))))}));const gR=e=>{let{trackedEntityTypeId:t,dataEntryId:r,itemId:n="newTei",orgUnitId:a}=e;const o=yf(r,n),{formFoundation:i}=vd({selectedScopeId:t}),s=(0,gs.d4)((e=>{let{formsValues:t}=e;return t[o]}));return{buildTeiWithoutEnrollment:()=>{if(!i)throw Error("form foundation object not found");const e=function(e,t){return t.convertValues(e,Mi)}(s,i),r=i.convertValues(e,_i),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).filter((e=>!WA(e))).map((t=>({attribute:t,value:e[t]})))}(r),o=HA(r),l=o?zA(o,s):void 0;return{attributes:n,trackedEntity:rR(),orgUnit:a,trackedEntityType:t,geometry:l,enrollments:[]}}}};function hR(){return hR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hR.apply(this,arguments)}const ER=e=>{let{selectedScopeId:t,dataEntryId:r,orgUnitId:n,inheritedAttributes:a}=e;const o=(0,gs.wA)(),{scopeType:i,trackedEntityName:s}=es(t),{formId:d,formFoundation:c}=vd({selectedScopeId:t}),u=(e=>{let{inheritedAttributes:t}=e;const r=(0,gs.d4)((e=>{let{searchDomain:t}=e;return t.currentSearchInfo.currentSearchTerms}));return(0,y.useMemo)((()=>t?null===t||void 0===t?void 0:t.reduce(((e,t)=>(e[t.attribute]=xt(t.value,t.valueType),e)),{}):r?null===r||void 0===r?void 0:r.reduce(((e,t)=>(e[t.id]=xt(t.value,t.type),e)),{}):null),[t,r])})({inheritedAttributes:a}),p=!!d;return(0,y.useEffect)((()=>{p&&i===it.m2.TRACKED_ENTITY_TYPE&&o((e=>{let{selectedOrgUnitId:t,selectedScopeId:r,dataEntryId:n,formFoundation:a,formValues:o}=e;return l(uR)({selectedOrgUnitId:t,selectedScopeId:r,dataEntryId:n,formFoundation:a,formValues:o})})({selectedOrgUnitId:n,selectedScopeId:t,dataEntryId:r,formFoundation:c,formValues:u}))}),[i,r,t,p,c,u,o,n]),{trackedEntityName:s}},yR=e=>{var t;let{selectedScopeId:r,id:n,orgUnitId:a,onSave:o,inheritedAttributes:i,...s}=e;const{trackedEntityName:l}=ER({selectedScopeId:r,dataEntryId:n,orgUnitId:a,inheritedAttributes:i}),d=(0,gs.d4)((e=>{let{dataEntries:t}=e;return!!t[n]})),c=(0,gs.d4)((e=>{let{dataEntries:t}=e;return t[n]})),{registrationMetaData:u}=vd({selectedScopeId:r}),{buildTeiWithoutEnrollment:p}=gR({trackedEntityTypeId:r,dataEntryId:n,orgUnitId:a}),m=(0,y.useMemo)((()=>c?`${n}-${c.itemId}`:""),[n,c]),g=(0,gs.d4)((e=>Df(e,m)));if(!u||u instanceof it.RQ)return null;return y.createElement(mR,hR({id:n,orgUnitId:a,teiRegistrationMetadata:u,selectedScopeId:null===(t=u.form)||void 0===t?void 0:t.id,ready:d&&!!u,trackedEntityName:l,isUserInteractionInProgress:g,onSave:()=>{const e=p();o(e)}},s))};var vR=r(76147),fR=r(28998),IR=r(95163),bR=r(59545),SR=r(29518),TR=r(18551),AR=r(86773),CR=r(82195);function OR(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class NR extends y.Component{constructor(){super(...arguments),OR(this,"getSortHandler",(e=>t=>{let{direction:r}=t;this.props.onSort(e,r)})),OR(this,"getCustomEndCellHeader",(()=>{const{getCustomEndCellHeader:e,getCustomEndCellBody:t,customEndCellHeaderStyle:r}=this.props;return t?y.createElement(fR.w,{style:r},e&&e(this.props)):null})),OR(this,"getCustomEndCellBody",((e,t)=>{const{getCustomEndCellBody:r,customEndCellBodyStyle:n}=this.props;return r?y.createElement(IR.B,{style:n},r(e,t)):null}))}renderHeaderRow(e){const{classes:t,sortById:r,sortByDirection:n,dataSource:a,onSelectAll:o,allRowsAreSelected:i}=this.props,s=e.map((e=>y.createElement(fR.w,{dataTest:`table-row-${r===e.id?n:"default"}`,onSortIconClick:this.getSortHandler(e.id),sortDirection:r===e.id?n:"default",key:e.id,align:NR.typesWithRightPlacement.includes(e.type)?"right":"left",className:er()({[t.headerAlign]:NR.typesWithRightPlacement.includes(e.type)})},e.header))),l=this.props.showSelectCheckBox?y.createElement(fR.w,{dataTest:"select-all-rows-checkbox"},y.createElement(bR.Y,{checked:i,onChange:()=>o(a.map((e=>{let{id:t}=e;return t})))})):null;return y.createElement(SR.J,{dataTest:"table-row"},l,s,this.getCustomEndCellHeader())}renderBody(e){const{getCustomEndCellBody:t,updating:r,classes:n}=this.props,a=e.length+(t?1:0);return r?y.createElement(SR.J,{className:n.loadingRow}):this.renderRows(e,a)}renderRows(e,t){const{dataSource:r,rowIdKey:a,selectedRows:o,onRowSelect:i,...s}=this.props;return r&&0!==r.length?r.map((t=>{const r=e.map((e=>y.createElement(IR.B,{key:e.id,align:NR.typesWithRightPlacement.includes(e.type)?"right":"left",style:{cursor:this.props.isSelectionInProgress?"pointer":"default"},onClick:()=>{this.props.isSelectionInProgress?i(t[a]):this.props.onRowClick(t)}},t[e.id]))),n=t[a];return y.createElement(SR.J,{selected:o[n],key:n,dataTest:t[a]},this.props.showSelectCheckBox&&y.createElement(IR.B,{width:"40px"},y.createElement(bR.Y,{dataTest:"select-row-checkbox",checked:o[n],onChange:()=>i(n)})),r,this.getCustomEndCellBody(t,s))})):y.createElement(SR.J,{dataTest:"table-row"},y.createElement(IR.B,{colSpan:t},n.A.t("No items to display")))}render(){const{classes:e,columns:t,updating:r}=this.props,n=t?t.filter((e=>e.visible)):[];return y.createElement("div",{className:e.tableContainer},y.createElement(TR.b,{dataTest:"online-list-table"},y.createElement(AR.n,null,this.renderHeaderRow(n)),y.createElement(CR.B,{loading:r},this.renderBody(n))))}}OR(NR,"typesWithRightPlacement",[it.CO.NUMBER,it.CO.INTEGER,it.CO.INTEGER_POSITIVE,it.CO.INTEGER_NEGATIVE,it.CO.INTEGER_ZERO_OR_POSITIVE]);const RR=(0,I.withStyles)((()=>({tableContainer:{overflowX:"auto"},loadingRow:{height:100},headerAlign:{"&>span.container":{alignItems:"flex-end"}}})))(NR);class wR extends y.Component{renderHeaderRow(e){const{classes:t}=this.props,r=e.map((e=>y.createElement(fR.w,{key:e.id,className:er()({[t.headerAlign]:wR.typesWithRightPlacement.includes(e.type)}),align:wR.typesWithRightPlacement.includes(e.type)?"right":"left"},e.header)));return y.createElement(SR.J,{dataTest:"table-row"},r)}renderRows(e){const{dataSource:t,noItemsText:r,rowIdKey:a}=this.props;if(!t||0===t.length){const t=e.length;return y.createElement(SR.J,{dataTest:"table-row"},y.createElement(IR.B,{colSpan:t},r||n.A.t("No items to display")))}return t.map((t=>{const r=e.map((e=>y.createElement(IR.B,{key:e.id,align:wR.typesWithRightPlacement.includes(e.type)?"right":"left"},t[e.id])));return y.createElement(SR.J,{key:t[a],dataTest:"table-row"},r)}))}render(){const{columns:e,classes:t}=this.props,r=e?e.filter((e=>e.visible)):[];return y.createElement("div",{className:t.tableContainer},y.createElement(TR.b,null,y.createElement(AR.n,null,this.renderHeaderRow(r)),y.createElement(CR.B,null,this.renderRows(r))))}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(wR,"typesWithRightPlacement",[it.CO.NUMBER,it.CO.INTEGER,it.CO.INTEGER_POSITIVE,it.CO.INTEGER_NEGATIVE,it.CO.INTEGER_ZERO_OR_POSITIVE]);const _R=(0,I.withStyles)((()=>({tableContainer:{overflow:"auto"},headerAlign:{"&>span.container":{alignItems:"flex-end"}}})))(wR),PR=(0,I.withStyles)((e=>({container:{borderColor:"light"===e.palette.type?e.palette.dividerLighter:e.palette.dividerDarker,borderWidth:"1px",borderStyle:"solid",padding:10,display:"flex",alignItems:"center",justifyContent:"center"}})))((e=>y.createElement("div",{className:e.classes.container},e.emptyListText||n.A.t("Data for offline list not present")))),kR=e=>{const t=e?e(_R):_R;return e=>{const{hasData:r,...n}=e;return r?y.createElement(t,n):y.createElement(PR,null)}};var DR=r(41519);const UR=(e,t)=>e.workingListsContext[t.listId].programId,LR=(e,t)=>e.workingListsColumnsOrder[t.listId],FR=e=>{const t=new it.fq((t=>{t.id=e.id,t.type=e.type})),r=e.options.map((e=>new it.c$((t=>{t.text=e.text,t.value=e.value})))),n=new it.G2(e.id,r,null,t);return t.optionSet=n,n},xR=(e,t)=>t.events,MR=(e,t)=>t.eventsValues,VR=(e,t)=>e.workingLists[t.listId].order,jR=(e,t,r)=>r.map((r=>({event:e[r],eventValues:t[r]}))),GR=(0,fg.Ad)(Ig.UI,((e,t)=>{let{eventContainers:r}=e,{eventContainers:n}=t;return n.every(((e,t)=>e.event===(r[t]&&r[t].event)&&e.eventValues===(r[t]&&r[t].eventValues)))&&r.every(((e,t)=>e.event===(n[t]&&n[t].event)&&e.eventValues===(n[t]&&n[t].eventValues)))})),BR=()=>GR(((e,t)=>({eventContainers:e,columns:t})),(e=>{let{eventContainers:t,columns:r}=e;return((e,t)=>{if(0===e.length)return[];const{stage:r,error:n}=(0,DR.p)(e[0].event);return n||!r?null:e.map((e=>{const n=r.stageForm.convertValues(e.eventValues,Ii);return{...t.filter((e=>e.isMainProperty)).reduce(((t,r)=>{const n=e.event[r.id];if(n)if(r.options){const e=r.options.find((e=>e.value===n));e?t[r.id]=e.text:S().error((0,j.px)("Missing value in options for main values")({sourceValue:n,mainColumn:r}))}else t[r.id]=Ii(n,r.type);return t}),{}),...n,eventId:e.event.eventId}}))})(t,r)})),$R=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(UR,LR,((e,t)=>{const r=(0,it.uJ)(e);if(r.error)return t;const n=r.stage.stageForm;return t.map((e=>{if(e.isMainProperty)return{...e,header:e.header||n.getLabel(e.id),optionSet:e.options&&FR(e)};const t=n.getElement(e.id);return{...e,header:t.formName,type:t.type,optionSet:t.optionSet}}))})),t=(0,fg.Mz)(xR,MR,VR,jR),r=BR();return(n,a)=>{const o=e(n,a),i=t(n,a),s=n.workingListsMeta[a.listId].sortById,l=n.workingListsMeta[a.listId].sortByDirection;return{columns:o,rowIdKey:"eventId",dataSource:r(i,o),sortById:s,sortByDirection:l}}}),{}),WR=(0,gs.Ng)(((e,t)=>{const r=e.workingListsContext[t.listId];return{hasData:!(!r||!of(r,e.currentSelections))}}),{})(kR($R));function HR(){return HR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HR.apply(this,arguments)}class zR extends y.Component{render(){const{listId:e,noItemsText:t,emptyListText:r,...a}=this.props;return y.createElement(WR,HR({listId:e,noItemsText:t||n.A.t("No events to display"),emptyListText:r||n.A.t("Data for offline list not present")},a))}}const YR="recentlyAddedEvents";function qR(){return qR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qR.apply(this,arguments)}const KR=(0,I.withStyles)((e=>({container:{padding:e.typography.pxToRem(20)},header:{paddingBottom:e.typography.pxToRem(10)}})))((e=>{const{classes:t,...r}=e,a=e.events?Object.keys(e.events).length:0;return 0===a?null:y.createElement(vR.Z,{className:t.container},y.createElement("div",{className:t.header},`${a} ${n.A.t("events added")}`),y.createElement(zR,qR({listId:YR,noItemsText:n.A.t("No events added"),emptyListText:n.A.t("No events added")},r)))})),QR=(0,gs.Ng)((e=>({events:e.recentlyAddedEvents,eventsValues:e.recentlyAddedEventsValues})),(()=>({onRowClick:()=>{}})))(KR),XR=e=>{let{dataElementIds:t,programId:r,stageId:n}=e;const{data:a,isLoading:o}=ri([r,"dataElements",n,{dataElementIds:t}],(()=>(async e=>{let{dataElementIds:t}=e;return ve().getAll(z.DATA_ELEMENTS,{predicate:e=>t.includes(e.id)})})({dataElementIds:t})),{enabled:!!t});return{dataElements:a,isLoading:o}},JR=e=>{let{programId:t,stageId:r}=e;const n=r||t,{program:a}=Ji(t,{enabled:!!t}),{locale:o}=us(),{serverVersion:{minor:i}}=(0,A.UK)(),{dataEntryFormConfig:s,configIsFetched:l}=Ed({selectedScopeId:n}),d=(0,y.useMemo)((()=>r?null===a||void 0===a?void 0:a.programStages.find((e=>e.id===r)):null===a||void 0===a?void 0:a.programStages[0]),[null===a||void 0===a?void 0:a.programStages,r]),c=(0,y.useMemo)((()=>d?d.programStageDataElements.map((e=>e.dataElementId)):[]),[d]),{dataElements:u}=XR({programId:t,stageId:r,dataElementIds:c}),{optionSets:p}=Xi({attributes:u,selectedScopeId:n}),{data:m,isIdle:g,isLoading:h,isError:E}=ri(["programStageMetadata",t,r],(()=>(async e=>{let{cachedProgramStage:t,programId:r,cachedDataElements:n,cachedOptionSets:a,locale:o,minorServerVersion:i,dataEntryFormConfig:s}=e;const l=ve(),d=await l.getAll(z.RELATIONSHIP_TYPES),c=await l.getAll(z.PROGRAM_RULES,{predicate:e=>e.programStageId===t.id});return new Cd({cachedOptionSets:new Map(a.map((e=>[e.id,e]))),cachedRelationshipTypes:d,cachedDataElements:new Map(n.map((e=>[e.id,e]))),locale:o,minorServerVersion:i,dataEntryFormConfig:s}).build(t,r).then((e=>(e.programRules=c,e)))})({cachedProgramStage:d,cachedDataElements:u,programId:t,cachedOptionSets:p,locale:o,minorServerVersion:i,dataEntryFormConfig:s})),{cacheTime:1/0,staleTime:1/0,enabled:!!a&&!!t&&!!u&&!!p&&!!o&&!!i&&l});return{formFoundation:null===m||void 0===m?void 0:m.stageForm,stage:m,isLoading:h||g,isError:E}},ZR=(0,fp.default)((()=>({flexContainer:{display:"flex",alignItems:"top",justifyContent:"space-between",marginBottom:yn.Q.dp12},flexEnd:{justifyContent:"flex-end",flexShrink:0},container:{marginBottom:yn.Q.dp16,padding:yn.Q.dp16,background:vn.T.white,border:"1px solid",borderColor:vn.T.grey400,borderRadius:3,color:vn.T.grey900},title:{fontWeight:500,fontSize:16,color:vn.T.grey800}})))((e=>{let{classes:t,formHorizontal:r,onFormLayoutDirectionChange:a}=e;const{id:o}={id:(0,gs.d4)((e=>{let{currentSelections:t}=e;return t.programId}))},i=vs().orgUnitId,{formFoundation:s,stage:l}=JR({programId:o}),{orgUnit:d,error:c}=ZN(i),u=(e=>{let{programId:t,orgUnit:r,formFoundation:n}=e;const a=(0,gs.wA)(),o=(0,y.useMemo)((()=>t&&(0,it.n$)(t)),[t]),i=(0,y.useRef)(),s=(0,gs.d4)((e=>e));return(0,y.useEffect)((()=>{r&&o&&n&&(a((0,Xd.OJ)([Jk({state:s,program:o,orgUnit:r,formFoundation:n})])),i.current=r)}),[a,o,r,n]),!!r&&i.current===r})({programId:o,orgUnit:d,formFoundation:s}),p=md(o);if(c)return c.errorComponent;const m=(()=>{let e=!1;return null!==s&&void 0!==s&&s.sections?(s.sections.forEach((t=>{t.customForm&&(e=!0)})),e):e})();return u&&y.createElement("div",{className:t.container},y.createElement("div",{className:t.flexContainer},y.createElement("div",{className:t.title},n.A.t("New {{titleText}}",{titleText:p,interpolation:{escapeValue:!1}})),y.createElement("div",{className:t.flexEnd},m?null:y.createElement(ra.$,{onClick:()=>a(!r),small:!0},r?n.A.t("Switch to form view"):n.A.t("Switch to row view")))),y.createElement("div",null,y.createElement(uT,{programId:o,stage:l,orgUnit:d,formFoundation:s,formHorizontal:r}),y.createElement(QR,null)))})),ew=(0,gs.Ng)((()=>e=>({dataEntryHasChanges:_I(e),formHorizontal:!!e.newEventPage.formHorizontal})),(e=>({onFormLayoutDirectionChange:t=>{e((e=>l(Zv)({formHorizontal:e}))(t))}})))(ZR);var tw=r(24512);function rw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class nw extends y.Component{constructor(){super(...arguments),rw(this,"onSelectRelationshipType",(e=>{this.props.onSelectRelationshipType({id:e.id,name:e.name,from:{...e.from},to:{...e.to}})})),rw(this,"renderRelationshipTypes",(()=>{const{classes:e,relationshipTypes:t}=this.props;return t?t.map((t=>y.createElement("div",{key:t.id,"data-test":`relationship-type-selector-button-${t.id}`,className:er()(e.relationshipType,e.relationshipTypeSelectable),role:"button",tabIndex:"0",onClick:()=>this.onSelectRelationshipType(t)},t.name))):[]})),rw(this,"renderSelectedRelationshipType",(e=>{const{classes:t,onDeselectRelationshipType:r}=this.props;return y.createElement("div",{className:er()(t.relationshipType,t.relationshipTypeSelected)},y.createElement("div",{className:t.relationshipTypeSelectedText,onClick:r,role:"button",tabIndex:"0"},y.createElement("div",null,e.name),y.createElement(tw.A,null)))}))}render(){const{selectedRelationshipType:e,classes:t}=this.props;return y.createElement("div",{className:t.container},e?this.renderSelectedRelationshipType(e):this.renderRelationshipTypes())}}const aw=(0,fp.default)((e=>({relationshipType:{display:"flex",padding:e.typography.pxToRem(10),border:`1px solid ${e.palette.grey.light}`,borderRadius:e.typography.pxToRem(4),margin:e.typography.pxToRem(10)},relationshipTypeSelectable:{cursor:"pointer"},relationshipTypeSelected:{backgroundColor:"#f0f9f8"},relationshipTypeSelectedText:{paddingLeft:e.typography.pxToRem(5),display:"flex",alignItems:"center",borderLeft:"2px solid #4ca899"},container:{display:"flex"}})))(nw);var ow=r(91273),iw=r(48130);const sw=e=>e.newRelationshipRegisterTei.programId,lw="relationship";var dw="enrollment_fieldLabelMediaBased__fAIwn";const cw=(0,I.withTheme)()((e=>{let{theme:t,onSave:r,onCancel:a,programId:o,orgUnitId:i,duplicatesReviewPageSize:s,renderDuplicatesDialogActions:l,renderDuplicatesCardActions:d,ExistingUniqueValueDialogActions:c}=e;const u={theme:t,fieldLabelMediaBasedClass:dw};return y.createElement(cR,{id:lw,selectedScopeId:o,orgUnitId:i,fieldOptions:u,saveButtonText:e=>n.A.t("Save new {{trackedEntityTypeName}} and link",{trackedEntityTypeName:e,interpolation:{escapeValue:!1}}),onSave:r,onCancel:a,duplicatesReviewPageSize:s,renderDuplicatesDialogActions:l,renderDuplicatesCardActions:d,ExistingUniqueValueDialogActions:c})})),uw=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(sw,(e=>{let t;try{t=(0,it.Ec)(e)}catch(r){return null}return t.enrollment}));return t=>({enrollmentMetadata:e(t),programId:t.newRelationshipRegisterTei.programId,orgUnitId:t.newRelationshipRegisterTei.orgUnit.id})}),(()=>({})))(cw),pw=e=>e.newRelationship.selectedRelationshipType.to.trackedEntityTypeId;var mw="trackedEntityInstance_fieldLabelMediaBased__LSf5c";const gw=(0,I.withTheme)()((e=>{let{theme:t,onSave:r,onCancel:a,teiRegistrationMetadata:o={},duplicatesReviewPageSize:i,renderDuplicatesDialogActions:s,renderDuplicatesCardActions:l,ExistingUniqueValueDialogActions:d}=e;const c=IN(),u={theme:t,fieldLabelMediaBasedClass:mw},{trackedEntityType:p}=o||{},m=p.name.toLocaleLowerCase();return y.createElement(yR,{id:lw,orgUnitId:c,teiRegistrationMetadata:o,selectedScopeId:o.form.id,saveButtonText:n.A.t("Save new {{trackedEntityTypeName}} and link",{trackedEntityTypeName:m,interpolation:{escapeValue:!1}}),fieldOptions:u,onSave:r,onCancel:a,duplicatesReviewPageSize:i,renderDuplicatesDialogActions:s,renderDuplicatesCardActions:l,ExistingUniqueValueDialogActions:d,orgUnit:{id:c}})})),hw=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(pw,(e=>{let t;try{t=(0,it.mu)(e)}catch(r){return S().error((0,j.px)("Could not get TrackedEntityType for id")({TETypeId:e})),null}return t.teiRegistration}));return t=>({teiRegistrationMetadata:e(t)})}),(()=>({})))(gw);class Ew extends y.Component{render(){const{showDataEntry:e,programId:t,...r}=this.props;return e?t?y.createElement(uw,r):y.createElement(hw,r):null}}const yw=(0,qd.compose)((0,gs.Ng)((e=>({showDataEntry:e.newRelationshipRegisterTei.orgUnit,error:e.newRelationshipRegisterTei.dataEntryError,programId:e.newRelationshipRegisterTei.programId})),(()=>({}))),qm())(Ew);function vw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class fw extends y.Component{static isBeingFiltered(e,t){return e.length!==t.length}constructor(e){super(e),vw(this,"filterPrograms",(e=>{const{orgUnitIds:t}=this.props;return e.filter((e=>!t||t.some((t=>e.organisationUnits[t]))))})),this.programs=Array.from(Nt.Jj.values())}getBaselinePrograms(e){const{baselineFilter:t}=this.props;return e.filter((e=>t(e)))}getPrograms(e){return(0,j.Fs)(this.filterPrograms)(e)}render(){const{orgUnitIds:e,baselineFilter:t,children:r,...n}=this.props,a=this.getBaselinePrograms(this.programs),o=this.getPrograms(a);return r(o,fw.isBeingFiltered(a,o),n)}}function Iw(){return Iw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Iw.apply(this,arguments)}function bw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Sw extends y.Component{constructor(){super(...arguments),bw(this,"baseLineFilter",(e=>{const{trackedEntityTypeId:t}=this.props;return e instanceof it.rr&&e.trackedEntityType.id===t&&e.access.data.write})),bw(this,"getOptionsFromPrograms",(e=>e.map((e=>({label:e.name,value:e.id,iconLeft:this.getProgramIcon(e)})))))}getProgramIcon(e){let{icon:{color:t,name:r}={},name:n}=e;const{classes:a}=this.props;return y.createElement("div",{className:a.iconContainer},y.createElement(Tm,{name:r||"clinical_fe_outline",color:t||"#e0e0e0",alternativeText:n,width:22,height:22,cornerRadius:2}))}renderIsFilteredText(){const{classes:e,onClearFilter:t}=this.props;return y.createElement("div",{className:e.isFilteredContainer},n.A.t("Some programs are being filtered."),y.createElement(Mg,{className:e.isFilteredLink,onClick:t},n.A.t("Show all")))}render(){const{classes:e,orgUnitIds:t,onUpdateSelectedProgram:r,onClearFilter:n,...a}=this.props;return y.createElement(fw,{orgUnitIds:t,baselineFilter:this.baseLineFilter},((e,t)=>y.createElement("div",null,y.createElement(tp,Iw({options:this.getOptionsFromPrograms(e),required:!1,onSelect:r},a)),t?this.renderIsFilteredText():null)))}}const Tw=hr()(hm()(Pm({onGetCustomFieldLabeClass:e=>e.programLabelClass})(vm((e=>{const{programLabelClass:t,...r}=e;return r}))(dp()((0,I.withStyles)((e=>({iconContainer:{display:"flex",alignItems:"center",paddingRight:5},icon:{width:22,height:22,borderRadius:2},isFilteredContainer:{fontSize:12,color:e.palette.grey.dark,paddingTop:5},isFilteredLink:{paddingLeft:2,backgroundColor:"inherit"}})))(Sw))))));function Aw(){return Aw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Aw.apply(this,arguments)}class Cw extends y.Component{render(){const{classes:e,...t}=this.props;return y.createElement(Tw,Aw({dataTest:"relationship-register-tei-program-selector",styles:Cw.baseComponentStyles,programLabelClass:e.programLabel,label:n.A.t("Program")},t))}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Cw,"baseComponentStyles",{labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}});const Ow=(0,I.withStyles)((e=>({programLabel:{paddingTop:"10px",[e.breakpoints.down(523)]:{paddingTop:"0px !important"}}})))(Cw),Nw="NewRelationshipSingleEventRegisterTeiProgramChange",Rw="NewRelationshipSingleEventRegisterTeiOrgUnitChange",ww="NewRelationshipSingleEventRegisterTeiOrgUnitSearchFailed",_w="NewRelationshipSingleEventRegisterTeiProgramFilterClear",Pw=(0,gs.Ng)((e=>({orgUnitIds:e.newRelationshipRegisterTei.orgUnit?[e.newRelationshipRegisterTei.orgUnit.id]:null,trackedEntityTypeId:e.newRelationship.selectedRelationshipType.to.trackedEntityTypeId,value:e.newRelationshipRegisterTei.programId})),(e=>({onUpdateSelectedProgram:t=>{e((e=>l(Nw)({programId:e}))(t))},onClearFilter:()=>{e(l(_w)())}})))(Ow);function kw(){return kw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kw.apply(this,arguments)}const Dw=eg()(jp);class Uw extends y.Component{render(){const{onUpdateSelectedOrgUnit:e,...t}=this.props;return y.createElement(Dw,kw({onSelect:e,scope:Fm,maxTreeHeight:200},t))}}const Lw=ym()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>e.labelClass})(vm((e=>{const{labelClass:t,...r}=e;return r}))(Qr()(Uw)))));function Fw(){return Fw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fw.apply(this,arguments)}function xw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Mw extends y.Component{constructor(){super(...arguments),xw(this,"handleUpdateSelectedOrgUnit",(e=>{var t;const{programId:r,onUpdateSelectedOrgUnit:n}=this.props;if(!r||!e)return void n(e,!1);let a;try{a=(0,it.Ec)(r)}catch(o){return void n(e,!0)}n(e,!(null===(t=a)||void 0===t||!t.organisationUnits)&&!a.organisationUnits[e.id])}))}render(){const{classes:e,onUpdateSelectedOrgUnit:t,programId:r,...a}=this.props;return y.createElement(Lw,Fw({labelClass:e.label,label:n.A.t("Organisation Unit"),styles:Mw.baseComponentStyles,onUpdateSelectedOrgUnit:this.handleUpdateSelectedOrgUnit},a))}}xw(Mw,"baseComponentStyles",{labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}});const Vw=(0,I.withStyles)((e=>({label:{paddingTop:"10px",[e.breakpoints.down(523)]:{paddingTop:"0px !important"}}})))(Mw),jw=(0,gs.Ng)((e=>({value:e.newRelationshipRegisterTei.orgUnit,programId:e.newRelationshipRegisterTei.programId})),(e=>({onUpdateSelectedOrgUnit:(t,r)=>{e(((e,t)=>l(Rw)({orgUnit:e,resetProgramSelection:t}))(t,r))},onSearchError:()=>{e(l(ww)())}})))(Vw),Gw=()=>y.createElement(y.Fragment,null,y.createElement(jw,null),y.createElement(Pw,null)),Bw=()=>{const e=n.A.t("Registration");return y.createElement(Lc,{title:e})},$w=(0,I.withStyles)((e=>({section:{backgroundColor:"white",maxWidth:e.typography.pxToRem(892)}})))((e=>{const{classes:t}=e;return y.createElement(kc,{header:Bw(),elevation:2,className:t.section},y.createElement(Gw,null))})),Ww=(0,I.withStyles)((e=>({container:{background:vn.T.white,border:"1px solid",borderColor:vn.T.grey400,borderRadius:3},headerContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:e.typography.pxToRem(5),minHeight:e.typography.pxToRem(42)},toggleCollapseButton:{padding:4},children:{padding:e.typography.pxToRem(10),borderTop:`1px solid ${e.palette.grey.blueGrey}`,"&.open":{animation:"slidein 200ms normal forwards ease-in-out",transformOrigin:"50% 0%"},"&.close":{animation:"slideout 200ms normal forwards ease-in-out",transformOrigin:"100% 0%"}},toggleButton:{margin:`0 0 0 ${yn.U.dp4}px`,height:"24px",borderRadius:"3px",color:vn.T.grey600,"&:hover":{background:vn.T.grey200,color:vn.T.grey800},"&.open":{animation:"flipOpen 200ms normal forwards linear"},"&.close":{animation:"flipClose 200ms normal forwards linear"},"&.closeinit":{transform:"rotateX(180deg)"}},"@keyframes slidein":{from:{transform:"scaleY(0)"},to:{transform:"scaleY(1)"}},"@keyframes slideout":{from:{transform:"scaleY(1)"},to:{transform:"scaleY(0)"}},"@keyframes flipOpen":{from:{transform:"rotateX(180deg)"},to:{transform:"rotateX(0)"}},"@keyframes flipClose":{from:{transform:"rotateX(0)"},to:{transform:"rotateX(180deg)"}}})))((e=>{let{header:t,collapsable:r=!1,collapsed:n=!1,children:a,classes:o}=e;const[i,s]=(0,y.useState)(n),[l,d]=(0,y.useState)(!n),[c,u]=(0,y.useState)(!1),p=(0,y.useRef)(null),m=(0,y.useRef)(!0);(0,y.useEffect)((()=>{if(m.current)return m.current=!1,void u(!1);u(!0),i?p.current=setTimeout((()=>{d(!1)}),200):d(!0)}),[i]);return y.createElement("div",{className:o.container},y.createElement("div",{className:o.headerContainer},t,r&&y.createElement(Bo,{className:er()(o.toggleButton,{closeinit:!c&&i,open:c&&!i,close:c&&i}),onClick:()=>{s((e=>!e))}},y.createElement(fn.A,null))),l&&y.createElement("div",{className:er()(o.children,{open:c&&!i,close:c&&i})},a))}));class Hw extends y.Component{render(){const{icon:e,text:t,badgeCount:r,classes:n,badgeClass:a}=this.props,o=!!r||0===r;return y.createElement("div",{className:n.headerContainer},y.createElement("div",{className:n.headerItemContainer},y.createElement(e,null)),y.createElement("div",{className:n.headerItemContainer},t),o&&y.createElement("div",{className:n.headerItemContainer},y.createElement(Fp.v,{dense:!0,className:(er()(n.badge),a)},r)))}}const zw=(0,I.withStyles)((e=>({headerContainer:{display:"flex",alignItems:"center"},headerItemContainer:{display:"inline-flex",paddingRight:e.typography.pxToRem(5),paddingLeft:e.typography.pxToRem(5)},badge:{display:"flex",alignItems:"center",cursor:"default !important",backgroundColor:`${vn.T.grey300} !important`}})))(Hw);function Yw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const qw=n.A.t("Errors");class Kw extends y.Component{constructor(){super(...arguments),Yw(this,"renderHeader",(()=>{const{classes:e,errors:t}=this.props,r=t?t.length:0;return y.createElement(zw,{icon:Gb.A,text:qw,badgeClass:e.badge,badgeCount:r})})),Yw(this,"renderItems",(e=>e.map((e=>y.createElement("div",{className:this.props.classes.error,key:e.id},e.message)))))}render(){const{errors:e}=this.props;return e&&e.length>0?y.createElement(Ww,{collapsable:!0,header:this.renderHeader()},this.renderItems(e)):null}}const Qw=(0,I.withStyles)((e=>({badge:{backgroundColor:e.palette.error.main,color:"white"},error:{marginTop:e.typography.pxToRem(5),marginBottom:e.typography.pxToRem(5),padding:e.typography.pxToRem(10),borderRadius:e.typography.pxToRem(4),backgroundColor:e.palette.error.lighter}})))(Kw),Xw=e=>e.messagesContainer,Jw=e=>e.containerPropNameMain,Zw=e=>e.containerPropNameOnComplete,e_=e=>e.showOnComplete,t_=()=>(0,fg.Mz)(Xw,e_,Jw,Zw,((e,t,r,n)=>{if(e=e||{},!t)return e[r];return[...e[r]||[],...e[n]||[]]})),r_=(0,gs.Ng)((()=>{const e=t_();return(t,r)=>{const n=r.dataEntryKey,a=t.rulesEffectsGeneralErrors[n],o=t.dataEntriesUI&&t.dataEntriesUI[n]&&t.dataEntriesUI[n].saveAttempted;return{errors:e({messagesContainer:a,containerPropNameMain:"error",containerPropNameOnComplete:"errorOnComplete",showOnComplete:o})}}}),(()=>({})))(Qw);function n_(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const a_=n.A.t("Warnings");class o_ extends y.Component{constructor(){super(...arguments),n_(this,"renderHeader",(()=>{const{classes:e,warnings:t}=this.props,r=t?t.length:0;return y.createElement(zw,{icon:Db.A,text:a_,badgeClass:e.badge,badgeCount:r})})),n_(this,"renderItems",(e=>e.map((e=>y.createElement("div",{className:this.props.classes.warning,key:e.id},e.message)))))}render(){const{warnings:e}=this.props;return e&&e.length>0?y.createElement(Ww,{collapsable:!0,header:this.renderHeader()},this.renderItems(e)):null}}const i_=(0,I.withStyles)((e=>({badge:{backgroundColor:e.palette.warning.light},warning:{marginTop:e.typography.pxToRem(5),marginBottom:e.typography.pxToRem(5),padding:e.typography.pxToRem(10),borderRadius:e.typography.pxToRem(4),backgroundColor:e.palette.warning.lighter}})))(o_),s_=(0,gs.Ng)((()=>{const e=t_();return(t,r)=>{const n=r.dataEntryKey,a=t.rulesEffectsGeneralWarnings[n],o=t.dataEntriesUI&&t.dataEntriesUI[n]&&t.dataEntriesUI[n].saveAttempted;return{warnings:e({messagesContainer:a,containerPropNameMain:"warning",containerPropNameOnComplete:"warningOnComplete",showOnComplete:o})}}}),(()=>({})))(i_);var l_=r(14569);function d_(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c_=n.A.t("Feedback");class u_ extends y.Component{constructor(){super(...arguments),d_(this,"renderHeader",(e=>{const t=this.props.classes;return y.createElement(zw,{icon:l_.A,text:c_,badgeClass:t.badge,badgeCount:e})})),d_(this,"renderTextItems",((e,t)=>e.map((e=>y.createElement("div",{className:er()(t.feedback,t.textFeedback),key:e.id},e.message))))),d_(this,"renderKeyValueItems",((e,t)=>e.map((e=>y.createElement("div",{className:er()(t.feedback,t.keyValueFeedback),key:e.id},y.createElement("div",{className:t.keyValueFeedbackItem},e.key),y.createElement("div",{className:t.keyValueFeedbackItem},e.value)))))),d_(this,"getFeedbacks",(()=>this.props.feedbacks||{}))}render(){const e=this.props.classes,t=this.getFeedbacks(),r=t.displayTexts||[],n=t.displayKeyValuePairs||[],a=r.length+n.length;return a>0?y.createElement(Ww,{collapsable:!0,header:this.renderHeader(a)},this.renderTextItems(r,e),this.renderKeyValueItems(n,e)):null}}const p_=(0,I.withStyles)((e=>({badge:{backgroundColor:e.palette.grey.light},feedback:{marginTop:e.typography.pxToRem(5),marginBottom:e.typography.pxToRem(5),borderRadius:e.typography.pxToRem(4),backgroundColor:e.palette.grey.lighter,display:"flex"},textFeedback:{padding:e.typography.pxToRem(10)},keyValueFeedbackItem:{padding:e.typography.pxToRem(10)},keyValueFeedback:{alignItems:"center",justifyContent:"space-between"}})))(u_),m_=(0,gs.Ng)(((e,t)=>({feedbacks:e.rulesEffectsFeedback[t.dataEntryKey]})),(()=>({})))(p_);var g_=r(7097);function h_(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const E_=n.A.t("Indicators");class y_ extends y.Component{constructor(){super(...arguments),h_(this,"renderHeader",(e=>{const t=this.props.classes;return y.createElement(zw,{icon:g_.A,text:E_,badgeClass:t.badge,badgeCount:e})})),h_(this,"renderTextItems",((e,t)=>e.map((e=>y.createElement("div",{className:er()(t.indicator,t.textIndicator),key:e.id},e.message))))),h_(this,"renderKeyValueItems",((e,t)=>e.map((e=>y.createElement("div",{className:er()(t.indicator,t.keyValueIndicator),key:e.id},y.createElement("div",{className:t.keyValueIndicatorItem},e.key),y.createElement("div",{className:t.keyValueIndicatorItem},e.value)))))),h_(this,"getIndicators",(()=>this.props.indicators||{}))}render(){const e=this.props.classes,t=this.getIndicators(),r=t.displayTexts||[],n=t.displayKeyValuePairs||[],a=r.length+n.length;return a>0?y.createElement(Ww,{collapsable:!0,header:this.renderHeader(a)},this.renderTextItems(r,e),this.renderKeyValueItems(n,e)):null}}const v_=(0,I.withStyles)((e=>({badge:{backgroundColor:e.palette.grey.light},indicator:{marginTop:e.typography.pxToRem(5),marginBottom:e.typography.pxToRem(5),borderRadius:e.typography.pxToRem(4),backgroundColor:e.palette.grey.lighter,display:"flex"},textIndicator:{padding:e.typography.pxToRem(10)},keyValueIndicatorItem:{padding:e.typography.pxToRem(10)},keyValueIndicator:{alignItems:"center",justifyContent:"space-between"}})))(y_),f_=(0,gs.Ng)(((e,t)=>({indicators:e.rulesEffectsIndicators[t.dataEntryKey]})),(()=>({})))(v_);function I_(){return I_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},I_.apply(this,arguments)}function b_(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const S_=[{id:"ErrorsSection",Component:r_},{id:"WarningsSection",Component:s_},{id:"FeedbacksSection",Component:m_},{id:"IndicatorsSection",Component:f_}];class T_ extends y.Component{constructor(){super(...arguments),b_(this,"renderComponent",((e,t)=>{const{renderCardActions:r,...n}=t,a="WarningsSection"===e.id?t:n;return y.createElement(e.Component,I_({key:e.id},a))}))}render(){const{classes:e,...t}=this.props;return y.createElement(If,{offsetTop:50,containerClass:e.stickyOnScroll},y.createElement("div",null,S_.map((e=>this.renderComponent(e,t)))))}}const A_=(0,I.withStyles)((e=>({stickyOnScroll:{position:"relative",flexGrow:1,width:e.typography.pxToRem(300),margin:e.typography.pxToRem(10),marginTop:0}})))(T_),C_=(0,gs.Ng)(((e,t)=>{let{dataEntryId:r}=t;const{dataEntries:n}=e,a=!!n[r];return{ready:a,dataEntryKey:a?yf(r,e.dataEntries[r].itemId):null}}),(()=>({})))((e=>e.ready?y.createElement(A_,e):null)),O_=e=>{let{teiId:t,values:r,handleOnClick:a}=e;return y.createElement(ra.$,{small:!0,dataTest:"view-dashboard-button",onClick:()=>{a(t,r)}},n.A.t("Link"))},N_=e=>{let{onCancel:t,onSave:r,trackedEntityName:a}=e;return y.createElement(y.Fragment,null,y.createElement(ra.$,{onClick:t,secondary:!0},n.A.t("Cancel")),y.createElement("div",{style:{marginLeft:16}},y.createElement(ra.$,{dataTest:"create-as-new-person",onClick:r,primary:!0},n.A.t("Save as new {{trackedEntityName}}",{trackedEntityName:a,interpolation:{escapeValue:!1}}))))},R_=(0,qd.compose)(qm(),(0,I.withStyles)((()=>({container:{display:"flex",flexWrap:"wrap"},leftContainer:{flexGrow:10,flexBasis:0,margin:8}}))))((e=>{let{dataEntryId:t,itemId:r,onLink:a,onSave:o,onCancel:i,onGetUnsavedAttributeValues:s,trackedEntityName:l,trackedEntityTypeId:d,newRelationshipProgramId:c,classes:u}=e;const{resultsPageSize:p}=(0,y.useContext)(WC),m=(0,y.useCallback)((e=>{let{item:t}=e;return y.createElement(O_,{teiId:t.id,values:t.values,handleOnClick:a})}),[a]),g=(0,y.useCallback)(((e,t)=>y.createElement(N_,{onCancel:e,onSave:t,trackedEntityName:l})),[l]),h=(0,y.useCallback)((e=>{let{teiId:t,attributeValues:r}=e;return y.createElement(ra.$,{dataTest:"existing-unique-value-link-tei-button",primary:!0,onClick:()=>{a(t,r)}},n.A.t("Link"))}),[a]),E=(0,y.useCallback)((()=>{o(r,t)}),[o,r,t]);return y.createElement("div",{className:u.container},y.createElement("div",{className:u.leftContainer},y.createElement($w,null),y.createElement(yw,{onLink:a,onSave:E,onCancel:i,onGetUnsavedAttributeValues:s,duplicatesReviewPageSize:p,renderDuplicatesDialogActions:g,renderDuplicatesCardActions:m,ExistingUniqueValueDialogActions:h,trackedEntityTypeId:d})),y.createElement(C_,{dataEntryId:t,selectedScopeId:c,renderCardActions:e=>{let{item:t}=e;return y.createElement(O_,{teiId:t.id,values:t.values,handleOnClick:a})}}))})),w_=e=>{let{onLink:t,onSave:r,onCancel:n,onGetUnsavedAttributeValues:a}=e;const o="relationship",i=(0,gs.d4)((e=>{var t;let{dataEntries:r}=e;return null===(t=r[o])||void 0===t?void 0:t.itemId})),s=(0,gs.d4)((e=>{let{newRelationshipRegisterTei:t}=e;return t.error})),l=(0,gs.d4)((e=>{let{newRelationshipRegisterTei:{programId:t},newRelationship:{selectedRelationshipType:{to:{trackedEntityTypeId:r}}}}=e;return t||r})),{trackedEntityName:d,tetId:c}=es(l);return y.createElement(R_,{dataEntryId:o,itemId:i,onLink:t,onSave:r,onCancel:n,onGetUnsavedAttributeValues:a,trackedEntityName:d,trackedEntityTypeId:c,newRelationshipProgramId:l,error:s})},__="InitializeNewRelationship",P_="SelectRelationshipType",k_="DeselectRelationshipType",D_="SelectFindMode",U_="SetSearching",L_="UnsetSearching",F_=()=>l(__)({}),x_="InitializeRegisterTei",M_="InitializeRegisterTeiFailed",V_=(e,t)=>l(x_)({programId:e,orgUnit:t}),j_="TEI_SEARCH",G_="TEI_REGISTER",B_={[j_]:n.A.t("Search"),[G_]:n.A.t("Register")};const $_="NewRelationshipRegisterTeiDataEntryOpen",W_="NewRelationshopRegisterTeiDataEntryOpenCancelled",H_="NewRelationshopRegisterTeiDataEntryOpenFailed",z_=e=>l(H_)({errorMessage:e});var Y_=r(40395);var q_=r(8941);const K_=n.A.t("tracked entity instance");function Q_(e,t,r){const n=Object.keys(e),a=t.filter((e=>n.some((t=>t===e.id))&&e.displayInReports));return 0===a.length?r||K_:a.slice(0,2).map((t=>t.convertValue(e[t.id],Ci))).join(" ")}function X_(e,t){return e?function(e){const t=(0,it.x6)(e);return{form:t.enrollment.enrollmentForm,attributes:t.trackedEntityType.attributes,tetName:t.trackedEntityType.name}}(e):function(e){const t=(0,it.mu)(e);return{form:t.teiRegistration.form,attributes:t.attributes,tetName:t.name}}(t)}function J_(e,t,r){const n=yf(e,t),a=r.formsValues[n],{programId:o,orgUnit:i}=r.newRelationshipRegisterTei,s=r.newRelationship.selectedRelationshipType.to.trackedEntityTypeId,{attributes:l,form:d,tetName:c}=X_(o,s),u=function(e,t){return t.convertValues(e,Mi)}(a,d),p=Q_(u,l,c),m=d.convertValues(u,_i),g=function(e,t,r){const n=ad(e,t,r)||{},a=Object.keys(n).reduce(((e,r)=>{const a=n[r],o=t[r].type;return e[r]=_i(a,o),e}),{});return a}(r.dataEntriesFieldsValue[n],r.dataEntriesFieldsMeta[n],d),h=Object.keys(m).map((e=>({attribute:e,value:m[e]}))),E=o?{program:o,status:"ACTIVE",orgUnit:i.id,occurredAt:xl($()()),attributes:h,...g}:null,y=(v=m,Object.keys(v).find((e=>e.startsWith("FEATURETYPE_"))));var v;let f;y&&(f=function(e,t){if(!t[e])return;return{type:Ot(e.replace("FEATURETYPE_","").toLocaleLowerCase()),coordinates:t[e]}}(y,m),delete m[y]);return{data:{attributes:E?void 0:h,orgUnit:i.id,trackedEntityType:s,geometry:f,enrollments:E?[E]:[]},name:p,id:(0,q_.A)()}}const Z_="TeiSearchRequestFilterOrgUnits",eP="TeiSearchClearOrgUnitsFilter",tP="TeiSearchFilteredOrgUnitsRetrieved",rP="TeiSearchFilterOrgUnitsFailed",nP="TeiSearchSetOrgUnitScope",aP="TeiSearchSetOrgUnit";function oP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const iP=hr()(nm()(hm()(Pm()(pm()(jp))))),sP=hm()(Pm()(mp)),lP={labelContainerStyle:{paddingTop:12,flexBasis:200},inputContainerStyle:{flexBasis:150}},dP={labelContainerStyle:{paddingTop:13,flexBasis:200},inputContainerStyle:{flexBasis:150}},cP=[{name:"All accessible",value:"ACCESSIBLE"},{name:"Selected",value:"SELECTED"}];class uP extends y.Component{constructor(){super(...arguments),oP(this,"onSelectOrgUnitScope",(e=>{e&&this.props.onSelectOrgUnitScope(this.props.searchId,e)})),oP(this,"onSetOrgUnit",(e=>{this.props.onSetOrgUnit(this.props.searchId,e)})),oP(this,"renderOrgUnitScopeSelector",(()=>{const{selectedOrgUnitScope:e}=this.props;return y.createElement(sP,{options:cP,label:"Organisation unit scope",styles:dP,onSelect:this.onSelectOrgUnitScope,value:e})})),oP(this,"isValid",(()=>"ACCESSIBLE"===this.props.selectedOrgUnitScope||this.props.selectedOrgUnit)),oP(this,"getErrorMessage",(()=>!this.isValid()&&this.props.searchAttempted?n.A.t("Please select an organisation unit"):null)),oP(this,"handleFilterOrgUnits",(e=>{this.props.onFilterOrgUnits(this.props.searchId,e)})),oP(this,"renderOrgUnitField",(()=>{const{selectedOrgUnit:e,treeRoots:t,treeReady:r,treeKey:n,treeSearchText:a}=this.props;return y.createElement(iP,{label:"Organisation unit",styles:lP,searchText:a,roots:t,ready:r,treeKey:n,onBlur:this.onSetOrgUnit,value:e,validationAttempted:this.props.searchAttempted,errorMessage:this.getErrorMessage(),onSearch:this.handleFilterOrgUnits})}))}validateAndScrollToIfFailed(){const e=this.isValid();return e||this.goto(),e}goto(){if(this.gotoInstance){this.gotoInstance.scrollIntoView();const e=window.scrollY;e&&window.scroll(0,e-48)}}render(){const{selectedOrgUnitScope:e}=this.props;return y.createElement("div",{ref:e=>{this.gotoInstance=e}},this.renderOrgUnitScopeSelector(),"ACCESSIBLE"!==e&&this.renderOrgUnitField())}}function pP(){return pP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pP.apply(this,arguments)}const mP=(0,gs.Ng)(((e,t)=>{const r=t.searchId,n=$m(r)||$m("searchRoots");return{selectedOrgUnit:e.teiSearch[r].selectedOrgUnit,selectedOrgUnitScope:e.teiSearch[r].selectedOrgUnitScope,treeRoots:n,treeSearchText:e.teiSearch[r].orgUnitsSearchText,treeReady:!e.teiSearch[r].orgUnitsLoading,treeKey:e.teiSearch[r].orgUnitsSearchText||"initial"}}),(e=>({onFilterOrgUnits:(t,r)=>{const n=r?((e,t)=>l(Z_)({searchId:e,searchText:t}))(t,r):(e=>l(eP)({searchId:e}))(t);e(n)},onSetOrgUnit:(t,r)=>{e(((e,t)=>l(aP)({searchId:e,orgUnit:t}))(t,r))},onSelectOrgUnitScope:(t,r)=>{e(((e,t)=>l(nP)({searchId:e,orgUnitScope:t}))(t,r))}})))((e=>{const{innerRef:t,...r}=e;return y.createElement(uP,pP({ref:t},r))}));function gP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const hP=fm()(mP);class EP extends y.Component{constructor(){super(...arguments),gP(this,"validNumberOfAttributes",(()=>this.props.attributesWithValuesCount>=this.props.searchGroup.minAttributesRequiredToSearch)),gP(this,"handleSearchAttempt",(()=>{const{error:e,isValid:t}=this.validateForm();!e&&t?this.props.onSearch(this.props.id,this.props.searchGroupId):this.props.onSearchValidationFailed(this.props.id,this.props.searchGroupId)})),gP(this,"getUniqueSearchButtonText",(e=>`Search ${e.getElements()[0].formName}`)),gP(this,"renderOrgUnitSelector",(()=>y.createElement(hP,{innerRef:e=>{this.orgUnitSelectorInstance=e},searchId:this.props.searchId,searchAttempted:this.props.searchAttempted}))),gP(this,"renderMinAttributesRequired",(()=>{const{classes:e,searchAttempted:t,searchGroup:r}=this.props,a=t&&!this.validNumberOfAttributes(),o=er()(e.minAttributesRequired,{[e.minAttribtuesRequiredInvalid]:a});return y.createElement("div",{className:o},n.A.t("Fill in at least {{count}} attribute to search",{count:r.minAttributesRequiredToSearch,defaultValue:"Fill in at least {{count}} attribute to search",defaultValue_plural:"Fill in at least {{count}} attributes to search"}))}))}validateForm(){if(!this.formInstance)return S().error((0,j.px)(EP.errorMessages.SEARCH_FORM_MISSING)({Search:this})),{error:!0,isValid:!1};let e=this.formInstance.validateFormScrollToFirstFailedField({});return e&&!this.props.searchGroup.unique&&(e=this.orgUnitSelectorInstance.validateAndScrollToIfFailed()),e&&!this.props.searchGroup.unique&&(e=this.validNumberOfAttributes()),{isValid:e,error:!1}}render(){const{searchGroup:e,classes:t,id:r}=this.props,a=e&&e.searchForm;if(!a)return y.createElement("div",null,EP.errorMessages.SEARCH_FORM_MISSING);const o=e.unique?this.getUniqueSearchButtonText(a):n.A.t("Search by attributes");return y.createElement("div",{"data-test":"d2-form-area",className:t.container},y.createElement(Fy,{formRef:e=>{this.formInstance=e},formFoundation:e.searchForm,id:r}),!e.unique&&this.renderOrgUnitSelector(),y.createElement("div",{className:t.searchButtonContainer},y.createElement(ra.$,{dataTest:`relationship-tei-search-button-${r}`,onClick:this.handleSearchAttempt},o),!e.unique&&this.renderMinAttributesRequired()))}}gP(EP,"errorMessages",{NO_ITEM_SELECTED:"No item selected",SEARCH_FORM_MISSING:"search form is missing. see log for details"});const yP=(0,I.withStyles)((e=>({orgUnitSection:{backgroundColor:"white",padding:e.typography.pxToRem(8),maxWidth:e.typography.pxToRem(892)},searchButtonContainer:{padding:e.typography.pxToRem(10),display:"flex",alignItems:"center"},minAttributesRequired:{flexGrow:1,textAlign:"right",fontSize:e.typography.pxToRem(14)},minAttribtuesRequiredInvalid:{color:e.palette.error.main}})))(EP),vP=(e,t)=>{const r=e.formsValues[t]||{};return Object.keys(r).filter((e=>r[e])).length},fP=(0,gs.Ng)(((e,t)=>{const r=t.searchId,n=t.id;return{searchAttempted:(e.teiSearch[r]&&e.teiSearch[r][n]?e.teiSearch[r][n]:{}).validationFailed,attributesWithValuesCount:vP(e,n)}}),(()=>({})))(yP),IP=(0,qd.compose)((0,gs.Ng)(((e,t)=>{const r=e.teiSearch[t.id]||{},n=r.searchResults||{},a=e.formsValues[n.formId],o=t.searchGroups[parseInt(n.searchGroupId,10)];return{resultsLoading:n.resultsLoading,teis:n.teis||[],currentPage:n.currentPage,searchValues:a,selectedProgramId:r.selectedProgramId,selectedTrackedEntityTypeId:r.selectedTrackedEntityTypeId,searchGroup:o}}),(()=>({}))),Dp((()=>({padding:"100px 0"})),null,(e=>!e.resultsLoading)))((e=>{let{getResultsView:t,...r}=e;return y.createElement("div",null,t&&t(r))}));function bP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const SP=hm()(Pm()(zu)),TP={labelContainerStyle:{paddingTop:12,flexBasis:200},inputContainerStyle:{flexBasis:150}};class AP extends y.Component{constructor(){super(...arguments),bP(this,"onSelectProgram",(e=>{this.props.onSetProgram(this.props.searchId,e)}))}render(){return y.createElement(SP,{styles:TP,options:this.props.programOptions,onSelect:this.onSelectProgram,label:n.A.t("Selected program"),value:this.props.selectedProgramId})}}const CP="TeiSearchStartSetProgram",OP=(e,t)=>e.teiSearch[t.searchId].selectedTrackedEntityTypeId,NP=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(OP,(e=>Array.from(Nt.Jj.values()).filter((t=>t instanceof it.rr&&t.trackedEntityType.id===e&&t.access.data.read)).map((e=>({value:e.id,label:e.name})))));return(t,r)=>({selectedProgramId:t.teiSearch[r.searchId].selectedProgramId,programOptions:e(t,r)})}),(e=>({onSetProgram:(t,r)=>{e(((e,t)=>l(CP)({searchId:e,programId:t}))(t,r))}})))(AP);function RP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class wP extends y.Component{constructor(e){var t;super(e),t=this,RP(this,"getFormId",(e=>{const t=this.props.selectedProgramId||this.props.selectedTrackedEntityTypeId||"";return`${this.props.id}-${t}-${e}`})),RP(this,"handleSearch",((e,t)=>{const{id:r}=this.props;this.props.onSearch(e,t,r)})),RP(this,"handleSearchResultsChangePage",(e=>{this.props.onSearchResultsChangePage(this.props.id,e)})),RP(this,"handleNewSearch",(()=>{this.props.onNewSearch(this.props.id)})),RP(this,"handleEditSearch",(()=>{this.props.onEditSearch(this.props.id)})),RP(this,"handleSearchValidationFailed",(function(){const{id:e}=t.props;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];t.props.onSearchValidationFailed(...n,e)})),RP(this,"renderSearchForms",(e=>y.createElement("div",{className:this.props.classes.container},this.renderProgramSection(),this.renderSearchGroups(e)))),RP(this,"renderProgramSection",(()=>{const e=!this.state.programSectionOpen;return y.createElement(kc,{className:this.props.classes.programSection,isCollapsed:e,header:y.createElement(Lc,{containerStyle:{borderBottom:"1px solid #ECEFF1"},isCollapsed:e,onChangeCollapseState:()=>{this.setState({programSectionOpen:!!e})},title:n.A.t("Program")})},y.createElement(NP,{searchId:this.props.id}))})),RP(this,"onChangeSectionCollapseState",(e=>{this.props.openSearchGroupSection!==e?this.props.onSetOpenSearchGroupSection(this.props.id,e):this.props.onSetOpenSearchGroupSection(this.props.id,null)})),RP(this,"renderSearchGroups",(e=>e.map(((e,t)=>{const r=t.toString(),a=this.getFormId(r),o=e.unique?n.A.t("Search {{uniqueAttrName}}",{uniqueAttrName:e.searchForm.getElements()[0].formName}):n.A.t("Search by attributes"),i=this.props.openSearchGroupSection!==r;return y.createElement(kc,{"data-test":"search-by-attributes-forms",key:a,isCollapsed:i,className:this.props.classes.formContainerSection,header:y.createElement(Lc,{containerStyle:{borderBottom:"1px solid #ECEFF1"},onChangeCollapseState:()=>{this.onChangeSectionCollapseState(r)},isCollapsed:i,title:o})},y.createElement(fP,{id:a,searchId:this.props.id,searchGroupId:r,searchGroup:e,onSearch:this.handleSearch,onSearchValidationFailed:this.handleSearchValidationFailed}))})))),RP(this,"renderSearchResult",(()=>{const{id:e,searchGroups:t,getResultsView:r}=this.props;return y.createElement(WC.Provider,{value:{resultsPageSize:5}},y.createElement(IP,{id:e,onChangePage:this.handleSearchResultsChangePage,onNewSearch:this.handleNewSearch,onEditSearch:this.handleEditSearch,getResultsView:r,searchGroups:t}))})),this.state={programSectionOpen:!0}}render(){const e=this.props.searchGroups;return this.props.showResults?this.renderSearchResult():e?this.renderSearchForms(e):y.createElement("div",null)}}const _P=(0,fp.default)((e=>({container:{margin:e.typography.pxToRem(10)},programSection:{backgroundColor:"white",maxWidth:e.typography.pxToRem(900),marginBottom:e.typography.pxToRem(20)},formContainerSection:{maxWidth:e.typography.pxToRem(900),marginBottom:e.typography.pxToRem(20)}})))(wP),PP="BatchSetTeiSearchProgramAndTet",kP="ResetSearchForms",DP="InitializeTeiSearch",UP="RequestSearchTei",LP="SearchFormValidationFailed",FP="SearchTeiFailed",xP="SearchTeiResultRetrieved",MP="SetTeiSearchProgramAndTet",VP="TeiNewSearch",jP="TeiEditSearch",GP="TeiSearchResultsChangePage",BP="TeiSearchSetOpenSearchGroupSection",$P="SearchTrackedEntityInTETScope",WP=(e,t,r)=>l(DP)({searchId:e,programId:t,trackedEntityTypeId:r}),HP=(e,t,r)=>l(FP)({formId:e,searchGroupId:t,searchId:r}),zP=(e,t,r,n)=>l(xP)({data:e,formId:t,searchGroupId:r,searchId:n}),YP=(e,t,r)=>l(MP)({searchId:e,programId:t,trackedEntityTypeId:r});function qP(e,t){if(t){return(0,it.x6)(t).searchGroups}return(0,it.mu)(e).searchGroups}const KP=(e,t)=>e.teiSearch[t.id].selectedTrackedEntityTypeId,QP=(e,t)=>e.teiSearch[t.id].selectedProgramId,XP=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(KP,QP,((e,t)=>qP(e,t).sort(((e,t)=>e.unique===t.unique?0:e.unique?-1:1))));return(t,r)=>{const n=e(t,r),a=t.teiSearch[r.id];return{searchGroups:n,showResults:!!a.searchResults,selectedProgramId:a.selectedProgramId,selectedTrackedEntityTypeId:a.selectedTrackedEntityTypeId,openSearchGroupSection:a.openSearchGroupSection}}}),((e,t)=>({onSearch:(r,n,a)=>{e(((e,t,r,n)=>l(UP)({formId:e,searchGroupId:t,searchId:r,resultsPageSize:n}))(r,n,a,t.resultsPageSize))},onSearchResultsChangePage:(r,n)=>{e(((e,t,r)=>l(GP)({searchId:e,pageNumber:t,resultsPageSize:r}))(r,n,t.resultsPageSize))},onSearchValidationFailed:(t,r,n)=>{e(((e,t,r)=>l(LP)({formId:e,searchGroupId:t,searchId:r}))(t,r,n))},onNewSearch:t=>{e((e=>l(VP)({searchId:e}))(t))},onEditSearch:t=>{e((e=>l(jP)({searchId:e}))(t))},onSetOpenSearchGroupSection:(t,r)=>{e(((e,t)=>l(BP)({searchId:e,searchGroupId:t}))(t,r))}})))(_P),JP=e=>e.selectedTrackedEntityTypeId,ZP=e=>e.selectedProgramId;function ek(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const tk=LO()(Fo),rk=e=>{let{handleOnClick:t,teiId:r}=e;return y.createElement(ra.$,{small:!0,dataTest:`relationship-tei-link-${r}`,onClick:t},n.A.t("Link"))};class nk extends y.Component{constructor(e){super(e),ek(this,"onAddRelationship",(e=>{const t=((e,t)=>{if(e)return(0,it.x6)(e).enrollment.enrollmentForm;return(0,it.mu)(t).teiRegistration.form})(this.props.selectedProgramId,this.props.selectedTrackedEntityTypeId),r=(n=e.values,t.convertValues(n,_i));var n;this.props.onAddRelationship(e.id,r)})),ek(this,"renderResults",(()=>{const e=this.getAttributes(this.props),{teis:t,trackedEntityTypeName:r,selectedProgramId:a}=this.props;return y.createElement(y.Fragment,null,this.renderTopSection(),y.createElement(eN,{currentProgramId:a,items:t,dataElements:e,noItemsText:n.A.t("No {{trackedEntityTypeName}} found.",{trackedEntityTypeName:r,interpolation:{escapeValue:!1}}),renderCustomCardActions:e=>{let{item:t}=e;return y.createElement(rk,{teiId:t.id,handleOnClick:()=>this.onAddRelationship(t)})}}),this.renderPager())})),ek(this,"getSearchValues",(()=>{const{searchValues:e,searchGroup:t}=this.props,r=t.searchForm;return Object.keys(e).filter((t=>null!==e[t])).map((t=>{const n=r.getElement(t),a=e[t];return{name:n.formName,value:a,id:n.id,type:n.type}}))})),ek(this,"renderTopSection",(()=>{const{onNewSearch:e,onEditSearch:t,classes:r}=this.props;return y.createElement("div",{className:r.topSection},y.createElement(FO,{currentSearchTerms:this.getSearchValues()}),y.createElement("div",null,y.createElement(ra.$,{className:r.actionButton,onClick:e},n.A.t("New search")),y.createElement(ra.$,{className:r.actionButton,onClick:t},n.A.t("Edit search"))))})),ek(this,"renderPager",(()=>{const{onChangePage:e,currentPage:t,classes:r,teis:n}=this.props;return y.createElement(WC.Consumer,null,(a=>{let{resultsPageSize:o}=a;return y.createElement("div",{className:r.pagination},y.createElement(tk,{nextPageButtonDisabled:n.length<o,onChangePage:t=>e(t),currentPage:t}))}))})),this.getAttributes=(0,fg.Mz)(ZP,JP,((e,t)=>e?(0,it.x6)(e).attributes.filter((e=>e.displayInReports)):(0,it.mu)(t).attributes.filter((e=>e.displayInReports))))}render(){return y.createElement("div",null,this.renderResults())}}const ak=(0,I.withStyles)((e=>({itemActionsContainer:{paddingTop:e.typography.pxToRem(10)},pagination:{display:"flex",justifyContent:"flex-end",marginLeft:e.typography.pxToRem(8),maxWidth:e.typography.pxToRem(600)},topSection:{display:"flex",flexDirection:"column",margin:e.typography.pxToRem(8),marginRight:0,backgroundColor:e.palette.grey.lighter,maxWidth:e.typography.pxToRem(600)},topSectionValuesContainer:{padding:e.typography.pxToRem(10)},actionButton:{margin:e.typography.pxToRem(10),color:e.palette.primary.dark,borderRadius:0,border:`1px solid ${e.palette.primary.dark}`}})))(nk),ok=e=>e.selectedRelationshipType.to.trackedEntityTypeId;function ik(){return ik=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ik.apply(this,arguments)}function sk(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class lk extends y.Component{constructor(e){super(e),sk(this,"getTrackedEntityTypeName",(()=>{const e=this.trackedEntityTypeSelector(this.props);return e?e.name:"Tracked entity instance"})),sk(this,"handleAddRelationship",((e,t)=>{const r=this.trackedEntityTypeSelector(this.props);this.props.onAddRelationship({id:e,name:Q_(t,r.attributes,r.name)})})),sk(this,"handleAddRelationshipWithNewTei",((e,t)=>{this.props.onAddRelationship({itemId:e,dataEntryId:t})})),sk(this,"renderModeSelections",(()=>{const{classes:e}=this.props,t=this.getTrackedEntityTypeName();return y.createElement("div",{className:e.modeSelectionsContainer},y.createElement("div",{className:e.button},y.createElement(ra.$,{large:!0,dataTest:"find-relationship-button",color:"primary",onClick:()=>this.props.onSelectFindMode(j_)},y.createElement("span",{className:e.buttonIcon}," ",y.createElement(ow.A,null)," "),n.A.t("Link to an existing {{trackedEntityType}}",{trackedEntityType:t}))),y.createElement("div",{className:e.button},y.createElement(ra.$,{large:!0,dataTest:"create-relationship-button",color:"primary",onClick:()=>this.props.onSelectFindMode(G_)},y.createElement("span",{className:e.buttonIcon}," ",y.createElement(iw.A,null)," "),n.A.t("Create new {{trackedEntityType}}",{trackedEntityType:t,interpolation:{escapeValue:!1}}))))})),sk(this,"renderSearch",(e=>{const{selectedRelationshipType:t,onAddRelationship:r,...n}=e,a=this.getTrackedEntityTypeName();return y.createElement(XP,ik({resultsPageSize:5,id:"relationshipTeiSearch",getResultsView:e=>y.createElement(ak,ik({trackedEntityTypeName:a,onAddRelationship:this.handleAddRelationship},e))},n))})),sk(this,"renderRegister",(()=>y.createElement(WC.Provider,{value:{resultsPageSize:5}},y.createElement(w_,{onLink:this.handleAddRelationship,onSave:this.handleAddRelationshipWithNewTei,onCancel:this.props.onCancel,onGetUnsavedAttributeValues:this.props.onGetUnsavedAttributeValues})))),sk(this,"renderByMode",((e,t)=>e===j_?this.renderSearch(t):e===G_?this.renderRegister():null)),this.trackedEntityTypeSelector=(0,fg.Mz)(ok,(e=>(0,it.mu)(e)))}render(){const{classes:e,findMode:t,onOpenSearch:r,onSelectFindMode:n,...a}=this.props;return y.createElement("div",{className:e.container},t?this.renderByMode(t,a):this.renderModeSelections())}}const dk=(0,fp.default)((e=>({modeSelectionsContainer:{display:"flex"},button:{margin:e.typography.pxToRem(10),padding:e.typography.pxToRem(10),display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",backgroundColor:e.palette.grey.lighter},buttonIcon:{marginRight:yn.U.dp8}})))(lk);function ck(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class uk extends y.Component{constructor(){super(...arguments),ck(this,"renderForRelationshipType",(e=>{const{onSelectRelationshipType:t,findMode:r}=this.props,n=e.name;return y.createElement(y.Fragment,null,this.renderSlash(),r?y.createElement(y.Fragment,null,y.createElement(Mg,{onClick:()=>t(e)},n),this.renderForFindMode(r)):n)})),ck(this,"renderSlash",(()=>y.createElement("span",{style:{padding:5}},"/"))),ck(this,"renderForFindMode",(e=>{const{onSelectFindMode:t,searching:r}=this.props,n=B_[e];return y.createElement(y.Fragment,null,this.renderSlash(),r?y.createElement(y.Fragment,null,y.createElement(Mg,{onClick:()=>t(e)},n),this.renderForSearching()):n)})),ck(this,"renderForSearching",(()=>y.createElement(y.Fragment,null,this.renderSlash(),n.A.t("Search results"))))}render(){const{selectedRelationshipType:e,onInitializeNewRelationship:t,header:r}=this.props;return y.createElement("div",{style:{padding:10}},e?y.createElement(y.Fragment,null,y.createElement(Mg,{onClick:t},r),this.renderForRelationshipType(e)):r)}}const pk=(0,gs.Ng)((e=>({searching:e.newRelationship.searching})),(()=>({})))(uk);function mk(){return mk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mk.apply(this,arguments)}function gk(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const hk={TRACKED_ENTITY_INSTANCE:dk};class Ek extends y.Component{constructor(){super(...arguments),gk(this,"renderRelationship",((e,t)=>{const r=hk[e.to.entity];return y.createElement(r,mk({onAddRelationship:this.handleAddRelationship},t))})),gk(this,"handleAddRelationship",(e=>{const t=this.props.selectedRelationshipType;t&&this.props.onAddRelationship({id:t.id,name:t.name},e,t.to.entity)}))}render(){const{classes:e,onAddRelationship:t,...r}=this.props,n=this.props.selectedRelationshipType;return y.createElement("div",{className:this.props.classes.container},y.createElement(pk,r),!n&&y.createElement(aw,r),n&&this.renderRelationship(n,r))}}const yk=(0,fp.default)((()=>({container:{}})))(Ek),vk=(0,gs.Ng)((e=>({selectedRelationshipType:e.newRelationship.selectedRelationshipType,findMode:e.newRelationship.findMode})),(e=>({onInitializeNewRelationship:()=>{e(F_())},onSelectRelationshipType:t=>{e((e=>l(P_)({selectedRelationshipType:e}))(t))},onDeselectRelationshipType:()=>{e(l(k_)({}))},onSelectFindMode:t=>{e((e=>l(D_)({findMode:e}))(t))}})))(yk);function fk(){return fk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fk.apply(this,arguments)}function Ik(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class bk extends y.Component{constructor(e){super(e),Ik(this,"handleDiscard",(()=>{this.setState({discardDialogOpen:!0})})),Ik(this,"handleCancelDiscard",(()=>{this.setState({discardDialogOpen:!1})})),Ik(this,"renderHeader",(()=>y.createElement("div",{className:this.props.classes.headerContainer},y.createElement("div",{className:this.props.classes.header},n.A.t("New event relationship"))))),Ik(this,"onGetUnsavedAttributeValues",(e=>{const{unsavedRelationships:t}=this.props;return t.map((t=>{if(!t.to.data||!t.to.data.attributes)return null;const r=t.to.data.attributes.find((t=>t.attribute===e));return r&&r.value})).filter((e=>e))})),this.state={discardDialogOpen:!1}}render(){const{classes:e,onCancel:t,...r}=this.props;return y.createElement("div",null,y.createElement("div",{className:e.backToEventContainer},y.createElement("span",null,n.A.t("Adding relationship to event.")),y.createElement(Mg,{className:e.backToEventButton,onClick:this.handleDiscard},n.A.t("Go back to event without saving relationship"))),y.createElement(vR.Z,{className:e.newRelationshipPaper},y.createElement(vk,fk({header:n.A.t("New event relationship"),onGetUnsavedAttributeValues:this.onGetUnsavedAttributeValues,onCancel:t},r))),y.createElement(Rf,{header:n.A.t("Discard unsaved changes?"),text:n.A.t("Leaving this page will discard the selections you made for a new relationship"),destructiveText:n.A.t("Yes, discard changes"),cancelText:n.A.t("No, cancel"),onDestroy:()=>this.props.onCancel("relationship"),open:!!this.state.discardDialogOpen,onCancel:this.handleCancelDiscard}))}}const Sk=(0,fp.default)((e=>({headerContainer:{display:"flex",justifyContent:"space-between",alignItems:"center"},header:{flexGrow:1,...e.typography.title,fontSize:18,fontWeight:500,paddingLeft:8},newRelationshipPaper:{marginBottom:e.typography.pxToRem(10),padding:e.typography.pxToRem(10)},backToEventContainer:{padding:8,borderRadius:4,display:"inline-block",marginBottom:10,backgroundColor:"#E9EEF4",color:"#494949",fontSize:14},backToEventButton:{backgroundColor:"inherit",fontSize:"inherit",color:"inherit"}})))(bk),Tk=e=>e.currentSelections.programId,Ak=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(Tk,(e=>(0,it.n$)(e).stage.relationshipTypesWhereStageIsFrom.filter((e=>"TRACKED_ENTITY_INSTANCE"===e.to.entity))));return t=>{const r=e(t),n="singleEvent",a=yf(n,t.dataEntries[n].itemId);return{relationshipTypes:r,unsavedRelationships:t.dataEntriesRelationships[a]}}}),(e=>({onCancel:t=>{e((e=>l(ef)({dataEntryId:e}))(t))},onAddRelationship:(t,r,n)=>{e(((e,t,r)=>l(tf)({relationshipType:e,entity:t,entityType:r}))(t,r,n))}})))(Sk),Ck=(0,I.withStyles)((()=>({header:{flexGrow:1,fontSize:16,fontWeight:500},message:{marginTop:10}})))((e=>{let{title:t,message:r,classes:n}=e;return y.createElement(y.Fragment,null,y.createElement("div",{className:n.header},t),y.createElement("div",{className:n.message},y.createElement(OO,null,r)))}));class Ok extends y.Component{render(){const{classes:e,onCancel:t}=this.props;return y.createElement("div",null,y.createElement(Ck,{title:n.A.t("New event"),message:n.A.t("You don't have access to create an event in the current selections")}),y.createElement("div",{className:e.buttonRow},y.createElement("div",{className:e.buttonContainer},y.createElement(ra.$,{variant:"raised",color:"primary",disabled:!0},n.A.t("Save"))),y.createElement("div",{className:e.buttonContainer},y.createElement(ra.$,{variant:"text",color:"primary",onClick:t},n.A.t("Cancel")))))}}const Nk=(0,I.withStyles)((e=>({contents:{display:"flex",justifyContent:"center",alignItems:"center",paddingTop:50,paddingBottom:50},buttonRow:{display:"flex",flexWrap:"wrap",paddingTop:10,marginLeft:"-8px"},buttonContainer:{paddingRight:2*e.spacing.unit}})))(Ok),Rk=(0,gs.Ng)((()=>({})),(e=>({onCancel:()=>{e(Yv())}})))(Nk);function wk(){return wk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wk.apply(this,arguments)}function _k(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Pk=(e,t)=>class extends y.Component{constructor(e){super(e),_k(this,"handleDialogConfirm",(()=>{this.setState({dialogOpen:!1}),this.unblock(),this.props.history.goBack()})),_k(this,"handleDialogCancel",(()=>{this.setState({dialogOpen:!1})})),this.state={dialogOpen:!1}}componentDidMount(){const{history:e}=this.props;this.historyLength=window.history.length,this.unblock=e.block(((e,t)=>{const{inEffect:r}=this.props,n=window.history.length===this.historyLength;return"POP"!==t||!r||!n||(this.setState({dialogOpen:!0}),!1)}))}componentWillUnmount(){this.unblock&&this.unblock()}render(){const{inEffect:r,history:n,location:a,match:o,staticContext:i,...s}=this.props;return y.createElement(y.Fragment,null,y.createElement(e,s),y.createElement(Rf,wk({},t,{onDestroy:this.handleDialogConfirm,open:this.state.dialogOpen,onCancel:this.handleDialogCancel})))}},kk=()=>({}),Dk=(e,t)=>r=>{return(0,gs.Ng)((n=t,(e,t)=>({inEffect:n(e,t)})),kk)((0,T.y)(Pk(r,e)));var n},Uk=e=>e.currentSelections.programId,Lk=e=>e.currentSelections.categoriesMeta,Fk=e=>e.currentSelections.stageId,xk=(0,qd.compose)((e=>t=>{const r=(0,y.useRef)(!1),{selectedScopeId:n}=t,a=(0,gs.wA)(),o=(0,gs.d4)((e=>e.currentSelections.categories)),{isLoading:i,programCategory:s}=RS(n);return(0,y.useEffect)((()=>{i||r.current||(a((0,Xd.OJ)([...Xk(s,o)])),r.current=!0)}),[o,a,i,s]),y.createElement(e,t)}),(0,gs.Ng)((()=>{const e=(0,fg.Mz)(Uk,Lk,Fk,((e,t,r)=>e&&(0,it.$j)(e,r,t)));return(t,r)=>{let{id:n}=r;return{ready:t.dataEntries[n],showAddRelationship:!!t.newEventPage.showAddRelationship,eventAccess:e(t)}}}),(()=>({})),(e=>e)),Dp(),Dk(wf,(e=>Df(e,"singleEvent-newEvent")||e.newEventPage.showAddRelationship)))((e=>{let{showAddRelationship:t,eventAccess:r}=e;return r.write?y.createElement(y.Fragment,null,t?y.createElement(Ak,null):y.createElement(ew,null)):y.createElement(Rk,null)}));const Mk=Object.freeze({ACTIVE:"ACTIVE",COMPLETED:"COMPLETED",CANCELLED:"CANCELLED"}),Vk=e=>{let{programStageName:t,programStagesWithActiveEvents:r,programStagesWithoutAccess:a,onCancel:o,onCompleteEnrollmentAndEvents:i,onCompleteEnrollment:s}=e;return y.createElement(N.a,{position:"middle",large:!0,dataTest:"enrollment-complete-modal"},y.createElement(Ip.w,null,n.A.t("{{programStageName}} completed",{programStageName:t,interpolation:{escapeValue:!1}})),y.createElement(R.$,null,y.createElement("p",null,n.A.t("Would you like to complete the enrollment and all active events as well?")),0!==Object.keys(r).length&&y.createElement(y.Fragment,null,n.A.t("The following events will be completed:"),Object.keys(r).map((e=>{const{count:t,name:a}=r[e];return y.createElement("ul",{key:e},n.A.t("{{count}} event in {{programStageName}}",{count:t,defaultValue:"{{count}} event in {{programStageName}}",defaultValue_plural:"{{count}} events in {{programStageName}}",programStageName:a,interpolation:{escapeValue:!1}}))}))),0!==Object.keys(a).length&&y.createElement(y.Fragment,null,n.A.t("The following events will not be completed due to lack of access:"),Object.keys(a).map((e=>{const{count:t,name:r}=a[e];return y.createElement("ul",{key:e},n.A.t("{{count}} event in {{programStageName}}",{count:t,defaultValue:"{{count}} event in {{programStageName}}",defaultValue_plural:"{{count}} events in {{programStageName}}",programStageName:r,interpolation:{escapeValue:!1}}))}))),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:i,primary:!0},n.A.t("Yes, complete enrollment and events")),y.createElement(ra.$,{onClick:s,secondary:!0,dataTest:"enrollment-actions-complete-button"},n.A.t("Complete enrollment only")),y.createElement(ra.$,{onClick:o,secondary:!0},n.A.t("No, cancel"))))))},jk=e=>{let{programStageName:t,onCancel:r,onCompleteEnrollment:a}=e;return y.createElement(N.a,{position:"middle",large:!0},y.createElement(Ip.w,null,n.A.t("{{programStageName}} completed",{programStageName:t,interpolation:{escapeValue:!1}})),y.createElement(R.$,null,y.createElement("p",null,n.A.t("Would you like to complete the enrollment?")),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:a,primary:!0},n.A.t("Complete enrollment")),y.createElement(ra.$,{onClick:r,secondary:!0},n.A.t("No, cancel"))))))},Gk=e=>{let{programId:t,eventId:r,enrollment:n,events:a,onCancel:o,onCompleteEnrollment:i,hasActiveEvents:s,programStageName:l}=e;const{fromClientDate:d}=(0,A.Bp)(),c=(0,y.useMemo)((()=>[...(0,it.x6)(t).stages.values()]),[t]),{programStagesWithActiveEvents:u,programStagesWithoutAccess:p}=(0,y.useMemo)((()=>a.reduce(((e,t)=>{const{name:r,access:n}=c.find((e=>e.id===t.programStage))||{},a=n.data.write?"programStagesWithActiveEvents":"programStagesWithoutAccess";return t.status===Es.ACTIVE&&(e[a][t.programStage]?e[a][t.programStage].count+=1:e[a][t.programStage]={count:1,name:r}),e}),{programStagesWithActiveEvents:{},programStagesWithoutAccess:{}})),[a,c]),m=(0,y.useCallback)((()=>{const{events:e,...t}=n;i({...t,status:Mk.COMPLETED})}),[n,i]),g=(0,y.useCallback)((()=>{const e=d(new Date),t=new Date(e.getServerZonedISOString()),o=$()(t).format("YYYY-MM-DDTHH:mm:ss"),s=a.reduce(((e,t)=>{const{access:n}=c.find((e=>e.id===t.programStage))||{},a=r&&t.event===r;return t.status===Es.ACTIVE&&n.data.write&&!a?[...e,{...t,status:Es.COMPLETED,updatedAt:o}]:e}),[]),l={...n,status:Mk.COMPLETED,events:s};i(l)}),[a,c,n,i,d,r]);return s?y.createElement(Vk,{programStageName:l,programStagesWithActiveEvents:u,programStagesWithoutAccess:p,onCancel:o,onCompleteEnrollmentAndEvents:g,onCompleteEnrollment:m}):y.createElement(jk,{programStageName:l,onCancel:o,onCompleteEnrollment:m})},Bk=Object.freeze({LINKABLE:"LINKABLE",AMBIGUOUS_RELATIONSHIPS:"AMBIGUOUS_RELATIONSHIPS"}),$k=Object.freeze({SCHEDULE_IN_ORG:"SCHEDULE_IN_ORG",LINK_EXISTING_RESPONSE:"LINK_EXISTING_RESPONSE",ENTER_DATA:"ENTER_DATA"}),Wk={[$k.SCHEDULE_IN_ORG]:n.A.t("Schedule"),[$k.ENTER_DATA]:n.A.t("Enter details now"),[$k.LINK_EXISTING_RESPONSE]:n.A.t("Link to an existing")};function Hk(){return Hk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Hk.apply(this,arguments)}const zk=()=>e=>(e=>t=>{const{askCompleteEnrollmentOnEventComplete:r,onSave:n,isCompleted:a,onSaveAndCompleteEnrollment:o,eventId:i,relatedStageRef:s,...l}=t,d=(0,gs.d4)((e=>{let{enrollmentDomain:t}=e;return null===t||void 0===t?void 0:t.enrollment})),c=null===d||void 0===d?void 0:d.events,u=(0,y.useMemo)((()=>null===c||void 0===c?void 0:c.some((e=>e.status===Es.ACTIVE))),[c]),[p,m]=(0,y.useState)(!1),g=(0,y.useRef)({});return y.createElement(y.Fragment,null,y.createElement(e,Hk({},l,{relatedStageRef:s,askCompleteEnrollmentOnEventComplete:r,onSave:(e,t,o,i)=>{var l,d;const{linkMode:c}=null!==(l=null===s||void 0===s||null===(d=s.current)||void 0===d?void 0:d.getLinkedStageValues())&&void 0!==l?l:{};g.current={itemId:e,dataEntryId:t,formFoundation:o,saveType:i},r&&(a||i===sb.COMPLETE)&&c!==$k.ENTER_DATA?m(!0):n(e,t,o,i)},isCompleted:a})),p&&y.createElement(Gk,{programId:null===d||void 0===d?void 0:d.program,eventId:i,onCancel:()=>{m(!1);const{itemId:e,dataEntryId:t,formFoundation:r,saveType:a}=g.current;n(e,t,r,a)},onCompleteEnrollment:e=>{m(!1);const{itemId:t,dataEntryId:r,formFoundation:n}=g.current;o(t,r,n,e)},enrollment:d,events:c,hasActiveEvents:u,programStageName:l.formFoundation.name}))})(e),Yk="singleEvent",qk="newEvent",Kk=yf(Yk,qk),Qk=[{id:"occurredAt",type:"DATE",validatorContainers:bI()},{clientId:"geometry",dataEntryId:"geometry",onConvertOut:UT},{id:"note",type:"TEXT",validatorContainers:VI(),clientIgnore:!0},{id:"relationship",type:"TEXT",clientIgnore:!0},{clientId:"status",dataEntryId:"complete",onConvertIn:FT,onConvertOut:xT},{id:"assignee"}],Xk=(e,t)=>{let r;return e&&e.categories&&Qk.push(...e.categories.map((t=>({id:`attributeCategoryOptions-${t.id}`,type:"TEXT",validatorContainers:TT({categories:e.categories},t.id)})))),t&&(r=Object.keys(t).reduce(((e,r)=>(e[`attributeCategoryOptions-${r}`]=t[r],e)),{})),[...pS(Yk,qk,Qk,r),My(Kk,{})]},Jk=e=>{let{state:t,program:r,formFoundation:n,orgUnit:a}=e;const o={...od(t,n,Kk),...id(t,qk,Yk,n),programStageId:n.id},i=Jl({program:r,orgUnit:a,currentEvent:o});return ld(i,Kk)},Zk="occurredAt",eD="status",tD="assignee",rD=e=>{const t=[{id:Zk,visible:!0,isMainProperty:!0,type:it.CO.DATE},{id:eD,header:"Status",visible:!0,isMainProperty:!0,type:it.CO.TEXT,singleSelect:!0,options:[{text:n.A.t("Active"),value:"ACTIVE"},{text:n.A.t("Completed"),value:"COMPLETED"}]}],r=[];if(e.enableUserAssignment){const e={id:tD,type:"ASSIGNEE",apiName:"assignedUser",header:"Assigned to",visible:!0,isMainProperty:!0};r.push(e)}return[...t,...r]},nD="newRecentlyAddedEvent",aD="ListItemPrepend",oD="ListItemRemove",iD="ListReset",sD=(e,t)=>l(aD)({listId:e,itemId:t}),lD=(e,t)=>l(oD)({listId:e,itemId:t});var dD=r(64859);const cD="CrossPage.SelectionsCompletenessCalculate",uD="CrossPage.AfterSettingOrgUnitSkipCategoriesReset",pD="CrossPage.AfterSettingOrgUnitDoCategoriesReset",mD="currentSelections.UpdateShowAccessibleStatus",gD={LOADING_START:"LockedSelector.Loading",FROM_URL_UPDATE:"LockedSelector.FromUrlUpdate",FROM_URL_UPDATE_COMPLETE:"LockedSelector.FromUrlUpdateComplete",FROM_URL_CURRENT_SELECTIONS_VALID:"LockedSelector.FromUrlQueriesValid",FROM_URL_CURRENT_SELECTIONS_INVALID:"LockedSelector.FromUrlQueriesInvalid",EMPTY_ORG_UNIT_SET:"LockedSelector.EmptyOrgUnitSet",FETCH_ORG_UNIT:"LockedSelector.FetchOrgUnit",FETCH_ORG_UNIT_SUCCESS:"LockedSelector.FetchOrgUnitSuccess",FETCH_ORG_UNIT_ERROR:"LockedSelector.FetchOrgUnitError"},hD=e=>l(gD.FROM_URL_UPDATE)(e),ED=e=>l(gD.FROM_URL_CURRENT_SELECTIONS_INVALID)({error:e}),yD=e=>l(gD.FETCH_ORG_UNIT_SUCCESS)(e),vD={NEW_PAGE_OPEN:"NewPage.NewPageOpen",NEW_PAGE_WITHOUT_ORG_UNIT_SELECTED_VIEW:"NewPage.WithoutOrgUnitSelectedView",NEW_PAGE_WITHOUT_PROGRAM_CATEGORY_SELECTED_VIEW:"NewPage.WithoutProgramComboSelectedView",NEW_PAGE_CATEGORY_OPTION_INVALID_FOR_ORG_UNIT_VIEW:"NewPage.InvalidCategoryOptionSelectedView",NEW_PAGE_DEFAULT_VIEW:"NewPage.DefaultView",CLEAN_UP_DATA_ENTRY:"NewPage.DataEntryCleanUp",CATEGORY_OPTION_SET:"NewPage.CategoryOptionSet",CATEGORY_OPTION_RESET:"NewPage.CategoryOptionReset",ALL_CATEGORY_OPTIONS_RESET:"NewPage.AllCategoryOptionsReset",CLEAN_UP_UID:"NewPage.CleanUpUid"},fD=e=>l(vD.CLEAN_UP_DATA_ENTRY)({dataEntryId:e}),ID=()=>l(vD.CLEAN_UP_UID)({}),bD=(e,t,r,n,a,o)=>{const i=e.value,s=yf(t,r),l=i.currentSelections.programId,d=(0,VO.n$)(l),c=d.stage.stageForm,u=c.id,p={...od(i,c,s,o),...id(i,r,t,c),programStageId:u},m=Jl({program:d,orgUnit:a,currentEvent:p});return(0,Xd.OJ)([ld(m,s),av(t,r,n)],mv)};function SD(e,t,r,n){return{formClientValues:e.convertValues(t,Mi),dataEntryClientValues:ad(r,n,e)}}const TD=(e,t)=>{const r=Object.keys(e).filter((e=>e.startsWith("attributeCategoryOptions-")));if(r.length>0){const n=(0,j.L8)(t,j.Gv.newAocApiSeparator),a=[];return r.forEach((t=>{a.push(e[t]),delete e[t]})),{...e,attributeCategoryOptions:a.join(n?",":";")}}return e},AD={completedAt:"completedAt",completedBy:"completedBy"};function CD(e,t){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;return Object.keys(e).reduce(((a,o)=>{if(n&&n[o])return a;const i=r(o,e[o]);return a[t[o]||o]=i,a}),{})}(e=TD(e,t),{eventId:"event",programId:"program",programStageId:"programStage",orgUnitId:"orgUnit",trackedEntityId:"trackedEntity",enrollmentId:"enrollment",assignee:"assignedUser"},((e,t)=>{let r;switch(e){case"occurredAt":case"scheduledAt":r=_i(t,it.CO.DATE);break;case"assignee":r=t&&_i(t,it.CO.ASSIGNEE);break;default:r=t}return r}),AD)}const OD=(e,t)=>{if(!e)return null;const r=(0,j.L8)(t,j.Gv.newAocApiSeparator);return{attributeCategoryOptions:Object.keys(e).map((t=>e[t])).join(r?",":";")}},ND=(e,t,r,n,a)=>{const o=t.convertValues(r,_i);return{events:[{...CD(n,a),program:e.currentSelections.programId,programStage:t.id,orgUnit:e.currentSelections.orgUnitId,...OD(e.currentSelections.categories,a),dataValues:Object.keys(o).map((e=>({dataElement:e,value:o[e]}))).filter((e=>{let{value:t}=e;return null!=t}))}]}};function RD(e,t){const r=e.dataEntriesNotes&&e.dataEntriesNotes[t];return r?r.map((e=>({value:e.value}))):[]}const wD=(e,t,r)=>{const n=e.formsValues[t],a=e.dataEntriesFieldsValue[t],o=e.dataEntriesFieldsMeta[t],{formClientValues:i,dataEntryClientValues:s}=SD(r,n,a,o);return{formClientValues:i,mainDataClientValues:{...s,notes:RD(e,t)}}};var _D=r(62110);const PD={TRACKED_ENTITY_INSTANCE:e=>({trackedEntity:{trackedEntity:e}}),PROGRAM_STAGE_INSTANCE:e=>({event:{event:e}})};function kD(e){return{relationshipType:e.relationshipType.id,from:PD[e.from.type](e.from.id),to:PD[e.to.type](e.to.id)}}const DD="singleEvent",UD="newEvent",LD=yf(DD,UD),FD=(e,t,r)=>{const n=e.find((e=>e.to.data));if(n){return((e,t,r,n,a)=>l(xv)({selections:t},{offline:{effect:{url:"tracker?async=false",method:oc,data:e},commit:{type:Mv,meta:{selections:t,triggerAction:r,relationshipData:n,relationshipClientId:a}},rollback:{type:Vv,meta:{selections:t,triggerAction:r}}}}))({trackedEntities:[{...n.to.data}]},t,r,e,n.clientId)}return((e,t,r)=>l(Dv)({selections:t},{offline:{effect:{url:"tracker?async=false",method:oc,data:e},commit:{type:Uv,meta:{selections:t,triggerAction:r}},rollback:{type:Lv,meta:{selections:t,triggerAction:r}}}}))({relationships:e.map(kD)},t,r)},xD=(e,t)=>{let{payload:{formId:r}}=t;const n=Object.keys(e).filter((e=>!e.includes(r)));return n.reduce(((t,r)=>({...t,[r]:e[r]})),{})},MD=(e,t)=>{let{payload:{dataEntryId:r}}=t;return Object.keys(e).reduce(((t,n)=>n.startsWith(r)?{...t,[n]:{}}:{...t,[n]:e[n]}),{})},VD=rc({[xy.FORM_DATA_ADD]:(e,t)=>{const r={...e},n=t.payload;return r[n.formId]=n.formValues,r},[vy]:(e,t)=>{const r={...e},n=t.payload;return(r[n.formId]={...r[n.formId]})[n.elementId]=n.value,r},[bc]:(e,t)=>{const{formId:r,elementId:n,value:a}=t.payload;return{...e,[r]:{...e[r],[n]:a}}},[Hy]:(e,t)=>{const r={...e},n=t.payload;return(r[n.formId]={...r[n.formId]})[n.elementId]=n.value,r},[sd]:(e,t)=>{const r=t.payload.rulesEffects&&t.payload.rulesEffects[Ls.ASSIGN_VALUE];if(!r)return e;const n=t.payload,a={...e,[n.formId]:{...e[n.formId],...Object.keys(r).reduce(((e,t)=>{const n=r[t],a=n[n.length-1].value;return e[t]=a,e}),{})}};return a},[xy.FORM_DATA_REMOVE]:xD,[vD.CLEAN_UP_DATA_ENTRY]:MD,[ef]:MD},"formsValues"),jD=rc({[xy.FORM_DATA_ADD]:(e,t)=>{const r={...e},n=t.payload.formId;return r[n]&&delete r[n],r},[vc]:(e,t)=>{const r={...e},n=t.payload;return r[n.formId]=Object.keys(n.fieldsUI).reduce(((e,t)=>(e[t]={...e[t],...n.fieldsUI[t],validatingMessage:null},e)),{...r[n.formId]}),r},[vy]:(e,t)=>{const r={...e},n=t.payload;r[n.sectionId]={...r[n.sectionId]};const a=r[n.sectionId];return a[n.elementId]={...a[n.elementId],...n.uiState,modified:!0,validatingMessage:null},r},[Ic]:(e,t)=>{const{formBuilderId:r,elementId:n}=t.payload;return{...e,[r]:{...e[r],[n]:{...e[r]&&e[r][n],loading:!0}}}},[bc]:(e,t)=>{const{uiState:r,formBuilderId:n,elementId:a}=t.payload;return{...e,[n]:{...e[n],[a]:{...e[n]&&e[n][a],...r,modified:!0,validatingMessage:null,loading:!1}}}},[Sc]:(e,t)=>{const{uiState:r,formBuilderId:n,elementId:a,errorMessage:o}=t.payload;return{...e,[n]:{...e[n],[a]:{...e[n]&&e[n][a],...r,modified:!0,validatingMessage:null,loading:!1,warning:o}}}},[Hy]:(e,t)=>{const r={...e},n=t.payload,a=r[n.formId];return a[n.elementId]={...a[n.elementId],...n.uiState,modified:!0,validatingMessage:null},r},[gu]:(e,t)=>{const r={...e},n=t.payload;r[n.sectionId]={...r[n.sectionId]};const a=r[n.sectionId];return a[n.elementId]={...a[n.elementId],...n.uiState},r},[fc]:(e,t)=>{const{fieldId:r,formId:n,message:a,fieldUIUpdates:o}=t.payload;return{...e,[n]:{...e[n],[r]:{...e[n]&&e[n][r],...o,validatingMessage:a}}}},[xy.FORM_DATA_REMOVE]:xD,[vD.CLEAN_UP_DATA_ENTRY]:MD,[sd]:(e,t)=>{const{formId:r,rulesEffects:n}=t.payload,a=e[r],o=n&&n[Ls.ASSIGN_VALUE];if(!o||!a)return e;const i=Object.keys(o).reduce(((e,t)=>(a[t]&&(e[t]={valid:!0,errorData:void 0,errorMessage:void 0,errorType:void 0,modified:!0,touched:!0,validatingMessage:null}),e)),{});return{...e,[r]:{...e[r],...i}}}},"formsSectionsFieldsUI"),GD=rc({[xy.FORM_DATA_ADD]:(e,t)=>{const r=t.payload,n=e[r.formId]&&e[r.formId].loadNr;let a;return a=n?999===n?1:n+1:1,{...e,[r.formId]:{...e[r.formId],loadNr:a}}},[xy.FORM_DATA_REMOVE]:xD},"forms"),BD=rc({[xy.FORM_DATA_ADD]:(e,t)=>({...e,[t.payload.formId]:{}}),[Qg]:(e,t)=>{const{formId:r,elementId:n,searchText:a}=t.payload;return{...e,[r]:{...e[r],[n]:{...e[r][n],orgUnitsLoading:!0,orgUnitsSearchText:a}}}},[Xg]:(e,t)=>{const{formId:r,elementId:n,roots:a}=t.payload;return{...e,[r]:{...e[r],[n]:{...e[r][n],orgUnitsLoading:!1,orgUnitsRoots:a}}}},[Jg]:(e,t)=>{const{formId:r,elementId:n}=t.payload;return{...e,[r]:{...e[r],[n]:{...e[r][n],orgUnitsLoading:!1}}}},[Zg]:(e,t)=>{const{formId:r,elementId:n}=t.payload;return{...e,[r]:{...e[r],[n]:{...e[r][n],orgUnitsLoading:!1,orgUnitsRoots:null,orgUnitsSearchText:null}}}},[xy.FORM_DATA_REMOVE]:xD},"formsFieldsMisc"),$D="EnrollmentLoaded",WD="EnrollmentLoadFailed",HD="EditEventFromUrl",zD="EventFromUrlRetrievedForEditEvent",YD="EventFromUrlCouldNotBeRetrievedForEditEvent",qD="OrgUnitRetrievalFailedForEditEventOnUrlUpdate",KD="AddEventNote",QD="RemoveEventNote",XD=e=>l(YD)(e),JD=(e,t)=>l(KD)({eventId:e,note:t}),ZD="ViewEventFromUrl",eU="EventFromUrlRetrievedForViewEvent",tU="EventFromUrlCouldNotBeRetrievedForViewEvent",rU="OrgUnitRetrievedForViewEventOnUrlUpdate",nU="OrgUnitRetrievalFailedForViewEventOnUrlUpdate",aU="StartOpenEventForView",oU="AddEventNoteForViewEvent",iU="RemoveEventNoteForViewEvent",sU="UpdateWorkingListOnBackToMainPageForViewEvent",lU="NoWorkingListUpdateNeededOnBackToMainPageForViewEvent",dU="StartGoBackToMainPageForViewEvent",cU="ViewEventOpenAddRelationship",uU="UpdateWorkingListPendingOnBackToMainPageForViewEvent",pU="OpenViewEventPageFailed",mU="InitializeWorkingListsOnBackToMainPage",gU="SingleEvent.AssigneeSet",hU="SingleEvent.AssigneeSaveFailed",EU=e=>l(ZD)({eventId:e.nextProps.viewEventId||e.nextProps.eventId,page:e.nextPage}),yU=e=>l(tU)({error:e}),vU=()=>l(lU)(),fU=()=>l(mU)(),IU=e=>l(pU)({error:e}),bU=rc({[$D]:(e,t)=>{const r=t.payload;if(!r||0===r.length)return e;const n=r.reduce(((e,t)=>(e[t.id]=t.event,e)),{});return{...e,...n}},[Gy]:(e,t)=>{const r={...e},n=t.payload;return r[n.eventId]=n.event,r},[Vy]:(e,t)=>{const r={...e},n=t.payload;return r[n.eventId]=n.event,r},[zD]:(e,t)=>{const r=t.payload.eventContainer.event;return{...e,[r.eventId]:r}},[eU]:(e,t)=>{const r=t.payload.eventContainer.event;return{...e,[r.eventId]:r}},[oU]:(e,t)=>{const r={...e},n=t.payload;return r[n.eventId]&&(r[n.eventId].notes=[...e[n.eventId].notes,n.note]),r},[iU]:(e,t)=>{const r={...e},n=t.payload;return r[n.eventId]&&(r[n.eventId].notes=e[n.eventId].notes.filter((e=>e.clientId!==n.noteClientId))),r}},"events",{}),SU=rc({[$D]:(e,t)=>{const r=t.payload;if(!r||0===r.length)return e;const n=r.reduce(((e,t)=>(e[t.id]=t.values,e)),{});return{...e,...n}},[Vy]:(e,t)=>{const r={...e};return r[t.payload.eventId]=t.payload.clientValues,r},[Gy]:(e,t)=>{const r={...e};return r[t.payload.eventId]=t.payload.clientValues,r}},"eventsValues",{}),TU=(e,t)=>{let{payload:{dataEntryId:r}}=t;return Object.keys(e).reduce(((t,n)=>n.startsWith(r)?{...t,[n]:{}}:{...t,[n]:e[n]}),{})},AU=rc({[uS]:(e,t)=>{const r={...e},n=t.payload;return r[n.dataEntryId]={...r[n.dataEntryId]},r[n.dataEntryId].itemId=n.itemId,r},[ev]:(e,t)=>{const r={...e},n=t.payload;return r[n.dataEntryId]={...r[n.dataEntryId],itemId:n.itemId,...n.extraProps},r},[Ky]:(e,t)=>{const r={...e},n=t.payload;return r[n.dataEntryId]={...r[n.dataEntryId],itemId:n.itemId,...n.extraProps},r},[tv]:TU},"dataEntries"),CU=rc({[uS]:(e,t)=>{const r={...e};return r[t.payload.key]={loaded:!0},r},[ev]:(e,t)=>{const r={...e};return r[t.payload.key]={loaded:!0},r},[By]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.id,n.itemId);return r[a]={...r[a]},r[a].saveAttempted=!0,r},[$y]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.id,n.itemId);return r[a]={...r[a]},r[a].saveAttempted=!0,r},[Hy]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.dataEntryId,n.itemId);return r[a]={...r[a]},r[a].inProgress=r[a].inProgress?r[a].inProgress+1:1,r},[zy]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.dataEntryId,n.itemId);return r[a]={...r[a]},r[a].inProgress=r[a].inProgress?r[a].inProgress-1:0,r}},"dataEntriesUI"),OU=rc({[uS]:(e,t)=>{const r={...e},{dataEntryValues:n,key:a}=t.payload;return r[a]=n||{},r},[ev]:(e,t)=>{const r={...e},n=t.payload;return r[n.key]=n.dataEntryValues,r},[Wy]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.dataEntryId,n.itemId);r[a]={...r[a]};return r[a][n.fieldId]=n.value,r},[vD.CLEAN_UP_DATA_ENTRY]:TU,[ef]:TU},"dataEntriesFieldsValue"),NU=rc({[uS]:(e,t)=>{const r={...e};return r[t.payload.key]=[],r},[ev]:(e,t)=>{const r={...e},n=t.payload;return r[n.key]=n.dataEntryNotes?[...n.dataEntryNotes]:[],r},[Yy]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.dataEntryId,n.itemId),o=e[a]?e[a].length:0;return r[a]=[...e[a],{...n.note,key:o}],r},[qy]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.dataEntryId,n.itemId);return r[a]=e[a].filter((e=>e.clientId!==n.noteClientId)),r}},"dataEntriesNotes",{}),RU=rc({[uS]:(e,t)=>{const r={...e},n=t.payload;return r[n.key]=n.dataEntryMeta,r},[ev]:(e,t)=>{const r={...e},n=t.payload;return r[n.key]=n.dataEntryMeta,r}},"dataEntriesFieldsMeta"),wU=rc({[uS]:(e,t)=>{const r={...e},n=t.payload;return r[n.key]=Object.keys(n.dataEntryUI).reduce(((e,t)=>(e[t]={...n.dataEntryUI[t],touched:!1},e)),{}),r},[ev]:(e,t)=>{const r={...e},n=t.payload;return r[n.key]=Object.keys(n.dataEntryUI).reduce(((e,t)=>(e[t]={...n.dataEntryUI[t],touched:!1},e)),{}),r},[Wy]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.dataEntryId,n.itemId);r[a]={...r[a]};const o=r[a];return o[n.fieldId]={...o[n.fieldId],...n.valueMeta,modified:!0},r},[vD.CLEAN_UP_DATA_ENTRY]:TU,[ef]:TU},"dataEntriesFieldsUI"),_U=rc({[uS]:(e,t)=>{const r={...e};return r[t.payload.key]=[],r},[ev]:(e,t)=>{const r={...e},n=t.payload;return r[n.key]=n.dataEntryRelationships?[...n.dataEntryRelationships]:[],r},[Jy]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.dataEntryId,n.itemId);return r[a]=e[a]?[...e[a],{...n.relationship}]:[{...n.relationship}],r},[Xy]:(e,t)=>{const r={...e},n=t.payload,a=yf(n.dataEntryId,n.itemId);return r[a]=e[a].filter((e=>e.clientId!==n.relationshipClientId)),r}},"dataEntriesRelationships",{}),PU=rc({[uS]:(e,t)=>{const{key:r}=t.payload;return{...e,[r]:null}},[ev]:(e,t)=>{const{key:r}=t.payload;return{...e,[r]:null}},[fc]:(e,t)=>{const{formId:r,validatingUid:n}=t.payload,a=[...e[r]||[],n],o=new Set(a);return{...e,[r]:Array.from(o)}},[vc]:(e,t)=>{const{formId:r,validatingUids:n}=t.payload,a=(e[r]||[]).filter((e=>!n.includes(e)));return{...e,[r]:a}},[Hy]:(e,t)=>{const{formId:r,updateCompleteUid:n}=t.payload,a=(e[r]||[]).filter((e=>e!==n));return{...e,[r]:a}},[Ic]:(e,t)=>{const{formId:r,uid:n}=t.payload;return{...e,[r]:[...e[r]||[],n]}},[bc]:(e,t)=>{const{formId:r,uid:n}=t.payload,a=(e[r]||[]).filter((e=>e!==n));return{...e,[r]:a}},[Sc]:(e,t)=>{const{formId:r,uid:n}=t.payload,a=(e[r]||[]).filter((e=>e!==n));return{...e,[r]:a}},[Qy]:(e,t)=>{const{dataEntryId:r,itemId:n,uid:a}=t.payload,o=yf(r,n);return{...e,[o]:[...e[o]||[],a]}},[zy]:(e,t)=>{const{dataEntryId:r,itemId:n,uid:a}=t.payload,o=yf(r,n),i=(e[o]||[]).filter((e=>e!==a));return{...e,[o]:i}}},"dataEntriesInProgressList"),kU="WorkingListsTemplateAddSuccessBatchAction",DU="WorkingListsTemplatesFetch",UU="WorkingListsTemplatesFetchSuccess",LU="WorkingListsTemplatesFetchError",FU="WorkingListsTemplatesFetchCancel",xU="WorkingListsTemplateSelect",MU="WorkingListsTemplateAdd",VU="WorkingListsTemplateAddSuccess",jU="WorkingListsTemplateAddError",GU="WorkingListsTemplateDelete",BU="WorkingListsTemplateDeleteSuccess",$U="WorkingListsTemplateDeleteError",WU="WorkingListsTemplateUpdate",HU="WorkingListsTemplateUpdateSuccess",zU="WorkingListsTemplateUpdateError",YU="WorkingListsTemplateDefaultUpdate",qU="WorkingListsListViewInit",KU="WorkingListsListViewInitSuccess",QU="WorkingListsListViewInitError",XU="WorkingListsListViewInitCancel",JU="WorkingListsListUpdate",ZU="WorkingListsListUpdateSuccess",eL="WorkingListsListUpdateError",tL="WorkingListsListUpdateCancel",rL="WorkingListsContextUnloading",nL="WorkingListsListSort",aL="WorkingListsListColumnOrderSet",oL="WorkingListsListColumnOrderReset",iL="WorkingListsFilterSet",sL="WorkingListsFilterRemove",lL="WorkingListsFilterClear",dL="WorkingListsFiltersClear",cL="WorkingListsRestMenuItemSelect",uL="WorkingListsStickyFiltersAfterColumnSortingSet",pL="WorkingListsPageChange",mL="WorkingListsRowsPerPageChange",gL="WorkingListsTemplateSharingSettingsSet",hL=(e,t,r,n)=>l(DU)({programId:e,storeId:t,selectedTemplateId:n,workingListsType:r}),EL=(e,t,r)=>l(UU)({templates:e,defaultTemplateId:t,storeId:r}),yL=(e,t)=>l(LU)({error:e,storeId:t}),vL=(e,t,r)=>l(HU)({templateId:e,criteria:t,...r}),fL=(e,t,r)=>l(zU)({templateId:e,criteria:t,...r}),IL=(e,t,r)=>l(VU)({templateId:e,clientId:t,...r}),bL=(e,t)=>l(jU)({clientId:e,...t}),SL=(e,t)=>l(BU)({template:e,storeId:t}),TL=(e,t)=>l($U)({template:e,storeId:t}),AL=(e,t)=>l(KU)({...t,storeId:e}),CL=(e,t)=>l(QU)({storeId:e,errorMessage:t}),OL=(e,t)=>l(ZU)({...t,storeId:e}),NL=(e,t)=>l(eL)({storeId:e,errorMessage:t}),RL=(e,t)=>l(YU)({defaultTemplate:e,storeId:t}),wL=(e,t)=>{let{storeId:r,workingListsType:n}=t;const a=(0,gs.d4)((e=>{let{workingListsTemplates:t}=e;const{selectedTemplateId:n,templates:a,loading:o,loadError:i}=t[r]||{};return{currentTemplateId:n,templates:a,templatesLoading:!!o,loadTemplatesError:i}}),gs.bN),o=(0,y.useMemo)((()=>({onSelectTemplate:(t,n)=>{var o,i;const s=null===(o=a.templates)||void 0===o?void 0:o.find((e=>e.id===t)),d=n||(null===s||void 0===s||null===(i=s.criteria)||void 0===i?void 0:i.programStage);return e(((e,t,r)=>l(xU)({templateId:e,storeId:t,programStageId:r}))(t,r,d))},onLoadTemplates:function(){for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e(hL(...a,r,n))},onCancelLoadTemplates:()=>e((e=>l(FU)({storeId:e}))(r)),onAddTemplate:(t,a,o,i)=>e(((e,t,r,n)=>l(MU)({name:e,criteria:t,...r,callBacks:n}))(t,a,{...o,storeId:r,workingListsType:n},i)),onUpdateTemplate:(t,a,o)=>e(((e,t,r)=>l(WU)({template:e,criteria:t,...r}))(t,a,{...o,storeId:r,workingListsType:n})),onDeleteTemplate:(t,a,o,i)=>e(((e,t,r,n)=>{let{storeId:a,workingListsType:o,programStageId:i}=r;return l(GU)({template:e,programId:t,storeId:a,workingListsType:o,callBacks:n,programStageId:i})})(t,a,{storeId:r,workingListsType:n,programStageId:o},i)),onSetTemplateSharingSettings:(t,n)=>e(((e,t,r)=>l(gL)({sharingSettings:e,templateId:t,storeId:r}))(t,n,r))})),[r,e,n,a.templates]);return{...a,...o}},_L=(e,t,r)=>{let{storeId:n,workingListsType:a}=r;const o=(0,gs.d4)((e=>{var t;let{workingLists:r,workingListsUI:a,workingListsMeta:o,workingListsColumnsOrder:i,workingListsStickyFilters:s,workingListsListRecords:l,workingListsContext:d}=e;const{order:c}=r[n]||{},{isUpdating:u,isLoading:p,isUpdatingWithDialog:m,dataLoadingError:g}=a[n]||{},{rowsPerPage:h,currentPage:E,sortById:y,sortByDirection:v,initial:f,nextInitial:I,viewPreloaded:b,next:S}=o[n]||{},{rowsPerPage:T,currentPage:A,sortById:C,sortByDirection:O}=S||{};return{records:l[n],recordsOrder:c,updating:!!u,loading:!!p,updatingWithDialog:!!m,loadViewError:g,customColumnOrder:i[n],programStage:null===(t=d[n])||void 0===t?void 0:t.programStageId,stickyFilters:s[n],rowsPerPage:T||h,currentPage:A||E,sortById:C||y,sortByDirection:O||v,initialViewConfig:I||f,viewPreloaded:b}}),gs.bN),i=(0,gs.d4)((e=>{let{workingListsMeta:t}=e;return t[n]&&t[n].filters})),s=(0,gs.d4)((e=>{let{workingListsMeta:t}=e;return t[n]&&t[n].next&&t[n].next.filters})),d=(0,y.useMemo)((()=>({...i,...s})),[i,s]),c=(0,y.useMemo)((()=>({onLoadView:(r,o,i)=>e(((e,t,r)=>l(qU)({...r,selectedTemplate:e,context:t}))(r,o,{...i,categoryCombinationId:t,storeId:n,workingListsType:a})),onUpdateList:(r,o)=>{const{resetMode:i,...s}=r;e(((e,t)=>l(JU)({queryArgs:e,...t}))(s,{...o,categoryCombinationId:t,storeId:n,workingListsType:a,resetMode:i}))},onCancelLoadView:()=>e((e=>l(XU)({storeId:e}))(n)),onCancelUpdateList:()=>e((e=>l(tL)({storeId:e}))(n)),onSortList:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t,r)=>l(nL)({id:e,direction:t,storeId:r}))(...r,n))},onSetListColumnOrder:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t)=>l(aL)({columns:e,storeId:t},{skipLogging:["columns"]}))(...r,n))},onResetListColumnOrder:()=>e((e=>l(oL)({storeId:e},{skipLogging:["columns"]}))(n)),onUpdateFilter:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t,r)=>l(iL)({filter:e,itemId:t,storeId:r}))(...r,n))},onRemoveFilter:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t,r)=>l(sL)({itemId:e,includeFilters:t,storeId:r}))(...r,n))},onClearFilter:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t)=>l(lL)({itemId:e,storeId:t}))(...r,n))},onClearFilters:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t)=>l(dL)({filtersList:e,storeId:t}))(...r,n))},onSelectRestMenuItem:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t)=>l(cL)({id:e,storeId:t}))(...r,n))},onChangePage:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t)=>l(pL)({pageNumber:e,storeId:t}))(...r,n))},onChangeRowsPerPage:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e(((e,t)=>l(mL)({rowsPerPage:e,storeId:t}))(...r,n))},onUpdateDefaultTemplate:t=>e(RL(t,n))})),[n,e,t,a]);return{...o,filters:d,...c}},PL=(e,t)=>{let{storeId:r}=t;const n=(0,gs.d4)((e=>{let{currentSelections:{orgUnitId:t,categories:r},offline:{lastTransaction:n}}=e;return{orgUnitId:t,categories:r,lastTransaction:n}}),gs.bN),{listDataRefreshTimestamp:a,lastTransactionOnListDataRefresh:o,...i}=(0,gs.d4)((e=>{let{workingListsContext:t}=e;return t[r]}))||{};return{...n,loadedContext:i,onUnloadingContext:(0,y.useCallback)((()=>e((e=>l(rL)({storeId:e}))(r))),[e,r]),listDataRefreshTimestamp:a,lastTransactionOnListDataRefresh:o}},kL=(e,t,r)=>{const n=(0,gs.wA)(),a=PL(n,{storeId:e,workingListsType:t});return{...wL(n,{storeId:e,workingListsType:t}),..._L(n,r.categoryCombination&&r.categoryCombination.id,{storeId:e,workingListsType:t}),...a}},DL=e=>(e=>({...(0,gs.d4)((t=>{let{workingLists:r,workingListsListRecords:n,workingListsColumnsOrder:a}=t;return{eventRecords:n[e],recordsOrder:r[e]&&r[e].order,customColumnOrder:a[e]}}),gs.bN)}))(e),UL=(e,t)=>{const r=(0,y.useMemo)((()=>t.reduce(((e,t)=>({...e,[t.id]:t})),{})),[t]);return(0,y.useMemo)((()=>e?e.reduce(((e,t)=>{let{id:n,visible:a}=t;return r[n]?[...e,{...r[n],visible:a}]:e}),[]):t),[e,t,r])},LL=(e,t,r)=>{const n=(0,y.useMemo)((()=>t&&e&&t.map((t=>({...e[t],id:t})))),[e,t]);return(0,y.useMemo)((()=>n&&n.map((e=>{const t=r.filter((e=>e.visible)).reduce(((t,r)=>{const{id:n,type:a,options:o,resolveValue:i}=r,s=e[n];if(i)t[n]=i()[s];else if(o)if(a===it.CO.MULTI_TEXT){const e=(e=>{const t=new it.fq((t=>{t.id=e.id,t.type=e.type}));if(e.options){const r=e.options.map((e=>new it.c$((t=>{t.text=e.text,t.value=e.value})))),n=new it.G2(e.id,r,null,t);t.optionSet=n}return t})(r);t[n]=Ii(s,a,e)}else{const e=o.find((e=>e.value===s));e?t[n]=e.text:(S().error((0,j.px)("Missing value in options")({id:n,clientValue:s,options:o})),t[n]=Ii(s,a))}else t[n]=Ii(s,a);return t}),{});return{...t,id:e.id}}))),[n,r])},FL=(0,y.createContext)(),xL=(0,y.createContext)(),ML=(0,y.createContext)(),VL=(0,y.createContext)(),jL=(0,y.createContext)(),GL=e=>{let{currentTemplate:t,onSelectTemplate:r,children:n}=e;const a=(0,y.useMemo)((()=>({currentTemplate:t,onSelectTemplate:r})),[t,r]);return y.createElement(FL.Provider,{value:a},n)},BL=e=>{let{currentViewHasTemplateChanges:t,onAddTemplate:r,onUpdateTemplate:n,onDeleteTemplate:a,children:o}=e;const i=(0,y.useMemo)((()=>({currentViewHasTemplateChanges:t,onAddTemplate:r,onUpdateTemplate:n,onDeleteTemplate:a})),[t,r,n,a]);return y.createElement(xL.Provider,{value:i},o)},$L=e=>{let{sortById:t,sortByDirection:r,filters:n,columns:a,loading:o,onLoadView:i,loadViewError:s,onUpdateList:l,onCancelLoadView:d,orgUnitId:c,categories:u,dirtyView:p,loadedViewContext:m,viewPreloaded:g,children:h}=e;const E=(0,y.useMemo)((()=>({sortById:t,sortByDirection:r,filters:n,columns:a,loading:o,onLoadView:i,loadViewError:s,onUpdateList:l,onCancelLoadView:d,orgUnitId:c,categories:u,dirtyView:p,loadedViewContext:m,viewPreloaded:g})),[t,r,n,a,o,i,s,l,d,c,u,p,m,g]);return y.createElement(ML.Provider,{value:E},h)},WL=e=>{let{rowsPerPage:t,currentPage:r,onCancelUpdateList:n,customUpdateTrigger:a,forceUpdateOnMount:o,dirtyList:i,loadedOrgUnitId:s,children:l}=e;const d=(0,y.useMemo)((()=>({rowsPerPage:t,currentPage:r,onCancelUpdateList:n,customUpdateTrigger:a,forceUpdateOnMount:o,dirtyList:i,loadedOrgUnitId:s})),[t,r,n,a,o,i,s]);return y.createElement(VL.Provider,{value:d},l)},HL=e=>{let{updating:t,updatingWithDialog:r,selectedRows:n,allRowsAreSelected:a,selectionInProgress:o,dataSource:i,onClickListRow:s,onRowSelect:l,onSelectAll:d,onSortList:c,onSetListColumnOrder:u,customRowMenuContents:p,onUpdateFilter:m,onClearFilter:g,onRemoveFilter:h,onSelectRestMenuItem:E,onChangePage:v,onChangeRowsPerPage:f,stickyFilters:I,programStageId:b,bulkActionBarComponent:S,children:T}=e;const A=(0,y.useMemo)((()=>({updating:t,updatingWithDialog:r,dataSource:i,selectedRows:n,allRowsAreSelected:a,selectionInProgress:o,onClickListRow:s,onRowSelect:l,onSelectAll:d,onSortList:c,onSetListColumnOrder:u,customRowMenuContents:p,onUpdateFilter:m,onClearFilter:g,onRemoveFilter:h,onSelectRestMenuItem:E,onChangePage:v,onChangeRowsPerPage:f,stickyFilters:I,programStageId:b,bulkActionBarComponent:S})),[t,r,i,n,a,o,s,l,d,c,u,p,m,g,h,E,v,f,I,b,S]);return y.createElement(jL.Provider,{value:A},T)},zL=(0,y.createContext)(),YL=(0,y.createContext)({});function qL(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KL(){return KL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KL.apply(this,arguments)}const QL=e=>{let{className:t,...r}=e;return y.createElement("svg",KL({className:t},r,{viewBox:"0 0 24 24",width:24,height:24}),y.createElement("path",{d:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"}))};class XL extends y.Component{static stopClearPropagation(e){e.stopPropagation()}static getCappedValue(e){return`${e.substring(0,7).trimRight()}...`}static getViewValueForFilter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`: ${e.length>10?JL.getCappedValue(e):e}`}constructor(e){super(e),qL(this,"setIsHovered",(()=>{this.setState({isHovered:!0})})),qL(this,"clearIsHovered",(()=>{this.setState({isHovered:!1})})),qL(this,"handleClearClick",(e=>{e.stopPropagation(),this.props.onClear()})),this.state={isHovered:!1}}render(){const{onChange:e,classes:t,iconClass:r,title:a,arrowIconElement:o,buttonText:i}=this.props,s=this.state.isHovered,l=er()(t.button,{[t.hovered]:s});return y.createElement("div",{onMouseEnter:this.setIsHovered,onMouseLeave:this.clearIsHovered},y.createElement(ra.$,{className:l,onClick:e},a,JL.getViewValueForFilter(i),o,y.createElement(Xo.m,{content:n.A.t("Clear"),placement:"bottom",openDelay:300},y.createElement(QL,{onMouseEnter:this.clearIsHovered,onMouseLeave:this.setIsHovered,className:er()(r,t.clearIcon),onClick:this.handleClearClick,onMouseDown:JL.stopClearPropagation,onMouseUp:JL.stopClearPropagation,onTouchStart:JL.stopClearPropagation,onTouchEnd:JL.stopClearPropagation,onTouchMove:JL.stopClearPropagation,onKeyDown:JL.stopClearPropagation,onKeyUp:JL.stopClearPropagation}))))}}const JL=(0,I.withStyles)((e=>({button:{backgroundColor:"rgb(184, 215, 243) !important"},hovered:{backgroundColor:"rgb(114, 176, 231) !important"},clearIcon:{color:e.palette.text.secondary,"&:hover":{color:e.palette.text.primary}}})))(XL),ZL={[it.CO.TEXT]:it.CO.TEXT,[it.CO.NUMBER]:it.CO.NUMBER,[it.CO.INTEGER]:it.CO.INTEGER,[it.CO.INTEGER_POSITIVE]:it.CO.INTEGER_POSITIVE,[it.CO.INTEGER_NEGATIVE]:it.CO.INTEGER_NEGATIVE,[it.CO.INTEGER_ZERO_OR_POSITIVE]:it.CO.INTEGER_ZERO_OR_POSITIVE,[it.CO.DATE]:it.CO.DATE,[it.CO.BOOLEAN]:it.CO.BOOLEAN,[it.CO.TRUE_ONLY]:it.CO.TRUE_ONLY,[it.CO.ASSIGNEE]:it.CO.ASSIGNEE};function eF(){return eF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},eF.apply(this,arguments)}function tF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const rF=e=>({buttonsContainer:{paddingTop:e.typography.pxToRem(8)},buttonContainer:{paddingRight:e.typography.pxToRem(8),display:"inline-block"}}),nF=()=>e=>(0,I.withStyles)(rF)(class extends y.Component{constructor(){super(...arguments),tF(this,"update",(e=>{const t=this.filterTypeInstance.onGetUpdateData(e);this.props.onUpdate(t)})),tF(this,"handleUpdateClick",(()=>{this.isValid()&&this.update()})),tF(this,"focusUpdateButton",(()=>{this.updateButtonInstance&&this.updateButtonInstance.focus()})),tF(this,"focusCloseButton",(()=>{this.closeButtonInstance&&this.closeButtonInstance.focus()})),tF(this,"focusRemoveButton",(()=>{this.removeButtonInstance&&this.removeButtonInstance.focus()})),tF(this,"setFilterTypeInstance",(e=>{this.filterTypeInstance=e})),tF(this,"setUpdateButtonInstance",(e=>{this.updateButtonInstance=e})),tF(this,"setCloseButtonInstance",(e=>{this.closeButtonInstance=e})),tF(this,"setRemoveButtonInstance",(e=>{this.removeButtonInstance=e}))}isValid(){return!this.filterTypeInstance.onIsValid||this.filterTypeInstance.onIsValid()}render(){const{onUpdate:t,onClose:r,onRemove:a,classes:o,disabledUpdate:i,disabledReset:s,isRemovable:l,...d}=this.props;return y.createElement(y.Fragment,null,y.createElement(e,eF({filterTypeRef:this.setFilterTypeInstance,onUpdate:this.update,onFocusUpdateButton:this.focusUpdateButton,onFocusCloseButton:this.focusCloseButton,onFocusRemoveButton:this.focusRemoveButton},d)),y.createElement("div",{className:o.buttonsContainer},y.createElement("div",{className:o.buttonContainer},y.createElement(ra.$,{dataTest:"list-view-filter-apply-button",muiButtonRef:this.setUpdateButtonInstance,primary:!0,onClick:this.handleUpdateClick,disabled:i},n.A.t("Update"))),y.createElement("div",{className:o.buttonContainer},y.createElement(ra.$,{dataTest:"list-view-filter-cancel-button",muiButtonRef:this.setCloseButtonInstance,secondary:!0,onClick:r,disabled:s},n.A.t("Reset filter"))),l&&y.createElement("div",{className:o.buttonContainer},y.createElement(ra.$,{dataTest:"list-view-filter-remove-button",muiButtonRef:this.setRemoveButtonInstance,destructive:!0,onClick:a},n.A.t("Remove filter")))))}});var aF=r(45674);function oF(){return oF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oF.apply(this,arguments)}function iF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class sF extends y.Component{constructor(e){super(e),iF(this,"handleChange",(e=>{this.props.onChange&&this.props.onChange(e.value,e)})),iF(this,"handleBlur",(e=>{this.props.onBlur&&this.props.onBlur(e.value,e)})),this.handleChange=this.handleChange.bind(this),this.handleBlur=this.handleBlur.bind(this)}focus(){this.materialUIInstance&&this.materialUIInstance.focus()}render(){const{onChange:e,onBlur:t,value:r,...n}=this.props;return y.createElement("div",{ref:e=>{this.materialUIContainerInstance=e}},y.createElement(aF.p,oF({inputRef:e=>{this.materialUIInstance=e},value:r||"",onChange:this.handleChange,onBlur:this.handleBlur},n)))}}function lF(){return lF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lF.apply(this,arguments)}iF(sF,"defaultProps",{value:""});const dF=()=>e=>class extends y.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this);const t=this.props.value;this.state={value:t}}UNSAFE_componentWillReceiveProps(e){e.value!==this.props.value&&this.setState({value:e.value})}handleChange(e){this.setState({value:e}),this.props.onChange&&this.props.onChange(e)}render(){const{onChange:t,value:r,...n}=this.props,a=this.state.value;return y.createElement(e,lF({onChange:this.handleChange,value:a},n))}};function cF(){return cF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cF.apply(this,arguments)}function uF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class pF extends y.Component{constructor(){super(...arguments),uF(this,"handleKeyPress",(e=>{"Enter"===e.key&&this.props.onEnterKey(this.props.value)}))}render(){const{onEnterKey:e,...t}=this.props;return y.createElement(sF,cF({onKeyPress:this.handleKeyPress,fullWidth:!0,placeholder:n.A.t("Contains text")},t))}}const mF=dF()(pF);function gF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class hF extends y.Component{constructor(){super(...arguments),gF(this,"handleEnterKey",(e=>{this.props.onUpdate(e||null)})),gF(this,"handleBlur",(e=>{this.props.onCommitValue(e)})),gF(this,"handleChange",(e=>{this.props.onCommitValue(e)}))}onGetUpdateData(e){const t="undefined"!==typeof e?e:this.props.value;return t?function(e){return{value:e}}(t):null}render(){const{value:e}=this.props;return y.createElement(mF,{onChange:this.handleChange,onBlur:this.handleBlur,onEnterKey:this.handleEnterKey,value:e})}}function EF(){return EF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},EF.apply(this,arguments)}function yF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class vF extends y.Component{static calculateDefaultState(e){return{value:e&&e.value?e.value:void 0}}constructor(e){super(e),yF(this,"handleCommitValue",(e=>{this.setState({value:e}),this.props.handleCommitValue&&this.props.handleCommitValue()})),this.state=vF.calculateDefaultState(this.props.filter)}render(){const{filter:e,filterTypeRef:t,...r}=this.props;return y.createElement(hF,EF({value:this.state.value,ref:t,onCommitValue:this.handleCommitValue},r))}}function fF(){return fF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fF.apply(this,arguments)}function IF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class bF extends y.Component{constructor(){super(...arguments),IF(this,"handleBlur",(e=>{this.props.onBlur(bF.getValueObject(e))})),IF(this,"handleKeyPress",(e=>{"Enter"===e.key&&this.props.onEnterKey()}))}static getValueObject(e){return{min:e.trim()}}render(){const{error:e,errorClass:t,onBlur:r,onEnterKey:a,...o}=this.props;return y.createElement("div",null,y.createElement(sF,fF({onKeyPress:this.handleKeyPress,onBlur:this.handleBlur,placeholder:n.A.t("Min"),fullWidth:!0},o)),y.createElement("div",{className:t},e))}}const SF=dF()(bF);function TF(){return TF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},TF.apply(this,arguments)}function AF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class CF extends y.Component{constructor(){super(...arguments),AF(this,"handleBlur",(e=>{this.props.onBlur(CF.getValueObject(e))})),AF(this,"handleKeyPress",(e=>{"Enter"===e.key&&this.props.onEnterKey(CF.getValueObject(this.props.value||""))}))}static getValueObject(e){return{max:e.trim()}}render(){const{error:e,onBlur:t,onEnterKey:r,textFieldRef:a,errorClass:o,...i}=this.props;return y.createElement("div",null,y.createElement(sF,TF({ref:a,onKeyPress:this.handleKeyPress,onBlur:this.handleBlur,placeholder:n.A.t("Max"),fullWidth:!0},i)),y.createElement("div",{className:o},e))}}const OF=dF()(CF);function NF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class RF extends y.Component{constructor(){super(...arguments),NF(this,"handleEnterKeyInMin",(()=>{this.maxD2TextFieldInstance.focus()})),NF(this,"handleEnterKeyInMax",(e=>{const t=this.getUpdatedValue(e);t&&!wF.isFilterValid(t.min,t.max,this.props.type)?this.props.onCommitValue(t):this.props.onUpdate(t||null)})),NF(this,"handleFieldBlur",(e=>{this.props.onCommitValue(this.getUpdatedValue(e))})),NF(this,"setMaxD2TextFieldInstance",(e=>{this.maxD2TextFieldInstance=e}))}static validateField(e,t){if(!e)return{isValid:!0,error:null};const r=(0,wF.validatorForTypes[t])(e);return{isValid:r,error:r?null:n.A.t(wF.errorMessages[t])}}static isFilterValid(e,t,r){return!(!wF.validateField(e,r).isValid||!wF.validateField(t,r).isValid)&&!(e&&t&&Number(e)>Number(t))}onGetUpdateData(e){const t="undefined"!==typeof e?e:this.props.value;return t?function(e){const t=e.min||void 0,r=e.max||void 0;return{ge:t&&ut(t),le:r&&ut(r)}}(t):null}onIsValid(){const e=this.props.value;return!e||wF.isFilterValid(e.min,e.max,this.props.type)}getUpdatedValue(e){const t={...this.props.value,...e};return Object.keys(t).filter((e=>t[e])).length>0?t:null}getErrors(){const e=this.props.value,t=e&&e.min,r=e&&e.max,a=this.props.type,{isValid:o,error:i}=wF.validateField(t,a),{isValid:s,error:l}=wF.validateField(r,a);let d=null;return o&&s&&t&&r&&Number(t)>Number(r)&&(d=n.A.t(wF.errorMessages.MIN_GREATER_THAN_MAX)),{minValueError:i,maxValueError:l,logicError:d}}render(){const{value:e,classes:t}=this.props,{minValueError:r,maxValueError:a,logicError:o}=this.getErrors();return y.createElement("div",null,y.createElement("div",{className:t.container},y.createElement("div",{className:t.inputContainer},y.createElement(SF,{value:e&&e.min,error:r,errorClass:t.error,onBlur:this.handleFieldBlur,onEnterKey:this.handleEnterKeyInMin})),y.createElement("div",{className:t.toLabelContainer},n.A.t("to")),y.createElement("div",{className:t.inputContainer},y.createElement(OF,{value:e&&e.max,error:a,errorClass:t.error,onBlur:this.handleFieldBlur,onEnterKey:this.handleEnterKeyInMax,textFieldRef:this.setMaxD2TextFieldInstance}))),y.createElement("div",{className:er()(t.error,t.logicErrorContainer)},o))}}NF(RF,"errorMessages",{MIN_GREATER_THAN_MAX:"Minimum value cannot be greater than maximum value",[it.CO.NUMBER]:"Please provide a valid number",[it.CO.INTEGER]:"Please provide a valid integer",[it.CO.INTEGER_POSITIVE]:"Please provide a positive integer",[it.CO.INTEGER_NEGATIVE]:"Please provide a negative integer",[it.CO.INTEGER_ZERO_OR_POSITIVE]:"Please provide zero or a positive integer"}),NF(RF,"validatorForTypes",{[it.CO.NUMBER]:Yt,[it.CO.INTEGER]:$t,[it.CO.INTEGER_POSITIVE]:Wt,[it.CO.INTEGER_NEGATIVE]:Ht,[it.CO.INTEGER_ZERO_OR_POSITIVE]:zt});const wF=(0,I.withStyles)((e=>({container:{display:"flex",flexWrap:"wrap"},inputContainer:{width:e.typography.pxToRem(100)},toLabelContainer:{paddingTop:e.typography.pxToRem(6),paddingLeft:e.typography.pxToRem(10),paddingRight:e.typography.pxToRem(10),fontSize:e.typography.body1.fontSize},error:{...e.typography.caption,color:e.palette.error.main},logicErrorContainer:{paddingTop:e.typography.pxToRem(10)}})))(RF);function _F(){return _F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_F.apply(this,arguments)}function PF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class kF extends y.Component{static calculateDefaultState(e){return{min:e&&(e.ge||0===e.ge)?e.ge.toString():void 0,max:e&&(e.le||0===e.le)?e.le.toString():void 0}}constructor(e){super(e),PF(this,"handleCommitValue",(e=>{this.setState({value:e}),this.props.handleCommitValue&&this.props.handleCommitValue()})),this.state={value:kF.calculateDefaultState(this.props.filter)}}render(){const{filter:e,filterTypeRef:t,...r}=this.props;return y.createElement(wF,_F({value:this.state.value,innerRef:t,onCommitValue:this.handleCommitValue},r))}}var DF=r(38278),UF=r(12569),LF=r(45503),FF=r(91297);class xF extends y.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this),this.labelClasses=this.buildLabelClasses()}buildLabelClasses(){return{root:this.props.classes.label}}handleChange(e){let t;t=e.checked?"true":null,this.props.onBlur(t)}render(){const{value:e,label:t,required:r,classes:n,style:a,useSwitch:o,useValueLabel:i}=this.props;return y.createElement("div",{ref:e=>{this.materialUIContainerInstance=e},style:a},y.createElement(DF.n,null,(()=>!t||i?null:y.createElement(UF.J,{required:!!r,classes:this.labelClasses},t))(),o?y.createElement(LF.d,{checked:!!e,label:i?t:"",onChange:this.handleChange,value:e,dense:!0,className:n.checkbox}):y.createElement(FF.S,{checked:!!e,label:i?t:"",onChange:this.handleChange,value:e,dense:!0,className:n.checkbox})))}}const MF=(0,I.withStyles)((e=>({label:e.typography.formFieldTitle,checkbox:{marginTop:yn.U.dp12,marginBottom:yn.U.dp12}})))(xF),VF="horizontal",jF="vertical";function GF(){return GF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},GF.apply(this,arguments)}const BF=(0,I.withStyles)({formGroup:{display:"flex",flexDirection:"column"},formGroupRow:{display:"flex",flexDirection:"row"}})((e=>{let{children:t,classes:r,row:n=!1,...a}=e;return y.createElement("div",GF({},a,{className:n?r.formGroupRow:r.formGroup}),t)}));class $F extends y.Component{constructor(e){super(e),this.handleOptionChange=this.handleOptionChange.bind(this),this.labelClasses=this.buildLabelClasses()}buildLabelClasses(){return{root:this.props.classes.label}}getBoxes(){const{options:e,classes:t}=this.props;return e.map(((e,r)=>{let{text:n,value:a}=e;return y.createElement(FF.S,{key:r,checked:this.isChecked(a),label:n,name:`multiSelectBoxes-${r}`,onChange:e=>{this.handleOptionChange(e,a)},value:a,className:t.checkbox,dense:!0})}))}handleOptionChange(e,t){this.handleSelectUpdate(e.checked,t)}handleSelectUpdate(e,t){let r=null;e?this.checkedValues?(this.checkedValues.add(t),r=Array.from(this.checkedValues)):r=[t]:this.checkedValues&&(this.checkedValues.delete(t),r=this.checkedValues.size>0?Array.from(this.checkedValues):null),this.props.onBlur(r)}setCheckedStatusForBoxes(){const e=this.props.value;this.checkedValues=e||!1===e||0===e?new Set(e):null}isChecked(e){return!(!this.checkedValues||!this.checkedValues.has(e))}renderHorizontal(){return y.createElement(BF,{row:!0},this.getBoxes())}renderVertical(){return y.createElement(BF,null,this.getBoxes())}renderCheckboxes(){return this.props.orientation===jF?this.renderVertical():this.renderHorizontal()}render(){const{label:e,required:t}=this.props;return this.setCheckedStatusForBoxes(),y.createElement("div",{ref:e=>{this.materialUIContainerInstance=e}},y.createElement(DF.n,null,(()=>e?y.createElement(UF.J,{required:!!t,className:this.labelClasses},e):null)(),this.renderCheckboxes()))}}const WF=(0,I.withStyles)((e=>({label:e.typography.formFieldTitle,checkbox:{marginTop:yn.U.dp8,marginBottom:yn.U.dp16}})))($F);var HF=r(57294);const zF="horizontal",YF="vertical";class qF extends y.Component{constructor(e){super(e),this.handleOptionChange=this.handleOptionChange.bind(this),this.labelClasses=this.buildLabelClasses()}buildLabelClasses(){return{root:this.props.classes.label}}getBoxes(){const{options:e,classes:t}=this.props;return e.map(((e,r)=>{let{text:n,value:a}=e;return y.createElement(HF.s,{key:r,checked:this.isChecked(a),label:n,name:`singleSelectBoxes-${r}`,onChange:e=>{this.handleOptionChange(e,a)},value:a,className:t.radio,dense:!0})}))}handleOptionChange(e,t){this.handleSingleSelectUpdate(e.checked,t)}handleSingleSelectUpdate(e,t){(!1!==e||this.props.nullable)&&this.props.onBlur(e?t:null)}setCheckedStatusForBoxes(){const e=this.props.value;this.checkedValues=e||!1===e||0===e?(new Set).add(e):null}isChecked(e){return!(!this.checkedValues||!this.checkedValues.has(e))}renderHorizontal(){return y.createElement(BF,{row:!0},this.getBoxes())}renderVertical(){return y.createElement(BF,null,this.getBoxes())}renderBoxes(){return this.props.orientation===YF?this.renderVertical():this.renderHorizontal()}render(){const{label:e,required:t}=this.props;return this.setCheckedStatusForBoxes(),y.createElement("div",{ref:e=>{this.materialUIContainerInstance=e}},y.createElement(DF.n,null,(()=>e?y.createElement(UF.J,{required:!!t,className:this.labelClasses},e):null)(),this.renderBoxes()))}}const KF=(0,I.withStyles)((e=>{let{typography:t,palette:r}=e;return{label:t.formFieldTitle,iconSelected:{fill:r.secondary.main},iconDeselected:{fill:vn.T.grey700},radio:{marginTop:yn.U.dp8,marginBottom:yn.U.dp16}}}))(qF),QF="vertical";function XF(){return XF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},XF.apply(this,arguments)}const JF=e=>{const{multiSelect:t,options:r,optionSet:n,orientation:a,...o}=e,i=(0,y.useMemo)((()=>n?n.options.map((e=>{let{text:t,value:r}=e;return{text:t,value:r}})):r),[n,r]),[s,l]=t?[WF,QF?jF:VF]:[KF,QF?YF:zF];return y.createElement(s,XF({},o,{orientation:l,options:i}))};function ZF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ex extends y.Component{constructor(){super(...arguments),ZF(this,"handleTrueOnlyBlur",(e=>{this.props.onCommitValue(e?[e]:null)}))}onGetUpdateData(){return this.props.value?{value:!0}:null}onIsValid(){return!0}render(){const{value:e,classes:t}=this.props;return y.createElement("div",{className:t.selectBoxesContainer},y.createElement(MF,{label:n.A.t("Yes"),useValueLabel:!0,value:e,onBlur:this.handleTrueOnlyBlur,orientation:QF}))}}const tx=(0,I.withStyles)((e=>({selectBoxesContainer:{marginRight:e.typography.pxToRem(-24)}})))(ex);function rx(){return rx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rx.apply(this,arguments)}function nx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ax extends y.Component{static calculateDefaultState(e){return{value:e&&e.value?["true"]:void 0}}constructor(e){super(e),nx(this,"handleCommitValue",(e=>{this.setState({value:e}),this.props.handleCommitValue&&this.props.handleCommitValue()})),this.state=ax.calculateDefaultState(this.props.filter)}render(){const{filter:e,filterTypeRef:t,...r}=this.props;return y.createElement(tx,rx({value:this.state.value,innerRef:t,onCommitValue:this.handleCommitValue},r))}}var ox=r(75876),ix=r(41554);function sx(){return sx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sx.apply(this,arguments)}class lx extends y.Component{static getOptions(){const e=n.A.t("Yes"),t=n.A.t("No"),r=new ox.G;return r.addOption(new ix.c((t=>{t.text=e,t.value=!0}))),r.addOption(new ix.c((e=>{e.text=t,e.value=!1}))),r}constructor(e){super(e),this.optionSet=lx.getOptions()}render(){const{allowMultiple:e,...t}=this.props;return y.createElement("div",null,y.createElement(JF,sx({},t,{optionSet:this.optionSet,multiSelect:e})))}}function dx(e){return{values:e.map((e=>e))}}function cx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ux extends y.Component{constructor(){super(...arguments),cx(this,"setBooleanFieldInstance",(e=>{this.booleanFieldInstance=e}))}onGetUpdateData(){const{value:e,allowMultiple:t}=this.props;return e||!1===e?t?dx(e):(e=>dx([e]))(e):null}onIsValid(){return!0}render(){const{onCommitValue:e,value:t,classes:r}=this.props;return y.createElement("div",{className:r.selectBoxesContainer},y.createElement(lx,{ref:this.setBooleanFieldInstance,allowMultiple:this.props.allowMultiple,value:t,onBlur:e,orientation:QF}))}}const px=(0,I.withStyles)((e=>({selectBoxesContainer:{marginRight:e.typography.pxToRem(-24)}})))(ux);function mx(){return mx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mx.apply(this,arguments)}function gx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class hx extends y.Component{static calculateDefaultValueState(e,t){if(e)return t?e.values[0]:e.values}constructor(e){super(e),gx(this,"handleCommitValue",(e=>{this.setState({value:e}),this.props.handleCommitValue&&this.props.handleCommitValue()})),this.state={value:hx.calculateDefaultValueState(this.props.filter,this.props.singleSelect)}}render(){const{filter:e,filterTypeRef:t,singleSelect:r,...n}=this.props;return y.createElement(px,mx({value:this.state.value,innerRef:t,onCommitValue:this.handleCommitValue,allowMultiple:!r},n))}}const Ex="right",yx="up",vx="absolute",fx="inline";class Ix extends y.Component{getAbsoluteBottom(){return this.props.inputUsesFloatingLabel?60:40}getAbsoluteVerticalPosition(){return this.props.absoluteDirection===yx?{bottom:this.getAbsoluteBottom()}:{top:0}}calculateMarginLeftInline(){const{inputWidth:e,calendarWidth:t}=this.props;return t-e}getPopupStyle(){const{anchorPosition:e,mode:t}=this.props;let r;return r=e===Ex?t===fx?{marginLeft:`-${this.calculateMarginLeftInline()}px`}:{...this.getAbsoluteVerticalPosition(),right:0}:t===fx?{}:{...this.getAbsoluteVerticalPosition(),left:0},r}render(){const{open:e,mode:t,classes:r,children:n}=this.props;if(!e)return null;const a=t===fx?r.containerInline:r.containerAbsolute,o=t===fx?r.calendarInline:r.calendarAbsolute,i=this.getPopupStyle();return y.createElement("div",{className:a},y.createElement("div",{className:o,style:i},n))}}const bx=(0,I.withStyles)((()=>({containerAbsolute:{position:"relative"},containerInline:{},calendarAbsolute:{position:"absolute",zIndex:201},calendarInline:{}})))(Ix);function Sx(){return Sx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sx.apply(this,arguments)}class Tx extends y.Component{constructor(e){super(e),this.handleChange=this.handleChange.bind(this);const t=W.get(),r=this.props.currentWidth;this.calendarLocaleData={locale:t.dateFnsLocale,headerFormat:r>=400?t.calendarFormatHeaderLong:t.calendarFormatHeaderShort,weekdays:t.weekDaysShort.map((e=>Ot(e))),blank:t.selectDatesText,todayLabel:{long:t.todayLabelLong,short:t.todayLabelShort},weekStartsOn:t.weekStartsOn},this.theme=(e=>({accentColor:e.palette.secondary.main,floatingNav:{background:"rgba(0, 30, 64, 0.8)",chevron:"rgb(145, 203, 193)",color:"white"},headerColor:e.palette.primary.main,todayColor:e.palette.secondary.main,selectionColor:e.palette.primary.main,weekdayColor:e.palette.primary.main}))(this.props.theme),this.displayOptions={...Ax.displayOptions,...this.props.displayOptions}}shouldComponentUpdate(e){if(e.currentWidth!==this.props.currentWidth){const t=W.get();return e.currentWidth<400?this.calendarLocaleData.headerFormat=t.calendarFormatHeaderShort:this.calendarLocaleData.headerFormat=t.calendarFormatHeaderLong,!0}return!1}handleChange(e){const t=wt(e);this.props.onDateSelected(t)}getValue(e){if(!e)return null;const t=Rt(e);return t.isValid?t.momentDate.toDate():null}getMinMaxProps(){const e={},t=this.props.minMoment,r=this.props.maxMoment;if(t){const r=t.toDate();e.min=r,e.minDate=r}if(r){const t=r.toDate();e.max=t,e.maxDate=t}return e}render(){const{value:e,classes:t,currentWidth:r,height:n,minMoment:a,maxMoment:o,onDateSelected:i,theme:s,displayOptions:l,...d}=this.props;return y.createElement("div",{className:t.container},y.createElement(_r.Ay,Sx({},this.getMinMaxProps(),{selected:this.getValue(e),onSelect:this.handleChange,locale:this.calendarLocaleData,width:r,height:n,autoFocus:!1,theme:this.theme,displayOptions:this.displayOptions},d)))}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Tx,"displayOptions",{showHeader:!1});const Ax=(0,I.withTheme)()((0,I.withStyles)((()=>({container:{}})))(Tx));function Cx(){return Cx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Cx.apply(this,arguments)}class Ox extends y.Component{static splitPassOnProps(e){const t={input:{},popup:{},calendar:{}};return e?Object.keys(e).reduce(((t,r)=>{let n;n=r.startsWith(Nx.propContainers.CALENDAR)?Nx.propContainers.CALENDAR:r.startsWith(Nx.propContainers.POPUP)?Nx.propContainers.POPUP:Nx.propContainers.INPUT;const a=Pu(r.replace(n,""));return t[n][a]=e[r],t}),t):t}constructor(e){super(e),this.state={popoverOpen:!1},this.handleTextFieldFocus=this.handleTextFieldFocus.bind(this),this.handleDateSelected=this.handleDateSelected.bind(this),this.handleTextFieldBlur=this.handleTextFieldBlur.bind(this),this.hidePopover=this.hidePopover.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this)}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick)}handleTextFieldFocus(){document.removeEventListener("click",this.handleDocumentClick),this.setState({popoverOpen:!0}),this.props.onFocus&&this.props.onFocus()}handleDateSelected(e){this.props.onBlur(e),this.hidePopover(),this.props.onDateSelectedFromCalendar&&this.props.onDateSelectedFromCalendar(),document.removeEventListener("click",this.handleDocumentClick)}handleDocumentClick(e){e.target&&e.target.className&&e.target.className.startsWith&&e.target.className.startsWith("Cal__")||e.target&&e.target.className&&e.target.className.baseVal&&e.target.className.baseVal.startsWith("Cal__")||(this.hidePopover(),document.removeEventListener("click",this.handleDocumentClick))}handleTextFieldBlur(e,t){this.props.onBlur(e),t.relatedTarget&&"Cal__Container__root"===t.relatedTarget.className?document.addEventListener("click",this.handleDocumentClick):this.hidePopover()}hidePopover(){this.setState({popoverOpen:!1})}render(){const{width:e,calendarWidth:t,calendarHeight:r,inputWidth:n,classes:a,onBlur:o,onFocus:i,onDateSelectedFromCalendar:s,textFieldRef:l,...d}=this.props,{popoverOpen:c}=this.state,u=l?{ref:l}:null,p=n||e,m=t||e,g=Nx.splitPassOnProps(d),h=r||350;return y.createElement("div",{ref:e=>{this.containerInstance=e},style:{width:e}},y.createElement(sF,Cx({},u,{onFocus:this.handleTextFieldFocus,onBlur:this.handleTextFieldBlur,className:a.textField,width:p},g.input)),y.createElement(bx,Cx({open:c,onClose:this.hidePopover,width:m,height:h,inputWidth:p,inputUsesFloatingLabel:!!g.input.label},g.popup),y.createElement(Ax,Cx({onDateSelected:this.handleDateSelected,value:this.props.value,currentWidth:m,height:h},g.calendar))))}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(Ox,"propContainers",{CALENDAR:"calendar",POPUP:"popup",INPUT:"input"});const Nx=(0,I.withStyles)((()=>({textField:{width:"100%"}})))(Ox);function Rx(){return Rx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rx.apply(this,arguments)}function wx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class _x extends y.Component{static getValueObject(e){return{from:e.trim()}}constructor(e){super(e),wx(this,"handleBlur",(e=>{this.props.onBlur(_x.getValueObject(e))})),wx(this,"handleKeyPress",(e=>{"Enter"===e.key&&this.props.onEnterKey()})),this.displayOptions={showWeekdays:!0,showHeader:!1}}render(){const{error:e,errorClass:t,onBlur:r,onEnterKey:a,...o}=this.props;return y.createElement("div",null,y.createElement(Nx,Rx({onKeyPress:this.handleKeyPress,onBlur:this.handleBlur,placeholder:n.A.t("From"),popupMode:vx,popupAbsoluteDirection:yx,width:150,calendarWidth:330,calendarHeight:170,calendarRowHeight:45,calendarDisplayOptions:this.displayOptions},o)),y.createElement("div",{className:t},e))}}const Px=dF()(_x);function kx(){return kx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kx.apply(this,arguments)}function Dx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ux extends y.Component{static getValueObject(e){return{to:e.trim()}}constructor(e){super(e),Dx(this,"handleBlur",(e=>{this.props.onBlur(Ux.getValueObject(e))})),Dx(this,"handleKeyPress",(e=>{"Enter"===e.key&&this.props.onEnterKey(Ux.getValueObject(this.props.value||""))})),Dx(this,"handleDateSelectedFromCalendar",(()=>{this.props.onFocusUpdateButton()})),this.displayOptions={showWeekdays:!0,showHeader:!1}}render(){const{error:e,onBlur:t,onEnterKey:r,errorClass:a,onFocusUpdateButton:o,...i}=this.props;return y.createElement("div",null,y.createElement(Nx,kx({onKeyPress:this.handleKeyPress,onBlur:this.handleBlur,onDateSelectedFromCalendar:this.handleDateSelectedFromCalendar,placeholder:n.A.t("To"),popupAnchorPosition:Ex,popupMode:vx,popupAbsoluteDirection:yx,width:150,calendarWidth:330,calendarHeight:170,calendarRowHeight:45,calendarDisplayOptions:this.displayOptions},i)),y.createElement("div",{className:a},e))}}const Lx=dF()(Ux),Fx={TODAY:"TODAY",THIS_WEEK:"THIS_WEEK",THIS_MONTH:"THIS_MONTH",THIS_YEAR:"THIS_YEAR",LAST_WEEK:"LAST_WEEK",LAST_MONTH:"LAST_MONTH",LAST_3_MONTHS:"LAST_3_MONTHS",ABSOLUTE_RANGE:"ABSOLUTE_RANGE",RELATIVE_RANGE:"RELATIVE_RANGE"},xx={[Fx.TODAY]:n.A.t("Today"),[Fx.THIS_WEEK]:n.A.t("This week"),[Fx.THIS_MONTH]:n.A.t("This month"),[Fx.THIS_YEAR]:n.A.t("This Year"),[Fx.LAST_WEEK]:n.A.t("Last week"),[Fx.LAST_MONTH]:n.A.t("Last month"),[Fx.LAST_3_MONTHS]:n.A.t("Last 3 months"),[Fx.ABSOLUTE_RANGE]:n.A.t("Absolute range"),[Fx.RELATIVE_RANGE]:n.A.t("Relative range")},Mx=Object.freeze({ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE"});function Vx(e){return e.main===Fx.ABSOLUTE_RANGE?function(e,t){const r={type:Mx.ABSOLUTE};if(e){const t=Rt(e).momentDate;r.ge=t}if(t){const e=Rt(t).momentDate;r.le=e}return r}(e.from,e.to):e.main===Fx.RELATIVE_RANGE?function(e){const t={type:Mx.RELATIVE},r=e.start&&ut(e.start),n=e.end&&ut(e.end);return(r||0===r)&&(t.startBuffer=-Math.abs(r)),(n||0===n)&&(t.endBuffer=n),t}(e):{type:Mx.RELATIVE,period:e.main}}function jx(){return jx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jx.apply(this,arguments)}function Gx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Bx extends y.Component{constructor(){super(...arguments),Gx(this,"handleBlur",(e=>{this.props.onBlur(Bx.getValueObject(e))})),Gx(this,"handleKeyPress",(e=>{"Enter"===e.key&&this.props.onEnterKey()}))}static getValueObject(e){return{start:e.trim()}}render(){const{error:e,errorClass:t,onBlur:r,onEnterKey:a,...o}=this.props;return y.createElement("div",null,y.createElement(sF,jx({onKeyPress:this.handleKeyPress,onBlur:this.handleBlur,placeholder:n.A.t("Days in the past"),fullWidth:!0,dataTest:"date-range-filter-start"},o)),y.createElement("div",{className:t},e))}}const $x=dF()(Bx);function Wx(){return Wx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Wx.apply(this,arguments)}function Hx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class zx extends y.Component{constructor(){super(...arguments),Hx(this,"handleBlur",(e=>{this.props.onBlur(zx.getValueObject(e))})),Hx(this,"handleKeyPress",(e=>{"Enter"===e.key&&this.props.onEnterKey(zx.getValueObject(this.props.value||""))}))}static getValueObject(e){return{end:e.trim()}}render(){const{error:e,onBlur:t,onEnterKey:r,textFieldRef:a,errorClass:o,...i}=this.props;return y.createElement("div",null,y.createElement(sF,Wx({ref:a,onKeyPress:this.handleKeyPress,onBlur:this.handleBlur,placeholder:n.A.t("Days in the future"),fullWidth:!0,dataTest:"date-range-filter-end"},i)),y.createElement("div",{className:o},e))}}const Yx=dF()(zx);function qx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Kx extends y.Component{constructor(){super(...arguments),qx(this,"handleEnterKeyInStart",(()=>{this.endD2TextFieldInstance.focus()})),qx(this,"handleEnterKeyInEnd",(e=>{this.props.handleEnterKeyInTo&&this.props.handleEnterKeyInTo(e)})),qx(this,"handleFieldBlur",(e=>{this.props.handleFieldBlur&&this.props.handleFieldBlur(this.getUpdatedValue(e))})),qx(this,"setEndD2TextFieldInstance",(e=>{this.endD2TextFieldInstance=e}))}getUpdatedValue(e){const t={...this.props.value,...e};return Object.keys(t).filter((e=>t[e])).length>0?t:{start:void 0,end:void 0}}render(){const{value:e,classes:t,startValueError:r,endValueError:a}=this.props;return y.createElement("div",null,y.createElement("div",{className:t.container},y.createElement("div",{className:t.inputContainer},y.createElement($x,{value:e&&e.start,error:r,errorClass:t.error,onBlur:this.handleFieldBlur,onEnterKey:this.handleEnterKeyInStart})),y.createElement("div",{className:t.toLabelContainer},n.A.t("to")),y.createElement("div",{className:t.inputContainer},y.createElement(Yx,{value:e&&e.end,error:a,errorClass:t.error,onBlur:this.handleFieldBlur,onEnterKey:this.handleEnterKeyInEnd,textFieldRef:this.setEndD2TextFieldInstance}))))}}const Qx=(0,I.withStyles)((e=>({container:{display:"flex",flexWrap:"wrap"},inputContainer:{width:"150px"},toLabelContainer:{paddingTop:e.typography.pxToRem(6),paddingLeft:e.typography.pxToRem(10),paddingRight:e.typography.pxToRem(10),fontSize:e.typography.body1.fontSize},error:{...e.typography.caption,color:e.palette.error.main},logicErrorContainer:{paddingTop:e.typography.pxToRem(10)}})))(Kx);function Xx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Jx=(e,t,r,a)=>{let o={minValueError:null,maxValueError:null,dateLogicError:null};if(e||t){const{isValid:a,error:i}=tM.validateField(e,r),{isValid:s,error:l}=tM.validateField(t,r),d=()=>a&&s&&e&&t&&tM.isFromAfterTo(e,t);o={...o,minValueError:i,maxValueError:l,dateLogicError:d()?n.A.t(tM.errorMessages.FROM_GREATER_THAN_TO):null}}else o={...o,dateLogicError:a?n.A.t(tM.errorMessages.ABSOLUTE_RANGE_WITHOUT_VALUES):null};return o},Zx=(e,t,r)=>{let a={startValueError:null,endValueError:null,bufferLogicError:null};e||t||(a={...a,bufferLogicError:r?n.A.t(tM.errorMessages.RELATIVE_RANGE_WITHOUT_VALUES):null});const{error:o}=tM.validateField(e,it.CO.INTEGER_ZERO_OR_POSITIVE),{error:i}=tM.validateField(t,it.CO.INTEGER_ZERO_OR_POSITIVE);return a={...a,startValueError:o,endValueError:i},a};class eM extends y.Component{static validateField(e,t){if(!e)return{isValid:!0,error:null};const r=(0,tM.validatorForTypes[t])(e);return{isValid:r,error:r?null:n.A.t(tM.errorMessages[t])}}static isFilterValid(e,t,r,n,a){return e===Fx.ABSOLUTE_RANGE?((e,t)=>{if(!e&&!t)return!1;const r=e?Rt(e):{isValid:!0,moment:null},n=t?Rt(t):{isValid:!0,moment:null};return!(!r.isValid||!n.isValid)&&!(r.momentDate&&n.momentDate&&r.momentDate.isAfter(n.momentDate))})(t,r):e!==Fx.RELATIVE_RANGE||((e,t)=>!(!e&&!t)&&!(!tM.validateField(e,it.CO.INTEGER_ZERO_OR_POSITIVE).isValid||!tM.validateField(t,it.CO.INTEGER_ZERO_OR_POSITIVE).isValid))(n,a)}static isFromAfterTo(e,t){const r=Rt(e).momentDate,n=Rt(t).momentDate;return r.isAfter(n)}constructor(e){super(e),Xx(this,"handleEnterKeyInFrom",(()=>{this.toD2DateTextFieldInstance.focus()})),Xx(this,"handleDateSelectedFromCalendarInFrom",(()=>{this.toD2DateTextFieldInstance.focus()})),Xx(this,"handleEnterKeyInTo",(e=>{const t=this.getUpdatedValue(e);this.setState({submitAttempted:!0}),t&&!tM.isFilterValid(t.main,t.from,t.to,t.start,t.end)?this.props.onCommitValue(t):this.props.onUpdate(t||null)})),Xx(this,"handleFieldBlur",(e=>{this.props.onCommitValue(this.getUpdatedValue(e))})),Xx(this,"handleMainSelect",(e=>{const t=e?{main:e}:null;this.props.onCommitValue(t)})),Xx(this,"setToD2DateTextFieldInstance",(e=>{this.toD2DateTextFieldInstance=e})),this.state={submitAttempted:!1}}onGetUpdateData(e){const t="undefined"!==typeof e?e:this.props.value;return t?function(e){return Vx(e)}(t):null}onIsValid(){this.setState({submitAttempted:!0});const e=this.props.value;return!e||tM.isFilterValid(e.main,e.from,e.to,e.start,e.end)}getUpdatedValue(e){const t={...this.props.value,...e};return(null===t||void 0===t?void 0:t.from)||(null===e||void 0===e?void 0:e.from)||(null===e||void 0===e?void 0:e.to)?(t.main=Fx.ABSOLUTE_RANGE,delete t.start,delete t.end):(null===t||void 0===t?void 0:t.start)||(null===e||void 0===e?void 0:e.start)||(null===e||void 0===e?void 0:e.end)?(t.main=Fx.RELATIVE_RANGE,delete t.from,delete t.to):t.main!==Fx.ABSOLUTE_RANGE&&t.main!==Fx.RELATIVE_RANGE||(t.main=null),Object.keys(t).filter((e=>t[e])).length>0?t:null}getErrors(){const e=this.props.value,t=this.state.submitAttempted,r=e&&e.main,n=e&&e.from,a=e&&e.to,o=e&&e.start,i=e&&e.end,s=this.props.type,l={minValueError:null,maxValueError:null,startValueError:null,endValueError:null,dateLogicError:null,bufferLogicError:null};return r===Fx.ABSOLUTE_RANGE?{...l,...Jx(n,a,s,t)}:r===Fx.RELATIVE_RANGE?{...l,...Zx(o,i,t)}:l}render(){const{value:e,classes:t,onFocusUpdateButton:r}=this.props,{minValueError:a,maxValueError:o,startValueError:i,endValueError:s,dateLogicError:l,bufferLogicError:d}=this.getErrors();return y.createElement("div",{id:"dateFilter"},y.createElement("div",null,y.createElement(JF,{optionSet:tM.mainOptionSet,orientation:QF,value:e&&e.main,onBlur:this.handleMainSelect,color:"secondary",nullable:!0})),y.createElement("div",{className:t.fromToContainer},y.createElement("div",{className:t.inputContainer},y.createElement(Px,{value:e&&e.from,error:a,errorClass:t.error,onBlur:this.handleFieldBlur,onEnterKey:this.handleEnterKeyInFrom,onDateSelectedFromCalendar:this.handleDateSelectedFromCalendarInFrom})),y.createElement("div",{className:t.toLabelContainer},n.A.t("to")),y.createElement("div",{className:t.inputContainer},y.createElement(Lx,{value:e&&e.to,error:o,errorClass:t.error,onBlur:this.handleFieldBlur,onEnterKey:this.handleEnterKeyInTo,textFieldRef:this.setToD2DateTextFieldInstance,onFocusUpdateButton:r}))),y.createElement("div",null,y.createElement(JF,{optionSet:tM.optionSet,orientation:QF,value:e&&e.main,onBlur:this.handleMainSelect,color:"secondary",nullable:!0})),y.createElement("div",null,y.createElement(Qx,{value:{start:null===e||void 0===e?void 0:e.start,end:null===e||void 0===e?void 0:e.end},startValueError:i,endValueError:s,handleFieldBlur:this.handleFieldBlur,handleEnterKeyInTo:this.handleEnterKeyInTo})),y.createElement("div",{className:er()(t.error,t.logicErrorContainer)},l),y.createElement("div",{className:er()(t.error,t.logicErrorContainer)},d))}}Xx(eM,"errorMessages",{ABSOLUTE_RANGE_WITHOUT_VALUES:"Please specify a range",RELATIVE_RANGE_WITHOUT_VALUES:"Please specify the number of days",FROM_GREATER_THAN_TO:"The From date can't be after the To date",MIN_GREATER_THAN_MAX:"Days in the past cannot be greater than days in the future",[it.CO.DATE]:"Please provide a valid date",[it.CO.INTEGER_ZERO_OR_POSITIVE]:"Please provide zero or a positive integer"}),Xx(eM,"validatorForTypes",{[it.CO.DATE]:xc,[it.CO.INTEGER_ZERO_OR_POSITIVE]:zt}),Xx(eM,"mainOptionSet",new ox.G("mainOptions",[new ix.c((e=>{e.text=xx[Fx.TODAY],e.value=Fx.TODAY})),new ix.c((e=>{e.text=xx[Fx.THIS_WEEK],e.value=Fx.THIS_WEEK})),new ix.c((e=>{e.text=xx[Fx.THIS_MONTH],e.value=Fx.THIS_MONTH})),new ix.c((e=>{e.text=xx[Fx.THIS_YEAR],e.value=Fx.THIS_YEAR})),new ix.c((e=>{e.text=xx[Fx.LAST_WEEK],e.value=Fx.LAST_WEEK})),new ix.c((e=>{e.text=xx[Fx.LAST_MONTH],e.value=Fx.LAST_MONTH})),new ix.c((e=>{e.text=xx[Fx.LAST_3_MONTHS],e.value=Fx.LAST_3_MONTHS})),new ix.c((e=>{e.text=xx[Fx.ABSOLUTE_RANGE],e.value=Fx.ABSOLUTE_RANGE}))])),Xx(eM,"optionSet",new ox.G("mainOptions",[new ix.c((e=>{e.text=xx[Fx.RELATIVE_RANGE],e.value=Fx.RELATIVE_RANGE}))]));const tM=(0,I.withStyles)((e=>({fromToContainer:{display:"flex",flexWrap:"wrap"},inputContainer:{},toLabelContainer:{width:30,display:"flex",justifyContent:"center",alignItems:"center",paddingTop:e.typography.pxToRem(6),fontSize:e.typography.body1.fontSize},error:{...e.typography.caption,color:e.palette.error.main},logicErrorContainer:{paddingTop:e.typography.pxToRem(10)}})))(eM),rM=(e,t)=>void 0!==e&&null!==e&&Number.isInteger(e)&&e<=0&&void 0!==t&&null!==t&&Number.isInteger(t)&&t>=0;function nM(){return nM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nM.apply(this,arguments)}function aM(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class oM extends y.Component{static convertDateForEdit(e){return _t($()(e))}static calculateAbsoluteRangeValueState(e){return{main:Fx.ABSOLUTE_RANGE,from:e.ge&&oM.convertDateForEdit(e.ge),to:e.le&&oM.convertDateForEdit(e.le)}}static calculateRelativeRangeValueState(e){return{main:Fx.RELATIVE_RANGE,start:e.startBuffer||0===e.startBuffer?Math.abs(e.startBuffer).toString():void 0,end:e.endBuffer||0===e.endBuffer?e.endBuffer.toString():void 0}}static calculateDefaultValueState(e){if(e)return e.type===Mx.RELATIVE?e.period?{main:e.period}:rM(e.startBuffer,e.endBuffer)?oM.calculateRelativeRangeValueState(e):void S().warn("The startBuffer and endBuffer values are not supported by the UI",e.startBuffer,e.endBuffer):oM.calculateAbsoluteRangeValueState(e)}constructor(e){super(e),aM(this,"handleCommitValue",(e=>{this.setState({value:e}),this.props.handleCommitValue&&this.props.handleCommitValue()})),this.state={value:oM.calculateDefaultValueState(this.props.filter)}}render(){const{filter:e,filterTypeRef:t,...r}=this.props;return y.createElement(tM,nM({value:this.state.value,innerRef:t,onCommitValue:this.handleCommitValue},r))}}function iM(e){return{usingOptionSet:!0,values:e}}const sM=iM;class lM extends y.Component{onGetUpdateData(){const{value:e,singleSelect:t}=this.props;return e?t?(e=>iM([e]))(e):sM(e):null}onIsValid(){return!0}render(){const{onCommitValue:e,options:t,value:r,classes:n,singleSelect:a}=this.props;return y.createElement("div",{className:n.selectBoxesContainer},y.createElement("div",{className:n.selectBoxesInnerContainer},y.createElement(JF,{options:t,value:r,onBlur:e,orientation:QF,multiSelect:!a,nullable:!0})))}}const dM=(0,I.withStyles)((e=>({selectBoxesContainer:{maxHeight:e.typography.pxToRem(250),overflowY:"auto"},selectBoxesInnerContainer:{marginLeft:12}})))(lM);function cM(){return cM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cM.apply(this,arguments)}function uM(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class pM extends y.Component{static calculateDefaultValueState(e,t){if(e)return t?e.values[0]:e.values}constructor(e){super(e),uM(this,"handleCommitValue",(e=>{this.setState({value:e}),this.props.handleCommitValue&&this.props.handleCommitValue()})),this.state={value:pM.calculateDefaultValueState(this.props.filter,!!this.props.singleSelect)}}render(){const{filter:e,filterTypeRef:t,...r}=this.props;return y.createElement(dM,cM({value:this.state.value,innerRef:t,onCommitValue:this.handleCommitValue},r))}}const mM="CURRENT",gM="ANY",hM="NONE",EM="PROVIDED";function yM(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class vM extends y.Component{constructor(e){super(e),yM(this,"handleModeSelect",(e=>{this.setState({error:""}),e?this.props.onCommitValue({mode:e}):this.props.onCommitValue(null)})),yM(this,"handleUserSelect",(e=>{this.setState({error:""}),this.props.onCommitValue({mode:EM,provided:e})})),this.modeOptions=[{name:n.A.t("Me"),value:mM},{name:n.A.t("Anyone"),value:gM},{name:n.A.t("None"),value:hM},{name:n.A.t("Select user"),value:EM}],this.state={error:""}}onGetUpdateData(){const{value:e}=this.props;return e&&function(e){return{assignedUserMode:e.mode,assignedUser:e.provided}}(e)}onIsValid(){const{value:e}=this.props;return!(e&&e.mode===EM&&!e.provided)||(this.setState({error:n.A.t("Please select the user")}),!1)}render(){const{value:e,classes:t}=this.props,{mode:r,provided:a}=e||{};return y.createElement("div",null,y.createElement("div",{className:t.selectBoxesContainer},y.createElement(mp,{options:this.modeOptions,value:r,orientation:qr,multiSelect:!1,onSelect:this.handleModeSelect})),r===EM?y.createElement("div",null,y.createElement(Uh,{value:a,onSet:this.handleUserSelect,inputPlaceholderText:n.A.t("Search for user"),focusOnMount:!0,useUpwardSuggestions:!0})):null,y.createElement("div",{className:t.error},this.state.error))}}const fM=(0,I.withStyles)((e=>({selectBoxesContainer:{maxHeight:e.typography.pxToRem(250),overflowY:"auto",marginRight:e.typography.pxToRem(-24)},error:{color:e.palette.error.main}})))(vM);function IM(){return IM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},IM.apply(this,arguments)}function bM(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class SM extends y.Component{static calculateDefaultValueState(e){if(e)return{mode:e.assignedUserMode,provided:e.assignedUser}}constructor(e){super(e),bM(this,"handleCommitValue",(e=>{this.setState({value:e}),this.props.handleCommitValue&&this.props.handleCommitValue()})),this.state={value:SM.calculateDefaultValueState(this.props.filter)}}render(){const{filter:e,filterTypeRef:t,...r}=this.props;return y.createElement(fM,IM({value:this.state.value,innerRef:t,onCommitValue:this.handleCommitValue},r))}}const TM=Object.freeze({PROVIDED:"PROVIDED",CURRENT:"CURRENT",ANY:"ANY",NONE:"NONE"});function AM(){return AM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AM.apply(this,arguments)}const CM=nF()(pM),OM={[ZL.TEXT]:vF,[ZL.NUMBER]:kF,[ZL.INTEGER]:kF,[ZL.INTEGER_POSITIVE]:kF,[ZL.INTEGER_NEGATIVE]:kF,[ZL.INTEGER_ZERO_OR_POSITIVE]:kF,[ZL.DATE]:oM,[ZL.BOOLEAN]:hx,[ZL.TRUE_ONLY]:ax,[ZL.ASSIGNEE]:SM},NM=(0,I.withStyles)((e=>({container:{padding:e.typography.pxToRem(24)}})))((e=>{let{classes:t,filterValue:r,type:n,options:a,multiValueFilter:o,isRemovable:i,...s}=e;const l=(e=>{let{filterValue:t,classes:r,type:n,options:a,multiValueFilter:o,isRemovable:i,...s}=e;const[l,d]=(0,y.useState)(!0),[c,u]=(0,y.useMemo)((()=>{if(a&&a.length<=25)return[CM,!0];const e=OM[n];return[nF()(e),!1]}),[n,a]);return u?y.createElement(c,AM({},s,{filter:t,options:a,singleSelect:!o,handleCommitValue:()=>d(!1),disabledUpdate:l,disabledReset:void 0===t,isRemovable:i})):y.createElement(c,AM({},s,{filter:t,type:n,singleSelect:!o,handleCommitValue:()=>d(!1),disabledUpdate:l,disabledReset:void 0===t}))})({classes:t,filterValue:r,type:n,options:a,multiValueFilter:o,isRemovable:i,...s});return y.createElement("div",{className:t.container,"data-test":"list-view-filter-contents"},l)}));function RM(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class wM extends y.Component{constructor(e){super(e),RM(this,"openFilterSelector",(()=>{const{itemId:e,onSetVisibleSelector:t}=this.props;t(e),this.props.filterValue&&this.activeFilterButtonInstance&&this.activeFilterButtonInstance.clearIsHovered()})),RM(this,"closeFilterSelector",(()=>{const{onSetVisibleSelector:e}=this.props;e(void 0)})),RM(this,"onClose",(()=>{this.handleFilterUpdate(null)})),RM(this,"onRemove",(()=>{const{itemId:e,onRemoveFilter:t}=this.props;this.closeFilterSelector(),t&&t(e)})),RM(this,"handleFilterUpdate",(e=>{const{itemId:t,onUpdateFilter:r,onClearFilter:n}=this.props;null==e?n(t):r(e,t),this.closeFilterSelector()})),RM(this,"handleClearFilter",(()=>{const{itemId:e,onClearFilter:t}=this.props;t(e)})),RM(this,"refActiveFilterInstance",(e=>{this.activeFilterButtonInstance=e})),this.state={isMounted:!1},this.anchorRef=y.createRef()}componentDidMount(){this.setState({isMounted:!0})}renderSelectorContents(){const{itemId:e,type:t,options:r,multiValueFilter:n,filterValue:a,isRemovable:o}=this.props;return y.createElement(NM,{type:t,options:r,multiValueFilter:n,id:e,onUpdate:this.handleFilterUpdate,onClose:this.onClose,filterValue:a,onRemove:this.onRemove,isRemovable:o})}renderWithAppliedFilter(){const{selectorVisible:e,classes:t,title:r,buttonText:n}=this.props,a=e?y.createElement("span",{className:t.icon},y.createElement(En,null)):y.createElement("span",{className:t.icon},y.createElement(hn,null));return y.createElement(JL,{innerRef:this.refActiveFilterInstance,onChange:this.openFilterSelector,onClear:this.handleClearFilter,iconClass:t.icon,title:r,arrowIconElement:a,buttonText:n})}renderWithoutAppliedFilter(){const{selectorVisible:e,classes:t,title:r,disabled:n,tooltipContent:a}=this.props;return y.createElement(aI,{content:a,enabled:n,closeDelay:50},y.createElement(ra.$,{disabled:n,onClick:this.openFilterSelector},r,y.createElement("span",{className:t.icon},e?y.createElement(En,null):y.createElement(hn,null))))}render(){const{filterValue:e,selectorVisible:t}=this.props,{isMounted:r}=this.state,n=e?this.renderWithAppliedFilter():this.renderWithoutAppliedFilter();return y.createElement(y.Fragment,null,y.createElement("div",{"data-test":"filter-button-popover-anchor",ref:this.anchorRef},n),t&&r&&y.createElement(Am.A,{reference:this.anchorRef.current,arrow:!1,placement:"bottom-start",onClickOutside:this.closeFilterSelector,maxWidth:400},(()=>t?this.renderSelectorContents():null)()))}}const _M=(0,I.withStyles)((e=>({icon:{paddingLeft:e.typography.pxToRem(12),display:"flex",alignItems:"center"},inactiveFilterButton:{backgroundColor:"#f5f5f5"},inactiveFilterButtonLabel:{textTransform:"none"}})))(wM),PM="THIS_WEEK",kM="THIS_MONTH",DM="THIS_YEAR",UM="LAST_WEEK",LM="LAST_MONTH",FM="LAST_3_MONTHS",xM="RELATIVE_RANGE",MM={["TODAY"]:n.A.t("Today"),[PM]:n.A.t("This week"),[kM]:n.A.t("This month"),[DM]:n.A.t("This Year"),[UM]:n.A.t("Last week"),[LM]:n.A.t("Last month"),[FM]:n.A.t("Last 3 months"),[xM]:n.A.t("Relative range")},VM=e=>(0,j.Fs)((e=>$()(e)),(e=>_t(e)))(e);const jM={true:n.A.t("Yes"),false:n.A.t("No")};function GM(e){let t="";const r=!!e.ge||0===e.ge,a=!!e.le||0===e.le;return t=r&&a?e.ge===e.le?e.ge.toString():`${e.ge.toString()} ${n.A.t("to")} ${e.le.toString()}`:r?`${n.A.t("greater than or equal to")} ${e.ge.toString()}`:`${n.A.t("less than or equal to")} ${e.le.toString()}`,t}function BM(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=typeof e;if("object"!==r||r!==typeof t||Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e))return e.every(((e,r)=>BM(e,t[r])));const n=[...Object.keys(e),...Object.keys(t)];return[...new Set(n).values()].every((r=>BM(e[r],t[r])))}const $M={[ZL.TEXT]:function(e){return e.value},[ZL.NUMBER]:GM,[ZL.INTEGER]:GM,[ZL.INTEGER_POSITIVE]:GM,[ZL.INTEGER_NEGATIVE]:GM,[ZL.INTEGER_ZERO_OR_POSITIVE]:GM,[ZL.DATE]:function(e){return"ABSOLUTE"===e.type?function(e){let t="";const r=e.ge,a=e.le;if(r&&a){const e=$()(r),o=$()(a);if(e.isSame(o))t=_t(e);else{const r=_t(e),a=_t(o);t=n.A.t("{{fromDate}} to {{toDate}}",{fromDate:r,toDate:a})}}else if(r){const e=VM(r);t=n.A.t("after or equal to {{date}}",{date:e})}else{const e=VM(a);t=n.A.t("before or equal to {{date}}",{date:e})}return t}(e):e.period?MM[e.period]:rM(e.startBuffer,e.endBuffer)?MM[xM]:""},[ZL.ASSIGNEE]:function(e){return e.assignedUserMode!==TM.PROVIDED?(e=>({[TM.CURRENT]:n.A.t("Me"),[TM.ANY]:n.A.t("Anyone"),[TM.NONE]:n.A.t("None")}[e]))(e.assignedUserMode):e.assignedUser.name},[ZL.BOOLEAN]:function(e){return(0,j.Fs)((e=>e.map((e=>(e=>jM[e])(e)))),(e=>e.join(", ")))(e.values)},[ZL.TRUE_ONLY]:function(){return n.A.t("Yes")}};function WM(e,t,r){return e.usingOptionSet&&r?function(e,t){const r=e.values.map((e=>{const r=t.find((t=>BM(t.value,e)));return r&&r.text})).filter((e=>e)).join(", ");return r.length>20?`${r.substring(0,18)}..`:r}(e,r):$M[t](e)}function HM(){return HM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HM.apply(this,arguments)}const zM=(0,y.memo)((e=>{let{filterValue:t,type:r,options:n,...a}=e;const o=(0,y.useMemo)((()=>t?WM(t,r,n):t),[t,r,n]);return y.createElement(_M,HM({},a,{filterValue:t,type:r,options:n,buttonText:o}))}));function YM(){return YM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YM.apply(this,arguments)}const qM=e=>{let{itemId:t,...r}=e;const n=(0,y.useContext)(zL),a=n&&n[t]||void 0;return y.createElement(zM,YM({},r,{itemId:t,filterValue:a}))},KM=(0,y.memo)((e=>y.createElement(qM,e)));var QM=r(93196);const XM=e=>{let{columns:t,onItemSelected:r}=e;const[a,o]=(0,y.useState)(!1),i=(0,y.useCallback)((()=>{o((e=>!e))}),[]),s=(0,y.useCallback)((e=>{o(!1),r(e)}),[r]),l=(0,y.useCallback)((()=>t.map((e=>y.createElement(bh.D,{key:e.id,onClick:()=>s(e.id),label:e.header})))),[t,s]);return y.createElement(QM.g,{dataTest:"more-filters",onClick:i,open:a,component:y.createElement(AI.n,{role:"menu",dataTest:"more-filters-menu",maxHeight:"300px"},l())},n.A.t("More filters"))},JM=(0,y.memo)((e=>{const{columns:t,stickyFilters:r,onSelectRestMenuItem:n,onUpdateFilter:a,onClearFilter:o,onRemoveFilter:i,filtersOnly:s,additionalFilters:l,classes:d}=e,[c,u]=y.useState(e.visibleSelectorId),p=(0,y.useMemo)((()=>(s||[]).filter((e=>!e.showInMoreFilters))),[s]),m=p.length,g=y.useMemo((()=>{const e=t||[],n=(s||[]).filter((e=>e.showInMoreFilters)),a=(e=>new Map(e.filter((e=>Object.values(ZL).includes(e.type)&&!e.filterHidden)).map(((e,t)=>({element:e,index:t}))).sort(((e,t)=>{const r=!!e.element.visible;return r===!!t.element.visible?e.index-t.index:r?-1:1})).map((e=>[e.element.id,e.element]))))(e),o=(e=>new Map(e.map((e=>[e.id,e]))))(n),i=new Map([...a,...o]),{filtersWithValueOnInit:d,userSelectedFilters:c}=r,{initValueElements:u,remainingElements:p}=((e,t)=>{const r=t||{};return Object.keys(r).reduce(((t,n)=>{const a=e.get(n);return a?(t.initValueElements.set(n,a),t.remainingElements.delete(n),t):(S().warn((0,j.px)("a filter with no config element was found")({key:n,value:r[n]})),t)}),{initValueElements:new Map,remainingElements:new Map(e.entries())})})(i,d),{fillUpElements:g,remainingElements:h}=((e,t)=>{const r=new Map,n=4-t;for(let a=0;e.size>0&&a<n;a++){const[t,n]=e.entries().next().value;r.set(t,n),e.delete(t)}return{fillUpElements:r,remainingElements:e}})(p,u.size+m),{remainingElements:E}=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=new Map([...e]);return t.length>0?(t.forEach((e=>{!r[e.id]&&!n[e.id]&&a.set(e.id,e)})),{remainingElements:a}):{remainingElements:e}}(h,n,d,c),{remainingElements:y}=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=t&&t.find((e=>e.mainButton));if(a)return r[a.id]||n[a.id]?{remainingElements:e}:{remainingElements:new Map([...e,[a.id,a]])};return{remainingElements:e}}(E,l,d,c),{userSelectedElements:v,remainingElements:f}=((e,t)=>{const r=t||{};return Object.keys(r).reduce(((t,r)=>{const n=e.get(r);return n?(t.userSelectedElements.set(r,n),t.remainingElements.delete(r),t):(S().warn((0,j.px)("a userSelectedFilter was specified but no config element was found")({key:r})),t)}),{userSelectedElements:new Map,remainingElements:e})})(y,c),I=((e,t,r,n)=>[...e.entries()].map((e=>e[1])).map((e=>{if(t.has(e.id)||r.has(e.id)||n.has(e.id))return e})).filter((e=>e)))(i,u,g,v);return{individualElementsArray:I,restElementsArray:[...f.entries()].map((e=>e[1]))}}),[t,r,s,m,l]),h=y.useCallback((e=>{u(e),n(e)}),[u,n]),E=y.useMemo((()=>{const{individualElementsArray:e,restElementsArray:t}=g,r=(e=>{let{individualElementsArray:t,filtersOnly:r,visibleSelectorId:n,onSetVisibleSelector:a,onUpdateFilter:o,onClearFilter:i,onRemoveFilter:s,classes:l}=e;return[...r||[],...t].map((e=>{let{id:t,type:r,header:d,options:c,multiValueFilter:u,disabled:p,tooltipContent:m,mainButton:g}=e;return y.createElement("div",{key:t,"data-test":`filter-button-container-${t}`,className:l.filterButtonContainer},y.createElement(KM,{"data-test":`filter-button-${t}`,itemId:t,type:r,title:d,options:c,disabled:p,tooltipContent:m,multiValueFilter:u,onSetVisibleSelector:a,selectorVisible:t===n,onUpdateFilter:o,onClearFilter:i,isRemovable:g,onRemoveFilter:s}))}))})({individualElementsArray:e,visibleSelectorId:c,onSetVisibleSelector:u,onUpdateFilter:a,onClearFilter:o,onRemoveFilter:i,filtersOnly:p,classes:d}),n=((e,t)=>e.length>0?y.createElement(XM,{key:"restMenu","data-test":"filter-rest-menu",columns:e,onItemSelected:t}):null)(t,h);return[[...r],n]}),[g,c,u,d,h,a,o,i,p]);return y.createElement(y.Fragment,null,E)})),ZM=(0,I.withStyles)((e=>({filterButtonContainer:{paddingRight:e.typography.pxToRem(e.spacing.unit),paddingBottom:e.typography.pxToRem(e.spacing.unit/2),paddingTop:e.typography.pxToRem(e.spacing.unit/2)}})))(JM),eV=(0,I.withStyles)((()=>({filtersButtons:{display:"flex",alignItems:"baseline",flexWrap:"wrap"},break:{flexBasis:"100%",height:0},additionalFiltersContainer:{backgroundColor:vn.T.grey100,borderRadius:yn.U.dp4,border:`1px solid ${vn.T.grey400}`,marginTop:yn.U.dp4,marginLeft:yn.U.dp16,padding:yn.U.dp4,display:"flex",alignItems:"baseline",flexWrap:"wrap"},additionalFiltersTitle:{color:vn.T.grey600,fontSize:12}})))((e=>{let{columns:t,filtersOnly:r,additionalFilters:a,onUpdateFilter:o,onClearFilter:i,onRemoveFilter:s,onSelectRestMenuItem:l,stickyFilters:d,shouldRenderAdditionalFiltersButtons:c,visibleSelectorId:u,classes:p}=e;return y.createElement(y.Fragment,null,y.createElement("div",{className:p.filtersButtons},y.createElement(ZM,{columns:t.filter((e=>!e.additionalColumn)),filtersOnly:r,additionalFilters:a,onUpdateFilter:o,onClearFilter:i,onSelectRestMenuItem:l,stickyFilters:d})),c&&y.createElement(y.Fragment,null,y.createElement("div",{className:p.break}),y.createElement("div",{className:p.additionalFiltersContainer},y.createElement("div",{className:p.additionalFiltersTitle},n.A.t("Stage filters").toUpperCase()),y.createElement("div",{className:p.break}),y.createElement(ZM,{columns:t.filter((e=>e.additionalColumn)),filtersOnly:a,onUpdateFilter:o,onClearFilter:i,onSelectRestMenuItem:l,stickyFilters:d,visibleSelectorId:u,onRemoveFilter:e=>s(e,d.filtersWithValueOnInit)}))))})),tV=e=>{let{columns:t,filtersOnly:r,additionalFilters:n,onUpdateFilter:a,onClearFilter:o,onRemoveFilter:i,onSelectRestMenuItem:s,stickyFilters:l,programStageId:d}=e;const{shouldRenderAdditionalFiltersButtons:c,visibleSelectorId:u}=(e=>{let{additionalFilters:t,stickyFilters:r,filterHasValue:n}=e;if(t&&r){const{filtersWithValueOnInit:e={},userSelectedFilters:a={}}=r,o=t.find((e=>e.mainButton));return o?{shouldRenderAdditionalFiltersButtons:a[o.id]||e[o.id],visibleSelectorId:n?void 0:o.id}:{shouldRenderAdditionalFiltersButtons:!1,visibleSelectorId:void 0}}return{shouldRenderAdditionalFiltersButtons:!1,visibleSelectorId:void 0}})({additionalFilters:n,stickyFilters:l,filterHasValue:Boolean(d)});return y.createElement(eV,{columns:t,filtersOnly:r,additionalFilters:n,onUpdateFilter:a,onClearFilter:o,onRemoveFilter:i,onSelectRestMenuItem:s,stickyFilters:l,shouldRenderAdditionalFiltersButtons:c,visibleSelectorId:u})};function rV(){return rV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rV.apply(this,arguments)}function nV(){return nV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nV.apply(this,arguments)}function aV(){return aV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},aV.apply(this,arguments)}function oV(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const iV=(e=>class extends y.Component{constructor(e){super(e),this.translations={clearText:n.A.t("Clear"),noResults:n.A.t("No results")}}render(){const{...t}=this.props;return y.createElement(e,nV({translations:this.translations},t))}})(zu),sV=e=>class t extends y.Component{static getOptions(){return[10,15,25,50,100].map((e=>({label:e.toString(),value:e})))}constructor(r){super(r),oV(this,"handleRowsSelect",(e=>{this.props.onChangeRowsPerPage(e)})),oV(this,"renderSelectorElement",(()=>{const{rowsPerPage:e,disabled:t}=this.props;return y.createElement("div",{id:"rows-per-page-selector","data-test":"rows-per-page-selector"},y.createElement(iV,{onSelect:this.handleRowsSelect,options:this.options,value:e,nullable:!1,disabled:t,withoutUnderline:!0,searchable:!1}))})),oV(this,"render",(()=>{const{...t}=this.props;return y.createElement(e,aV({rowsCountSelector:this.renderSelectorElement()},t))})),this.options=t.getOptions()}};function lV(){return lV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lV.apply(this,arguments)}const dV=(e=>sV(e))(LO()(Fo)),cV=e=>{let{rowCountPage:t,rowsPerPage:r,...a}=e;return y.createElement(dV,lV({},a,{rowsPerPage:r,rowsCountSelectorLabel:n.A.t("Rows per page"),nextPageButtonDisabled:!!(r>t)}))};function uV(){return uV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uV.apply(this,arguments)}const pV=e=>{const t=(0,y.useContext)(YL);return y.createElement(cV,uV({},e,t))},mV=(0,y.memo)((e=>y.createElement(pV,e)));var gV=r(48476),hV=r(31932),EV=r(42226),yV=r(9226),vV=r.n(yV),fV=r(64577),IV=r(98415),bV=r(99962),SV=r(94139);const TV="listItem",AV=(0,I.withStyles)({rowWithoutHover:{"&:hover > td":{backgroundColor:"transparent !important"}}})((e=>{let{id:t,index:r,text:n,visible:a,handleToggle:o,moveListItem:i,isDraggingAny:s,onDragStart:l,onDragEnd:d,classes:c}=e;const u=(0,y.useRef)(null),[,p]=(0,bV.H)({accept:TV,hover(e){const t=e.index,n=r;t!==n&&(i(t,n),e.index=n)}}),[{isDragging:m},g]=(0,SV.i)({type:TV,item:{id:t,index:r},collect:e=>({isDragging:e.isDragging()})});g(p(u));const h=m?0:1;return y.createElement(SR.J,{ref:u,style:{opacity:h},className:s?c.rowWithoutHover:null,draggable:!0,onDragStart:l,onDragEnd:d},y.createElement(IR.B,null,n),y.createElement(IR.B,null,y.createElement(FF.S,{checked:a,onChange:o(t),valid:!0,dense:!0})))}));function CV(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class OV extends y.Component{constructor(){super(...arguments),CV(this,"state",{isDraggingAny:!1}),CV(this,"moveListItem",((e,t)=>{const{listItems:r}=this.props,n=r[e];let a=[];a=vV()(r,{$splice:[[e,1],[t,0,n]]}),this.props.handleUpdateListOrder(a)})),CV(this,"handleDragStart",(()=>{this.setState({isDraggingAny:!0})})),CV(this,"handleDragEnd",(()=>{this.setState({isDraggingAny:!1})}))}render(){const{listItems:e}=this.props,{isDraggingAny:t}=this.state;return y.createElement(hV.Q,{backend:EV.t2},y.createElement(TR.b,null,y.createElement(fV.n,null,y.createElement(SR.J,null,y.createElement(fR.w,null),y.createElement(fR.w,null,n.A.t("Column")),y.createElement(fR.w,null,n.A.t("Visible")))),y.createElement(IV.B,null,e.map(((e,r)=>y.createElement(AV,{key:e.id,index:r,id:e.id,text:e.header,moveListItem:this.moveListItem,handleToggle:this.props.handleToggle,visible:e.visible,isDraggingAny:t,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd}))))))}}const NV=e=>{let{columns:t,open:r,onClose:a,onSave:o}=e;const[i,s]=(0,y.useState)(t);(0,y.useEffect)((()=>{s((e=>(0,Ya.isEqual)(t,e)?e:t))}),[t]);return r?y.createElement("span",null,y.createElement(N.a,{hide:!r,onClose:a,dataTest:"column-selector-dialog"},y.createElement(Ip.w,null,n.A.t("Columns to show in table")),y.createElement(R.$,null,y.createElement(OV,{listItems:i,handleUpdateListOrder:e=>{s(e)},handleToggle:e=>()=>{const t=i.findIndex((t=>t.id===e)),r=[...i];r[t]={...r[t],visible:!r[t].visible},s(r)}})),y.createElement(ta.N,null,y.createElement(ra.$,{onClick:()=>{o(i)},primary:!0,initialFocus:!0},n.A.t("Save"))))):null};function RV(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class wV extends y.PureComponent{constructor(e){super(e),RV(this,"openDialog",(()=>{this.setState({dialogOpen:!0})})),RV(this,"closeDialog",(()=>{this.setState({dialogOpen:!1})})),RV(this,"handleSaveColumns",(e=>{this.props.onSave(e),this.closeDialog()})),this.state={dialogOpen:!1}}render(){const{columns:e}=this.props;return y.createElement(y.Fragment,null,y.createElement(Xo.m,{openDelay:500,content:n.A.t("Select columns"),dataTest:"select-columns"},y.createElement(Bo,{onClick:this.openDialog},y.createElement(gV.A,null))),y.createElement(NV,{open:this.state.dialogOpen,onClose:this.closeDialog,onSave:this.handleSaveColumns,columns:e}))}}var _V=r(58368);const PV=e=>{const{customRowMenuContents:t=[],row:r}=e,n=(0,y.useRef)(null),[a,o]=(0,y.useState)(!1);return y.createElement("div",{ref:n,style:{display:"inline-block",position:"relative"}},y.createElement(Bo,{onClick:()=>{o((e=>!e))},"data-test":"row-menu-toggle"},y.createElement(_V.A,null)),a&&y.createElement(NI.W,{onBackdropClick:()=>o(!1),transparent:!0},y.createElement(RI.N,{placement:"right",reference:n,"data-test":"row-menu-popper"},y.createElement(AI.n,{role:"menu"},t.map((e=>y.createElement(bh.D,{key:e.key,"data-test":`menu-item-${e.key}`,onClick:()=>{e.clickHandler&&(o(!1),e.clickHandler(r))},disabled:!e.clickHandler,label:e.label,icon:e.icon})))))))};function kV(){return kV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kV.apply(this,arguments)}const DV=()=>({getCellBody:(e,t)=>y.createElement(PV,kV({row:e},t)),headerCellStyle:{width:96}});function UV(){return UV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},UV.apply(this,arguments)}function LV(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var FV=r(47671);const xV=(0,y.memo)((0,I.withStyles)((()=>({subHeader:{paddingLeft:16,paddingRight:16,paddingTop:10,paddingBottom:10,color:"#717c8b",fontWeight:500,fontSize:16,"&:focus":{outline:"none",color:"black"}},subHeaderDivider:{"&:focus":{outline:"none",backgroundColor:"black"}}})))((e=>{let{customMenuContents:t=[],classes:r}=e;const n=(0,y.useRef)(null),[a,o]=(0,y.useState)(!1),i=(0,y.useCallback)((()=>t.map((e=>e.subHeader?y.createElement(y.Fragment,null,y.createElement(FV.c,{key:`${e.key}divider`,dataTest:`subheader-divider-${e.key}`,className:r.subHeaderDivider}),",",y.createElement("div",{key:e.key,"data-test":`subheader-${e.key}`,className:r.subHeader},e.subHeader),","):y.createElement(bh.D,{key:e.key,"data-test":`menu-item-${e.key}`,onClick:()=>{e.clickHandler&&(o(!1),e.clickHandler())},disabled:!e.clickHandler,label:e.element}))).flat(1)),[t,r]);return y.createElement("div",{ref:n,style:{display:"inline-block",position:"relative"}},y.createElement(Bo,{onClick:()=>{o((e=>!e))},dataTest:"list-view-menu-button"},y.createElement(_V.A,null)),a&&y.createElement(NI.W,{onBackdropClick:()=>o(!1),transparent:!0},y.createElement(RI.N,{placement:"bottom-end",reference:n},y.createElement(AI.n,{role:"menu"},i()))))})));function MV(){return MV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},MV.apply(this,arguments)}function VV(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const jV=(e=>class extends y.Component{constructor(){super(...arguments),LV(this,"getCustomEndCellBody",((e,t)=>DV().getCellBody(e,t))),LV(this,"getCustomEndCellHeader",((e,t)=>{const r=DV();return r.getCellHeader&&r.getCellHeader(t)}))}render(){const t=DV();return y.createElement(e,UV({getCustomEndCellHeader:this.getCustomEndCellHeader,getCustomEndCellBody:this.getCustomEndCellBody,customEndCellHeaderStyle:t.headerCellStyle,customEndCellBodyStyle:t.bodyCellStyle},this.props))}})(RR);class GV extends y.PureComponent{constructor(){super(...arguments),VV(this,"renderTopBar",(()=>{const{classes:e,filters:t,columns:r,customMenuContents:n,onSetColumnOrder:a,isSelectionInProgress:o,bulkActionBarComponent:i}=this.props;return o?i:y.createElement("div",{className:e.topBarContainer},y.createElement("div",{className:e.topBarLeftContainer},t),y.createElement("div",{className:e.topBarButtonContainer},y.createElement(wV,{onSave:a,columns:r}),y.createElement(xV,{customMenuContents:n})))})),VV(this,"renderPager",(()=>{const{classes:e,isSelectionInProgress:t}=this.props;return y.createElement("div",{className:e.paginationContainer},y.createElement(mV,{disabled:t}))})),VV(this,"renderList",(()=>{const{classes:e,filters:t,updatingWithDialog:r,onClickListRow:n,onRowSelect:a,onSelectAll:o,customRowMenuContents:i,isSelectionInProgress:s,...l}=this.props,d=i&&i.length?jV:RR;return y.createElement(d,MV({},l,{showSelectCheckBox:!0,isSelectionInProgress:s,customRowMenuContents:i,onRowClick:n,onRowSelect:a,onSelectAll:o}))}))}render(){return y.createElement("div",null,this.renderTopBar(),this.renderList(),this.renderPager(),this.props.updatingWithDialog&&y.createElement(w,null))}}const BV=(e=>t=>{let{columns:r,filtersOnly:n,additionalFilters:a,onUpdateFilter:o,onClearFilter:i,onRemoveFilter:s,onSelectRestMenuItem:l,stickyFilters:d,programStageId:c,...u}=t;return y.createElement(e,rV({},u,{columns:r,filters:y.createElement(tV,{columns:r,programStageId:c,filtersOnly:n,additionalFilters:a,onUpdateFilter:o,onClearFilter:i,onRemoveFilter:s,onSelectRestMenuItem:l,stickyFilters:d})}))})((0,I.withStyles)((e=>({topBarContainer:{display:"flex",justifyContent:"space-between",padding:e.typography.pxToRem(8)},topBarLeftContainer:{display:"flex",alignItems:"center",flexWrap:"wrap"},topBarButtonContainer:{display:"flex",gap:"6px",alignItems:"center"},paginationContainer:{fontSize:e.typography.pxToRem(12),color:e.palette.text.secondary,fontWeight:e.typography.fontWeightMedium,display:"flex",justifyContent:"flex-end"}})))(GV));function $V(){return $V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$V.apply(this,arguments)}const WV=e=>{let{filters:t,selectedRows:r,allRowsAreSelected:n,onRowSelect:a,onSelectAll:o,selectionInProgress:i,onChangePage:s,onChangeRowsPerPage:l,rowsPerPage:d,currentPage:c,dataSource:u,...p}=e;const m=(0,y.useMemo)((()=>({onChangePage:s,onChangeRowsPerPage:l,rowsPerPage:d,currentPage:c,rowCountPage:u.length})),[s,l,d,c,u.length]);return y.createElement(zL.Provider,{value:t},y.createElement(YL.Provider,{value:m},y.createElement(BV,$V({},p,{dataSource:u,selectedRows:r,allRowsAreSelected:n,onRowSelect:a,onSelectAll:o,isSelectionInProgress:i}))))};function HV(){return HV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HV.apply(this,arguments)}const zV=(0,y.memo)((e=>{let{columns:t=[],...r}=e;return y.createElement(WV,HV({},r,{columns:t}))}));function YV(){return YV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YV.apply(this,arguments)}function qV(e,t){if(e===t)return!0;const r=Object.keys(e).filter((t=>null!=e[t])),n=Object.keys(t).filter((e=>null!=t[e]));return r.length===n.length&&n.every((r=>(0,Ya.isEqual)(t[r],e[r])))}function KV(){return KV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KV.apply(this,arguments)}const QV=Dp((()=>({margin:10,height:60})))((e=>{let{customListViewMenuContents:t,...r}=e;const n=(0,y.useContext)(jL);if(!n)throw Error("missing ListViewBuilderContext");const{dataSource:a,onClickListRow:o,onRowSelect:i,onSelectAll:s,selectedRows:l,allRowsAreSelected:d,onSortList:c,onSetListColumnOrder:u,stickyFilters:p,...m}=n;if(!a||!p){const e="dataSource and stickyFilters needs to be set in ListViewBuilder";throw S().error((0,j.px)(e)({dataSource:a,stickyFilters:p})),Error(`${e}. See console for details`)}return y.createElement(zV,YV({},r,m,{dataSource:a,selectedRows:l,allRowsAreSelected:d,onClickListRow:o,onRowSelect:i,onSelectAll:s,onSort:c,onSetColumnOrder:u,customMenuContents:t,stickyFilters:p}))})),XV=(e,t)=>{let{forceFirstRunUpdate:r,filters:n,restDependencies:a}=t;const o=(0,y.useRef)(!0);(0,y.useEffect)((()=>{if(!o.current||(o.current=!1,r))return e()}),(e=>{const[t,...r]=e,n=(0,y.useRef)(t);return qV(n.current,t)||(n.current=t),[n.current,...r]})([n,r,...a]))};function JV(){return JV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JV.apply(this,arguments)}const ZV=qm()(Dp((()=>({margin:10,height:60})))((e=>{const{filters:t,sortById:r,sortByDirection:n,onUpdateList:a,programId:o,programStageId:i,orgUnitId:s,categories:l,viewLoadedOnFirstRun:d,...c}=e,u=(0,y.useContext)(VL);if(!u)throw Error("missing ListViewUpdaterContext");const{currentPage:p,rowsPerPage:m,onCancelUpdateList:g,customUpdateTrigger:h,forceUpdateOnMount:E,dirtyList:v,loadedOrgUnitId:f}=u,I=(0,y.useRef)((E||v||f!==s)&&!d);if(!p||!m)throw S().error((0,j.px)("currentPage and rowsPerPage needs to be set during list view loading")({currentPage:p,rowsPerPage:m})),Error("currentPage and rowsPerPage needs to be set during list view loading. See console for details");const b=(0,y.useRef)(f),{computedPage:T,resetMode:A}=b.current===s?{computedPage:p,resetMode:!1}:{computedPage:1,resetMode:!0};return b.current=s,XV((()=>(a({filters:t,sortById:r,sortByDirection:n,currentPage:T,rowsPerPage:m,programId:o,programStageId:i,orgUnitId:s,categories:l,resetMode:A}),()=>g&&g())),{forceFirstRunUpdate:I.current,filters:t,restDependencies:[r,n,T,m,o,i,s,l,h,a,g]}),(0,y.useEffect)((()=>()=>g&&g()),[g]),y.createElement(QV,KV({},c,{filters:t,sortById:r,sortByDirection:n,currentPage:T,rowsPerPage:m,ready:!A}))}))),ej=e=>{let{programId:t,categories:r,loadedViewContext:n,currentTemplate:a,viewPreloaded:o,dirtyView:i,firstRun:s,prevTemplate:l}=e;const d=((e,t,r)=>(0,y.useMemo)((()=>!!r&&of({programId:e,categories:t},r)),[e,t,r]))(t,r,n);let c=!1;return(!d||((e,t,r)=>t&&e.id!==t.id&&!r)(a,l,o)||i&&s)&&(c=!0),c},tj=(0,y.memo)((e=>{const{currentTemplate:t,programId:r,programStageId:n,...a}=e,o=(0,y.useContext)(ML);if(!o)throw Error("missing ListViewLoaderContext");const{sortById:i,sortByDirection:s,filters:l,columns:d,loading:c,onLoadView:u,loadViewError:p,onCancelLoadView:m,onUpdateList:g,orgUnitId:h,categories:E,dirtyView:v,loadedViewContext:f,viewPreloaded:I}=o,{triggerLoad:b,viewLoadedOnFirstRun:S}=(e=>{let{programId:t,programStageId:r,orgUnitId:n,categories:a,loadedViewContext:o,currentTemplate:i,dirtyView:s,onLoadView:l,onCancelLoadView:d,viewPreloaded:c}=e;const u=(0,y.useRef)(!0),p=(0,y.useRef)(void 0),m=(0,y.useRef)(!0),g=(0,y.useRef)(!1),h=ej({programId:t,categories:a,loadedViewContext:o,currentTemplate:i,viewPreloaded:c,dirtyView:s,firstRun:u.current,prevTemplate:p.current});m.current=h;const E=(0,y.useCallback)((()=>{m.current&&d&&d()}),[d]);return(0,y.useEffect)((()=>(p.current=i,u.current=!1,h&&l(i,{programId:t,programStageId:r,orgUnitId:n,categories:a}),()=>E())),[h,l,i,t,r,a,E]),(0,y.useEffect)((()=>()=>d&&d()),[d]),u.current&&h&&(g.current=!0),{triggerLoad:h,viewLoadedOnFirstRun:g.current}})({programId:r,programStageId:n,orgUnitId:h,categories:E,loadedViewContext:f,currentTemplate:t,dirtyView:v,onLoadView:u,onCancelLoadView:m,viewPreloaded:I});return y.createElement(ZV,JV({},a,{sortById:i,sortByDirection:s,filters:l,columns:d,programId:r,programStageId:n,orgUnitId:h,categories:E,ready:!b&&!c,error:p,onUpdateList:g,viewLoadedOnFirstRun:S}))})),rj=e=>{const{onSaveTemplate:t,onClose:r}=e;return y.createElement(y.Fragment,null,y.createElement(Ip.w,null,n.A.t("Save")),y.createElement(R.$,null),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{onClick:r},n.A.t("Cancel")),y.createElement(ra.$,{onClick:t,primary:!0},n.A.t("Save")))))},nj=e=>{const{open:t,onClose:r,onSaveTemplate:n}=e;return t?y.createElement(N.a,{hide:!t,onClose:r,position:"center",dataTest:"existing-template-dialog"},y.createElement(rj,{onSaveTemplate:n,onClose:r})):null};var aj=r(46186);function oj(){return oj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oj.apply(this,arguments)}const ij=e=>{const{...t}=e,[r,n]=y.useState(""),a=y.useCallback((e=>{let{value:t}=e;t.length>50?n(t.substring(0,50)):n(t)}),[]);return y.createElement(aj.F,oj({},t,{onChange:a,value:r}))},sj=(0,I.withStyles)((e=>({error:{padding:4,color:vn.T.red500,fontSize:e.typography.pxToRem(14)},input:{width:"100%"},buttonContainer:{display:"flex",justifyContent:"space-between"}})))((e=>{const{onSaveTemplate:t,onClose:r,classes:a}=e,[o,i]=y.useState(""),[s,l]=y.useState(),d=y.useCallback((e=>{let{value:t}=e;t&&l(void 0),i(t)}),[]),c=y.useCallback((()=>{o?t(o):l("Please specify a view name")}),[o,t]);return y.createElement(y.Fragment,null,y.createElement(Ip.w,null,n.A.t("Save As view")),y.createElement(R.$,null,y.createElement(ij,{onBlur:d,className:a.input,label:n.A.t("View name"),error:!!s,dataTest:"view-name",initialFocus:!0,required:!0,name:"viewName"}),y.createElement("div",{"data-test":"view-name-error-message",className:a.error},s)),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{onClick:r},n.A.t("Cancel")),y.createElement(ra.$,{onClick:c,primary:!0},n.A.t("Save")))))})),lj=e=>{const{open:t,onClose:r,onSaveTemplate:n}=e;return t?y.createElement(N.a,{hide:!t,onClose:r,dataTest:"new-template-dialog",position:"center"},y.createElement(sj,{onSaveTemplate:n,onClose:r})):null},dj=e=>{const{open:t,onClose:r,onDeleteTemplate:a,templateName:o}=e;return t?y.createElement(N.a,{hide:!t,onClose:r},y.createElement(Ip.w,null,n.A.t("Delete view")),y.createElement(R.$,null,n.A.t("Do you really want to delete the '{{templateName}}' view?",{templateName:o})),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{onClick:r},n.A.t("Cancel")),y.createElement(ra.$,{onClick:a,primary:!0},n.A.t("Confirm"))))):null};var cj=r(27149);const uj=(0,I.withStyles)({dialog:{width:1e3,display:"flex"}})((e=>{let{onClose:t,open:r,templateId:n,classes:a,templateSharingType:o,dataTest:i}=e;const{refetch:s}=(0,A.iO)((0,y.useMemo)((()=>({sharing:{resource:"sharing",params:e=>{let{variables:{templateId:t,templateSharingType:r}}=e;return{id:t,type:r}}}})),[]),{lazy:!0,onComplete:e=>{let{sharing:r}=e;const{externalAccess:n,publicAccess:a,userAccesses:o,userGroupAccesses:i}=r.object;t({externalAccess:n,publicAccess:a,userAccesses:o.map((e=>{let{id:t,access:r}=e;return{id:t,access:r}})),userGroupAccesses:i.map((e=>{let{id:t,access:r}=e;return{id:t,access:r}}))})}}),l=(0,y.useCallback)((()=>{s({variables:{templateId:n,templateSharingType:o}})}),[s,n,o]);return r?y.createElement(cj.x,{type:o,id:n,onClose:l,className:a.dialog,dataTest:i}):null})),pj="NEW",mj="REPLACE",gj="DELETE",hj="SHARING";function Ej(){return Ej=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ej.apply(this,arguments)}const yj=(e,t)=>{const{mode:r,currentTemplate:n,onAddTemplate:a,onUpdateTemplate:o,onDeleteTemplate:i,onSetSharingSettings:s,templateSharingType:l,...d}=e,c=(0,y.useCallback)((()=>{o(n)}),[o,n]),u=(0,y.useCallback)((()=>{i(n)}),[i,n]),p=(0,y.useCallback)((e=>{s(e,n.id)}),[s,n.id]);return(0,y.useImperativeHandle)(t,(()=>({handleUpdateTemplate:c}))),y.createElement(y.Fragment,null,y.createElement(nj,Ej({},d,{open:r===mj,onSaveTemplate:c})),y.createElement(lj,Ej({},d,{open:r===pj,onSaveTemplate:a})),y.createElement(dj,Ej({},d,{open:r===gj,onDeleteTemplate:u,templateName:n.name})),y.createElement(uj,{open:r===hj,templateId:n.id,onClose:p,templateSharingType:l,dataTest:"sharing-dialog"}))},vj=(0,y.forwardRef)(yj);function fj(){return fj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fj.apply(this,arguments)}const Ij=(0,I.withStyles)((e=>({delete:{color:e.palette.error.dark}})))((e=>{const{currentTemplate:t,onAddTemplate:r,onUpdateTemplate:a,onDeleteTemplate:o,onSetTemplateSharingSettings:i,currentViewHasTemplateChanges:s,classes:l,customListViewMenuContents:d,templateSharingType:c,...u}=e,[p,m]=(0,y.useState)(null),g=(0,y.useRef)(null),h=(0,y.useCallback)((()=>{m(null)}),[]),E=(0,y.useCallback)((function(){m(null),a&&a(...arguments)}),[a]),v=(0,y.useCallback)((function(){m(null),r&&r(...arguments)}),[r]),f=(0,y.useCallback)((function(){m(null),o&&o(...arguments)}),[o]),I=(0,y.useCallback)((function(){m(null),i&&i(...arguments)}),[i]),b=(0,y.useCallback)((()=>({key:"save",clickHandler:()=>{g.current.handleUpdateTemplate()},element:n.A.t("Update view")})),[]),S=(0,y.useCallback)(((e,t)=>e&&!t?{key:"saveAs",element:n.A.t("Save current view...")}:{key:"saveAs",clickHandler:()=>{m(pj)},element:e?n.A.t("Save current view..."):n.A.t("Save current view as...")}),[]),T=(0,y.useCallback)((()=>({key:"delete",clickHandler:()=>{m(gj)},element:y.createElement("div",{className:l.delete},n.A.t("Delete view"))})),[l.delete]),A=(0,y.useCallback)((()=>({key:"share",clickHandler:()=>{m(hj)},element:n.A.t("Share view...")})),[]),C=(0,y.useCallback)((e=>({key:"savedViewSubHeader",subHeader:e.length>30?`${e.substring(0,27)}...`:e})),[]),O=(0,y.useMemo)((()=>{const e=[],n=[],{access:i,isDefault:l,notPreserved:c,name:u}=t;return r&&e.push(S(!!l,s)),!l&&!c&&i.write&&i.update&&s&&a&&n.push(b()),l||c||!i.manage||n.push(A()),!l&&!c&&i.delete&&o&&n.push(T()),n.length>0&&n.splice(0,0,C(u)),[...d||[],...e,...n]}),[t,b,S,T,A,s,C,d,r,a,o]);return y.createElement(y.Fragment,null,y.createElement(tj,fj({},u,{currentTemplate:t,customListViewMenuContents:O})),y.createElement(vj,{ref:g,onClose:h,mode:p,currentTemplate:t,onAddTemplate:v,onUpdateTemplate:E,onDeleteTemplate:f,onSetSharingSettings:I,templateSharingType:c}))}));function bj(){return bj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},bj.apply(this,arguments)}const Sj=e=>{const{children:t,...r}=e,n=(0,y.useContext)(xL);if(!n)throw Error("missing ListViewConfigContext");const{currentViewHasTemplateChanges:a,...o}=n;return y.createElement(y.Fragment,null,t(!!a),y.createElement(Ij,bj({},r,o,{currentViewHasTemplateChanges:!!a})))},Tj=e=>{const{currentListIsModified:t,text:r,maxCharacters:n,isSelectedTemplate:a}=e,o=r.length>n?`${r.substring(0,n-3)}...`:r;return a&&t?`${o} *`:o},Aj=(0,I.withStyles)({button:{border:"none",backgroundColor:"transparent",borderRadius:"16px",padding:0,margin:0,minWidth:0,minHeight:0,"&:hover":{backgroundColor:"transparent"}}})((e=>{const{enabled:t,children:r,classes:n,onClick:a,...o}=e;return t?y.createElement(Xo.m,o,(e=>{let{ref:t,onMouseOver:o,onMouseOut:i}=e;return y.createElement("button",{ref:t,onClick:a,className:n.button,onPointerEnter:o,onPointerLeave:i,onFocus:o,onBlur:i},r)})):y.createElement("button",{onClick:a,className:n.button},r)}));function Cj(){return Cj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Cj.apply(this,arguments)}const Oj=e=>{const{template:t,currentTemplateId:r,onSelectTemplate:n,disabled:a,maxCharacters:o=30,...i}=e,{name:s,id:l}=t,d=y.useCallback((()=>{a||n(t)}),[a,n,t]);return y.createElement(Aj,{content:s,placement:"top",openDelay:800,enabled:s.length>o,onClick:d},y.createElement(Fp.v,{marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,dataTest:"workinglist-template-selector-chip",selected:l===r,disabled:a},y.createElement(Tj,Cj({},i,{text:s,maxCharacters:o,isSelectedTemplate:l===r,disabled:a}))))},Nj=e=>{const{captureEl:t,extraTriggers:r}=e,[n,a]=y.useState(0),o=y.useCallback((()=>{a(t.current.scrollHeight)}),[t]);return y.useLayoutEffect((()=>(o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o))),[...r,o]),e.children(n)},Rj=e=>{const t=e.palette.dividerLighter;return`${e.typography.pxToRem(1)} solid ${t}`},wj=(0,I.withStyles)((e=>({container:{borderBottom:Rj(e)},configsContainer:{display:"flex",flexWrap:"wrap",padding:`${e.typography.pxToRem(3)} 0rem`,maxHeight:110,overflow:"hidden"},configsContainerExpanded:{display:"flex",flexWrap:"wrap",padding:`${e.typography.pxToRem(3)} 0rem`},chipContainer:{padding:`${e.typography.pxToRem(5)} ${e.typography.pxToRem(8)}`},linkButtonContainer:{marginBottom:5,display:"flex",justifyContent:"center"},linkButton:{fontSize:10,backgroundColor:"transparent","&:focus":{outline:"none",fontWeight:500}}})))((e=>{const{templates:t,currentTemplateId:r,currentListIsModified:a,onSelectTemplate:o,selectionInProgress:i,classes:s}=e,l=y.useRef(null),[d,c]=y.useState(!1),u=y.useMemo((()=>t.filter((e=>!e.isDefault)).sort(((e,t)=>{let r,{order:n,name:a}=e,{order:o,name:i}=t;return r=n&&o?n-o:n?1:o?-1:Zh(a,i),r}))),[t]),p=y.useCallback((()=>y.createElement(Mg,{className:s.linkButton,onClick:()=>{c(!d)}},d?n.A.t("Show Less"):n.A.t("Show All"))),[d,s.linkButton]);if(u.length<=0)return null;const m=u.map((e=>{const{id:t}=e;return y.createElement("div",{"data-test":"workinglist-template-selector-chip-container",className:s.chipContainer,key:t},y.createElement(Oj,{template:e,currentTemplateId:r,onSelectTemplate:o,currentListIsModified:a,disabled:i}))}));return y.createElement("div",{className:s.container},y.createElement(Nj,{captureEl:l,extraTriggers:[t]},(e=>y.createElement(y.Fragment,null,y.createElement("div",{"data-test":"workinglists-template-selector-chips-container",ref:l,className:d?s.configsContainerExpanded:s.configsContainer},m),y.createElement("div",{className:s.linkButtonContainer},e>110?p():null)))))})),_j=e=>{const t=e.palette.dividerLighter;return`${e.typography.pxToRem(1)} solid ${t}`},Pj=e=>({container:{border:_j(e)}});function kj(){return kj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kj.apply(this,arguments)}const Dj=(e=>(0,I.withStyles)(Pj)(class extends y.Component{render(){const{classes:t,...r}=this.props;return y.createElement("div",{className:t.container,"data-test":"workinglists-border"},y.createElement(e,r))}}))((e=>{const{templates:t,selectionInProgress:r,...n}=e,{currentTemplate:a,onSelectTemplate:o}=(0,y.useContext)(FL)||{};if(!t||!a)throw S().error((0,j.px)("Templates and currentTemplate needs to be set during templates loading")({templates:t,currentTemplate:a})),Error("Templates and currentTemplate needs to be set during templates loading. See console for details");const i=(0,y.useCallback)((e=>{if(e.id!==a.id)o(e.id);else{const e=t.find((e=>e.isDefault));o(e.id)}}),[o,a.id,t]);return y.createElement(Sj,kj({},n,{selectionInProgress:r,currentTemplate:a}),(e=>y.createElement(wj,{templates:t,currentTemplateId:a.id,currentListIsModified:e,onSelectTemplate:i,selectionInProgress:r})))}));function Uj(){return Uj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uj.apply(this,arguments)}const Lj=qm()(Dp()(Dj)),Fj=(0,y.memo)((e=>{const{loadTemplatesError:t,onLoadTemplates:r,onCancelLoadTemplates:n,programId:a,loadedProgramIdForTemplates:o,dirtyTemplates:i,templatesLoading:s,...l}=e,d=(e=>{let{programId:t,loadedProgramIdForTemplates:r,dirtyTemplates:n,onLoadTemplates:a,onCancelLoadTemplates:o}=e;const i=(0,y.useRef)(!0),s=(0,y.useRef)(!0);let l=!1;(t!==r||n&&i.current)&&(l=!0),s.current=l;const d=(0,y.useCallback)((()=>{s.current&&o&&o()}),[o]);return(0,y.useEffect)((()=>(i.current=!1,l&&a(t),()=>d())),[l,a,t,d]),(0,y.useEffect)((()=>()=>o&&o()),[o]),l})({programId:a,loadedProgramIdForTemplates:o,dirtyTemplates:i,onLoadTemplates:r,onCancelLoadTemplates:n});return y.createElement(Lj,Uj({},l,{ready:!d&&!s,error:t,programId:a}))}));function xj(){return xj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xj.apply(this,arguments)}const Mj=e=>{const{templates:t,currentTemplate:r,selectedRows:n,selectionInProgress:a,allRowsAreSelected:o,onSelectTemplate:i,onLoadView:s,loadViewError:l,onUpdateList:d,onCancelLoadView:c,onCancelUpdateList:u,columns:p,loading:m,updating:g,updatingWithDialog:h,onAddTemplate:E,onUpdateTemplate:v,onDeleteTemplate:f,onUnloadingContext:I,orgUnitId:b,categories:S,loadedContext:T,dataSource:A,onClickListRow:C,onRowSelect:O,onSelectAll:N,sortById:R,sortByDirection:w,onSortList:_,customRowMenuContents:P,onSetListColumnOrder:k,filters:D,onUpdateFilter:U,onClearFilter:L,onRemoveFilter:F,onSelectRestMenuItem:x,onChangePage:M,onChangeRowsPerPage:V,stickyFilters:j,rowsPerPage:G,currentPage:B,currentViewHasTemplateChanges:$,viewPreloaded:W,customUpdateTrigger:H,forceUpdateOnMount:z,programStageId:Y,bulkActionBarComponent:q,...K}=e,Q=(0,y.useMemo)((()=>!!t&&t.some((e=>e.updating||e.notPreserved||e.deleted))),[t]),X=(0,y.useRef)(Q),J=(0,y.useRef)(m),Z=(0,y.useRef)(g||h),ee=(0,y.useMemo)((()=>T||{}),[T]),te=(0,y.useMemo)((()=>ee.programIdTemplates),[ee.programIdTemplates]),re=(0,y.useMemo)((()=>({programId:ee.programIdView,categories:ee.categories})),[ee.programIdView,ee.categories]),ne=(0,y.useMemo)((()=>t&&t.filter((e=>!e.deleted))),[t]);return(0,y.useEffect)((()=>()=>I&&I()),[I]),y.createElement(GL,{currentTemplate:r,onSelectTemplate:i},y.createElement(BL,{currentViewHasTemplateChanges:$,onAddTemplate:E,onUpdateTemplate:v,onDeleteTemplate:f},y.createElement($L,{sortById:R,sortByDirection:w,filters:D,columns:p,loading:m,onLoadView:s,loadViewError:l,onUpdateList:d,onCancelLoadView:c,orgUnitId:b,categories:S,dirtyView:X.current||J.current,loadedViewContext:re,viewPreloaded:W},y.createElement(WL,{rowsPerPage:G,currentPage:B,onCancelUpdateList:u,customUpdateTrigger:H,forceUpdateOnMount:z,dirtyList:Z.current,loadedOrgUnitId:ee.orgUnitId},y.createElement(HL,{selectedRows:n,allRowsAreSelected:o,selectionInProgress:a,updating:g,updatingWithDialog:h,dataSource:A,onClickListRow:C,onRowSelect:O,onSelectAll:N,onSortList:_,onSetListColumnOrder:k,customRowMenuContents:P,onUpdateFilter:U,onClearFilter:L,onRemoveFilter:F,onSelectRestMenuItem:x,onChangePage:M,onChangeRowsPerPage:V,stickyFilters:j,programStageId:Y,bulkActionBarComponent:q},y.createElement(Fj,xj({},K,{templates:ne,dirtyTemplates:!!X.current,loadedProgramIdForTemplates:te,programStageId:Y,selectionInProgress:a})))))))},Vj=(0,y.memo)((e=>y.createElement(Mj,e))),jj=e=>{let{initialViewConfig:t,defaultColumns:r,filters:n,columns:a,sortById:o,sortByDirection:i,programStageId:s,isDefaultTemplateAltered:l}=e;const d=(0,j.iT)(j.Gv.storeProgramStageWorkingList),c=(0,y.useMemo)((()=>{if(!t)return t;const e=t.customVisibleColumnIds||r.filter((e=>e.visible)).map((e=>e.id));return{...t,customVisibleColumnIds:void 0,visibleColumnIds:e}}),[t,r]),u=(0,y.useMemo)((()=>!!l||(!d&&s||!c?void 0:((e,t)=>{let{filters:r,columns:n,sortById:a,sortByDirection:o}=e,{filters:i,visibleColumnIds:s,sortById:l,sortByDirection:d}=t;if(a!==l||o!==d)return!0;const c=n.filter((e=>e.visible)).map((e=>e.id));return c.length!==s.length||!!c.some(((e,t)=>e!==s[t]))||!qV(i,r)})({filters:n,columns:a,sortById:o,sortByDirection:i},c))),[n,a,o,i,c,s,d,l]);return u},Gj={},Bj={["TODAY"]:()=>{const e=$()(),t=e;return[`ge:${xl(e)}`,`le:${xl(t)}`]},["THIS_WEEK"]:()=>{const e=$()().startOf("week"),t=$()().endOf("week");return[`ge:${xl(e)}`,`le:${xl(t)}`]},["THIS_MONTH"]:()=>{const e=$()().startOf("month"),t=$()().endOf("month");return[`ge:${xl(e)}`,`le:${xl(t)}`]},["THIS_YEAR"]:()=>{const e=$()().startOf("year"),t=$()().endOf("year");return[`ge:${xl(e)}`,`le:${xl(t)}`]},["LAST_WEEK"]:()=>{const e=$()().subtract(1,"weeks").startOf("week"),t=$()().subtract(1,"weeks").endOf("week");return[`ge:${xl(e)}`,`le:${xl(t)}`]},["LAST_MONTH"]:()=>{const e=$()().subtract(1,"months").startOf("month"),t=$()().subtract(1,"months").endOf("month");return[`ge:${xl(e)}`,`le:${xl(t)}`]},["LAST_3_MONTHS"]:()=>{const e=$()().subtract(3,"months").startOf("month"),t=$()().subtract(1,"months").endOf("month");return[`ge:${xl(e)}`,`le:${xl(t)}`]}};function $j(e,t,r,n){let a=[];var o,i;return rM(e.startBuffer,e.endBuffer)?(a=function(e){const{startBuffer:t,endBuffer:r}=e,n=[];if(t||0===t){const e=xl($()().add(t,"days"));n.push(`ge:${e}`)}if(r||0===r){const e=xl($()().add(r,"days"));n.push(`le:${e}`)}return n}(e),null===(o=a)||void 0===o?void 0:o.join(":")):e.period?(a=function(e,t,r){Gj[t]&&!r||(Gj[t]={});const n=Gj[t];return n[e]||(n[e]=(0,fg.Mz)((e=>e),(e=>Bj[e.period]&&Bj[e.period]()))),n[e]}(t,r,n)(e),null===(i=a)||void 0===i?void 0:i.join(":")):""}const Wj=e=>e.toString();const Hj={[it.CO.NUMBER]:Wj,[it.CO.INTEGER]:Wj,[it.CO.INTEGER_POSITIVE]:Wj,[it.CO.INTEGER_ZERO_OR_POSITIVE]:Wj,[it.CO.INTEGER_NEGATIVE]:Wj,[it.CO.DATE]:function(e){const t=$()(e);return t.locale("en"),t.format("YYYY-MM-DD")},[it.CO.TRUE_ONLY]:()=>"true",[it.CO.BOOLEAN]:e=>e?"true":"false",[it.CO.FILE_RESOURCE]:e=>e.value,[it.CO.IMAGE]:e=>e.value,[it.CO.COORDINATE]:e=>`[${e.longitude},${e.latitude}]`,[it.CO.PERCENTAGE]:e=>e.replace("%",""),[it.CO.ORGANISATION_UNIT]:e=>e.id};function zj(e,t){return(0,j.Fs)((e=>e.map((e=>$i(function(e,t){return Hj[t]?Hj[t](e):e}(e,t))))),(e=>e.join(";")),(e=>`in:${e}`))(e.values)}const Yj={true:"true",false:"false"};function qj(e){const t=[];return(e.ge||0===e.ge)&&t.push(`ge:${e.ge}`),(e.le||0===e.le)&&t.push(`le:${e.le}`),t.join(":")}const Kj={[ZL.TEXT]:function(e){return`like:${$i(e.value)}`},[ZL.NUMBER]:qj,[ZL.INTEGER]:qj,[ZL.INTEGER_POSITIVE]:qj,[ZL.INTEGER_NEGATIVE]:qj,[ZL.INTEGER_ZERO_OR_POSITIVE]:qj,[ZL.DATE]:function(e,t,r,n){return"ABSOLUTE"===e.type?function(e){const t=[];if(e.ge){const r=xl($()(e.ge));t.push(`ge:${r}`)}if(e.le){const r=xl($()(e.le));t.push(`le:${r}`)}return null===t||void 0===t?void 0:t.join(":")}(e):$j(e,t,r,n)},[ZL.ASSIGNEE]:function(e){return{assignedUserMode:e.assignedUserMode,assignedUser:e.assignedUser&&e.assignedUser.id}},[ZL.BOOLEAN]:function(e){return(0,j.Fs)((e=>e.map((e=>Yj[e]))),(e=>e.length>1?{valueString:e.join(";"),single:!1}:{valueString:e[0],single:!0}),(e=>{let{valueString:t,single:r}=e;return r?`eq:${t}`:`in:${t}`}))(e.values)},[ZL.TRUE_ONLY]:function(e){return`eq:${e.value}`}};const Qj=(e,t)=>{let{columns:r,filtersOnly:n,storeId:a,isInit:o=!1}=t;return Object.keys(e).filter((t=>e[t])).reduce(((t,i)=>{const{type:s}=r.get(i)||n&&n.get(i)||{};if(s){const r=function(e,t,r){return e&&e.usingOptionSet?zj(e,t):Kj[t]?Kj[t](e,r.key,r.storeId,r.isInit):e}(e[i],s,{key:i,storeId:a,isInit:o});t[i]=r}else S().error((0,j.px)("Could not get type for key")({key:i,storeId:a}));return t}),{})},Xj={teiList:{tei:"trackedEntityInstanceFilter",programStageWorkingList:"programStageWorkingList"},eventList:"eventFilter"},Jj=(0,I.withStyles)((()=>({downloadLink:{textDecoration:"none",outline:"none"},downloadLinkContainer:{paddingRight:5,paddingBottom:5},downloadContainer:{display:"flex",flexWrap:"wrap"}})))((e=>{let{open:t,onClose:r,request:a={},absoluteApiPath:o,classes:i,hasCSVSupport:s}=e;return t?y.createElement(N.a,{hide:!t,onClose:r,position:"center",dataTest:"working-lists-download-dialog"},y.createElement(Ip.w,null,n.A.t("Download with current filters")),y.createElement(R.$,null,(()=>{const e=`${o}/${a.url}`,{pageSize:t,page:r,...l}=a.queryParams||{},d=(e=>{const{filter:t,...r}=e,n=new URLSearchParams(r);return t&&t.forEach((e=>{n.append("filter",e)})),n.toString()})({...l,skipPaging:"true"});return y.createElement("div",{className:i.downloadContainer},y.createElement("div",{className:i.downloadLinkContainer},y.createElement("a",{download:`${a.url}.json`,href:`${e}.json?${d}`,className:i.downloadLink},y.createElement(ra.$,null,n.A.t("Download as JSON")))),s&&y.createElement("div",{className:i.downloadLinkContainer},y.createElement("a",{download:`${a.url}.csv`,href:`${e}.csv?${d}`,className:i.downloadLink},y.createElement(ra.$,null,n.A.t("Download as CSV")))))})()),y.createElement(ta.N,null,y.createElement(ra.$,{onClick:r,color:"primary"},n.A.t("Close")))):null})),Zj=e=>{let{request:t,open:r,onClose:n,hasCSVSupport:a=!0}=e;const{baseUrl:o,apiVersion:i}=(0,A.UK)(),s=(0,j.c$)(o,`api/${i}`);return y.createElement(Jj,{request:t,absoluteApiPath:s,open:r,onClose:n,hasCSVSupport:a})},eG=rc({[qU]:(e,t)=>{const{storeId:r}=t.payload;return{...e,[r]:void 0}},[KU]:(e,t)=>{const r={...e},{storeId:n,config:a,pagingData:o}=t.payload,{filters:i,rowsPerPage:s,currentPage:l,sortById:d,sortByDirection:c,customColumnOrder:u}=a,p={filters:i,rowsPerPage:s,currentPage:l,sortById:d,sortByDirection:c,...o,initial:{filters:i,sortById:d,sortByDirection:c,customVisibleColumnIds:u&&u.map((e=>e.visible?e.id:null)).filter((e=>e))},next:{}};return r[n]=p,r},[JU]:(e,t)=>{let{payload:{storeId:r,resetMode:n}}=t;return n?{...e,[r]:{...e[r],currentPage:1}}:e},[ZU]:(e,t)=>{const r={...e},{storeId:n,pagingData:a}=t.payload,o=r[n].next;return r[n]={...r[n],...o,...a,filters:{...r[n].filters,...r[n].next.filters},next:{}},r},[eL]:(e,t)=>{const r={...e},n=t.payload.storeId;return r[n]={...r[n],next:{}},r},[WU]:(e,t)=>{const{visibleColumnIds:r,filters:n,sortById:a,sortByDirection:o,storeId:i}=t.payload,s={filters:n,sortById:a,sortByDirection:o,customVisibleColumnIds:r};return{...e,[i]:{...e[i],nextInitial:s}}},[HU]:(e,t)=>{const{isActiveTemplate:r,storeId:n}=t.payload;return r?{...e,[n]:{...e[n],initial:e[n].nextInitial,nextInitial:void 0}}:e},[zU]:(e,t)=>{const{isActiveTemplate:r,storeId:n}=t.payload;return r?{...e,[n]:{...e[n],nextInitial:void 0}}:e},[MU]:(e,t)=>{const{visibleColumnIds:r,filters:n,sortById:a,sortByDirection:o,storeId:i}=t.payload,s={filters:n,sortById:a,sortByDirection:o,customVisibleColumnIds:r};return{...e,[i]:{...e[i],nextInitial:s,viewPreloaded:!0}}},[VU]:(e,t)=>{const{isActiveTemplate:r,storeId:n}=t.payload;return r?{...e,[n]:{...e[n],initial:e[n].nextInitial,nextInitial:void 0,viewPreloaded:!1}}:e},[jU]:(e,t)=>{const{isActiveTemplate:r,storeId:n}=t.payload;return r?{...e,[n]:{...e[n],nextInitial:void 0}}:e},[xU]:(e,t)=>{const{storeId:r}=t.payload;return{...e,[r]:{...e[r],viewPreloaded:!1}}},[pL]:(e,t)=>{const r={...e},{pageNumber:n,storeId:a}=t.payload;return r[a]={...r[a],next:{...r[a].next,currentPage:n}},r},[nL]:(e,t)=>{const r={...e},{storeId:n,id:a,direction:o}=t.payload;return r[n]={...r[n],next:{...r[n].next,sortById:a,sortByDirection:o,currentPage:1}},r},[mL]:(e,t)=>{const r={...e},{rowsPerPage:n,storeId:a}=t.payload;return r[a]={...r[a],next:{...r[a].next,rowsPerPage:n,currentPage:1}},r},[iL]:(e,t)=>{const{filter:r,storeId:n,itemId:a}=t.payload;return{...e,[n]:{...e[n],next:{...e[n].next,filters:{...e[n].next&&e[n].next.filters,[a]:r},currentPage:1}}}},[sL]:(e,t)=>{const{itemId:r,storeId:n}=t.payload;return{...e,[n]:{...e[n],next:{...e[n].next,filters:{...e[n].next&&e[n].next.filters,[r]:null},currentPage:1}}}},[lL]:(e,t)=>{const{itemId:r,storeId:n}=t.payload;return{...e,[n]:{...e[n],next:{...e[n].next,filters:{...e[n].next&&e[n].next.filters,[r]:null},currentPage:1}}}},[dL]:(e,t)=>{const{filtersList:r,storeId:n}=t.payload;return e[n]?{...e,[n]:{...e[n],filters:r}}:e},[iD]:(e,t)=>{const r={...e};return r[t.payload.listId]=t.payload.meta,r},[oL]:(e,t)=>{const{storeId:r}=t.payload;return{...e,[r]:{...e[r],sortByDirection:"desc",sortById:"createdAt"}}}},"workingListsMeta"),tG="EventWorkingListsEventListEventDeleteSuccess",rG="EventWorkingListsEventListEventDeleteError",nG="ViewEventPageOpen",aG="EventWorkingListsEventDelete",oG=e=>{const t=[{id:Zk,visible:!0,type:it.CO.DATE,header:e.stageForm.getLabel(Zk)},{id:eD,visible:!0,type:it.CO.TEXT,header:n.A.t("Status"),options:[{text:n.A.t("Active"),value:"ACTIVE"},{text:n.A.t("Completed"),value:"COMPLETED"}],resolveValue:ys}],r=[];return e.enableUserAssignment&&r.push({id:tD,visible:!0,type:"ASSIGNEE",header:n.A.t("Assigned to"),apiName:"assignedUser"}),[...t,...r].map((e=>({...e,isMainProperty:!0})))},iG=e=>e.stageForm.getElements().map((e=>{let{id:t,displayInReports:r,type:n,formName:a,optionSet:o}=e;return{id:t,visible:r,type:n,header:a,options:o&&o.options.map((e=>{let{text:t,value:r}=e;return{text:t,value:r}})),multiValueFilter:!!o}})),sG=e=>(0,y.useMemo)((()=>[...oG(e),...iG(e)]),[e]),lG=(e,t)=>{if(e&&e.length>0)return((e,t)=>{const r=new Map([...t.entries()].map((e=>{let[,t]=e;return[t.apiName,t]}))),n=new Map(e.map((e=>{if(t.has(e))return e;const n=r.get(e);return n?n.id:(S().error((0,j.px)("id specified in column order not valid")({id:e})),null)})).filter((e=>e)).map((e=>[e,{id:e,visible:!0}]))),a=[...t.values()].filter((e=>{let{id:t}=e;return!n.has(t)})).map((e=>{let{id:t}=e;return{id:t,visible:!1}}));return[...n.values(),...a]})(e,t)},dG={[it.CO.NUMBER]:ut,[it.CO.INTEGER]:ut,[it.CO.INTEGER_POSITIVE]:ut,[it.CO.INTEGER_ZERO_OR_POSITIVE]:ut,[it.CO.INTEGER_NEGATIVE]:ut,[it.CO.DATE]:e=>$()(e,"YYYY-MM-DD").toISOString(),[it.CO.BOOLEAN]:e=>"true"===e,[it.CO.TRUE_ONLY]:e=>"true"===e||null},cG=(e,t)=>({usingOptionSet:!0,values:e.in.map((e=>dG[t]?dG[t](e):e))}),uG=Object.freeze({PROVIDED:"PROVIDED",CURRENT:"CURRENT",ANY:"ANY",NONE:"NONE"}),pG=Object.freeze({ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE"}),mG="SINGLE_EVENT",gG=e=>({ge:e.ge?Number(e.ge):void 0,le:e.le?Number(e.le):void 0}),hG=e=>{let{dateFilter:t}=e;return t.type===pG.RELATIVE?t.period?{type:t.type,period:t.period}:rM(t.startBuffer,t.endBuffer)?{type:t.type,startBuffer:t.startBuffer,endBuffer:t.endBuffer}:void 0:t.type===pG.ABSOLUTE?{type:t.type,ge:t.startDate?$()(t.startDate,"YYYY-MM-DD").toISOString():void 0,le:t.endDate?$()(t.endDate,"YYYY-MM-DD").toISOString():void 0}:void 0},EG=async(e,t,r)=>{if(e===uG.PROVIDED){const n=t&&t.length>0&&t[0];if(!n)return;const a=await((e,t)=>t({resource:`userLookup/${e}`}).then((e=>{let{id:t,displayName:r,username:n}=e;return{id:t,name:r,username:n}})).catch((t=>(S().error((0,j.px)("An error occured retrieving assignee user")({error:t,userId:e})),null))))(n,r);if(!a)return;return{assignedUserMode:e,assignedUser:a}}return{assignedUserMode:e}},yG={[ZL.TEXT]:e=>({value:e.like}),[ZL.NUMBER]:gG,[ZL.INTEGER]:gG,[ZL.INTEGER_POSITIVE]:gG,[ZL.INTEGER_NEGATIVE]:gG,[ZL.INTEGER_ZERO_OR_POSITIVE]:gG,[ZL.DATE]:hG,[ZL.BOOLEAN]:e=>({values:e.in.map((e=>"true"===e))}),[ZL.TRUE_ONLY]:()=>({value:!0})},vG=(e,t)=>e?e.map((e=>{const r=t.get(e.dataItem);if(!r||!yG[r.type])return null;if(((e,t)=>{if([ZL.BOOLEAN].includes(e)){const e=["true","false"];return t.in.some((t=>!e.includes[t]))}return t.in})(r.type,e))return{...cG(e,r.type),id:e.dataItem};const n=yG[r.type](e,r);return n&&{id:e.dataItem,...n}})).filter((e=>e)):[],fG=async(e,t,r)=>{if(!e)return[];const{occurredAt:n,status:a,assignedUserMode:o,assignedUsers:i}=e,s=[];if(a&&s.push({...cG({in:[a]},t.get("status").type),id:"status"}),n){const e=hG({dateFilter:n});e&&s.push({...e,id:"occurredAt"})}return o&&s.push({...await EG(o,i,r),id:"assignee"}),s},IG={currentPage:1,rowsPerPage:15};async function bG(e,t,r){const{sortById:n,sortByDirection:a}=(e=>{const t=e&&e.split(":");return!t||t.length<2?{sortById:"occurredAt",sortByDirection:"desc"}:{sortById:t[0],sortByDirection:t[1]}})(e&&e.order),o=[...vG(e&&e.dataFilters,t),...await fG(e,t,r)].reduce(((e,t)=>{const{id:r,...n}=t;return e[r]=n,e}),{});return{filters:o,customColumnOrder:lG(e&&e.displayColumnOrder,t),sortById:n,sortByDirection:a,...IG}}const SG=e=>e.toString(),TG={[it.CO.NUMBER]:SG,[it.CO.INTEGER]:SG,[it.CO.INTEGER_POSITIVE]:SG,[it.CO.INTEGER_ZERO_OR_POSITIVE]:SG,[it.CO.INTEGER_NEGATIVE]:SG,[it.CO.DATE]:e=>{const t=$()(e);return t.locale("en"),t.format("YYYY-MM-DD")},[it.CO.BOOLEAN]:e=>e?"true":"false",[it.CO.TRUE_ONLY]:()=>"true"},AG=(e,t)=>({in:e.values.map((e=>TG[t]?TG[t](e):e.toString()))}),CG=e=>({ge:e.ge?e.ge.toString():void 0,le:e.le?e.le.toString():void 0}),OG=e=>{const t=$()(e);return t.locale("en"),t.format("YYYY-MM-DD")},NG={[ZL.TEXT]:e=>({like:e.value}),[ZL.NUMBER]:CG,[ZL.INTEGER]:CG,[ZL.INTEGER_POSITIVE]:CG,[ZL.INTEGER_NEGATIVE]:CG,[ZL.INTEGER_ZERO_OR_POSITIVE]:CG,[ZL.DATE]:e=>({dateFilter:e.type===Mx.RELATIVE?{type:e.type,period:e.period,startBuffer:e.startBuffer,endBuffer:e.endBuffer}:{type:e.type,startDate:e.ge?OG(e.ge):void 0,endDate:e.le?OG(e.le):void 0}}),[ZL.BOOLEAN]:e=>({in:e.values.map((e=>e?"true":"false"))}),[ZL.TRUE_ONLY]:()=>({eq:"true"}),[ZL.ASSIGNEE]:e=>({assignedUserMode:e.assignedUserMode,assignedUsers:e.assignedUser?[e.assignedUser.id]:void 0})},RG=e=>{let{filters:t,sortById:r,sortByDirection:n,columns:a}=e;const o=((e,t)=>`${e}:${t}`)(r,n),i=(0,j.Fs)((()=>((e,t)=>Object.keys(e).map((r=>{const n=e[r];if(null==n)return null;const a=t.get(r);return a&&NG[a.type]?n.usingOptionSet?{...AG(n,a.type),dataItem:r}:{...NG[a.type](n),dataItem:r}:(S().error((0,j.px)("tried to convert a filter to api value, but there was no filter converter or specification found")({filter:n,element:a})),null)})).filter((e=>null!=e)))(t,a)),(e=>((e,t)=>e.reduce(((e,r)=>{if(t.get(r.dataItem).isMainProperty){const t=(e=>{let t;const{dataItem:r,...n}=e;switch(r){case"status":t={status:n.in[0]};break;case"occurredAt":t={eventDate:n.dateFilter};break;case"assignee":t=n;break;default:t=null}return t})(r);return{...e,...t}}return e.dataFilters.push(r),e}),{dataFilters:[]}))(e,a)))();return{...i,order:o,displayColumnOrder:(e=>e.filter((e=>e.visible)).map((e=>e.apiName||e.id)))([...a.values()])}};var wG=r(94746);function _G(){return _G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_G.apply(this,arguments)}const PG=e=>{let{lastTransaction:t,customUpdateTrigger:r,lastIdDeleted:n,listDataRefreshTimestamp:a,lastTransactionOnListDataRefresh:o,onLoadView:i,onUpdateList:s,...l}=e;const d=$()().diff($()(a||0),"minutes")>5||t!==o,c=(0,y.useCallback)(((e,r,n)=>i(e,{...r,lastTransaction:t},n)),[i,t]),u=(0,y.useCallback)((e=>s(e,t)),[s,t]);return y.createElement(Vj,_G({},l,{customUpdateTrigger:r,forceUpdateOnMount:d,onLoadView:c,onUpdateList:u}))};function kG(){return kG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kG.apply(this,arguments)}const DG=e=>{let{onDeleteEvent:t,...r}=e;const a=(0,y.useMemo)((()=>[{key:"deleteEventItem",clickHandler:e=>{let{id:r}=e;return t(r)},icon:y.createElement(wG.A,{color:vn.T.red400}),label:n.A.t("Delete event")}]),[t]);return y.createElement(PG,kG({},r,{customRowMenuContents:a}))},UG={container:{background:vn.T.teal100,height:"60px",border:`2px solid ${vn.T.teal400}`,width:"100%",padding:"8px",fontSize:"14px",gap:"8px",display:"flex",alignItems:"center"}},LG=(0,I.withStyles)(UG)((e=>{let{selectedRowsCount:t,onClearSelection:r,children:a,classes:o}=e;return y.createElement("div",{className:o.container,"data-test":"bulk-action-bar"},y.createElement("span",null,n.A.t("{{count}} selected",{count:t})),a,y.createElement(ra.$,{small:!0,secondary:!0,onClick:r},n.A.t("Deselect all")))})),FG=e=>{let{onClearSelection:t,selectedRowsCount:r,children:n}=e;return y.createElement(y.Fragment,null,y.createElement(LG,{selectedRowsCount:r,onClearSelection:t},n))},xG=e=>{let{recordIds:t}=e;const[r,n]=(0,y.useState)({}),a=(0,y.useMemo)((()=>t&&t.length>0&&t.every((e=>r[e]))),[t,r]),o=(0,y.useCallback)((e=>{n((t=>{const r={...t};return r[e]?delete r[e]:r[e]=!0,r}))}),[]),i=(0,y.useCallback)((e=>{n(a?{}:e.reduce(((e,t)=>(e[t]=!0,e)),{}))}),[a]),s=(0,y.useCallback)((()=>{n({})}),[]),l=(0,y.useMemo)((()=>Object.keys(r).length>0),[r]),d=(0,y.useCallback)((e=>{n((t=>{const r={...t};return e.forEach((e=>{delete r[e]})),r}))}),[]);return{selectedRows:r,toggleRowSelected:o,allRowsAreSelected:a,selectAllRows:i,selectionInProgress:l,clearSelection:s,removeRowsFromSelection:d}},MG=e=>{let{selectedRows:t,disabled:r,onUpdateList:a}=e;const[o,i]=(0,y.useState)(!1),s=(0,A.ow)(),{show:l}=(0,A.MW)((e=>{let{message:t}=e;return t}),{critical:!0}),{mutate:d,isLoading:c}=(0,Zo.useMutation)((()=>s.mutate({resource:"tracker?async=false&importStrategy=DELETE",type:"create",data:{events:Object.keys(t).map((e=>({event:e})))}})),{onError:e=>{S().error((0,j.px)("An error occurred while deleting the events")({error:e})),l({message:n.A.t("An error occurred while deleting the events")})},onSuccess:()=>{a(),i(!1)}});return y.createElement(y.Fragment,null,y.createElement(aI,{enabled:r,content:n.A.t("You do not have access to delete events")},y.createElement(ra.$,{small:!0,onClick:()=>i(!0),disabled:r},n.A.t("Delete"))),o&&y.createElement(N.a,{small:!0,onClose:()=>i(!1),dataTest:"bulk-delete-events-dialog"},y.createElement(Ip.w,null,n.A.t("Delete events")),y.createElement(R.$,null,n.A.t("This cannot be undone. Are you sure you want to delete the selected events?")),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{secondary:!0,onClick:()=>i(!1)},n.A.t("Cancel")),y.createElement(ra.$,{destructive:!0,onClick:d,loading:c},n.A.t("Delete"))))))},VG={container:{fontSize:"14px",lineHeight:"19px",color:vn.T.grey900,display:"flex",flexDirection:"column",gap:"8px"},errorContainer:{padding:"0px 20px"}},jG=(0,I.withStyles)(VG)((e=>{var t;let{selectedRows:r,disabled:a,removeRowsFromSelection:o,onUpdateList:i,classes:s}=e;const[l,d]=(0,y.useState)(!1),[c,u]=(0,y.useState)(!1),{eventCounts:p,isLoading:m,isCompletingEvents:g,onCompleteEvents:h,validationError:E}=(e=>{let{selectedRows:t,isCompleteDialogOpen:r,setIsCompleteDialogOpen:a,removeRowsFromSelection:o,onUpdateList:i}=e;const{serverVersion:{minor:s}}=(0,A.UK)(),l=(0,A.ow)(),{show:d}=(0,A.MW)((e=>{let{message:t}=e;return t}),{critical:!0}),{data:c,isLoading:u}=ai(["WorkingLists","BulkActionBar","CompleteAction","Events",t],{resource:"tracker/events",params:()=>{const e=(0,j.L8)(s,j.Gv.newEntityFilterQueryParam);return{fields:"*,!completedAt,!completedBy,!dataValues,!relationships",[e?"events":"event"]:Object.keys(t).join(e?",":";")}}},{enabled:Object.keys(t).length>0&&r,staleTime:0,cacheTime:0,select:e=>L(U.events,e).reduce(((e,t)=>("ACTIVE"===t.status?e.activeEvents.push(t):e.completedEvents.push(t),e)),{activeEvents:[],completedEvents:[]})}),{mutate:p,isLoading:m,data:g,error:h,reset:E}=(0,Zo.useMutation)((e=>{let{payload:t}=e;return l.mutate({resource:"tracker?async=false&importStrategy=UPDATE&atomicMode=OBJECT",type:"create",data:{events:t}})}),{onError:()=>{d({message:n.A.t("An error occurred while completing events")})},onSuccess:(e,t)=>{var r;let{payload:n}=t;const s=null===e||void 0===e||null===(r=e.validationReport)||void 0===r?void 0:r.errorReports;if(s&&s.length){const e=n.map((e=>e.event)).filter((e=>!s.find((t=>t.uid===e))));o(e),i(!0)}else i(),a(!1)}}),v=(0,y.useCallback)((()=>{if(!c)return;const e=c.activeEvents.map((e=>({...e,status:"COMPLETED"})));p({payload:e})}),[p,c]),f=(0,y.useMemo)((()=>c?{active:c.activeEvents.length,completed:c.completedEvents.length}:null),[c]);return(0,y.useEffect)((()=>{r||E()}),[r,E]),{eventCounts:f,error:h,validationError:g,onCompleteEvents:v,isCompletingEvents:m,isLoading:u}})({selectedRows:r,isCompleteDialogOpen:l,setIsCompleteDialogOpen:d,removeRowsFromSelection:o,onUpdateList:i});return y.createElement(y.Fragment,null,y.createElement(aI,{enabled:a,content:n.A.t("You do not have access to complete events")},y.createElement(ra.$,{small:!0,onClick:()=>d(!0),disabled:a},n.A.t("Complete"))),l&&p&&!E&&y.createElement(N.a,{small:!0,onClose:()=>d(!1),dataTest:"bulk-complete-events-dialog"},y.createElement(Ip.w,null,n.A.t("Complete events")),y.createElement(R.$,null,y.createElement("span",{className:s.container},p.active>0?n.A.t("Are you sure you want to complete all active events in selection?"):n.A.t("There are no active events to complete in the current selection."))),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{secondary:!0,onClick:()=>d(!1)},n.A.t("Cancel")),y.createElement(ra.$,{primary:!0,onClick:h,disabled:m||0===(null===p||void 0===p?void 0:p.active)||!p,loading:g},n.A.t("Complete"))))),l&&E&&y.createElement(N.a,{small:!0,onClose:()=>d(!1),dataTest:"bulk-complete-events-dialog"},y.createElement(Ip.w,null,n.A.t("Error completing events")),y.createElement(R.$,null,y.createElement("span",{className:s.container},n.A.t("There was an error completing the events."),y.createElement(Ib,{open:c,onOpen:()=>u(!0),onClose:()=>u(!1),borderless:!0,header:n.A.t("Details (Advanced)")},y.createElement("span",{className:s.errorContainer},y.createElement("ul",null,null!==E&&void 0!==E&&null!==(t=E.validationReport)&&void 0!==t&&t.errorReports?E.validationReport.errorReports.map((e=>y.createElement("li",{key:`${e.uid}-${e.errorCode}`},null===e||void 0===e?void 0:e.message))):y.createElement("li",null,n.A.t("An unknown error occurred."))))))),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{secondary:!0,onClick:()=>d(!1)},n.A.t("Close"))))))})),GG=e=>{let{selectedRows:t,stage:r,onClearSelection:n,removeRowsFromSelection:a,onUpdateList:o}=e;const i=Object.keys(t).length;return i?y.createElement(FG,{selectedRowsCount:i,onClearSelection:n},y.createElement(jG,{selectedRows:t,disabled:!r.access.data.write,onUpdateList:o,removeRowsFromSelection:a}),y.createElement(MG,{selectedRows:t,disabled:!r.access.data.write,onUpdateList:o})):null};function BG(){return BG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},BG.apply(this,arguments)}const $G=e=>{let{downloadRequest:t,program:r,dataSource:a,...o}=e;const[i,s]=(0,y.useState)(!1),[l,d]=(0,y.useState)(),{selectedRows:c,clearSelection:u,selectAllRows:p,selectionInProgress:m,toggleRowSelected:g,allRowsAreSelected:h,removeRowsFromSelection:E}=xG({recordIds:null===a||void 0===a?void 0:a.map((e=>e.id))}),v=(0,y.useMemo)((()=>[{key:"downloadData",clickHandler:()=>s(!0),element:n.A.t("Download data...")}]),[s]),f=(0,y.useCallback)((()=>{s(!1)}),[s]),I=(0,y.useCallback)((e=>{const t=(0,yc.A)();d(t),!e&&u()}),[u]),b=y.createElement(GG,{selectedRows:c,stage:r.stage,onClearSelection:u,onUpdateList:I,removeRowsFromSelection:E});return y.createElement(y.Fragment,null,y.createElement(DG,BG({},o,{customUpdateTrigger:l,dataSource:a,programId:r.id,customListViewMenuContents:v,selectedRows:c,onSelectAll:p,selectionInProgress:m,onRowSelect:g,allRowsAreSelected:h,bulkActionBarComponent:b})),y.createElement(Zj,{open:i,onClose:f,request:t}))};function WG(){return WG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},WG.apply(this,arguments)}const HG=e=>(0,y.useMemo)((()=>(e||[]).map((e=>({...e,updating:!!e.nextCriteria})))),[e]),zG=e=>{let{filters:t,columns:r,sortById:n,sortByDirection:a,program:o,onAddTemplate:i,onUpdateTemplate:s,onDeleteTemplate:l,templates:d,...c}=e;const u=y.useCallback((e=>{const i=RG({filters:t,columns:new Map(r.map((e=>[e.id,e]))),sortById:n,sortByDirection:a});s(e,i,{filters:t,visibleColumnIds:r&&r.filter((e=>{let{visible:t}=e;return t})).map((e=>{let{id:t}=e;return t})),sortById:n,sortByDirection:a,programId:o.id})}),[s,t,r,n,a,o.id]),p=y.useCallback((e=>{const s=RG({filters:t,columns:new Map(r.map((e=>[e.id,e]))),sortById:n,sortByDirection:a});i(e,s,{filters:t,visibleColumnIds:r&&r.filter((e=>{let{visible:t}=e;return t})).map((e=>{let{id:t}=e;return t})),sortById:n,sortByDirection:a,clientId:(0,yc.A)(),programId:o.id})}),[i,t,r,n,a,o.id]),m=y.useCallback((e=>l(e,o.id)),[l,o.id]);return y.createElement($G,WG({},c,{filters:t,columns:r,sortById:n,sortByDirection:a,program:o,onAddTemplate:p,onUpdateTemplate:u,onDeleteTemplate:m,templates:HG(d)}))};function YG(){return YG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YG.apply(this,arguments)}const qG=e=>{let{records:t,columns:r,recordsOrder:n,...a}=e;return y.createElement(zG,YG({},a,{dataSource:LL(t,n,r),columns:r,rowIdKey:"id"}))};function KG(){return KG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KG.apply(this,arguments)}const QG=e=>{let{filters:t,columns:r,sortById:n,sortByDirection:a,defaultColumns:o,initialViewConfig:i,...s}=e;const l=jj({initialViewConfig:i,defaultColumns:o,filters:t,columns:r,sortById:n,sortByDirection:a});return y.createElement(qG,KG({},s,{filters:t,columns:r,sortById:n,sortByDirection:a,currentViewHasTemplateChanges:l}))};function XG(){return XG=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},XG.apply(this,arguments)}const JG=e=>{let{program:t,programStage:r,customColumnOrder:n,onLoadView:a,onUpdateList:o,...i}=e;const s=sG(r),l=((e,t)=>(0,y.useCallback)(((r,n,a)=>{const o=new Map(e.map((e=>{let{id:t,type:r,apiName:n,isMainProperty:a}=e;return[t,{id:t,type:r,apiName:n,isMainProperty:a}]})));t(r,n,{...a,columnsMetaForDataFetching:o})}),[t,e]))(s,a),d=((e,t)=>(0,y.useCallback)(((r,n)=>{const a=new Map(e.map((e=>{let{id:t,type:r,apiName:n,isMainProperty:a}=e;return[t,{id:t,type:r,apiName:n,isMainProperty:a}]})));t(r,{columnsMetaForDataFetching:a,lastTransaction:n})}),[t,e]))(s,o),c=UL(n,s);return y.createElement(QG,XG({},i,{program:t,programStageId:r.id,columns:c,defaultColumns:s,onLoadView:l,onUpdateList:d}))},ZG="Could not get subvalue",eB={[it.CO.FILE_RESOURCE]:e=>{let{value:t,eventId:r,metaElementId:n,absoluteApiPath:a,querySingleResource:o}=e;return o({resource:`fileResources/${t}`}).then((e=>({name:e.name,value:e.id,url:(0,j.UR)(j.Gv.trackerFileEndpoint)?`${a}/tracker/events/${r}/dataValues/${n}/file`:`${a}/events/files?dataElementUid=${n}&eventUid=${r}`}))).catch((e=>(S().warn((0,j.px)(ZG)({value:t,eventId:r,metaElementId:n,error:e})),null)))},[it.CO.IMAGE]:e=>{let{value:t,eventId:r,metaElementId:n,absoluteApiPath:a}=e;return(0,j.UR)(j.Gv.trackerImageEndpoint)?{value:t,url:`${a}/tracker/events/${r}/dataValues/${n}/image`,previewUrl:`${a}/tracker/events/${r}/dataValues/${n}/image?dimension=small`}:{value:t,url:`${a}/events/files?dataElementUid=${n}&eventUid=${r}`,previewUrl:`${a}/events/files?dataElementUid=${n}&eventUid=${r}&dimension=SMALL`}},[it.CO.ORGANISATION_UNIT]:e=>{let{value:t,eventId:r,metaElementId:n,querySingleResource:a}=e;const o=t.split("/");return a({resource:"organisationUnits",id:o[o.length-1],params:{fields:"id,code,displayName,path"}}).then((e=>({id:e.id,code:e.code,name:e.displayName,path:e.path}))).catch((e=>(S().warn((0,j.px)(ZG)({value:t,eventId:r,metaElementId:n,error:e})),null)))}};const tB={PROGRAM_NOT_FOUND:"Program not found",STAGE_NOT_FOUND:"Stage not found"};const rB={event:"eventId",program:"programId",programStage:"programStageId",orgUnit:"orgUnitId",trackedEntity:"trackedEntityId",enrollment:"enrollmentId"};function nB(e){const t=["dataValues","assignedUser"];return Object.keys(e).reduce(((r,n)=>{if("assignedUser"===n){const t=function(e){if(!e.assignedUser)return;const{uid:t,firstName:r,surname:n,username:a}=e.assignedUser;return r&&n?{id:t,username:a,name:`${r} ${n}`}:void 0}(e);t&&(r.assignee=t)}else if(!t.includes(n)){const t=function(e,t){let r;return r="occurredAt"===t||"scheduledAt"===t||"completedAt"===t?Et(e,it.CO.DATE):e,r}(e[n],n);r[rB[n]||n]=t}return r}),{})}async function aB(e,t,r){const n=td.J.get(e.program);if(!n)return S().error((0,j.px)(tB.PROGRAM_NOT_FOUND)({fn:"convertToClientEvent",event:e})),null;const a=n.getStage(e.programStage);if(!a)return S().error((0,j.px)(tB.STAGE_NOT_FOUND)({fn:"convertToClientEvent",event:e})),null;const o=a.stageForm,i=(s=e.dataValues)?s.reduce(((e,t)=>(e[t.dataElement]=t.value,e)),{}):s;var s;const l=o.convertValues(i,Et);await async function(e){let{eventId:t,programStage:r,values:n,absoluteApiPath:a,querySingleResource:o}=e;if(!n)return null;const i=r.getElementsById();return Object.keys(n).reduce((async(e,r)=>{const s=await e,l=n[r],d=i[r];if((0,Q.A)(l)&&null!==l&&d){const e=eB[d.type];if(e){const n=await e({value:l,eventId:t,metaElementId:r,absoluteApiPath:a,querySingleResource:o});s[r]=n}}return s}),Promise.resolve(n))}({eventId:e.event,programStage:o,values:l,absoluteApiPath:t,querySingleResource:r});const d=nB(e);return{id:d.eventId,event:d,values:l||{}}}async function oB(e,t,r){const n=await r({resource:`tracker/events/${e}`});return await aB(n,t,r)}const iB={programId:"program",programStageId:"programStage",orgUnitId:"orgUnit",rowsPerPage:"pageSize",currentPage:"page"},sB=e=>[...e.values()].reduce(((e,t)=>(t.isMainProperty&&(e[t.id]=t),e)),{}),lB=(e,t)=>{const r=e?Object.keys(e).filter((r=>null!=e[r]&&!t[r])).reduce(((t,r)=>{const n=e[r];if(Array.isArray(n)){const e=n.map((e=>`${r}:${e}`));t=[...t,...e]}else t.push(`${r}:${n}`);return t}),[]):null;return r&&r.length>0?{filter:r}:null},dB=(e,t)=>{const r=e?Object.keys(e).filter((r=>t[r]&&null!=e[r])).reduce(((t,r)=>{const n=e[r];let a={};return"occurredAt"===r?a=(e=>{const t={},r=e.split(":"),n=r.indexOf("ge"),a=r.indexOf("le");return-1!==n&&r[n+1]&&(t.occurredAfter=r[n+1]),-1!==a&&r[a+1]&&(t.occurredBefore=r[a+1]),t})(n):"status"===r?a=(e=>({status:e.replace("in:","")}))(n):"assignee"===r&&(a=n),{...t,...a}}),{}):null;return r},cB=(e,t)=>e&&t?{attributeCc:t,attributeCos:Object.keys(e).map((t=>e[t])).join(";")}:null,uB=(e,t,r)=>{const n=((e,t)=>{if(t[e]){const r=t[e];if(r.apiName)return r.apiName}return e})(e,r);return`${n}:${t}`},pB=(e,t,r)=>{let n={...e,order:uB(e.sortById,e.sortByDirection,t),...lB(e.filters,t),...dB(e.filters,t),...cB(e.categories,r)};n.order.includes("default")&&delete n.order,n.hasOwnProperty("categories")&&delete n.categories,n.hasOwnProperty("sortById")&&delete n.sortById,n.hasOwnProperty("sortByDirection")&&delete n.sortByDirection,n.hasOwnProperty("filters")&&delete n.filters,n=Object.keys(n).reduce(((e,t)=>{const r=n[t];return void 0!==r&&(e[t]=r),e}),{});const a=Object.keys(n).reduce(((e,t)=>(iB[t]?e[iB[t]]=n[t]:e[t]=n[t],e)),{});return a},mB=async e=>{let{queryArgs:t,columnsMetaForDataFetching:r,categoryCombinationId:n,absoluteApiPath:a,querySingleResource:o}=e;const i=sB(r),{eventContainers:s,pagingData:l,request:d}=await async function(e,t,r){const n={url:"tracker/events",queryParams:e},a=await r({resource:"tracker/events",params:e}),o=L(U.events,a);return{eventContainers:await o.reduce((async(e,n)=>{const a=await e,o=await aB(n,t,r);return o&&a.push(o),a}),Promise.resolve([])),pagingData:{rowsPerPage:e.pageSize,currentPage:e.page},request:n}}(pB(t,i,n),a,o),c=[...r.keys()];return{eventContainers:s.map((e=>{let{id:t,event:r,values:n}=e;return{id:t,record:{...r,...n}}})).map((e=>{let{id:t,record:r}=e;return{id:t,record:c.reduce(((e,t)=>(e[t]=r[t],e)),{})}})),pagingData:l,request:d}},gB=e=>{let{clientConfig:{currentPage:t,rowsPerPage:r,sortById:n,sortByDirection:a,filters:o},context:{programId:i,categories:s,programStageId:l,orgUnitId:d,storeId:c,program:u},meta:{columnsMetaForDataFetching:p}}=e;const m=u.categoryCombination&&u.categoryCombination.id,g={currentPage:t,rowsPerPage:r,sortById:n,sortByDirection:a,filters:Qj(o,{columns:p,storeId:c,isInit:!0}),fields:"dataValues,occurredAt,event,status,orgUnit,program,programType,updatedAt,createdAt,assignedUser,",programId:i,orgUnitId:d,categories:s,programStageId:l,ouMode:d?"SELECTED":"ACCESSIBLE"},h=sB(p);return{url:"tracker/events",queryParams:pB(g,h,m)}};function hB(){return hB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hB.apply(this,arguments)}const EB=e=>{let{storeId:t,program:r,programStage:n,orgUnitId:a}=e;const o=(0,gs.wA)(),i=(0,A.ow)(),{currentTemplateId:s,templates:d,onLoadView:c,onUpdateList:u,onResetListColumnOrder:p,onClearFilters:m,onUpdateDefaultTemplate:g,...h}=kL(t,mG,r),E=s&&d&&d.find((e=>e.id===s)),v=(0,gs.d4)((e=>{let{workingListsUI:r}=e;return r[t]&&r[t].lastEventIdDeleted})),f=(0,gs.d4)((e=>{let{workingLists:r}=e;return r[t]&&r[t].currentRequest})),I=(0,y.useCallback)((e=>{let{id:t}=e;var r;window.scrollTo(0,0),o((r=t,l(nG)({eventId:r})))}),[o]),b=(0,y.useCallback)((e=>{o(((e,t)=>l(aG)({eventId:e,storeId:t}))(e,t))}),[o,t]),S=(0,y.useCallback)((async(e,n,o)=>{const s=(null===e||void 0===e?void 0:e.nextCriteria)||(null===e||void 0===e?void 0:e.criteria),l=D(i.query.bind(i)),d=await bG(s,null===o||void 0===o?void 0:o.columnsMetaForDataFetching,l),u=gB({clientConfig:d,context:{programId:n.programId,categories:n.categories,programStageId:n.programStageId,orgUnitId:a,storeId:t,program:r},meta:{columnsMetaForDataFetching:o.columnsMetaForDataFetching}});return c(e,{...n,currentRequest:u},o)}),[c,a,t,r,i]),T=(0,y.useCallback)(((e,n)=>{const{lastTransaction:o,columnsMetaForDataFetching:i}=n,s=gB({clientConfig:e,context:{programId:e.programId,categories:e.categories,programStageId:e.programStageId,orgUnitId:a,storeId:t,program:r},meta:{columnsMetaForDataFetching:i}});return u(e,{...n,currentRequest:s},o)}),[u,a,t,r]);return y.createElement(JG,hB({},h,{templateSharingType:Xj[t],program:r,programStage:n,orgUnitId:a,currentTemplate:E,templates:d,lastIdDeleted:v,onClickListRow:I,onLoadView:S,onUpdateList:T,onDeleteEvent:b,downloadRequest:f}))},yB=e=>({error:e,program:void 0,programStage:void 0}),vB=(e,t)=>({program:e,programStage:t,error:void 0}),fB=(e,t)=>(0,y.useMemo)((()=>{let r;return[()=>{if(!t&&!e)return yB("At least one argument must be supplied")},()=>{if(!t)return;const r=td.J.get(t);if(!r)return yB("Program not found");const n=e?r.stages.get(e):[...r.stages.values()][0];return n?vB(r,n):yB("Program stage not found")},()=>{let t;return[...td.J.values()].some((r=>{const n=r.stages.get(e);return n&&(t=vB(r,n)),Boolean(t)})),t||yB("Program stage not found")}].some((e=>(r=e(),Boolean(r)))),r}),[t,e]),IB=e=>{let{storeId:t,programId:r,programStageId:a,orgUnitId:o}=e;const{program:i,programStage:s,error:l}=fB(a,r);return(0,y.useEffect)((()=>{l&&S().error((0,j.px)(l)({programId:r,programStageId:a}))}),[l,r,a]),l?n.A.t("Working list could not be loaded"):y.createElement("div",{"data-test":"event-working-lists"},y.createElement(EB,{storeId:t,program:i,programStage:s,orgUnitId:o}))},bB="Working list could not be loaded",SB="Working list could not be updated",TB=rc({[KU]:(e,t)=>{let{payload:{storeId:r,recordContainers:n}}=t;return{...e,[r]:n.reduce(((e,t)=>{let{record:r,id:n}=t;return e[n]=r,e}),{})}},[JU]:(e,t)=>{let{payload:{storeId:r,resetMode:n}}=t;return n?{...e,[r]:{}}:e},[ZU]:(e,t)=>{let{payload:{storeId:r,recordContainers:n}}=t;return{...e,[r]:n.reduce(((e,t)=>{let{record:r,id:n}=t;return e[n]=r,e}),{})}}},"workingListsListRecords"),AB=rc({[DU]:(e,t)=>{const{storeId:r}=t.payload;return{...e,[r]:{...e[r],loading:!0}}},[UU]:(e,t)=>{const{templates:r,storeId:n,defaultTemplateId:a}=t.payload;return{...e,[n]:{...e[n],templates:r,selectedTemplateId:a,loading:!1}}},[LU]:(e,t)=>{const{storeId:r,error:n}=t.payload;return{...e,[r]:{...e[r],loadError:n,loading:!1}}},[xU]:(e,t)=>{const{storeId:r,templateId:n}=t.payload;return{...e,[r]:{...e[r],selectedTemplateId:n,currentListId:r}}},[WU]:(e,t)=>{const{criteria:r,template:n,storeId:a}=t.payload,o=e[a].templates.filter((e=>e.id!==n.id)),i={...n,nextCriteria:r};return{...e,[a]:{...e[a],templates:[...o,i]}}},[YU]:(e,t)=>{var r;let{payload:{defaultTemplate:n,storeId:a}}=t;const o=null===(r=e[a].templates)||void 0===r?void 0:r.filter((e=>!e.isDefault));if(!o)return e;const i=[...o,n];return{...e,[a]:{...e[a],templates:i}}},[HU]:(e,t)=>{const{criteria:r,templateId:n,storeId:a}=t.payload,o=e[a].templates,i=o.find((e=>e.id===n));if(i){const t=o.filter((e=>e.id!==n)),s={...i,criteria:r,nextCriteria:void 0};return{...e,[a]:{...e[a],templates:[...t,s]}}}return e},[zU]:(e,t)=>{const{templateId:r,storeId:n}=t.payload,a=e[n].templates,o=a.find((e=>e.id===r));if(o){const t=a.filter((e=>e.id!==r)),i={...o,nextCriteria:void 0};return{...e,[n]:{...e[n],templates:[...t,i]}}}return e},[MU]:(e,t)=>{let{payload:{name:r,criteria:n,clientId:a,storeId:o}}=t;const i={id:a,name:r,criteria:n,notPreserved:!0,access:{update:!0,delete:!0,write:!0,manage:!0}},s=e[o].templates;return{...e,[o]:{...e[o],selectedTemplateId:a,templates:[...s,i]}}},[VU]:(e,t)=>{const{templateId:r,clientId:n,storeId:a}=t.payload,o=e[a].templates,i=o.find((e=>e.id===n)),s=o.filter((e=>e.id!==n)),l=e[a].selectedTemplateId;let d=l;l===n&&(d=r);const c={...i,id:r,notPreserved:void 0};return{...e,[a]:{...e[a],selectedTemplateId:d,templates:[...s,c]}}},[jU]:(e,t)=>{const{clientId:r,storeId:n}=t.payload,a=e[n].templates.filter((e=>e.id!==r)),o=e[n].selectedTemplateId,i=o===r?a.find((e=>e.isDefault)).id:o;return{...e,[n]:{...e[n],selectedTemplateId:i,templates:a}}},[GU]:(e,t)=>{const{template:r,storeId:n}=t.payload,a=e[n].templates.filter((e=>e.id!==r.id)),o={...r,deleted:!0};return{...e,[n]:{...e[n],selectedTemplateId:a.find((e=>e.isDefault)).id,templates:[...a,o]}}},[BU]:(e,t)=>{const{template:r,storeId:n}=t.payload,a=e[n].templates.filter((e=>e.id!==r.id));return{...e,[n]:{...e[n],templates:[...a]}}},[$U]:(e,t)=>{const{template:r,storeId:n}=t.payload,a=e[n].templates.filter((e=>e.id!==r.id)),o={...r,deleted:void 0};return{...e,[n]:{...e[n],templates:[...a,o]}}},[gL]:(e,t)=>{let{payload:{sharingSettings:r,templateId:n,storeId:a}}=t;const o=e[a].templates,i=o.findIndex((e=>e.id===n)),s={...o[i],...r},l=[...o];return l[i]=s,{...e,[a]:{...e[a],templates:l}}}},"workingListsTemplates"),CB=rc({[qU]:(e,t)=>{const{storeId:r,context:{currentRequest:n}}=t.payload;return{...e,[r]:{currentRequest:n}}},[KU]:(e,t)=>{const r={...e},{storeId:n,recordContainers:a,request:o}=t.payload;return r[n]={order:a.map((e=>{let{id:t}=e;return t})),currentRequest:o},r},[JU]:(e,t)=>{let{payload:{storeId:r,resetMode:n,currentRequest:a}}=t;return n?{...e,[r]:{order:[],currentRequest:{}}}:{...e,[r]:{...e[r],currentRequest:a}}},[ZU]:(e,t)=>{const r={...e},{storeId:n,recordContainers:a,request:o}=t.payload;return r[n]={order:a.map((e=>{let{id:t}=e;return t})),currentRequest:o},r},[aD]:(e,t)=>{const r={...e},{listId:n,itemId:a}=t.payload;return r[n]={order:[a,...e[n]?e[n].order:[]]},r},[oD]:(e,t)=>{const r={...e},{listId:n,itemId:a}=t.payload;return r[n]={order:e[n]?e[n].order.filter((e=>e!==a)):[]},r},[iD]:(e,t)=>{const r={...e};return r[t.payload.listId]={order:[]},r}},"workingLists"),OB=(e,t)=>({...e,...t,isLoading:!1,isUpdating:!1,isUpdatingWithDialog:!1}),NB=rc({[qU]:(e,t)=>{const r={...e},n=t.payload.storeId;return r[n]={...r[n],isLoading:!0},r},[KU]:(e,t)=>{const r={...e},n=t.payload.storeId;return r[n]=OB(r[n],{hasBeenLoaded:!0,dataLoadingError:null}),r},[QU]:(e,t)=>{const r={...e},n=t.payload;return r[n.storeId]=OB({},{dataLoadingError:n.errorMessage}),r},[JU]:(e,t)=>{const r={...e},n=t.payload.storeId;return r[n]={...r[n],isUpdating:!0},r},[ZU]:(e,t)=>{const r={...e},n=t.payload.storeId;return r[n]=OB(r[n],{dataLoadingError:null}),r},[eL]:(e,t)=>{const r={...e};return r[t.payload.storeId]=OB({},{dataLoadingError:null}),r},[aG]:(e,t)=>{const r=t.payload.storeId;return{...e,[r]:{...e[r],isUpdatingWithDialog:!0}}},[tG]:(e,t)=>{const{storeId:r,eventId:n}=t.payload;return{...e,[r]:{...e[r],lastEventIdDeleted:n,isUpdatingWithDialog:!1}}},[rG]:(e,t)=>{const{storeId:r}=t.payload;return{...e,[r]:{...e[r],isUpdatingWithDialog:!1}}}},"workingListsUI"),RB=rc({[qU]:(e,t)=>{const{storeId:r}=t.payload;return{...e,[r]:void 0}},[KU]:(e,t)=>{const{storeId:r,config:{customColumnOrder:n}}=t.payload;return{...e,[r]:n}},[aL]:(e,t)=>{const{columns:r,storeId:n}=t.payload;return{...e,[n]:r.map((e=>{let{id:t,visible:r}=e;return{id:t,visible:r}}))}},[oL]:(e,t)=>{const{storeId:r}=t.payload;return{...e,[r]:void 0}},[iD]:(e,t)=>{const r={...e};return r[t.payload.listId]=[...t.payload.columnOrder],r}},"workingListsColumnsOrder"),wB=rc({[DU]:(e,t)=>{const{programId:r,storeId:n}=t.payload;return{...e,[n]:{...e[n],programIdTemplates:r}}},[xU]:(e,t)=>{const{storeId:r,programStageId:n}=t.payload;return{...e,[r]:{...e[r],programStageId:n}}},[UU]:(e,t)=>{var r;const{templates:n,storeId:a,defaultTemplateId:o}=t.payload,i=n.find((e=>e.id===o));return{...e,[a]:{...e[a],programStageId:null===i||void 0===i||null===(r=i.criteria)||void 0===r?void 0:r.programStage}}},[qU]:(e,t)=>{const{storeId:r,context:{programId:n,lastTransaction:a,...o}}=t.payload;return{...e,[r]:{...e[r],...o,programIdView:n,listDataRefreshTimestamp:$()().toISOString(),lastTransactionOnListDataRefresh:a}}},[KU]:(e,t)=>{const{storeId:r,context:n}=t.payload;return{...e,[r]:{...e[r],programStageId:null===n||void 0===n?void 0:n.programStageId}}},[JU]:(e,t)=>{let{payload:r}=t;const{storeId:n,lastTransaction:a}=r,{orgUnitId:o}=r.queryArgs;return{...e,[n]:{...e[n],listDataRefreshTimestamp:$()().toISOString(),lastTransactionOnListDataRefresh:a,orgUnitId:o}}},[iD]:(e,t)=>{const r={...e};return r[t.payload.listId]=t.payload.selections,r},[iL]:(e,t)=>{const{itemId:r,filter:n,storeId:a}=t.payload;return"programStage"===r?{...e,[a]:{...e[a],programStageId:n.values[0]}}:e},[lL]:(e,t)=>{const{itemId:r,storeId:n}=t.payload;return"programStage"===r?{...e,[n]:{...e[n],programStageId:void 0}}:e},[sL]:(e,t)=>{const{itemId:r,storeId:n}=t.payload;return"programStage"===r?{...e,[n]:{...e[n],programStageId:void 0}}:e}},"workingListsContext"),_B=rc({[qU]:(e,t)=>{const{storeId:r}=t.payload;return{...e,[r]:void 0}},[KU]:(e,t)=>{const{storeId:r,config:n}=t.payload,a=n.filters,o=a?Object.keys(a).reduce(((e,t)=>({...e,[t]:!0})),{}):void 0;return{...e,[r]:{filtersWithValueOnInit:o,userSelectedFilters:void 0}}},[cL]:(e,t)=>{const{id:r,storeId:n}=t.payload,a={...e[n],userSelectedFilters:{...e[n].userSelectedFilters,[r]:!0}};return{...e,[n]:a}},[uL]:(e,t)=>{const{storeId:r,includeFilters:n}=t.payload;return{...e,[r]:{filtersWithValueOnInit:n,userSelectedFilters:void 0}}},[sL]:(e,t)=>{const{itemId:r,includeFilters:n,storeId:a}=t.payload,{[r]:o,...i}=n||{},{[r]:s,...l}=e[a].userSelectedFilters||{};return{...e,[a]:{filtersWithValueOnInit:i,userSelectedFilters:l}}}},"workingListsStickyFilters"),PB=rc({[HD]:e=>({...e,selectionsError:null})},"mainPage"),kB=rc({[hv]:e=>{const t={...e};return t.showAddRelationship=!1,t},[Pv]:e=>({...e,showAddRelationship:!0}),[tf]:e=>({...e,showAddRelationship:!1}),[rf]:(e,t)=>({...e,recentlyAddedRelationshipId:t.payload.relationshipId}),[jv]:e=>({...e,recentlyAddedRelationshipId:null}),[ef]:e=>{const t={...e};return t.showAddRelationship=!1,t},[Zv]:(e,t)=>{const r={...e};return r.formHorizontal=t.payload.formHorizontal,r},[wv]:(e,t)=>{const r={...e};return r.saveTypes=t.payload.saveTypes,r}},"newEventPage"),DB=e=>!e||xc(e),UB=()=>[{validator:Vt,message:n.A.t("A value is required")},{validator:DB,message:n.A.t("Please provide a valid date")}],LB=(e,t)=>{const r=[{validator:r=>((e,t,r)=>{var a,o;const i=null===t||void 0===t||null===(a=t.categories)||void 0===a||null===(o=a.find((e=>e.id===r)))||void 0===o?void 0:o.displayName;return{valid:Vt(e),message:n.A.t("Please select {{categoryName}}",{categoryName:i})}})(r,e,t),message:""}];return r};var FB=r(68557);const xB=function(){let e=arguments.length>1?arguments[1]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((t,r)=>{let{id:n,value:a}=r;const o=e.find((e=>{let{id:t}=e;return n===t}));return o&&(t[n]=Et(a,o.type)),t}),{})},MB=function(){let{enrolledAt:e,occurredAt:t,enrollment:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{enrollmentId:r,enrolledAt:Et(e,it.CO.DATE),occurredAt:Et(t,it.CO.DATE)}},VB="Program not found",jB="Stage not found",GB="Stage form not found";const BB={event:"eventId",program:"programId",programStage:"programStageId",orgUnit:"orgUnitId",trackedEntity:"trackedEntityId",enrollment:"enrollmentId"};function $B(e){const t=td.J.get(e.program);if(!t)return S().error((0,j.px)(VB)({fn:"convertDataValues",apiEvent:e})),null;const r=t.getStage(e.programStage);if(!r)return S().error((0,j.px)(jB)({fn:"convertDataValues",apiEvent:e})),null;const n=r.stageForm;if(!n)return S().error((0,j.px)(GB)({fn:"convertDataValues",apiEvent:e})),null;const a=e.dataValues.reduce(((e,t)=>(e[t.dataElement]=t.value,e)),{});return n.convertValues&&n.convertValues(a,Et)}function WB(e){return Object.keys(e).reduce(((t,r)=>{if("dataValues"!==r){const n=e[r];let a;a="occurredAt"===r||"scheduledAt"===r||"completedAt"===r?Et(n,it.CO.DATE):n;t[BB[r]||r]=a}return t}),{})}const HB=function(){let e=arguments.length>1?arguments[1]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((t=>e&&e.eventId===t.event?e:{...WB(t),...$B(t)}))},zB="UpdateDataEntryFieldForEditSingleEventActionsBatch",YB="UpdateFieldForEditSingleEventActionsBatch",qB="RulesEffectsForEditSingleEventActionsBatch",KB="OpenSingleEventForEditInDataEntry",QB="PrerequisitesErrorOpeningSingleEventForEditInDataEntry",XB="StartRunRulesOnUpdateForEditSingleEvent";const JB=e=>{let{loadedValues:{eventContainer:t,dataEntryValues:r,formValues:a},orgUnit:o,foundation:i,program:s,enrollment:d,attributeValues:c,dataEntryId:u,dataEntryKey:p,programCategory:m}=e;const g=[{id:"occurredAt",type:"DATE",validatorContainers:UB()},{id:"scheduledAt",type:"DATE",validatorContainers:UB()},{clientId:"geometry",dataEntryId:"geometry",onConvertIn:LT(i),onConvertOut:UT},{clientId:"status",dataEntryId:"complete",onConvertIn:FT,onConvertOut:xT}],h=yf(u,p);m&&m.categories&&g.push(...m.categories.map((e=>({id:`attributeCategoryOptions-${e.id}`,type:"TEXT",validatorContainers:LB({categories:m.categories},e.id)}))));const E=function(e,t,r,n,a,o,i){const s=dS(o),l=yf(e,t),d=lS(a),c=cS(r,a);return[dv({key:l,itemId:t,dataEntryId:e,dataEntryMeta:d,dataEntryValues:r,extraProps:i,dataEntryUI:c,dataEntryNotes:s}),My(l,n)]}(u,p,r,a,g,t.event,{eventId:t.event.eventId,programCategory:m}),y={...t.event,...t.values};let v;if(s instanceof FB.rr){var f;const e=null===(f=(0,DR.p)(t.event))||void 0===f?void 0:f.stage;if(!e)throw Error(n.A.t("stage not found in rules execution"));v=Zl({program:s,stage:e,orgUnit:o,currentEvent:y,otherEvents:HB(null===d||void 0===d?void 0:d.events.filter((e=>e.event!==y.eventId))),enrollmentData:MB(d),attributeValues:xB(c,s.attributes)})}else s instanceof FB.jV&&(v=Jl({program:s,orgUnit:o,currentEvent:y}));return[...E,ld(v,h),l(KB)()]},ZB=e=>l(XB)(e),e$=rc({[HD]:(e,t)=>{const r={...e};return r.eventId=t.payload.eventId,r.isLoading=!0,r.loadError=null,r},[YD]:(e,t)=>{const r={...e};return r.isLoading=!1,r.loadError=t.payload,r},[zD]:e=>{const t={...e};return t.isLoading=!1,t.dataEntryIsLoading=!0,t},[qD]:e=>{const t={...e};return t.isLoading=!1,t.dataEntryIsLoading=!0,t},[KB]:e=>{const t={...e};return t.dataEntryIsLoading=!1,t},[QB]:(e,t)=>{const r={...e};return r.dataEntryIsLoading=!1,r.dataEntryLoadError=t.payload,r}},"editEventPage"),t$="LoadEventRelationshipsBatch",r$="SaveEventRelationshipBatch",n$="DeleteEventRelationshipBatch",a$="EventRelationshipsLoaded",o$="EventCancelNewRelationship",i$="RequestAddEventRelationship",s$="StartSaveEventRelationship",l$="EventRelationshipSaved",d$="SaveFailedForEventRelationship",c$="EventRelationshipAlreadyExists",u$="StartDeleteEventRelationship",p$="EventRelationshipDeleted",m$="DeleteFailedForEventRelationship",g$="RequestDeleteEventRelationship",h$="EventRelationshipNewTeiSave",E$="EventRelationshipNewTeiSaveSuccess",y$="EventRelationshipNewTeiSaveFailed",v$=(e,t,r)=>l(s$)({selections:t},{offline:{effect:{url:"tracker?async=false",method:oc,data:e,clientId:r},commit:{type:l$,meta:{selections:t,clientId:r}},rollback:{type:d$,meta:{selections:t,clientId:r}}}}),f$=(e,t,r)=>"SaveFailedForEventRelationship"===r.type?null:(e.meta.offline.effect.url="tracker?importStrategy=DELETE&async=false",e),I$=(e,t,r)=>l(u$)({selections:r},{offline:{effect:{url:"tracker?importStrategy=DELETE&async=false",method:oc,data:e,clientId:t,updateOnDequeueCallback:f$.toString()},commit:{type:p$,meta:{selections:r,clientId:t}},rollback:{type:m$,meta:{selections:r,clientId:t}}}}),b$="StartShowEditEventDataEntryForViewSingleEvent",S$="ShowEditEventDataEntryForViewSingleEvent";async function T$(e,t,r,n,a,o,i,s,l){const d=a?lS(a):{},c=dS(r),u=a?function(e,t){return[...e.filter((e=>e.type)).map((e=>new it.fq((t=>{t.id=e.id,t.type=e.type})))).map((e=>({id:e.id,value:e.convertValue(t[e.id],xt)}))),...e.filter((e=>e.onConvertIn)).map((e=>({id:e.dataEntryId,value:e.onConvertIn(t[e.clientId])})))].reduce(((e,t)=>(e[t.id]=t.value,e)),{})}(a,r):{},p=function(e,t){return t.convertValues(e,xt)}(n,o),m=yf(e,t),{dataEntryValues:g={...u,...i},formValues:h=p}=l&&await l(u,p,o)||{},E=a?cS(g,a):{};return{actions:[dv({key:m,itemId:t,dataEntryId:e,dataEntryMeta:d,dataEntryValues:g,dataEntryNotes:c,extraProps:s,dataEntryUI:E}),My(m,h)],dataEntryValues:g,formValues:h}}const A$="ViewEventDataEntryLoadedForViewSingleEvent",C$="PrerequisitesErrorLoadingViewEventDataEntryForViewSingleEvent";const O$=async e=>{let{eventContainer:t,orgUnit:r,foundation:a,program:o,enrollment:i,attributeValues:s,dataEntryId:d,dataEntryKey:c,serverMinorVersion:u}=e;const p=[{id:"occurredAt",type:"DATE",validatorContainers:UB()},{id:"scheduledAt",type:"DATE"},{clientId:"geometry",dataEntryId:"geometry",onConvertIn:LT(a),onConvertOut:UT},{clientId:"status",dataEntryId:"complete",onConvertIn:e=>"COMPLETED"===e?"true":"false",onConvertOut:xT}],m=yf(d,c);let g;if(t.event&&t.event.attributeCategoryOptions){var h;const e=(0,j.L8)(u,j.Gv.newAocApiSeparator),r=null===(h=t.event)||void 0===h?void 0:h.attributeCategoryOptions.split(e?",":";"),n=async e=>{const t=e.map((async e=>{const t=await((e,t)=>ve().get(e,t))(z.CATEGORY_OPTIONS,e);return"default"===t.displayName?null:t}));return(await Promise.all(t)).filter(Boolean)};g=(await n(r)).reduce(((e,t)=>(e[`attributeCategoryOptions-${t.categories[0]}`]=t.id,e)),{}),p.push(...Object.keys(g).map((e=>({id:e,type:"TEXT"}))))}const E={eventId:t.event.eventId},{actions:y,dataEntryValues:v,formValues:f}=await T$(d,c,t.event,t.values,p,a,g,E),I={...t.event,...t.values};let b;if(o instanceof FB.rr){var S;const e=null===(S=(0,DR.p)(t.event))||void 0===S?void 0:S.stage;if(!e)throw Error(n.A.t("stage not found in rules execution"));b=Zl({program:o,stage:e,orgUnit:r,currentEvent:I,otherEvents:HB(null===i||void 0===i?void 0:i.events.filter((e=>e.event!==I.eventId))),enrollmentData:MB(i),attributeValues:xB(s,o.attributes)})}else o instanceof FB.jV&&(b=Jl({program:o,orgUnit:r,currentEvent:I}));const T=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const{[t]:r,...n}=e;return n}(b,Ls.ASSIGN_VALUE);return[...y,ld(T,m),l(A$)({loadedValues:{dataEntryValues:v,formValues:f,eventContainer:t,orgUnit:r},assignee:(A=t.event.assignee,A?xt(A,it.CO.USERNAME):A)})];var A},N$="StartSaveEditEventDataEntryBatchForViewSingleEvent",R$="SaveEditEventDataEntryBatchFailed",w$="CancelEditEventDataEntryForViewSingleEvent",_$="RequestSaveEditEventDataEntryForViewSingleEvent",P$="StartSaveEditEventDataEntryForViewSingleEvent",k$="EditEventDataEntrySavedForViewSingleEvent",D$="SaveEditEventDataEntryFailedForViewSingleEvent",U$="PrerequisitesErrorLoadingEditEventDataEntryForViewSingleEvent",L$="RequestDeleteEventDataEntry",F$="StartDeleteEventDataEntry",x$="DeleteEventDataEntryFailed",M$="DeleteEventDataEntrySucceeded",V$="ScheduleEvent.UpdateScheduleEventSuccess",j$="ScheduleEvent.UpdateScheduleEventError",G$="WidgetEventEdit.StartCreateNewAfterCompleting",B$="WidgetEventEdit.EventSaveAndEnrollmentCompleteRequest",$$=()=>l(w$)(),W$=(e,t,r)=>l(_$)({itemId:e,dataEntryId:t,formFoundation:r},{skipLogging:["formFoundation"]}),H$=(e,t,r,n)=>l(P$)({},{offline:{effect:{url:"tracker?async=false&importStrategy=UPDATE",method:oc,data:t},commit:{type:k$,meta:{eventId:e,triggerAction:r}},rollback:{type:D$,meta:{eventId:e,triggerAction:n}}}}),z$=e=>l(U$)(e),Y$=e=>{let{enrollmentId:t,isCreateNew:r,orgUnitId:n,programId:a,teiId:o,availableProgramStages:i}=e;return l(G$)({enrollmentId:t,isCreateNew:r,orgUnitId:n,programId:a,teiId:o,availableProgramStages:i})},q$="LoadEventNotesBatch",K$="SaveEventNoteBatch",Q$="EventNotesLoaded",X$="RequestSaveEventNote",J$="StartSaveEventNote",Z$="SaveEventNoteFailed",eW="EventNoteSaved",tW="UpdateEventNoteField",rW=(e,t,r,n)=>l(J$)({selections:r,clientId:n},{offline:{effect:{url:`events/${e}/note`,method:oc,data:t},commit:{type:eW,meta:{selections:r,clientId:n}},rollback:{type:Z$,meta:{selections:r,clientId:n}}}}),nW="WidgetEventEdit.StartShowEditEventDataEntry",aW=(0,j.Fs)(Et,Ci),oW=(e,t)=>null!==e&&void 0!==e&&e.value?aW(e.value,e.valueType,t):"",iW=(e,t,r)=>{const n=oW(e.find((e=>{let{attribute:r}=e;return r===(null===t||void 0===t?void 0:t.id)})),t),a=oW(e.find((e=>{let{attribute:t}=e;return t===(null===r||void 0===r?void 0:r.id)})),r);return n||a?`${n}${n&&" "}${a}`:""},sW=(e,t,r)=>{const n=(0,VO.Nn)(t),a=((e,t)=>{const[r,n]=t.filter((e=>{let{displayInReports:t}=e;return t}));return iW(e,r,n)})(e,n);if(a)return a;const o=((e,t)=>{const[r,n]=t;return iW(e,r,n)})(e,n);return o||r},lW=(e,t)=>{var r,n;const{error:a,data:o}=(0,A.iO)((0,y.useMemo)((()=>({trackedEntities:{resource:`tracker/trackedEntities/${e}`,params:{fields:["attributes","trackedEntityType"],program:[t]}}})),[e,t]));return{error:a,teiDisplayName:(0,y.useMemo)((()=>{var t,r;return null!==o&&void 0!==o&&null!==(t=o.trackedEntities)&&void 0!==t&&t.attributes&&null!==o&&void 0!==o&&null!==(r=o.trackedEntities)&&void 0!==r&&r.trackedEntityType?sW(o.trackedEntities.attributes,o.trackedEntities.trackedEntityType,e):""}),[null===o||void 0===o||null===(r=o.trackedEntities)||void 0===r?void 0:r.attributes,null===o||void 0===o||null===(n=o.trackedEntities)||void 0===n?void 0:n.trackedEntityType,e])}},dW=e=>(0,y.useMemo)((()=>{try{const t=(0,it.Ec)(e);return{program:t,programType:t instanceof it.rr?it.S2.TRACKER_PROGRAM:it.S2.EVENT_PROGRAM}}catch(t){return{program:void 0,programType:void 0}}}),[e]),cW="DEFAULT",uW="MISSING_DATA",pW="WITHOUT_ORG_UNIT_SELECTED",mW="LOADING",gW="OrgUnitFetcher.FetchOrgUnit",hW="OrgUnitFetcher.FetchOrgUnitSuccess",EW="OrgUnitFetcher.FetchOrgUnitFailure",yW=()=>l(EW)(),vW=e=>{let{orgUnitId:t,children:r,error:n}=e;const a=(0,gs.wA)(),o=(0,gs.d4)((e=>{let{organisationUnits:r}=e;return r[t]}));return(0,y.useEffect)((()=>{!o&&t&&a((e=>l(gW)({orgUnitId:e}))(t))}),[t,o,a]),o||!t||n?r:y.createElement(_,null)},fW="ScopeSelector.OrgUnitSet",IW="ScopeSelector.ResetOrgUnitId",bW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)(),{selectedTemplateId:r,...n}=vs();return{setProgramId:function(r){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;e.push(`${a}?${Is({...n,programId:r})}`)},setProgramIdAndResetEnrollmentContext:function(r){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;e.push(`${a}?${Is({...n,programId:r,enrollmentId:"AUTO"})}`)}}},SW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)(),r=vs();return{setOrgUnitId:function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?e.push(`${a}?${Is({...r,orgUnitId:n})}`):e.push(`${a}?${Is({orgUnitId:n})}`)}}},TW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)(),{programId:r,orgUnitId:n,teiId:a}=vs();return{setEnrollmentId:o=>{let{enrollmentId:i,pageToPush:s=t,shouldReplaceHistory:l}=o;const d=`${s}?${Is({programId:r,orgUnitId:n,teiId:a,enrollmentId:i})}`;l?e.replace(d):e.push(d)}}},AW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)();return{resetProgramId:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;const{programId:n,...a}=fs();e.push(`${r}?${Is({...a})}`)},resetProgramIdAndEnrollmentContext:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=arguments.length>1?arguments[1]:void 0;const{programId:a,enrollmentId:o,stageId:i,eventId:s,teiId:l,...d}=fs();e.push(`${r}?${Is({...d,teiId:null!==l&&void 0!==l?l:null===n||void 0===n?void 0:n.teiId,enrollmentId:"AUTO"})}`)},resetProgramIdAndTeiId:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;const{programId:n,teiId:a,...o}=fs();e.push(`${r}?${Is({...o})}`)},resetProgramIdAndSelectedTemplateId:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;const{programId:n,selectedTemplateId:a,...o}=fs();e.push(`${r}?${Is({...o})}`)}}},CW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)(),{orgUnitId:r,...n}=vs();return{resetOrgUnitId:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;e.push(`${r}?${Is({...n})}`)}}},OW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)(),{programId:r,orgUnitId:n}=vs();return{resetTeiId:function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,o=arguments.length>1?arguments[1]:void 0;e.push(`${a}?${Is({programId:null!==r&&void 0!==r?r:null===o||void 0===o?void 0:o.programId,orgUnitId:n})}`)}}},NW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)(),{programId:r,orgUnitId:n,teiId:a}=vs();return{resetEnrollmentId:function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments.length>1?arguments[1]:void 0;e.push(`${o}?${Is({programId:null!==r&&void 0!==r?r:null===i||void 0===i?void 0:i.programId,orgUnitId:n,teiId:null!==a&&void 0!==a?a:null===i||void 0===i?void 0:i.teiId})}`)}}},RW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)(),{programId:r,orgUnitId:n,teiId:a,enrollmentId:o}=vs();return{resetStageId:function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,s=arguments.length>1?arguments[1]:void 0;e.push(`${i}?${Is({programId:r,orgUnitId:n,teiId:a,enrollmentId:null!==o&&void 0!==o?o:null===s||void 0===s?void 0:s.enrollmentId})}`)}}},wW=()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)(),{programId:r,orgUnitId:n,teiId:a,enrollmentId:o}=vs();return{resetEventId:function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,s=arguments.length>1?arguments[1]:void 0;e.push(`${i}?${Is({programId:r,orgUnitId:n,teiId:a,enrollmentId:null!==o&&void 0!==o?o:null===s||void 0===s?void 0:s.enrollmentId})}`)}}},_W=()=>{const e=(0,T.W6)();return{reset:()=>{e.push("/")}}};var PW=r(47109),kW=r(13895),DW=r(16325);const UW=e=>e.options,LW=e=>e.onSelect,FW=(0,I.withStyles)((()=>({icon:{display:"flex",alignItems:"center",paddingRight:5},label:{display:"flex",alignItems:"center"}})))((e=>{let{icon:t,label:r,classes:n}=e;return y.createElement("div",{className:n.label},t?y.createElement("div",{className:n.icon},y.createElement(Tm,{name:t.name,color:t.color,alternativeText:t.name,width:22,height:22,cornerRadius:2})):null,r)})),xW=(0,I.withStyles)((()=>({input:{position:"sticky",top:"0",background:`${vn.T.white}`,padding:`${yn.Q.dp8} ${yn.Q.dp8} ${yn.Q.dp4} ${yn.Q.dp8}`,zIndex:"1"},empty:{fontSize:"14px",color:`${vn.T.grey700}`,display:"flex",justifyContent:"center",padding:`${yn.Q.dp16} ${yn.Q.dp8}`}})))((e=>{let{dataTest:t,options:r,onChange:a,searchText:o,classes:i}=e;const[s,l]=(0,y.useState)(""),d=r.reduce(((e,t)=>t.label.toLowerCase().includes(s.toLowerCase())?[...e,t]:e),[]),c=(null===d||void 0===d?void 0:d.length)>0;return y.createElement(y.Fragment,null,y.createElement(aF.p,{dense:!0,dataTest:`${t}-filterinput`,value:s,onChange:e=>{let{value:t}=e;return l(t)},type:"text",placeholder:o,initialFocus:!0,className:i.input}),c?d.map((e=>y.createElement(bh.D,{key:e.value,label:y.createElement(FW,{icon:e.icon,label:e.label}),value:e.value,onClick:a}))):y.createElement("div",{className:i.empty},y.createElement("span",null,n.A.t("No results found for "),s)))}));class MW extends y.Component{static getOptionsAsync(e,t,r){return Rd(e,{predicate:e=>{if(!t)return!0;const r=e.organisationUnits;return!r||!!r[t]},project:e=>({label:e.displayName,value:e.id,writeAccess:e.access.data.write}),onIsAborted:r})}static getDerivedStateFromProps(e,t){return e.selectedOrgUnitId!==t.prevOrgUnitId?{prevOrgUnitId:e.selectedOrgUnitId,options:null}:null}constructor(e){super(e),this.state={options:null,prevOrgUnitId:null,open:!1},this.onSelectSelector=(0,fg.Mz)(UW,LW,((e,t)=>r=>{const n=e.find((e=>e.value===r));t({name:n.label,id:n.value,writeAccess:n.writeAccess})})),this.loadCagoryOptions(this.props)}componentDidUpdate(e){this.state.options||e.selectedOrgUnitId===this.props.selectedOrgUnitId||this.loadCagoryOptions(this.props)}componentWillUnmount(){this.cancelablePromise&&this.cancelablePromise.cancel(),this.cancelablePromise=null}loadCagoryOptions(e){const{category:t,selectedOrgUnitId:r}=e;let n;this.setState({options:null}),this.cancelablePromise&&this.cancelablePromise.cancel();n=(0,j.gI)(VW.getOptionsAsync(t.id,r,(()=>n&&this.cancelablePromise!==n))),n.promise.then((e=>{e.sort(((e,t)=>e.label===t.label?0:e.label<t.label?-1:1)),this.setState({options:e}),this.cancelablePromise=null})).catch((e=>{e&&(e.aborted||e.isCanceled)||(S().error((0,j.px)("An error occured loading category options")({error:e})),this.setState({options:[]}))})),this.cancelablePromise=n}render(){const{selectedOrgUnitId:e,onSelect:t,onClearSelectionClick:r,selectedCategoryName:a,classes:o,displayOnly:i,disabled:s,...l}=this.props,{options:d}=this.state,c=this.onSelectSelector({options:d,onSelect:t});return y.createElement(kW.G,{label:l.category.name,value:a,noValueMessage:n.A.t(`Choose a ${l.category.name}`),open:this.state.open,setOpen:e=>{i||this.setState({open:e})},onClearSelectionClick:!i&&r,dataTest:"category-selector-container",disabled:s,displayOnly:i},d&&y.createElement("div",{className:o.selectBarMenu},y.createElement(nI.W,null,d.length>10?y.createElement(xW,{options:d,onChange:e=>{this.setState({open:!1}),c(e.value)},searchText:n.A.t(`Search for a ${l.category.name}`),dataTest:"category"}):d.map((e=>y.createElement(bh.D,{key:e.value,label:e.label,value:e.value,onClick:e=>{this.setState({open:!1}),c(e.value)}}))),Boolean(a)&&d.length>10&&y.createElement(y.Fragment,null,y.createElement(DW.N,null),y.createElement(bh.D,{dense:!0,onClick:()=>{this.setState({open:!1}),r()},label:n.A.t("Clear selection")})))))}}const VW=(0,I.withStyles)((()=>({selectBarMenu:{maxHeight:"80vh",overflow:"auto",paddingBottom:`${yn.Q.dp4}`}})))(MW),jW=(0,I.withStyles)((()=>({filterWarning:{fontSize:"14px",color:`${vn.T.grey700}`,display:"flex",alignItems:"center",gap:`${yn.Q.dp8}`,padding:`${yn.Q.dp4} ${yn.Q.dp12}`}})))((e=>{let{onResetOrgUnit:t,classes:r}=e;const{push:a}=(0,T.W6)(),{pathname:o}=(0,T.zy)(),{enrollmentId:i,teiId:s,orgUnitId:l}=vs();return(0,y.useEffect)((()=>{a(`${o}?${Is({enrollmentId:i,teiId:s,orgUnitId:l})}`)}),[a,o,i,s,l]),y.createElement("div",{className:r.filterWarning},y.createElement("span",null,n.A.t("No programs available.")),y.createElement(ra.$,{small:!0,secondary:!0,onClick:()=>t(),dataTest:"program-selector-no-programs"},n.A.t("Show all")))})),GW=(0,I.withStyles)((()=>({filterWarning:{fontSize:"14px",color:`${vn.T.grey700}`,display:"flex",alignItems:"center",gap:`${yn.Q.dp8}`,padding:`${yn.Q.dp4} ${yn.Q.dp12}`}})))((e=>{let{programOptions:t,programsArray:r,onChange:a,onResetOrgUnit:o,classes:i}=e;const s=t.length===r.filter((e=>e.access.data.read)).length;return y.createElement(y.Fragment,null,t.length>10?y.createElement(xW,{options:t,onChange:a,searchText:n.A.t("Search for a program"),dataTest:"program"}):t.map((e=>y.createElement(bh.D,{key:e.value,label:y.createElement(FW,{icon:e.icon,label:e.label}),value:e.value,onClick:a}))),!s&&y.createElement(y.Fragment,null,y.createElement(DW.N,null),y.createElement("div",{className:i.filterWarning},y.createElement("span",null,n.A.t("Some programs are being filtered by the chosen organisation unit")),y.createElement(ra.$,{small:!0,secondary:!0,onClick:()=>o()},n.A.t("Show all programs")))))})),BW=e=>e.map((e=>({label:e.name,value:e.id,icon:e.icon}))),$W=(0,I.withStyles)((()=>({selectBarMenu:{maxHeight:"80vh",overflow:"auto",paddingBottom:`${yn.Q.dp4}`}})))((e=>{let{handleClickProgram:t,handleSetCatergoryCombo:r,onResetProgramId:a,onResetCategoryOption:o,onResetOrgUnit:i,selectedProgramId:s,selectedOrgUnitId:l,selectedCategories:d,formIsOpen:c,classes:u}=e;const[p,m]=(0,y.useState)(!1),[g,h]=(0,y.useState)([]),E=s?Nt.Jj.get(s):null,v=((e,t)=>BW(e?t.filter((t=>t.organisationUnits[e]&&t.access.data.read)):t.filter((e=>e.access.data.read))))(l,g),f=!t;(0,y.useEffect)((()=>{h(Array.from(Nt.Jj.values()))}),[]);return y.createElement(y.Fragment,null,y.createElement(kW.G,{label:n.A.t("Program"),noValueMessage:n.A.t("Choose a program"),value:E&&y.createElement(FW,{icon:E.icon,label:E.name}),open:p,setOpen:e=>f?null:m(e),displayOnly:f,onClearSelectionClick:()=>a(uf()),dataTest:"program-selector-container"},y.createElement("div",{className:u.selectBarMenu},y.createElement(nI.W,null,0===v.length?y.createElement(jW,{onResetOrgUnit:()=>i()}):y.createElement(y.Fragment,null,y.createElement(GW,{programOptions:v,programsArray:g,onChange:e=>{m(!1),t&&t(e.value)},onResetOrgUnit:()=>i()}),Boolean(E)&&v.length>10&&y.createElement(y.Fragment,null,y.createElement(DW.N,null),y.createElement(bh.D,{dense:!0,onClick:()=>{m(!1),a(uf())},label:n.A.t("Clear selection")})))))),null!==E&&void 0!==E&&E.categoryCombination?Array.from(E.categoryCombination.categories.values()).map((e=>y.createElement(VW,{key:e.id,category:e,selectedCategoryName:d&&d[e.id]?d[e.id].name:"",onSelect:t=>r&&r(t,e.id),onClearSelectionClick:()=>o(e.id),selectedOrgUnitId:l,displayOnly:c}))):null)}));class WW extends y.Component{constructor(e){super(e),this.state={open:!1},this.handleClick=this.handleClick.bind(this)}handleClick(e){const t={id:e.id,name:e.displayName,code:e.code},{handleClickOrgUnit:r}=this.props;r&&r(e.id,t)}render(){const{selectedOrgUnitId:e,selectedOrgUnit:t,previousOrgUnitId:r,onReset:a,classes:o}=this.props;return y.createElement(kW.G,{label:n.A.t("Organisation unit"),noValueMessage:n.A.t("Choose an organisation unit"),value:e?null===t||void 0===t?void 0:t.name:"",open:this.state.open,setOpen:e=>this.setState({open:e}),onClearSelectionClick:()=>a(),dataTest:"org-unit-selector-container"},y.createElement("div",{className:o.selectBarMenu},y.createElement(Lp,{"data-test":"org-unit-field",onSelectClick:(e,t)=>{t.stopPropagation(),t.preventDefault(),this.setState({open:!1}),this.handleClick(e)},previousOrgUnitId:e||r})))}}const HW=(0,I.withStyles)((()=>({selectBarMenu:{minWidth:"640px",maxHeight:"80vh",overflow:"auto",minHeight:yn.Q.dp96}})))(WW),zW=e=>{let{selectedOrgUnitId:t,selectedProgramId:r,selectedCategories:n,selectedOrgUnit:a,previousOrgUnitId:o,onSetOrgUnit:i,onSetProgramId:s,onSetCategoryOption:l,onResetOrgUnitId:d,onResetProgramId:c,onResetCategoryOption:u,onResetAllCategoryOptions:p,formIsOpen:m,children:g,onStartAgain:h}=e;return y.createElement(PW.l,{disableClearSelections:!r&&!t,onClearSelectionClick:()=>h()},y.createElement($W,{selectedProgramId:r,selectedOrgUnitId:t,selectedCategories:n,handleClickProgram:s,handleSetCatergoryCombo:l,handleResetCategorySelections:p,buttonModeMaxLength:5,onResetProgramId:c,onResetCategoryOption:u,onResetOrgUnit:d,formIsOpen:m}),y.createElement(HW,{previousOrgUnitId:o,selectedOrgUnitId:t,handleClickOrgUnit:i,selectedOrgUnit:a,onReset:d}),g)};function YW(){return YW=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YW.apply(this,arguments)}function qW(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class KW extends y.Component{constructor(e){super(e),qW(this,"dontShowWarning",(()=>!this.props.isUserInteractionInProgress)),qW(this,"handleOpenOrgUnitWarning",(()=>{this.dontShowWarning()?this.props.onResetOrgUnitId():this.setState({openOrgUnitWarning:!0})})),qW(this,"handleOpenProgramWarning",(e=>{this.dontShowWarning()?this.props.onResetProgramId(e):this.setState({openProgramWarning:e})})),qW(this,"handleOpenCatComboWarning",(e=>{this.dontShowWarning()?this.props.onResetCategoryOption&&this.props.onResetCategoryOption(e):this.setState({openCatComboWarning:!0,categoryIdToReset:e})})),qW(this,"handleStartAgainWarning",(()=>{this.dontShowWarning()?this.props.onStartAgain&&this.props.onStartAgain():this.setState({openStartAgainWarning:!0})})),qW(this,"handleClose",(()=>{this.setState({openOrgUnitWarning:!1,openProgramWarning:null,openCatComboWarning:!1,openStartAgainWarning:!1})})),qW(this,"handleAcceptOrgUnit",(()=>{this.props.onResetOrgUnitId(),this.handleClose()})),qW(this,"handleAcceptProgram",(()=>{this.state.openProgramWarning&&this.props.onResetProgramId(this.state.openProgramWarning),this.handleClose()})),qW(this,"handleAcceptCatCombo",(()=>{this.props.onResetCategoryOption&&this.props.onResetCategoryOption(this.state.categoryIdToReset),this.handleClose()})),qW(this,"handleAcceptStartAgain",(()=>{this.props.onStartAgain&&this.props.onStartAgain(),this.handleClose()})),this.state={openOrgUnitWarning:!1,openProgramWarning:null,openCatComboWarning:!1,openStartAgainWarning:!1,categoryIdToReset:""}}render(){const{onSetOrgUnit:e,onSetProgramId:t,onSetCategoryOption:r,onResetAllCategoryOptions:n}=this.props;return y.createElement("div",{className:this.props.classes.stickyTopBar,"data-test":"scope-selector"},y.createElement(zW,{onSetOrgUnit:e,onSetProgramId:t,onSetCategoryOption:r,onResetAllCategoryOptions:n,onResetOrgUnitId:this.handleOpenOrgUnitWarning,onResetProgramId:this.handleOpenProgramWarning,onResetCategoryOption:this.handleOpenCatComboWarning,onStartAgain:this.handleStartAgainWarning,previousOrgUnitId:this.props.previousOrgUnitId,selectedOrgUnitId:this.props.selectedOrgUnitId,selectedProgramId:this.props.selectedProgramId,selectedOrgUnit:this.props.selectedOrgUnit,selectedCategories:this.props.selectedCategories,isUserInteractionInProgress:this.props.isUserInteractionInProgress,formIsOpen:this.props.formIsOpen},this.props.children),y.createElement(Rf,YW({onDestroy:this.handleAcceptOrgUnit,open:this.state.openOrgUnitWarning,onCancel:this.handleClose},wf)),y.createElement(Rf,YW({onDestroy:this.handleAcceptProgram,open:!!this.state.openProgramWarning,onCancel:this.handleClose},wf)),y.createElement(Rf,YW({onDestroy:this.handleAcceptCatCombo,open:this.state.openCatComboWarning,onCancel:this.handleClose},wf)),y.createElement(Rf,YW({onDestroy:this.handleAcceptStartAgain,open:this.state.openStartAgainWarning,onCancel:this.handleClose},wf)))}}const QW=(0,qd.compose)(Dp((()=>({height:"100px"}))),(0,I.withStyles)({stickyTopBar:{position:"sticky",top:0,zIndex:1e3,width:"100%"}}))(KW),XW=e=>{let{isUserInteractionInProgress:t=!1,selectedProgramId:r,selectedOrgUnitId:n,selectedCategories:a,onSetProgramId:o,onSetOrgUnit:i,onSetCategoryOption:s,onResetProgramId:d,onResetOrgUnitId:c,onResetCategoryOption:u,onResetAllCategoryOptions:p,onStartAgain:m,formIsOpen:g=!1,children:h}=e;const E=(0,gs.wA)(),[v,f]=(0,y.useState)({name:void 0,id:n}),{displayName:I,error:b}=mi(v.id);(0,y.useEffect)((()=>{I&&v.name!==I&&f((e=>({...e,name:I})))}),[I,v,f]),(0,y.useEffect)((()=>{n&&v.id!==n&&n&&f((e=>({...e,id:n})))}),[n,v,f]);const{lockedSelectorLoads:S,previousOrgUnitId:T}=(0,gs.d4)((e=>{let{activePage:t,app:r}=e;return{lockedSelectorLoads:t.lockedSelectorLoads,previousOrgUnitId:r.previousOrgUnitId}})),A=((e,t,r,n,a)=>!!(a||!t||r&&r===n)&&!e)(S,v.id,v.name,I,b);return y.createElement(QW,{onResetProgramId:d,onResetOrgUnitId:()=>(v&&E((e=>l(IW)({previousOrgUnitId:e}))(null===v||void 0===v?void 0:v.id)),c()),onResetAllCategoryOptions:p,onResetCategoryOption:u,onSetCategoryOption:s,onSetProgramId:o,onSetOrgUnit:(e,t)=>{f(t),i&&i(e)},previousOrgUnitId:T,selectedOrgUnit:{...v,name:b?void 0:v.name},selectedOrgUnitId:n,selectedProgramId:r,selectedCategories:a,isUserInteractionInProgress:t,formIsOpen:g,onStartAgain:m,ready:A},h)};function JW(){return JW=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JW.apply(this,arguments)}const ZW=(0,qd.compose)(Dp((()=>({height:"100%",alignItems:"center",justifyContent:"center"})),(()=>({size:15}))),(0,I.withStyles)((()=>({selectBarMenu:{maxHeight:"80vh",overflow:"auto"},label:{display:"flex",alignItems:"center"}}))))((e=>{let{onClear:t,onSelect:r,title:a,selectedValue:o,options:i=[],displayOnly:s,classes:l,isUserInteractionInProgress:d}=e;const[c,u]=(0,y.useState)(!1),[p,m]=(0,y.useState)(!1),g=!s&&(null===i||void 0===i?void 0:i.length)>0,h=()=>{u(!1)},E=()=>{d?u(!0):t&&t()},v=(0,y.useCallback)((e=>{let{value:t}=e;r&&r(t)}),[r]),f=e=>{m(!1),v(e)},{label:I,icon:b}=((e,t)=>e.find((e=>{let{value:r}=e;return r===t}))||{})(i,o),S=i.length>10;return y.createElement("span",{"data-test":"single-locked-select"},y.createElement(kW.G,{disabled:0===i.length,displayOnly:s,label:Ot(a),value:I&&y.createElement(FW,{icon:b,label:I}),noValueMessage:g?n.A.t(`Choose a ${Pu(a)}`):"",open:p,setOpen:e=>g&&m(e),onClearSelectionClick:()=>E(),dataTest:`${Pu(a)}-selector-container`},g&&y.createElement("div",{className:l.selectBarMenu},y.createElement(nI.W,null,S?y.createElement(xW,{options:i,onChange:f,searchText:n.A.t(`Search for a ${a}`),dataTest:a}):i.map((e=>y.createElement(bh.D,{key:e.value,label:y.createElement(FW,{icon:e.icon,label:e.label}),value:e.value,onClick:f}))),I&&S&&y.createElement(y.Fragment,null,y.createElement(DW.N,null),y.createElement(bh.D,{dense:!0,onClick:()=>{m(!1),E()},label:n.A.t("Clear selection")}))))),y.createElement(Rf,JW({onDestroy:()=>{h(),t&&t()},open:c,onCancel:h},wf)))})),eH=function(){let e=arguments.length>1?arguments[1]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((t=>{let{program:r}=t;return r===e})).map((e=>{let{enrolledAt:t,enrollment:r}=e;return{label:Oi(t),value:r}}))},tH=(0,I.withStyles)((()=>({container:{display:"flex",alignItems:"center",marginLeft:`${yn.Q.dp8}`,gap:`${yn.Q.dp4}`,height:"40px"}})))((e=>{let{onNewClick:t,onNewClickWithoutProgramId:r,onFindClick:a,onFindClickWithoutProgramId:o,selectedProgramId:i,classes:s,openConfirmDialog:l}=e;const{trackedEntityName:d,scopeType:c,programName:u}=es(i),[p,m]=(0,y.useState)(!1);return(0,y.useEffect)((()=>{m(!1)}),[l]),y.createElement("div",{className:s.container},c!==it.m2.TRACKER_PROGRAM&&c!==it.m2.EVENT_PROGRAM?y.createElement(ra.$,{small:!0,secondary:!0,dataTest:"new-event-button",className:s.marginRight,onClick:r},n.A.t("Create new")):y.createElement(TI.f,{small:!0,secondary:!0,dataTest:"new-button",className:s.marginRight,onClick:()=>{t()},component:y.createElement(AI.n,{dense:!0,maxWidth:"250px"},y.createElement(bh.D,{dataTest:"new-menuitem-one",label:`${n.A.t("Create new in another program")}...`,onClick:()=>{r()}}))},c===it.m2.TRACKER_PROGRAM&&n.A.t("Create new {{trackedEntityType}}",{trackedEntityType:d,interpolation:{escapeValue:!1}}),c===it.m2.EVENT_PROGRAM&&n.A.t("Create new event")),c!==it.m2.TRACKER_PROGRAM?y.createElement(ra.$,{small:!0,secondary:!0,dataTest:"find-button",className:s.marginRight,onClick:o},n.A.t("Search")):y.createElement(QM.g,{small:!0,secondary:!0,dataTest:"find-button",className:s.marginRight,open:p,onClick:()=>m((e=>!e)),component:y.createElement(AI.n,{dense:!0,maxWidth:"250px"},y.createElement(bh.D,{dataTest:"find-menuitem-one",label:n.A.t("Search for a {{trackedEntityName}} in {{programName}}",{trackedEntityName:d,programName:u,interpolation:{escapeValue:!1}}),onClick:()=>{a(),m((e=>!e))}}),y.createElement(bh.D,{dataTest:"find-menuitem-two",label:`${n.A.t("Search")}...`,onClick:()=>{o(),m((e=>!e))}}))},n.A.t("Search")))}));function rH(){return rH=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rH.apply(this,arguments)}const nH={openNewRegistrationPage:!1,openNewRegistrationPageWithoutProgramId:!1,openSearchPage:!1,openSearchPageWithoutProgramId:!1},aH=e=>{let{selectedProgramId:t,selectedOrgUnitId:r,isUserInteractionInProgress:n=!1}=e;const[a,o]=(0,y.useState)(nH),{openNewRegistrationPage:i,openNewRegistrationPageWithoutProgramId:s,openSearchPage:l,openSearchPageWithoutProgramId:d}=a,c=i||s||l||d,u=(0,T.W6)(),p=()=>{const e={};r&&(e.orgUnitId=r),t&&(e.programId=t),u.push(`new?${Is(e)}`)},m=()=>{const e=r?{orgUnitId:r}:{};u.push(`new?${Is(e)}`)},g=()=>{const e={};r&&(e.orgUnitId=r),t&&(e.programId=t),u.push(`search?${Is(e)}`)},h=()=>{const e=r?{orgUnitId:r}:{};u.push(`search?${Is(e)}`)};return y.createElement(y.Fragment,null,y.createElement(tH,{selectedProgramId:t,onFindClick:()=>{n?o((e=>({...e,openSearchPage:!0}))):g()},onFindClickWithoutProgramId:()=>{n?o((e=>({...e,openSearchPageWithoutProgramId:!0}))):h()},onNewClick:()=>{n?o((e=>({...e,openNewRegistrationPage:!0}))):p()},onNewClickWithoutProgramId:()=>{n?o((e=>({...e,openNewRegistrationPageWithoutProgramId:!0}))):m()},openConfirmDialog:c}),y.createElement(Rf,rH({onDestroy:()=>{i&&p(),s&&m(),l&&g(),d&&h(),o(nH)},open:c,onCancel:()=>o(nH)},wf)))},oH=e=>{let{mode:t,programStage:r,enrollmentId:a,programId:o,enrollmentsAsOptions:i,trackedEntityName:s,teiDisplayName:l,orgUnitId:d,teiId:c,eventDate:u,pageStatus:p}=e;const{setOrgUnitId:m}=SW(),{resetProgramIdAndEnrollmentContext:g}=AW(),{resetOrgUnitId:h}=CW(),{resetEnrollmentId:E}=NW(),{resetTeiId:v}=OW(),{resetStageId:f}=RW(),{resetEventId:I}=wW(),{reset:b}=_W(),S=t===V.EDIT;return y.createElement(XW,{selectedProgramId:o,selectedOrgUnitId:d,onSetOrgUnit:e=>m(e),onResetProgramId:()=>g("enrollment",{teiId:c}),onResetOrgUnitId:()=>h(),isUserInteractionInProgress:S,onStartAgain:()=>b()},y.createElement(ZW,{displayOnly:!0,ready:p!==uW,onClear:()=>v("/",{programId:o}),options:[{label:l,value:"alwaysPreselected"}],selectedValue:"alwaysPreselected",title:s,isUserInteractionInProgress:S}),y.createElement(ZW,{ready:p!==uW,onClear:()=>E("enrollment",{programId:o,teiId:c}),options:i,selectedValue:a,title:n.A.t("Enrollment"),isUserInteractionInProgress:S}),y.createElement(ZW,{displayOnly:!0,ready:p!==uW,onClear:()=>f("enrollment",{enrollmentId:a}),options:[{label:(null===r||void 0===r?void 0:r.name)||"",value:"alwaysPreselected",icon:null===r||void 0===r?void 0:r.icon}],selectedValue:"alwaysPreselected",title:n.A.t("Stage"),isUserInteractionInProgress:S}),r&&y.createElement(ZW,{displayOnly:!0,ready:p!==uW,onClear:()=>I("enrollment",{enrollmentId:a}),options:[{label:u||"",value:"alwaysPreselected"}],selectedValue:"alwaysPreselected",title:r.stageForm.getLabel("occurredAt"),isUserInteractionInProgress:S}),y.createElement(aH,{selectedProgramId:o,selectedOrgUnitId:d,isUserInteractionInProgress:t===V.EDIT}))},iH=e=>{let{formId:t}=e;const[r,a]=(0,y.useState)(!1),[o,i]=(0,y.useState)([]),{rulesEffectsHiddenFields:s}=(0,gs.d4)((e=>({rulesEffectsHiddenFields:e.rulesEffectsHiddenFields[t]||[]})),gs.bN);return(0,y.useEffect)((()=>{const e=(e=>Object.keys(e).reduce(((t,r)=>{if(e[r].hadValue){const a=e[r].content||`${e[r].name} ${n.A.t("was blanked out and hidden by your last action")}`;return[...t,{key:r,text:a}]}return t}),[]))(s);(null===e||void 0===e?void 0:e.length)>0&&(i(e),a(!0))}),[s]),r?y.createElement(N.a,{onClose:()=>a(!1),position:"middle"},y.createElement(Ip.w,null,n.A.t("Notice")),y.createElement(R.$,null,y.createElement("ul",null,o.map((e=>y.createElement("li",{key:e.key},e.text)))),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:()=>a(!1)},n.A.t("Close the notice")))))):null};var sH=r(63300),lH=r(84270),dH=r(30294);const cH={[it.CO.FILE_RESOURCE]:async(e,t,r,n)=>{const a=Object.keys(e).map((async a=>{const o=e[a];if(o){const{id:e,displayName:i}=await t({resource:`fileResources/${o}`});return{id:e,name:i,url:(0,j.UR)(j.Gv.trackerFileEndpoint)?`${n}/tracker/events/${r}/dataValues/${a}/file`:`${n}/events/files?dataElementUid=${a}&eventUid=${r}`}}return{}}));return(await Promise.all(a)).reduce(((e,t)=>{let{id:r,name:n,url:a}=t;return r&&(e[r]={value:r,name:n,url:a}),e}),{})},[it.CO.IMAGE]:(e,t,r,n)=>Object.keys(e).map((t=>{const a=e[t];return a?{value:a,...(0,j.UR)(j.Gv.trackerImageEndpoint)?{url:`${n}/tracker/events/${r}/dataValues/${t}/image`,previewUrl:`${n}/tracker/events/${r}/dataValues/${t}/image?dimension=small`}:{url:`${n}/events/files?dataElementUid=${t}&eventUid=${r}`,previewUrl:`${n}/events/files?dataElementUid=${t}&eventUid=${r}&dimension=SMALL`}}:{}})).reduce(((e,t)=>{let{value:r,url:n,previewUrl:a}=t;return r&&(e[r]={value:r,url:n,previewUrl:a}),e}),{}),[it.CO.ORGANISATION_UNIT]:async(e,t)=>{const r=Object.values(e).map((e=>String(e)));return await pi(r,t)}};async function uH(e,t,r){const{type:n,ids:a,eventId:o}=e;return a?Object.keys(a).reduce((async(e,i)=>{const s=await e;if(n){const e=cH[n];if(e){const n=await e(a,t,o,r);s[i]=n[a[i]]}else s[i]=a[i]}return s}),Promise.resolve(a)):null}var pH=r(21476);const mH=(0,I.withStyles)({wrapper:{display:"flex",alignItems:"center"},text:{paddingLeft:"2px"}})((e=>{var t;let{event:r,classes:n}=e;const a=null===(t=r.notes)||void 0===t?void 0:t.length;return a?y.createElement("div",{className:n.wrapper},y.createElement(pH.A,null),y.createElement("span",{className:n.text},a)):null})),gH=e=>$()(e.scheduledAt).isBefore($()().startOf("day"))&&e.status===Es.SCHEDULE,hH=(e,t)=>{let{id:r,resolveValue:n}=t;return n?n(e):e[r]},EH={container:{display:"flex",alignItems:"center",padding:"0",justifyContent:"space-between",width:"100%",marginLeft:"-4px"},icon:{paddingRight:yn.U.dp8},descriptionIcon:{marginLeft:yn.U.dp4,marginRight:yn.U.dp8,height:"16px"},infoTitles:{display:"flex",alignItems:"center"},infoItems:{display:"flex",gap:yn.Q.dp12},indicatorIcon:{paddingRight:yn.U.dp4,height:"16px"},title:{fontSize:"18px",lineHeight:"19px",fontWeight:500,color:vn.T.grey900,display:"flex",marginInlineEnd:yn.Q.dp4},indicator:{color:vn.T.grey800,fontSize:"12px",lineHeight:"16px",fontWeight:400,height:"100%",display:"flex",alignItems:"center"},warningIndicator:{color:vn.T.red700}},yH=(0,I.withStyles)(EH)((e=>{let{title:t,icon:r,description:a,events:o,classes:i}=e;const{fromServerDate:s}=(0,A.Bp)(),l=o.length,d=o.filter(gH).length,c=o.filter((e=>e.status===Es.SCHEDULE)).length;return y.createElement("div",{className:i.container},y.createElement("div",{className:i.infoTitles},r&&y.createElement("div",{className:i.icon},y.createElement(Tm,{name:r.name,color:r.color,width:32,height:32,cornerRadius:5})),y.createElement("div",null),y.createElement("div",{className:i.title},t),a&&y.createElement(Xo.m,{content:a,openDelay:100},y.createElement("div",{className:i.descriptionIcon},y.createElement(bm.A,null)))),y.createElement("div",{className:i.infoItems},y.createElement("div",{className:i.indicator},n.A.t("{{ count }} event",{count:l,defaultValue:"{{ count }} event",defaultValue_plural:"{{count}} events"})),d>0?y.createElement("div",{className:er()(i.indicator,i.warningIndicator)},y.createElement("div",{className:i.indicatorIcon},y.createElement(sH.A,null)),n.A.t("{{ overdueEvents }} overdue",{overdueEvents:d})):null,c>0?y.createElement("div",{className:i.indicator},y.createElement("div",{className:i.indicatorIcon},y.createElement(lH.A,null)),n.A.t("{{ scheduledEvents }} scheduled",{scheduledEvents:c})):null,l>0&&y.createElement("div",{className:er()(i.indicator)},y.createElement("div",{className:i.indicatorIcon},y.createElement(dH.A,null)),((e,t)=>{const r=e.reduce(((e,t)=>new Date(e.updatedAt).getTime()>new Date(t.updatedAt).getTime()?e:t));if(r){const{updatedAt:e}=r;return null!==r&&void 0!==r&&r.updatedAt&&$()(e).isValid()?y.createElement(y.Fragment,null,n.A.t("Last updated"),"\xa0",y.createElement(Xo.m,{content:t(e).toLocaleString()},$()(t(e)).fromNow())):null}return null})(o,s))))}));var vH=r(86023),fH=r(92072);const IH=Object.freeze({DEFAULT:"default",ASC:"asc",DESC:"desc"}),bH=(e,t,r,n)=>{const a=Number(e),o=Number(t),{eventDateA:i,eventDateB:s}=n;return r===IH.DESC?Number.isNaN(a)?1:Number.isNaN(o)?-1:a!==o?a-o:$()(s).unix()-$()(i).unix():r===IH.ASC?Number.isNaN(a)?-1:Number.isNaN(o)?1:a!==o?o-a:$()(s).unix()-$()(i).unix():0},SH=(e,t,r,n)=>{const{eventDateA:a,eventDateB:o}=n;return r===IH.DESC?e?t?e!==t?e.localeCompare(t):$()(o).unix()-$()(a).unix():-1:1:r===IH.ASC?e?t?e!==t?t.localeCompare(e):$()(o).unix()-$()(a).unix():1:-1:0},TH=(e,t,r,n)=>{const{eventDateA:a,eventDateB:o}=n;return r===IH.DESC?e!==t?$()(t).unix()-$()(e).unix():$()(o).unix()-$()(a).unix():r===IH.ASC?e!==t?$()(e).unix()-$()(t).unix():$()(a).unix()-$()(o).unix():0},AH={[it.CO.EMAIL]:SH,[it.CO.TEXT]:SH,[it.CO.PHONE_NUMBER]:SH,[it.CO.LONG_TEXT]:SH,[it.CO.NUMBER]:bH,[it.CO.INTEGER]:bH,[it.CO.INTEGER_POSITIVE]:bH,[it.CO.INTEGER_NEGATIVE]:bH,[it.CO.INTEGER_ZERO_OR_POSITIVE]:bH,[it.CO.BOOLEAN]:SH,[it.CO.TRUE_ONLY]:SH,[it.CO.DATE]:TH,[it.CO.DATETIME]:TH,[it.CO.TIME]:TH,[it.CO.PERCENTAGE]:SH,[it.CO.URL]:SH,[it.CO.AGE]:SH,[it.CO.ORGANISATION_UNIT]:(e,t,r,n)=>SH(e.name,t.name,r,n),[it.CO.USERNAME]:SH,[it.CO.STATUS]:(e,t,r,n)=>{const{eventDateA:a,eventDateB:o,dueDateA:i,dueDateB:s}=n,l=["Scheduled","Active","Completed","Skipped"];return r===IH.DESC?e.text!==t.text?l.indexOf(e.text)-l.indexOf(t.text):"Scheduled"===e.text?$()(s).unix()-$()(i).unix():$()(o).unix()-$()(a).unix():r===IH.ASC?e.text!==t.text?l.indexOf(t.text)-l.indexOf(e.text):"Scheduled"===e.text?$()(s).unix()-$()(i).unix():$()(o).unix()-$()(a).unix():0},[it.CO.COORDINATE]:()=>null,[it.CO.POLYGON]:()=>null,[it.CO.FILE_RESOURCE]:()=>null,[it.CO.IMAGE]:()=>null,[it.CO.UNKNOWN]:()=>null};var CH=r(92379);const OH=e=>{let{onCreateNew:t,stageWriteAccess:r,eventCount:a,repeatable:o,preventAddingEventActionInEffect:i,eventName:s}=e;const{isDisabled:l,tooltipContent:d}=(0,y.useMemo)((()=>r?i?{isDisabled:!0,tooltipContent:n.A.t("You can't add any more {{ programStageName }} events",{programStageName:s,interpolation:{escapeValue:!1}})}:!o&&a>0?{isDisabled:!0,tooltipContent:n.A.t("This stage can only have one event")}:{isDisabled:!1,tooltipContent:""}:{isDisabled:!0,tooltipContent:n.A.t("You do not have access to create events in this stage",{programStageName:s,interpolation:{escapeValue:!1}})}),[a,s,i,o,r]);return y.createElement(aI,{enabled:l,content:d,closeDelay:50},y.createElement(ra.$,{small:!0,secondary:!0,icon:y.createElement(CH.A,null),onClick:t,dataTest:"create-new-button",disabled:l},n.A.t("New {{ eventName }} event",{eventName:s,interpolation:{escapeValue:!1}})))},NH=[{type:it.CO.STATUS,resolveValue:e=>{const{status:t,options:r}=(e=>{const t=$()().startOf("day"),r=$()(e.scheduledAt),n=r.from(t),a=r.diff(t,"days");return gH(e)?{status:Es.OVERDUE,options:a?n:void 0}:"VISITED"===e.status?{status:Es.ACTIVE,options:void 0}:e.status===Es.SCHEDULE?e.scheduledAt&&a?a<14?{status:Es.SCHEDULE,options:n}:{status:Es.SCHEDULE,options:_t(r)}:{status:Es.SCHEDULE,options:void 0}:{status:e.status,options:void 0}})(e),n=[Es.COMPLETED].includes(t);return{isNegative:[Es.OVERDUE].includes(t),isPositive:n,text:ys(r)[t],status:t}}},{type:it.CO.DATE},{type:"ASSIGNEE"},{type:it.CO.TEXT,resolveValue:e=>y.createElement(gi,{orgUnitId:e.orgUnit})},{type:it.CO.DATE},{type:it.CO.UNKNOWN,resolveValue:e=>y.createElement(mH,{event:e})}],RH=e=>[{header:n.A.t("Status"),sortDirection:IH.DEFAULT,isPredefined:!0},{header:e.formFoundation.getLabel("occurredAt"),sortDirection:IH.DEFAULT,isPredefined:!0},{header:n.A.t("Assigned to"),sortDirection:IH.DEFAULT,isPredefined:!0},{header:n.A.t("Organisation unit"),sortDirection:IH.DEFAULT,isPredefined:!0},{header:e.formFoundation.getLabel("scheduledAt"),sortDirection:IH.DEFAULT,isPredefined:!0},{header:"",sortDirection:null,isPredefined:!0}],wH=[{id:"status"},{id:"occurredAt"},{id:"assignedUser"},{id:"orgUnit"},{id:"scheduledAt"},{id:"notes"}].map(((e,t)=>({...e,...NH[t]}))),_H=(e,t,r)=>t.reduce(((t,n)=>{var a,o;let{id:i,type:s}=n;const l=null===(a=r.find((t=>t.type===s&&t.eventId===e)))||void 0===a||null===(o=a.ids)||void 0===o?void 0:o[i];return t[i]=s&&l?Et(l,s):void 0,t}),{}),PH=(e,t)=>{const[r,n]=(0,y.useState)(null),[a,o]=(0,y.useState)(null),[i,s]=(0,y.useState)(!0),l=(0,A.ow)(),{baseUrl:d,apiVersion:c}=(0,A.UK)(),u=(0,y.useMemo)((()=>t.map((e=>{let{orgUnit:t}=e;return t}))),[t]),{orgUnitNames:p,error:m}=ui(u),g=(0,y.useCallback)((async()=>{try{s(!0);const r=D(l.query.bind(l)),a=(0,j.c$)(d,`api/${c}`),o=await(async(e,t,r,n)=>{const a=e.reduce(((e,r)=>(r.dataValues.forEach((n=>{const{dataElement:a,value:o}=n,{type:i}=t.find((e=>e.id===a))||{};if(!i)return;const s=e.find((e=>e.type===i&&e.eventId===r.event));s?s.ids[a]=o:e.push({type:i,eventId:r.event,ids:{[a]:o}})})),e)),[]);for await(const o of a)o.ids=await uH(o,r,n);return a})(t,e,r,a),i=[];for(const n of t){const t=n.event,r=wH.reduce(((e,t)=>(e[t.id]=Et(hH(n,t),t.type),e)),{}),a=_H(t,e,o);i.push({id:t,pendingApiResponse:n.pendingApiResponse,...r,...a})}n(i)}catch(r){o(r)}finally{s(!1)}}),[t,e,l,d,c]);return(0,y.useEffect)((()=>{p?g():m&&o(m)}),[p,g,o,m]),{value:r,error:a,loading:i}},kH=(e,t)=>Object.keys(e).reduce(((r,n)=>{const{type:a}=wH.find((e=>e.id===n))||{},o=t.find((e=>e.id===n)),{type:i}=o||{},s=e[n];if(a)r[n]=Ii(s,a);else if(i){const e=((e,t)=>{if(!e)return null;const r=new it.fq((r=>{r.id=e.id,r.type=t}));if(e.options){const t=Object.keys(e.options).map((t=>new it.c$((r=>{r.text=e.options[t],r.value=t})))),n=new it.G2(e.id,t);r.optionSet=n}return r})(o,i);r[n]=Ii(s,i,e)}else r[n]=s;return r}),{});var DH=r(29233);const UH=e=>{let{setActionsOpen:t,setDeleteModalOpen:r}=e;return y.createElement(y.Fragment,null,y.createElement(bh.D,{dense:!0,icon:y.createElement(hI.A,{color:vn.T.red600}),label:n.A.t("Delete"),onClick:()=>{r(!0),t(!1)}}))};var LH=r(86816);const FH=e=>{let{eventId:t,eventDetails:r,pendingApiResponse:a,setActionsOpen:o,onUpdateEventStatus:i}=e;const s=(0,A.ow)(),{show:l}=(0,A.MW)((e=>{let{message:t}=e;return t}),{critical:!0}),{mutate:d}=(0,Zo.useMutation)((e=>{let{status:n}=e;return s.mutate({resource:"tracker?async=false&importStrategy=UPDATE",type:"create",data:{events:[{...r,event:t,status:n}]}})}),{onMutate:e=>{const n=MH[e.status],a=r.status;return n&&i(t,n),{previousStatus:a}},onError:(e,r,a)=>{l({message:n.A.t("An error occurred when updating event status")}),S().error((0,j.px)("An error occurred when updating event status")({error:e,payload:r,context:a})),a&&i(t,a.previousStatus)}}),c=e=>{o(!1),!a&&d({status:e})};return r.status===MH.SKIPPED?y.createElement(bh.D,{dense:!0,icon:y.createElement(LH.A,null),label:n.A.t("Unskip"),onClick:()=>c(MH.SCHEDULE)}):y.createElement(bh.D,{dense:!0,icon:y.createElement(gI.A,null),label:n.A.t("Skip"),onClick:()=>c(MH.SKIPPED)})},xH=e=>{let{setDeleteModalOpen:t,pendingApiResponse:r,eventId:a,teiId:o,programId:i,enrollmentId:s,onDeleteEvent:l,onRollbackDeleteEvent:d}=e;const{show:c}=(0,A.MW)((e=>{let{message:t}=e;return t}),{critical:!0}),u=(0,A.ow)(),p=(0,Zo.useQueryClient)(),m=[ei,"stages&event","enrollmentData",o,i,s],{mutate:g}=(0,Zo.useMutation)((()=>u.mutate({resource:"tracker?async=false&importStrategy=DELETE",type:"create",data:{events:[{event:a}]}})),{onMutate:()=>{var e,t;const r=p.getQueryData(m),n=null===r||void 0===r||null===(e=r.enrollments)||void 0===e||null===(t=e.flatMap((e=>e.events)))||void 0===t?void 0:t.find((e=>e.event===a));return l(a),n},onError:(e,t,r)=>{c({message:n.A.t("An error occurred while deleting the event")}),S().error((0,j.px)("An error occurred while deleting the event")({apiError:e,payload:t})),r&&d(r)}});return y.createElement(N.a,{onClose:()=>t(!1),small:!0},y.createElement(Ip.w,null,n.A.t("Delete event")),y.createElement(R.$,null,y.createElement("p",null,n.A.t("Deleting an event is permanent and cannot be undone. Are you sure you want to delete this event?"))),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{onClick:()=>t(!1)},n.A.t("No, cancel")),y.createElement(ra.$,{destructive:!0,onClick:()=>!r&&g({eventId:a})},n.A.t("Yes, delete event")))))},MH={ACTIVE:"ACTIVE",COMPLETED:"COMPLETED",SKIPPED:"SKIPPED",SCHEDULE:"SCHEDULE"},VH=(0,I.withStyles)({row:{maxWidth:"100%",whiteSpace:"nowrap",cursor:"pointer"},rowDisabled:{cursor:"not-allowed",opacity:.5}})((e=>{let{id:t,pendingApiResponse:r,eventDetails:n,cells:a,stageWriteAccess:o,onDeleteEvent:i,onRollbackDeleteEvent:s,onUpdateEventStatus:l,teiId:d,programId:c,enrollmentId:u,classes:p}=e;const[m,g]=(0,y.useState)(!1),[h,E]=(0,y.useState)(!1);return y.createElement(SR.J,{className:r?p.rowDisabled:p.row,key:t},a,y.createElement(IR.B,null,y.createElement(y.Fragment,null,y.createElement(wI,{open:m,onClick:()=>g((e=>!e)),dataTest:"overflow-button",secondary:!0,small:!0,icon:y.createElement(DH.A,null),disabled:r||!o,component:y.createElement(AI.n,{dense:!0,dataTest:"overflow-menu"},(n.status===MH.SCHEDULE||n.status===MH.SKIPPED)&&y.createElement(FH,{eventId:t,eventDetails:n,setActionsOpen:g,pendingApiResponse:r,onUpdateEventStatus:l}),y.createElement(UH,{setActionsOpen:g,setDeleteModalOpen:E}))}),h&&y.createElement(xH,{eventId:t,pendingApiResponse:r,teiId:d,programId:c,enrollmentId:u,onDeleteEvent:i,onRollbackDeleteEvent:s,setActionsOpen:g,setDeleteModalOpen:E}))))})),jH={row:{maxWidth:"100%",whiteSpace:"nowrap",cursor:"pointer"},container:{display:"flex",flexDirection:"column"},scrollBox:{overflowX:"auto",overflow:"hidden"},hidenButton:{display:"none !important"},icon:{position:"absolute",left:yn.U.dp8,top:"1px"},label:{paddingLeft:yn.U.dp32},table:{border:"none !important"},tableToolbar:{borderLeft:"none !important",borderBottom:"none !important",borderRight:"none !important",borderTop:`1px solid ${vn.T.grey300} !important`,width:"100%",padding:"0 !important"},toolbarContent:{width:"100%"},showMoreButton:{width:"100%",border:"none",background:vn.T.grey100,color:vn.T.grey800,fontSize:"13px",height:"24px",borderBottom:`1px solid ${vn.T.grey300}`,"&:hover":{background:vn.T.grey200,color:vn.T.grey900,cursor:"pointer"},"&:focus":{outline:`3px solid ${vH.w.focus}`}},newButton:{margin:`${yn.Q.dp8} ${yn.Q.dp12}`}},GH=(0,I.withStyles)(jH)((e=>{const{events:t,eventName:r,stageId:a,programId:o,dataElements:i,hideDueDate:s=!1,repeatable:l=!1,enableUserAssignment:d=!1,onEventClick:c,onDeleteEvent:u,onUpdateEventStatus:p,onRollbackDeleteEvent:m,onViewAll:g,onCreateNew:h,hiddenProgramStage:E,classes:v}=e,f={columnName:"status",sortDirection:IH.DESC},{stage:I}=(0,VO.RE)(o,a),b=((e,t,r,n)=>{const a=(0,y.useMemo)((()=>{const a=e.reduce(((e,t)=>{const{id:r,name:n,formName:a,type:o,optionSet:i}=t;if(!e.find((e=>e.id===r))){if(Vi(o,i))return S().error((0,j.px)("could not create the metadata because a MULIT_TEXT without associated option sets was found")({currDataElement:t})),e;e.push({id:r,header:a||n,type:o,sortDirection:IH.DEFAULT})}return e}),[]);return[...(o={formFoundation:n},wH.map(((e,t)=>({...e,...RH(o)[t]})))).filter((e=>(r||"assignedUser"!==e.id)&&(!t||"scheduledAt"!==e.id))),...a];var o}),[e,t,r,n]);return a})(i,s,d,null===I||void 0===I?void 0:I.stageForm),{loading:T,value:A,error:C}=PH(i,t),[{columnName:O,sortDirection:N},R]=(0,y.useState)(f),[w,_]=(0,y.useState)(5),P=e=>e.id===O?N:e.sortDirection,k=e=>{let{name:t,direction:r}=e;r===IH.DEFAULT&&t!==f.columnName?R(f):R({columnName:t,sortDirection:r})},D=(0,y.useCallback)((()=>{g(a)}),[g,a]),U=(0,y.useCallback)((()=>{h(a)}),[h,a]),L=(0,y.useCallback)((()=>{const e=Math.min(t.length,w+5);_(e)}),[t,w,_]);return C?y.createElement("div",null,n.A.t("Events could not be retrieved. Please try again later.")):y.createElement("div",{className:v.container},y.createElement("div",{className:v.scrollBox},y.createElement(TR.b,{className:v.table},y.createElement(AR.n,null,function(){const e=b.map((e=>y.createElement(fR.w,{key:e.id,name:e.id,sortDirection:P(e),onSortIconClick:e.sortDirection&&k},e.header)));return y.createElement(SR.J,{className:v.row},e,y.createElement(fR.w,null))}()),y.createElement(CR.B,null,!A||T?null:A.sort(((e,t)=>{const{type:r}=b.find((e=>e.id===O))||{};return(e=>{let{dataA:t,dataB:r,type:n,columnName:a,direction:o}=e;n||S().error((0,j.px)("Type is not defined")({dataA:t,dataB:r}));const i=t[a],s=r[a],l={eventDateA:t.occurredAt,eventDateB:r.occurredAt,dueDateA:t.scheduledAt,dueDateB:r.scheduledAt};return AH[n](i,s,o,l)})({dataA:e,dataB:t,type:r,columnName:O,direction:N})})).slice(0,w).map((e=>kH(e,i))).map((e=>{var r,a;const i=b.map((t=>{let{id:r}=t;return y.createElement(Xo.m,{key:`${r}-${e.id}`,content:n.A.t("To open this event, please wait until saving is complete"),closeDelay:50},(t=>{let{onMouseOver:n,onMouseOut:a,ref:o}=t;return y.createElement(IR.B,{key:r,onClick:()=>!e.pendingApiResponse&&c(e.id),ref:t=>{t&&(e.pendingApiResponse?(t.onmouseover=n,t.onmouseout=a,o.current=t):(t.onmouseover=null,t.onmouseout=null))}},y.createElement("div",null,e[r]))}))})),s=t.find((t=>t.event===e.id));return s?y.createElement(VH,{id:e.id,pendingApiResponse:e.pendingApiResponse,eventDetails:s,teiId:s.trackedEntity,stageWriteAccess:null===I||void 0===I||null===(r=I.access)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.write,programId:o,enrollmentId:s.enrollment,cells:i,onEventClick:c,onDeleteEvent:u,onRollbackDeleteEvent:m,onUpdateEventStatus:p}):(S().error((0,j.px)("Event details not found")({row:e})),null)}))))),y.createElement(fH.e,{className:v.tableToolbar,position:"bottom"},y.createElement("div",{className:v.toolbarContent},y.createElement("div",{className:v.footerToolbar},A&&!T&&t.length>5&&w<t.length?y.createElement("button",{"data-test":"show-more-button",className:v.showMoreButton,onClick:L},n.A.t("Show {{ rest }} more",{rest:Math.min(t.length-w,5)})):null,t.length>1?y.createElement(ra.$,{small:!0,secondary:!0,dataTest:"view-all-button",className:v.hidenButton,onClick:D},n.A.t("Go to full {{ eventName }}",{eventName:r,interpolation:{escapeValue:!1}})):null,(()=>{var e,n;return y.createElement("div",{className:v.newButton},y.createElement(OH,{eventCount:t.length,onCreateNew:U,preventAddingEventActionInEffect:E,repeatable:l,stageWriteAccess:null===I||void 0===I||null===(e=I.access)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.write,eventName:r}))})()))))}));function BH(){return BH=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},BH.apply(this,arguments)}const $H={overview:{marginLeft:yn.U.dp16,marginRight:yn.U.dp16,marginBottom:yn.U.dp24},buttonContainer:{margin:`0 ${yn.U.dp12}px ${yn.U.dp8}px ${yn.U.dp12}px`},buttonRow:{display:"flex",alignItems:"center"}},WH=(0,I.withStyles)($H)((e=>{let{stage:t,events:r,classes:n,className:a,onCreateNew:o,ruleEffects:i,...s}=e;const[l,d]=(0,y.useState)(!0),{id:c,name:u,icon:p,description:m,dataElements:g,hideDueDate:h,repeatable:E,enableUserAssignment:v}=t,f=((e,t)=>Boolean(null===e||void 0===e?void 0:e.find((e=>"HIDEPROGRAMSTAGE"===e.type&&e.id===t))))(i,c),I=f&&0===r.length,b=(0,y.useCallback)((()=>d(!0)),[d]),S=(0,y.useCallback)((()=>d(!1)),[d]);return I?null:y.createElement("div",{"data-test":"stage-content",className:er()(n.overview,a)},y.createElement(Ib,{header:y.createElement(yH,{title:u,icon:p,description:m,events:r}),onOpen:b,onClose:S,open:l},r.length>0?y.createElement(GH,BH({stageId:c,eventName:u,events:r,dataElements:g,hideDueDate:h,repeatable:E,enableUserAssignment:v,onCreateNew:o,hiddenProgramStage:f},s)):y.createElement("div",{className:n.buttonContainer},y.createElement(OH,{onCreateNew:()=>o(c),stageWriteAccess:t.dataAccess.write,eventCount:r.length,repeatable:E,preventAddingEventActionInEffect:f,eventName:u}))))}));function HH(){return HH=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HH.apply(this,arguments)}const zH=(0,qd.compose)(Dp(),(0,I.withStyles)({}))((e=>{let{stages:t,events:r,classes:n,...a}=e;const o=(0,y.useMemo)((()=>t.reduce(((e,t)=>(e[t.id]=e[t.id]||[],e)),r.reduce(((e,t)=>{const r=t.programStage;return e[r]?e[r].push(t):e[r]=[t],e}),{}))),[t,r]);return y.createElement(y.Fragment,null,t.filter((e=>e.dataAccess.read)).map((e=>y.createElement(WH,HH({events:o[e.id],key:e.id,stage:e,className:n.stage},a)))))}));function YH(){return YH=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YH.apply(this,arguments)}const qH="WidgetSelectFindMode",KH="batchOpenTeiSearchWidget",QH=e=>({attributeIds:e.flatMap((e=>{var t,r;const{fromConstraint:n,toConstraint:a}=e;return[...(null===(t=n.trackerDataView)||void 0===t?void 0:t.attributes)||[],...(null===(r=a.trackerDataView)||void 0===r?void 0:r.attributes)||[]]})).reduce(((e,t)=>(e[t]=!0,e)),{}),dataElementIds:e.flatMap((e=>{var t,r;const{fromConstraint:n,toConstraint:a}=e;return[...(null===(t=n.trackerDataView)||void 0===t?void 0:t.dataElements)||[],...(null===(r=a.trackerDataView)||void 0===r?void 0:r.dataElements)||[]]})).reduce(((e,t)=>(e[t]=!0,e)),{})}),XH=(e,t,r)=>{let{relationshipType:n,elementType:a}=r;return(e||[]).map((e=>{const r=t[e];return r?r.valueType?{id:e,type:r.valueType,displayName:r.displayName,options:r.options}:(S().error((0,j.px)(`cached ${a} is missing value type`)({elementId:e,element:r})),null):(S().error((0,j.px)(`${a} from relationshipType not found in cache`)({elementId:e,relationshipType:n})),null)})).filter((e=>e))},JH="ATTRIBUTE",ZH="DATA_ELEMENT",ez=e=>{let{relationshipTypes:t=[],attributes:r,dataElements:n}=e;const a=r.reduce(((e,t)=>{let{id:r,valueType:n,displayName:a,optionSet:o}=t;return e[r]={valueType:n,displayName:a,options:null===o||void 0===o?void 0:o.options},e}),{}),o=n.reduce(((e,t)=>{let{id:r,valueType:n,displayName:a,optionSet:o}=t;return e[r]={valueType:n,displayName:a,options:null===o||void 0===o?void 0:o.options},e}),{});return t.map((e=>{var t,r,n,i;const{fromConstraint:s,toConstraint:l}=e,d=XH(null===(t=s.trackerDataView)||void 0===t?void 0:t.attributes,a,{relationshipType:e,elementType:JH}),c=XH(null===(r=l.trackerDataView)||void 0===r?void 0:r.attributes,a,{relationshipType:e,elementType:JH}),u=XH(null===(n=s.trackerDataView)||void 0===n?void 0:n.dataElements,o,{relationshipType:e,elementType:ZH}),p=XH(null===(i=l.trackerDataView)||void 0===i?void 0:i.dataElements,o,{relationshipType:e,elementType:ZH});return{...e,fromConstraint:{...s,trackerDataView:{attributes:d,dataElements:u}},toConstraint:{...l,trackerDataView:{attributes:c,dataElements:p}}}})).filter((e=>e))},tz=async(e,t)=>{const r=e.reduce(((e,t)=>{let{optionSet:r}=t;return r&&(e[r.id]=!0),e}),{}),n=await t.getAll(z.OPTION_SETS,{predicate:e=>{let{id:t}=e;return r[t]},project:e=>{let{id:t,options:r}=e;return{id:t,options:r.map((e=>{let{code:t,displayName:r}=e;return{code:t,name:r}}))}}});return n.length?e.map((e=>{if(e.optionSet){const t=n.find((t=>{let{id:r}=t;return r===e.optionSet.id}));return t?{...e,optionSet:{...e.optionSet,options:t.options}}:(S().error((0,j.px)(`OptionSet with id ${e.optionSet.id} not found in indexedDB.`)({element:e})),e)}return e})):e},rz=async()=>{const e=ve(),t=await e.getAll(z.RELATIONSHIP_TYPES,{predicate:e=>{let{access:t}=e;return t.data.read}}),{dataElementIds:r,attributeIds:n}=QH(t),a=await e.getAll(z.TRACKED_ENTITY_ATTRIBUTES,{predicate:e=>{let{id:t}=e;return n[t]},project:e=>{let{id:t,valueType:r,displayName:n,optionSet:a}=e;return{id:t,valueType:r,displayName:n,optionSet:a}}}),o=await e.getAll(z.DATA_ELEMENTS,{predicate:e=>{let{id:t}=e;return r[t]},project:e=>{let{id:t,valueType:r,displayName:n,optionSet:a}=e;return{id:t,valueType:r,displayName:n,optionSet:a}}}),i=await tz(a,e),s=await tz(o,e);return ez({relationshipTypes:t,attributes:i,dataElements:s})};var nz=r(96397);const az=Object.freeze({PROGRAM_STAGE_INSTANCE:"PROGRAM_STAGE_INSTANCE",TRACKED_ENTITY_INSTANCE:"TRACKED_ENTITY_INSTANCE",PROGRAM_INSTANCE:"PROGRAM_INSTANCE"}),oz={[az.TRACKED_ENTITY_INSTANCE]:()=>[{id:"trackedEntityTypeName",displayName:n.A.t("Type"),convertValue:e=>e},{id:"relationshipCreatedAt",displayName:n.A.t("Created date"),convertValue:e=>Ii(Et(e,it.CO.DATE),it.CO.DATE)}],[az.PROGRAM_STAGE_INSTANCE]:()=>[{id:"programStageName",displayName:n.A.t("Program stage name"),convertValue:e=>e},{id:"relationshipCreatedAt",displayName:n.A.t("Created date"),convertValue:e=>Ii(Et(e,it.CO.DATE),it.CO.DATE)}]},iz=(e,t,r)=>{var n,a,o,i;return(null===(n=e.trackedEntity)||void 0===n?void 0:n.trackedEntity)===r||(null===(a=e.event)||void 0===a?void 0:a.event)===r?t:(null===(o=t.trackedEntity)||void 0===o?void 0:o.trackedEntity)===r||(null===(i=t.event)||void 0===i?void 0:i.event)===r?e:(S().error((0,j.px)("Could not determine linked entity")({fromEntity:e,toEntity:t,sourceId:r})),null)},sz=(e,t,r)=>(0,y.useMemo)((()=>null!==r&&void 0!==r&&r.length&&null!==t&&void 0!==t&&t.length?r.sort(((e,t)=>$()(t.createdAt).diff($()(e.createdAt)))).reduce(((r,n)=>{const{relationship:a,relationshipType:o,from:i,to:s,pendingApiResponse:l,createdAt:d}=n,c=t.find((e=>e.id===o));if(!c)return S().error((0,j.px)("Could not find relationshipType")({relationshipTypeId:o,relationshipTypes:t})),r;const u=iz(i,s,e);if(!u)return r;if(!c.bidirectional&&u===i)return r;const p=((e,t,r)=>e.trackedEntity?((e,t,r)=>{let{attributes:n,trackedEntity:a}=e,{relationshipCreatedAt:o,relationshipId:i}=t;return{id:a,values:n.reduce(((e,t)=>(e[t.attribute]=t.value,e)),{}),baseValues:{pendingApiResponse:r,relationshipCreatedAt:o,relationshipId:i},navigation:{trackedEntityId:a}}})(e.trackedEntity,t,r):e.event?((e,t,r)=>{let{dataValues:n,event:a,program:o}=e,{relationshipCreatedAt:i,relationshipId:s}=t;return{id:a,values:n.reduce(((e,t)=>(e[t.dataElement]=t.value,e)),{}),baseValues:{relationshipCreatedAt:i,relationshipId:s,pendingApiResponse:r},navigation:{eventId:a,programId:o}}})(e.event,t,r):e.enrollment?(S().warn((0,j.px)("Linked entities of type enrollment are not currently supported")({apiLinkedEntity:e})),null):(S().error((0,j.px)("Unsupported linked entity type")({apiLinkedEntity:e})),null))(u,{relationshipCreatedAt:d,relationshipId:a},l);if(!p)return r;const m=`${o}-${u===i?"from":"to"}`,g=r.find((e=>{let{id:t}=e;return t===m}));if(g)g.linkedEntities=[...g.linkedEntities,p];else{const{constraint:e,name:t}=u===i?{constraint:c.fromConstraint,name:c.toFromName}:{constraint:c.toConstraint,name:c.fromToName},n=(e=>{var t;let r,{relationshipEntity:n,trackerDataView:a}=e;return n===az.TRACKED_ENTITY_INSTANCE?r=a.attributes:n===az.PROGRAM_STAGE_INSTANCE&&(r=a.dataElements),null!==(t=r)&&void 0!==t&&t.length||(r=oz[n]()),r})(e),a=((e,t)=>{let{relationshipEntity:r,program:n,programStage:a,trackedEntityType:o}=e;return r===az.TRACKED_ENTITY_INSTANCE?{navigation:{programId:null===n||void 0===n?void 0:n.id},display:{trackedEntityTypeName:o.name,showDeleteButton:t.data.write}}:r===az.PROGRAM_STAGE_INSTANCE?{navigation:{},display:{programStageName:a.name,showDeleteButton:t.data.write&&!1}}:{navigation:{},display:{}}})(e,c.access);r.push({id:m,name:t||c.displayName,linkedEntities:[p],columns:n,context:a})}return r}),[]):[]),[r,t,e]),lz=e=>{let{columns:t,context:r}=e;return y.createElement(AR.n,null,y.createElement(SR.J,null,t.map((e=>{let{id:t,displayName:r}=e;return y.createElement(fR.w,{key:t},r)})),r.display.showDeleteButton&&y.createElement(fR.w,null)))},dz=(0,I.withStyles)({tableCell:{display:"flex",justifyContent:"center"}})((e=>{let{handleDeleteRelationship:t,disabled:r,classes:a}=e;const[o,i]=(0,y.useState)(!1);return y.createElement(y.Fragment,null,y.createElement(IR.B,{className:a.tableCell},y.createElement(Bo,{onClick:()=>{r||i(!0)},dataTest:"delete-relationship-button"},y.createElement(hI.A,{color:vn.T.red600}))),o&&y.createElement(N.a,{hide:!o,onClose:()=>i(!1),dataTest:"delete-relationship-modal"},y.createElement(Ip.w,null,n.A.t("Delete relationship")),y.createElement(R.$,null,n.A.t("Deleting the relationship is permanent and cannot be undone. Are you sure you want to delete this relationship?")),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{onClick:()=>i(!1)},n.A.t("No, cancel")),y.createElement(ra.$,{destructive:!0,dataTest:"delete-relationship-confirmation-button",onClick:()=>{t(),i(!1)}},n.A.t("Yes, delete relationship"))))))})),cz=(0,I.withStyles)({row:{cursor:"pointer"},rowDisabled:{cursor:"not-allowed",opacity:.5}})((e=>{let{linkedEntities:t,columns:r,onLinkedRecordClick:a,context:o,onDeleteRelationship:i,classes:s}=e;return y.createElement(CR.B,{dataTest:"relationship-table-body"},t.map((e=>{let{id:t,values:l,baseValues:d,navigation:c}=e;const{pendingApiResponse:u,relationshipId:p}=d||{};return y.createElement(SR.J,{key:t,dataTest:"relationship-table-row",className:u?s.rowDisabled:s.row},r.map((e=>{var r;let{id:i,type:p,options:m,convertValue:g}=e;const h=p?bi(Et(l[i],p),p,m):g(null!==(r=null===d||void 0===d?void 0:d[i])&&void 0!==r?r:o.display[i]);return y.createElement(Xo.m,{key:`${t}-${i}`,content:n.A.t("To open this relationship, please wait until saving is complete"),closeDelay:50},(e=>{let{onMouseOver:r,onMouseOut:n,ref:l}=e;return y.createElement(IR.B,{className:s.row,key:`${t}-${i}`,onClick:()=>!u&&a({...o.navigation,...c}),ref:e=>{e&&(u?(e.onmouseover=r,e.onmouseout=n,l.current=e):(e.onmouseover=null,e.onmouseout=null))}},h)}))})),o.display.showDeleteButton&&y.createElement(dz,{handleDeleteRelationship:()=>i({relationshipId:p}),disabled:u}))})))})),uz={button:{marginTop:`${yn.Q.dp8}`},dataTableWrapper:{overflowY:"auto",whiteSpace:"nowrap"}},pz=(0,I.withStyles)(uz)((e=>{let{linkedEntities:t,columns:r,onLinkedRecordClick:a,onDeleteRelationship:o,context:i,classes:s}=e;const[l,d]=(0,y.useState)(5),c=(0,y.useMemo)((()=>t.slice(0,l)),[t,l]),u=t.length>l;return y.createElement("div",{className:s.dataTableWrapper},y.createElement(TR.b,null,y.createElement(lz,{columns:r,context:i}),y.createElement(cz,{linkedEntities:c,columns:r,onLinkedRecordClick:a,context:i,onDeleteRelationship:o})),u&&y.createElement(ra.$,{small:!0,secondary:!0,dataTest:"show-more-button",className:s.button,onClick:()=>{const e=Math.min(l+5,t.length);d(e)}},n.A.t("Show {{ rest }} more",{rest:Math.min(t.length-l,5)})))})),mz={container:{padding:`0 ${yn.Q.dp16} ${yn.Q.dp12} ${yn.Q.dp16}`},title:{fontWeight:500,fontSize:16,color:vn.T.grey800,paddingBottom:yn.U.dp16},wrapper:{paddingBottom:yn.U.dp16}},gz=(0,I.withStyles)(mz)((e=>{let{groupedLinkedEntities:t,onLinkedRecordClick:r,onDeleteRelationship:n,classes:a}=e;return y.createElement("div",{"data-test":"relationships",className:a.container},null===t||void 0===t?void 0:t.map((e=>{const{id:t,name:o,linkedEntities:i,columns:s,context:l}=e;return y.createElement("div",{key:t,className:a.wrapper},y.createElement("div",{className:a.title},o),y.createElement(pz,{linkedEntities:i,columns:s,onLinkedRecordClick:r,onDeleteRelationship:n,context:l}))})))})),hz={resource:"tracker?importStrategy=DELETE&async=false",type:"create",data:e=>{let{relationshipId:t}=e;return{relationships:[{relationship:t}]}}},Ez={header:{display:"flex",alignItems:"center"},icon:{paddingRight:yn.Q.dp8}},yz=(0,I.withStyles)(Ez)((e=>{let{title:t,relationships:r,isLoading:a,sourceId:o,relationshipTypes:i,onLinkedRecordClick:s,children:l,classes:d}=e;const[c,u]=(0,y.useState)(!0),p=sz(o,i,r),{onDeleteRelationship:m}=(e=>{let{sourceId:t}=e;const r=(0,A.ow)(),a=(0,j.iT)(j.Gv.exportablePayload)?"relationships":"instances",o=(0,Zo.useQueryClient)(),{show:i}=(0,A.MW)(n.A.t("An error occurred while deleting the relationship."),{critical:!0}),{mutate:s}=(0,Zo.useMutation)((e=>{let{relationshipId:t}=e;return r.mutate(hz,{variables:{relationshipId:t}})}),{onMutate:e=>{let{relationshipId:r}=e;const n=o.getQueryData([ei,"relationships",t]),i=L(U.relationships,n),s=null===i||void 0===i?void 0:i.filter((e=>{let{relationship:t}=e;return t!==r}));return o.setQueryData([ei,"relationships",t],{[a]:s}),{prevRelationships:n}},onError:(e,r,n)=>{let{relationshipId:a}=r;S().error((0,j.px)("An error occurred while deleting the relationship")({error:e,relationshipId:a})),i(),null!==n&&void 0!==n&&n.prevRelationships&&o.setQueryData([ei,"relationships",t],n.prevRelationships)}});return{onDeleteRelationship:s}})({sourceId:o});return a?y.createElement(Ib,{header:y.createElement("div",{className:d.header},y.createElement("span",{className:d.icon},y.createElement(nz.A,null))),onOpen:()=>u(!0),onClose:()=>u(!1),open:c},y.createElement(_,{containerStyle:{height:"100px",marginBottom:"50px"}})):y.createElement("div",{"data-test":"tracked-entity-relationship-widget"},y.createElement(Ib,{header:y.createElement("div",{className:d.header},y.createElement("span",{className:d.icon},y.createElement(nz.A,null)),y.createElement("span",null,t),r&&y.createElement(Fp.v,{dense:!0},r.length)),onOpen:()=>u(!0),onClose:()=>u(!1),open:c},p&&y.createElement(gz,{groupedLinkedEntities:p,onLinkedRecordClick:s,onDeleteRelationship:m}),l))})),vz=Object.freeze({TRACKED_ENTITY:"trackedEntity",ENROLLMENT:"enrollment",EVENT:"event"}),fz=Object.freeze({SELECT_LINKED_ENTITY_METADATA:Object.freeze({value:1,id:"selectLinkedEntityMetadata"}),SELECT_RETRIEVER_MODE:Object.freeze({value:2,id:"selectRetrieverMode"}),FIND_EXISTING_LINKED_ENTITY:Object.freeze({value:3,id:"findExistingLinkedEntity"}),NEW_LINKED_ENTITY:Object.freeze({value:4,id:"newLinkedEntity"})}),Iz={container:{padding:`${yn.Q.dp8} 0`}},bz=(0,I.withStyles)({slash:{padding:5}})((e=>{let{classes:t}=e;return y.createElement("span",{className:t.slash},"/")})),Sz=e=>{let{currentStep:t,trackedEntityTypeName:r,onNavigate:a}=e;const o=n.A.t("New {{trackedEntityTypeName}} relationship",{trackedEntityTypeName:r&&r.toLowerCase()});return t.value>fz.SELECT_LINKED_ENTITY_METADATA.value?y.createElement(Mg,{onClick:a},o):y.createElement("span",null,o)},Tz=e=>{let{currentStep:t,onNavigate:r,linkedEntityMetadataName:n}=e;return t.value<fz.SELECT_RETRIEVER_MODE.value?null:y.createElement(y.Fragment,null,y.createElement(bz,null),t.value>fz.SELECT_RETRIEVER_MODE.value?y.createElement(Mg,{onClick:r},n):y.createElement("span",null,n))},Az=e=>{let{currentStep:t}=e;const r=(0,y.useMemo)((()=>t.id===fz.NEW_LINKED_ENTITY.id?n.A.t("Register"):t.id===fz.FIND_EXISTING_LINKED_ENTITY.id?n.A.t("Search"):null),[t.id]);return r?y.createElement(y.Fragment,null,y.createElement(bz,null),y.createElement("span",null,r)):null},Cz=(0,I.withStyles)(Iz)((e=>{let{currentStep:t,onNavigate:r,linkedEntityMetadataName:n,trackedEntityTypeName:a,classes:o}=e;return y.createElement("div",{className:o.container},y.createElement(Sz,{currentStep:t,trackedEntityTypeName:a,onNavigate:()=>r(fz.SELECT_LINKED_ENTITY_METADATA)}),y.createElement(Tz,{currentStep:t,linkedEntityMetadataName:n,onNavigate:()=>r(fz.SELECT_RETRIEVER_MODE)}),y.createElement(Az,{currentStep:t}))})),Oz=Object.freeze({FROM:"FROM",TO:"TO"}),Nz=(e,t)=>!t||!e||t.includes(e),Rz=(()=>{const e=(e,t)=>t?e.includes(t)?{programMatch:!0,noProgram:!1}:{programMatch:!1,noProgram:!1}:{noProgram:!0,programMatch:!1};return(t,r,n)=>{if(!t)return[Oz.FROM,Oz.TO];const{programMatch:a,noProgram:o}=e(t,r),{programMatch:i,noProgram:s}=e(t,n);return a?[Oz.TO]:i?[Oz.FROM]:o&&s?[Oz.FROM,Oz.TO]:o?[Oz.TO]:s?[Oz.FROM]:[]}})(),wz=(e,t,r)=>(0,y.useMemo)((()=>e.filter((e=>{let{access:t}=e;return t.data.write})).map((e=>{let{fromConstraint:n,toConstraint:a,bidirectional:o,id:i,displayName:s,fromToName:l,toFromName:d}=e;if(n.relationshipEntity===az.TRACKED_ENTITY_INSTANCE&&a.relationshipEntity===az.TRACKED_ENTITY_INSTANCE){if(!o){const e=((e,t,r)=>{let{trackedEntityType:n,program:a}=e;const o=n.id,i=null===a||void 0===a?void 0:a.id;return Boolean(t===o&&Nz(i,r))})(n,t,r);if(!e)return null;const{trackedEntityType:o,program:d}=a;return{id:i,name:s,sides:[{programId:null===d||void 0===d?void 0:d.id,trackedEntityTypeId:o.id,trackedEntityName:o.name.toLowerCase(),targetSide:Oz.TO,name:null!==l&&void 0!==l?l:s}]}}const e=((e,t,r)=>{let{fromConstraint:n,toConstraint:a}=e;const{trackedEntityType:o}=n,{trackedEntityType:i}=a;var s,l;if(o.id===t&&i.id===t)return Rz(r,null===(s=n.program)||void 0===s?void 0:s.id,null===(l=a.program)||void 0===l?void 0:l.id);if(o.id===t||i.id===t){var d,c;const{programId:e,targetSide:i}=o.id===t?{programId:null===(d=n.program)||void 0===d?void 0:d.id,targetSide:Oz.TO}:{programId:null===(c=a.program)||void 0===c?void 0:c.id,targetSide:Oz.FROM};return Nz(e,r)?[i]:[]}return[]})({fromConstraint:n,toConstraint:a},t,r);return e.length?{id:i,name:s,sides:e.map((e=>{var t,r;const{trackedEntityTypeId:o,trackedEntityName:i,programId:s,name:c}=e===Oz.TO?{trackedEntityTypeId:a.trackedEntityType.id,trackedEntityName:a.trackedEntityType.name.toLowerCase(),programId:null===(t=a.program)||void 0===t?void 0:t.id,name:l}:{trackedEntityTypeId:n.trackedEntityType.id,trackedEntityName:n.trackedEntityType.name.toLowerCase(),programId:null===(r=n.program)||void 0===r?void 0:r.id,name:d};return{trackedEntityTypeId:o,trackedEntityName:i,programId:s,targetSide:e,name:c}}))}:null}return null})).filter((e=>e))),[e,t,r]),_z={container:{padding:yn.Q.dp16,paddingTop:0},typeSelector:{display:"flex",flexDirection:"column",gap:yn.Q.dp8,marginBottom:yn.Q.dp16},selectorButton:{display:"flex",flexDirection:"column",gap:yn.Q.dp4,marginBottom:yn.Q.dp8},title:{fontWeight:500,marginBottom:yn.Q.dp4},buttonContainer:{display:"flex",gap:yn.Q.dp8}},Pz=(0,I.withStyles)(_z)((e=>{let{applicableTypesInfo:t,onSelectLinkedEntityMetadata:r,classes:n}=e;return y.createElement("div",{className:n.container},y.createElement("div",{className:n.typeSelector},t.map((e=>{let{id:t,name:a,sides:o}=e;return y.createElement("div",{key:t,className:n.selectorButton},y.createElement("div",{className:n.title},a),y.createElement("div",null,y.createElement("div",{className:n.buttonContainer},o.map((e=>y.createElement(ra.$,{key:`${t}-${e.targetSide}`,onClick:()=>r({...e,relationshipId:t}),secondary:!0},e.name))))))}))))})),kz=e=>{let{relationshipTypes:t,trackedEntityTypeId:r,programId:n,onSelectLinkedEntityMetadata:a}=e;const o=wz(t,r,[n]),i=Pz;return y.createElement(i,{applicableTypesInfo:o,onSelectLinkedEntityMetadata:a})};var Dz=r(21844);const Uz={container:{padding:yn.U.dp16,paddingTop:0},retrieverSelector:{display:"flex",gap:yn.Q.dp8}},Lz=(0,I.withStyles)(Uz)((e=>{let{classes:t,onSearchSelected:r,onNewSelected:a,trackedEntityName:o}=e;return y.createElement("div",{className:t.container},y.createElement("div",{className:t.retrieverSelector},y.createElement(ra.$,{className:t.retrieverSelector,onClick:r},y.createElement(Dz.A,null),y.createElement("p",null,n.A.t("Link to an existing {{tetName}}",{tetName:o}))),y.createElement(ra.$,{className:t.retrieverSelector,onClick:a},y.createElement(CH.A,null),y.createElement("p",null,n.A.t("Create new")))))})),Fz="capture",xz={resource:"/tracker?async=false&importStrategy=CREATE",type:"create",data:e=>{let{apiData:t}=e;return t}},Mz=(0,I.withStyles)({container:{backgroundColor:"#FAFAFA",maxWidth:1200},bar:{color:"#494949",padding:"8px",display:"inline-block",fontSize:"14px",borderRadius:"4px",marginBottom:"10px",backgroundColor:"#E9EEF4"},linkText:{backgroundColor:"transparent",fontSize:"inherit",color:"inherit"}})((e=>{let{relationshipTypes:t,trackedEntityTypeId:r,programId:a,teiId:o,trackedEntityTypeName:i,orgUnitId:s,onCancel:l,onSave:d,renderTrackedEntitySearch:c,renderTrackedEntityRegistration:u,onSelectFindMode:p,classes:m}=e;const[g,h]=(0,y.useState)(fz.SELECT_LINKED_ENTITY_METADATA),[E,v]=(0,y.useState)(void 0),{addRelationship:f}=(e=>{let{teiId:t,onMutate:r,onSuccess:a}=e;const o=(0,Zo.useQueryClient)(),i=(0,j.iT)(j.Gv.exportablePayload)?"relationships":"instances",s=(0,A.ow)(),{show:l}=(0,A.MW)(n.A.t("An error occurred while adding the relationship"),{critical:!0}),{mutate:d}=(0,Zo.useMutation)((e=>{let{apiData:t}=e;return s.mutate(xz,{variables:{apiData:t}})}),{onError:(e,r)=>{l();const n=r.clientRelationship.relationship,a=o.getQueryData([Fz,"relationships",t]),s=L(U.relationships,a);if(0===s.length)return;const d=s.reduce(((e,t)=>(t.relationship===n||e.push(t),e)),[]);o.setQueryData([Fz,"relationships",t],{[i]:d})},onMutate:function(){r&&r(...arguments);const{clientRelationship:e}=arguments.length<=0?void 0:arguments[0];e&&o.setQueryData([Fz,"relationships",t],(t=>{const r=L(U.relationships,t),n=[e,...r];return{[i]:n}}))},onSuccess:async(e,r)=>{const n=e.bundleReport.typeReportMap.RELATIONSHIP.objectReports[0].uid,s=o.getQueryData([Fz,"relationships",t]),l=L(U.relationships,s);if(0===l.length)return;const d=l.map((e=>e.relationship===n?{...e,pendingApiResponse:!1}:e));o.setQueryData([Fz,"relationships",t],{[i]:d}),a&&a(e,r)}});return{addRelationship:d}})({teiId:o,onMutate:()=>d&&d()}),I=(0,y.useCallback)(((e,t)=>{if(!E)return;const{relationshipId:r,targetSide:n}=E,a=rR(),i=n===Oz.TO?{from:{trackedEntity:{trackedEntity:o}},to:{trackedEntity:{trackedEntity:e}}}:{from:{trackedEntity:{trackedEntity:e}},to:{trackedEntity:{trackedEntity:o}}},s={createdAt:(new Date).toISOString(),pendingApiResponse:!0,...i};if(t){const e=n.toLowerCase();s[e].trackedEntity={...s[e].trackedEntity,attributes:Object.keys(t).map((e=>({attribute:e,value:t[e]})))}}f({apiData:{relationships:[{relationshipType:r,relationship:a,...i}]},clientRelationship:{relationshipType:r,relationship:a,...s}})}),[f,E,o]),b=(0,y.useCallback)((e=>{var t,r,n;if(!E)return;const{relationshipId:a,targetSide:i}=E,s=rR(),l=i===Oz.TO?{from:{trackedEntity:{trackedEntity:o}},to:{trackedEntity:{trackedEntity:e.trackedEntity}}}:{from:{trackedEntity:{trackedEntity:e.trackedEntity}},to:{trackedEntity:{trackedEntity:o}}},d={relationship:s,relationshipType:a,createdAt:(new Date).toISOString(),pendingApiResponse:!0,...l,[i.toLowerCase()]:{trackedEntity:{attributes:null!==(t=e.attributes)&&void 0!==t?t:null===(r=e.enrollments)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.attributes,orgUnitId:e.orgUnit,trackedEntity:e.trackedEntity,trackedEntityType:e.trackedEntityType}}},c={apiData:{trackedEntities:[e],relationships:[{relationship:s,relationshipType:a,...l}]},clientRelationship:d};f(c)}),[f,E,o]),S=(0,y.useCallback)((e=>{h(e)}),[]),T=(0,y.useCallback)((e=>{v(e),h(fz.SELECT_RETRIEVER_MODE)}),[]),C=(0,y.useCallback)((()=>{E&&p&&p({findMode:"TEI_SEARCH",orgUnitId:s,relationshipConstraint:{programId:null===E||void 0===E?void 0:E.programId,trackedEntityTypeId:E.trackedEntityTypeId}}),h(fz.FIND_EXISTING_LINKED_ENTITY)}),[p,s,E]),O=(0,y.useCallback)((()=>{E&&p&&p({findMode:"TEI_REGISTER",orgUnitId:s,relationshipConstraint:{programId:null===E||void 0===E?void 0:E.programId,trackedEntityTypeId:E.trackedEntityTypeId}}),h(fz.NEW_LINKED_ENTITY)}),[p,s,E]),N=(0,y.useMemo)((()=>{if(g.id===fz.SELECT_LINKED_ENTITY_METADATA.id)return y.createElement(kz,{relationshipTypes:t,trackedEntityTypeId:r,programId:a,onSelectLinkedEntityMetadata:T});if(g.id===fz.SELECT_RETRIEVER_MODE.id&&null!==E&&void 0!==E&&E.trackedEntityName)return y.createElement(Lz,{onSearchSelected:C,onNewSelected:O,trackedEntityName:E.trackedEntityName});if(g.id===fz.FIND_EXISTING_LINKED_ENTITY.id){const{trackedEntityTypeId:e,programId:t}=E;if(c)return c(e,t,I)}if(g.id===fz.NEW_LINKED_ENTITY.id){const{trackedEntityTypeId:e,programId:t}=E;if(u)return u(e,t,b,I,l)}return y.createElement("div",null,n.A.t("Missing implementation step"))}),[g.id,T,O,C,l,b,I,a,t,u,c,E,r]);return y.createElement("div",{className:m.container},y.createElement("div",{className:m.bar},y.createElement(Mg,{onClick:l,className:m.linkText},n.A.t("Go back without saving relationship"))),y.createElement(Ib,{noncollapsible:!0,header:y.createElement(Cz,{currentStep:g,onNavigate:S,linkedEntityMetadataName:null===E||void 0===E?void 0:E.name,trackedEntityTypeName:i})},N))})),Vz=e=>{let{renderElement:t,...r}=e;return Da.createPortal(y.createElement(Mz,r),t)},jz={container:{padding:`0 ${yn.Q.dp16} ${yn.Q.dp24} ${yn.Q.dp16}`}},Gz=(0,I.withStyles)(jz)((e=>{let{renderElement:t,teiId:r,orgUnitId:a,programId:o,trackedEntityTypeName:i,relationshipTypes:s,trackedEntityTypeId:l,onCloseAddRelationship:d,onOpenAddRelationship:c,renderTrackedEntitySearch:u,renderTrackedEntityRegistration:p,onSelectFindMode:m,classes:g}=e;const[h,E]=(0,y.useState)(!1),v=(0,y.useCallback)((()=>{E(!1),d&&d()}),[d]),f=(0,y.useCallback)((()=>{E(!0),c&&c()}),[c]);return y.createElement("div",{className:g.container},y.createElement(ra.$,{onClick:f,small:!0,secondary:!0},n.A.t("New Relationship")),h&&y.createElement(Vz,{relationshipTypes:s,teiId:r,orgUnitId:a,trackedEntityTypeName:i,trackedEntityTypeId:l,programId:o,renderElement:t,onSave:v,onCancel:v,renderTrackedEntitySearch:u,renderTrackedEntityRegistration:p,onSelectFindMode:m}))})),Bz={resource:"relationshipTypes",params:{filter:"access.data.read:eq:true",fields:"id,displayName,fromToName,toFromName,access[data[read,write],read,write],fromConstraint[relationshipEntity,trackerDataView,trackedEntityType[id,name],program[id,name],programStage[id,name]],toConstraint[relationshipEntity,trackerDataView,trackedEntityType[id,name],program[id,name],programStage[id,name]]"}},$z=e=>{let{relationshipTypes:t,teiId:r,trackedEntityTypeId:a,programId:o,orgUnitId:i,addRelationshipRenderElement:s,onLinkedRecordClick:l,onOpenAddRelationship:d,onCloseAddRelationship:c,onSelectFindMode:u,renderTrackedEntitySearch:p,renderTrackedEntityRegistration:m}=e;const{data:g}=(e=>{const{data:t,isError:r,isLoading:n}=ni(["relationshipTypes"],Bz,{enabled:!(null!==e&&void 0!==e&&e.length),select:e=>{let{relationshipTypes:t}=e;return t}}),{attributeQuery:a,dataElementQuery:o}=(0,y.useMemo)((()=>{if(!t)return{};const{dataElementIds:e,attributeIds:r}=QH(t);return{attributeQuery:{resource:"trackedEntityAttributes",params:{fields:"id,displayName,valueType,optionSet[id,options[code,name]]",filter:`id:in:[${Object.keys(r).join(",")}]`,paging:!1}},dataElementQuery:{resource:"dataElements",params:{fields:"id,displayName,valueType,optionSet[id,options[code,name]]",filter:`id:in:[${Object.keys(e).join(",")}]`,paging:!1}}}}),[t]),{data:i}=ni(["attributes"],a,{enabled:!(null!==e&&void 0!==e&&e.length)&&!!a,select:e=>{let{trackedEntityAttributes:t}=e;return t}}),{data:s}=ni(["dataElements"],o,{enabled:!(null!==e&&void 0!==e&&e.length)&&!!o,select:e=>{let{dataElements:t}=e;return t}}),l=(0,y.useMemo)((()=>t&&i&&s?ez({relationshipTypes:t,attributes:i,dataElements:s}):null),[i,s,t]);return{data:null!==l&&void 0!==l?l:e,isError:r,isLoading:n}})(t),{data:h,isLoading:E}=(e=>{const t=(0,y.useMemo)((()=>({resource:"trackedEntityTypes",id:e,params:{fields:"displayName"}})),[e]),{data:r,isLoading:n,error:a}=ai(["trackedEntityTypeName",e],t,{enabled:!!e,select:e=>{let{displayName:t}=e;return t}});return{data:r,isLoading:n,error:a}})(a),{data:v,isError:f,isLoading:I}=(e=>{let{entityId:t,searchMode:r,relationshipTypes:n}=e;const a=(0,y.useMemo)((()=>({resource:"tracker/relationships",params:{[r]:t,fields:"relationship,relationshipType,createdAt,from[trackedEntity[trackedEntity,attributes,program,orgUnit,trackedEntityType],event[event,dataValues,program,orgUnit,orgUnitName,status,createdAt]],to[trackedEntity[trackedEntity,attributes,program,orgUnit,trackedEntityType],event[event,dataValues,program,orgUnit,orgUnitName,status,createdAt]]"}})),[t,r]);return ai(["relationships",t],a,{enabled:!!t,select:e=>{const r=L(U.relationships,e);return null!==n&&void 0!==n&&n.length&&null!==r&&void 0!==r&&r.length?r.reduce(((e,r)=>{const a=n.find((e=>e.id===r.relationshipType));if(!a)return e;const{from:o,to:i}=r,s=iz(o,i,t);return s&&(a.bidirectional||s!==o)?(e.push(r),e):e}),[]):[]}})})({entityId:r,searchMode:vz.TRACKED_ENTITY,relationshipTypes:g}),b=(0,y.useMemo)((()=>I||E),[I,E]);return f?y.createElement("div",null,n.A.t("Something went wrong while loading relationships. Please try again later.")):null!==g&&void 0!==g&&g.length?y.createElement(yz,{title:n.A.t("{{trackedEntityTypeName}} relationships",{trackedEntityTypeName:h,interpolation:{escapeValue:!1}}),isLoading:b,relationships:v,relationshipTypes:g,sourceId:r,onLinkedRecordClick:l},y.createElement(Gz,{teiId:r,renderElement:s,trackedEntityTypeName:h,relationshipTypes:g,trackedEntityTypeId:a,programId:o,orgUnitId:i,onOpenAddRelationship:d,onCloseAddRelationship:c,onSelectFindMode:u,renderTrackedEntitySearch:p,renderTrackedEntityRegistration:m})):null},Wz="TeiSearchRequestFilterOrgUnits",Hz="TeiSearchClearOrgUnitsFilter",zz="TeiSearchSetOrgUnitScope",Yz="TeiSearchSetOrgUnit";function qz(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Kz=hr()(nm()(hm()(Pm()(pm()(jp))))),Qz=hm()(Pm()(mp)),Xz={labelContainerStyle:{paddingTop:12,flexBasis:200},inputContainerStyle:{flexBasis:150}},Jz={labelContainerStyle:{paddingTop:13,flexBasis:200},inputContainerStyle:{flexBasis:150}},Zz=[{name:"All accessible",value:"ACCESSIBLE"},{name:"Selected",value:"SELECTED"}];class eY extends y.Component{constructor(){super(...arguments),qz(this,"onSelectOrgUnitScope",(e=>{e&&this.props.onSelectOrgUnitScope(this.props.searchId,e)})),qz(this,"onSetOrgUnit",(e=>{this.props.onSetOrgUnit(this.props.searchId,e)})),qz(this,"renderOrgUnitScopeSelector",(()=>{const{selectedOrgUnitScope:e}=this.props;return y.createElement(Qz,{options:Zz,label:"Organisation unit scope",styles:Jz,onSelect:this.onSelectOrgUnitScope,value:e})})),qz(this,"isValid",(()=>"ACCESSIBLE"===this.props.selectedOrgUnitScope||this.props.selectedOrgUnit)),qz(this,"getErrorMessage",(()=>!this.isValid()&&this.props.searchAttempted?n.A.t("Please select an organisation unit"):null)),qz(this,"handleFilterOrgUnits",(e=>{this.props.onFilterOrgUnits(this.props.searchId,e)})),qz(this,"renderOrgUnitField",(()=>{const{selectedOrgUnit:e,treeRoots:t,treeReady:r,treeKey:n,treeSearchText:a}=this.props;return y.createElement(Kz,{label:"Organisation unit",styles:Xz,searchText:a,roots:t,ready:r,treeKey:n,onBlur:this.onSetOrgUnit,value:e,validationAttempted:this.props.searchAttempted,errorMessage:this.getErrorMessage(),onSearch:this.handleFilterOrgUnits})}))}validateAndScrollToIfFailed(){const e=this.isValid();return e||this.goto(),e}goto(){if(this.gotoInstance){this.gotoInstance.scrollIntoView();const e=window.scrollY;e&&window.scroll(0,e-48)}}render(){const{selectedOrgUnitScope:e}=this.props;return y.createElement("div",{ref:e=>{this.gotoInstance=e}},this.renderOrgUnitScopeSelector(),"ACCESSIBLE"!==e&&this.renderOrgUnitField())}}function tY(){return tY=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tY.apply(this,arguments)}const rY=(0,gs.Ng)(((e,t)=>{const r=t.searchId,n=$m(r)||$m("searchRoots");return{selectedOrgUnit:e.teiSearch[r].selectedOrgUnit,selectedOrgUnitScope:e.teiSearch[r].selectedOrgUnitScope,treeRoots:n,treeSearchText:e.teiSearch[r].orgUnitsSearchText,treeReady:!e.teiSearch[r].orgUnitsLoading,treeKey:e.teiSearch[r].orgUnitsSearchText||"initial"}}),(e=>({onFilterOrgUnits:(t,r)=>{const n=r?((e,t)=>l(Wz)({searchId:e,searchText:t}))(t,r):(e=>l(Hz)({searchId:e}))(t);e(n)},onSetOrgUnit:(t,r)=>{e(((e,t)=>l(Yz)({searchId:e,orgUnit:t}))(t,r))},onSelectOrgUnitScope:(t,r)=>{e(((e,t)=>l(zz)({searchId:e,orgUnitScope:t}))(t,r))}})))((e=>{const{innerRef:t,...r}=e;return y.createElement(eY,tY({ref:t},r))}));function nY(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const aY=fm()(rY);class oY extends y.Component{constructor(){super(...arguments),nY(this,"validNumberOfAttributes",(()=>this.props.attributesWithValuesCount>=this.props.searchGroup.minAttributesRequiredToSearch)),nY(this,"handleSearchAttempt",(()=>{const{error:e,isValid:t}=this.validateForm();!e&&t?this.props.onSearch(this.props.id,this.props.searchGroupId):this.props.onSearchValidationFailed(this.props.id,this.props.searchGroupId)})),nY(this,"getUniqueSearchButtonText",(e=>`Search ${e.getElements()[0].formName}`)),nY(this,"renderOrgUnitSelector",(()=>y.createElement(aY,{innerRef:e=>{this.orgUnitSelectorInstance=e},searchId:this.props.searchId,searchAttempted:this.props.searchAttempted}))),nY(this,"renderMinAttributesRequired",(()=>{const{classes:e,searchAttempted:t,searchGroup:r}=this.props,a=t&&!this.validNumberOfAttributes(),o=er()(e.minAttributesRequired,{[e.minAttribtuesRequiredInvalid]:a});return y.createElement("div",{className:o},n.A.t("Fill in at least {{count}} attribute to search",{count:r.minAttributesRequiredToSearch,defaultValue:"Fill in at least {{count}} attribute to search",defaultValue_plural:"Fill in at least {{count}} attributes to search"}))}))}validateForm(){if(!this.formInstance)return S().error((0,j.px)(oY.errorMessages.SEARCH_FORM_MISSING)({Search:this})),{error:!0,isValid:!1};let e=this.formInstance.validateFormScrollToFirstFailedField({});return e&&!this.props.searchGroup.unique&&(e=this.orgUnitSelectorInstance.validateAndScrollToIfFailed()),e&&!this.props.searchGroup.unique&&(e=this.validNumberOfAttributes()),{isValid:e,error:!1}}render(){const{searchGroup:e,classes:t,id:r}=this.props,a=e&&e.searchForm;if(!a)return y.createElement("div",null,oY.errorMessages.SEARCH_FORM_MISSING);const o=e.unique?this.getUniqueSearchButtonText(a):n.A.t("Search by attributes");return y.createElement("div",{"data-test":"d2-form-area",className:t.container},y.createElement(Fy,{formRef:e=>{this.formInstance=e},formFoundation:e.searchForm,id:r}),!e.unique&&this.renderOrgUnitSelector(),y.createElement("div",{className:t.searchButtonContainer},y.createElement(ra.$,{dataTest:`relationship-tei-search-button-${r}`,onClick:this.handleSearchAttempt},o),!e.unique&&this.renderMinAttributesRequired()))}}nY(oY,"errorMessages",{NO_ITEM_SELECTED:"No item selected",SEARCH_FORM_MISSING:"search form is missing. see log for details"});const iY=(0,I.withStyles)((e=>({orgUnitSection:{backgroundColor:"white",padding:e.typography.pxToRem(8),maxWidth:e.typography.pxToRem(892)},searchButtonContainer:{padding:e.typography.pxToRem(10),display:"flex",alignItems:"center"},minAttributesRequired:{flexGrow:1,textAlign:"right",fontSize:e.typography.pxToRem(14)},minAttribtuesRequiredInvalid:{color:e.palette.error.main}})))(oY),sY=(e,t)=>{const r=e.formsValues[t]||{};return Object.keys(r).filter((e=>r[e])).length},lY=(0,gs.Ng)(((e,t)=>{const r=t.searchId,n=t.id;return{searchAttempted:(e.teiSearch[r]&&e.teiSearch[r][n]?e.teiSearch[r][n]:{}).validationFailed,attributesWithValuesCount:sY(e,n)}}),(()=>({})))(iY),dY=(0,qd.compose)((0,gs.Ng)(((e,t)=>{const r=(e.teiSearch[t.id]||{}).searchResults||{},n=e.formsValues[r.formId],a=t.searchGroups[parseInt(r.searchGroupId,10)];return{resultsLoading:r.resultsLoading,teis:r.teis||[],currentPage:r.currentPage,searchValues:n,searchGroup:a}}),(()=>({}))),Dp((()=>({padding:"100px 0"})),null,(e=>!e.resultsLoading)))((e=>{let{getResultsView:t,...r}=e;return y.createElement("div",null,t&&t(r))}));function cY(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const uY=hm()(Pm()(zu)),pY={labelContainerStyle:{paddingTop:12,flexBasis:200},inputContainerStyle:{flexBasis:150}};class mY extends y.Component{constructor(){super(...arguments),cY(this,"onSelectProgram",(e=>{this.props.onSetProgram(this.props.searchId,e)}))}render(){return y.createElement(uY,{styles:pY,options:this.props.programOptions,onSelect:this.onSelectProgram,label:n.A.t("Selected program"),value:this.props.selectedProgramId})}}const gY="RelationshipsWidget.TeiSearchStartSetProgram",hY=(0,gs.Ng)(((e,t)=>{return{programOptions:(r=t.selectedTrackedEntityTypeId,Array.from(Nt.Jj.values()).filter((e=>e instanceof it.rr&&e.trackedEntityType.id===r&&e.access.data.read)).map((e=>({value:e.id,label:e.name}))))};var r}),(e=>({onSetProgram:(t,r)=>{e(((e,t)=>l(gY)({searchId:e,programId:t}))(t,r))}})))(mY),EY=(0,fp.default)((e=>({container:{margin:e.typography.pxToRem(10)},programSection:{backgroundColor:"white",maxWidth:e.typography.pxToRem(900),marginBottom:e.typography.pxToRem(20)},formContainerSection:{maxWidth:e.typography.pxToRem(900),marginBottom:e.typography.pxToRem(20)}})))((e=>{const[t,r]=(0,y.useState)(!0),a=(0,y.useCallback)((t=>{const r=e.selectedProgramId||e.selectedTrackedEntityTypeId||"";return`${e.id}-${r}-${t}`}),[e.selectedProgramId,e.selectedTrackedEntityTypeId,e.id]),o=(t,r)=>{e.onSearch(t,r,e.id)},i=t=>{e.onSearchResultsChangePage(e.id,t)},s=()=>{e.onNewSearch(e.id)},l=()=>{e.onEditSearch(e.id)},d=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.onSearchValidationFailed(...r,e.id)},c=()=>{const a=!t;return y.createElement(kc,{className:e.classes.programSection,isCollapsed:a,header:y.createElement(Lc,{containerStyle:{borderBottom:"1px solid #ECEFF1"},isCollapsed:a,onChangeCollapseState:()=>{r(!a)},title:n.A.t("Program")})},y.createElement(hY,{searchId:e.id,selectedProgramId:e.selectedProgramId,selectedTrackedEntityTypeId:e.selectedTrackedEntityTypeId}))},u=t=>t.map(((t,r)=>{const i=r.toString(),s=a(i),l=t.unique?n.A.t("Search {{uniqueAttrName}}",{uniqueAttrName:t.searchForm.getElements()[0].formName}):n.A.t("Search by attributes"),c=e.openSearchGroupSection!==i;return y.createElement(kc,{"data-test":"search-by-attributes-forms",key:s,isCollapsed:c,className:e.classes.formContainerSection,header:y.createElement(Lc,{containerStyle:{borderBottom:"1px solid #ECEFF1"},onChangeCollapseState:()=>{var t;t=i,e.openSearchGroupSection!==t?e.onSetOpenSearchGroupSection(e.id,t):e.onSetOpenSearchGroupSection(e.id,null)},isCollapsed:c,title:l})},y.createElement(lY,{id:s,searchId:e.id,searchGroupId:i,searchGroup:t,onSearch:o,onSearchValidationFailed:d}))})),p=e.searchGroups;return e.showResults?(()=>{const{id:t,searchGroups:r,getResultsView:n,selectedProgramId:a,selectedTrackedEntityTypeId:o,trackedEntityTypeName:d}=e;return y.createElement(WC.Provider,{value:{resultsPageSize:5}},y.createElement(dY,{id:t,onChangePage:i,onNewSearch:s,onEditSearch:l,getResultsView:n,searchGroups:r,selectedProgramId:a,selectedTrackedEntityTypeId:o,trackedEntityTypeName:d}))})():p?(t=>y.createElement("div",{className:e.classes.container},c(),u(t)))(p):y.createElement("div",null)})),yY="RelationshipsWidget.BatchSetTeiSearchProgramAndTet",vY="RelationshipsWidget.ResetSearchForms",fY="RelationshipsWidget.InitializeTeiSearch",IY="RelationshipsWidget.RequestSearchTei",bY="RelationshipsWidget.SearchFormValidationFailed",SY="RelationshipsWidget.SearchTeiFailed",TY="RelationshipsWidget.SearchTeiResultRetrieved",AY="RelationshipsWidget.SetTeiSearchProgramAndTet",CY="RelationshipsWidget.TeiNewSearch",OY="RelationshipsWidget.TeiEditSearch",NY="RelationshipsWidget.TeiSearchResultsChangePage",RY="RelationshipsWidget.TeiSearchSetOpenSearchGroupSection",wY="RelationshipsWidget.SearchTrackedEntityInTETScope",_Y=(e,t,r)=>l(SY)({formId:e,searchGroupId:t,searchId:r}),PY=(e,t,r,n)=>l(TY)({data:e,formId:t,searchGroupId:r,searchId:n}),kY=(e,t,r)=>l(AY)({searchId:e,programId:t,trackedEntityTypeId:r});function DY(e,t){if(t){return(0,it.x6)(t).searchGroups}return(0,it.mu)(e).searchGroups}const UY=(0,gs.Ng)(((e,t)=>{var r;const n=null!==(r=e.teiSearch[t.id])&&void 0!==r?r:{},{selectedTrackedEntityTypeId:a}=t,o=DY(a,n.selectedProgramId),{name:i}=(0,it.mu)(a);return{searchGroups:o,showResults:!!n.searchResults,openSearchGroupSection:n.openSearchGroupSection,trackedEntityTypeName:i.toLowerCase(),selectedProgramId:n.selectedProgramId}}),((e,t)=>({onSearch:(r,n,a)=>{e(((e,t,r,n)=>l(IY)({formId:e,searchGroupId:t,searchId:r,resultsPageSize:n}))(r,n,a,t.resultsPageSize))},onSearchResultsChangePage:(r,n)=>{e(((e,t,r)=>l(NY)({searchId:e,pageNumber:t,resultsPageSize:r}))(r,n,t.resultsPageSize))},onSearchValidationFailed:(t,r,n)=>{e(((e,t,r)=>l(bY)({formId:e,searchGroupId:t,searchId:r}))(t,r,n))},onNewSearch:t=>{e((e=>l(CY)({searchId:e}))(t))},onEditSearch:t=>{e((e=>l(OY)({searchId:e}))(t))},onSetOpenSearchGroupSection:(t,r)=>{e(((e,t)=>l(RY)({searchId:e,searchGroupId:t}))(t,r))}})))(EY),LY=e=>e.newRelationshipRegisterTei.programId,FY="relationship";var xY="enrollment_fieldLabelMediaBased__-aGaU";const MY=(0,I.withTheme)()((e=>{let{theme:t,onSave:r,onCancel:a,programId:o,inheritedAttributes:i,orgUnitId:s,duplicatesReviewPageSize:l,renderDuplicatesDialogActions:d,renderDuplicatesCardActions:c,ExistingUniqueValueDialogActions:u}=e;const p={theme:t,fieldLabelMediaBasedClass:xY};return y.createElement(cR,{id:FY,selectedScopeId:o,orgUnitId:s,fieldOptions:p,saveButtonText:e=>n.A.t("Save new {{trackedEntityTypeName}} and link",{trackedEntityTypeName:e,interpolation:{escapeValue:!1}}),onSave:r,onCancel:a,duplicatesReviewPageSize:l,renderDuplicatesDialogActions:d,renderDuplicatesCardActions:c,ExistingUniqueValueDialogActions:u,trackedEntityInstanceAttributes:i})})),VY=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(LY,(e=>{let t;try{t=(0,it.Ec)(e)}catch(r){return null}return t.enrollment}));return t=>({enrollmentMetadata:e(t),programId:t.newRelationshipRegisterTei.programId,orgUnitId:t.newRelationshipRegisterTei.orgUnit.id})}),(()=>({})))(MY);var jY="trackedEntityInstance_fieldLabelMediaBased__f5QY4";const GY=(0,I.withTheme)()((e=>{let{theme:t,onSave:r,onCancel:a,trackedEntityTypeId:o,inheritedAttributes:i,duplicatesReviewPageSize:s,renderDuplicatesDialogActions:l,renderDuplicatesCardActions:d,ExistingUniqueValueDialogActions:c}=e;const{orgUnitId:u}=vs(),p={theme:t,fieldLabelMediaBasedClass:jY},m=(e=>{let t;try{t=(0,it.mu)(e)}catch(r){return S().error((0,j.px)("Could not get TrackedEntityType for id")({TETypeId:e})),null}return t.teiRegistration})(o),{trackedEntityType:g}=m||{},h=g.name.toLocaleLowerCase();return m||null!==m&&void 0!==m&&m.form?y.createElement(yR,{id:FY,orgUnitId:u,teiRegistrationMetadata:m,selectedScopeId:m.form.id,inheritedAttributes:i,onCancel:a,saveButtonText:n.A.t("Save new {{trackedEntityTypeName}} and link",{trackedEntityTypeName:h,interpolation:{escapeValue:!1}}),fieldOptions:p,onSave:r,duplicatesReviewPageSize:s,renderDuplicatesDialogActions:l,renderDuplicatesCardActions:d,ExistingUniqueValueDialogActions:c,orgUnit:{id:u}}):null}));function BY(){return BY=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},BY.apply(this,arguments)}class $Y extends y.Component{render(){const{showDataEntry:e,programId:t,onSaveWithoutEnrollment:r,onSaveWithEnrollment:n,...a}=this.props;return e?t?y.createElement(VY,BY({},a,{onSave:n})):y.createElement(GY,BY({},a,{onSave:r})):null}}const WY=(0,qd.compose)((0,gs.Ng)((e=>({showDataEntry:e.newRelationshipRegisterTei.orgUnit,error:e.newRelationshipRegisterTei.dataEntryError,programId:e.newRelationshipRegisterTei.programId})),(()=>({}))),qm())($Y);function HY(){return HY=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HY.apply(this,arguments)}function zY(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class YY extends y.Component{constructor(){super(...arguments),zY(this,"baseLineFilter",(e=>{const{trackedEntityTypeId:t}=this.props;return e instanceof it.rr&&e.trackedEntityType.id===t&&e.access.data.write})),zY(this,"getOptionsFromPrograms",(e=>e.map((e=>({label:e.name,value:e.id,iconLeft:this.getProgramIcon(e)})))))}getProgramIcon(e){let{icon:{color:t,name:r}={},name:n}=e;const{classes:a}=this.props;return y.createElement("div",{className:a.iconContainer},y.createElement(Tm,{name:r||"clinical_fe_outline",color:t||"#e0e0e0",alternativeText:n,width:22,height:22,cornerRadius:2}))}renderIsFilteredText(){const{classes:e,onClearFilter:t}=this.props;return y.createElement("div",{className:e.isFilteredContainer},n.A.t("Some programs are being filtered."),y.createElement(Mg,{className:e.isFilteredLink,onClick:t},n.A.t("Show all")))}render(){const{classes:e,orgUnitIds:t,onUpdateSelectedProgram:r,onClearFilter:n,...a}=this.props;return y.createElement(fw,{orgUnitIds:t,baselineFilter:this.baseLineFilter},((e,t)=>y.createElement("div",null,y.createElement(tp,HY({options:this.getOptionsFromPrograms(e),required:!1,onSelect:r},a)),t?this.renderIsFilteredText():null)))}}const qY=hr()(hm()(Pm({onGetCustomFieldLabeClass:e=>e.programLabelClass})(vm((e=>{const{programLabelClass:t,...r}=e;return r}))(dp()((0,I.withStyles)((e=>({iconContainer:{display:"flex",alignItems:"center",paddingRight:5},icon:{width:22,height:22,borderRadius:2},isFilteredContainer:{fontSize:12,color:e.palette.grey.dark,paddingTop:5},isFilteredLink:{paddingLeft:2,backgroundColor:"inherit"}})))(YY))))));function KY(){return KY=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KY.apply(this,arguments)}class QY extends y.Component{render(){const{classes:e,...t}=this.props;return y.createElement(qY,KY({dataTest:"relationship-register-tei-program-selector",styles:QY.baseComponentStyles,programLabelClass:e.programLabel,label:n.A.t("Program")},t))}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(QY,"baseComponentStyles",{labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}});const XY=(0,I.withStyles)((e=>({programLabel:{paddingTop:"10px",[e.breakpoints.down(523)]:{paddingTop:"0px !important"}}})))(QY),JY="RelationshipsWidget.NewRelationshipSingleEventRegisterTeiProgramChange",ZY="RelationshipsWidget.NewRelationshipSingleEventRegisterTeiOrgUnitChange",eq="RelationshipsWidget.NewRelationshipSingleEventRegisterTeiOrgUnitSearchFailed",tq="RelationshipsWidget.NewRelationshipSingleEventRegisterTeiProgramFilterClear",rq=(0,gs.Ng)((e=>({orgUnitIds:e.newRelationshipRegisterTei.orgUnit?[e.newRelationshipRegisterTei.orgUnit.id]:null,value:e.newRelationshipRegisterTei.programId})),(e=>({onUpdateSelectedProgram:t=>{e((e=>l(JY)({programId:e}))(t))},onClearFilter:()=>{e(l(tq)())}})))(XY);function nq(){return nq=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nq.apply(this,arguments)}const aq=eg()(jp);class oq extends y.Component{render(){const{onUpdateSelectedOrgUnit:e,...t}=this.props;return y.createElement(aq,nq({onSelect:e,scope:Fm,maxTreeHeight:200},t))}}const iq=ym()(hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>e.labelClass})(vm((e=>{const{labelClass:t,...r}=e;return r}))(Qr()(oq)))));function sq(){return sq=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sq.apply(this,arguments)}function lq(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class dq extends y.Component{constructor(){super(...arguments),lq(this,"handleUpdateSelectedOrgUnit",(e=>{var t;const{programId:r,onUpdateSelectedOrgUnit:n}=this.props;if(!r||!e)return void n(e,!1);let a;try{a=(0,it.Ec)(r)}catch(o){return void n(e,!0)}n(e,!(null===(t=a)||void 0===t||!t.organisationUnits)&&!a.organisationUnits[e.id])}))}render(){const{classes:e,onUpdateSelectedOrgUnit:t,programId:r,...a}=this.props;return y.createElement(iq,sq({labelClass:e.label,label:n.A.t("Organisation Unit"),styles:dq.baseComponentStyles,onUpdateSelectedOrgUnit:this.handleUpdateSelectedOrgUnit},a))}}lq(dq,"baseComponentStyles",{labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}});const cq=(0,I.withStyles)((e=>({label:{paddingTop:"10px",[e.breakpoints.down(523)]:{paddingTop:"0px !important"}}})))(dq),uq=(0,gs.Ng)((e=>({value:e.newRelationshipRegisterTei.orgUnit,programId:e.newRelationshipRegisterTei.programId})),(e=>({onUpdateSelectedOrgUnit:(t,r)=>{e(((e,t)=>l(ZY)({orgUnit:e,resetProgramSelection:t}))(t,r))},onSearchError:()=>{e(l(eq)())}})))(cq),pq=e=>{let{trackedEntityTypeId:t}=e;return y.createElement(y.Fragment,null,y.createElement(uq,null),y.createElement(rq,{trackedEntityTypeId:t}))},mq=()=>{const e=n.A.t("Registration");return y.createElement(Lc,{title:e})},gq=(0,I.withStyles)((e=>({section:{backgroundColor:"white",maxWidth:e.typography.pxToRem(892)}})))((e=>{const{classes:t,trackedEntityTypeId:r}=e;return y.createElement(kc,{header:mq(),elevation:2,className:t.section},y.createElement(pq,{trackedEntityTypeId:r}))})),hq=e=>{let{teiId:t,values:r,handleOnClick:a}=e;return y.createElement(ra.$,{small:!0,dataTest:"view-dashboard-button",onClick:()=>{a(t,r)}},n.A.t("Link"))},Eq=e=>{let{onCancel:t,onSave:r,trackedEntityName:a}=e;return y.createElement(y.Fragment,null,y.createElement(ra.$,{onClick:t,secondary:!0},n.A.t("Cancel")),y.createElement("div",{style:{marginLeft:16}},y.createElement(ra.$,{dataTest:"create-as-new-person",onClick:r,primary:!0},n.A.t("Save as new {{trackedEntityName}}",{trackedEntityName:a,interpolation:{escapeValue:!1}}))))},yq=(0,qd.compose)(qm(),(0,I.withStyles)((()=>({container:{display:"flex",flexWrap:"wrap"},leftContainer:{flexGrow:10,flexBasis:0,margin:8}}))))((e=>{let{dataEntryId:t,onLink:r,onCancel:a,onSaveWithoutEnrollment:o,onSaveWithEnrollment:i,onGetUnsavedAttributeValues:s,trackedEntityName:l,trackedEntityTypeId:d,selectedScopeId:c,inheritedAttributes:u,classes:p}=e;const{resultsPageSize:m}=(0,y.useContext)(WC),g=(0,y.useCallback)((e=>{let{item:t}=e;return y.createElement(hq,{teiId:t.id,values:t.values,handleOnClick:r})}),[r]),h=(0,y.useCallback)(((e,t)=>y.createElement(Eq,{onCancel:e,onSave:t,trackedEntityName:l})),[l]),E=(0,y.useCallback)((e=>{let{teiId:t,attributeValues:a}=e;return y.createElement(ra.$,{dataTest:"existing-unique-value-link-tei-button",primary:!0,onClick:()=>{r(t,a)}},n.A.t("Link"))}),[r]);return y.createElement("div",{className:p.container},y.createElement("div",{className:p.leftContainer},y.createElement(gq,{trackedEntityTypeId:d}),y.createElement(WY,{onLink:r,onCancel:a,onSaveWithoutEnrollment:o,onSaveWithEnrollment:i,trackedEntityTypeId:d,onGetUnsavedAttributeValues:s,duplicatesReviewPageSize:m,renderDuplicatesDialogActions:h,renderDuplicatesCardActions:g,ExistingUniqueValueDialogActions:E,inheritedAttributes:u})),y.createElement(C_,{dataEntryId:t,selectedScopeId:c,renderCardActions:e=>{let{item:t}=e;return y.createElement(hq,{teiId:t.id,values:t.values,handleOnClick:r})}}))})),vq=e=>{let{onLink:t,onSave:r,onGetUnsavedAttributeValues:n,onCancel:a,teiId:o,trackedEntityTypeId:i,suggestedProgramId:s}=e;const l=(0,gs.d4)((e=>{let{newRelationshipRegisterTei:t}=e;return t.error})),d=s||i,{trackedEntityName:c}=es(d),{inheritedAttributes:u,isLoading:p}=(e=>{let{teiId:t,trackedEntityTypeId:r}=e;const n=(0,gs.d4)((e=>{let{newRelationshipRegisterTei:t}=e;return t.programId})),a=(0,y.useMemo)((()=>{const e=new Set;if(n){const t=(0,it.Ec)(n);return t instanceof it.rr&&t.attributes.forEach((t=>{t.inherit&&e.add(t.id)})),e}return(0,it.mu)(r).attributes.forEach((t=>{t.inherit&&e.add(t.id)})),e}),[n,r]),{data:o,isLoading:i}=ai(["inheritedAttributeValues",t,n],{resource:"tracker/trackedEntities",id:t,params:{fields:["attributes"],program:n}},{enabled:!!t,select:e=>(e.attributes||[]).filter((e=>a.has(e.attribute)))});return{inheritedAttributes:null!==o&&void 0!==o?o:[],isLoading:i}})({teiId:o,trackedEntityTypeId:i,programId:s});return p?null:y.createElement(yq,{dataEntryId:"relationship",onLink:t,onCancel:a,onSaveWithoutEnrollment:r,onSaveWithEnrollment:r,onGetUnsavedAttributeValues:n,trackedEntityName:c,selectedScopeId:d,error:l,trackedEntityTypeId:i,inheritedAttributes:u})},fq="RelationshipsWidget.InitializeRegisterTei",Iq="RelationshipsWidget.InitializeRegisterTeiFailed",bq=(e,t)=>l(fq)({programId:e,orgUnit:t}),Sq="RelationshipsWidget.NewRelationshipRegisterTeiDataEntryOpen",Tq="RelationshipsWidget.NewRelationshopRegisterTeiDataEntryOpenCancelled",Aq="RelationshipsWidget.NewRelationshopRegisterTeiDataEntryOpenFailed";function Cq(){return Cq=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Cq.apply(this,arguments)}function Oq(e,t,r){return`${e}-${t}-${r}`}const Nq="relationshipTeiSearchWidget";var Rq=r(16899);const wq={button:{display:"flex",gap:yn.Q.dp8,alignItems:"center"}},_q=(0,I.withStyles)(wq)((e=>{let{icon:t,label:r,onClickAction:a,dataTest:o,disable:i,classes:s}=e;return y.createElement(aI,{content:n.A.t("No available program stages"),enabled:i},y.createElement(ra.$,{onClick:a,dataTest:o,disabled:i},y.createElement("div",{className:s.button},t,r)))})),Pq=Object.freeze({REPORT:"REPORT",SCHEDULE:"SCHEDULE",REFER:"REFER"}),kq={contentContainer:{padding:`0 ${yn.Q.dp16} ${yn.Q.dp16} ${yn.Q.dp16}`,display:"flex",gap:yn.Q.dp8}},Dq=(0,I.withStyles)(kq)((e=>{let{stages:t,events:r,ruleEffects:a,classes:o}=e;const[i,s]=(0,y.useState)(!0),l=(0,T.W6)(),{enrollmentId:d,programId:c,teiId:u,orgUnitId:p}=vs(),m=(0,y.useMemo)((()=>t.map((e=>{var t;const n={...e};return n.eventCount=null===r||void 0===r||null===(t=r.filter((t=>t.programStage===e.id)))||void 0===t?void 0:t.length,n}))),[r,t]),g=(0,y.useMemo)((()=>null===a||void 0===a?void 0:a.filter((e=>"HIDEPROGRAMSTAGE"===e.type))),[a]),h=(0,y.useMemo)((()=>m.every((e=>!e.dataAccess.write||!e.repeatable&&e.eventCount>0||(null===g||void 0===g?void 0:g.find((t=>t.id===e.id)))))),[m,g]),E=e=>{l.push(`/enrollmentEventNew?${Is({programId:c,teiId:u,enrollmentId:d,orgUnitId:p,tab:e})}`)},v=void 0!==r&&void 0!==t;return y.createElement(Ib,{header:n.A.t("Quick actions"),open:i,onClose:()=>s(!1),onOpen:()=>s(!0)},v&&y.createElement("div",{className:o.contentContainer,"data-test":"quick-action-button-container"},y.createElement(_q,{icon:y.createElement(iw.A,{color:vn.T.grey700}),label:n.A.t("New Event"),onClickAction:()=>E(Pq.REPORT),dataTest:"quick-action-button-report",disable:h}),y.createElement(_q,{icon:y.createElement(Rq.A,{color:vn.T.grey700}),label:n.A.t("Schedule an event"),onClickAction:()=>E(Pq.SCHEDULE),dataTest:"quick-action-button-schedule",disable:h})))})),Uq="RequestAddNoteForEnrollment",Lq="StartAddNoteForEnrollment",Fq="NoteAddedForEnrollment",xq="AddEnrollmentNote",Mq="AddNoteFailedForEnrollment",Vq="AddNoteBatchForEnrollment",jq=(e,t,r,n)=>l(Lq)({selections:r,context:n},{offline:{effect:{url:`enrollments/${e}/note`,method:oc,data:t},commit:{type:Fq,meta:{selections:r,context:n}},rollback:{type:Mq,meta:{selections:r,context:n}}}}),Gq=(e,t)=>l(xq)({enrollmentId:e,note:t});function Bq(){return Bq=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Bq.apply(this,arguments)}const $q=hr()(Nu),Wq={item:{padding:yn.U.dp12,marginRight:yn.U.dp4,background:vn.T.grey200,borderRadius:"5px",display:"flex",fontSize:"14px",lineHeight:"19px",color:vn.T.grey900,"& + &":{marginTop:yn.U.dp8}},wrapper:{padding:`0 ${yn.U.dp16}px`,marginBottom:yn.U.dp16},notesWrapper:{maxHeight:400,overflowY:"auto"},editor:{paddingTop:yn.U.dp16},emptyNotes:{fontSize:14,color:vn.T.grey600},name:{fontSize:"13px",fontWeight:500},lastUpdated:{fontSize:"12px",marginLeft:"8px",color:vn.T.grey700},body:{"& p":{margin:`${yn.U.dp8}px 0 0 0`}},newNoteButtonContainer:{paddingTop:yn.U.dp4,display:"flex",gap:"4px"}},Hq=(0,I.withStyles)(Wq)((e=>{let{placeholder:t,emptyNoteMessage:r,notes:a,handleAddNote:o,classes:i}=e;const[s,l]=(0,y.useState)(!1),[d,c]=(0,y.useState)(""),{fromServerDate:u}=(0,A.Bp)(),p=(0,y.useCallback)((e=>{l(!0),c(e)}),[]),m=(0,y.useCallback)((()=>{c(""),l(!1)}),[]),g=(0,y.useCallback)((()=>{o(d),c(""),l(!1)}),[o,d]),h=e=>{let{value:t,storedAt:r,createdBy:n}=e;return y.createElement("div",{"data-test":"note-item",className:er()(i.item)},y.createElement("div",{className:i.rightColumn},y.createElement("div",{className:i.header},n&&y.createElement("span",{className:er()(i.headerText,i.name)},n.firstName," "," "," ",n.surname),y.createElement("span",{className:er()(i.headerText,i.lastUpdated)},y.createElement(Xo.m,{content:u(r).toLocaleString()},$()(u(r)).fromNow()))),y.createElement("div",{className:i.body},y.createElement(rI.iX,null,t))))};return y.createElement("div",{className:i.wrapper},y.createElement("div",{className:i.notesWrapper},a.sort(((e,t)=>$()(e.storedAt).valueOf()-$()(t.storedAt).valueOf())).map((e=>y.createElement(h,Bq({key:`note-item-${e.note}-`},e)))),0===a.length&&y.createElement("div",{className:i.emptyNotes},r)),y.createElement("div",{className:i.editor},y.createElement(rI.KE,null,y.createElement($q,{placeholder:t,onChange:p,value:d,"data-test":"note-textfield"}))),s&&y.createElement("div",{className:i.newNoteButtonContainer,"data-test":"note-buttons-container"},y.createElement(ra.$,{dataTest:"add-note-btn",onClick:g,primary:!0},n.A.t("Save note")),y.createElement(ra.$,{dataTest:"cancel-note-btn",onClick:m},n.A.t("Cancel"))))}));function zq(){return zq=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zq.apply(this,arguments)}const Yq=e=>{let{title:t,notes:r,onAddNote:n,...a}=e;const[o,i]=(0,y.useState)(!0);return y.createElement(Ib,{header:y.createElement("div",null,y.createElement("span",null,t),r.length?y.createElement(Fp.v,{dense:!0},r.length):null),onOpen:(0,y.useCallback)((()=>i(!0)),[i]),onClose:(0,y.useCallback)((()=>i(!1)),[i]),open:o},y.createElement(Hq,zq({notes:r,handleAddNote:n},a)))},qq=e=>{let{optionGroups:t}=e;return t.reduce(((e,t)=>{const r=t.optionSet.id,n={id:t.id,options:t.options.map((e=>e.id))};return e[r]?e[r].push(n):e[r]=[n],e}),{})},Kq=e=>{const{error:t,loading:r,program:n}=(e=>{const{error:t,loading:r,data:n}=(0,A.iO)((0,y.useMemo)((()=>({programs:{resource:"programs",id:e,params:{fields:"id,version,displayName,displayShortName,description,programType,style,minAttributesRequiredToSearch,enrollmentDateLabel,incidentDateLabel,featureType,selectEnrollmentDatesInFuture,selectIncidentDatesInFuture,displayIncidentDate,access[*],dataEntryForm[id,htmlCode],categoryCombo[id,displayName,isDefault,categories[id,displayName]],programIndicators[id,displayName,code,shortName,style,displayInForm,expression,displayDescription,description,filter,program[id]],programSections[id,displayFormName,displayDescription,sortOrder,trackedEntityAttributes],programRuleVariables[id,displayName,programRuleVariableSourceType,valueType,program[id],programStage[id],dataElement[id],trackedEntityAttribute[id],useCodeForOptionSet],programStages[id,access,autoGenerateEvent,openAfterEnrollment,generatedByEnrollmentDate,reportDateToUse,minDaysFromStart,displayName,description,executionDateLabel,formType,featureType,validationStrategy,enableUserAssignment,style,dataEntryForm[id,htmlCode],programStageSections[id,displayName,displayDescription,sortOrder,dataElements[id]],programStageDataElements[compulsory,displayInReports,renderOptionsAsRadio,allowFutureDate,renderType[*],dataElement[id,displayName,displayShortName,displayFormName,valueType,translations[*],description,optionSetValue,style,optionSet[id,displayName,version,valueType,options[id,displayName,code,style, translations]]]]],programTrackedEntityAttributes[trackedEntityAttribute[id,displayName,displayShortName,displayFormName,description,valueType,optionSetValue,unique,orgunitScope,pattern,translations[property,locale,value],optionSet[id,displayName,version,valueType,options[id,displayName,name,code,style,translations]]],displayInList,searchable,mandatory,renderOptionsAsRadio,allowFutureDate],trackedEntityType[id,access,displayName,allowAuditLog,minAttributesRequiredToSearch,featureType,trackedEntityTypeAttributes[trackedEntityAttribute[id],displayInList,mandatory,searchable],translations[property,locale,value]],userRoles[id,displayName]"}}})),[e]));return{error:t,loading:r,program:null===n||void 0===n?void 0:n.programs}})(e),{error:a,loading:o,optionGroups:i}=(e=>{const t=(0,y.useMemo)((()=>e?{fields:"id,optionSet,options",filter:`optionSet.id:in:[${e.programTrackedEntityAttributes.reduce(((e,t)=>{const r=t.trackedEntityAttribute.optionSet;return r&&e.push(r.id),e}),[]).join(",")}]`}:{}),[e]),r=["optionGroups","programAttributes",...null!==e&&void 0!==e&&e.id?[e.id]:[]],n={resource:"optionGroups",params:t},a={enabled:Boolean(e),select:qq},{data:o,isLoading:i,error:s}=ni(r,n,a);return{optionGroups:e?o:null,loading:i,error:s}})(n);return{program:(0,y.useMemo)((()=>n&&i?(n.trackedEntityType&&(n.trackedEntityType.changelogEnabled=n.trackedEntityType.allowAuditLog,delete n.trackedEntityType.allowAuditLog),n.programTrackedEntityAttributes=n.programTrackedEntityAttributes.map((e=>{const t=e.trackedEntityAttribute;return t.optionSet&&(t.optionSet.optionGroups=i[t.optionSet.id]),e})),n):null),[n,i]),loading:r||o,error:t||a}},Qq=(e,t)=>{const{absoluteApiPath:r,teiId:n,programId:a,id:o}=e;return(0,j.L8)(t,j.Gv.trackerFileEndpoint)?`${r}/tracker/trackedEntities/${n}/attributes/${o}/file?program=${a}`:`${r}/trackedEntityInstances/${n}/${o}/file`},Xq={[it.CO.FILE_RESOURCE]:async e=>{let{attribute:t,querySingleResource:r,minorServerVersion:n}=e;if(!t.value)return null;const{id:a,displayName:o}=await r({resource:"fileResources",id:t.value});return{id:a,name:o,value:a,url:Qq(t,n)}},[it.CO.IMAGE]:async e=>{let{attribute:t,minorServerVersion:r}=e;const{id:n,value:a,teiId:o,programId:i,absoluteApiPath:s}=t;if(!a)return null;return{value:a,...(0,j.L8)(r,j.Gv.trackerImageEndpoint)?{url:`${s}/tracker/trackedEntities/${o}/attributes/${n}/image?program=${i}`,previewUrl:`${s}/tracker/trackedEntities/${o}/attributes/${n}/image?program=${i}&dimension=small`}:{url:`${s}/trackedEntityInstances/${o}/${n}/image?program=${i}`,previewUrl:`${s}/trackedEntityInstances/${o}/${n}/image?program=${i}&dimension=SMALL`}}},[it.CO.ORGANISATION_UNIT]:async e=>{let{attribute:{value:t},querySingleResource:r}=e;return(await pi([t],r))[t]}},Jq=e=>{let{errorsMessages:t=[],warningsMessages:r=[],hasApiError:a=!1}=e;return y.createElement(y.Fragment,null,y.createElement("br",null),t&&t.length>0&&y.createElement(zm.I,{title:n.A.t("There is a problem with this form"),error:!0},y.createElement("ul",null,null===t||void 0===t?void 0:t.map((e=>y.createElement("li",{key:e.id}," ",e.message," "))))),y.createElement("br",null),r&&r.length>0&&y.createElement(zm.I,{title:n.A.t("There are warnings in this form"),warning:!0},y.createElement("ul",null,null===r||void 0===r?void 0:r.map((e=>y.createElement("li",{key:e.id}," ",e.message," "))))),y.createElement("br",null),a&&y.createElement(zm.I,{title:n.A.t("There was a problem saving changes"),error:!0},n.A.t("Try again or contact your system administrator for support")),y.createElement("br",null))},Zq=e=>{var t;return null===e||void 0===e||null===(t=e.programStageSection)||void 0===t?void 0:t.id},eK=e=>{var t;return null===e||void 0===e||null===(t=e.programStage)||void 0===t?void 0:t.id},tK=e=>{var t;return null===e||void 0===e||null===(t=e.dataElement)||void 0===t?void 0:t.id},rK=e=>{var t;return null===e||void 0===e||null===(t=e.trackedEntityAttribute)||void 0===t?void 0:t.id},nK=e=>{var t;return null===e||void 0===e||null===(t=e.optionGroup)||void 0===t?void 0:t.id},aK=e=>{var t;return null===e||void 0===e||null===(t=e.option)||void 0===t?void 0:t.id},oK=e=>{var t;return null===e||void 0===e||null===(t=e.program)||void 0===t?void 0:t.id},iK={POINT:{FEATURETYPE:"FEATURETYPE_POINT",DATAELEMENTTYPE:it.CO.COORDINATE,LABEL:"Coordinate"},POLYGON:{FEATURETYPE:"FEATURETYPE_POLYGON",DATAELEMENTTYPE:it.CO.POLYGON,LABEL:"Area"}},sK=e=>{var t;return(null===(t=iK[e])||void 0===t?void 0:t.FEATURETYPE)||e},lK=e=>{var t;return(null===(t=iK[e])||void 0===t?void 0:t.DATAELEMENTTYPE)||e},dK=e=>{const{value:t,attribute:r,valueType:n,optionSet:a}=e,o=new it.fq((e=>{e.id=r,e.type=n}));if(a){const e=a.options.map((e=>new it.c$((t=>{t.text=e.displayName,t.value=e.code}))));o.optionSet=new it.G2(r,e,null,o)}return Ci(t,n,o)},cK=Object.freeze({COLON:":",COMMA:",",SLASH:"/"}),uK=e=>e.replace(new RegExp(cK.SLASH,"g"),`/${cK.SLASH}`).replace(new RegExp(cK.COLON,"g"),`/${cK.COLON}`).replace(new RegExp(cK.COMMA,"g"),`/${cK.COMMA}`),pK=Object.freeze({events:"events",trackedEntities:"trackedEntities",relationships:"relationships"}),mK=(e,t)=>t&&(t[e]||t.instances)||[],gK=async e=>{let{programAPI:t,programRules:r,constants:n,setRulesContainer:a}=e;const{programRuleVariables:o,programIndicators:i}=t,s={};o&&((e,t)=>{e.programRuleVariables=t.map((e=>({...e,programId:oK(e),dataElementId:tK(e),trackedEntityAttributeId:rK(e)})))})(s,o),r&&((e,t)=>{e.programRules=t.map((e=>{return{...e,programId:oK(e),programStageId:eK(e),programRuleActions:(t=e.programRuleActions,null===t||void 0===t?void 0:t.map((e=>({...e,programStageSectionId:Zq(e),programStageId:eK(e),dataElementId:tK(e),trackedEntityAttributeId:rK(e),optionGroupId:nK(e),optionId:aK(e)}))))};var t}))})(s,r),i&&((e,t)=>{const r=t.map((e=>({...e,programId:oK(e)}))),{rules:n,variables:a}=xd(r,e.id);a&&(e.programRuleVariables=[...e.programRuleVariables,...a]),n&&(e.programRules=[...e.programRules,...n])})(s,i),s.constants=n,a(s)},hK=e=>e&&Object.values(e).reduce(((e,t)=>({...e,[t.id]:{id:t.id,valueType:t.valueType,optionSetId:t.optionSet&&t.optionSet.id}})),{}),EK=e=>{let{foundation:t,formId:r,orgUnit:n,enrollmentData:a,teiValues:o,trackedEntityAttributes:i,optionSets:s,rulesContainer:l,otherEvents:d,dataElements:c,userRoles:u}=e;var p;return((e,t,r)=>{const n=Xl(Ql(e,t));return[ld(n,r)]})(Hl.getProgramRuleEffects({programRulesContainer:l,currentEvent:null,otherEvents:d,dataElements:hK(c),trackedEntityAttributes:i,selectedEnrollment:(p=a,p&&{enrollmentId:p.enrollment,enrolledAt:p.enrolledAt,occurredAt:p.occurredAt}),selectedEntity:o,selectedOrgUnit:n,selectedUserRoles:u,optionSets:s}),t,r)},yK="Open",vK="OpenWithErrors",fK="OpenAndDisabled",IK="Close",bK="UpdateFieldProfileActionBatch",SK="OpenDataEntryProfileActionBatch",TK="TeiUpdate",AK="TeiSaveRequest",CK="TeiUpdateSucess",OK="TeiUpdateError",NK="SetTeiModalError",RK="SetTeiValues",wK="CleanTeiModal",_K=[{clientId:"geometry",dataEntryId:"geometry",onConvertOut:UT},{id:"assignee"}],PK=e=>l(NK)({hasError:e}),kK=(e,t)=>l(RK)({attributeValues:e,geometry:t}),DK=e=>{let{dataEntryId:t,itemId:r,onCancel:a,onSave:o,saveAttempted:i,onUpdateFormField:s,onUpdateFormFieldAsync:l,trackedEntityName:d,formFoundation:c,modalState:u,onGetValidationContext:p,errorsMessages:m,warningsMessages:g,orgUnit:h}=e;return y.createElement(N.a,{large:!0,onClose:a,dataTest:"modal-edit-profile"},y.createElement(Ip.w,null,n.A.t(`Edit ${d}`)),y.createElement(R.$,null,n.A.t("Change information about this {{trackedEntityName}} here. To change information about this enrollment, use the Edit button in the in the Enrollment box on this dashboard",{trackedEntityName:d,interpolation:{escapeValue:!1}}),y.createElement(Of,{id:t,formFoundation:c,saveAttempted:i,onUpdateFormField:s,onUpdateFormFieldAsync:l,onGetValidationContext:p,orgUnit:h}),y.createElement(Jq,{dataEntryId:t,itemId:r,saveAttempted:i,errorsMessages:m,warningsMessages:g,hasApiError:u===vK})),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:a,secondary:!0},n.A.t("Cancel without saving")),u===fK&&y.createElement(ra.$,{loading:!0,primary:!0},n.A.t(" Loading...")),(u===yK||u===vK)&&y.createElement(ra.$,{onClick:o,primary:!0},n.A.t("Save changes")))))},UK=e=>{let{programAPI:t,orgUnitId:r,clientAttributesWithSubvalues:n,userRoles:a,dataEntryId:o,itemId:i,geometry:s,dataEntryFormConfig:d}=e;const c=(0,gs.wA)(),u=(0,gs.d4)((e=>e)),p=(0,gs.d4)((e=>{let{enrollmentDomain:t}=e;return null===t||void 0===t?void 0:t.enrollment})),m=JK(t),g=XK(p,m),h=Jo(r).orgUnit,E=YK(t),v=zK(t,d),{formValues:f,clientValues:I}=qK({formFoundation:v,clientAttributesWithSubvalues:n,orgUnit:h}),{formGeometryValues:b,clientGeometryValues:S}=nQ({geometry:s,featureType:t.trackedEntityType.featureType}),T=tQ(t),A=eQ(T,m);return(0,y.useEffect)((()=>(Object.entries(f).length>0&&c((e=>{let{dataEntryId:t,itemId:r,formValues:n}=e;return(0,Xd.OJ)([...pS(t,r,_K),My(`${t}-${r}`,n)],SK)})({dataEntryId:o,itemId:i,formValues:{...f,...b}})),()=>{c(cv(o)),c(l(wK)())})),[c,f,b,o,i]),(0,y.useEffect)((()=>{h&&Object.entries(h).length>0&&Object.entries(v).length>0&&Object.entries(I).length>0&&Object.entries(E).length>0&&c(...EK({foundation:v,formId:`${o}-${i}`,orgUnit:h,trackedEntityAttributes:T,teiValues:{...I,...S},optionSets:A,rulesContainer:E,otherEvents:g,dataElements:m,enrollmentData:p,userRoles:a}))}),[c,h,v,T,n,A,E,I,o,i,g,m,p,S,a]),{orgUnit:h,trackedEntityAttributes:T,optionSets:A,rulesContainer:E,formFoundation:v,state:u,otherEvents:g,dataElements:m,enrollment:p,userRoles:a}},LK=(e,t,r)=>new it.Ow((n=>{n.scope=t.orgunitScope?it.w$.ORGANISATION_UNIT:it.w$.ENTIRE_SYSTEM,n.onValidate=function(a){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=(0,j.Fs)(Mi,_i)(a,t.valueType);if(o.onGetUnsavedAttributeValues){const t=o.onGetUnsavedAttributeValues(e.id);if(t){if(t.find((e=>e===i)))return{valid:!1,data:{attributeValueExistsUnsaved:!0}}}}let s;if(n.scope===it.w$.ORGANISATION_UNIT){const t=o.orgUnitId;s=r({resource:"tracker/trackedEntities",params:{program:o.programId,orgUnit:t,filter:`${e.id}:EQ:${uK(i)}`}})}else s=r({resource:"tracker/trackedEntities",params:{program:o.programId,ouMode:"ACCESSIBLE",filter:`${e.id}:EQ:${uK(i)}`}});return s.then((t=>{const a=mK(pK.trackedEntities,t).filter((e=>e.trackedEntity!==o.trackedEntityInstanceId));if(0===a.length)return function(e,t,r){let n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0;if(e.scope===it.w$.ORGANISATION_UNIT){const e=a.orgUnitId;n=o({resource:"tracker/trackedEntities",params:{trackedEntityType:a.trackedEntityTypeId,orgUnit:e,filter:`${t.id}:EQ:${uK(r)}`}})}else n=o({resource:"tracker/trackedEntities",params:{trackedEntityType:a.trackedEntityTypeId,ouMode:"ACCESSIBLE",filter:`${t.id}:EQ:${uK(r)}`}});return n.then((e=>{const t=mK(pK.trackedEntities,e).filter((e=>e.trackedEntity!==a.trackedEntityInstanceId)),r=t&&t[0]||{},n={id:r.trackedEntity,tetId:r.trackedEntityType};return{valid:0===t.length,data:n}}))}(n,e,i,o,r);const s=a&&a[0]||{},l={id:s.trackedEntity,tetId:s.trackedEntityType};return{valid:0===a.length,data:l}}))},t.pattern&&(n.generatable=!!t.pattern)})),FK=async e=>{let{dataElement:t,optionSets:r,programTrackedEntityAttribute:n,trackedEntityAttribute:a,querySingleResource:o}=e;t.id=a.id,t.compulsory=n.mandatory,t.name=a.displayName,t.shortName=a.displayShortName,t.formName=a.displayFormName,t.description=a.description,t.displayInForms=!0,t.displayInReports=n.displayInList,t.disabled=!1,t.type=a.valueType,t.searchable=n.searchable,a.unique&&(t.unique=LK(t,a,o)),a.optionSet&&a.optionSet.id&&(t.optionSet=await xK(t,r,a.optionSet.id,n.renderOptionsAsRadio))},xK=async(e,t,r,n)=>{const a=t.find((e=>e.id===r));if(!a)return S().warn((0,j.px)("Optionset not found")({id:r})),null;e.type=a.valueType;const o=a.options.map((async e=>{const t=yt(e.style);return new it.c$((r=>{r.id=e.id,r.value=e.code,r.text=e.displayName,r.icon=t}))})),i=await Promise.all(o),s=a.optionGroups&&new Map(a.optionGroups.map((e=>[e.id,new vt.z((t=>{t.id=e.id,t.optionIds=new Map(e.options.map((e=>[e,e])))}))]))),l=new it.G2(a.id,i,s,e,gt,a.attributeValues);return l.inputType=n?it.P$.VERTICAL_RADIOBUTTONS:null,l},MK=e=>new it.fq((t=>{t.id=sK(e),t.name=n.A.t((e=>{var t;return(null===(t=iK[e])||void 0===t?void 0:t.LABEL)||e})(e)),t.formName=t.name,t.compulsory=!1,t.displayInForms=!0,t.disabled=!1,t.type=lK(e)})),VK=(e,t,r,n,a)=>{const o=e.trackedEntityAttributeId&&t.find((t=>t.id===e.trackedEntityAttributeId));return o?o.valueType===it.CO.DATE?(async(e,t,r,n)=>{const a=new it.H;return a.type=it.CO.DATE,a.allowFutureDate=t.allowFutureDate,await FK({dataElement:a,optionSets:e,programTrackedEntityAttribute:t,trackedEntityAttribute:r,querySingleResource:n}),a})(r,e,o,n):(async(e,t,r,n,a)=>{const o=new it.fq;return o.type=r.valueType,await FK({dataElement:o,optionSets:e,programTrackedEntityAttribute:t,trackedEntityAttribute:r,querySingleResource:n}),Gi(o,a)})(r,e,o,n,a):(S().error((0,j.px)("TrackedEntityAttributeId missing from programTrackedEntityAttribute or trackedEntityAttribute not found")({programTrackedEntityAttribute:e})),null)},jK=e=>e.type===Qi.PLUGIN,GK=e=>e.trackedEntityAttributes.map((e=>{let{id:t}=e;return t})),BK=e=>{if(!e)return null;const t=e.featureType;return t&&["POINT","POLYGON"].includes(t)?MK(t):null},$K=async e=>{let{programTrackedEntityAttributes:t,trackedEntityAttributes:r,optionSets:n,section:a,querySingleResource:o,minorServerVersion:i}=e;for(const s of t)if(jK(s)){const e=s,t=e.fieldMap.filter((e=>e.objectType===yd.ATTRIBUTE)).reduce(((e,t)=>(e[t.IdFromApp]=t,e)),{}),l=new qi.g((r=>{r.id=e.id,r.name=e.name,r.pluginSource=e.pluginSource,r.fields=new Map,r.customAttributes=t}));await e.fieldMap.asyncForEach((async e=>{if(e.objectType&&e.objectType===yd.TRACKED_ENTITY_ATTRIBUTE){const t=await VK(e,r,n,o,i);if(!t)return;l.addField(e.IdFromPlugin,t)}})),l&&a.addElement(l)}else if(!jK(s)){const e=s,t=await VK(e,r,n,o,i);t&&a.addElement(t)}return a},WK=async e=>{let{programTrackedEntityAttributes:t,trackedEntityAttributes:r,optionSets:n,sectionCustomLabel:a,sectionCustomId:o,sectionDisplayDescription:i,querySingleResource:s,minorServerVersion:l}=e;if(null===t||void 0===t||!t.length)return null;const d=new it.wn((e=>{e.id=o,e.name=a,e.displayDescription=i}));return await $K({programTrackedEntityAttributes:t,trackedEntityAttributes:r,optionSets:n,section:d,querySingleResource:s,minorServerVersion:l}),d},HK=async(e,t,r,a)=>{const{programSections:o,trackedEntityType:i}=e,s=null===(l=e.programTrackedEntityAttributes)||void 0===l?void 0:l.map((e=>({...e,trackedEntityAttributeId:rK(e)})));var l;const d=(e=>{var t;return null===e||void 0===e||null===(t=e.trackedEntityType)||void 0===t?void 0:t.id})(e),c=e.programTrackedEntityAttributes.reduce(((e,t)=>[...e,t.trackedEntityAttribute]),[]),u=c.reduce(((e,t)=>t.optionSet?[...e,t.optionSet]:e),[]),p=new it.k3((t=>{var r;t.featureType=(r=e.featureType)?Ot(r.toLowerCase()):"None",t.name=e.displayName}));let m;if(null!==o&&void 0!==o&&o.length||a){if(d&&(m=await(async(e,t)=>{const r=BK(t);if(!r)return null;const n=new it.wn((r=>{r.id=e,r.name=(null===t||void 0===t?void 0:t.displayName)||""}));return r&&n.addElement(r),n})(d,i),m&&p.addSection(m)),s){const e=s.reduce(((e,t)=>(t.trackedEntityAttributeId&&(e[t.trackedEntityAttributeId]=t),e)),{});if(a)await a.asyncForEach((async a=>{var i,s,l;const d=a.elements.reduce(((t,r)=>{if(r.type===Qi.PLUGIN){var n;const a=null===(n=r.fieldMap)||void 0===n?void 0:n.map((t=>({...t,...e[t.IdFromApp]})));return t.push({...r,fieldMap:a}),t}const a=e[r.id];return a&&t.push(a),t}),[]),g=null===o||void 0===o?void 0:o.find((e=>e.id===a.id));!g&&o&&o.length>0&&S().warn((0,j.px)("Could not find metadata for section. This could indicate that your form configuration may be out of sync with your metadata.")({sectionId:a.id})),m=await WK({programTrackedEntityAttributes:d,sectionCustomLabel:null!==(i=null!==(s=a.name)&&void 0!==s?s:null===g||void 0===g?void 0:g.displayFormName)&&void 0!==i?i:n.A.t("Profile"),sectionCustomId:a.id,sectionDisplayDescription:null!==(l=null===g||void 0===g?void 0:g.displayDescription)&&void 0!==l?l:"",minorServerVersion:r,trackedEntityAttributes:c,optionSets:u,querySingleResource:t}),m&&p.addSection(m)}));else for(const n of o){const a=GK(n);m=await WK({programTrackedEntityAttributes:a.map((t=>e[t])),trackedEntityAttributes:c,optionSets:u,sectionCustomLabel:n.displayFormName,sectionCustomId:n.id,sectionDisplayDescription:n.displayDescription,querySingleResource:t,minorServerVersion:r}),m&&p.addSection(m)}}}else m=await(async e=>{let{trackedEntityType:t,trackedEntityAttributes:r,optionSets:a,programTrackedEntityAttributes:o,querySingleResource:i,minorServerVersion:s}=e;const l=new it.wn((e=>{e.id=it.wn.MAIN_SECTION_ID,e.name=n.A.t("Profile")}));if(null===o||void 0===o||!o.length)return null;const d=BK(t);return d&&l.addElement(d),await $K({programTrackedEntityAttributes:o,trackedEntityAttributes:r,optionSets:a,section:l,querySingleResource:i,minorServerVersion:s}),l})({trackedEntityType:i,trackedEntityAttributes:c,optionSets:u,programTrackedEntityAttributes:s,querySingleResource:t,minorServerVersion:r}),m&&p.addSection(m);return p},zK=(e,t)=>{const[r,n]=(0,y.useState)({}),a=(0,A.ow)(),{serverVersion:{minor:o}}=(0,A.UK)();return(0,y.useEffect)((()=>{const r=D(a.query.bind(a));(async(e,t,r,n,a)=>{const o=await HK(e,r,n,a)||{};t&&t(o)})(e,n,r,o,t)}),[e,a,o,t]),r},YK=e=>{const{programRules:t,loading:r}=(e=>{var t,r;const[n,a]=(0,y.useState)(0),[o,i]=(0,y.useState)([]),{error:s,loading:l,data:d,called:c,refetch:u}=(0,A.iO)((0,y.useMemo)((()=>({programRules:{resource:"programRules",params:t=>{let{variables:r}=t;return{filter:`program.id:eq:${e}`,fields:"id,displayName,condition,description,program[id],programStage[id],priority,programRuleActions[id,content,displayContent,location,data,programRuleActionType,programStageSection[id],dataElement[id],trackedEntityAttribute[id],programStage[id],optionGroup[id],option[id]]",page:r.page}}}})),[e]),{lazy:!0});return(0,y.useEffect)((()=>{var e,t,r;(!c||!l&&(null===d||void 0===d||null===(e=d.programRules)||void 0===e||null===(t=e.pager)||void 0===t?void 0:t.nextPage))&&(u({variables:{page:n+1}}),a(n+1)),d&&d.programRules&&(null===(r=d.programRules.pager)||void 0===r?void 0:r.total)>o.length&&i([...o,...d.programRules.programRules])}),[d,c,l,u,i,n,o]),{error:s,loading:(null===d||void 0===d||null===(t=d.programRules)||void 0===t||null===(r=t.pager)||void 0===r?void 0:r.total)!==o.length,programRules:o}})(e.id),{constants:n}=(()=>{var e;const{error:t,loading:r,data:n}=(0,A.iO)((0,y.useMemo)((()=>({constants:{resource:"constants",params:{fields:"id,displayName,value"}}})),[]));return{error:t,constants:!r&&(null===n||void 0===n||null===(e=n.constants)||void 0===e?void 0:e.constants)}})(),[a,o]=(0,y.useState)({});return(0,y.useEffect)((()=>{!r&&n&&gK({programAPI:e,setRulesContainer:o,programRules:t,constants:n})}),[e,r,t,n]),a},qK=e=>{let{formFoundation:t,orgUnit:r,clientAttributesWithSubvalues:n}=e;const[a,o]=(0,y.useState)({}),[i,s]=(0,y.useState)({}),l=(0,y.useRef)(!1),d=(0,A.ow)();return(0,y.useEffect)((()=>{if(null!==r&&void 0!==r&&r.id&&Object.entries(t).length>0&&0===Object.entries(a).length&&!1===l.current){const e={orgUnitCode:r.code},a=D(d.query.bind(d));l.current=!0,(async e=>{let{foundation:t,clientAttributesWithSubvalues:r=[],staticPatternValues:n,setFormValues:a,setClientValues:o,querySingleResource:i}=e;const s=null===r||void 0===r?void 0:r.reduce(((e,t)=>({...e,[t.attribute]:t.value})),{}),l=null===r||void 0===r?void 0:r.reduce(((e,t)=>({...e,[t.attribute]:xt(t.value,t.valueType)})),{}),d=await $A(t,r,n,i);a&&a({...l,...d}),o&&o({...s,...d})})({foundation:t,clientAttributesWithSubvalues:n,staticPatternValues:e,setFormValues:o,setClientValues:s,querySingleResource:a})}}),[t,n,a,l,r,d]),{formValues:a,clientValues:i}},KK=e=>Et(e,it.CO.DATE),QK=(e,t)=>e.reduce(((e,r)=>{let{dataElement:n,value:a}=r;const o=t[n];return o&&(e[n]=Et(a,o.valueType)),e}),{}),XK=(e,t)=>{const r=(0,y.useMemo)((()=>(e=>e?e.events.reduce(((e,t)=>(t.orgUnit&&e.push(t.orgUnit),e)),[]):[])(e)),[e]),{orgUnitNames:n}=ui(r);return(0,y.useMemo)((()=>e&&n&&e.events.map((e=>({eventId:e.event,programId:e.program,programStageId:e.programStage,orgUnitId:e.orgUnit,orgUnitName:n[e.orgUnit],trackedEntityInstanceId:e.trackedEntity,enrollmentId:e.enrollment,enrollmentStatus:e.enrollmentStatus,status:e.status,occurredAt:KK(e.occurredAt),scheduledAt:KK(e.scheduledAt),...QK(e.dataValues,t)})))),[t,e,n])},JK=e=>(0,y.useMemo)((()=>e&&e.programStages&&(e=>[...e.programStages.values()].reduce(((e,t)=>{return{...e,...(r=t.programStageDataElements,r.reduce(((e,t)=>({...e,[t.dataElement.id]:{displayInReports:t.displayInReports,displayInList:t.displayInList,displayInForms:t.displayInForms,compulsory:t.compulsory,...t.dataElement}})),{}))};var r}),{}))(e)),[e]),ZK=e=>{var t;return e&&(null===(t=Object.values(e))||void 0===t?void 0:t.reduce(((e,t)=>{const{optionSet:r}=t;if(r){const{valueType:t,options:n,id:a}=r;return{...e,[a]:{...r,options:n.map((e=>({...e,code:Et(e.code,t)})))}}}return e}),{}))},eQ=(e,t)=>(0,y.useMemo)((()=>({...ZK(e),...ZK(t)})),[e,t]),tQ=e=>(0,y.useMemo)((()=>(e=>{var t;return null===e||void 0===e||null===(t=e.programTrackedEntityAttributes)||void 0===t?void 0:t.reduce(((e,t)=>({...e,[t.trackedEntityAttribute.id]:t.trackedEntityAttribute})),{})})(e)),[e]),rQ=(e,t,r,n)=>{let a=e&&e[n]?e[n]:[];return r&&(a=e[`${n}OnComplete`]?[...a,...e[`${n}OnComplete`]]:a,a=Object.values(t).reduce(((e,t)=>t[`${n}OnComplete`]?[...e,{message:t[`${n}OnComplete`],id:(0,yc.A)()}]:e),a)),a},nQ=e=>{let{featureType:t,geometry:r}=e;const[n,a]=(0,y.useState)({}),[o,i]=(0,y.useState)({});return(0,y.useEffect)((()=>{if(r&&Object.keys(iK).includes(t)){const e=lK(t),n=Et(r.coordinates,e),o=xt(n,e),s=sK(t);a({[s]:o}),i({[s]:n})}}),[r,t]),{formGeometryValues:n,clientGeometryValues:o}},aQ=e=>{let{programAPI:t,orgUnitId:r,onCancel:a,onDisable:o,clientAttributesWithSubvalues:i,userRoles:s,modalState:d,trackedEntityInstanceId:c,onSaveSuccessActionType:u,onSaveErrorActionType:p,onSaveExternal:m,geometry:g,trackedEntityName:h,dataEntryFormConfig:E}=e;const v="trackedEntityProfile",f="edit",I=(0,gs.wA)(),[b,S]=(0,y.useState)(!1),T=UK({programAPI:t,orgUnitId:r,clientAttributesWithSubvalues:i,userRoles:s,dataEntryId:v,itemId:f,geometry:g,dataEntryFormConfig:E}),{formFoundation:A}=T,{formValidated:C,errorsMessages:O,warningsMessages:N}=((e,t,r)=>{const a=`${e}-${t}`,{rulesEffectsGeneralErrors:o={},rulesEffectsGeneralWarnings:i={},rulesEffectsMessages:s={},formsSectionsFieldsUI:l={}}=(0,gs.d4)((e=>({rulesEffectsGeneralErrors:e.rulesEffectsGeneralErrors&&e.rulesEffectsGeneralErrors[a],rulesEffectsGeneralWarnings:e.rulesEffectsGeneralWarnings&&e.rulesEffectsGeneralWarnings[a],rulesEffectsMessages:e.rulesEffectsMessages&&e.rulesEffectsMessages[a],formsSectionsFieldsUI:e.formsSectionsFieldsUI&&e.formsSectionsFieldsUI[a]}))),d=(0,y.useMemo)((()=>Object.values(l).every((e=>{let{valid:t}=e;return!0===t}))),[l]),c=(0,y.useMemo)((()=>Object.values(s).every((e=>{let{error:t,errorOnComplete:r}=e;return!t&&!r}))&&!o.errors&&!o.errorOnComplete),[s,o]),u=d&&c;let p=r&&!u?[{id:(0,yc.A)(),message:n.A.t("Fix errors in the form to continue.")}]:[];return p=[...p,...rQ(o,s,r,"error")],{errorsMessages:p,warningsMessages:rQ(i,s,r,"warning"),formValidated:u}})(v,f,b),R=(0,y.useCallback)((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return I(((e,t)=>{const r=(0,yc.A)(),{orgUnit:n,trackedEntityAttributes:a,optionSets:o,rulesContainer:i,formFoundation:s,state:l,otherEvents:d,dataElements:c,enrollment:u,userRoles:p}=e,{dataEntryId:m,itemId:g,elementId:h,value:E,uiState:y}=t.payload||{},v=`${m}-${g}`,f=od(l,s,v,{elementId:h,value:E,valid:null===y||void 0===y?void 0:y.valid}),I=EK({foundation:s,formId:v,orgUnit:n,enrollmentData:u,teiValues:f,trackedEntityAttributes:a,optionSets:o,rulesContainer:i,otherEvents:d,dataElements:c,userRoles:p});return(0,Xd.OJ)([t,...I,av(m,g,r),nv(m,g,r)],bK)})(T,...t))}),[I,T]),w=(0,y.useCallback)((e=>{I(e)}),[I]),_=(0,y.useCallback)((()=>({programId:t.id,orgUnitId:r,trackedEntityInstanceId:c,trackedEntityTypeId:t.trackedEntityType.id})),[t,r,c]),P=(0,y.useCallback)((()=>{S(!0),C&&(o(),I(PK(!1)),I((e=>{let{itemId:t,dataEntryId:r,orgUnitId:n,trackedEntityTypeId:a,trackedEntityInstanceId:o,onSaveExternal:i,onSaveSuccessActionType:s,onSaveErrorActionType:d,formFoundation:c}=e;return l(AK)({itemId:t,dataEntryId:r,orgUnitId:n,trackedEntityTypeId:a,trackedEntityInstanceId:o,formFoundation:c,onSaveExternal:i,onSaveSuccessActionType:s,onSaveErrorActionType:d})})({itemId:f,dataEntryId:v,orgUnitId:r,trackedEntityInstanceId:c,trackedEntityTypeId:t.trackedEntityType.id,onSaveExternal:m,onSaveSuccessActionType:u,onSaveErrorActionType:p,formFoundation:A})))}),[I,f,v,r,c,t,C,A,m,u,p,o]);return Object.entries(A).length>0&&y.createElement(DK,{dataEntryId:v,itemId:f,onCancel:a,onSave:P,saveAttempted:b,trackedEntityName:h,formFoundation:A,onUpdateFormField:R,onUpdateFormFieldAsync:w,modalState:d,onGetValidationContext:_,errorsMessages:O,warningsMessages:N,orgUnit:{id:r}})},oQ=(0,j.Fs)(Mi,_i),iQ=e=>Object.values(iK).find((t=>t.FEATURETYPE===e)),sQ=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).filter((e=>!iQ(e))).map((t=>({attribute:t,value:e[t]})))},lQ=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).filter((e=>iQ(e))).reduce(((t,r)=>(e=>{if(e)return Array.isArray(e)?{type:"Polygon",coordinates:e}:e.longitude&&e.latitude?{type:"Point",coordinates:[e.longitude,e.latitude]}:void 0})(e[r])),void 0)},dQ=n.A.t("tracked entity instance"),cQ=e=>{if(null!==e&&void 0!==e&&e.value){const t=dK(e);return"string"===typeof t?t:""}return""},uQ=(e,t,r)=>{const n=cQ(e.find((e=>{let{attribute:r}=e;return r===t}))),a=cQ(e.find((e=>{let{attribute:t}=e;return t===r})));return n||a?`${n}${n&&" "}${a}`:""},pQ=(e,t,r)=>{if(!e||!t)return r||dQ;const n=((e,t)=>{const[r,n]=t.filter((e=>{let{displayInList:t}=e;return t})).map((e=>{let{trackedEntityAttribute:t}=e;return t.id}));return uQ(e,r,n)})(t,e);if(n)return n;const a=((e,t)=>{const[r,n]=t.map((e=>{let{id:t}=e;return t}));return uQ(e,r,n)})(t,e);return a||(r||dQ)},mQ=Object.freeze({CREATED:"CREATE",DELETED:"DELETE",UPDATED:"UPDATE"}),gQ=Object.freeze({EVENT:"event",TRACKED_ENTITY:"trackedEntity"}),hQ=Object.freeze({[gQ.EVENT]:"events",[gQ.TRACKED_ENTITY]:"trackedEntities"}),EQ="default";var yQ=r(37851),vQ=r(44783);const fQ=e=>{let{sortDirection:t,setSortDirection:r}=e;return y.createElement(AR.n,null,y.createElement(SR.J,null,y.createElement(fR.w,{onSortIconClick:e=>{let{direction:t}=e;return r(t)},sortDirection:t,fixed:!0,top:"0",width:"140px"},n.A.t("Date")),y.createElement(fR.w,{fixed:!0,top:"0",width:"125px"},n.A.t("User")),y.createElement(fR.w,{fixed:!0,top:"0",width:"125px"},n.A.t("Data item")),y.createElement(fR.w,{fixed:!0,top:"0",width:"85px"},n.A.t("Change")),y.createElement(fR.w,{fixed:!0,top:"0",width:"275px"},n.A.t("Value"))))},IQ={[mQ.UPDATED]:{label:n.A.t("Updated"),variant:{neutral:!0}},[mQ.CREATED]:{label:n.A.t("Created"),variant:{positive:!0}},[mQ.DELETED]:{label:n.A.t("Deleted"),variant:{negative:!0}}},bQ=e=>{let{label:t,variant:r}=e;return y.createElement(Mt.v,r,t)},SQ=e=>{let{changeType:t}=e;const r=IQ[t];return r?y.createElement(bQ,r):(S().error((0,j.px)("Changelog component not found")({changeType:t})),null)},TQ={container:{alignItems:"center",display:"flex"},previousValue:{color:vn.T.grey700},currentValue:{color:vn.T.grey900},updatePreviousValue:{color:vn.T.grey700,maxWidth:"45%"},updateCurrentValue:{color:vn.T.grey900,maxWidth:"45%"},updateArrow:{display:"inline-flex",alignItems:"center",margin:`${yn.Q.dp4}`}},AQ={[mQ.UPDATED]:e=>{let{previousValue:t,currentValue:r,classes:n}=e;return y.createElement("div",{className:n.container},y.createElement("span",{className:n.updatePreviousValue},t),y.createElement("span",{className:n.updateArrow},y.createElement(gI.A,null)),y.createElement("span",{className:n.updateCurrentValue},r))},[mQ.CREATED]:e=>{let{currentValue:t,classes:r}=e;return y.createElement("div",{className:r.container},y.createElement("span",{className:r.currentValue},t))},[mQ.DELETED]:e=>{let{previousValue:t,classes:r}=e;return y.createElement("div",{className:r.container},y.createElement("span",{className:r.previousValue},t))}},CQ=(0,I.withStyles)(TQ)((e=>{let{changeType:t,currentValue:r,previousValue:n,classes:a}=e;const o=AQ[t];return o?y.createElement(o,{classes:a,previousValue:n,currentValue:r}):(S().error((0,j.px)("Changelog component not found")({changeType:t})),null)})),OQ=(0,I.withStyles)({dataItemColumn:{wordWrap:"break-word",hyphens:"auto"},valueColumn:{wordWrap:"break-word"}})((e=>{let{record:t,classes:r}=e;return y.createElement(SR.J,null,y.createElement(IR.B,null,t.date),y.createElement(IR.B,null,t.user),y.createElement(IR.B,{className:r.dataItemColumn},t.dataItemLabel),y.createElement(IR.B,null,y.createElement(SQ,{changeType:t.changeType})),y.createElement(IR.B,{className:r.valueColumn},y.createElement(CQ,t)))})),NQ=e=>{let{isOpen:t,close:r,records:a,pager:o,setPage:i,setPageSize:s,sortDirection:l,setSortDirection:d}=e;return y.createElement(N.a,{large:!0,hide:!t,dataTest:"changelog-modal",onClose:r},y.createElement(Ip.w,null,n.A.t("Changelog")),y.createElement(R.$,null,y.createElement(TR.b,{fixed:!0,dataTest:"changelog-data-table",layout:"fixed"},y.createElement(fQ,{sortDirection:l,setSortDirection:d}),a&&a.length>0?y.createElement(CR.B,{dataTest:"changelog-data-table-body"},null===a||void 0===a?void 0:a.map((e=>y.createElement(OQ,{key:e.reactKey,record:e})))):y.createElement(CR.B,null,y.createElement(SR.J,null,y.createElement(IR.B,{align:"center",colSpan:"4"},n.A.t("No changes to display")))),o&&y.createElement(yQ.B,null,y.createElement(SR.J,null,y.createElement(IR.B,{colSpan:"5"},y.createElement(vQ.d,{page:o.page,pageSize:o.pageSize,onPageChange:i,onPageSizeChange:s,isLastPage:!o.nextPage,dataTest:"changelog-pagination"})))))),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{onClick:r,secondary:!0},n.A.t("Close")))))},RQ=e=>{let{entityId:t,entityType:r,programId:n,isOpen:a,close:o,dataItemDefinitions:i}=e;const{records:s,pager:l,isLoading:d,setPage:c,setPageSize:u,sortDirection:p,setSortDirection:m}=(e=>{let{entityId:t,entityType:r,programId:n,dataItemDefinitions:a}=e;const[o,i]=(0,y.useState)(1),[s,l]=(0,y.useState)(10),[d,c]=(0,y.useState)(EQ),{fromServerDate:u}=(0,A.Bp)(),{data:p,isLoading:m,isError:g}=ai(["changelog",r,t,{sortDirection:d,page:o,pageSize:s,programId:n}],{resource:`tracker/${hQ[r]}/${t}/changeLogs`,params:{page:o,pageSize:s,program:n,order:d===EQ?void 0:`createdAt:${d}`}},{enabled:!!t}),h=(0,y.useMemo)((()=>{if(p)return p.changeLogs.map((e=>{const{change:t,createdAt:r,createdBy:n}=e,o=Object.keys(t)[0],i=t[o],{metadataElement:s,fieldId:l}=((e,t,r)=>{const{dataElement:n,attribute:a}=t,o=null!==n&&void 0!==n?n:a;return{metadataElement:o?r[o]:r[e],fieldId:o}})(o,i,a);if(!s)return S().error((0,j.px)("Could not find metadata for element")({...e})),null;const{firstName:d,surname:c,username:p}=n,{options:m}=s,g=bi(Et(i.previousValue,s.type),s.type,m),h=bi(Et(i.currentValue,s.type),s.type,m);return{reactKey:(0,yc.A)(),date:$()(u(r)).format("YYYY-MM-DD HH:mm"),user:`${d} ${c} (${p})`,dataItemId:l,changeType:e.type,dataItemLabel:s.name,previousValue:g,currentValue:h}})).filter(Boolean)}),[p,a,u]);return{records:h,pager:null===p||void 0===p?void 0:p.pager,setPage:i,setPageSize:e=>{i(1),l(e)},sortDirection:d,setSortDirection:c,isLoading:m,isError:g}})({entityId:t,entityType:r,programId:n,dataItemDefinitions:i});return d?y.createElement(N.a,{onClose:o},y.createElement(_,null)):y.createElement(NQ,{isOpen:a,close:o,records:s,pager:l,setPage:c,setPageSize:u,sortDirection:p,setSortDirection:m})};function wQ(){return wQ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wQ.apply(this,arguments)}const _Q=e=>{let{eventId:t,setIsOpen:r,...n}=e;return y.createElement(RQ,wQ({},n,{close:()=>r(!1),entityId:t,entityType:gQ.EVENT}))};function PQ(){return PQ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PQ.apply(this,arguments)}const kQ=e=>{let{teiId:t,programId:r,close:n,...a}=e;return y.createElement(RQ,PQ({},a,{close:n,entityId:t,programId:r,entityType:gQ.TRACKED_ENTITY}))},DQ=Object.freeze({ALL:"ALL"}),UQ=e=>{let{authorities:t}=e;const r={select:e=>{let{authorities:r}=e;return r&&t.some((e=>r.includes(DQ.ALL)||r.includes(e)))}},{data:n}=ni(["authorities"],{resource:"me.json",params:{fields:"authorities"}},r);return{hasAuthority:Boolean(n)}},LQ=e=>{let{trackedEntityTypeName:t,canCascadeDeleteTei:r,canWriteData:a,setActionsIsOpen:o,setDeleteModalIsOpen:i}=e;const s=(0,y.useMemo)((()=>!a||!r),[a,r]),l=((e,t)=>e?n.A.t("You do not have access to delete this {{trackedEntityTypeName}}",{trackedEntityTypeName:t,interpolation:{escapeValue:!1}}):"")(s,t);return y.createElement(aI,{content:l,enabled:s},y.createElement(bh.D,{destructive:!0,dense:!0,icon:y.createElement(hI.A,null),label:n.A.t("Delete {{trackedEntityTypeName}}",{trackedEntityTypeName:t,interpolation:{escapeValue:!1}}),onClick:()=>{i(!0),o(!1)},disabled:s}))},FQ={resource:"tracker?async=false&importStrategy=DELETE",type:"create",data:e=>({trackedEntities:[e]})},xQ=(e,t)=>{const[r,{loading:n}]=(0,A.r8)(FQ,{onComplete:()=>{e&&e()},onError:e=>{t&&t((e=>{var t,r;const n=null===e||void 0===e||null===(t=e.details)||void 0===t||null===(r=t.validationReport)||void 0===r?void 0:r.errorReports;return(null===n||void 0===n?void 0:n.length)>0?n:[{uid:(0,yc.A)(),message:e.message}]})(e))}});return{deleteMutation:r,deleteLoading:n}},MQ=e=>{let{trackedEntityTypeName:t,trackedEntity:r,setOpenModal:a,onDeleteSuccess:o}=e;const[i,s]=(0,y.useState)([]),{deleteMutation:l,deleteLoading:d}=xQ(o,(e=>{s(e)}));return y.createElement(N.a,{dataTest:"widget-profile-delete-modal"},y.createElement(Ip.w,null,n.A.t("Delete {{trackedEntityTypeName}}",{trackedEntityTypeName:t,interpolation:{escapeValue:!1}})),y.createElement(R.$,null,y.createElement("p",null,n.A.t("Are you sure you want to delete this {{trackedEntityTypeName}}? This will permanently remove the {{trackedEntityTypeName}} and all its associated enrollments and events in all programs.",{trackedEntityTypeName:t,interpolation:{escapeValue:!1}})),i.length>0&&y.createElement(zm.I,{title:n.A.t("There was a problem deleting the {{trackedEntityTypeName}}",{trackedEntityTypeName:t,interpolation:{escapeValue:!1}}),error:!0},y.createElement("ul",null,i.map((e=>y.createElement("li",{key:e.uid},e.message)))))),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:()=>a(!1),secondary:!0},n.A.t("No, cancel")),y.createElement(ra.$,{onClick:()=>l(r),primary:!0,loading:d,destructive:!0},n.A.t("Yes, delete {{trackedEntityTypeName}}",{trackedEntityTypeName:t,interpolation:{escapeValue:!1}})))))};function VQ(){return VQ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},VQ.apply(this,arguments)}const jQ=e=>{let{programAPI:t,teiId:r,setIsOpen:n,...a}=e;const o=zK(t),i=(0,y.useMemo)((()=>{var e;if(null===(e=Object.keys(o))||void 0===e||!e.length)return{};const t=o.getElements(),r=o.getLabels(),n=t.reduce(((e,t)=>{const{optionSet:r}=t,n={id:t.id,name:t.formName,type:t.type,optionSet:void 0,options:void 0};return r&&r.options&&(n.optionSet=r.id,n.options=r.options.map((e=>({code:e.value,name:e.text})))),e[t.id]=n,e}),{}),a=Object.keys(r).reduce(((e,t)=>(e[t]={id:t,name:r[t],type:it.CO.DATE},e)),{});return{...n,...a}}),[o]);return y.createElement(kQ,VQ({},a,{teiId:r,close:()=>n(!1),programId:t.id,dataItemDefinitions:i}))},GQ=e=>{let{trackedEntity:t,trackedEntityTypeName:r,canWriteData:a,canCascadeDeleteTei:o,onDeleteSuccess:i,displayChangelog:s,teiId:l,programAPI:d}=e;const[c,u]=(0,y.useState)(!1),[p,m]=(0,y.useState)(!1),[g,h]=(0,y.useState)(!1);return y.createElement(y.Fragment,null,y.createElement(wI,{open:c,onClick:()=>u((e=>!e)),icon:y.createElement(DH.A,null),small:!0,secondary:!0,dataTest:"widget-profile-overflow-menu",component:y.createElement(AI.n,{dense:!0},s&&y.createElement(y.Fragment,null,y.createElement(bh.D,{label:n.A.t("View changelog"),onClick:()=>{h(!0),u(!1)}}),y.createElement(DW.N,{dense:!0})),y.createElement(LQ,{trackedEntityTypeName:r,canWriteData:a,canCascadeDeleteTei:o,setActionsIsOpen:u,setDeleteModalIsOpen:m}))}),p&&y.createElement(MQ,{trackedEntityTypeName:r,trackedEntity:t,setOpenModal:m,onDeleteSuccess:i}),g&&y.createElement(jQ,{teiId:l,programAPI:d,isOpen:g,setIsOpen:h}))},BQ=e=>{let{trackedEntityTypeName:t,canWriteData:r,trackedEntity:n,onDeleteSuccess:a,displayChangelog:o,teiId:i,programAPI:s}=e;const{hasAuthority:l}=UQ({authorities:["F_TEI_CASCADE_DELETE"]});return y.createElement(GQ,{trackedEntityTypeName:t,canWriteData:r,canCascadeDeleteTei:l,trackedEntity:n,onDeleteSuccess:a,displayChangelog:o,teiId:i,programAPI:s})},$Q={header:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},container:{padding:`0 ${yn.Q.dp16}`,marginBottom:yn.Q.dp8},actions:{display:"flex",gap:"4px"}},WQ=(0,I.withStyles)($Q)((e=>{var t;let{teiId:r,programId:a,readOnlyMode:o=!1,orgUnitId:i="",onUpdateTeiAttributeValues:s,onDeleteSuccess:l,classes:d}=e;const c=(0,j.iT)(j.Gv.changelogs),u=(0,Zo.useQueryClient)(),[p,m]=(0,y.useState)(!0),[g,h]=(0,y.useState)(IK),{loading:E,program:v,error:f}=Kq(a),{storedAttributeValues:I,storedGeometry:b,hasError:T}=(0,gs.d4)((e=>{let{trackedEntityInstance:t}=e;return{storedAttributeValues:null===t||void 0===t?void 0:t.attributeValues,storedGeometry:null===t||void 0===t?void 0:t.geometry,hasError:null===t||void 0===t?void 0:t.hasError}})),{configIsFetched:C,dataEntryFormConfig:O}=Ed({selectedScopeId:a}),{loading:N,error:R,trackedEntity:w,trackedEntityInstanceAttributes:P,trackedEntityTypeName:k,trackedEntityTypeAccess:U,geometry:L}=((e,t,r,n)=>{var a,o,i,s,l;const[d,c]=(0,y.useState)([]),[u,p]=(0,y.useState)(),{error:m,loading:g,data:h}=(0,A.iO)((0,y.useMemo)((()=>({trackedEntityInstance:{resource:"tracker/trackedEntities",id:e,params:{program:t}}})),[e,t])),{loading:E,data:v,refetch:f}=(0,A.iO)((0,y.useMemo)((()=>({trackedEntityType:{resource:"trackedEntityTypes",id:e=>{let{variables:{tetId:t}}=e;return t},params:{fields:"displayName,access"}}})),[]),{lazy:!0});return(0,y.useEffect)((()=>{var e,t,r;(null===h||void 0===h||null===(e=h.trackedEntityInstance)||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.length)>0&&c(null===h||void 0===h||null===(r=h.trackedEntityInstance)||void 0===r?void 0:r.attributes.map((e=>{let{attribute:t,value:r}=e;return{attribute:t,value:r}})))}),[null===h||void 0===h||null===(a=h.trackedEntityInstance)||void 0===a?void 0:a.attributes]),(0,y.useEffect)((()=>{var e,t;null!==h&&void 0!==h&&null!==(e=h.trackedEntityInstance)&&void 0!==e&&e.geometry&&p(null===h||void 0===h||null===(t=h.trackedEntityInstance)||void 0===t?void 0:t.geometry)}),[null===h||void 0===h||null===(o=h.trackedEntityInstance)||void 0===o?void 0:o.geometry]),(0,y.useEffect)((()=>{(null===r||void 0===r?void 0:r.length)>0&&c(r)}),[r]),(0,y.useEffect)((()=>{var e,t;null!==h&&void 0!==h&&null!==(e=h.trackedEntityInstance)&&void 0!==e&&e.trackedEntityType&&f({variables:{tetId:null===h||void 0===h||null===(t=h.trackedEntityInstance)||void 0===t?void 0:t.trackedEntityType}})}),[null===h||void 0===h||null===(i=h.trackedEntityInstance)||void 0===i?void 0:i.trackedEntityType,f]),(0,y.useEffect)((()=>{void 0!==n&&p(n)}),[n]),{error:m,loading:g,trackedEntity:!g&&(null===h||void 0===h?void 0:h.trackedEntityInstance),trackedEntityInstanceAttributes:!g&&d,trackedEntityTypeName:!E&&(null===v||void 0===v||null===(s=v.trackedEntityType)||void 0===s?void 0:s.displayName),trackedEntityTypeAccess:!E&&(null===v||void 0===v||null===(l=v.trackedEntityType)||void 0===l?void 0:l.access),geometry:u}})(r,a,I,b),{loading:F,error:x,userRoles:M}=(()=>{const{error:e,loading:t,data:r}=(0,A.iO)((0,y.useMemo)((()=>({userData:{resource:"me.json",params:{fields:"userCredentials[userRoles]"}}})),[])),n=(0,y.useMemo)((()=>!t&&r&&r.userData&&r.userData.userCredentials&&r.userData.userCredentials.userRoles.map((e=>{let{id:t}=e;return t}))),[t,r]);return{error:e,loading:t,userRoles:n}})(),V=(0,y.useMemo)((()=>{var e;return P.length>0&&(null===U||void 0===U||null===(e=U.data)||void 0===e?void 0:e.write)&&!o}),[P,o,U]),G=E||N||F||!C,B=f||R||x,$=((e,t,r)=>{const n=(0,A.ow)(),{baseUrl:a,apiVersion:o,serverVersion:{minor:i}}=(0,A.UK)(),s=(0,j.c$)(a,`api/${o}`),[l,d]=(0,y.useState)([]),c=(0,y.useCallback)((async()=>{if(t&&r){const a=D(n.query.bind(n)),{programTrackedEntityAttributes:o}=t,l=await o.reduce((async(n,o)=>{const{displayInList:l,trackedEntityAttribute:{id:d,optionSet:c,valueType:u,unique:p,displayFormName:m}}=o,g=null===r||void 0===r?void 0:r.find((e=>e.attribute===d));let h;g&&(h=Xq[u]?await Xq[u]({attribute:{value:g.value,id:d,teiId:e,programId:t.id,absoluteApiPath:s},querySingleResource:a,minorServerVersion:i}):Et(g.value,u));const E=await n;return Vi(u,c)?(S().error((0,j.px)("could not create the metadata because a MULIT_TEXT without associated option sets was found")({optionSet:c})),E):[...E,{attribute:d,key:m,optionSet:c,displayInList:l,value:h,unique:p,valueType:u}]}),Promise.resolve([]));d(l)}}),[t,r,n,e,s,i]);return(0,y.useEffect)((()=>{c()}),[c]),l})(r,v,P),W=((e,t,r,n)=>(0,y.useMemo)((()=>{var a;const o=null===e||void 0===e||null===(a=e.trackedEntityType)||void 0===a?void 0:a.trackedEntityTypeAttributes,i=r.map((e=>{var r;return{...e,value:null===(r=t.find((t=>t.attribute===e.attribute)))||void 0===r?void 0:r.value}}));return pQ(o,i,n)}),[e,t,r,n]))(v,I,$,r),H=c&&v&&(null===(t=v.trackedEntityType)||void 0===t?void 0:t.changelogEnabled),z=(0,y.useMemo)((()=>$.filter((e=>e.displayInList)).map((e=>{const{attribute:t,key:r,valueType:n}=e;return{attribute:t,key:r,value:dK(e),valueType:n,reactKey:t}}))),[$]),Y=(0,y.useCallback)((()=>{u.removeQueries([ei,"changelog",gQ.TRACKED_ENTITY,r])}),[u,r]);(0,y.useEffect)((()=>{T&&h(vK)}),[T]),(0,y.useEffect)((()=>{(null===I||void 0===I?void 0:I.length)>0&&(h(IK),s&&s(I,W))}),[I,s,W]);const q=(0,y.useMemo)((()=>{var e,t,r;return(null===U||void 0===U||null===(e=U.data)||void 0===e?void 0:e.write)&&(null===v||void 0===v||null===(t=v.access)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.write)}),[U,v]);return y.createElement("div",{"data-test":"profile-widget"},y.createElement(Ib,{header:y.createElement("div",{className:d.header},y.createElement("div",null,n.A.t("{{trackedEntityTypeName}} profile",{trackedEntityTypeName:k,interpolation:{escapeValue:!1}})),y.createElement("div",{className:d.actions},V&&y.createElement(ra.$,{onClick:()=>h(yK),secondary:!0,small:!0},n.A.t("Edit")),y.createElement(BQ,{trackedEntityTypeName:k,canWriteData:q,trackedEntity:w,onDeleteSuccess:l,displayChangelog:H,teiId:r,programAPI:v}))),onOpen:(0,y.useCallback)((()=>m(!0)),[m]),onClose:(0,y.useCallback)((()=>m(!1)),[m]),open:p},G?y.createElement(_,null):B?(S().error((0,j.px)("Profile widget could not be loaded")({error:B})),y.createElement("span",null,n.A.t("Profile widget could not be loaded. Please try again later"))):y.createElement("div",{className:d.container},y.createElement(Yo,{dataTest:"profile-widget-flatlist",list:z}))),((e,t,r,n)=>!e&&!t&&r&&n!==IK)(G,B,V,g)&&y.createElement(y.Fragment,null,y.createElement(aQ,{onCancel:()=>h(IK),onDisable:()=>h(fK),programAPI:v,dataEntryFormConfig:O,orgUnitId:i,clientAttributesWithSubvalues:$,userRoles:M,trackedEntityInstanceId:r,onSaveSuccessActionType:CK,onSaveErrorActionType:OK,onSaveExternal:Y,modalState:g,geometry:L,trackedEntityName:k}),y.createElement(iH,{formId:"trackedEntityProfile-edit"})))}));var HQ=r(22572),zQ=r(15342);const YQ=Object.freeze({ACTIVE:"ACTIVE",COMPLETED:"COMPLETED",CANCELLED:"CANCELLED"}),qQ=Object.freeze({[YQ.ACTIVE]:n.A.t("Active"),[YQ.COMPLETED]:n.A.t("Completed"),[YQ.CANCELLED]:n.A.t("Cancelled")}),KQ=Object.freeze({ACTIVE:"ACTIVE",COMPLETED:"COMPLETED",VISITED:"VISITED",SCHEDULE:"SCHEDULE",OVERDUE:"OVERDUE",SKIPPED:"SKIPPED"}),QQ={status:{margin:`0 0 ${yn.U.dp4}px 0`}},XQ=(0,I.withStyles)(QQ)((e=>{let{status:t="",classes:r}=e;return y.createElement(y.Fragment,null,y.createElement(Mt.v,{className:r.status,neutral:t===YQ.ACTIVE,negative:t===YQ.CANCELLED},qQ[t]||t))}));var JQ=r(35440),ZQ=r(43900);const eX={editButton:{display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,cursor:"pointer",border:"none",borderRadius:"3px",background:"transparent",color:vn.T.grey600,padding:0,marginLeft:"2px","&:focus":{outline:"none",background:vn.T.grey200,color:vn.T.grey800},"&:hover":{background:vn.T.grey200,color:vn.T.grey800}},calendar:{paddingTop:"6px"},inputField:{maxWidth:"200px"},buttonStrip:{display:"flex",gap:`${yn.U.dp4}px`,margin:`${yn.U.dp4}px 0`},note:{fontSize:"12px",color:vn.T.grey700}},tX=(0,I.withStyles)(eX)((e=>{let{date:t,dateLabel:r,locale:a,editEnabled:o,displayAutoGeneratedEventWarning:i,onSave:s,classes:l}=e;const[d,c]=(0,y.useState)(!1),[u,p]=(0,y.useState)(),m=(0,y.useCallback)((e=>{let{calendarDateString:t}=e;p(t)}),[p]),g=String(Ci(t,it.CO.DATE));return d?y.createElement("div",{"data-test":"widget-enrollment-date"},y.createElement("div",{className:l.inputField},y.createElement(JQ.p,{calendar:"gregory",dense:!0,className:l.calendar,label:r,date:u,locale:a,onDateSelect:m})),y.createElement("div",{className:l.buttonStrip},y.createElement(ra.$,{primary:!0,small:!0,onClick:()=>{if(u){const e=$().utc(u,"YYYY-MM-DD").format("YYYY-MM-DDTHH:mm:ss.SSS");e!==t&&s(e)}c(!1)}},n.A.t("Save")),y.createElement(ra.$,{secondary:!0,small:!0,onClick:()=>c(!1)},n.A.t("Cancel"))),i&&y.createElement("div",{className:l.note},n.A.t("Existing dates for auto-generated events will not be updated."))):y.createElement("div",{className:l.row,"data-test":"widget-enrollment-date"},y.createElement("span",{"data-test":"widget-enrollment-icon-calendar"},y.createElement(lH.A,{color:vn.T.grey600})),r,": ",g,o&&y.createElement("button",{className:l.editButton,"data-test":"widget-enrollment-icon-edit-date",onClick:()=>{p($()(t).format("YYYY-MM-DD")),c(!0)}},y.createElement(ZQ.A,null)))}));var rX=r(4390);const nX=e=>{let{enrollment:t,onUpdate:r}=e;return t.status===YQ.CANCELLED?y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-reactivate",onClick:()=>r({...t,status:YQ.ACTIVE}),icon:y.createElement(rX.A,null),label:n.A.t("Reactivate")}):y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-cancel",onClick:()=>r({...t,status:YQ.CANCELLED}),icon:y.createElement(tw.A,null),destructive:!0,label:n.A.t("Mark as cancelled")})},aX=e=>{let{enrollment:t,events:r,onUpdate:a,setOpenCompleteModal:o}=e;const i=r.some((e=>e.status===KQ.ACTIVE));return y.createElement(y.Fragment,null,t.status===YQ.COMPLETED?y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-incomplete",onClick:()=>a({...t,status:YQ.ACTIVE}),icon:y.createElement(Oa.A,null),label:n.A.t("Mark incomplete")}):y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-complete",onClick:()=>i?(o(!0),null):a({...t,status:YQ.COMPLETED}),icon:y.createElement(Oa.A,null),label:n.A.t("Complete")}))},oX=e=>{let{programStagesWithActiveEvents:t,programStagesWithoutAccess:r,setOpenCompleteModal:a,onCompleteEnrollment:o,onCompleteEnrollmentAndEvents:i}=e;return y.createElement(N.a,{position:"middle",large:!0,dataTest:"widget-enrollment-complete-modal"},y.createElement(Ip.w,null,n.A.t("Complete enrollment")),y.createElement(R.$,null,y.createElement("p",null,n.A.t("Would you like to complete the enrollment and all active events as well?")),0!==Object.keys(t).length&&y.createElement(y.Fragment,null,n.A.t("The following events will be completed:"),Object.keys(t).map((e=>{const{count:r,name:a}=t[e];return y.createElement("ul",{key:e},n.A.t("{{count}} event in {{programStageName}}",{count:r,defaultValue:"{{count}} event in {{programStageName}}",defaultValue_plural:"{{count}} events in {{programStageName}}",programStageName:a,interpolation:{escapeValue:!1}}))}))),0!==Object.keys(r).length&&y.createElement(y.Fragment,null,n.A.t("The following events will not be completed due to lack of access:"),Object.keys(r).map((e=>{const{count:t,name:a}=r[e];return y.createElement("ul",{key:e},n.A.t("{{count}} event in {{programStageName}}",{count:t,defaultValue:"{{count}} event in {{programStageName}}",defaultValue_plural:"{{count}} events in {{programStageName}}",programStageName:a,interpolation:{escapeValue:!1}}))}))),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:()=>{a(!1),i()},primary:!0,dataTest:"widget-enrollment-actions-complete-button"},n.A.t("Yes, complete enrollment and events")),y.createElement(ra.$,{onClick:()=>{a(!1),o()},secondary:!0},n.A.t("Complete enrollment only")),y.createElement(ra.$,{onClick:()=>a(!1),secondary:!0},n.A.t("No, cancel"))))))},iX=e=>{let{enrollment:t,events:r,programStages:n,setOpenCompleteModal:a,onUpdateStatus:o}=e;const{fromClientDate:i}=(0,A.Bp)(),{programStagesWithActiveEvents:s,programStagesWithoutAccess:l}=(0,y.useMemo)((()=>r.reduce(((e,t)=>{const{name:r,access:a}=n.find((e=>e.id===t.programStage))||{},o=a.data.write?"programStagesWithActiveEvents":"programStagesWithoutAccess";return t.status===KQ.ACTIVE&&(e[o][t.programStage]?e[o][t.programStage].count+=1:e[o][t.programStage]={count:1,name:r}),e}),{programStagesWithActiveEvents:{},programStagesWithoutAccess:{}})),[r,n]),d=(0,y.useCallback)((()=>{const e={...t,status:YQ.COMPLETED};o(e,!0)}),[o,t]),c=(0,y.useCallback)((()=>{const e=i(new Date),a=new Date(e.getServerZonedISOString()),s=$()(a).format("YYYY-MM-DDTHH:mm:ss"),l=r.reduce(((e,t)=>{const{access:r}=n.find((e=>e.id===t.programStage))||{};return t.status===KQ.ACTIVE&&r.data.write?[...e,{...t,status:KQ.COMPLETED,updatedAt:s}]:e}),[]),d={...t,status:YQ.COMPLETED,events:l};o(d,!0)}),[r,o,n,t,i]);return y.createElement(oX,{programStagesWithActiveEvents:s,programStagesWithoutAccess:l,setOpenCompleteModal:a,onCompleteEnrollment:d,onCompleteEnrollmentAndEvents:c})},sX=e=>{let{canCascadeDeleteEnrollment:t,enrollment:r,onDelete:a}=e;const[o,i]=(0,y.useState)(!1),s=!t,l=n.A.t("You do not have access to delete this enrollment");return y.createElement(aI,{content:l,enabled:s},y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-delete",disabled:s,icon:y.createElement(hI.A,null),destructive:!0,label:n.A.t("Delete"),onClick:()=>i(!0)}),o&&y.createElement(N.a,{small:!0,onClose:()=>i(!1),dataTest:"widget-enrollment-actions-modal"},y.createElement(Ip.w,null,n.A.t("Delete enrollment")),y.createElement(R.$,null,n.A.t("Are you sure you want to delete this enrollment? This will permanently remove the current enrollment.")),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:()=>i(!1),secondary:!0},n.A.t("No, cancel")),y.createElement(ra.$,{destructive:!0,onClick:()=>a(r)},n.A.t("Yes, delete enrollment."))))))};var lX=r(28522);const dX=e=>{let{enrollment:t,onUpdate:r}=e;return t.followUp?y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-followup-remove",onClick:()=>r({...t,followUp:!1}),icon:y.createElement(lX.A,null),label:n.A.t("Remove mark for follow-up")}):y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-followup-mark",onClick:()=>r({...t,followUp:!0}),icon:y.createElement(lX.A,null),label:n.A.t("Mark for follow-up")})},cX=e=>{let{canAddNew:t,onlyEnrollOnce:r,tetName:a,onAddNew:o}=e;return t?y.createElement(aI,{content:n.A.t("Only one enrollment per {{tetName}} is allowed in this program",{tetName:a}),enabled:r},y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-add-new",onClick:o,icon:y.createElement(CH.A,null),label:n.A.t("Add new"),disabled:r})):null},uX=e=>{const{error:t,loading:r,data:n}=(0,A.iO)((0,y.useMemo)((()=>({program:{resource:`programs/${e}`,params:{fields:["displayIncidentDate,displayIncidentDateLabel,displayEnrollmentDateLabel,onlyEnrollOnce,trackedEntityType[displayName,access],programStages[autoGenerateEvent,name,access,id],access,featureType"]}}})),[e]));return{error:t,loading:r,program:null===n||void 0===n?void 0:n.program}},pX=e=>{let{enrollment:t,setOpenMap:r}=e;const a=(e=>{var t;const{program:{featureType:r},error:a}=uX(e.program);if(!a&&r&&["POINT","POLYGON"].includes(r)&&(null===(t=e.geometry)||void 0===t||!t.type))return"POINT"===r?n.A.t("Add coordinates"):n.A.t("Add area")})(t);return a?y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-add-location",icon:y.createElement(Na.A,null),label:a,onClick:()=>r(!0)}):null};function mX(e){return"number"===typeof e||"string"===typeof e&&null===e.match(/[^0-9.,-]+/)}const gX=e=>{if(!e)return!1;const{longitude:t,latitude:r}=e;if(!mX(r)||!mX(t))return!1;const n=parseInt(t,10),a=parseInt(r,10);return n>=-180&&n<=180&&a>=-90&&a<=90},hX=(0,Qn.k0)(ea.h),EX=(0,I.withStyles)((e=>({modalContent:{width:"100%"},map:{width:"100%",height:"calc(100vh - 380px)"},inputWrapper:{paddingTop:yn.Q.dp8,display:"flex"},inputContent:{flexGrow:1},fieldButton:{height:"42px !important",width:42,borderRadius:"0 !important"},errorContainer:{backgroundColor:e.palette.error.lighter,color:e.palette.error.main}})))((e=>{let{classes:t,center:r,setOpen:a,defaultValues:o,onSetCoordinates:i}=e;const[s,l]=(0,y.useState)(o),[d,c]=(0,y.useState)(),[u,p]=(0,y.useState)(null===s||void 0===s?void 0:s[0]),[m,g]=(0,y.useState)(null===s||void 0===s?void 0:s[1]),[h,E]=(0,y.useState)(!o),[v,f]=(0,y.useState)(!0),I=(0,y.useMemo)((()=>!BM(s,o)&&!v),[s,o,v]),b=e=>{if(h){const{lat:t,lng:r}=e.latlng,n=[t,r];f(!0),l(n),p(t),g(r)}},S=e=>{c(e),f(!0),p(e[0]),g(e[1]),l(e)};return y.createElement(N.a,{large:!0},y.createElement(Ip.w,null,n.A.t("Coordinates")),y.createElement(R.$,{className:t.modalContent},y.createElement(Xn.A,{center:null!==d&&void 0!==d?d:r,zoom:13,ref:e=>{null!==e&&void 0!==e&&e.leafletElement&&e.leafletElement.invalidateSize()},className:t.map,onClick:b},y.createElement(hX,{position:"topright",inputPlaceholder:"Search",closeResultsOnClick:!0,search:null,mapStateModifier:S,showMarker:!1,openSearchOnLoad:!0}),y.createElement(Jn.A,{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),s&&y.createElement(Zn.A,{position:s})),y.createElement("div",{className:er()({[t.errorContainer]:I})},y.createElement("div",{className:t.inputWrapper},y.createElement("div",{className:t.inputContent},y.createElement(ia,{label:n.A.t("Latitude"),value:u,classes:t,disabled:!h,onBlur:e=>{if(!e)return;const t=m||(null!==s&&void 0!==s&&s[1]?s[1]:void 0);if(!t)return;if(!gX({longitude:Number(t),latitude:Number(e)}))return l(null),void f(!1);f(!0);const r=[Number(e),t];l(r),c(r)},onChange:e=>{p(e)}})),y.createElement("div",{className:t.inputContent},y.createElement(ia,{label:n.A.t("Longitude"),value:m,classes:t,disabled:!h,onBlur:e=>{if(!e)return;const t=u||(null!==s&&void 0!==s&&s[1]?s[0]:void 0);if(!t)return;if(!gX({longitude:Number(e),latitude:Number(t)}))return l(null),void f(!1);f(!0);const r=[t,Number(e)];l(r),c(r)},onChange:e=>{g(e)}})),y.createElement("div",null,h?y.createElement(ra.$,{className:t.fieldButton,icon:y.createElement(tr.A,null),onClick:()=>{f(!0),l(null),p(null),g(null)}}):y.createElement(ra.$,{className:t.fieldButton,primary:!0,onClick:()=>{E(!0)}},n.A.t("Edit")))),I&&y.createElement("div",{className:t.inputWrapper},n.A.t("Please provide valid coordinates")))),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:()=>{c(r),l(o),o?(p(o[0]),g(o[1]),E(!1)):(p(null),g(null)),a(!1)},secondary:!0},n.A.t("Cancel")),y.createElement(ra.$,{disabled:I,onClick:()=>{const e=(t=[s])&&t[0]?[t[0][1],t[0][0]]:null;var t;i(e),a(!1),E(!1)},primary:!0},n.A.t("Set coordinates")))))})),yX=(0,Qn.k0)((e=>{let{onClick:t,disabled:r,leaflet:a}=e;const[o,i]=(0,y.useState)(),s=(0,y.useCallback)((()=>!r&&t()),[r,t]);return(0,y.useEffect)((()=>{const e=wa().control({position:"topright"}),t=n.A.t("Delete polygon"),a=y.createElement("div",{className:"leaflet-draw-toolbar leaflet-bar"},y.createElement("a",{className:er()("leaflet-draw-edit-remove",{"leaflet-disabled":r}),onClick:s,title:t,role:"button",tabIndex:"0"}));e.onAdd=()=>{const e=wa().DomUtil.create("div","");return Da.render(a,e),e},i(e)}),[s,r]),(0,y.useEffect)((()=>{o&&o.addTo(a.map)}),[o,a.map]),(0,y.useEffect)((()=>()=>o&&o.remove()),[o]),null})),vX=e=>{const{enabled:t,children:r,...n}=e;return t?y.createElement(Xo.m,n,(e=>{let{onMouseOver:t,onMouseOut:n,ref:a}=e;return y.createElement("span",{ref:e=>{e&&(e.onpointerenter=t,e.onpointerleave=n,a.current=e)}},r)})):r},fX="STARTED",IX="FINISHED",bX=(0,Qn.k0)(ea.h),SX=(0,I.withStyles)((()=>({modalContent:{width:"100%"},map:{width:"100%",height:"calc(100vh - 380px)"},setAreaButton:{marginLeft:"5px"}})))((e=>{let{classes:t,center:r,setOpen:a,defaultValues:o,onSetCoordinates:i}=e;const[s,l]=(0,y.useState)(o),[d,c]=(0,y.useState)(),[u,p]=(0,y.useState)(void 0),m=(0,y.useRef)(void 0),g=()=>{c(r),l(o)},h=e=>{const t=e.layer.toGeoJSON().geometry.coordinates[0].map((e=>[e[1],e[0]]));l(t),p(IX),m.current=IX},E=()=>{l(null),p(IX),m.current=IX},v=e=>{c(e)},f=(e,t)=>{if(e)if(t){const r=new(wa().GeoJSON)(t),n=e.leafletElement;n.clearLayers(),r.eachLayer((e=>{n.addLayer(e)}))}else{e.leafletElement.clearLayers()}};return y.createElement(N.a,{large:!0},y.createElement(Ip.w,null," ",n.A.t("Area")),y.createElement(R.$,{className:t.modalContent},y.createElement(Xn.A,{center:null!==d&&void 0!==d?d:r,zoom:13,ref:e=>{if(null!==e&&void 0!==e&&e.leafletElement&&(e.leafletElement.invalidateSize(),e.contextValue&&s)){const{map:t}=e.contextValue;null===t||void 0===t||t.fitBounds(s)}},className:t.map},y.createElement(bX,{position:"topright",inputPlaceholder:"Search",closeResultsOnClick:!0,search:null,mapStateModifier:v,showMarker:!1,openSearchOnLoad:!0}),y.createElement(Jn.A,{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),y.createElement(_a.A,{ref:e=>{f(e,(()=>{return Array.isArray(s)&&(e=s)?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[e[0].length>2?e[0]:e.map((e=>[e[1],e[0]]))]}}]}:null;var e})())}},y.createElement(Pa.M,{position:"topright",onCreated:h,onDeleted:E,onDrawStart:()=>p(fX),onDrawStop:()=>p(m.current),draw:{rectangle:!1,polyline:!1,circle:!1,marker:!1,circlemarker:!1},edit:{remove:!1,edit:!1}}),y.createElement(yX,{onClick:E,disabled:!s||u===fX})))),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},!u&&y.createElement(ra.$,{onClick:()=>{g(),a(!1)},secondary:!0},n.A.t("Close")),u&&y.createElement(y.Fragment,null,y.createElement(ra.$,{onClick:()=>{g(),a(!1)},secondary:!0},n.A.t("Close without saving")),y.createElement(vX,{content:n.A.t("Finish drawing before saving"),enabled:u===fX},y.createElement(ra.$,{disabled:u===fX,className:t.setAreaButton,onClick:()=>{const e=(t=s)?Array(t.map((e=>e?[e[1],e[0]]:null))):null;var t;i(e),a(!1)},primary:!0},n.A.t("Set area")))))))})),TX=e=>{let{type:t,center:r,setOpen:n,onSetCoordinates:a,defaultValues:o}=e;return y.createElement(y.Fragment,null,t===it.CO.COORDINATE&&y.createElement(EX,{center:r,setOpen:n,onSetCoordinates:a,defaultValues:o}),t===it.CO.POLYGON&&y.createElement(SX,{center:r,setOpen:n,onSetCoordinates:a,defaultValues:o}))},AX=[51.505,-.09],CX=(e,t)=>{const[r,n]=(0,y.useState)(e),a=["organisationUnit","geometry",r],o={resource:"organisationUnits",id:()=>r,params:{fields:"geometry,parent"}},i={enabled:!t&&Boolean(e)},{data:s,isLoading:l}=ni(a,o,i),d=(0,y.useMemo)((()=>{if(s){const{geometry:e,parent:t}=s;return e?(e=>{let{coordinates:t,type:r}=e;switch(r){case"Point":return[t[1],t[0]];case"Polygon":return t[0][0];default:return AX}})(e):(null!==t&&void 0!==t&&t.id&&n(t.id),AX)}}),[s]);return t?{center:t}:{center:d,loading:l}},OX=e=>{let{enrollment:t,onUpdate:r,setOpenMap:n,defaultValues:a,center:o}=e;const{geometryType:i,dataElementType:s}=(e=>{const{program:{featureType:t}}=uX(e.program);return"POINT"===t?{geometryType:"Point",dataElementType:it.CO.COORDINATE}:{geometryType:"Polygon",dataElementType:it.CO.POLYGON}})(t),{center:l}=CX(t.orgUnit,o),d=(0,y.useCallback)((e=>{const n=e?{type:i,coordinates:e}:null;r({...t,geometry:n})}),[t,i,r]);return y.createElement(TX,{center:l,type:s,setOpen:n,onSetCoordinates:d,defaultValues:a})},NX=e=>{let{setOpenTransfer:t}=e;return y.createElement(bh.D,{dense:!0,dataTest:"widget-enrollment-actions-transfer",onClick:()=>t(!0),icon:y.createElement(gI.A,null),label:n.A.t("Transfer")})},RX=(0,I.withStyles)((()=>({orgunitTree:{padding:4,minHeight:42,paddingTop:8,backgroundColor:"white",display:"flex",maxWidth:"100vw"}})))((e=>{const{roots:t,selected:r,classes:n,treeKey:a,onSelectClick:o}=e,i=t&&1===t.length?[`/${t[0].id}`]:(null===t||void 0===t?void 0:t.length)>1?t.map((e=>e.path)):void 0,[s,l]=y.useState(i);return t?y.createElement("div",{className:n.orgunitTree},y.createElement(Pp.f,{key:a,dataTest:"widget-enrollment-transfer-orgunit-tree",roots:t.map((e=>e.id)),expanded:s,handleExpand:e=>{let{path:t}=e;s&&!s.includes(t)&&l([...s,t])},handleCollapse:e=>{let{path:t}=e;const r=null===s||void 0===s?void 0:s.indexOf(t);if(r&&-1!==r&&s){const e=0===r?s.slice(1):[...s.slice(0,r),...s.slice(r+1)];l(e)}},singleSelection:!0,selected:(()=>{if(null!==r&&void 0!==r&&r.path)return[null===r||void 0===r?void 0:r.path]})(),onChange:o})):null})),wX={root:{border:"1px solid #ccc",margin:"20px 0"},debounceFieldContainer:{padding:8,background:vn.T.grey100,borderTopLeftRadius:3,borderTopRightRadius:3},orgUnitTreeContainer:{maxHeight:300,overflowY:"auto",margin:"10px 0",padding:"0 8px"}},_X=(0,I.withStyles)(wX)((e=>{let{selected:t,onSelectClick:r,classes:a}=e;const[o,i]=(0,y.useState)(void 0),{orgUnitRoots:s}=(e=>{let{searchText:t}=e;const{data:r,isLoading:n}=ni(["organisationUnits","userOrgUnitScope"],{resource:"me",params:{fields:"teiSearchOrganisationUnits[id,path],organisationUnits[id,path]"}},{enabled:!t,select:e=>{const{teiSearchOrganisationUnits:t,organisationUnits:r}=e;return t.length?t:r}}),{data:a,isLoading:o}=ni(["organisationUnits","userOrgUnitScope","search",t],{resource:"organisationUnits",params:{fields:["id,path"],paging:!0,query:t,withinUserSearchHierarchy:!0,pageSize:15}},{enabled:Boolean(t),cacheTime:72e5,select:e=>{const{organisationUnits:t}=e;return t}});return{orgUnitRoots:null!==t&&void 0!==t&&t.length?a:r,isLoading:null!==t&&void 0!==t&&t.length?o:n}})({searchText:o});return y.createElement("div",{className:a.root},y.createElement("div",{className:a.debounceFieldContainer},y.createElement(Qa,{onDebounced:e=>{const{value:t}=e.currentTarget;i(t)},value:o,placeholder:n.A.t("Search"),classes:a})),y.createElement("div",{className:a.orgUnitTreeContainer},y.createElement(RX,{treeKey:JSON.stringify(s),roots:s,selected:t,onSelectClick:r})))})),PX=Object.freeze({OPEN:"OPEN",AUDITED:"AUDITED",PROTECTED:"PROTECTED",CLOSED:"CLOSED"}),kX=Object.freeze({CAPTURE:"CAPTURE",SEARCH:"SEARCH"}),DX=async(e,t)=>{var r,n;const a=await t.query({captureOrgUnits:{resource:"organisationUnits",params:{query:e,withinUserHierarchy:!0,fields:"id"}}});return(null===a||void 0===a||null===(r=a.captureOrgUnits)||void 0===r||null===(n=r.organisationUnits)||void 0===n?void 0:n.length)>0},UX=e=>{let{ownerOrgUnitId:t,programId:r}=e;const n=(0,A.ow)(),[a,o]=(0,y.useState)(),[i,s]=(0,y.useState)({origin:null,destination:null}),{accessLevel:l}=(e=>{let{programId:t}=e;const{data:r,isLoading:n}=ni(["programProtectionLevel",t],{resource:"programs",id:t,params:{fields:"accessLevel"}},{enabled:!!t});return{accessLevel:null===r||void 0===r?void 0:r.accessLevel,isLoading:n}})({programId:r}),d=(0,y.useMemo)((()=>!!l&&!!i.origin),[l,i.origin]);(0,y.useEffect)((()=>{DX(t,n).then((e=>{const t=e?kX.CAPTURE:kX.SEARCH;var r;r=t,s((e=>({...e,origin:r})))}))}),[n,t]);const c=e=>s((t=>({...t,destination:e})));return{handleOrgUnitChange:async e=>{if(e&&e.id!==a){if(l!==PX.OPEN&&l!==PX.AUDITED||c(kX.CAPTURE),l===PX.PROTECTED||l===PX.CLOSED){const t=await DX(e.id,n)?kX.CAPTURE:kX.SEARCH;c(t)}o(e)}},selectedOrgUnit:a,programAccessLevel:l,orgUnitScopes:i,ready:d}},LX={container:{display:"flex",flexDirection:"column",gap:"8px"},alert:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",padding:"14px 10px",borderRadius:"4px","&.info":{backgroundColor:vn.T.grey200},"&.warning":{backgroundColor:vn.T.yellow100}}},FX=(0,I.withStyles)(LX)((e=>{let{ownerOrgUnitId:t,validOrgUnitId:r,programAccessLevel:a,orgUnitScopes:o,classes:i}=e;const{displayName:s}=mi(t),{displayName:l}=mi(r),d=[PX.PROTECTED,PX.CLOSED].includes(a)&&o.destination===kX.SEARCH;return y.createElement("div",{className:i.container},l&&y.createElement("div",{className:er()(i.alert,{info:!0})},y.createElement(bm.A,{color:vn.T.grey600}),n.A.t("Transferring enrollment ownership from {{ownerOrgUnit}} to {{newOrgUnit}}{{escape}}",{ownerOrgUnit:s,newOrgUnit:l,escape:"."})),d&&y.createElement("div",{className:er()(i.alert,{warning:!0})},y.createElement(sH.A,null),n.A.t("You will lose access to the enrollment when transferring ownership to {{organisationUnit}}.",{organisationUnit:l})))})),xX=e=>{let{enrollment:t,ownerOrgUnitId:r,setOpenTransfer:a,onUpdateOwnership:o,isTransferLoading:i}=e;const{selectedOrgUnit:s,handleOrgUnitChange:l,orgUnitScopes:d,ready:c,programAccessLevel:u}=UX({programId:t.program,ownerOrgUnitId:r});return y.createElement(N.a,{large:!0,onClose:()=>a(!1),dataTest:"widget-enrollment-transfer-modal"},y.createElement(Ip.w,null,n.A.t("Transfer Ownership")),y.createElement(R.$,null,y.createElement("div",null,n.A.t("Choose the organisation unit to which enrollment ownership should be transferred.")),y.createElement(_X,{selected:s,onSelectClick:l}),y.createElement(FX,{ownerOrgUnitId:r,validOrgUnitId:null===s||void 0===s?void 0:s.id,programAccessLevel:u,orgUnitScopes:d})),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:()=>a(!1)},n.A.t("Cancel")),y.createElement(ra.$,{dataTest:"widget-enrollment-transfer-button",primary:!0,disabled:!c||!s,loading:i,onClick:async()=>{s&&(await o({orgUnitId:s.id,programAccessLevel:u,orgUnitScopes:d}),a(!1))}},n.A.t("Transfer")))))},MX={actions:{margin:`${yn.U.dp8}px 0 0 0`},loading:{display:"flex",alignItems:"center",margin:`${yn.U.dp8}px 0 0 0`,fontSize:"14px",color:vn.T.grey900}},VX=(0,I.withStyles)(MX)((e=>{let{enrollment:t={},events:r,programStages:a,ownerOrgUnitId:o,tetName:i,canAddNew:s,onUpdateStatus:l,onUpdate:d,onDelete:c,onUpdateOwnership:u,canCascadeDeleteEnrollment:p,isTransferLoading:m,onAddNew:g,loading:h,onlyEnrollOnce:E,classes:v}=e;const[f,I]=(0,y.useState)(!1),[b,S]=(0,y.useState)(!1),[T,A]=(0,y.useState)(!1),[C,O]=(0,y.useState)(!1),N=e=>{I(!1),d(e)},R=(e,t)=>{I(!1),l(e,t)};return y.createElement(y.Fragment,null,y.createElement(QM.g,{dataTest:"widget-enrollment-actions-button",secondary:!0,small:!0,disabled:h,className:v.actions,open:f,onClick:()=>I((e=>!e)),component:h?null:y.createElement(AI.n,{dense:!0,maxWidth:"250px"},y.createElement(cX,{onlyEnrollOnce:E,tetName:i,canAddNew:s,onAddNew:g}),y.createElement(aX,{enrollment:t,events:r,onUpdate:R,setOpenCompleteModal:e=>{O(e),I(!e)}}),y.createElement(dX,{enrollment:t,onUpdate:N}),y.createElement(NX,{enrollment:t,setOpenTransfer:()=>{A(!0),I(!1)}}),y.createElement(pX,{enrollment:t,setOpenMap:()=>{S(!0),I(!1)}}),y.createElement(DW.N,null),y.createElement(nX,{enrollment:t,onUpdate:R}),y.createElement(sX,{canCascadeDeleteEnrollment:p,enrollment:t,onDelete:e=>{I(!1),c(e)}}))},n.A.t("Enrollment actions")),h&&y.createElement("div",{className:v.loading},y.createElement(P,null),"\xa0",n.A.t("We are processing your request.")),b&&y.createElement(OX,{enrollment:t,onUpdate:N,setOpenMap:S}),T&&y.createElement(xX,{enrollment:t,ownerOrgUnitId:o,setOpenTransfer:A,onUpdateOwnership:u,isTransferLoading:m}),C&&y.createElement(iX,{enrollment:t,events:r,programStages:a,setOpenCompleteModal:O,onUpdateStatus:R}))})),jX={resource:"tracker?async=false&importStrategy=UPDATE",type:"create",data:e=>({enrollments:[e]})},GX={resource:"tracker?async=false&importStrategy=DELETE",type:"create",data:e=>({enrollments:[e]})},BX=e=>{var t,r;const n=null===e||void 0===e||null===(t=e.details)||void 0===t||null===(r=t.validationReport)||void 0===r?void 0:r.errorReports;return(null===n||void 0===n?void 0:n.length)>0?n.reduce(((e,t)=>`${e} ${t.message}`),""):e.message},$X=(e,t,r,n)=>{const a=(0,y.useRef)(!1),[o,{loading:i}]=(0,A.r8)(jX,{onComplete:()=>{e(),t(),n&&n({redirect:a.current})},onError:e=>{r&&r(BX(e))}});return{updateMutation:o,updateLoading:i,changeRedirect:e=>a.current=e}},WX={resource:"tracker/ownership/transfer",type:"update",params:e=>{let{teiId:t,programId:r,orgUnitId:n,teiParamKey:a}=e;return{program:r,ou:n,[a]:t}}};function HX(){return HX=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HX.apply(this,arguments)}const zX=e=>{let{enrollment:t={},refetchEnrollment:r,refetchTEI:a,onDelete:o,onError:i,onUpdateEnrollmentStatus:s,onUpdateEnrollmentStatusError:l,onUpdateEnrollmentStatusSuccess:d,onSuccess:c,onAccessLostFromTransfer:u,...p}=e;const{updateMutation:m,updateLoading:g}=$X(r,a,i,c),{deleteMutation:h,deleteLoading:E}=((e,t,r)=>{const[n,{loading:a}]=(0,A.r8)(GX,{onComplete:()=>{e(),r&&r()},onError:e=>{t&&t(BX(e))}});return{deleteMutation:n,deleteLoading:a}})(o,i,c),{hasAuthority:v}=UQ({authorities:["F_ENROLLMENT_CASCADE_DELETE"]}),{updateEnrollmentOwnership:f,isTransferLoading:I}=(e=>{let{refetchTEI:t,programId:r,teiId:a,onAccessLostFromTransfer:o}=e;const i=(0,A.ow)(),s=(0,j.iT)(j.Gv.newTransferQueryParam)?"trackedEntity":"trackedEntityInstance",{show:l}=(0,A.MW)(n.A.t("An error occurred while transferring ownership"),{critical:!0}),{mutateAsync:d,isLoading:c}=(0,Zo.useMutation)((e=>{let{orgUnitId:t}=e;return i.mutate(WX,{variables:{programId:r,teiId:a,orgUnitId:t,teiParamKey:s}})}),{onSuccess:(e,r)=>{let{programAccessLevel:n,orgUnitScopes:a}=r;if(a.destination!==kX.CAPTURE)if([PX.OPEN,PX.AUDITED].includes(n))t();else{if(n===PX.PROTECTED){if(a.origin===kX.CAPTURE)return void(o&&o());if(a.origin===kX.SEARCH)return void t()}n===PX.CLOSED&&o&&o()}else t()},onError:e=>{l(),S().error((0,j.px)("Failed to transfer ownership")({error:e}))}});return{updateEnrollmentOwnership:d,isTransferLoading:c}})({teiId:t.trackedEntity,programId:t.program,onAccessLostFromTransfer:u,refetchTEI:a}),{updateMutation:b,updateLoading:T,changeRedirect:C}=$X(r,a,l,d),O=(0,y.useCallback)(((e,t)=>{s&&s(e),C(Boolean(t)),b(e)}),[b,s,C]);return y.createElement(VX,HX({enrollment:t,onUpdate:m,onUpdateStatus:O,onDelete:h,canCascadeDeleteEnrollment:v,loading:g||E||T,onUpdateOwnership:f,isTransferLoading:I},p))};var YX=r(24207);const qX=(0,I.withStyles)((()=>({mapContainer:{width:150,height:120},map:{width:"100%",height:"100%"}})))((e=>{let{coordinates:t,geometryType:r,enrollment:n,refetchEnrollment:a,refetchTEI:o,onError:i,classes:s}=e;const[l,d]=(0,y.useState)(!1),{updateMutation:c}=$X(a,o,i),u=((e,t)=>t===it.CO.COORDINATE?[e[1],e[0]]:e[0].map((e=>[e[1],e[0]])))(t,r),p=r===it.CO.COORDINATE?u:u[0];return y.createElement(y.Fragment,null,y.createElement("div",{className:s.mapContainer},y.createElement(Xn.A,{ref:e=>{(e=>{if(null!==e&&void 0!==e&&e.contextValue&&r===it.CO.POLYGON){const{map:t}=e.contextValue;null===t||void 0===t||t.fitBounds(u)}})(e)},center:p,className:s.map,zoom:11,zoomControl:!1,attributionControl:!1,key:"minimap",onClick:()=>{d(!0)}},y.createElement(Jn.A,{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),r===it.CO.COORDINATE&&y.createElement(Zn.A,{position:u}),r===it.CO.POLYGON&&y.createElement(YX.A,{positions:u}))),l&&y.createElement(OX,{center:p,setOpenMap:d,defaultValues:u,onUpdate:c,enrollment:n}))})),KX={enrollment:{padding:`0 ${yn.U.dp16}px ${yn.U.dp16}px ${yn.U.dp16}px`},row:{display:"flex",alignItems:"center",margin:`${yn.U.dp8}px 0`,fontSize:"14px",color:vn.T.grey900,gap:`${yn.U.dp4}px`},statuses:{display:"flex",gap:`${yn.U.dp4}px`}},QX=e=>e.displayEnrollmentDateLabel||n.A.t("Enrollment date"),XX=e=>e.displayIncidentDateLabel||n.A.t("Incident date"),JX=(0,I.withStyles)(KX)((e=>{var t;let{classes:r,events:a,enrollment:o={},program:i={},ownerOrgUnit:s={},locale:l,refetchEnrollment:d,refetchTEI:c,initError:u,loading:p,canAddNew:m,editDateEnabled:g,displayAutoGeneratedEventWarning:h,onDelete:E,onAddNew:v,updateEnrollmentDate:f,updateIncidentDate:I,onError:b,onSuccess:S,onUpdateEnrollmentStatus:T,onUpdateEnrollmentStatusError:C,onUpdateEnrollmentStatusSuccess:O,onAccessLostFromTransfer:N,type:R=it.CO.ORGANISATION_UNIT}=e;const[w,P]=(0,y.useState)(!0),{fromServerDate:k}=(0,A.Bp)(),D=(e=>"Point"===e?it.CO.COORDINATE:it.CO.POLYGON)(null===o||void 0===o||null===(t=o.geometry)||void 0===t?void 0:t.type),{displayName:U,ancestors:L}=mi(null===o||void 0===o?void 0:o.orgUnit),{displayName:F,ancestors:x}=mi(null===s||void 0===s?void 0:s.id),M={id:null===o||void 0===o?void 0:o.orgUnit,name:U,ancestors:L},V={id:null===s||void 0===s?void 0:s.id,name:F,ancestors:x};return y.createElement("div",{"data-test":"widget-enrollment"},y.createElement(Ib,{header:n.A.t("Enrollment"),onOpen:(0,y.useCallback)((()=>P(!0)),[P]),onClose:(0,y.useCallback)((()=>P(!1)),[P]),open:w},u&&y.createElement("div",{className:r.enrollment},n.A.t("Enrollment widget could not be loaded. Please try again later")),p&&y.createElement(_,null),!u&&!p&&y.createElement("div",{className:r.enrollment,"data-test":"widget-enrollment-contents"},y.createElement("div",{className:r.statuses,"data-test":"widget-enrollment-status"},o.followUp&&y.createElement(Mt.v,{className:r.followup,negative:!0},n.A.t("Follow-up")),y.createElement(XQ,{status:o.status})),y.createElement("span",{"data-test":"widget-enrollment-enrollment-date"},y.createElement(tX,{date:o.enrolledAt,dateLabel:QX(i),locale:l,editEnabled:g,displayAutoGeneratedEventWarning:h,onSave:f,classes:r})),i.displayIncidentDate&&y.createElement("span",{"data-test":"widget-enrollment-incident-date"},y.createElement(tX,{date:o.occurredAt,dateLabel:XX(i),locale:l,editEnabled:g,displayAutoGeneratedEventWarning:h,onSave:I,classes:r})),y.createElement("div",{className:r.row,"data-test":"widget-enrollment-orgunit"},y.createElement("span",{className:r.icon,"data-test":"widget-enrollment-icon-orgunit"},y.createElement(HQ.A,{color:vn.T.grey600})),n.A.t("Started at{{escape}}",{escape:":"}),Ci(M,R)),y.createElement("div",{className:r.row,"data-test":"widget-enrollment-owner-orgunit"},y.createElement("span",{className:r.icon,"data-test":"widget-enrollment-icon-owner-orgunit"},y.createElement(HQ.A,{color:vn.T.grey600})),n.A.t("Owned by{{escape}}",{escape:":"}),Ci(V,R)),y.createElement("div",{className:r.row,"data-test":"widget-enrollment-last-update"},y.createElement("span",{className:r.icon,"data-test":"widget-enrollment-icon-clock"},y.createElement(zQ.A,{color:vn.T.grey600})),n.A.t("Last updated"),y.createElement(Xo.m,{content:k(o.updatedAt).toLocaleString()},$()(k(o.updatedAt)).fromNow())),o.geometry&&y.createElement("div",{className:r.row},y.createElement(qX,{coordinates:o.geometry.coordinates,geometryType:D,enrollment:o,refetchEnrollment:d,refetchTEI:c,onError:b})),y.createElement(zX,{tetName:i.trackedEntityType.displayName,onlyEnrollOnce:i.onlyEnrollOnce,programStages:i.programStages,enrollment:o,events:a,ownerOrgUnitId:s.id,refetchEnrollment:d,refetchTEI:c,onDelete:E,onAddNew:v,canAddNew:m,onError:b,onSuccess:S,onUpdateEnrollmentStatus:T,onUpdateEnrollmentStatusSuccess:O,onUpdateEnrollmentStatusError:C,onAccessLostFromTransfer:N}))))})),ZX={resource:"tracker?async=false&importStrategy=UPDATE",type:"create",data:e=>({enrollments:[e]})},eJ=e=>{let{enrollment:t,setEnrollment:r,propertyName:n,updateHandler:a,onError:o}=e;const[i]=(0,A.r8)(ZX,{onError:e=>{r(t),a&&a(t[n]),o&&o((e=>{var t,r;const n=null===e||void 0===e||null===(t=e.details)||void 0===t||null===(r=t.validationReport)||void 0===r?void 0:r.errorReports;return(null===n||void 0===n?void 0:n.length)>0?n.reduce(((e,t)=>`${e} ${t.message}`),""):e.message})(e))}});return(0,y.useCallback)((e=>{const o={...t};o[n]=e,r(o),i(o),a&&a(e)}),[t,r,n,a,i])},tJ={container:{display:"flex",flexDirection:"column",gap:yn.Q.dp8,padding:yn.Q.dp16,paddingTop:0},button:{alignSelf:"start"},cancelbutton:{alignSelf:"start",marginTop:yn.U.dp16}},rJ=(0,I.withStyles)(tJ)((e=>{let{programStages:t,onSelectProgramStage:r,onCancel:a,classes:o}=e;return y.createElement("div",{className:o.container},t.map((e=>{var t,a,i;const s=!e.dataAccess.write||!e.repeatable&&e.eventCount>0||e.hiddenProgramStage;return y.createElement("div",{key:e.id},y.createElement(aI,{content:n.A.t("You can't add any more {{ programStageName }} events",{programStageName:e.displayName,interpolation:{escapeValue:!1}}),enabled:s},y.createElement(ra.$,{className:o.button,secondary:!0,disabled:s,onClick:()=>r(e.id),dataTest:"program-stage-selector-button",icon:(null===(t=e.style)||void 0===t?void 0:t.icon)&&y.createElement("div",{className:o.icon},y.createElement(Tm,{name:null===(a=e.style)||void 0===a?void 0:a.icon,color:null===(i=e.style)||void 0===i?void 0:i.color,width:24,height:24,cornerRadius:5}))},e.displayName)))})),y.createElement(ra.$,{className:o.cancelbutton,secondary:!0,big:!0,onClick:a},n.A.t("Cancel without saving")))})),nJ=e=>(0,y.useMemo)((()=>(0,it.x6)(e)),[e]),aJ=e=>{let{programId:t,orgUnitId:r,teiId:a,enrollmentId:o}=e;const i=(0,T.W6)(),{tab:s}=vs(),{error:l,enrollment:d,attributeValues:c}=Us(a,o,t),{program:u,isLoading:p,isError:m}=Ji(t),{orgUnit:g}=ZN(r),h=nJ(t),E=ud({orgUnit:g,program:h,apiEnrollment:d,apiAttributeValues:c});(0,y.useEffect)((()=>{(l||m)&&S().error((0,j.px)("Enrollment page could not be loaded")({enrollmentsError:l,programError:m}))}),[l,m]);const v=(0,y.useMemo)((()=>{var e;return!p&&(null===u||void 0===u||null===(e=u.programStages)||void 0===e?void 0:e.reduce(((e,t)=>{var r,n;return e.push({id:t.id,dataAccess:t.access.data,eventCount:null===d||void 0===d||null===(r=d.events)||void 0===r||null===(n=r.filter((e=>e.programStage===t.id)))||void 0===n?void 0:n.length,displayName:t.displayName,style:t.style,repeatable:t.repeatable,hiddenProgramStage:null===E||void 0===E?void 0:E.find((e=>"HIDEPROGRAMSTAGE"===e.type&&e.id===t.id))}),e}),[]))}),[null===d||void 0===d?void 0:d.events,null===u||void 0===u?void 0:u.programStages,p,E]);return y.createElement(y.Fragment,null,u?y.createElement(Ib,{header:n.A.t("Choose a stage for a new event"),noncollapsible:!0},y.createElement(rJ,{programStages:v||[],onSelectProgramStage:e=>i.push(`enrollmentEventNew?${Is({programId:t,orgUnitId:r,teiId:a,enrollmentId:o,stageId:e,tab:s})}`),onCancel:()=>i.push(`enrollment?${Is({programId:t,orgUnitId:r,teiId:a,enrollmentId:o})}`)})):n.A.t("Program Stages could not be loaded"))};var oJ=r(52796),iJ=r(88367);const sJ=e=>!e||xc(e),lJ=()=>[{validator:Vt,message:n.A.t("A value is required")},{validator:sJ,message:n.A.t("Please provide a valid date")}],dJ=e=>!e,cJ=()=>[{validator:dJ,message:n.A.t("Please add or cancel the note before saving the event")}];function uJ(){return uJ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uJ.apply(this,arguments)}const pJ=(0,I.withStyles)((()=>({container:{display:"flex",alignItems:"baseline",padding:"8px 8px 8px 12px"},containerVertical:{display:"flex",flexDirection:"column",margin:8},label:{fontSize:14,flexBasis:200,color:"#212934"},field:{flexBasis:150,flexGrow:1}})))((e=>{const{classes:t,orientation:r,...a}=e;return y.createElement("div",{className:"horizontal"===r?t.container:t.containerVertical},y.createElement("div",{className:"horizontal"===r&&t.label},n.A.t("Assigned user")),y.createElement("div",{className:"horizontal"===r&&t.field},y.createElement(Uh,uJ({inputPlaceholderText:n.A.t("Search for user")},a))))}));var mJ="dataEntryFieldLabels_coordinateLabel__sNmiR",gJ="dataEntryFieldLabels_polygonLabel__xsN+c",hJ="dataEntryFieldLabels_dateLabel__RxJn-",EJ="dataEntryFieldLabels_selectLabel__iYaM-";function yJ(){return yJ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yJ.apply(this,arguments)}function vJ(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const fJ="BASICINFO",IJ="STATUS",bJ="NOTES",SJ="RELATIONSHIPS",TJ="ASSIGNEE",AJ={errorMessage:"validationError"},CJ={labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}},OJ={labelContainerStyle:{width:150},inputContainerStyle:{width:150}};function NJ(e){const{formHorizontal:t,fieldOptions:r,validationError:n,modified:a,...o}=e;return o}const RJ=e=>({fieldOptions:e.fieldOptions,formHorizontal:e.formHorizontal,styles:e.formHorizontal?OJ:CJ}),wJ=(e,t)=>({...RJ(e),...t}),_J=nm(AJ)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${mJ}`})(pm()(Qr()(vm(NJ)(Np)))))))),PJ=nm(AJ)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${gJ}`})(pm()(Qr()(vm(NJ)(_p)))))))),kJ=e=>e?qr:Yr,DJ=(0,qd.compose)(PS({}),CS((()=>{const e=nm(AJ)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${EJ}`})(pm()(Qr()(vm(NJ)(tp))))))));return{getComponent:()=>e,getComponentProps:(e,t)=>{var r,n;return wJ(e,{...null!==(r=null===(n=e.categories)||void 0===n?void 0:n.find((e=>e.id===t)))&&void 0!==r?r:{},required:!0})},getPropName:(e,t)=>t?`${NS}-${t}`:NS,getFieldIds:e=>{var t;return null===(t=e.categories)||void 0===t?void 0:t.map((e=>e.id))},getValidatorContainers:(e,t)=>kS(e,t),getMeta:e=>{var t;return{section:OS,placement:gf,sectionName:null===(t=e.programCategory)||void 0===t?void 0:t.displayName}}}})()),Qf((()=>{const e=nm(AJ)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${hJ}`})(pm()(Qr()(vm(NJ)(Ep))))))));return{getComponent:()=>e,getComponentProps:e=>{return wJ(e,{width:e&&e.formHorizontal?150:"100%",label:e.formFoundation.getLabel("occurredAt"),required:!0,calendarWidth:e.formHorizontal?250:350,popupAnchorPosition:(t=e.formHorizontal,t?"center":"left")});var t},getPropName:()=>"occurredAt",getValidatorContainers:()=>lJ(),getMeta:()=>({placement:gf,section:fJ})}})()),GI({isApplicable:e=>{const t=e.formFoundation.featureType;return["Polygon","Point"].includes(t)},getComponent:e=>"Polygon"===e.formFoundation.featureType?PJ:_J,getComponentProps:e=>{const t=e.formFoundation.featureType;return wJ(e,"Polygon"===t?{width:e&&e.formHorizontal?150:350,label:n.A.t("Area"),dialogLabel:n.A.t("Area"),required:!1,orientation:kJ(e.formHorizontal),orgUnit:e.orgUnit}:{width:e&&e.formHorizontal?150:350,label:n.A.t("Coordinate"),dialogLabel:n.A.t("Coordinate"),required:!1,orientation:kJ(e.formHorizontal),shrinkDisabled:e.formHorizontal,orgUnit:e.orgUnit})},getPropName:()=>"geometry",getValidatorContainers:()=>[],getMeta:()=>({placement:gf,section:fJ})}),Qf((()=>{const e=nm(AJ)(hm()(ym()(pm()(Qr()(vm(NJ)(tI()(lI)))))));return{getComponent:()=>e,getComponentProps:e=>wJ(e,{label:n.A.t("Notes"),onAddNote:e.onAddNote,id:"notes",dataEntryId:e.id}),getPropName:()=>"note",getValidatorContainers:()=>cJ(),getMeta:()=>({placement:hf,section:bJ})}})()),GI((()=>{const e=Hm(["onBlur","onSet"])(hr()(vm((e=>{const t=NJ(e),{validationAttempted:r,touched:n,...a}=t;return a}))(pJ)));return{isApplicable:e=>!!(e.stage&&e.stage.enableUserAssignment),getComponent:()=>e,getComponentProps:e=>wJ({},{orientation:kJ(e.formHorizontal)}),getPropName:()=>"assignee",getValidatorContainers:()=>[],getMeta:()=>({section:TJ})}})()),nS(),vm((e=>{const{stage:t,onScrollToRelationships:r,recentlyAddedRelationshipId:n,relationshipsRef:a,...o}=e;return o})))(Of),UJ={[fJ]:{placement:gf,name:n.A.t("Basic info")},[IJ]:{placement:hf,name:n.A.t("Status")},[bJ]:{placement:hf,name:n.A.t("Notes")},[SJ]:{placement:hf,name:n.A.t("Relationships")},[TJ]:{placement:hf,name:n.A.t("Assignee")},[OS]:{placement:gf,name:""}};class LJ extends y.Component{constructor(e){super(e),vJ(this,"setRelationshipsInstance",(e=>{this.relationshipsInstance=e})),this.fieldOptions={theme:e.theme,fieldLabelMediaBasedClass:e.classes.fieldLabelMediaBased},this.dataEntrySections=UJ}UNSAFE_componentWillMount(){this.props.onSetSaveTypes(null)}componentDidMount(){this.relationshipsInstance&&this.props.recentlyAddedRelationshipId&&(this.relationshipsInstance.scrollIntoView(),this.props.onScrollToRelationships())}componentWillUnmount(){Fg.clear()}render(){const{onUpdateField:e,onStartAsyncUpdateField:t,classes:r,onSave:n,onSetSaveTypes:a,theme:o,id:i,...s}=this.props;return y.createElement("div",{"data-test":"new-enrollment-event-form"},y.createElement(DJ,yJ({id:i,onUpdateFormField:e,onUpdateFormFieldAsync:t,fieldOptions:this.fieldOptions,dataEntrySections:this.dataEntrySections,relationshipsRef:this.setRelationshipsInstance},s)))}}const FJ=(0,I.withStyles)((e=>({savingContextContainer:{paddingTop:e.typography.pxToRem(10),display:"flex",alignItems:"center",color:e.palette.grey.dark,fontSize:e.typography.pxToRem(13)},savingContextText:{paddingLeft:e.typography.pxToRem(10)},savingContextNames:{fontWeight:"bold"},topButtonsContainer:{display:"flex",flexFlow:"row-reverse"},horizontal:{padding:e.typography.pxToRem(10),paddingTop:e.typography.pxToRem(20),paddingBottom:e.typography.pxToRem(15)},fieldLabelMediaBased:{[e.breakpoints.down(523)]:{paddingTop:"0px !important"}}})))((0,I.withTheme)()(LJ)),xJ="UpdateDataEntryFieldForAddEventActionsBatch",MJ="NewEvent.UpdateFieldBatch",VJ="RulesEffectsForAddEventActionsBatch",jJ="NewEvent.ExecuteRulesOnUpdate",GJ="NewEvent.AddEventNote",BJ="SetNewEventSaveTypes",$J=e=>l(jJ)(e);function WJ(){return WJ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},WJ.apply(this,arguments)}const HJ=e=>{let{orgUnit:t,rulesExecutionDependenciesClientFormatted:r,...n}=e;const a=(0,gs.wA)(),{orgUnitId:o,programId:i}=(0,gs.d4)((e=>{let{currentSelections:t}=e;return t})),s=(0,y.useCallback)((e=>{const{dataEntryId:n,itemId:o}=e.payload,i=(0,yc.A)();a((0,Xd.OJ)([e,nv(n,o,i),$J({...e.payload,uid:i,orgUnit:t,rulesExecutionDependenciesClientFormatted:r})],xJ))}),[a,t,r]),c=(0,y.useCallback)((e=>{const{dataEntryId:n,itemId:o}=e.payload,i=(0,yc.A)();a((0,Xd.OJ)([e,nv(n,o,i),$J({...e.payload,uid:i,orgUnit:t,rulesExecutionDependenciesClientFormatted:r})],MJ))}),[a,t,r]),u=(0,y.useCallback)(((e,n,o)=>{a(((e,t,r)=>d(e)({onSuccess:t,onError:r}))(e,(e=>{const a=(0,yc.A)();return(0,Xd.OJ)([e,nv(n,o,a),$J({...e.payload,dataEntryId:n,itemId:o,uid:a,orgUnit:t,rulesExecutionDependenciesClientFormatted:r})],MJ)}),(e=>e)))}),[a,t,r]),p=(0,y.useCallback)(((e,t,r)=>{a(((e,t,r)=>l(GJ)({itemId:e,dataEntryId:t,note:r}))(e,t,r))}),[a]),m=(0,y.useCallback)((e=>{a((e=>l(BJ)({saveTypes:e}))(e))}),[a]);return y.createElement(FJ,WJ({},n,{orgUnit:t,orgUnitId:o,programId:i,onUpdateDataEntryField:s,onUpdateField:c,onStartAsyncUpdateField:u,onAddNote:p,onSetSaveTypes:m}))},zJ=(e,t,r,a,o,i,s,l)=>{let{events:d,attributeValues:c,enrollmentData:u}=s;const p=e.value,m=yf(t,r),{programId:g,stageId:h}=fs(),E=(0,VO.x6)(g),y=E.getStage(h);if(!y)throw Error(n.A.t("Program stage not found"));const v=y.stageForm,f=v.id,I={...od(p,v,m,l),...id(p,r,t,v),programStageId:f},b=Zl({program:E,stage:y,orgUnit:o,currentEvent:I,otherEvents:d,attributeValues:c,enrollmentData:u});return(0,Xd.OJ)([ld(b,m),av(t,r,a)],VJ)},YJ=(e,t)=>{const r=[{validator:r=>((e,t,r)=>{var a;const o=null===t||void 0===t||null===(a=t.categories)||void 0===a?void 0:a.find((e=>e.id===r)),i=(null===o||void 0===o?void 0:o.label)||(null===o||void 0===o?void 0:o.displayName);return{valid:Vt(e),message:n.A.t("Please select {{categoryName}}",{categoryName:i})}})(r,e,t),message:""}];return r},qJ=[{id:"occurredAt",type:"DATE",validatorContainers:lJ()},{id:"scheduledAt",type:"DATE",validatorContainers:lJ()},{clientId:"geometry",dataEntryId:"geometry",onConvertOut:UT},{id:"note",type:"TEXT",validatorContainers:cJ(),clientIgnore:!0},{id:"assignee"}],KJ=(e,t,r)=>(r&&r.categories&&qJ.push(...r.categories.map((e=>({id:`attributeCategoryOptions-${e.id}`,type:"TEXT",validatorContainers:YJ({categories:r.categories},e.id)})))),pS(e,t,qJ)),QJ=e=>{let{state:t,program:r,stage:n,formFoundation:a,dataEntryId:o,itemId:i,orgUnit:s,eventsRulesDependency:l,attributesValuesRulesDependency:d,enrollmentDataRulesDependency:c}=e;const u=yf(o,i),p={...od(t,a,u),...id(t,i,o,a),programStageId:a.id},m=Zl({program:r,stage:n,orgUnit:s,currentEvent:p,otherEvents:l,attributeValues:d,enrollmentData:c});return ld(m,u)},XJ=(e,t)=>e.reduce(((e,r)=>{let{id:n,value:a}=r;const{type:o}=t.attributes.find((e=>{let{id:t}=e;return n===t}))||{};return e[n]=Et(a,o),e}),{}),JJ=e=>{let{enrolledAt:t,occurredAt:r,enrollmentId:n}=e;return{enrolledAt:Et(t,it.CO.DATE),occurredAt:Et(r,it.CO.DATE),enrollmentId:n}},ZJ={container:{display:"flex",marginTop:yn.U.dp4},button:{paddingRight:yn.U.dp8}},eZ=Mf()((0,I.withStyles)(ZJ)((e=>{let{onSave:t,cancelButton:r,isLoading:a,classes:o}=e;return y.createElement("div",{className:o.container},y.createElement("div",{className:o.button},y.createElement(ra.$,{onClick:()=>t(sb.COMPLETE),primary:!0,loading:a},n.A.t("Complete"))),y.createElement("div",{className:o.button},y.createElement(ra.$,{onClick:()=>t(sb.SAVE_WITHOUT_COMPLETING),disabled:a},n.A.t("Save without completing"))),r)}))),tZ=e=>{let{orgUnitName:t,stageName:r,programName:a}=e;return y.createElement(SS,null,y.createElement("span",null,n.A.t("Saving to {{stageName}} for {{programName}} in {{orgUnitName}}",{orgUnitName:t,stageName:r,programName:a,interpolation:{escapeValue:!1}})))},rZ=Object.freeze({PROGRAM_STAGE_INSTANCE:"PROGRAM_STAGE_INSTANCE",TRACKED_ENTITY_INSTANCE:"TRACKED_ENTITY_INSTANCE",PROGRAM_INSTANCE:"PROGRAM_INSTANCE"}),nZ=e=>{var t,r;let{programStageId:n,programId:a}=e;const{data:o}=ri(["RelatedStages","relationshipTypes",a,n],(()=>ve().getAll(z.RELATIONSHIP_TYPES)),{select:e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.filter((e=>{if(!e.access.data.write)return!1;const{fromConstraint:t,toConstraint:r,bidirectional:o}=e;return t.relationshipEntity===rZ.PROGRAM_STAGE_INSTANCE&&r.relationshipEntity===rZ.PROGRAM_STAGE_INSTANCE&&((t.programStage.id===n||r.programStage.id===n)&&(t.programStage.program.id===a&&r.programStage.program.id===a&&(!!o||((e,t)=>{const{fromConstraint:r,toConstraint:n}=e,a=r.programStage.id===t&&n.programStage.id===t;return!(r.programStage.id!==t&&!a)})(e,n))))})))&&void 0!==t?t:[]}}),i=(0,y.useMemo)((()=>{if(o){if(1===o.length)return Bk.LINKABLE;if(o.length>1)return Bk.AMBIGUOUS_RELATIONSHIPS}return null}),[o]),s=i===Bk.LINKABLE?null===o||void 0===o?void 0:o[0]:void 0;return{currentRelatedStagesStatus:i,selectedRelationshipType:s,constraint:(null===s||void 0===s||null===(t=s.toConstraint)||void 0===t||null===(r=t.programStage)||void 0===r?void 0:r.id)===n?null===s||void 0===s?void 0:s.fromConstraint:null===s||void 0===s?void 0:s.toConstraint}},aZ=(0,I.withStyles)((e=>({sectionWrapper:{border:`1px solid ${vn.T.grey300}`,borderRadius:"3px",marginBottom:yn.U.dp16,maxWidth:e.typography.pxToRem(892)},sectionHeader:{color:vn.T.grey900,fontSize:14,fontWeight:500,backgroundColor:vn.T.grey300,padding:"4px 8px",marginBottom:"8px",width:"fit-content"}})))((e=>{let{sectionName:t,children:r,classes:n,dataTest:a}=e;return y.createElement("div",{"data-test":a,className:n.sectionWrapper},y.createElement("div",{className:n.sectionHeader},t),r)}));var oZ="dataEntryFieldLabels_dateLabel__MISOI";const iZ={inputContainerStyle:{flexBasis:150},labelContainerStyle:{flexBasis:200}},sZ=hm()(Pm({onGetCustomFieldLabeClass:()=>oZ})(pm()(Qr()(Ep)))),lZ=e=>{let{scheduledLabel:t,relatedStagesDataValues:r,onBlurDateField:n,saveAttempted:a,errorMessages:o}=e;const[i,s]=(0,y.useState)(!1),l=i||a;return y.createElement(sZ,{label:t,value:r.scheduledAt?Pt(r.scheduledAt):"",required:!0,onSetFocus:()=>{},onFocus:()=>{},onRemoveFocus:()=>{},styles:iZ,calendarWidth:350,onBlur:e=>{s(!0),n(e)},errorMessage:l&&(null===o||void 0===o?void 0:o.scheduledAt)})},dZ=hm()(Pm({onGetCustomFieldLabeClass:()=>oZ})(pm()(Qr()(jp)))),cZ=e=>{let{relatedStagesDataValues:t,onSelectOrgUnit:r,onDeselectOrgUnit:a,errorMessages:o,saveAttempted:i}=e;const[s,l]=(0,y.useState)(!1),d=i||s;return y.createElement(dZ,{label:n.A.t("Organisation unit"),value:t.orgUnit,required:!0,onSelectClick:e=>{l(!0),r(e)},onBlur:()=>{l(!0),a()},styles:iZ,errorMessage:d&&(null===o||void 0===o?void 0:o.orgUnit)})},uZ={wrapper:{padding:`${yn.Q.dp16} 0`,maxWidth:"55.75rem"},fieldWrapper:{display:"flex",flexWrap:"wrap",alignItems:"start",justifyContent:"space-between",padding:`${yn.Q.dp8}  ${yn.Q.dp16}`},fieldLabel:{color:vn.T.grey900,paddingTop:yn.U.dp12,paddingRight:yn.U.dp16,flexBasis:"200px"},fieldContent:{flexBasis:"150px",flexGrow:1},alternateColor:{backgroundColor:vn.T.grey100}},pZ=(0,I.withStyles)(uZ)((e=>{let{relatedStagesDataValues:t,setRelatedStagesDataValues:r,saveAttempted:n,errorMessages:a,scheduledLabel:o,classes:i}=e;return y.createElement("div",{className:i.wrapper},y.createElement("div",null,y.createElement(lZ,{scheduledLabel:o,errorMessages:a,saveAttempted:n,onBlurDateField:e=>{r((t=>({...t,scheduledAt:Pt(e)})))},relatedStagesDataValues:t})),y.createElement("div",null,y.createElement(cZ,{relatedStagesDataValues:t,onSelectOrgUnit:e=>{const t={id:e.id,name:e.displayName,path:e.path};r((e=>({...e,orgUnit:t})))},onDeselectOrgUnit:()=>{r((e=>({...e,orgUnit:null})))},errorMessages:a,saveAttempted:n})))})),mZ=(0,I.withStyles)((()=>({searchRow:{padding:yn.Q.dp16,display:"flex",alignItems:"center",gap:yn.Q.dp16},label:{width:"150px",fontSize:"14px"},singleSelectField:{flexGrow:1}})))((e=>{let{relatedStagesDataValues:t,setRelatedStagesDataValues:r,linkableEvents:a,linkableStageLabel:o,errorMessages:i,saveAttempted:s,classes:l}=e;return y.createElement("div",{className:l.searchRow},y.createElement("p",{className:l.label},n.A.t("Link to an existing {{linkableStageLabel}}",{linkableStageLabel:o})),y.createElement(IO.l,{selected:t.linkedEventId,onChange:e=>{let{selected:n}=e;return(e=>{r({...t,linkedEventId:e})})(n)},placeholder:n.A.t("Choose a {{linkableStageLabel}}",{linkableStageLabel:o}),className:l.singleSelectField,error:s&&!!i.linkedEventId,validationText:s&&i.linkedEventId},a.map((e=>y.createElement(bO.e,{key:e.id,value:e.id,label:e.label})))))})),gZ={wrapper:{padding:`${yn.Q.dp16} 0`,maxWidth:"55.75rem"},fieldWrapper:{display:"flex",flexWrap:"wrap",alignItems:"start",justifyContent:"space-between",padding:`${yn.Q.dp8}  ${yn.Q.dp16}`},fieldLabel:{color:vn.T.grey900,paddingTop:yn.U.dp12,paddingRight:yn.U.dp16,flexBasis:"200px"},fieldContent:{flexBasis:"150px",flexGrow:1},alternateColor:{backgroundColor:vn.T.grey100},infoBox:{margin:"8px 8px",display:"flex",fontSize:"14px",gap:"5px",background:vn.T.grey100,padding:"12px 8px",border:`1px solid ${vn.T.grey600}`}},hZ=(0,I.withStyles)(gZ)((e=>{var t,r;let{linkableStageLabel:a,relatedStagesDataValues:o,setRelatedStagesDataValues:i,saveAttempted:s,errorMessages:l,currentStageLabel:d,classes:c}=e;return y.createElement("div",{className:c.wrapper},y.createElement("div",null,y.createElement(cZ,{relatedStagesDataValues:o,onSelectOrgUnit:e=>{const t={id:e.id,name:e.displayName,path:e.path};i((e=>({...e,orgUnit:t})))},onDeselectOrgUnit:()=>{i((e=>({...e,orgUnit:null})))},errorMessages:l,saveAttempted:s})),y.createElement("div",{className:c.infoBox},y.createElement(bm.A,null),n.A.t(null!==o&&void 0!==o&&null!==(t=o.orgUnit)&&void 0!==t&&t.name?"Enter {{linkableStageLabel}} details for {{orgUnitLabel}} in the next step after completing this {{currentStageLabel}}.":"Select organisation unit and enter {{linkableStageLabel}} details in the next step after completing this {{currentStageLabel}}.",{linkableStageLabel:a,currentStageLabel:d,orgUnitLabel:null===o||void 0===o||null===(r=o.orgUnit)||void 0===r?void 0:r.name})))})),EZ=(0,I.withStyles)((()=>({wrapper:{padding:yn.Q.dp8,width:"fit-content"},fieldWrapper:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",padding:`${yn.Q.dp8} ${yn.Q.dp16}`},fieldLabel:{color:vn.T.grey900,flexGrow:0,flexShrink:0,paddingTop:yn.U.dp16,paddingRight:yn.U.dp16},fieldContent:{flexGrow:1,flexShrink:0},clearSelections:{padding:yn.Q.dp8}})))((e=>{var t;let{classes:r,type:a,relationshipName:o,scheduledLabel:i,events:s,linkableEvents:l,relatedStagesDataValues:d,setRelatedStagesDataValues:c,constraint:u,currentStageLabel:p,errorMessages:m,saveAttempted:g}=e;const{programStage:h}=fB(null===u||void 0===u||null===(t=u.programStage)||void 0===t?void 0:t.id),E=(0,y.useMemo)((()=>d.linkMode),[d.linkMode]),v=e=>{c((t=>({...t,linkMode:e})))},f=((e,t)=>{const r=(0,gs.d4)((e=>{let{rulesEffectsHiddenProgramStageDesc:t}=e;return null===t||void 0===t?void 0:t["enrollmentEvent-newEvent"]}));return(0,y.useMemo)((()=>!(null===r||void 0===r?void 0:r[null===e||void 0===e?void 0:e.id])&&!(!e||!t)&&(e.repeatable||!e.repeatable&&0===t.length)),[e,t,r])})(h,s);return h?y.createElement(aZ,{dataTest:"related-stages-section",sectionName:n.A.t("Actions: {{relationshipName}}",{relationshipName:o})},y.createElement("div",{className:r.wrapper},a===Bk.LINKABLE&&y.createElement(y.Fragment,null,y.createElement(aI,{key:$k.SCHEDULE_IN_ORG,content:n.A.t("{{ linkableStageLabel }} is not repeatable",{linkableStageLabel:h.stageForm.name,interpolation:{escapeValue:!1}}),closeDelay:50,enabled:!f},y.createElement(HF.s,{name:`related-stage-action-${$k.SCHEDULE_IN_ORG}`,checked:$k.SCHEDULE_IN_ORG===E,disabled:!f,label:Wk[$k.SCHEDULE_IN_ORG],onChange:e=>v(e.value),value:$k.SCHEDULE_IN_ORG})),y.createElement(aI,{key:$k.ENTER_DATA,content:n.A.t("{{ linkableStageLabel }} is not repeatable",{linkableStageLabel:h.stageForm.name,interpolation:{escapeValue:!1}}),closeDelay:50,enabled:!f},y.createElement(HF.s,{name:`related-stage-action-${$k.ENTER_DATA}`,checked:$k.ENTER_DATA===E,disabled:!f,label:Wk[$k.ENTER_DATA],onChange:e=>v(e.value),value:$k.ENTER_DATA})),y.createElement(aI,{key:$k.LINK_EXISTING_RESPONSE,content:n.A.t("{{ linkableStageLabel }} has no linkable events",{linkableStageLabel:h.stageForm.name,interpolation:{escapeValue:!1}}),closeDelay:50,enabled:!l.length},y.createElement(HF.s,{name:`related-stage-action-${$k.LINK_EXISTING_RESPONSE}`,checked:$k.LINK_EXISTING_RESPONSE===E,disabled:!l.length,label:Wk[$k.LINK_EXISTING_RESPONSE],onChange:e=>v(e.value),value:$k.LINK_EXISTING_RESPONSE}))),a===Bk.AMBIGUOUS_RELATIONSHIPS&&y.createElement("div",null,n.A.t("Ambiguous relationships, contact system administrator"))),!!E&&y.createElement("div",{className:r.clearSelections},y.createElement(ra.$,{secondary:!0,small:!0,onClick:()=>v(void 0)},n.A.t("Clear selection"))),E===$k.SCHEDULE_IN_ORG&&y.createElement(pZ,{relatedStagesDataValues:d,setRelatedStagesDataValues:c,scheduledLabel:i,saveAttempted:g,errorMessages:m}),E===$k.ENTER_DATA&&y.createElement(hZ,{linkableStageLabel:h.stageForm.name,relatedStagesDataValues:d,setRelatedStagesDataValues:c,currentStageLabel:p,saveAttempted:g,errorMessages:m}),E===$k.LINK_EXISTING_RESPONSE&&y.createElement(mZ,{relatedStagesDataValues:d,setRelatedStagesDataValues:c,linkableEvents:l,linkableStageLabel:h.stageForm.name,errorMessages:m,saveAttempted:g})):null})),yZ=e=>{const{scheduledAt:t,orgUnit:r,setErrorMessages:a}=null!==e&&void 0!==e?e:{},o=!!t&&jt(t,Nt.sI.get().dateFormat);const i=Xt(r);return a(o?{scheduledAt:null}:{scheduledAt:n.A.t("Please provide a valid date")}),a(i?{orgUnit:null}:{orgUnit:n.A.t("Please provide a valid organisation unit")}),o&&i},vZ={[$k.SCHEDULE_IN_ORG]:e=>yZ(e),[$k.ENTER_DATA]:e=>(e=>{const{orgUnit:t,setErrorMessages:r}=null!==e&&void 0!==e?e:{},a=Xt(t);return r(a?{orgUnit:null}:{orgUnit:n.A.t("Please provide a valid organisation unit")}),a})(e),[$k.LINK_EXISTING_RESPONSE]:e=>(e=>{const{linkedEventId:t,setErrorMessages:r}=null!==e&&void 0!==e?e:{},a=!!t;return r(a?{linkedEventId:null}:{linkedEventId:n.A.t("Please select a valid event")}),a})(e)};function fZ(){return fZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fZ.apply(this,arguments)}const IZ=(e,t)=>{var r,a;let{programId:o,enrollmentId:i,programStageId:s,currentStageLabel:l,...d}=e;const{currentRelatedStagesStatus:c,selectedRelationshipType:u,constraint:p}=nZ({programStageId:s,programId:o}),{scheduledLabel:m,occurredLabel:g}=((e,t)=>{var r,a;const o=ve(),{data:i,error:s,isLoading:l}=ri(["programStageLabels",t],(()=>o.get(z.PROGRAMS,e,{project:e=>{let{programStages:r}=e;const n=null===r||void 0===r?void 0:r.find((e=>e.id===t));if(!n)return{};const{displayDueDateLabel:a,displayExecutionDateLabel:o}=n;return{displayDueDateLabel:a,displayExecutionDateLabel:o}}})),{enabled:!!t});return{scheduledLabel:null!==(r=null===i||void 0===i?void 0:i.displayDueDateLabel)&&void 0!==r?r:n.A.t("Scheduled date"),occurredLabel:null!==(a=null===i||void 0===i?void 0:i.displayExecutionDateLabel)&&void 0!==a?a:n.A.t("Report date"),isLoading:l,error:s}})(o,null===p||void 0===p||null===(r=p.programStage)||void 0===r?void 0:r.id),{events:h,linkableEvents:E,isLoading:v}=(e=>{var t;let{stageId:r,enrollmentId:n,relationshipTypeId:a,scheduledLabel:o,occurredLabel:i,enabled:s=!0}=e;const l=(0,y.useMemo)((()=>({resource:"tracker/events",params:{programStage:r,enrollments:n,fields:"event,occurredAt,scheduledAt,status,relationships"}})),[r,n]),{data:d,isLoading:c,isError:u}=ai(["availableRelatedStageEvents",r,n,a],l,{enabled:!!r&&s,cacheTime:0,staleTime:0,select:e=>{const t=L(U.events,e);return 0===t.length?[]:t.map((e=>{var t;const r=!(null!==(t=e.relationships)&&void 0!==t&&t.some((e=>e.relationshipType===a))),n=e.occurredAt?`${i}: ${wt(new Date(e.occurredAt))}`:`${o}: ${wt(new Date(e.scheduledAt))}`;return{id:e.event,status:e.status,isLinkable:r,label:n}}))}});return{events:null!==d&&void 0!==d?d:[],linkableEvents:null!==(t=null===d||void 0===d?void 0:d.filter((e=>e.isLinkable)))&&void 0!==t?t:[],isLoading:c,isError:u}})({stageId:null===p||void 0===p||null===(a=p.programStage)||void 0===a?void 0:a.id,relationshipTypeId:null===u||void 0===u?void 0:u.id,scheduledLabel:m,occurredLabel:g,enrollmentId:i}),[f,I]=(0,y.useState)(!1),[b,T]=(0,y.useState)({}),[A,C]=(0,y.useState)({linkMode:void 0,scheduledAt:"",orgUnit:void 0,linkedEventId:void 0}),{isLoading:O,data:N}=oi();(0,y.useEffect)((()=>{O||1!==(null===N||void 0===N?void 0:N.length)||C((e=>({...e,orgUnit:N[0]})))}),[N,O,C]);const R=e=>{T((t=>({...t,...e})))},w=()=>c===Bk.LINKABLE,_=()=>(I(!0),P()),P=(0,y.useCallback)((()=>{const{scheduledAt:e,orgUnit:t,linkedEventId:r,linkMode:n}=A;return(e=>{let{linkMode:t,scheduledAt:r,orgUnit:n,linkedEventId:a,setErrorMessages:o}=e;if(!t)return!0;const i=vZ[t];return i?i({scheduledAt:r,orgUnit:n,linkedEventId:a,setErrorMessages:o}):(S().error((0,j.px)("No validation function found for referral mode")),!1)})({linkMode:n,scheduledAt:e,orgUnit:t,linkedEventId:r,setErrorMessages:R})}),[A]),k=()=>({linkMode:A.linkMode,relatedStageDataValues:A,selectedRelationshipType:u});return(0,y.useImperativeHandle)(t,(()=>({eventHasLinkableStageRelationship:w,formIsValidOnSave:_,getLinkedStageValues:k}))),(0,y.useEffect)((()=>{A&&P()}),[P,A]),!c||!u||v||O?null:y.createElement(EZ,fZ({relationshipName:u.displayName,scheduledLabel:m,type:c,events:h,linkableEvents:E,relatedStagesDataValues:A,setRelatedStagesDataValues:C,addErrorMessage:R,saveAttempted:f,errorMessages:b,constraint:p,currentStageLabel:l},d))},bZ=(0,y.forwardRef)(IZ);function SZ(){return SZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},SZ.apply(this,arguments)}const TZ=e=>{let{ready:t,stage:r,programName:n,programId:a,enrollmentId:o,eventSaveInProgress:i,formFoundation:s,classes:l,relatedStageRef:d,onSave:c,onCancel:u,orgUnit:p,id:m,...g}=e;return y.createElement(Ib,{noncollapsible:!0,borderless:!0,header:y.createElement(y.Fragment,null)},t&&y.createElement("div",{className:l.wrapper},y.createElement(HJ,SZ({},g,{stage:r,formFoundation:s,id:m,orgUnit:p})),y.createElement(bZ,{ref:d,enrollmentId:o,programId:a,programStageId:null===r||void 0===r?void 0:r.id,currentStageLabel:r.name}),y.createElement(eZ,{onSave:c,onCancel:u,isLoading:i,cancelButtonIsDisabled:i,id:m}),y.createElement(tZ,{programName:n,stageName:r.name,orgUnitName:p.name})))},AZ=(0,fp.default)((()=>({wrapper:{paddingLeft:yn.U.dp16}})))((0,y.memo)(TZ)),CZ="NewEvent.RequestSaveAndSetSubmissionInProgress",OZ="NewEvent.RequestSaveEvent",NZ="NewEvent.SaveEvent",RZ="NewEvent.StartCreateNewAfterCompleting",wZ="NewEvent.SetSaveEnrollmentEventInProgress",_Z="NewEvent.CleanUpDataEntry",PZ=e=>{let{requestEvent:t,linkedEvent:r,relationship:n,serverData:a,linkMode:o,onSaveExternal:i,onSaveSuccessActionType:s,onSaveErrorActionType:d}=e;return l(OZ)({requestEvent:t,linkedEvent:r,relationship:n,serverData:a,linkMode:o,onSaveExternal:i,onSaveSuccessActionType:s,onSaveErrorActionType:d},{skipLogging:["formFoundation"]})},kZ=e=>{let{requestEventId:t,linkedEventId:r,linkedOrgUnitId:n,linkMode:a}=e;return l(wZ)({requestEventId:t,linkedEventId:r,linkedOrgUnitId:n,linkMode:a})};const DZ=(0,j.Fs)(Mi,_i),UZ=e=>{let{linkMode:t,relatedStageDataValues:r,programId:n,teiId:a,currentProgramStageId:o,clientRequestEvent:i,enrollmentId:s,relatedStageType:l}=e;const d=l.fromConstraint.programStage.id===o,{linkedEvent:c,linkedEventId:u}=(e=>{let{relatedStageDataValues:t,requestEventIsFromConstraint:r,linkMode:n,relatedStageType:a,programId:o,teiId:i,enrollmentId:s,clientRequestEvent:l}=e;const d={event:rR(),program:o,programStage:r?a.toConstraint.programStage.id:a.fromConstraint.programStage.id,trackedEntity:i,enrollment:s,dataValues:[],notes:[],status:"SCHEDULE"};if(n===$k.SCHEDULE_IN_ORG){const{scheduledAt:e,orgUnit:r}=t;if(!e||!r)throw new Error((0,j.px)("Missing required data for creating related stage event")({linkedEventOrgUnit:r,linkedEventScheduledAt:e}));return{linkedEvent:{...d,scheduledAt:DZ(e,it.CO.DATE),orgUnit:DZ(r,it.CO.ORGANISATION_UNIT)},linkedEventId:d.event}}if(n===$k.ENTER_DATA){const{orgUnit:e}=t;if(!e)throw new Error((0,j.px)("Missing required data for creating related stage event")({linkedEventOrgUnit:e}));return{linkedEvent:{...d,scheduledAt:DZ(l.scheduledAt,it.CO.DATE),orgUnit:DZ(e,it.CO.ORGANISATION_UNIT)},linkedEventId:d.event}}if(n===$k.LINK_EXISTING_RESPONSE){const{linkedEventId:e}=t;return{linkedEvent:null,linkedEventId:e}}return S().error((0,j.px)(`Referral mode ${n} is not supported`)()),{linkedEvent:null,linkedEventId:null}})({relatedStageDataValues:r,requestEventIsFromConstraint:d,linkMode:t,relatedStageType:l,programId:n,teiId:a,enrollmentId:s,clientRequestEvent:i});return{linkedEvent:c,relationship:u&&{relationshipType:l.id,from:{event:{event:d?i.event:u}},to:{event:{event:d?u:i.event}}}}},LZ=e=>{let{dataEntryId:t,itemId:r,orgUnitId:n,programId:a,teiId:o,enrollmentId:i,orgUnitName:s,formFoundation:l}=e;const{serverVersion:{minor:d}}=(0,A.UK)(),c=`${t}-${r}`,u=(0,gs.d4)((e=>{let{formsValues:t}=e;return t[c]})),p=(0,gs.d4)((e=>{let{dataEntriesFieldsValue:t}=e;return t[c]})),m=(0,gs.d4)((e=>{let{dataEntriesFieldsMeta:t}=e;return t[c]})),g=(0,gs.d4)((e=>{let{dataEntriesNotes:t}=e;return t[c]})),{fromClientDate:h}=(0,A.Bp)();return{buildNewEventPayload:(e,t)=>{const r=rR(),{formClientValues:c,dataEntryClientValues:E}=SD(l,u,p,m),y=g?g.map((e=>({value:e.value}))):[],v=(e=>{let{formFoundation:t,formClientValues:r,mainDataClientValues:n,eventId:a,programId:o,orgUnitId:i,orgUnitName:s,teiId:l,enrollmentId:d,completed:c,fromClientDate:u,uid:p,serverMinorVersion:m}=e;const g=t.convertValues(r,_i),h=CD(n,m),E=u(new Date),y=new Date(E.getServerZonedISOString()),v=$()(y).format("YYYY-MM-DDTHH:mm:ss");return h.status||(h.status=c?"COMPLETED":"ACTIVE"),{...h,event:a,program:o,programStage:t.id,orgUnit:i,trackedEntity:l,enrollment:d,scheduledAt:h.occurredAt,orgUnitName:s,updatedAt:v,uid:p,dataValues:Object.keys(g).map((e=>({dataElement:e,value:g[e]}))).filter((e=>{let{value:t}=e;return null!=t}))}})({formFoundation:l,formClientValues:c,eventId:r,mainDataClientValues:{...E,notes:y},programId:a,orgUnitId:n,enrollmentId:i,teiId:o,orgUnitName:s,completed:e===sb.COMPLETE,fromClientDate:h,serverMinorVersion:d}),{formHasError:f,linkedEvent:I,relationship:b,linkMode:S}=((e,t,r)=>{if(r.current&&r.current.eventHasLinkableStageRelationship()){var n;if(!r.current.formIsValidOnSave()||null===(n=r.current)||void 0===n||!n.getLinkedStageValues)return{formHasError:!0,linkedEvent:null,relationship:null,linkMode:null};const{selectedRelationshipType:t,relatedStageDataValues:s,linkMode:d}=r.current.getLinkedStageValues();if(!d)return{formHasError:!1,linkedEvent:null,relationship:null,linkMode:null};const{linkedEvent:c,relationship:u}=UZ({linkMode:d,relatedStageDataValues:s,clientRequestEvent:e,relatedStageType:t,programId:a,currentProgramStageId:l.id,teiId:o,enrollmentId:i});return{formHasError:!1,linkedEvent:c,relationship:u,linkMode:d}}return{formHasError:!1,linkedEvent:null,relationship:null,linkMode:null}})(v,0,t);return{formHasError:f,clientRequestEvent:v,linkedEvent:I,relationship:b,linkMode:S}}}};function FZ(){return FZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},FZ.apply(this,arguments)}const xZ=ub()(AZ),MZ=sS()(xZ),VZ=zk()(MZ),jZ=e=>{let{program:t,stage:r,formFoundation:n,onSaveExternal:a,onSaveSuccessActionType:o,onSaveErrorActionType:i,orgUnit:s,teiId:d,enrollmentId:c,rulesExecutionDependencies:u,onSaveAndCompleteEnrollmentSuccessActionType:p,onSaveAndCompleteEnrollmentErrorActionType:m,...g}=e;const h="enrollmentEvent",E="newEvent",v=(0,y.useRef)(null),f=(0,gs.d4)((e=>{var t;let{enrollmentDomain:r}=e;return!(null===(t=r.eventSaveInProgress)||void 0===t||!t.requestEventId)})),{buildNewEventPayload:I}=LZ({dataEntryId:h,itemId:E,programId:t.id,orgUnitId:s.id,orgUnitName:s.name,teiId:d,enrollmentId:c,formFoundation:n}),b=((e,t)=>{let{events:r,attributeValues:n,enrollmentData:a}=e;return(0,y.useMemo)((()=>({events:HB(r),attributeValues:XJ(n,t),enrollmentData:JJ(a)})),[r,n,a,t])})(u,t),S=(e=>{let{program:t,stage:r,formFoundation:n,orgUnit:a,dataEntryId:o,itemId:i,rulesExecutionDependenciesClientFormatted:{events:s,attributeValues:l,enrollmentData:d}}=e;const c=(0,gs.wA)(),[u,p]=(0,y.useState)(1),m=(0,y.useRef)(!1),g=(0,y.useRef)(!1),{programCategory:h,isLoading:E}=RS(t.id);(0,y.useEffect)((()=>{E||(c((0,Xd.OJ)([...KJ(o,i,h)])),m.current=!0,g.current=!0)}),[c,o,i,t,n,E,h]);const v=(0,y.useRef)(),f=(0,y.useRef)(),I=(0,y.useRef)(),b=(0,gs.d4)((e=>e));(0,y.useEffect)((()=>{E||(g.current?(g.current=!1,p(-u)):(c((0,Xd.OJ)([QJ({state:b,program:t,stage:r,formFoundation:n,dataEntryId:o,itemId:i,orgUnit:a,eventsRulesDependency:s,attributesValuesRulesDependency:l,enrollmentDataRulesDependency:d})])),v.current=s,f.current=l,I.current=d))}),[c,a,s,l,t,r,o,i,u,E]);const S=v.current===s&&f.current===l&&I.current===d;return m.current&&S})({program:t,stage:r,formFoundation:n,orgUnit:s,dataEntryId:h,itemId:E,rulesExecutionDependenciesClientFormatted:b}),T=pd(r,d,c,t.id),A=(0,gs.wA)(),C=(0,y.useCallback)(((e,t,r,n,s)=>new Promise(((e,t)=>{window.scrollTo(0,0);const{clientRequestEvent:r,linkedEvent:l,relationship:d,linkMode:c,formHasError:u}=I(n,v);if(u)return void t(new Error("Form has error"));const g=(e=>{let{clientRequestEvent:t,linkedEvent:r,relationship:n,enrollment:a}=e;const o=n?[n]:void 0,i=r?[t,r]:[t];if(a)return{enrollments:[{...a,events:[...a.events||[],...i]}],relationships:o};return{events:i,relationships:o}})({clientRequestEvent:r,linkedEvent:l,relationship:d,enrollment:s});A((0,Xd.OJ)([PZ({requestEvent:r,linkedEvent:l,relationship:d,serverData:g,linkMode:c,onSaveExternal:a,onSaveSuccessActionType:s?p:o,onSaveErrorActionType:s?m:i}),kZ({requestEventId:null===r||void 0===r?void 0:r.event,linkedEventId:null===l||void 0===l?void 0:l.event,linkedOrgUnitId:null===l||void 0===l?void 0:l.orgUnit,linkMode:c})],CZ)),e()}))),[I,A,a,p,o,m,i]),O=(0,y.useCallback)((async e=>{try{await C(E,h,n,sb.COMPLETE),A((e=>{let{enrollmentId:t,isCreateNew:r,orgUnitId:n,programId:a,teiId:o,availableProgramStages:i}=e;return l(RZ)({enrollmentId:t,isCreateNew:r,orgUnitId:n,programId:a,teiId:o,availableProgramStages:i})})({enrollmentId:c,isCreateNew:e,orgUnitId:s.id,programId:t.id,teiId:d,availableProgramStages:T}))}catch(r){}}),[C,n,A,c,s.id,t.id,d,T]),N=(0,y.useCallback)(((e,t,r,n)=>{C(e,t,r,sb.COMPLETE,n)}),[C]);return(0,y.useEffect)((()=>()=>{A(l(_Z)())}),[A]),y.createElement(VZ,FZ({},g,{stage:r,allowGenerateNextVisit:r.allowGenerateNextVisit,askCompleteEnrollmentOnEventComplete:r.askCompleteEnrollmentOnEventComplete,selectedOrgUnitId:s.id,availableProgramStages:T,eventSaveInProgress:f,ready:S,id:h,itemId:E,enrollmentId:c,formFoundation:n,relatedStageRef:v,onSave:C,onCancelCreateNew:()=>O(),onConfirmCreateNew:()=>O(!0),programId:t.id,onSaveAndCompleteEnrollment:N,programName:t.name,orgUnit:s,rulesExecutionDependenciesClientFormatted:b}))};function GZ(){return GZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},GZ.apply(this,arguments)}const BZ=e=>{let{orgUnitId:t,...r}=e;const{error:a,orgUnit:o}=ZN(t);return a?y.createElement("div",null,n.A.t("organisation unit could not be retrieved. Please try again later.")):o?y.createElement(jZ,GZ({},r,{orgUnit:o})):null};class $Z extends y.Component{render(){const{classes:e,onCancel:t}=this.props;return y.createElement("div",null,y.createElement(Ck,{title:n.A.t("New event"),message:n.A.t("You don't have access to create an event in the current selections")}),y.createElement("div",{className:e.buttonRow},y.createElement("div",{className:e.buttonContainer},y.createElement(ra.$,{variant:"raised",color:"primary",disabled:!0},n.A.t("Save"))),y.createElement("div",{className:e.buttonContainer},y.createElement(ra.$,{variant:"text",color:"primary",onClick:t},n.A.t("Cancel")))))}}const WZ=(0,I.withStyles)((e=>({contents:{display:"flex",justifyContent:"center",alignItems:"center",paddingTop:50,paddingBottom:50},buttonRow:{display:"flex",flexWrap:"wrap",paddingTop:10,marginLeft:"-8px"},buttonContainer:{paddingRight:2*e.spacing.unit}})))($Z);function HZ(){return HZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HZ.apply(this,arguments)}const zZ=(e,t)=>{let{programId:r}=t;return r},YZ=(e,t)=>{let{stageId:r}=t;return r},qZ=(0,qd.compose)((0,gs.Ng)((()=>{const e=(0,fg.Mz)(zZ,YZ,((e,t)=>e&&(0,it.$j)(e,t)));return(t,r)=>{let{program:n,stage:a}=r;return{eventAccess:e(t,{programId:n.id,stageId:a.id})}}}),(()=>({}))),Dk(wf,((e,t)=>Df(e,t.widgetReducerName)||e.newEventPage.showAddRelationship)))((e=>{let{eventAccess:t,onCancel:r,...n}=e;return t.write?y.createElement(BZ,HZ({onCancel:r},n)):y.createElement(WZ,{onCancel:r})}));function KZ(){return KZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KZ.apply(this,arguments)}const QZ=e=>{let{programId:t,stageId:r,onSave:a,...o}=e;const{program:i}=(0,y.useMemo)((()=>(0,it.RE)(t,r)),[t,r]),{stage:s,formFoundation:l,isLoading:d,isError:c}=JR({programId:t,stageId:r});return d?y.createElement("div",null,n.A.t("Loading")):i&&s&&i instanceof it.rr&&!c&&l?y.createElement(qZ,KZ({},o,{stage:s,formFoundation:l,program:i,onSaveExternal:a})):y.createElement("div",null,n.A.t("program or stage is invalid"),";")},XZ=(0,fp.default)((()=>({wrapper:{paddingLeft:yn.U.dp16},header:{display:"flex",alignItems:"center",padding:yn.U.dp8},icon:{paddingRight:yn.U.dp8}})))((e=>{var t,r;let{stage:n,classes:a}=e;return y.createElement("div",{className:a.header},(null===n||void 0===n?void 0:n.icon)&&y.createElement("div",{className:a.icon},y.createElement(Tm,{name:null===n||void 0===n||null===(t=n.icon)||void 0===t?void 0:t.name,color:null===n||void 0===n||null===(r=n.icon)||void 0===r?void 0:r.color,width:30,height:30,cornerRadius:2})),y.createElement("span",null,null===n||void 0===n?void 0:n.name))})),JZ="ScheduleEvent.RequestScheduleEvent",ZZ="ScheduleEvent.ScheduleEvent",e0="ScheduleEvent.UpdateScheduledDate";function t0(){return t0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t0.apply(this,arguments)}const r0={container:{display:"flex",gap:yn.Q.dp8},button:{}},n0=(0,I.withStyles)(r0)((e=>{let{hasChanges:t,onSchedule:r,onCancel:a,classes:o}=e;const[i,s]=(0,y.useState)(!1);return y.createElement("div",{className:o.container},y.createElement("div",{className:o.button},y.createElement(ra.$,{onClick:r,primary:!0},n.A.t("Schedule"))),y.createElement("div",{className:o.button},y.createElement(ra.$,{onClick:()=>{t?s(!0):a()},secondary:!0},n.A.t("Cancel"))),y.createElement(Rf,t0({},wf,{onDestroy:a,open:i,onCancel:()=>{s(!1)}})))})),a0={infoBox:{marginTop:yn.U.dp16,padding:yn.U.dp16}},o0=(0,I.withStyles)(a0)((e=>{let{scheduleDate:t,suggestedScheduleDate:r,hideDueDate:a,eventCountInOrgUnit:o,orgUnitName:i,classes:s}=e;if(!t||!r)return null;const l=$()(t).diff($()(r),"days");return y.createElement(zm.I,{className:s.infoBox,title:n.A.t("Schedule date info")},a?y.createElement(y.Fragment,null,n.A.t("Scheduled automatically for {{suggestedScheduleDate}}",{suggestedScheduleDate:r})):y.createElement(y.Fragment,null,t===r?n.A.t("The scheduled date matches the suggested date, but can be changed if needed."):n.A.t("The scheduled date is {{count}} days {{position}} the suggested date.",{position:l>0?n.A.t("after"):n.A.t("before"),count:Math.abs(l),defaultValue:"The scheduled date is {{count}} day {{position}} the suggested date.",defaultValue_plural:"The scheduled date is {{count}} days {{position}} the suggested date."})," ",n.A.t("There are {{count}} scheduled event in {{orgUnitName}} on this day.",{count:o,orgUnitName:i,defaultValue:"There are {{count}} scheduled event in {{orgUnitName}} on this day.",defaultValue_plural:"There are {{count}} scheduled events in {{orgUnitName}} on this day.",interpolation:{escapeValue:!1}})))})),i0={container:{display:"flex",marginTop:yn.U.dp4},button:{paddingRight:yn.U.dp16}},s0=(0,fp.default)(i0)((e=>{let{scheduleDate:t,serverScheduleDate:r,setScheduleDate:n,orgUnit:a,serverSuggestedScheduleDate:o,eventCountInOrgUnit:i,classes:s,hideDueDate:l}=e;return y.createElement(y.Fragment,null,!l&&y.createElement("div",{className:s.container},y.createElement(Ep,{value:t,width:"100%",calendarWidth:350,onSetFocus:()=>{},onFocus:()=>{},onRemoveFocus:()=>{},onBlur:e=>{n(Pt(e))}})),y.createElement(o0,{scheduleDate:r,suggestedScheduleDate:o,eventCountInOrgUnit:i,orgUnitName:null===a||void 0===a?void 0:a.name,hideDueDate:l}))})),l0=e=>{let{orgUnitName:t,stageName:r,programName:a}=e;return y.createElement(SS,null,y.createElement("span",null,n.A.t("Scheduling an event in {{stageName}} for {{programName}} in {{orgUnitName}}",{orgUnitName:t,stageName:r,programName:a,interpolation:{escapeValue:!1}})))};class d0 extends y.Component{static getOptionsAsync(e,t,r){return Rd(e,{predicate:e=>{if(!t)return!0;const r=e.organisationUnits;return!r||!!r[t]},project:e=>({label:e.displayName,value:e.id,writeAccess:e.access.data.write}),onIsAborted:r})}static getDerivedStateFromProps(e,t){return e.selectedOrgUnitId!==t.prevOrgUnitId?{prevOrgUnitId:e.selectedOrgUnitId,options:null}:null}constructor(e){super(e),this.state={options:null,prevOrgUnitId:null,open:!1,selectedOption:e.initialValue},this.loadCagoryOptions(this.props)}componentDidUpdate(e){this.state.options||e.selectedOrgUnitId===this.props.selectedOrgUnitId||this.loadCagoryOptions(this.props)}componentWillUnmount(){this.cancelablePromise&&this.cancelablePromise.cancel(),this.cancelablePromise=null}loadCagoryOptions(e){const{category:t,selectedOrgUnitId:r}=e;let n;this.setState({options:null}),this.cancelablePromise&&this.cancelablePromise.cancel();n=(0,j.gI)(c0.getOptionsAsync(t.id,r,(()=>n&&this.cancelablePromise!==n))),n.promise.then((e=>{e.sort(((e,t)=>e.label===t.label?0:e.label<t.label?-1:1)),this.setState({options:e}),this.cancelablePromise=null})).catch((e=>{e&&(e.aborted||e.isCanceled)||(S().error((0,j.px)("An error occured loading category options")({error:e})),this.setState({options:[]}))})),this.cancelablePromise=n}render(){var e;const{onChange:t}=this.props,{options:r}=this.state;return r?y.createElement(zu,{value:null===(e=this.state.selectedOption)||void 0===e?void 0:e.value,nullable:!0,onChange:e=>{this.setState({selectedOption:e}),t(e)},options:r}):null}}const c0=(0,I.withStyles)((()=>({})))(d0),u0=(0,I.withStyles)((e=>({container:{display:"flex",padding:`${yn.Q.dp8}  ${yn.Q.dp16}`},error:{backgroundColor:e.palette.error.lighter},containerVertical:{display:"flex",flexDirection:"column",margin:8},label:{flexBasis:200,paddingLeft:5,paddingTop:11},field:{flexBasis:150,flexGrow:1},selectedText:{display:"flex",alignItems:"center"},requiredClass:{color:e.palette.required},errorMessage:{color:e.palette.error.main,fontSize:e.typography.pxToRem(14),padding:"10px 8px"}})))((e=>{const{classes:t,orientation:r="horizontal",categories:a,selectedOrgUnitId:o,selectedCategories:i,categoryOptionsError:s,onClickCategoryOption:l,onResetCategoryOption:d,required:c}=e;return a?y.createElement("div",null,a.map((e=>{var a,u;const{id:p}=e,m=(null===s||void 0===s||null===(a=s[p])||void 0===a?void 0:a.touched)&&!(null!==s&&void 0!==s&&null!==(u=s[p])&&void 0!==u&&u.valid);return y.createElement("div",{className:m?t.error:""},y.createElement("div",{className:"horizontal"===r?t.container:t.containerVertical},y.createElement("div",{className:"horizontal"===r&&t.label},e.displayName,c&&y.createElement("span",{className:t.requiredClass},"\xa0*")),y.createElement("div",{className:"horizontal"===r&&t.field},y.createElement(c0,{initialValue:null===i||void 0===i?void 0:i[e.id],category:e,selectedOrgUnitId:o,onChange:t=>{t?l(t.value,e.id):d(e.id)}}),m&&y.createElement("div",{className:t.errorMessage},n.A.t("Please select {{categoryName}}",{categoryName:e.displayName})))))}))):null}));function p0(){return p0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p0.apply(this,arguments)}const m0=(0,I.withStyles)((()=>({container:{display:"flex",alignItems:"baseline",padding:"8px 8px 8px 12px"},label:{fontSize:14,flexBasis:200,color:"#212934"},field:{flexBasis:150,flexGrow:1}})))((e=>{const{classes:t,assignee:r,...a}=e;return y.createElement("div",{className:t.container},y.createElement("div",{className:t.label},n.A.t("Assignee")),y.createElement("div",{className:t.field},y.createElement(Uh,p0({inputPlaceholderText:n.A.t("Search for user"),value:r},a))))}));function g0(){return g0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g0.apply(this,arguments)}const h0=(0,fp.default)((()=>({wrapper:{padding:`${yn.Q.dp16} 0`,maxWidth:"55.75rem"},fieldWrapper:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",padding:`${yn.Q.dp8}  ${yn.Q.dp16}`},fieldLabel:{color:vn.T.grey900,paddingTop:yn.U.dp16,paddingRight:yn.U.dp16},fieldContent:{flexBasis:"200px",flexGrow:1},containerWrapper:{padding:`${yn.Q.dp8}  ${yn.Q.dp16}`},container:{display:"flex",alignItems:"center",paddingTop:8,paddingBottom:8},label:{flexBasis:200,paddingLeft:5},field:{flexBasis:150,flexGrow:1}})))((e=>{let{stageId:t,programId:r,programName:a,stageName:o,displayDueDateLabel:i,orgUnit:s,onCancel:l,onSchedule:d,onAddNote:c,classes:u,scheduleDate:p,suggestedScheduleDate:m,serverSuggestedScheduleDate:g,notes:h,programCategory:E,enableUserAssignment:v,selectedCategories:f,onClickCategoryOption:I,onResetCategoryOption:b,onSetAssignee:S,assignee:T,categoryOptionsError:A,...C}=e;return y.createElement("div",{className:u.wrapper},y.createElement(aZ,{dataTest:"schedule-section",sectionName:n.A.t("Schedule info")},y.createElement("div",{className:u.fieldWrapper},y.createElement("div",{className:u.fieldLabel},null!==i&&void 0!==i?i:n.A.t("Schedule date / Due date",{interpolation:{escapeValue:!1}})),y.createElement("div",{className:u.fieldContent},y.createElement(s0,g0({programId:r,stageId:t,orgUnit:s,scheduleDate:p,serverSuggestedScheduleDate:g},C))))),E&&y.createElement(aZ,{dataTest:"category-options-section",sectionName:E.displayName},y.createElement(u0,{categories:E.categories,selectedOrgUnitId:null===s||void 0===s?void 0:s.id,selectedCategories:f,categoryOptionsError:A,onClickCategoryOption:I,onResetCategoryOption:b,required:!0})),y.createElement(aZ,{dataTest:"note-section",sectionName:n.A.t("Event notes")},y.createElement(Hq,{notes:h,placeholder:n.A.t("Write a note about this scheduled event"),handleAddNote:c})),v&&y.createElement(aZ,{dataTest:"assignee-section",sectionName:n.A.t("Assignee")},y.createElement(m0,{onSet:S,assignee:T})),y.createElement(n0,{hasChanges:p!==m,onCancel:l,onSchedule:d}),y.createElement(l0,{programName:a,stageName:o,orgUnitName:(null===s||void 0===s?void 0:s.name)||""}))})),E0=e=>Et(e,it.CO.DATE),y0=(e,t)=>$().utc(t.eventDate).diff($().utc(e.eventDate)),v0=e=>{let t,{generatedByEnrollmentDate:r,displayIncidentDate:n,enrolledAt:a,occurredAt:o,minDaysFromStart:i}=e;return t=r||!n?$()(a).add(i,"days").format():$()(o).add(i,"days").format(),t},f0=e=>{let{programStageScheduleConfig:t,programConfig:r,enrolledAt:n,occurredAt:a,eventData:o,initialScheduleDate:i,hideDueDate:s}=e;if(i&&!s)return Pt(i);if(!t)return;const{nextScheduleDate:l,standardInterval:d,generatedByEnrollmentDate:c,minDaysFromStart:u,id:p}=t,{displayIncidentDate:m}=r,g=o.filter((e=>e.programStage===p)),h=[()=>{if(s)return v0({generatedByEnrollmentDate:c,displayIncidentDate:m,enrolledAt:n,occurredAt:a,minDaysFromStart:u})},()=>(null===l||void 0===l?void 0:l.id)&&((e,t)=>{const r=t.map((e=>{var t;return{...e,eventDate:null!==(t=e.scheduledAt)&&void 0!==t?t:e.occurredAt}})).reduce(((t,r)=>(r.dataValues.forEach((n=>{n.dataElement===e&&null!==n.value&&t.push({...n,eventDate:E0(r.eventDate)})})),t)),[]).sort(y0);if(r.length)return r[0].value})(l.id,g),()=>d&&((e,t)=>{const r=t.map((e=>{var t;return{eventDate:null!==(t=e.scheduledAt)&&void 0!==t?t:e.occurredAt}})).filter((e=>e.eventDate)).map((e=>({eventDate:E0(e.eventDate)}))).sort(y0);if(r.length)return $()(r[0].eventDate).add(e,"days").format()})(d,g),()=>v0({generatedByEnrollmentDate:c,displayIncidentDate:m,enrolledAt:n,occurredAt:a,minDaysFromStart:u})];return Pt(xt(h.reduce(((e,t)=>e||t()),void 0),it.CO.DATE))};class I0 extends y.Component{render(){const{classes:e,onCancel:t}=this.props;return y.createElement("div",null,y.createElement(Ck,{title:n.A.t("New event"),message:n.A.t("You don't have access to create an event in the current selections")}),y.createElement("div",{className:e.buttonRow},y.createElement("div",{className:e.buttonContainer},y.createElement(ra.$,{variant:"raised",color:"primary",disabled:!0},n.A.t("Save"))),y.createElement("div",{className:e.buttonContainer},y.createElement(ra.$,{variant:"text",color:"primary",onClick:t},n.A.t("Cancel")))))}}const b0=(0,I.withStyles)((e=>({contents:{display:"flex",justifyContent:"center",alignItems:"center",paddingTop:50,paddingBottom:50},buttonRow:{display:"flex",flexWrap:"wrap",paddingTop:10,marginLeft:"-8px"},buttonContainer:{paddingRight:2*e.spacing.unit}})))(I0);function S0(){return S0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},S0.apply(this,arguments)}const T0=e=>{let{enrollmentId:t,teiId:r,stageId:a,programId:o,orgUnitId:i,onSave:s,onSaveSuccessActionType:d,onSaveErrorActionType:c,onCancel:u,initialScheduleDate:p,enableUserAssignment:m,assignee:g,...h}=e;const{program:E,stage:v}=(0,y.useMemo)((()=>(0,it.RE)(o,a)),[o,a]),f=(0,gs.wA)(),I={id:i,name:mi(i).displayName},{programStageScheduleConfig:b}=(e=>{const{data:t,error:r,loading:n}=(0,A.iO)((0,y.useMemo)((()=>({programStageScheduleConfig:{resource:"programStages",id:e,params:{fields:["id,nextScheduleDate,standardInterval,generatedByEnrollmentDate,minDaysFromStart,displayDueDateLabel"]}}})),[e]));return{error:r,programStageScheduleConfig:!n&&t.programStageScheduleConfig}})(a),{programConfig:S}=(e=>{const{data:t,error:r,loading:n}=(0,A.iO)((0,y.useMemo)((()=>({programConfig:{resource:"programs",id:e,params:{fields:["displayIncidentDate"]}}})),[e]));return{error:r,programConfig:!n&&(null===t||void 0===t?void 0:t.programConfig)}})(o),T=f0({programStageScheduleConfig:b,programConfig:S,initialScheduleDate:p,...h}),{currentUser:C,noteId:O}=(()=>{const{data:e,error:t,loading:r}=(0,A.iO)((0,y.useMemo)((()=>({currentUser:{resource:"me",params:{fields:["firstName,surname,username"]}}})),[]));return{error:t,currentUser:!r&&e.currentUser,noteId:rR()}})(),[N,R]=(0,y.useState)(""),w=(0,j.Fs)(Mi,_i),_=w(N,it.CO.DATE),P=w(T,it.CO.DATE),[k,D]=(0,y.useState)([]),[F,x]=(0,y.useState)(g),{events:M}=((e,t)=>{const{data:r,error:n,loading:a,refetch:o}=(0,A.iO)((0,y.useMemo)((()=>({events:{resource:"tracker/events",params:e=>{let{variables:{orgUnitId:t,selectedDate:r}}=e;return{orgUnit:t,occurredAfter:r,occurredBefore:r,skipPaging:!0,status:"SCHEDULE",ouMode:"SELECTED",fields:"scheduledAt"}}}})),[]),{lazy:!0});(0,y.useEffect)((()=>{e&&t&&o({variables:{orgUnitId:e,selectedDate:t}})}),[o,e,t]);const i=L(U.events,null===r||void 0===r?void 0:r.events);return{error:n,events:!a&&r?i:[]}})(i,_),{eventId:V}=vs(),G=M.filter((e=>$()(e.scheduledAt).format("YYYY-MM-DD")===_)).length,[B,W]=(0,y.useState)({}),[H,z]=(0,y.useState)(),{programCategory:Y}=RS(o);(0,y.useEffect)((()=>{!N&&T&&R(T)}),[T,N]),(0,y.useEffect)((()=>{x(g)}),[g]);const q=(0,y.useCallback)((()=>{var e;if(null!==Y&&void 0!==Y&&Y.categories&&Object.keys(B).length!==(null===Y||void 0===Y||null===(e=Y.categories)||void 0===e?void 0:e.length)){const e=Y.categories.filter((e=>{let{id:t}=e;return!B[t]})).reduce(((e,t)=>(e[t.id]={touched:!0,valid:!1},e)),{});z(e)}else f((e=>{let{scheduleDate:t,notes:r,programId:n,orgUnitId:a,stageId:o,teiId:i,eventId:s,enrollmentId:d,categoryOptions:c,onSaveExternal:u,onSaveSuccessActionType:p,onSaveErrorActionType:m,assignedUser:g}=e;return l(JZ)({scheduleDate:t,notes:r,programId:n,orgUnitId:a,stageId:o,teiId:i,enrollmentId:d,eventId:s,categoryOptions:c,onSaveExternal:u,onSaveSuccessActionType:p,onSaveErrorActionType:m,assignedUser:g})})({scheduleDate:_,notes:k,programId:o,orgUnitId:i,stageId:a,teiId:r,enrollmentId:t,eventId:V,categoryOptions:B,onSaveExternal:s,onSaveSuccessActionType:d,onSaveErrorActionType:c,...F&&{assignedUser:_i(F,it.CO.ASSIGNEE)}}))}),[f,_,k,o,i,a,r,t,V,B,s,d,c,Y,F]);y.useEffect((()=>{T&&!N&&R(T)}),[N,T]);const K=(0,y.useCallback)((e=>x(e)),[]),Q=(0,y.useCallback)(((e,t)=>{W((r=>({...r,[t]:e}))),z((e=>({...e,[t]:{touched:!0,valid:!0}})))}),[W]),X=(0,y.useCallback)((e=>{const t={...B};delete t[e],W(t),z((t=>({...t,[e]:{touched:!0,valid:!1}})))}),[W,B]);if(!E||!v||!(E instanceof it.rr))return y.createElement("div",null,n.A.t("program or stage is invalid"),";");const J=(0,it.$j)(o,a);return null!==J&&void 0!==J&&J.write?y.createElement(h0,S0({assignee:F,stageId:a,stageName:v.name,programId:o,programCategory:Y,programName:E.name,enableUserAssignment:m&&(null===v||void 0===v?void 0:v.enableUserAssignment),scheduleDate:N,serverScheduleDate:_,displayDueDateLabel:b.displayDueDateLabel,suggestedScheduleDate:T,serverSuggestedScheduleDate:P,onCancel:u,setScheduleDate:R,onSchedule:q,onAddNote:e=>{const t={storedBy:C.userName,storedAt:$()().toISOString(),value:e,createdBy:{firstName:C.firstName,surname:C.surname},note:O};D([...k,t])},eventCountInOrgUnit:G,orgUnit:I,notes:k,selectedCategories:B,categoryOptionsError:H,onClickCategoryOption:Q,onResetCategoryOption:X,onSetAssignee:K},h)):y.createElement(b0,{onCancel:u})},A0="NewEnrollmentEventPage.saveEventSuccess",C0="NewEnrollmentEventPage.saveEventError",O0="ScheduleEvent.ScheduleEventSuccess",N0="ScheduleEvent.ScheduleEventError",R0="NewEnrollmentEventPage.EventSaveAndEnrollmentCompleteSuccess",w0="NewEnrollmentEventPage.EventSaveAndEnrollmentCompleteError";function _0(){return _0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_0.apply(this,arguments)}const P0=(0,fp.default)((()=>({innerWrapper:{padding:`0 ${yn.U.dp16}px`}})))((e=>{let{stageId:t,programId:r,orgUnitId:a,teiId:o,enrollmentId:i,dataEntryHasChanges:s,onCancel:l,onSave:d,classes:c,...u}=e;const{tab:p}=vs(),{events:m,enrolledAt:g,occurredAt:h}=(0,gs.d4)((e=>{let{enrollmentDomain:t}=e;return null===t||void 0===t?void 0:t.enrollment})),[E,v]=(0,y.useState)(null!==p&&void 0!==p?p:Pq.REPORT),[f,I]=(0,y.useState)(!1),b=(0,y.useRef)(void 0),{stage:S}=(0,y.useMemo)((()=>(0,it.RE)(r,t)),[r,t]),T=e=>{s?(I(!0),b.current=e):v(e)};return y.createElement(y.Fragment,null,y.createElement(Ib,{noncollapsible:!0,header:y.createElement(XZ,{stage:S})},y.createElement("div",{"data-test":"add-event-enrollment-page-content",className:c.innerWrapper},y.createElement(oJ.V,{dataTest:"new-event-tab-bar"},y.createElement(iJ.o,{key:"report-tab",selected:E===Pq.REPORT,onClick:()=>T(Pq.REPORT),dataTest:"new-event-report-tab"},n.A.t("Report")),y.createElement(iJ.o,{key:"schedule-tab",selected:E===Pq.SCHEDULE,onClick:()=>T(Pq.SCHEDULE),dataTest:"new-event-schedule-tab"},n.A.t("Schedule"))),E===Pq.REPORT&&y.createElement(QZ,_0({programId:r,stageId:t,orgUnitId:a,teiId:o,enrollmentId:i,onSaveSuccessActionType:A0,onSaveErrorActionType:C0,onSaveAndCompleteEnrollmentSuccessActionType:R0,onSaveAndCompleteEnrollmentErrorActionType:w0,onSave:d,onCancel:l},u)),E===Pq.SCHEDULE&&y.createElement(T0,{programId:r,stageId:t,orgUnitId:a,teiId:o,eventData:m,enrollmentId:i,enrolledAt:g,occurredAt:h,onSaveSuccessActionType:O0,onSaveErrorActionType:N0,onSave:d,onCancel:l,hideDueDate:null===S||void 0===S?void 0:S.hideDueDate,enableUserAssignment:!0}))),y.createElement(Rf,_0({},wf,{onDestroy:()=>{v(b.current),I(!1)},open:f,onCancel:()=>I(!1)})))}));function k0(){return k0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},k0.apply(this,arguments)}var D0=r(89345),U0=r(29105);function L0(){return L0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},L0.apply(this,arguments)}function F0(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const x0=e=>class extends y.Component{constructor(){super(...arguments),F0(this,"renderMainButton",(e=>y.createElement(aI,{content:n.A.t("No write access"),enabled:!e},y.createElement(ra.$,{onClick:()=>{this.props.onSave()},disabled:!e,primary:!0},n.A.t("Save")))))}getWrappedInstance(){return this.innerInstance}render(){const{onSave:t,...r}=this.props,n=this.props.formFoundation.access.data.write;return y.createElement(e,L0({innerRef:e=>{this.innerInstance=e},mainButton:this.renderMainButton(n)},r))}},M0=()=>({});var V0="dataEntryFieldLabels_trueOnlyLabel__2ICnb",j0="dataEntryFieldLabels_coordinateLabel__EGaSb",G0="dataEntryFieldLabels_polygonLabel__hjhfw",B0="dataEntryFieldLabels_dateLabel__MuySN",$0="dataEntryFieldLabels_selectLabel__fJgx2";function W0(){return W0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},W0.apply(this,arguments)}function H0(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const z0=e=>class extends y.Component{constructor(e){super(e),H0(this,"renderDeleteButton",(e=>e?y.createElement("div",null,y.createElement(ra.$,{onClick:()=>{this.setState({isOpen:!0})},disabled:!this.props.formFoundation.access.data.write,destructive:!0},n.A.t("Delete")),this.state.isOpen&&y.createElement(N.a,{hide:!this.state.isOpen},y.createElement(Ip.w,null,n.A.t("Delete event")),y.createElement(R.$,null,n.A.t("Deleting an event is permanent and cannot be undone. Are you sure you want to delete this event? ")),y.createElement(ta.N,null,y.createElement(Nf.v,{end:!0},y.createElement(ra.$,{onClick:()=>{this.setState({isOpen:!1})},secondary:!0},n.A.t("No, cancel")),y.createElement(ra.$,{onClick:()=>{this.props.onDelete(),this.setState({isOpen:!1})},destructive:!0},n.A.t("Yes, delete event")))))):null)),this.state={isOpen:!1}}getWrappedInstance(){return this.innerInstance}render(){const{onDelete:t,hasDeleteButton:r,...n}=this.props;return y.createElement(e,W0({innerRef:e=>{this.innerInstance=e},deleteButton:this.renderDeleteButton(r)},n))}};function Y0(){return Y0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Y0.apply(this,arguments)}function q0(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const K0=Object.freeze({REPORT:"REPORT",SCHEDULE:"SCHEDULE"}),Q0="BASICINFO",X0="STATUS",J0={errorMessage:"validationError"},Z0={labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}},e1={labelContainerStyle:{width:150},inputContainerStyle:{width:150}};function t1(e){const{formHorizontal:t,fieldOptions:r,validationError:n,modified:a,...o}=e;return o}const r1=e=>({fieldOptions:e.fieldOptions,formHorizontal:e.formHorizontal,styles:e.formHorizontal?e1:Z0}),n1=(e,t)=>({...r1(e),...t}),a1=nm(J0)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${j0}`})(pm()(Qr()(vm(t1)(Np)))))))),o1=nm(J0)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${G0}`})(pm()(Qr()(vm(t1)(_p)))))))),i1=PS({})(CS((()=>{const e=nm(J0)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions&&e.fieldOptions.fieldLabelMediaBasedClass} ${$0}`})(pm()(Qr()(vm(t1)(tp))))))));return{getComponent:()=>e,getComponentProps:(e,t)=>{var r,n;return n1(e,{...null!==(r=null===(n=e.categories)||void 0===n?void 0:n.find((e=>e.id===t)))&&void 0!==r?r:{},required:!0})},getPropName:(e,t)=>t?`${NS}-${t}`:NS,getFieldIds:e=>{var t;return null===(t=e.categories)||void 0===t?void 0:t.map((e=>e.id))},getValidatorContainers:(e,t)=>kS(e,t),getMeta:e=>{var t;return{section:OS,placement:gf,sectionName:null===(t=e.programCategory)||void 0===t?void 0:t.displayName}}}})())(Of)),s1=nS()(i1),l1=GI({isApplicable:e=>{const t=e.formFoundation.featureType;return["Polygon","Point"].includes(t)},getComponent:e=>"Polygon"===e.formFoundation.featureType?o1:a1,getComponentProps:e=>{const t=e.formFoundation.featureType;return n1(e,"Polygon"===t?{width:e&&e.formHorizontal?150:350,label:n.A.t("Area"),dialogLabel:n.A.t("Area"),required:!1,orgUnit:e.orgUnit}:{width:e&&e.formHorizontal?150:"100%",label:n.A.t("Coordinate"),dialogLabel:n.A.t("Coordinate"),required:!1,orgUnit:e.orgUnit})},getPropName:()=>"geometry",getValidatorContainers:()=>[],getMeta:()=>({placement:gf,section:Q0})})(s1),d1=Qf({getComponent:e=>{return t=e,nm(J0)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${B0}`,customTooltip:()=>[Es.SCHEDULE,Es.OVERDUE].includes(t.eventStatus)?n.A.t("Go to \u201cSchedule\u201d tab to reschedule this event"):n.A.t("Scheduled date cannot be changed for {{ eventStatus }} events",{eventStatus:ys()[t.eventStatus]})})(pm()(Qr()(vm(t1)(Ep))))))));var t},getComponentProps:e=>n1(e,{width:"100%",calendarWidth:350,label:e.formFoundation.getLabel("scheduledAt"),disabled:!0}),getIsHidden:e=>e.id!==M.ENROLLMENT_EVENT||e.hideDueDate,getPropName:()=>"scheduledAt",getValidatorContainers:()=>UB(),getMeta:()=>({placement:gf,section:Q0})})(l1),c1=Qf((()=>{const e=nm(J0)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${B0}`})(pm()(Qr()(vm(t1)(Ep))))))));return{getComponent:()=>e,getComponentProps:e=>n1(e,{width:"100%",calendarWidth:350,label:e.formFoundation.getLabel("occurredAt"),required:!0}),getPropName:()=>"occurredAt",getValidatorContainers:()=>UB(),getMeta:()=>({placement:gf,section:Q0})}})())(d1),u1=ub({onIsCompleting:e=>"true"===e.completeDataEntryFieldValue,onFilterProps:e=>{const{completeDataEntryFieldValue:t,...r}=e;return r}})((e=>(0,gs.Ng)(null,M0)(x0(e)))(c1)),p1=Mf((()=>({color:"primary"})))(u1),m1=(e=>z0(e))(Qf((()=>{const e=nm(J0)(hr()(hm()(ym()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${V0}`})(pm()(Qr()(Mu)))))));return{getComponent:()=>e,getComponentProps:e=>n1(e,{label:n.A.t("Complete event"),id:"complete"}),getPropName:()=>"complete",getValidatorContainers:()=>[],getMeta:()=>({placement:hf,section:X0}),getPassOnFieldData:()=>!0}})())(p1)),g1=sS()(m1),h1=zk()(g1),E1=YI()(h1),y1={[Q0]:{placement:gf,name:n.A.t("Basic info")},[OS]:{placement:gf},[X0]:{placement:hf,name:n.A.t("Status")}};class v1 extends y.Component{constructor(e){super(e),q0(this,"onHandleSwitchTab",(e=>this.setState({mode:e}))),this.fieldOptions={theme:e.theme,fieldLabelMediaBasedClass:e.classes.fieldLabelMediaBased},this.dataEntrySections=y1,this.state={mode:K0.REPORT},this.onHandleSwitchTab=this.onHandleSwitchTab.bind(this)}renderScheduleView(){const{orgUnit:e,programId:t,eventStatus:r,onUpdateDataEntryField:a,onUpdateField:o,onStartAsyncUpdateField:i,onHandleScheduleSave:s,onSave:l,classes:d,dataEntryId:c,onCancelEditEvent:u,assignee:p,...m}=this.props;return y.createElement("div",null,y.createElement(oJ.V,{dataTest:"edit-event-tab-bar"},y.createElement(iJ.o,{key:"report-tab",selected:this.state.mode===K0.REPORT,onClick:()=>this.onHandleSwitchTab(K0.REPORT),dataTest:"edit-event-report-tab"},n.A.t("Report")),y.createElement(iJ.o,{key:"schedule-tab",selected:this.state.mode===K0.SCHEDULE,onClick:()=>this.onHandleSwitchTab(K0.SCHEDULE),dataTest:"edit-event-schedule-tab"},n.A.t("Schedule"))),this.state.mode===K0.REPORT&&this.renderDataEntry(),this.state.mode===K0.SCHEDULE&&y.createElement(T0,Y0({programId:t,onSave:s,orgUnitId:e.id,onSaveSuccessActionType:V$,onSaveErrorActionType:j$,assignee:p},m)))}renderDataEntry(){const{dataEntryId:e,orgUnit:t,programId:r,onUpdateDataEntryField:n,onUpdateField:a,onStartAsyncUpdateField:o,onSave:i,onSaveAndCompleteEnrollment:s,classes:l,...d}=this.props;return y.createElement(E1,Y0({id:e,onUpdateDataEntryField:n(t,r),onUpdateFormField:a(t,r),onUpdateFormFieldAsync:o(t,r),onSave:i(t),onSaveAndCompleteEnrollment:s(t),fieldOptions:this.fieldOptions,dataEntrySections:this.dataEntrySections,orgUnit:t,programId:r,selectedOrgUnitId:null===t||void 0===t?void 0:t.id},d))}render(){const{eventStatus:e}=this.props;return[Es.SCHEDULE,Es.OVERDUE].includes(e)?this.renderScheduleView():this.renderDataEntry()}}const f1=(0,I.withStyles)((e=>({dataEntryContainer:{},fieldLabelMediaBased:{[e.breakpoints.down(523)]:{paddingTop:"0px !important"}}})))(v1),I1=(0,gs.Ng)(((e,t)=>{var r,n,a,o,i,s,l;const d=e.viewEventPage.eventDetailsSection||{},c=e.dataEntries[t.dataEntryId]&&e.dataEntries[t.dataEntryId].itemId,u=`${t.dataEntryId}-${c}`,p="true"===(null===(r=e.dataEntriesFieldsValue[u])||void 0===r?void 0:r.complete);return{ready:!e.activePage.isDataEntryLoading&&!d.loading,itemId:c,isCompleted:p,enrolledAt:null===(n=e.enrollmentDomain)||void 0===n||null===(a=n.enrollment)||void 0===a?void 0:a.enrolledAt,occurredAt:null===(o=e.enrollmentDomain)||void 0===o||null===(i=o.enrollment)||void 0===i?void 0:i.occurredAt,eventData:null===(s=e.enrollmentDomain)||void 0===s||null===(l=s.enrollment)||void 0===l?void 0:l.events}}),((e,t)=>({onUpdateDataEntryField:(t,r)=>n=>{const{dataEntryId:a,itemId:o}=n.payload,i=(0,yc.A)();e((0,Xd.OJ)([n,nv(a,o,i),ZB({...n.payload,uid:i,orgUnit:t,programId:r})],zB))},onUpdateField:(t,r)=>n=>{const{dataEntryId:a,itemId:o}=n.payload,i=(0,yc.A)();e((0,Xd.OJ)([n,nv(a,o,i),ZB({...n.payload,uid:i,orgUnit:t,programId:r})],YB))},onStartAsyncUpdateField:(t,r)=>(n,a,o)=>{e(((e,t,r)=>d(e)({onSuccess:t,onError:r}))(n,(e=>{const n=(0,yc.A)();return(0,Xd.OJ)([e,nv(a,o,n),ZB({...e.payload,dataEntryId:a,itemId:o,uid:n,orgUnit:t,programId:r})],YB)}),(e=>e)))},onSave:()=>(r,n,a)=>{const{onSaveExternal:o}=t;window.scrollTo(0,0),o&&o(),e(W$(r,n,a))},onSaveAndCompleteEnrollment:()=>(r,n,a,o)=>{const{onSaveAndCompleteEnrollmentExternal:i,onSaveAndCompleteEnrollmentSuccessActionType:s,onSaveAndCompleteEnrollmentErrorActionType:d}=t;e((e=>{let{itemId:t,dataEntryId:r,formFoundation:n,onSaveAndCompleteEnrollmentExternal:a,onSaveAndCompleteEnrollmentSuccessActionType:o,onSaveAndCompleteEnrollmentErrorActionType:i,enrollment:s}=e;return l(B$)({itemId:t,dataEntryId:r,formFoundation:n,onSaveAndCompleteEnrollmentExternal:a,onSaveAndCompleteEnrollmentSuccessActionType:o,onSaveAndCompleteEnrollmentErrorActionType:i,enrollment:s},{skipLogging:["formFoundation"]})})({itemId:r,dataEntryId:n,formFoundation:a,onSaveAndCompleteEnrollmentExternal:i,onSaveAndCompleteEnrollmentSuccessActionType:s,onSaveAndCompleteEnrollmentErrorActionType:d,enrollment:o}))},onCancel:()=>{const{eventStatus:r,onCancelEditEvent:n}=t,a=r===Es.SCHEDULE||r===Es.OVERDUE;window.scrollTo(0,0),e((0,Xd.OJ)([$$(),...a?[]:[sv(t.dataEntryId,V.VIEW)]])),n&&n(a)},onDelete:()=>{const{enrollmentId:r}=t,{eventId:n}=fs();e((e=>{let{eventId:t,enrollmentId:r}=e;return l(L$)({eventId:t,enrollmentId:r})})({eventId:n,enrollmentId:r}))},onCancelCreateNew:r=>{const{dataEntryId:n,formFoundation:a,orgUnit:o,enrollmentId:i,programId:s,teiId:l,availableProgramStages:d}=t;e(W$(r,n,a)),e(Y$({enrollmentId:i,isCreateNew:!1,orgUnitId:o.id,programId:s,teiId:l,availableProgramStages:d}))},onConfirmCreateNew:r=>{const{dataEntryId:n,formFoundation:a,orgUnit:o,enrollmentId:i,programId:s,teiId:l,availableProgramStages:d}=t;e(W$(r,n,a)),e(Y$({enrollmentId:i,isCreateNew:!0,orgUnitId:o.id,programId:s,teiId:l,availableProgramStages:d}))}})))(Dp()(f1));var b1="viewEventDataEntryFieldLabels_defaultViewLabel__bi6Pd";const S1=Object.freeze({ACTIVE:"occurredAt",COMPLETED:"occurredAt",SCHEDULE:"scheduledAt"});function T1(){return T1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},T1.apply(this,arguments)}const A1=(0,j.Fs)(Mi,Ci),C1="BASICINFO",O1="STATUS",N1="NOTES",R1={labelContainerStyle:{flexBasis:200},inputContainerStyle:{flexBasis:150}},w1={labelContainerStyle:{width:150},inputContainerStyle:{width:150}};const _1=e=>({fieldOptions:e.fieldOptions,formHorizontal:e.formHorizontal,styles:e.formHorizontal?w1:R1}),P1=(e,t)=>({..._1(e),...t}),k1=hm()(Pm({onGetUseVerticalOrientation:e=>e.formHorizontal,onGetCustomFieldLabeClass:e=>`${e.fieldOptions.fieldLabelMediaBasedClass} ${b1}`})(vm((function(e){const{formHorizontal:t,fieldOptions:r,validationError:n,modified:a,...o}=e;return o}))(Wp))),D1=PS({})(CS((()=>{const e={getComponent:()=>k1,getComponentProps:(e,t)=>{var r,n;return P1(e,{...null!==(r=null===(n=e.categories)||void 0===n?void 0:n.find((e=>e.id===t)))&&void 0!==r?r:{},valueConverter:r=>{var n,a,o,i;return null===(n=e.categories)||void 0===n||null===(a=n.find((e=>e.id===t)))||void 0===a||null===(o=a.options)||void 0===o||null===(i=o.find((e=>e.value===r)))||void 0===i?void 0:i.label}})},getPropName:(e,t)=>t?`${NS}-${t}`:NS,getFieldIds:e=>{var t;return null===(t=e.categories)||void 0===t?void 0:t.map((e=>e.id))},getValidatorContainers:()=>kS(),getMeta:e=>{var t;return{section:OS,placement:hf,sectionName:null===(t=e.programCategory)||void 0===t?void 0:t.displayName}}};return e})())(Of)),U1=nS()(D1),L1=GI({isApplicable:e=>{const t=e.formFoundation.featureType;return["Polygon","Point"].includes(t)},getComponent:()=>k1,getComponentProps:e=>{if("Polygon"===e.formFoundation.featureType)return P1(e,{label:n.A.t("Area"),valueConverter:e=>e?"Polygon captured":"No polygon captured"});const t=new it.fq((e=>{e.id="geometry",e.type=it.CO.COORDINATE}));return P1(e,{label:"Coordinate",valueConverter:e=>t.convertValue(e,A1)})},getPropName:()=>"geometry",getValidatorContainers:()=>[],getMeta:()=>({placement:gf,section:C1})})(U1),F1=Qf((()=>{const e=new it.fq((e=>{e.type=it.CO.DATE})),t={getComponent:()=>k1,getComponentProps:t=>P1(t,{label:`${t.formFoundation.getLabel("scheduledAt")}`,valueConverter:t=>e.convertValue(t,A1)}),getIsHidden:e=>e.id!==M.ENROLLMENT_EVENT||e.hideDueDate,getPropName:()=>"scheduledAt",getMeta:()=>({placement:gf,section:C1})};return t})())(L1),x1=Qf((()=>{const e=new it.fq((e=>{e.type=it.CO.DATE})),t={getComponent:()=>k1,getComponentProps:t=>P1(t,{label:t.formFoundation.getLabel(S1[t.eventStatus]),valueConverter:t=>e.convertValue(t,A1)}),getPropName:e=>S1[e.eventStatus],getMeta:()=>({placement:gf,section:C1})};return t})())(F1),M1=Qf((()=>{const e=new it.fq((e=>{e.id="complete",e.type=it.CO.BOOLEAN})),t={getComponent:()=>k1,getComponentProps:t=>P1(t,{label:n.A.t("Event completed"),id:e.id,valueConverter:t=>e.convertValue(t,A1)}),getPropName:()=>e.id,getMeta:()=>({placement:hf,section:O1}),passOnFieldData:!0};return t})())(x1),V1=YI()(M1),j1={[C1]:{placement:gf,name:n.A.t("Basic info")},[O1]:{placement:hf,name:n.A.t("Status")},[N1]:{placement:hf,name:n.A.t("Notes")},[OS]:{placement:gf,name:""}};class G1 extends y.Component{constructor(e){super(e),this.fieldOptions={theme:e.theme,fieldLabelMediaBasedClass:e.classes.fieldLabelMediaBased},this.dataEntrySections=j1}render(){const{classes:e,dataEntryId:t,itemId:r,...n}=this.props;return y.createElement(V1,T1({id:t,viewMode:!0,fieldOptions:this.fieldOptions,dataEntrySections:this.dataEntrySections},n))}}const B1=(0,I.withStyles)((e=>({header:{...e.typography.title,fontSize:18,padding:e.typography.pxToRem(10),borderBottom:`1px solid ${e.palette.grey.blueGrey}`},paper:{maxWidth:e.typography.pxToRem(1070)},container:{flexGrow:3},content:{display:"flex"},dataEntryContainer:{flexGrow:1,padding:e.typography.pxToRem(10)},dataEntryActionsContainer:{padding:e.typography.pxToRem(10),paddingTop:e.typography.pxToRem(30)},button:{whiteSpace:"nowrap"},fieldLabelMediaBased:{[e.breakpoints.down(523)]:{paddingTop:"0px !important"}}})))(G1),$1=(0,gs.Ng)(((e,t)=>{var r,n,a,o;const i=e.viewEventPage.eventDetailsSection||{},s=null===(r=e.viewEventPage)||void 0===r||null===(n=r.loadedValues)||void 0===n||null===(a=n.eventContainer)||void 0===a||null===(o=a.event)||void 0===o?void 0:o.status,l=e.dataEntries[t.dataEntryId]&&e.dataEntries[t.dataEntryId].itemId,d=e.currentSelections.programId;return{ready:!e.activePage.isDataEntryLoading&&!i.loading,eventStatus:s,itemId:l,programId:d}}),(()=>({})))(Dp()(B1));function W1(){return W1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},W1.apply(this,arguments)}const H1=e=>{let{formFoundation:t,eventId:r,...n}=e;const a=(0,y.useMemo)((()=>{const e=t.getElements(),r=t.getLabels(),n=e.reduce(((e,t)=>{const{optionSet:r}=t,n={id:t.id,name:t.formName,type:t.type,optionSet:void 0,options:void 0};return r&&r.options&&(n.optionSet=r.id,n.options=r.options.map((e=>({code:e.value,name:e.text})))),e[t.id]=n,e}),{}),a=Object.keys(r).reduce(((e,t)=>(e[t]={id:t,name:r[t],type:it.CO.DATE},e)),{});return{...n,...a}}),[t]);return y.createElement(_Q,W1({},n,{eventId:r,dataItemDefinitions:a}))},z1=Object.freeze({ACTIVE:"ACTIVE",COMPLETED:"COMPLETED",VISITED:"VISITED",SCHEDULE:"SCHEDULE",OVERDUE:"OVERDUE",SKIPPED:"SKIPPED"}),Y1={header:{display:"flex",alignItems:"center",padding:yn.U.dp8},icon:{paddingRight:yn.U.dp8},form:{padding:yn.U.dp8},menu:{display:"flex",alignItems:"center",padding:yn.U.dp8,justifyContent:"space-between",background:vn.T.white,borderTopLeftRadius:3,borderTopRightRadius:3,borderStyle:"solid",borderColor:vn.T.grey400,borderWidth:1,borderBottomWidth:0},menuActions:{display:"flex",alignItems:"center",gap:yn.Q.dp4},button:{margin:yn.U.dp8},tooltip:{display:"inline-flex"}},q1=(0,I.withStyles)(Y1)((e=>{let{eventStatus:t,initialScheduleDate:r,stage:a,formFoundation:o,onGoBack:i,onCancelEditEvent:s,onHandleScheduleSave:d,onSaveExternal:c,programId:u,orgUnitId:p,enrollmentId:m,eventId:g,stageId:h,teiId:E,assignee:v,onSaveAndCompleteEnrollment:f,onSaveAndCompleteEnrollmentSuccessActionType:I,onSaveAndCompleteEnrollmentErrorActionType:b,classes:S}=e;(0,y.useEffect)((()=>Fg.clear),[]);const T=(0,gs.wA)(),A=(0,j.iT)(j.Gv.changelogs),{currentPageMode:C}=bs(t),{orgUnit:O,error:N}=ZN(p),[R,w]=(0,y.useState)(!1),[P,k]=(0,y.useState)(!1),D=(0,gs.d4)((e=>{let{viewEventPage:t}=e;return t.loadedValues})),U=(0,it.$j)(u,h),{hasAuthority:L}=UQ({authorities:["F_UNCOMPLETE_EVENT"]}),F=a.blockEntryForm&&!L&&t===z1.COMPLETED,x=!(null!==U&&void 0!==U&&U.write)||F,G=F?n.A.t("The event cannot be edited after it has been completed"):n.A.t("You don't have access to edit this event"),B=pd(a,E,m,u),{programCategory:$}=RS(u);if(N)return N.errorComponent;const{icon:W,name:H}=a;return O&&D?y.createElement("div",{"data-test":"widget-enrollment-event"},y.createElement("div",{className:S.menu},y.createElement(ra.$,{small:!0,secondary:!0,onClick:i},y.createElement(D0.A,null),n.A.t("Back to all stages and events")),C===V.VIEW&&y.createElement("div",{className:S.menuActions},y.createElement(aI,{content:G,enabled:x,wrapperClassName:S.tooltip},y.createElement(ra.$,{small:!0,secondary:!0,disabled:x,icon:y.createElement(U0.A,null),onClick:()=>T(((e,t)=>l(nW)({orgUnit:e,programCategory:t}))(O,$))},n.A.t("Edit event"))),A&&y.createElement(wI,{open:P,onClick:()=>k((e=>!e)),icon:y.createElement(DH.A,null),small:!0,secondary:!0,dataTest:"widget-event-edit-overflow-button",component:y.createElement(AI.n,{dense:!0,maxWidth:"250px"},y.createElement(bh.D,{label:n.A.t("View changelog"),dataTest:"event-overflow-view-changelog",onClick:()=>{w(!0),k(!1)}}))}))),y.createElement(Ib,{header:y.createElement("div",{className:S.header},W&&y.createElement("div",{className:S.icon},y.createElement(Tm,{name:null===W||void 0===W?void 0:W.name,color:null===W||void 0===W?void 0:W.color,width:30,height:30,cornerRadius:2})),y.createElement("span",null," ",H," ")),noncollapsible:!0},C===V.VIEW?y.createElement("div",{className:S.form,"data-test":"widget-enrollment-event-view"},y.createElement($1,{programId:u,formFoundation:o,dataEntryId:M.ENROLLMENT_EVENT,hideDueDate:a.hideDueDate})):y.createElement("div",{className:S.form,"data-test":"widget-enrollment-event-edit"},y.createElement(I1,{dataEntryId:M.ENROLLMENT_EVENT,formFoundation:o,orgUnit:O,programId:u,stageId:h,teiId:E,enrollmentId:m,eventId:g,eventStatus:t,onCancelEditEvent:s,hasDeleteButton:!0,onHandleScheduleSave:d,onSaveExternal:c,initialScheduleDate:r,allowGenerateNextVisit:a.allowGenerateNextVisit,askCompleteEnrollmentOnEventComplete:a.askCompleteEnrollmentOnEventComplete,availableProgramStages:B,hideDueDate:a.hideDueDate,assignee:v,onSaveAndCompleteEnrollmentExternal:f,onSaveAndCompleteEnrollmentErrorActionType:b,onSaveAndCompleteEnrollmentSuccessActionType:I}))),A&&R&&y.createElement(H1,{isOpen:!0,setIsOpen:w,eventId:D.eventContainer.id,formFoundation:o})):y.createElement(_,null)}));function K1(){return K1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},K1.apply(this,arguments)}const Q1="RequestAddNoteForEvent",X1="StartAddNoteForEvent",J1="NoteAddedForEvent",Z1="AddNoteFailedForEvent",e2="AddNoteBatchForEvent",t2="RemoveNoteBatchForEvent",r2=(e,t,r,n)=>l(X1)({selections:r,context:n},{offline:{effect:{url:`events/${e}/note`,method:oc,data:t},commit:{type:J1,meta:{selections:r,context:n}},rollback:{type:Z1,meta:{selections:r,context:n}}}});var n2=r(78882),a2=r(48161);const o2=(0,I.withStyles)((()=>({wrapper:{display:"flex",alignItems:"center",fontSize:14},editButton:{marginLeft:yn.Q.dp12},assignButton:{marginLeft:yn.Q.dp12},avatarWrapper:{display:"flex",alignItems:"center"},avatar:{margin:yn.Q.dp4}})))((e=>{let{assignee:t,onEdit:r,writeAccess:a,avatarId:o,classes:i}=e;return t?y.createElement("div",{className:i.wrapper},y.createElement("div",{className:i.avatarWrapper},n.A.t("Assigned to"),y.createElement(a2.H,{name:t.name,className:i.avatar,avatarId:o,small:!0}),t.name),y.createElement(aI,{content:n.A.t("You don't have access to edit the assigned user"),enabled:!a},y.createElement(ra.$,{onClick:r,className:i.editButton,dataTest:"widget-assignee-edit",disabled:!a,secondary:!0,small:!0},n.A.t("Edit")))):y.createElement("div",{className:i.wrapper},n.A.t("No one is assigned to this event"),y.createElement(aI,{content:n.A.t("You don't have access to assign a user to this event"),enabled:!a},y.createElement(ra.$,{onClick:r,className:i.assignButton,dataTest:"widget-assignee-assign",small:!0,secondary:!0,disabled:!a},n.A.t("Assign"))))})),i2=(0,I.withStyles)((()=>({container:{display:"flex",alignItems:"center"},searchContainer:{flexGrow:1,flexShrink:1,paddingRight:5},buttonContainer:{marginTop:yn.Q.dp8}})))((e=>{const{onCancel:t,onSet:r,assignee:a,classes:o}=e,[i,s]=(0,y.useState)(a);return y.createElement("div",{className:o.container},y.createElement("div",{className:o.searchContainer},y.createElement(Uh,{inputPlaceholderText:n.A.t("Search for user"),value:i,inputWrapperClasses:{},focusInputOnMount:!0,exitBehaviour:"doNothing",onSet:e=>{s(e)}}),y.createElement(Nf.v,{className:o.buttonContainer},y.createElement(ra.$,{onClick:()=>r(i),small:!0,primary:!0,dataTest:"widget-assignee-save"},n.A.t("Save")),y.createElement(ra.$,{onClick:t,small:!0,secondary:!0},n.A.t("Cancel")))))})),s2=(0,I.withStyles)((()=>({header:{display:"flex",alignItems:"center"},wrapper:{padding:`0 ${yn.Q.dp16} ${yn.Q.dp16} ${yn.Q.dp16}`}})))((e=>{let{assignee:t,writeAccess:r,onSet:a,avatarId:o,classes:i}=e;const[s,l]=(0,y.useState)(!0),[d,c]=(0,y.useState)(!1),u=(0,y.useCallback)((e=>{c(!1),a(e)}),[a]);return y.createElement("div",{"data-test":"widget-assignee"},y.createElement(Ib,{header:y.createElement("span",{className:i.header},y.createElement(n2.A,null)," ",y.createElement("span",null,n.A.t("Assignee"))),onOpen:(0,y.useCallback)((()=>l(!0)),[l]),onClose:(0,y.useCallback)((()=>l(!1)),[l]),open:s},y.createElement("div",{className:i.wrapper},d?y.createElement(i2,{onCancel:()=>c(!1),onSet:u,assignee:t}):y.createElement(o2,{assignee:t,onEdit:()=>c(!0),writeAccess:r,avatarId:o}))))})),l2=e=>e?{uid:e.id,displayName:e.name,username:e.username,firstName:e.firstName,surname:e.surname}:null,d2=e=>{const{assignee:t,writeAccess:r,getSaveContext:n,onSave:a,onSaveError:o}=e,i=(0,y.useRef)(t),{avatarId:s,isLoading:l}=(e=>{var t;const r=["users",...e?[e]:[]],n={resource:"users",id:e,params:{fields:"avatar"}},a={enabled:Boolean(e)},{data:o,isLoading:i}=ni(r,n,a);return{avatarId:null===o||void 0===o||null===(t=o.avatar)||void 0===t?void 0:t.id,isLoading:i}})(null===t||void 0===t?void 0:t.id),[d]=(0,A.r8)({resource:"tracker?async=false&importStrategy=UPDATE",type:"create",data:e=>({events:[e]})},{onError:()=>{o(i.current)}}),c=(0,y.useCallback)((async e=>{const{event:r}=n();i.current=t,a(e),await d({...r,assignedUser:l2(e)})}),[d,n,a,t]);return l?null:y.createElement(s2,{assignee:t,writeAccess:r,avatarId:s,onSet:c})},c2=e=>e.enabled?y.createElement(d2,e):null,u2=(0,j.Fs)(Et,Ci),p2="TOP",m2="BOTTOM",g2={ACTIVE:n.A.t("Active"),COMPLETED:n.A.t("Completed"),CANCELLED:n.A.t("Cancelled"),SCHEDULE:n.A.t("Scheduled")},h2={occurredAt:{apiKey:"occurredAt",type:it.CO.DATE,placement:p2},scheduledAt:{apiKey:"scheduledAt",type:it.CO.DATE,placement:p2},orgUnit:{apiKey:"orgUnit",type:it.CO.ORGANISATION_UNIT,placement:p2,label:n.A.t("Organisation unit"),convertFn:e=>y.createElement(gi,{orgUnitId:e})},status:{apiKey:"status",type:it.CO.TEXT,placement:m2,label:n.A.t("Status"),convertFn:e=>g2[e]}},E2={container:{padding:`${yn.Q.dp8} ${yn.Q.dp16}`,display:"flex",flexDirection:"column",gap:yn.Q.dp8}},y2=(0,fp.default)(E2)((e=>{let{linkedEvent:t,dataValues:r,formFoundation:n,classes:a}=e;const o=(0,y.useMemo)((()=>((e,t)=>{const r=Object.values(h2).map((r=>{var n;const a=e[r.apiKey];if(!a)return null;const o=r.convertFn?r.convertFn(a):u2(a,r.type);return{key:null!==(n=r.label)&&void 0!==n?n:t.getLabel(r.apiKey),value:o,reactKey:r.apiKey,placement:r.placement}}));return r.reduce(((e,t)=>t?(e[t.placement].push(t),e):e),{[p2]:[],[m2]:[]})})(t,n)),[t,n]),i=(0,y.useMemo)((()=>n.getElements().map((e=>{const t=r[e.id];return{key:e.formName,value:null!==t&&void 0!==t?t:"",reactKey:e.id}})).filter(Boolean)),[r,n]);return y.createElement("div",{className:a.container},y.createElement(Yo,{list:[...o[p2],...i,...o[m2]]}))})),v2={[it.CO.FILE_RESOURCE]:async e=>{let{dataElement:t,querySingleResource:r,eventId:n,absoluteApiPath:a}=e;const{value:o}=t;if(!o)return null;const{id:i,displayName:s}=await r({resource:`fileResources/${o}`});return{id:i,name:s,url:(0,j.UR)(j.Gv.trackerFileEndpoint)?`${a}/tracker/events/${n}/dataValues/${t.id}/file`:`${a}/events/files?dataElementUid=${t.id}&eventUid=${n}`}},[it.CO.IMAGE]:async e=>{let{dataElement:t,querySingleResource:r,eventId:n,absoluteApiPath:a}=e;const{id:o,value:i}=t;if(!i)return null;const{id:s,displayName:l}=await r({resource:`fileResources/${i}`});return{id:s,name:l,...(0,j.UR)(j.Gv.trackerImageEndpoint)?{url:`${a}/tracker/events/${n}/dataValues/${o}/image`,previewUrl:`${a}/tracker/events/${n}/dataValues/${o}/image?dimension=small`}:{url:`${a}/events/files?dataElementUid=${o}&eventUid=${n}`,previewUrl:`${a}/events/files?dataElementUid=${o}&eventUid=${n}`}}},[it.CO.ORGANISATION_UNIT]:async e=>{let{dataElement:{value:t},querySingleResource:r}=e;return(await pi([t],r))[t]}},f2=(0,j.Fs)(Et,Ci),I2=e=>{let{linkedEventId:t,dataValues:r,formFoundation:n}=e;const a=(0,A.ow)(),{baseUrl:o,apiVersion:i}=(0,A.UK)(),s=D(a.query.bind(a)),{data:l,isError:d,isLoading:c}=(0,Zo.useQuery)(["formattedDataValues",t,r],(()=>(async(e,t,r,n,a)=>{const o=t.getElements(),i=e.map((async e=>{const t=o.find((t=>{let{id:r}=t;return r===e.dataElement}));if(!t)return null;let i=e.value;return v2[t.type]&&(i=await v2[t.type]({dataElement:{id:t.id,value:e.value},querySingleResource:r,eventId:n,absoluteApiPath:a})),{id:t.id,value:f2(i,t.type,t)}}));return(await Promise.all(i)).reduce(((e,t)=>(t&&(e[t.id]=t.value),e)),{})})(r,n,s,t,(0,j.c$)(o,`api/${i}`))),{enabled:!!r&&!!n&&!!t&&!!o&&!!i&&!!s});return{clientValuesWithSubValues:l,isError:d,isLoading:c}},b2={menu:{display:"flex",alignItems:"center",padding:yn.U.dp8,justifyContent:"end",background:vn.T.white,borderTopLeftRadius:3,borderTopRightRadius:3,borderStyle:"solid",borderColor:vn.T.grey400,borderWidth:1,borderBottomWidth:0},header:{display:"flex",alignItems:"center",padding:yn.U.dp8},icon:{marginRight:yn.U.dp8}},S2=(0,I.withStyles)(b2)((e=>{var t,r;let{eventId:a,programId:o,orgUnitId:i,currentPage:s,classes:l}=e;const[d,c]=(0,y.useState)(!1),{push:u}=(0,T.W6)(),{linkedEvent:p,dataValues:m,isError:g,isLoading:h}=(e=>{let{originEventId:t}=e;const r=(0,y.useMemo)((()=>({resource:"tracker/events",id:t,params:{fields:"event,relationships[relationshipType,relationshipName,bidirectional,from[event[event,dataValues,occurredAt,scheduledAt,status,orgUnit,programStage,program]],to[event[event,dataValues,*,occurredAt,scheduledAt,status,orgUnit,programStage,program]]]"}})),[t]),{data:n,isLoading:a,isError:o,error:i}=ai(["linkedEventByOriginEvent",t],r,{enabled:!!t,cacheTime:0,staleTime:4e3}),{linkedEvent:s,relationshipType:l,dataValues:d}=(0,y.useMemo)((()=>{if(!n)return{};const e=(e=>{if(!e||!e.relationships||0===e.relationships.length)return null;const t=e.relationships.filter((e=>{let{to:t,from:r}=e;return t.event&&r.event?t.event.program===r.event.program:null}));if(1!==t.length)return null;const r=t[0],n=r.from.event.event===e.event;if(n&&!r.bidirectional)return null;const a=n?r.to.event:r.from.event;return{relationshipType:r.relationshipType,linkedEvent:a}})(n);return e?{linkedEvent:e.linkedEvent,relationshipType:e.relationshipType,dataValues:e.linkedEvent.dataValues}:{}}),[n]),{data:c,isLoading:u,isError:p}=ai(["linkedEventDataValuesFallback",null===s||void 0===s?void 0:s.event],{resource:"tracker/events",id:null===s||void 0===s?void 0:s.event,params:{fields:"event,dataValues,occurredAt,scheduledAt,status,orgUnit,programStage,program"}},{enabled:!(null===s||void 0===s||!s.event)&&!d});return{linkedEvent:d?s:c,relationshipType:l,dataValues:d||(null===c||void 0===c?void 0:c.dataValues),isLoading:a||u,isError:o||p,error:i}})({originEventId:a}),{formFoundation:E,stage:v,isLoading:f,isError:I}=JR({programId:o,stageId:null===p||void 0===p?void 0:p.programStage}),{clientValuesWithSubValues:b,isLoading:S,isError:A}=I2({linkedEventId:null===p||void 0===p?void 0:p.event,dataValues:m,formFoundation:E});return h||f||S?null:g||I||A?y.createElement("div",null,n.A.t("An error occurred while loading the widget.")):p&&E&&v?y.createElement("div",null,s===M2.VIEW_EVENT&&y.createElement("div",{className:l.menu},y.createElement(wI,{open:d,onClick:()=>c((e=>!e)),icon:y.createElement(DH.A,null),small:!0,secondary:!0,dataTest:"widget-event-navigate-to-linked-event",component:y.createElement(AI.n,{dense:!0,maxWidth:"250px"},y.createElement(bh.D,{label:n.A.t("View linked event"),dataTest:"event-overflow-view-linked-event",onClick:()=>{u(`/enrollmentEventEdit?${Is({eventId:p.event,orgUnitId:i})}`),c(!1)}}))})),y.createElement(Ib,{header:y.createElement("div",{className:l.header},v.icon&&y.createElement("div",{className:l.icon},y.createElement(Tm,{name:null===(t=v.icon)||void 0===t?void 0:t.name,color:null===(r=v.icon)||void 0===r?void 0:r.color,width:30,height:30,cornerRadius:2})),y.createElement("span",null," ",v.name," ")),noncollapsible:!0},y.createElement(y2,{linkedEvent:p,formFoundation:E,dataValues:b}))):null})),T2={Component:Dq,getProps:e=>{let{stages:t,events:r,ruleEffects:n}=e;return{stages:t,events:r,ruleEffects:n}}},A2={Component:e=>{let{className:t,stages:r,events:a,...o}=e;const[i,s]=(0,y.useState)(!0);return y.createElement("div",{"data-test":"stages-and-events-widget",className:t},y.createElement(Ib,{header:n.A.t("Stages and Events"),onOpen:(0,y.useCallback)((()=>s(!0)),[s]),onClose:(0,y.useCallback)((()=>s(!1)),[s]),open:i},y.createElement(zH,YH({stages:r,ready:void 0!==a&&void 0!==r,events:a},o))))},getProps:e=>{let{program:t,stages:r,events:n,onViewAll:a,onCreateNew:o,onDeleteEvent:i,onUpdateEventStatus:s,onRollbackDeleteEvent:l,onEventClick:d,ruleEffects:c}=e;return{programId:t.id,stages:r,events:n,onViewAll:a,onCreateNew:o,onDeleteEvent:i,onUpdateEventStatus:s,onRollbackDeleteEvent:l,onEventClick:d,ruleEffects:c}}},C2={Component:e=>{let{trackedEntityTypeId:t,teiId:r,programId:a,orgUnitId:o,addRelationshipRenderElement:i,onOpenAddRelationship:s,onCloseAddRelationship:d,onLinkedRecordClick:c}=e;const u=(0,gs.wA)(),{relationshipTypes:p,isError:m}=(()=>{const{data:e,isError:t}=ri(["cachedRelationshipTypes"],rz);return{relationshipTypes:e,isError:t}})(),{orgUnit:g}=ZN(o),h=g?{id:o,name:g.name,path:g.path}:null;return m?y.createElement("div",null,n.A.t("Could not retrieve metadata. Please try again later.")):null!==p&&void 0!==p&&p.length&&i?y.createElement(y.Fragment,null,y.createElement($z,{programId:a,trackedEntityTypeId:t,teiId:r,orgUnitId:o,onLinkedRecordClick:c,addRelationshipRenderElement:i,onOpenAddRelationship:s,onCloseAddRelationship:d,onSelectFindMode:e=>{let{findMode:t,relationshipConstraint:r}=e;u((e=>{let{findMode:t,orgUnit:r,relationshipConstraint:n}=e;return l(qH)({findMode:t,orgUnit:r,relationshipConstraint:n})})({findMode:t,orgUnit:h,relationshipConstraint:r}))},relationshipTypes:p,renderTrackedEntityRegistration:(e,t,n,a,o)=>y.createElement(WC.Provider,{value:{resultsPageSize:5}},y.createElement(vq,{suggestedProgramId:t,onLink:a,onSave:n,teiId:r,onGetUnsavedAttributeValues:()=>console.log("get unsaved"),trackedEntityTypeId:e,onCancel:o})),renderTrackedEntitySearch:(e,t,r)=>y.createElement(UY,{resultsPageSize:5,id:"relationshipTeiSearchWidget",selectedTrackedEntityTypeId:e,getResultsView:e=>y.createElement(ak,Cq({onAddRelationship:r},e))})})):null},shouldHideWidget:e=>{let{addRelationShipContainerElement:t}=e;return!t},getProps:e=>{let{program:t,orgUnitId:r,addRelationShipContainerElement:n,toggleVisibility:a,teiId:o,onLinkedRecordClick:i}=e;return{trackedEntityTypeId:t.trackedEntityType.id,programId:t.id,orgUnitId:r,addRelationshipRenderElement:n,onOpenAddRelationship:a,onCloseAddRelationship:a,teiId:o,onLinkedRecordClick:i}}},O2={Component:Wb,getProps:e=>{let{widgetEffects:t}=e;return{error:null===t||void 0===t?void 0:t.errors}}},N2={Component:Fb,getProps:e=>{let{widgetEffects:t}=e;return{warning:null===t||void 0===t?void 0:t.warnings}}},R2={Component:Tb,shouldHideWidget:e=>{let{hideWidgets:t}=e;return null===t||void 0===t?void 0:t.feedback},getProps:e=>{let{widgetEffects:t,feedbackEmptyText:r}=e;return{feedback:null===t||void 0===t?void 0:t.feedbacks,emptyText:r}}},w2={Component:Jb,shouldHideWidget:e=>{let{hideWidgets:t}=e;return null===t||void 0===t?void 0:t.indicator},getProps:e=>{let{widgetEffects:t,indicatorEmptyText:r}=e;return{indicators:null===t||void 0===t?void 0:t.indicators,emptyText:r}}},_2={Component:()=>{const e=(0,gs.wA)(),{enrollmentId:t}=vs(),r=(0,gs.d4)((e=>{var t,r;let{enrollmentDomain:n}=e;return null!==(t=null===n||void 0===n||null===(r=n.enrollment)||void 0===r?void 0:r.notes)&&void 0!==t?t:[]}));return y.createElement("div",{"data-test":"enrollment-note-widget"},y.createElement(Yq,{title:n.A.t("Notes about this enrollment"),placeholder:n.A.t("Write a note about this enrollment"),emptyNoteMessage:n.A.t("This enrollment doesn't have any notes"),notes:r,onAddNote:r=>{e(((e,t)=>l(Uq)({enrollmentId:e,note:t}))(t,r))}}))},getProps:()=>{}},P2={Component:WQ,getCustomSettings:e=>{let{readOnlyMode:t=!0}=e;return{readOnlyMode:t}},getProps:e=>{let{teiId:t,program:r,orgUnitId:n,onUpdateTeiAttributeValues:a,onDeleteTrackedEntitySuccess:o}=e;return{teiId:t,programId:r.id,orgUnitId:n,onUpdateTeiAttributeValues:a,onDeleteSuccess:o}}},k2={Component:e=>{let{stageId:t,programId:r,orgUnitId:n,teiId:a,enrollmentId:o,...i}=e;return t?y.createElement(P0,k0({programId:r,stageId:t,orgUnitId:n,teiId:a,enrollmentId:o},i)):y.createElement(aJ,{programId:r,orgUnitId:n,teiId:a,enrollmentId:o})},getProps:e=>{let{program:t,stageId:r,orgUnitId:n,teiId:a,enrollmentId:o,dataEntryHasChanges:i,widgetReducerName:s,rulesExecutionDependencies:l,onSave:d,onCancel:c}=e;return{programId:t.id,stageId:r,orgUnitId:n,teiId:a,enrollmentId:o,dataEntryHasChanges:i,widgetReducerName:s,rulesExecutionDependencies:l,onSave:d,onCancel:c}}},D2={Component:e=>{let{externalData:t,teiId:r,enrollmentId:n,programId:a,readOnlyMode:o=!1,onDelete:i,onAddNew:s,onUpdateEnrollmentDate:l,onUpdateIncidentDate:d,onError:c,onSuccess:u,onUpdateEnrollmentStatus:p,onUpdateEnrollmentStatusError:m,onUpdateEnrollmentStatusSuccess:g,onAccessLostFromTransfer:h}=e;const{enrollment:E,updateEnrollmentDate:v,updateIncidentDate:f,error:I,refetch:b}=(e=>{let{enrollmentId:t,onUpdateEnrollmentDate:r,onUpdateIncidentDate:n,onError:a,externalData:o}=e;const[i,s]=(0,y.useState)(),{error:l,loading:d,data:c,refetch:u}=(0,A.iO)((0,y.useMemo)((()=>({enrollment:{resource:"tracker/enrollments/",id:e=>{let{variables:{enrollmentId:t}}=e;return t},params:{fields:"enrollment,trackedEntity,program,status,orgUnit,enrolledAt,occurredAt,followUp,deleted,createdBy,updatedBy,updatedAt,geometry"}}})),[]),{lazy:!0});(0,y.useEffect)((()=>{t&&u({variables:{enrollmentId:t}})}),[u,t]),(0,y.useEffect)((()=>{c&&s(c.enrollment)}),[s,c]),(0,y.useEffect)((()=>{var e;null!==o&&void 0!==o&&null!==(e=o.status)&&void 0!==e&&e.value&&s((e=>{var t;return{...e,status:null===o||void 0===o||null===(t=o.status)||void 0===t?void 0:t.value}}))}),[s,null===o||void 0===o?void 0:o.status]);const p=eJ({enrollment:i,setEnrollment:s,propertyName:"enrolledAt",updateHandler:r,onError:a}),m=eJ({enrollment:i,setEnrollment:s,propertyName:"occurredAt",updateHandler:n,onError:a});return{error:l,refetch:u,enrollment:d?null:i,updateEnrollmentDate:p,updateIncidentDate:m}})({enrollmentId:n,onUpdateEnrollmentDate:l,onUpdateIncidentDate:d,onError:c,externalData:t}),{error:T,program:C}=uX(a),{error:O,ownerOrgUnit:N,enrollments:R,refetch:w}=((e,t)=>{var r,n,a;const{error:o,loading:i,data:s,refetch:l}=(0,A.iO)((0,y.useMemo)((()=>({trackedEntityInstances:{resource:`tracker/trackedEntities/${e}`,params:{fields:["programOwners[orgUnit],enrollments"],program:[t]}}})),[e,t]));return{error:o,refetch:l,ownerOrgUnit:!i&&(null===s||void 0===s||null===(r=s.trackedEntityInstances)||void 0===r||null===(n=r.programOwners[0])||void 0===n?void 0:n.orgUnit),enrollments:!i&&null!==s&&void 0!==s&&s.trackedEntityInstances?null===s||void 0===s||null===(a=s.trackedEntityInstances)||void 0===a?void 0:a.enrollments:[]}})(r,a),{error:_,displayName:P}=mi("string"===typeof N?N:void 0),{error:k,locale:D}=us(),U=((e,t,r)=>(0,y.useMemo)((()=>{var n;return(null===r||void 0===r||null===(n=r.data)||void 0===n?void 0:n.write)&&e.filter((e=>e.program===t)).every((e=>e.status!==YQ.ACTIVE))}),[e,t,r]))(R,a,null===C||void 0===C?void 0:C.trackedEntityType.access),L=(e=>(0,y.useMemo)((()=>e&&e.programStages.some((e=>{let{autoGenerateEvent:t}=e;return t}))),[e]))(C),F=((e,t,r,n,a)=>(0,y.useMemo)((()=>e||t||r||n||a),[e,t,r,n,a]))(I,T,O,_,k),x=(e=>(0,y.useMemo)((()=>e.events||[]),[e]))(t);return F&&S().error((0,j.px)("Enrollment widget could not be loaded")({error:F})),y.createElement(JX,{enrollment:E,events:x,canAddNew:U,editDateEnabled:!o&&C&&C.access.data.write,displayAutoGeneratedEventWarning:L,program:C,refetchEnrollment:b,refetchTEI:w,ownerOrgUnit:{id:N,displayName:P},locale:D,loading:!(E&&C&&P&&D),onDelete:i,onAddNew:s,updateEnrollmentDate:v,updateIncidentDate:f,initError:F,onError:c,onSuccess:u,onUpdateEnrollmentStatus:p,onUpdateEnrollmentStatusSuccess:g,onUpdateEnrollmentStatusError:m,onAccessLostFromTransfer:h})},shouldHideWidget:e=>{let{enrollmentId:t}=e;return"AUTO"===t},getCustomSettings:e=>{let{readOnlyMode:t}=e;return{readOnlyMode:t}},getProps:e=>{let{teiId:t,enrollmentId:r,program:n,events:a,widgetEnrollmentStatus:o,onDelete:i,onAddNew:s,onUpdateEnrollmentDate:l,onUpdateIncidentDate:d,onUpdateEnrollmentStatus:c,onUpdateEnrollmentStatusSuccess:u,onUpdateEnrollmentStatusError:p,onEnrollmentError:m,onAccessLostFromTransfer:g}=e;return{teiId:t,enrollmentId:r,programId:n.id,onDelete:i,onAddNew:s,onUpdateEnrollmentDate:l,onUpdateIncidentDate:d,onUpdateEnrollmentStatus:c,onUpdateEnrollmentStatusSuccess:u,onUpdateEnrollmentStatusError:p,externalData:{status:o,events:a},onError:m,onAccessLostFromTransfer:g}}},U2={Component:e=>{let{pageStatus:t,...r}=e;const{programId:a,stageId:o}=r,{formFoundation:i,stage:s,isLoading:l,isError:d}=JR({programId:a,stageId:o});return t===pW?y.createElement(OO,null,n.A.t("Choose an organisation unit to start reporting")):t===uW?y.createElement("span",null,n.A.t("The enrollment event data could not be found")):l?y.createElement("div",null,n.A.t("Loading")):i&&s&&!d?y.createElement(q1,K1({},r,{stage:s,formFoundation:i,programId:a,stageId:o})):y.createElement("div",null,n.A.t("An error occurred while loading the form"))},getProps:e=>{let{onGoBack:t,program:r,orgUnitId:n,teiId:a,enrollmentId:o,eventId:i,stageId:s,eventStatus:l,onCancelEditEvent:d,onHandleScheduleSave:c,onSaveExternal:u,initialScheduleDate:p,assignee:m,onSaveAndCompleteEnrollment:g,onSaveAndCompleteEnrollmentErrorActionType:h,onSaveAndCompleteEnrollmentSuccessActionType:E}=e;return{onGoBack:t,programId:r.id,stageId:s,orgUnitId:n,teiId:a,enrollmentId:o,eventId:i,eventStatus:l,onCancelEditEvent:d,onHandleScheduleSave:c,onSaveExternal:u,initialScheduleDate:p,assignee:m,onSaveAndCompleteEnrollment:g,onSaveAndCompleteEnrollmentErrorActionType:h,onSaveAndCompleteEnrollmentSuccessActionType:E}}},L2={Component:S2,getProps:e=>{let{currentPage:t,eventId:r,program:n,stageId:a,orgUnitId:o}=e;return{currentPage:t,eventId:r,programId:n.id,orgUnitId:o,stageId:a}}},F2={Component:c2,getProps:e=>{let{programStage:t,assignee:r,getAssignedUserSaveContext:n,eventAccess:a,onSaveAssignee:o,onSaveAssigneeError:i}=e;return{enabled:(null===t||void 0===t?void 0:t.enableUserAssignment)||!1,assignee:r,getSaveContext:n,writeAccess:(null===a||void 0===a?void 0:a.write)||!1,onSave:o,onSaveError:i}}},x2={Component:e=>{let{dataEntryKey:t,dataEntryId:r}=e;const a=(0,gs.wA)(),o=(0,gs.d4)((e=>{var n;let{dataEntriesNotes:a}=e;return null!==(n=a[`${r}-${t}`])&&void 0!==n?n:[]}));return y.createElement("div",{"data-test":"event-note-widget"},y.createElement(Yq,{title:n.A.t("Notes about this event"),placeholder:n.A.t("Write a note about this event"),emptyNoteMessage:n.A.t("This event doesn't have any notes"),notes:o,onAddNote:e=>{a(((e,t,r)=>l(Q1)({itemId:e,dataEntryId:t,note:r}))(t,r,e))}}))},getProps:e=>{let{dataEntryKey:t,dataEntryId:r}=e;return{dataEntryKey:t,dataEntryId:r}}},M2=Object.freeze({OVERVIEW:"overview",NEW_EVENT:"newEvent",EDIT_EVENT:"editEvent",VIEW_EVENT:"viewEvent"}),V2={TrackedEntityRelationship:C2,ErrorWidget:O2,WarningWidget:N2,FeedbackWidget:R2,IndicatorWidget:w2,ProfileWidget:P2,EnrollmentWidget:D2},j2=Object.freeze({COMPONENT:"component",PLUGIN:"plugin"}),G2=Object.freeze({ENROLLMENT_OVERVIEW:"enrollmentOverviewLayout",ENROLLMENT_EVENT_NEW:"enrollmentEventNewLayout",ENROLLMENT_EVENT_EDIT:"enrollmentEventEditLayout"});function B2(){return B2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},B2.apply(this,arguments)}const $2=e=>{let{pluginSource:t,...r}=e;const[n,a]=(0,y.useState)(void 0),o=(0,T.W6)(),i=(0,y.useRef)();return(0,y.useEffect)((()=>{const{current:e}=i;if(!e)return()=>{};const t=new ResizeObserver((e=>{e.forEach((e=>a(e.contentRect.width)))}));return t.observe(e),()=>{t.unobserve(e),t.disconnect()}}),[i]),y.createElement("div",{ref:i},y.createElement(ly.k,B2({pluginSource:t,width:n,navigate:o.push},r)))};function W2(){return W2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},W2.apply(this,arguments)}const H2={},z2={},Y2=(e,t,r)=>{const{type:n}=e;return n.toLowerCase()===j2.COMPONENT?((e,t,r)=>{const{name:n,settings:a={}}=e,o=t[n];if(!o)return z2[n]||(S().error((0,j.px)(`Widget ${n} is not supported`)({name:n})),z2[n]=!0),null;const{getProps:i,shouldHideWidget:s,getCustomSettings:l}=o;if(s&&s(r))return null;let d={};try{d=i(r)}catch(p){return S().error((0,j.px)(`Error while getting widget props for widget ${n}`)({error:p,props:r})),null}const c=l&&l(a);let u=H2[n];return u||(u=o.Component,H2[n]=y.memo(u)),y.createElement(u,W2({},d,c,{key:n}))})(e,t,r):n.toLowerCase()===j2.PLUGIN?((e,t,r)=>{const{source:n}=e;let a=H2[n];a||(a=$2,H2[n]=a);const o=(e=>{let{program:t,enrollmentId:r,teiId:n,orgUnitId:a,programStage:o,eventId:i,stageId:s}=e;return{programId:t.id,enrollmentId:r,teiId:n,orgUnitId:a,programStageId:null!==s&&void 0!==s?s:null===o||void 0===o?void 0:o.id,eventId:i}})(r);return y.createElement(a,W2({key:n,pluginSource:n},o))})(e,0,r):(S().error((0,j.px)(`Widget type ${n} is not supported`)({type:n})),null)},q2=e=>{let{setRelationshipRef:t}=e;const r=(0,y.useRef)(void 0);return(0,y.useEffect)((()=>{r.current&&t(r.current)}),[t]),y.createElement("div",{ref:r})};var K2=r(16287);const Q2={active:n.A.t("Active enrollments"),complete:n.A.t("Completed enrollments"),cancelled:n.A.t("Cancelled enrollments")},X2={button:{background:"none",border:"none",cursor:"pointer",font:"inherit",fontSize:"14px",padding:"6px 4px",color:vn.T.grey800,borderRadius:"3px","&:hover":{textDecoration:"underline",color:"black"},"&.selected":{color:"black"}}},J2=(0,I.withStyles)(X2)((e=>{let{label:t,onClick:r,selected:n,classes:a}=e;return y.createElement("button",{type:"button",className:er()(a.button,{selected:n}),onClick:r},t)}));function Z2(){return Z2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Z2.apply(this,arguments)}const e5={ACTIVE:"ACTIVE",COMPLETED:"COMPLETED",SKIPPED:"SKIPPED",SCHEDULE:"SCHEDULE",OVERDUE:"OVERDUE"},t5=Object.freeze({MAIN_PAGE:"mainPage",...M2}),r5=e=>[e5.SCHEDULE,e5.OVERDUE,e5.SKIPPED].includes(e),n5=(0,I.withStyles)({container:{display:"flex",alignItems:"center"}})((e=>{let{onBackToMainPage:t,onBackToDashboard:r,onBackToViewEvent:a,eventStatus:o,programId:i,trackedEntityName:s,displayFrontPageList:l,userInteractionInProgress:d=!1,page:c,classes:u}=e;const[p,m]=(0,y.useState)(null),{label:g}=(e=>{let{programId:t,trackedEntityName:r,displayFrontPageList:a}=e;const o=(0,gs.d4)((e=>{let{workingListsTemplates:t}=e;return null===t||void 0===t?void 0:t.teiList})),i=(0,gs.d4)((e=>{var t;let{workingListsContext:r}=e;return null===r||void 0===r||null===(t=r.teiList)||void 0===t?void 0:t.programIdView})),{selectedTemplateId:s,loading:l,templates:d}=null!==o&&void 0!==o?o:{},c=null===d||void 0===d?void 0:d.find((e=>{let{id:t}=e;return t===s})),u=i===t;return{label:(0,y.useMemo)((()=>{if(l)return"...";if(u){if(c&&!c.isDefault)return c.name;if(s&&!c)return Q2[s];if("default"===c.name)return n.A.t("{{trackedEntityName}} list",{trackedEntityName:r})}return a?r?n.A.t("{{trackedEntityName}} list",{trackedEntityName:r}):n.A.t("Working List"):n.A.t("Search")}),[a,l,u,c,s,r])}})({trackedEntityName:s,programId:i,displayFrontPageList:l}),h=(0,y.useCallback)(((e,t)=>{d?m(t):e&&e()}),[d]),E=(0,y.useMemo)((()=>[{key:t5.MAIN_PAGE,onClick:()=>h(t,t5.MAIN_PAGE),label:g,selected:!1,condition:!0},{key:t5.OVERVIEW,onClick:()=>h(r,t5.OVERVIEW),label:n.A.t("Enrollment dashboard"),selected:c===t5.OVERVIEW,condition:!0},{key:t5.VIEW_EVENT,onClick:()=>h(a,t5.VIEW_EVENT),label:n.A.t("View event"),selected:c===t5.VIEW_EVENT,condition:c===t5.VIEW_EVENT||c===t5.EDIT_EVENT&&!r5(o)},{key:t5.EDIT_EVENT,onClick:()=>{},label:n.A.t("Edit event"),selected:c===t5.EDIT_EVENT,condition:c===t5.EDIT_EVENT},{key:t5.NEW_EVENT,onClick:()=>{},label:n.A.t("New event"),selected:c===t5.NEW_EVENT,condition:c===t5.NEW_EVENT}].filter((e=>e.condition))),[g,c,o,h,t,r,a]);return y.createElement("div",{className:u.container},E.map(((e,t)=>y.createElement(y.Fragment,{key:e.key},y.createElement(J2,{label:e.label,onClick:e.onClick,selected:e.selected}),t<E.length-1&&y.createElement(K2.A,{color:vn.T.grey800})))),y.createElement(Rf,Z2({open:p===t5.MAIN_PAGE,onDestroy:()=>{m(null),t&&t()},onCancel:()=>m(null)},wf)),y.createElement(Rf,Z2({open:p===t5.OVERVIEW,onDestroy:()=>{m(null),r&&r()},onCancel:()=>m(null)},wf)),y.createElement(Rf,Z2({open:p===t5.VIEW_EVENT,onDestroy:()=>{m(null),a&&a()},onCancel:()=>m(null)},wf)))})),a5=(0,I.withStyles)((()=>({container:{minHeight:"90vh",padding:"16px 24px 16px 24px"},contentContainer:{position:"relative",display:"flex",flexDirection:"column",gap:yn.Q.dp12},columns:{display:"flex",gap:yn.Q.dp16},leftColumn:{flexGrow:3,flexShrink:1,width:872,display:"flex",flexDirection:"column",gap:yn.Q.dp16},rightColumn:{flexGrow:1,flexShrink:1,width:360,display:"flex",flexDirection:"column",gap:yn.Q.dp16},title:{fontSize:"1.25rem",color:vn.T.grey900,fontWeight:500,paddingTop:yn.U.dp8}})))((e=>{let{pageLayout:t,availableWidgets:r,program:n,trackedEntityName:a,userInteractionInProgress:o,eventStatus:i,currentPage:s,onBackToMainPage:l,onBackToDashboard:d,onBackToViewEvent:c,classes:u,...p}=e;const[m,g]=(0,y.useState)(!0),[h,E]=(0,y.useState)(void 0),v=(0,y.useCallback)((()=>g((e=>!e))),[]),f=(0,y.useMemo)((()=>({...p,program:n,currentPage:s,eventStatus:i,toggleVisibility:v,addRelationShipContainerElement:h})),[h,s,i,p,n,v]),{leftColumnWidgets:I,rightColumnWidgets:b}=(e=>{let{pageLayout:t,availableWidgets:r,props:n}=e;const{leftColumn:a,rightColumn:o}=t,i=(0,y.useCallback)((e=>null===e||void 0===e?void 0:e.map((e=>Y2(e,r,n))).filter(Boolean)),[r,n]);return{leftColumnWidgets:(0,y.useMemo)((()=>i(a)),[a,i]),rightColumnWidgets:(0,y.useMemo)((()=>i(o)),[o,i])}})({pageLayout:t,availableWidgets:r,props:f}),S=(0,y.useMemo)((()=>{var e;if(t.backgroundColor&&(e=t.backgroundColor,/^#[0-9A-F]{6}$/i.test(e)))return{backgroundColor:t.backgroundColor}}),[t.backgroundColor]);return y.createElement("div",{className:u.container,style:S,"data-test":`enrollment-${s}-page`},y.createElement(q2,{setRelationshipRef:E}),y.createElement("div",{className:u.contentContainer,style:m?void 0:{display:"none"}},y.createElement("div",null,y.createElement(n5,{page:s,onBackToMainPage:l,onBackToDashboard:d,onBackToViewEvent:c,programId:n.id,trackedEntityName:a,displayFrontPageList:n.displayFrontPageList,userInteractionInProgress:o,eventStatus:i})),y.createElement("div",{className:u.columns},t.leftColumn&&!(null===I||void 0===I||!I.length)&&y.createElement("div",{className:u.leftColumn},I),t.rightColumn&&!(null===b||void 0===b||!b.length)&&y.createElement("div",{className:u.rightColumn},b))))})),o5=Object.freeze({EditEventWorkspace:U2,TwoEventWorkspace:L2,EventNote:x2,AssigneeWidget:F2,...V2}),i5={leftColumn:[{type:j2.COMPONENT,name:"TwoEventWorkspace"},{type:j2.COMPONENT,name:"EditEventWorkspace"}],rightColumn:[{type:j2.COMPONENT,name:"AssigneeWidget"},{type:j2.COMPONENT,name:"ErrorWidget"},{type:j2.COMPONENT,name:"WarningWidget"},{type:j2.COMPONENT,name:"EventNote"},{type:j2.COMPONENT,name:"FeedbackWidget"},{type:j2.COMPONENT,name:"IndicatorWidget"},{type:j2.COMPONENT,name:"TrackedEntityRelationship"},{type:j2.COMPONENT,name:"ProfileWidget",settings:{readOnlyMode:!0}},{type:j2.COMPONENT,name:"EnrollmentWidget",settings:{readOnlyMode:!0}}]},s5="EnrollmentDomain.AssigneeSet",l5="EnrollmentDomain.AssigneeSaveFailed",d5="EditEnrollmentEventPage.EventSaveAndEnrollmentCompleteSuccess",c5="EditEnrollmentEventPage.EventSaveAndEnrollmentCompleteError",u5=e=>{let{pageLayout:t,mode:r,programStage:a,teiId:o,enrollmentId:i,eventId:s,stageId:l,trackedEntityTypeId:d,program:c,enrollmentsAsOptions:u,trackedEntityName:p,teiDisplayName:m,widgetEffects:g,hideWidgets:h,onDelete:E,onAddNew:v,onGoBack:f,onLinkedRecordClick:I,orgUnitId:b,eventDate:S,scheduleDate:T,eventStatus:A,eventAccess:C,assignee:O,pageStatus:N,events:R,onBackToDashboard:w,onBackToMainPage:_,onBackToViewEvent:P,onEnrollmentError:k,onEnrollmentSuccess:D,onUpdateEnrollmentStatus:U,onUpdateEnrollmentStatusError:L,onUpdateEnrollmentStatusSuccess:F,onSaveAndCompleteEnrollment:x,onCancelEditEvent:V,onHandleScheduleSave:j,onSaveExternal:G,getAssignedUserSaveContext:B,onSaveAssignee:$,onSaveAssigneeError:W,onDeleteTrackedEntitySuccess:H,onAccessLostFromTransfer:z}=e;return y.createElement(vW,{orgUnitId:b},y.createElement(oH,{mode:r,programStage:a,enrollmentId:i,programId:null===c||void 0===c?void 0:c.id,enrollmentsAsOptions:u,trackedEntityName:p,teiDisplayName:m,orgUnitId:b,eventDate:S,teiId:o,pageStatus:N}),y.createElement(a5,{pageLayout:t,currentPage:r===M2.EDIT_EVENT?M2.EDIT_EVENT:M2.VIEW_EVENT,availableWidgets:o5,userInteractionInProgress:r===M2.EDIT_EVENT,trackedEntityName:p,onBackToMainPage:_,onBackToDashboard:w,onBackToViewEvent:P,onSaveExternal:G,trackedEntityTypeId:d,programStage:a,onGoBack:f,program:c,orgUnitId:b,teiId:o,enrollmentId:i,eventId:s,stageId:l,eventStatus:A,initialScheduleDate:T,onCancelEditEvent:V,onHandleScheduleSave:j,dataEntryKey:r,dataEntryId:M.ENROLLMENT_EVENT,onLinkedRecordClick:I,onEnrollmentError:k,onEnrollmentSuccess:D,onUpdateEnrollmentStatus:U,onUpdateEnrollmentStatusError:L,onUpdateEnrollmentStatusSuccess:F,onSaveAndCompleteEnrollment:x,onSaveAndCompleteEnrollmentSuccessActionType:d5,onSaveAndCompleteEnrollmentErrorActionType:c5,events:R,pageStatus:N,widgetEffects:g,hideWidgets:h,onDelete:E,onAddNew:v,eventAccess:C,assignee:O,getAssignedUserSaveContext:B,onSaveAssignee:$,onSaveAssigneeError:W,onDeleteTrackedEntitySuccess:H,onAccessLostFromTransfer:z,feedbackEmptyText:n.A.t("No feedback for this event yet"),indicatorEmptyText:n.A.t("No indicator output for this event yet")}),y.createElement(iH,{formId:`${M.ENROLLMENT_EVENT}-${r}`}))},p5=e=>(0,gs.d4)((t=>{var r,n,a,o,i,s;let{rulesEffectsFeedback:l,rulesEffectsIndicators:d,rulesEffectsGeneralWarnings:c,rulesEffectsGeneralErrors:u}=t;return{feedbacks:[...(null===(r=l[e])||void 0===r?void 0:r.displayTexts)||[],...(null===(n=l[e])||void 0===n?void 0:n.displayKeyValuePairs)||[]],indicators:[...(null===(a=d[e])||void 0===a?void 0:a.displayTexts)||[],...(null===(o=d[e])||void 0===o?void 0:o.displayKeyValuePairs)||[]],warnings:null===(i=c[e])||void 0===i?void 0:i.warning,errors:null===(s=u[e])||void 0===s?void 0:s.error}}),gs.bN),m5="useProgramMetadata",g5=e=>{const{program:t,isLoading:r,isError:n}=Ji(e,{enabled:!!e}),a=(0,y.useMemo)((()=>t?t.programStages.reduce(((e,t)=>t.programStageDataElements.reduce(((e,t)=>(e.add(t.dataElementId),e)),e)),new Set):void 0),[t]),{isLoading:o,dataElements:i,isError:s}=((e,t,r)=>{const n=ve(),{enabled:a=!!t}=null!==r&&void 0!==r?r:{},{data:o,isLoading:i,isError:s}=ri(["dataElements",...e],(()=>n.getAll(z.DATA_ELEMENTS,{predicate:e=>t.has(e.id)})),{enabled:a});return{dataElements:o,isLoading:i,isError:s}})([m5,e],a),l=(0,y.useMemo)((()=>i?{optionSetIds:i.reduce(((e,t)=>(t.optionSetValue&&e.add(t.optionSet.id),e)),new Set),dataElementDictionary:i.reduce(((e,t)=>(e[t.id]=t,e)),{})}:void 0),[i]),{isLoading:d,optionSets:c,isError:u}=((e,t,r)=>{const n=ve(),{enabled:a=!!t}=null!==r&&void 0!==r?r:{},{data:o,isLoading:i,isError:s}=ri(["optionSets",...e],(()=>n.getAll(z.OPTION_SETS,{predicate:e=>t.has(e.id)})),{enabled:a});return{optionSets:o,isLoading:i,isError:s}})([m5,e],l&&l.optionSetIds),p=(0,y.useMemo)((()=>c?c.reduce(((e,t)=>(e[t.id]={options:t.options.map((e=>({name:e.displayName,code:e.code})))},e)),{}):void 0),[c]),m=(0,y.useMemo)((()=>{if(!t||!l||!p)return;const e=l.dataElementDictionary;return{programStages:t.programStages.map((t=>({id:t.id,dataAccess:{read:t.access.data.read,write:t.access.data.write},repeatable:t.repeatable,hideDueDate:t.hideDueDate,enableUserAssignment:t.enableUserAssignment,programStageDataElements:t.programStageDataElements.map((t=>{const r=e[t.dataElementId];return{displayInReports:t.displayInReports,dataElement:{id:r.id,valueType:r.valueType,displayName:r.displayName,displayFormName:r.displayFormName,optionSet:r.optionSetValue?p[r.optionSet.id]:{}}}}))})))}}),[t,l,p]);return{error:(n||s||u)&&{programId:e},programMetadata:r||o||d?void 0:m}},h5=e=>(0,y.useMemo)((()=>{const t=e.map((e=>e.programRuleActions.map((e=>e.location||null)))).flat(),r={};return r.feedback=!t.includes("feedback"),r.indicator=!t.includes("indicators"),r}),[e]),E5={PAGE_OPEN:"EnrollmentPage.Open",PAGE_CLOSE:"EnrollmentPage.Close",PROCESS_ENROLLMENT_ID:"EnrollmentPage.EnrollmentUrlIdUpdated",RESET_ENROLLMENT_ID:"EnrollmentPage.ResetEnrollmentId",FETCH_ENROLLMENT_ID:"EnrollmentPage.FetchEnrollmentId",VERIFY_ENROLLMENT_ID_SUCCESS:"EnrollmentPage.VerifyEnrollmentIdSuccess",FETCH_ENROLLMENT_ID_SUCCESS:"EnrollmentPage.FetchEnrollmentIdSuccess",FETCH_ENROLLMENT_ID_ERROR:"EnrollmentPage.FetchEnrollmentIdError",PROCESS_TEI_ID:"EnrollmentPage.TeiUrlIdUpdated",RESET_TEI_ID:"EnrollmentPage.ResetTeiId",FETCH_TEI:"EnrollmentPage.FetchTei",VERIFY_FETCH_TEI_SUCCESS:"EnrollmentPage.VerifyFetchTeiSuccess",FETCH_TEI_SUCCESS:"EnrollmentPage.FetchTeiSuccess",FETCH_TEI_ERROR:"EnrollmentPage.FetchTeiError",PROCESS_PROGRAM_ID:"EnrollmentPage.ProgramUrlIdUpdated",COMMIT_TRACKER_PROGRAM_ID:"EnrollmentPage.CommitTrackerProgramId",COMMIT_NON_TRACKER_PROGRAM_ID:"EnrollmentPage.CommitNonTrackerProgramId",PROGRAM_ID_ERROR:"EnrollmentPage.ProgramIdError",FETCH_ENROLLMENTS:"EnrollmentPage.FetchEnrollments",VERIFY_FETCHED_ENROLLMENTS:"EnrollmentPage.VerifyFetchedEnrollments",FETCH_ENROLLMENTS_ERROR:"EnrollmentPage.FetchEnrollmentsError",FETCH_ENROLLMENTS_SUCCESS:"EnrollmentPage.FetchEnrollmentsSuccess",DEFAULT_VIEW:"EnrollmentPage.DefaultView",LOADING_VIEW:"EnrollmentPage.LoadingView",MISSING_MESSAGE_VIEW:"EnrollmentPage.MissingMessageView",ERROR_VIEW:"EnrollmentPage.ErrorView",CLEAR_ERROR_VIEW:"EnrollmentPage.ClearErrorView",DELETE_ENROLLMENT:"EnrollmentPage.DeleteEnrollment",UPDATE_TEI_DISPLAY_NAME:"EnrollmentPage.UpdateTeiDisplayName",UPDATE_ENROLLMENT_DATE:"EnrollmentPage.UpdateEnrollmentDate"},y5=()=>l(E5.FETCH_ENROLLMENTS)(),v5=e=>{let{accessLevel:t}=e;return l(E5.FETCH_ENROLLMENTS_ERROR)({accessLevel:t})},f5=e=>{let{error:t}=e;return l(E5.ERROR_VIEW)({error:t})},I5=e=>{let{enrollmentId:t}=e;return l(E5.DELETE_ENROLLMENT)({enrollmentId:t})};var b5=r(10234);const S5={program:"",programStage:"",enrollment:"",trackedEntity:""},T5={event:{resource:"tracker/events",id:e=>{let{variables:{id:t}}=e;return t},params:{fields:["program","programStage","enrollment","trackedEntity","event"]}}},A5={enrollment:{resource:"tracker/enrollments",id:e=>{let{variables:{enrollment:t}}=e;return t},params:{fields:["trackedEntity"]}}},C5=()=>{const e=(0,T.W6)(),{orgUnitId:t}=vs();return{onLinkedRecordClick:(0,y.useCallback)((r=>{let n;if(r.eventId){const{eventId:e,programId:a}=r;n=(0,it.Ec)(a)instanceof it.jV?`/viewEvent?viewEventId=${e}`:`/enrollmentEventEdit?${Is({orgUnitId:t,eventId:e})}`}else if(r.trackedEntityId){const{trackedEntityId:e,programId:a}=r;n=`/enrollment?${Is({programId:a,orgUnitId:t,teiId:e,enrollmentId:"AUTO"})}`}n&&e.push(n)}),[e,t])}};var O5=r(10947);const N5=(0,fg.Mz)((e=>e.currentSelections.programId),(e=>e.currentSelections.trackedEntityTypeId),(e=>e.currentSelections.orgUnitId),(e=>e.editEventPage.eventId),(e=>e.viewEventPage.eventId),((e,t,r,n,a)=>({programId:e,trackedEntityTypeId:t,orgUnitId:r,eventId:n,viewEventId:a}))),R5=()=>{const e=window.location.href.split("#")[1];try{return e.split("?")[0]}catch{return e}},w5=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k5;return Object.values(t).includes(e)};function _5(){return _5=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_5.apply(this,arguments)}function P5(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const k5={MAIN:"",VIEW_EVENT:"viewEvent",SEARCH:"search",NEW:"new",ENROLLMENT_EVENT_NEW:"enrollmentEventNew",ENROLLMENT_EVENT:"enrollmentEventEdit"},D5={urlParameterName:"programId"},U5={urlParameterName:"orgUnitId"},L5={[k5.MAIN]:[D5,U5],[k5.VIEW_EVENT]:[{urlParameterName:"viewEventId"}],[k5.SEARCH]:[D5,U5],[k5.NEW]:[D5,U5,{urlParameterName:"trackedEntityTypeId"}]},F5={[k5.MAIN]:hD,[k5.SEARCH]:hD,[k5.NEW]:hD,[k5.VIEW_EVENT]:EU,[k5.ENROLLMENT_EVENT_NEW]:hD,[k5.ENROLLMENT_EVENT]:EU},x5=e=>{let{selectedScopeId:t,defaultPageLayout:r,dataStoreKey:n}=e;const{data:a,isLoading:o,isError:i}=ni(["customEnrollmentPageLayout"],{resource:"dataStore/capture?fields=."},{enabled:!!t,select:e=>{var a;const{entries:o}=null!==e&&void 0!==e?e:{},i=null===o||void 0===o||null===(a=o.find((e=>{let{key:t}=e;return t===n})))||void 0===a?void 0:a.value,s=null===i||void 0===i?void 0:i[t];if(!s)return r;const{leftColumn:l,rightColumn:d}=s;if(!l&&!d)throw new Error("Invalid enrollment page layout configuration");return s}});return{pageLayout:a,isLoading:o,isError:i}},M5=()=>{var e;const t=(0,T.W6)(),r=(0,gs.wA)(),n=(0,gs.d4)((e=>{let{viewEventPage:t}=e;return t.eventId})),a=(0,gs.d4)((e=>{var t;let{activePage:r}=e;return null===(t=r.viewEventLoadError)||void 0===t?void 0:t.error})),{loading:o,event:i}=(e=>{var t;const[r,n]=(0,y.useState)(S5),{data:a,error:o,refetch:i}=(0,A.iO)(T5),{data:s,refetch:l}=(0,A.iO)(A5);return(0,y.useEffect)((()=>{e&&(n(S5),i({variables:{id:e}}))}),[e,i]),(0,y.useEffect)((()=>{(null===a||void 0===a?void 0:a.event)&&n(a.event)}),[null===a||void 0===a?void 0:a.event]),(0,y.useEffect)((()=>{r.enrollment&&void 0===r.trackedEntity&&l({variables:{enrollment:r.enrollment}})}),[r.enrollment,r.trackedEntity,l]),(0,y.useEffect)((()=>{var e;null!==s&&void 0!==s&&null!==(e=s.enrollment)&&void 0!==e&&e.trackedEntity&&n((e=>{var t;return{...e,trackedEntity:null===s||void 0===s||null===(t=s.enrollment)||void 0===t?void 0:t.trackedEntity}}))}),[null===s||void 0===s||null===(t=s.enrollment)||void 0===t?void 0:t.trackedEntity]),{error:o,loading:!e||e!==r.event||!r.trackedEntity,event:r}})(n),{program:s,programStage:d,trackedEntity:c,enrollment:u}=i,{orgUnitId:p,eventId:m,initMode:g}=vs(),h=Us(c,u,s).enrollment,E=null===h||void 0===h||null===(e=h.events)||void 0===e?void 0:e.find((e=>e.event===n));return(0,y.useEffect)((()=>{m?n!==m&&r(((e,t)=>l(ZD)({eventId:e,page:t}))(m,k5.ENROLLMENT_EVENT)):t.push(`/?${Is({orgUnitId:p})}`)}),[r,t,n,m,p]),(!o&&n===m||a)&&E?y.createElement(V5,{programId:s,stageId:d,teiId:c,enrollmentId:u,orgUnitId:p,error:a,initMode:g,enrollmentSite:h,event:E}):y.createElement(O,null)},V5=qm()((e=>{var t,r;let{programId:n,stageId:a,teiId:o,enrollmentId:i,orgUnitId:s,initMode:d,enrollmentSite:c,event:u}=e;const p=(0,T.W6)(),m=(0,gs.wA)(),g=(0,Zo.useQueryClient)(),{pageLayout:h,isLoading:E}=x5({selectedScopeId:n,dataStoreKey:G2.ENROLLMENT_EVENT_EDIT,defaultPageLayout:i5}),{event:v}=u,{onLinkedRecordClick:f}=C5();(0,y.useEffect)((()=>()=>{m(cv(M.ENROLLMENT_EVENT))}),[m]);const{program:I}=dW(n),b=[...null!==(t=null===I||void 0===I||null===(r=I.stages)||void 0===r?void 0:r.values())&&void 0!==t?t:[]].find((e=>e.id===a)),S=h5(null===I||void 0===I?void 0:I.programRules.concat(null===b||void 0===b?void 0:b.programRules)),A=(0,y.useCallback)((()=>{p.push(`/?${Is({orgUnitId:s,programId:n})}`)}),[p,s,n]),C=(0,y.useCallback)((()=>{p.push(`/?${Is({orgUnitId:s,programId:n})}`)}),[p,s,n]),N=(0,y.useCallback)((e=>{m(ws(e))}),[m]),R=(0,y.useCallback)((e=>{m(_s()),m(Rs({message:e}))}),[m]),w=(0,y.useCallback)((e=>{let{redirect:t}=e;m(Ps()),t&&p.push(`enrollment?${Is({programId:n,orgUnitId:s,teiId:o,enrollmentId:i})}`)}),[m,p,n,s,o,i]),_=(0,y.useCallback)((e=>{m(ks(Mk.COMPLETED)),m(ws(e)),p.push(`enrollment?${Is({programId:n,orgUnitId:s,teiId:o,enrollmentId:i})}`)}),[m,p,n,s,o,i]),P=(0,y.useCallback)((e=>{e&&p.push(`/enrollment?${Is({enrollmentId:i})}`),d&&p.push(`/enrollmentEventEdit?${Is({eventId:v,orgUnitId:s})}`)}),[d,i,v,s,p]),k=()=>p.push(`/enrollment?${Is({enrollmentId:i})}`),{teiDisplayName:D}=lW(o,n),{name:U,id:L}=null===I||void 0===I?void 0:I.trackedEntityType,F=eH([c||{}],n),x=(e=>{const t=Oi((null===e||void 0===e?void 0:e.occurredAt)||(null===e||void 0===e?void 0:e.scheduledAt));return t?t.toString():""})(u),V=(e=>{if(null===e||void 0===e||!e.scheduledAt)return;const t=Ci(null===e||void 0===e?void 0:e.scheduledAt,b5.CO.DATETIME);return null===t||void 0===t?void 0:t.toString()})(u),{currentPageMode:j}=bs(null===u||void 0===u?void 0:u.status),G=`${M.ENROLLMENT_EVENT}-${j}`,B=p5(G),$=(0,it.$j)(n,null===b||void 0===b?void 0:b.id),W=(e=>{let{orgUnitId:t,enrollmentSite:r,teiDisplayName:n,trackedEntityName:a,programStage:o,isLoading:i,event:s}=e;return i?mW:t?r&&n&&a&&o&&s?cW:uW:pW})({orgUnitId:s,enrollmentSite:c,teiDisplayName:D,trackedEntityName:U,programStage:b,event:u,isLoading:E}),H=(e=>(0,y.useMemo)((()=>Et(null===e||void 0===e?void 0:e.assignedUser,it.CO.ASSIGNEE)),[null===e||void 0===e?void 0:e.assignedUser]))(u),z=(e=>(0,y.useCallback)((()=>({event:e})),[e]))(u);return W===mW?y.createElement(O,null):y.createElement(u5,{pageLayout:h,mode:j,pageStatus:W,programStage:b,onGoBack:k,onBackToMainPage:C,onBackToDashboard:k,onBackToViewEvent:()=>{m($$()),m(sv(M.ENROLLMENT_EVENT,k5.VIEW_EVENT))},widgetEffects:B,hideWidgets:S,teiId:o,enrollmentId:i,eventId:v,stageId:a,trackedEntityTypeId:L,enrollmentsAsOptions:F,teiDisplayName:D,trackedEntityName:U,program:I,onDelete:()=>{p.push(`/enrollment?${Is({orgUnitId:s,programId:n,teiId:o})}`),m(I5({enrollmentId:i}))},onDeleteTrackedEntitySuccess:A,onAddNew:()=>{p.push(`/new?${Is({programId:n,orgUnitId:s,teiId:o})}`)},orgUnitId:s,eventDate:x,assignee:H,onLinkedRecordClick:f,onEnrollmentError:e=>m(Rs({message:e})),onEnrollmentSuccess:()=>m(y5()),onUpdateEnrollmentStatus:N,onUpdateEnrollmentStatusSuccess:w,onUpdateEnrollmentStatusError:R,onSaveAndCompleteEnrollment:_,eventStatus:null===u||void 0===u?void 0:u.status,eventAccess:$,scheduleDate:V,onCancelEditEvent:P,onHandleScheduleSave:e=>{m(Ts(v,e)),p.push(`enrollment?${Is({enrollmentId:i})}`)},onSaveExternal:()=>{const e=[ei,"changelog",gQ.EVENT,v];g.removeQueries(e),p.push(`enrollment?${Is({enrollmentId:i})}`)},getAssignedUserSaveContext:z,onSaveAssignee:e=>{const t=_i(e,b5.CO.ASSIGNEE);m(((e,t,r)=>l(s5)({assignedUser:e,assignee:t,eventId:r}))(t,e,v))},onSaveAssigneeError:e=>{const t=e?_i(e,b5.CO.ASSIGNEE):void 0;m(((e,t,r)=>l(l5)({assignedUser:e,assignee:t,eventId:r}))(t,e,v))},events:null===c||void 0===c?void 0:c.events,onAccessLostFromTransfer:()=>{p.push(`/?${Is({orgUnitId:s,programId:n})}`)}})})),j5=(e,t)=>{const{assignee:r,eventId:n}=t.payload;if(n!==e.eventId)return e;return{...e,saveInProgress:!0,loadedValues:{...e.loadedValues,eventContainer:{...e.loadedValues.eventContainer,event:{...e.loadedValues.eventContainer.event,assignee:r}}}}},G5=rc({[ZD]:(e,t)=>({eventDetailsSection:{},notesSection:{isLoading:!0},relationshipsSection:{isLoading:!0},assigneeSection:{isLoading:!0},eventId:t.payload.eventId}),[A$]:(e,t)=>{const r={...e};return r.eventDetailsSection={...r.eventDetailsSection},r.loadedValues=t.payload.loadedValues,r.assigneeSection={isLoading:!1,assignee:t.payload.assignee},r},[C$]:(e,t)=>{const r={...e};return r.dataEntryIsLoading=!1,r.dataEntryLoadError=t.payload,r},[nG]:(e,t)=>{let{payload:{eventId:r}}=t;return{eventDetailsSection:{},notesSection:{isLoading:!0},relationshipsSection:{isLoading:!0},assigneeSection:{isLoading:!0},eventId:r}},[cU]:e=>({...e,showAddRelationship:!0}),[a$]:e=>({...e,relationshipsSection:{...e.relationshipsSection,isLoading:!1}}),[i$]:e=>({...e,showAddRelationship:!1}),[o$]:e=>{const t={...e};return t.showAddRelationship=!1,t},[Q$]:e=>({...e,notesSection:{...e.notesSection,isLoading:!1}}),[tW]:(e,t)=>({...e,notesSection:{...e.notesSection,fieldValue:t.payload.value}}),[b$]:e=>({...e,eventDetailsSection:{...e.eventDetailsSection}}),[nW]:e=>({...e,eventDetailsSection:{...e.eventDetailsSection}}),[S$]:e=>({...e,eventDetailsSection:{...e.eventDetailsSection,showEditEvent:!0}}),[w$]:e=>({...e,eventDetailsSection:{...e.eventDetailsSection,showEditEvent:!1}}),[_$]:e=>({...e,saveInProgress:!0}),[D$]:(e,t)=>t.meta.eventId!==e.eventId?e:{...e,saveInProgress:!1},[k$]:(e,t)=>t.meta.eventId!==e.eventId?e:{...e,saveInProgress:!1,eventHasChanged:!0},[gU]:j5,[hU]:j5,[s5]:j5,[l5]:j5},"viewEventPage"),B5=rc({[__]:()=>({}),[P_]:(e,t)=>({...e,selectedRelationshipType:t.payload.selectedRelationshipType,findMode:null}),[D_]:(e,t)=>({...e,findMode:t.payload.findMode,searching:!1}),[U_]:e=>({...e,searching:!0}),[L_]:e=>({...e,searching:!1})},"newRelationship",{}),$5=rc({[x_]:(e,t)=>{const{programId:r,orgUnit:n}=t.payload;return{...e,programId:r,orgUnit:n}},[M_]:(e,t)=>({...e,error:t.payload.errorMessage}),[Nw]:(e,t)=>{const{programId:r}=t.payload;return{...e,programId:r}},[Rw]:(e,t)=>{const{orgUnit:r,resetProgramSelection:n}=t.payload;return{...e,orgUnit:r,programId:n?null:e.programId}},[_w]:e=>({...e,orgUnit:null}),[$_]:e=>({...e,dataEntryError:null}),[H_]:(e,t)=>({...e,dataEntryError:t.payload.errorMessage}),[W_]:e=>({...e,dataEntryError:null}),[fq]:(e,t)=>{const{programId:r,orgUnit:n}=t.payload;return{...e,programId:r,orgUnit:n}},[Iq]:(e,t)=>({...e,error:t.payload.errorMessage}),[JY]:(e,t)=>{const{programId:r}=t.payload;return{...e,programId:r}},[ZY]:(e,t)=>{const{orgUnit:r,resetProgramSelection:n}=t.payload;return{...e,orgUnit:r,programId:n?null:e.programId}},[tq]:e=>({...e,orgUnit:null}),[Sq]:e=>({...e,dataEntryError:null}),[Aq]:(e,t)=>({...e,dataEntryError:t.payload.errorMessage}),[Tq]:e=>({...e,dataEntryError:null})},"newRelationshipRegisterTei"),W5=rc({[QN]:(e,t)=>({...e,[t.payload.id]:t.payload})},"organisationUnits"),H5=rc({[p]:(e,t)=>({...e,searchRoots:{roots:t.payload.roots}}),[u]:(e,t)=>({...e,captureRoots:{roots:t.payload.roots}})},"organisationUnitRoots2222"),z5="NetworkStatusChange",Y5=rc({[z5]:(e,t)=>{const r={...e};return t.payload.status?r.offlineSince=0:r.offlineSince=Date.now(),r}},"networkStatus",{}),q5=rc({[nD]:(e,t)=>{const r={...e},n=t.payload.event;return r[n.eventId]=n,r},[iD]:(e,t)=>{if(t.payload.listId===YR){return{}}return e}},"recentlyAddedEvents",{}),K5=rc({[nD]:(e,t)=>{const r={...e};return r[t.payload.event.eventId]=t.payload.eventValues,r},[iD]:(e,t)=>{if(t.payload.listId===YR){return{}}return e}},"recentlyAddedEventsValues",{}),Q5=rc({[DP]:(e,t)=>({...e,[t.payload.searchId]:{selectedOrgUnitScope:"ACCESSIBLE",openSearchGroupSection:"0",selectedProgramId:t.payload.programId,selectedTrackedEntityTypeId:t.payload.trackedEntityTypeId}}),[UP]:(e,t)=>({...e,[t.payload.searchId]:{...e[t.payload.searchId],searchResults:{formId:t.payload.formId,searchGroupId:t.payload.searchGroupId,resultsLoading:!0}}}),[xP]:(e,t)=>{const r=t.payload.data,n=t.payload.searchId,a=r.trackedEntityInstanceContainers?r.trackedEntityInstanceContainers:[];return{...e,[n]:{...e[n],searchResults:{...e[n].searchResults,resultsLoading:!1,teis:a,currentPage:r.currentPage}}}},[FP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],searchResults:{...e[r].searchResults,resultsLoading:!1,teis:[],currentPage:null}}}},[fY]:(e,t)=>({...e,[t.payload.searchId]:{selectedOrgUnitScope:"ACCESSIBLE",openSearchGroupSection:"0",selectedProgramId:t.payload.programId,selectedTrackedEntityTypeId:t.payload.trackedEntityTypeId}}),[IY]:(e,t)=>({...e,[t.payload.searchId]:{...e[t.payload.searchId],searchResults:{formId:t.payload.formId,searchGroupId:t.payload.searchGroupId,resultsLoading:!0}}}),[TY]:(e,t)=>{const r=t.payload.data,n=t.payload.searchId,a=r.trackedEntityInstanceContainers?r.trackedEntityInstanceContainers:[];return{...e,[n]:{...e[n],searchResults:{...e[n].searchResults,resultsLoading:!1,teis:a,currentPage:r.currentPage}}}},[SY]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],searchResults:{...e[r].searchResults,resultsLoading:!1,teis:[],currentPage:null}}}},[Z_]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],orgUnitsLoading:!0,orgUnitsSearchText:t.payload.searchText}}},[eP]:(e,t)=>{const r=t.payload.searchId;return Bm(r,null),{...e,[r]:{...e[r],orgUnitsLoading:!1,orgUnitsSearchText:null,orgUnitsRoots:null}}},[tP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],orgUnitsLoading:!1,orgUnitsSearchText:t.payload.searchText,orgUnitsRoots:t.payload.roots}}},[rP]:(e,t)=>{const r=t.payload.searchId;return Bm(r,null),{...e,[r]:{...e[r],orgUnitsLoading:!1,orgUnitsSearchText:null,orgUnitsRoots:null}}},[nP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],selectedOrgUnitScope:t.payload.orgUnitScope}}},[aP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],selectedOrgUnit:t.payload.orgUnit}}},[MP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],selectedProgramId:t.payload.programId,selectedTrackedEntityTypeId:t.payload.trackedEntityTypeId,openSearchGroupSection:"0"}}},[LP]:(e,t)=>{const r=t.payload.searchId,n=t.payload.formId;return{...e,[r]:{...e[r],[n]:{...e[r]?e[r][n]:{},validationFailed:!0}}}},[VP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],searchResults:null}}},[jP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],searchResults:null}}},[GP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],searchResults:{...e[r].searchResults,resultsLoading:!0}}}},[BP]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],openSearchGroupSection:t.payload.searchGroupId}}},[AY]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],selectedProgramId:t.payload.programId,selectedTrackedEntityTypeId:t.payload.trackedEntityTypeId,openSearchGroupSection:"0"}}},[bY]:(e,t)=>{const r=t.payload.searchId,n=t.payload.formId;return{...e,[r]:{...e[r],[n]:{...e[r]?e[r][n]:{},validationFailed:!0}}}},[CY]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],searchResults:null}}},[OY]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],searchResults:null}}},[NY]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],searchResults:{...e[r].searchResults,resultsLoading:!0}}}},[RY]:(e,t)=>{const r=t.payload.searchId;return{...e,[r]:{...e[r],openSearchGroupSection:t.payload.searchGroupId}}}},"teiSearch",{}),X5="SetNotes",J5="AddTTNote",Z5="RemoveNote",e4=(e,t)=>l(X5)({key:e,notes:t}),t4=(e,t)=>l(J5)({key:e,note:t}),r4=rc({[X5]:(e,t)=>({...e,[t.payload.key]:t.payload.notes}),[J5]:(e,t)=>{const r=t.payload.key,n=t.payload.note;return{...e,[r]:[...e[r],n]}},[Z5]:(e,t)=>{const r=t.payload.key,n=t.payload.noteClientId;return{...e,[r]:e[r].filter((e=>e.clientId!==n))}}},"notes"),n4="SetRelationships",a4="AddRelationship",o4="UpdateRelationship",i4="RemoveRelationship",s4=(e,t)=>l(n4)({key:e,relationships:t}),l4=(e,t)=>l(a4)({key:e,relationship:t}),d4=(e,t)=>l(i4)({key:e,relationshipClientId:t}),c4=rc({[n4]:(e,t)=>({...e,[t.payload.key]:t.payload.relationships}),[a4]:(e,t)=>{const r=t.payload.key,n=t.payload.relationship;return{...e,[r]:[...e[r],n]}},[o4]:(e,t)=>{const r=t.payload.key,n=t.payload.updatedRelationship,a=e[r].findIndex((e=>e.clientId===n.clientId)),o=[...e[r]];return o[a]=n,{...e,[r]:o}},[i4]:(e,t)=>{const r=t.payload.key,n=t.payload.relationshipClientId;return{...e,[r]:e[r].filter((e=>e.clientId!==n))}}},"relationships"),u4=rc({[TA]:(e,t)=>{const{dataEntryId:r,generatedUniqueValues:n}=t.payload;return{...e,[r]:{...e[r],...n}}},[MA]:(e,t)=>{const{dataEntryId:r,generatedUniqueValues:n}=t.payload;return{...e,[r]:{...e[r],...n}}},[Jy]:(e,t)=>{const{newToEntity:r}=t.payload;return r?{...e,[r.dataEntryId]:void 0}:e},[i$]:(e,t)=>{const{entity:r}=t.payload;return r.id?e:{...e,[r.dataEntryId]:void 0}}},"generatedUniqueValuesCache"),p4="GoingOnlineExecutedBatch",m4="GoingOnlineExecuted",g4="GetEventListOnReconnect",h4="SearchPage.NavigateToMainPage",E4="SearchPage.SearchPageOpen",y4=(v4={[g]:e=>({...e,initDone:!1,page:""}),[h]:e=>{const t={...e};return t.initDone=!0,t},[E]:(e,t)=>{const{error:r}=t.payload;return{...e,initDone:!0,error:r}}},rc({...v4,[HD]:(e,t)=>({...e,page:t.payload.page}),[ZD]:(e,t)=>({...e,page:t.payload.page}),[yv]:e=>{const t={...e};return t.page=null,t.locationSwitchInProgress=!0,t},[fv]:e=>{const t={...e};return t.page=null,t.locationSwitchInProgress=!0,t},[dU]:e=>{const t={...e};return t.page=null,t.locationSwitchInProgress=!0,t},[E5.PAGE_OPEN]:e=>{const t={...e};return t.page="enrollment",t},[nG]:e=>({...e,page:"viewEvent",locationSwitchInProgress:!0}),[sf]:e=>({...e,page:null,locationSwitchInProgress:!0}),[lf]:e=>({...e,page:null,locationSwitchInProgress:!0}),"@@router/LOCATION_CHANGE":e=>{const t={...e};return t.locationSwitchInProgress=!1,t},[cf]:e=>{const t={...e};return t.locationSwitchInProgress=!1,t},"Offline/STATUS_CHANGED":(e,t)=>t.payload.online?{...e,goingOnlineInProgress:!0}:e,[m4]:e=>({...e,goingOnlineInProgress:!1}),[gD.FROM_URL_UPDATE]:(e,t)=>({...e,page:t.payload.nextPage}),[vD.NEW_PAGE_OPEN]:e=>({...e,locationSwitchInProgress:!1,page:"new"}),[h4]:e=>({...e,page:null,locationSwitchInProgress:!0}),[E4]:e=>({...e,locationSwitchInProgress:!1,page:"search"}),[IW]:(e,t)=>({...e,previousOrgUnitId:t.payload.previousOrgUnitId}),[m]:(e,t)=>({...e,roots:t.payload.roots})},"app"));var v4;const f4="MainPage.CategoryOptionSet",I4="MainPage.CategoryOptionReset",b4="MainPage.AllCategoryOptionsReset",S4="ViewEventPage.CategoryOptionSet",T4="ViewEventPage.CategoryOptionReset",A4="ViewEventPage.AllCategoryOptionsReset",C4=(e,t)=>Object.keys(t).reduce(((r,n)=>n!==e?{...r,[n]:t[n]}:r),{}),O4=(e,t)=>{const{categoryId:r,categoryOption:n}=t.payload;return((e,t,r)=>{const n={...e.categories,[t]:r.id},a={...e.categoriesMeta,[t]:{name:r.name,writeAccess:r.writeAccess}};return{...e,categories:n,categoriesMeta:a,complete:!1}})(e,r,n)},N4=(e,t)=>{const{categoryId:r}=t.payload;return((e,t)=>{const{categoriesMeta:r,categories:n}=e,a=C4(t,n),o=C4(t,r);if(!Object.keys(a).length&&!Object.keys(o).length){const t={...e};return delete t.categories,delete t.categoriesMeta,t.complete=!1,t}return{...e,categories:a,categoriesMeta:o,complete:!1}})(e,r)},R4=e=>({...e,categories:void 0,categoriesMeta:void 0}),w4=(e=>rc({...e,[cD]:(e,t)=>({...e,complete:t.payload.isComplete}),[df]:e=>({...e,programId:void 0,categories:void 0,categoriesMeta:void 0,trackedEntityTypeId:void 0,complete:!1}),[zD]:(e,t)=>{const{eventContainer:r,categoriesData:n}=t.payload,a=r.event,o=n?n.reduce(((e,t)=>(e[t.categoryId]=t.categoryOption.id,e)),{}):void 0,i=n?n.reduce(((e,t)=>(e[t.categoryId]={name:t.categoryOption.name,writeAccess:t.categoryOption.writeAccess},e)),{}):void 0;return{...e,programId:a.programId,orgUnitId:a.orgUnitId,categories:o,categoriesMeta:i,complete:!0}},[eU]:(e,t)=>{const{eventContainer:r,categoriesData:n}=t.payload,a=r.event,o=n?n.reduce(((e,t)=>(e[t.categoryId]=t.categoryOption.id,e)),{}):void 0,i=n?n.reduce(((e,t)=>(e[t.categoryId]={name:t.categoryOption.name,writeAccess:t.categoryOption.writeAccess},e)),{}):void 0;return{...e,programId:a.programId,orgUnitId:a.orgUnitId,categories:o,categoriesMeta:i,complete:!0}},[pD]:(e,t)=>{const{resetCategories:r}=t.payload,{categories:n,categoriesMeta:a}=e,o=r.reduce(((e,t)=>(e.categories[t]=void 0,e.categoriesMeta[t]=void 0,e)),{categories:{...n},categoriesMeta:{...a}});return{...e,categories:o.categories,categoriesMeta:o.categoriesMeta,categoryCheckInProgress:!1}},[uD]:e=>({...e,categoryCheckInProgress:!1}),[mD]:(e,t)=>{const{newStatus:r}=t.payload;return{...e,showaccessible:r}},[gD.FROM_URL_UPDATE]:(e,t)=>{let{categories:r,categoriesMeta:n}=e;const{nextProps:a,prevProps:{programId:o}}=t.payload,i=a.programId===o?{categories:r,categoriesMeta:n}:{};return{...a,...i,complete:!1}},[f4]:O4,[I4]:N4,[b4]:R4,[vD.CATEGORY_OPTION_SET]:O4,[vD.CATEGORY_OPTION_RESET]:N4,[vD.ALL_CATEGORY_OPTIONS_RESET]:R4,[S4]:O4,[T4]:N4,[A4]:R4,[hC]:(e,t)=>{let{payload:{trackedEntityTypeId:r}}=t;return{...e,complete:!1,programId:void 0,categories:void 0,categoriesMeta:void 0,trackedEntityTypeId:r}},[fO]:(e,t)=>{let{payload:{trackedEntityTypeId:r}}=t;return{...e,programId:void 0,categories:void 0,categoriesMeta:void 0,complete:!1,trackedEntityTypeId:r}}},"currentSelections",{complete:!1,showaccessible:!1,categoryCheckInProgress:!1}))({}),_4="CloseFeedback",P4="StartSavingNewTrackedEntityInstance",k4="SaveNewTrackedEntityInstance",D4="CompleteSavingNewTrackedEntityInstance",U4="FailSavingNewTrackedEntityInstance",L4="StartSavingNewTrackedEntityInstanceWithEnrollment",F4="SaveNewTrackedEntityInstanceWithEnrollment",x4="CompleteSavingNewTrackedEntityInstanceWithEnrollment",M4="FailSavingNewTrackedEntityInstanceWithEnrollment";function V4(e,t,r){const n=[...e];return n.push({message:t,action:r,feedbackType:"ERROR"}),n}function j4(e,t){return{message:e,action:t,feedbackType:"ERROR"}}const G4=(e=>rc({...e,[_4]:e=>{const t=[...e];return t.shift(),t},[jy]:(e,t)=>V4(e,t.payload.error,t.payload.action),[WD]:(e,t)=>V4(e,t.payload),[QU]:(e,t)=>V4(e,t.payload.errorMessage),[Tv]:(e,t)=>{const r=t.payload,a=(0,ki.A)(r)?r:r.message,o=(0,wc.A)(r)?r:null;S().error((0,j.px)(a||n.A.t("Error saving event"))(o));return[...e,j4(n.A.t("Could not save event"))]},[eL]:(e,t)=>[...e,j4(t.payload.errorMessage)],[rG]:e=>[...e,j4(n.A.t("Could not delete event"))],[zU]:e=>[...e,j4(n.A.t("Could not save working list"))],[jU]:e=>[...e,j4(n.A.t("Could not add working list"))],[$U]:e=>[...e,j4(n.A.t("Could not delete working list"))],[Sc]:(e,t)=>V4(e,t.payload.message),[Rv]:(e,t)=>{const r=t.payload,a=(0,ki.A)(r)?r:r.message,o=(0,wc.A)(r)?r:null;S().error((0,j.px)(a||n.A.t("Error saving event"))(o));return[...e,j4(n.A.t("Could not save event"))]},[Zy]:(e,t)=>V4(e,t.payload.message),[c$]:(e,t)=>V4(e,t.payload.message),[ww]:e=>V4(e,n.A.t("Organisation unit search failed.")),[U4]:e=>V4(e,n.A.t("Error saving tracked entity instance")),[M4]:e=>V4(e,n.A.t("Error saving enrollment")),[Ss.SAVE_FAILED]:e=>V4(e,n.A.t("Error saving the enrollment event")),[x$]:e=>V4(e,n.A.t("Error deleting the enrollment event")),[D$]:e=>V4(e,n.A.t("Error editing the event, the changes made were not saved")),[Ss.ERROR_ENROLLMENT]:(e,t)=>V4(e,n.A.t(t.payload.message)),[hU]:e=>V4(e,n.A.t("Error updating the Assignee")),[l5]:e=>V4(e,n.A.t("Error updating the Assignee"))},"feedbacks",[]))({[h]:e=>{const t=ye();return t.Adapters[0]!==t.adapterType?[...e,{message:{title:n.A.t("Compatibility mode"),content:n.A.t("This app is currently running in compatibility mode due to browser restrictions. For better performance, use another browser or exit private mode if this is currently in use.")},feedbackType:"ERROR",displayType:"dialog"}]:e}}),B4=rc({[gD.FROM_URL_CURRENT_SELECTIONS_VALID]:e=>({...e,selectionsError:null,lockedSelectorLoads:!1,isDataEntryLoading:!1}),[gD.FROM_URL_CURRENT_SELECTIONS_INVALID]:(e,t)=>({...e,lockedSelectorLoads:!1,selectionsError:t.payload}),[gD.FETCH_ORG_UNIT_ERROR]:(e,t)=>({...e,lockedSelectorLoads:!1,selectionsError:t.payload}),[gD.FETCH_ORG_UNIT_SUCCESS]:e=>({...e,lockedSelectorLoads:!1}),[gD.LOADING_START]:e=>({...e,lockedSelectorLoads:!0}),[gD.FROM_URL_UPDATE_COMPLETE]:e=>({...e,lockedSelectorLoads:!1}),[ZD]:e=>({...e,isDataEntryLoading:!0,lockedSelectorLoads:!0,viewEventLoadError:null}),[C$]:(e,t)=>({...e,isDataEntryLoading:!1,viewEventLoadError:t.payload}),[A$]:e=>({...e,isDataEntryLoading:!1}),[nG]:e=>({...e,isDataEntryLoading:!0,viewEventLoadError:null}),[pU]:(e,t)=>({...e,viewEventLoadError:t.payload.error}),[rU]:e=>({...e,isDataEntryLoading:!0,lockedSelectorLoads:!1}),[nU]:e=>({...e,isDataEntryLoading:!0,lockedSelectorLoads:!1}),[tU]:(e,t)=>({...e,viewEventLoadError:t.payload,lockedSelectorLoads:!1}),[E5.ERROR_VIEW]:(e,t)=>{let{payload:{error:r}}=t;return{...e,lockedSelectorLoads:!1,selectionsError:{error:r}}},[E5.CLEAR_ERROR_VIEW]:e=>({...e,selectionsError:null})},"activePage",{selectionsError:null,lockedSelectorLoads:!1,isDataEntryLoading:!1,viewEventLoadError:null}),$4="DEFAULT",W4="LOADING",H4="ERROR",z4="MISSING_SELECTIONS",Y4="READY",q4="ERROR",K4="LOADING",Q4="FULL_ACCESS",X4="LIMITED_ACCESS",J4="NO_ACCESS",Z4="UNKNOWN_ACCESS",e8="OWNERSHIP_ACCESS_PARTIALLY_DENIED",t8="OWNERSHIP_ACCESS_DENIED",r8="PROGRAM_ACCESS_CLOSED",n8="User has no read access to organisation unit:",a8={pageOpen:!0,enrollmentPageStatus:null,enrollmentAccessLevel:Z4,fetchStatus:{enrollmentId:Y4,programId:Y4,teiId:Y4}},{PAGE_OPEN:o8,PAGE_CLOSE:i8,RESET_ENROLLMENT_ID:s8,FETCH_ENROLLMENT_ID:l8,FETCH_ENROLLMENT_ID_SUCCESS:d8,FETCH_ENROLLMENT_ID_ERROR:c8,FETCH_TEI:u8,FETCH_TEI_SUCCESS:p8,FETCH_TEI_ERROR:m8,COMMIT_TRACKER_PROGRAM_ID:g8,COMMIT_NON_TRACKER_PROGRAM_ID:h8,PROGRAM_ID_ERROR:E8,FETCH_ENROLLMENTS:y8,FETCH_ENROLLMENTS_ERROR:v8,FETCH_ENROLLMENTS_SUCCESS:f8,DEFAULT_VIEW:I8,LOADING_VIEW:b8,MISSING_MESSAGE_VIEW:S8,ERROR_VIEW:T8,DELETE_ENROLLMENT:A8,UPDATE_TEI_DISPLAY_NAME:C8,UPDATE_ENROLLMENT_DATE:O8}=E5,N8=rc({[o8]:()=>a8,[i8]:e=>({...e,pageOpen:!1}),[s8]:e=>{let{enrollmentId:t,...r}=e;return{...r,fetchStatus:{...r.fetchStatus,enrollmentId:Y4}}},[l8]:(e,t)=>{let{programId:r,teiId:n,enrollments:a,...o}=e,{payload:{enrollmentId:i}}=t;return{...o,enrollmentId:i,fetchStatus:{...o.fetchStatus,enrollmentId:K4},enrollmentPageStatus:W4}},[d8]:e=>({...e,fetchStatus:{...e.fetchStatus,enrollmentId:Y4}}),[c8]:e=>({...e,fetchStatus:{...e.fetchStatus,enrollmentId:q4}}),[u8]:(e,t)=>{let{enrollments:r,...n}=e,{payload:{teiId:a}}=t;return{...n,teiId:a,fetchStatus:{...n.fetchStatus,teiId:K4},enrollmentPageStatus:W4,enrollmentAccessLevel:Z4}},[p8]:(e,t)=>{let{payload:{tetId:r,teiDisplayName:n}}=t;return{...e,tetId:r,teiDisplayName:n,fetchStatus:{...e.fetchStatus,teiId:Y4}}},[m8]:e=>({...e,fetchStatus:{...e.fetchStatus,teiId:q4}}),[g8]:(e,t)=>{let{enrollments:r,...n}=e,{payload:{programId:a}}=t;return{...n,programId:a,fetchStatus:{...n.fetchStatus,programId:Y4},enrollmentAccessLevel:Z4}},[h8]:(e,t)=>{let{enrollments:r,...n}=e,{payload:{programId:a}}=t;return{...n,programId:a,fetchStatus:{...n.fetchStatus,programId:q4},enrollmentAccessLevel:Z4}},[E8]:(e,t)=>{let{payload:{programId:r}}=t;return{...e,programId:r,fetchStatus:{...e.fetchStatus,programId:q4}}},[y8]:e=>{let{enrollments:t,...r}=e;return{...r,enrollmentPageStatus:W4,enrollmentAccessLevel:Z4}},[f8]:(e,t)=>{let{payload:{enrollments:r}}=t;return{...e,enrollments:r,enrollmentPageStatus:$4,enrollmentAccessLevel:Q4}},[v8]:(e,t)=>{let{enrollments:r,...n}=e,{payload:{accessLevel:a}}=t;return{...n,enrollmentPageStatus:z4,enrollmentAccessLevel:a}},[I8]:e=>({...e,enrollmentPageStatus:$4}),[b8]:e=>({...e,enrollmentPageStatus:W4}),[S8]:e=>({...e,enrollmentPageStatus:z4}),[T8]:e=>({...e,enrollmentPageStatus:H4}),[C8]:(e,t)=>{let{payload:{teiDisplayName:r}}=t;return{...e,teiDisplayName:r}},[O8]:(e,t)=>{let{payload:{enrollmentId:r,enrollmentDate:n}}=t;return{...e,enrollments:e.enrollments.map((e=>(e.enrollment===r&&(e.enrolledAt=n),e)))}},[A8]:(e,t)=>{let{payload:{enrollmentId:r}}=t;return{...e,enrollments:[...e.enrollments.filter((e=>e.enrollment!==r))]}}},"enrollmentPage",a8),{COMMON_ENROLLMENT_SITE_DATA_SET:R8,UPDATE_ENROLLMENT_DATE:w8,UPDATE_INCIDENT_DATE:_8,UPDATE_ENROLLMENT_EVENT:P8,UPDATE_OR_ADD_ENROLLMENT_EVENTS:k8,UPDATE_ENROLLMENT_ATTRIBUTE_VALUES:D8,UPDATE_ENROLLMENT_AND_EVENTS:U8,ROLLBACK_ENROLLMENT_EVENT:L8,ROLLBACK_ENROLLMENT_EVENTS:F8,ROLLBACK_ENROLLMENT_AND_EVENTS:x8,COMMIT_ENROLLMENT_EVENT:M8,COMMIT_ENROLLMENT_EVENTS:V8,ADD_PERSISTED_ENROLLMENT_EVENTS:j8,COMMIT_ENROLLMENT_AND_EVENTS:G8,DELETE_ENROLLMENT_EVENT:B8,UPDATE_ENROLLMENT_EVENT_STATUS:$8}=Ss,W8=(e,t)=>{const{assignedUser:r,eventId:n}=t.payload,a=e.enrollment.events.reduce(((e,t)=>t.event===n?[...e,{...t,assignedUser:r}]:[...e,t]),[]);return{...e,enrollment:{...e.enrollment,events:a}}},H8=rc({[R8]:(e,t)=>{let{payload:{enrollment:r,attributeValues:n}}=t;return{...e,enrollment:r,attributeValues:n,enrollmentId:null===r||void 0===r?void 0:r.enrollment}},[w8]:(e,t)=>{let{payload:{enrollmentDate:r}}=t;return{...e,enrollment:{...e.enrollment,enrolledAt:r}}},[_8]:(e,t)=>{let{payload:{incidentDate:r}}=t;return{...e,enrollment:{...e.enrollment,occurredAt:r}}},[P8]:(e,t)=>{var r;let{payload:{eventId:n,eventData:a}}=t;const o=null===(r=e.enrollment.events)||void 0===r?void 0:r.map((e=>e.event===n?{...a,pendingApiResponse:!0,dataToRollback:e}:e));return{...e,enrollment:{...e.enrollment,events:o}}},[L8]:(e,t)=>{var r;let{payload:{eventId:n}}=t;const a=null===(r=e.enrollment.events)||void 0===r?void 0:r.map((e=>e.event===n?e.dataToRollback:e));return{...e,enrollment:{...e.enrollment,events:a}}},[M8]:(e,t)=>{var r,n;let{payload:{eventId:a}}=t;const o=null===(r=e.enrollment)||void 0===r||null===(n=r.events)||void 0===n?void 0:n.map((e=>{if(e.event===a){const{pendingApiResponse:t,dataToRollback:r,...n}=e;return n}return e}));return{...e,enrollment:{...e.enrollment,events:o}}},[B8]:(e,t)=>{var r;let{payload:{eventId:n}}=t;const a=null===(r=e.enrollment.events)||void 0===r?void 0:r.filter((e=>e.event!==n));return{...e,enrollment:{...e.enrollment,events:a}}},[$8]:(e,t)=>{var r;let{payload:{eventId:n,status:a,updatedAt:o}}=t;const i=null===(r=e.enrollment.events)||void 0===r?void 0:r.map((e=>e.event===n?{...e,status:a,updatedAt:o}:e));return{...e,enrollment:{...e.enrollment,events:i}}},[k8]:(e,t)=>{let{payload:{events:r}}=t;const n=r.map((e=>({...e,pendingApiResponse:!0}))),a=e.enrollment.events.map((e=>{const t=n.find((t=>t.event===e.event));return t?{...t,dataToRollback:e}:e})).concat(n.filter((t=>!e.enrollment.events.some((e=>e.event===t.event)))));return{...e,enrollment:{...e.enrollment,events:a}}},[j8]:(e,t)=>{let{payload:{events:r}}=t;const n=[...e.enrollment.events,...r];return{...e,enrollment:{...e.enrollment,events:n}}},[F8]:(e,t)=>{let{payload:{events:r}}=t;const n=r.map((e=>e.event)),a=e.enrollment.events.map((e=>n.includes(e.event)?e.dataToRollback?e.dataToRollback:null:e)).filter(Boolean);return{...e,enrollment:{...e.enrollment,events:a}}},[V8]:(e,t)=>{var r,n;let{payload:{events:a}}=t;const o=a.map((e=>e.uid)),i=null===(r=e.enrollment)||void 0===r||null===(n=r.events)||void 0===n?void 0:n.map((e=>{if(o.includes(e.event)){const{pendingApiResponse:t,uid:r,dataToRollback:n,...a}=e;return{...a}}return e}));return{...e,enrollment:{...e.enrollment,events:i}}},[U8]:(e,t)=>{var r;let{payload:{enrollment:n}}=t;const a={...n,pendingApiResponse:!0,dataToRollback:e.enrollment};if((null===(r=a.events)||void 0===r?void 0:r.length)>0){const t=e.enrollment.events.map((e=>{const t=a.events.find((t=>t.event===e.event));return t?{...t,pendingApiResponse:!0,dataToRollback:e}:e})).concat(a.events.filter((t=>!e.enrollment.events.some((e=>e.event===t.event)))).map((e=>({...e,pendingApiResponse:!0}))));return{...e,enrollment:{...e.enrollment,...a,events:t}}}return{...e,enrollment:{...e.enrollment,...a}}},[x8]:(e,t)=>{let{payload:{uid:r}}=t;const n=e.enrollment.dataToRollback,a=e.enrollment.events.reduce(((e,t)=>{if(r&&t.uid===r)return e;if(t.pendingApiResponse&&!t.dataToRollback)return e;const n=t.dataToRollback?t.dataToRollback:t;return[...e,n]}),[]);return{...e,enrollment:{...n,events:a}}},[G8]:(e,t)=>{let{payload:{eventId:r,uid:n}}=t;const{pendingApiResponse:a,dataToRollback:o,...i}=e.enrollment,s=e.enrollment.events.map((e=>{const t=n&&e.uid===n?r:e.event,{pendingApiResponse:a,dataToRollback:o,uid:i,...s}=e;return{...s,event:t}}));return{...e,enrollment:{...i,events:s}}},[D8]:(e,t)=>{let{payload:{attributeValues:r}}=t;return{...e,attributeValues:r}},[xq]:(e,t)=>{let{payload:{note:r}}=t;return{...e,enrollment:{...e.enrollment,notes:[...e.enrollment.notes,r]}}},[L$]:(e,t)=>{var r;let{payload:{eventId:n}}=t;const a=null===(r=e.enrollment.events)||void 0===r?void 0:r.map((e=>e.event===n?{...e,pendingApiResponse:!0}:e));return{...e,enrollment:{...e.enrollment,events:a}}},[M$]:(e,t)=>{var r;let{meta:{eventId:n}}=t;const a=null===(r=e.enrollment.events)||void 0===r?void 0:r.filter((e=>e.event!==n));return{...e,enrollment:{...e.enrollment,events:a}}},[x$]:(e,t)=>{var r;let{meta:{eventId:n}}=t;const a=null===(r=e.enrollment.events)||void 0===r?void 0:r.map((e=>{if(e.event===n){const{pendingApiResponse:t,...r}=e;return{...r,event:n}}return e}));return{...e,enrollment:{...e.enrollment,events:a}}},[wZ]:(e,t)=>{let{payload:r}=t;return{...e,eventSaveInProgress:r}},[_Z]:e=>{const{eventSaveInProgress:t,...r}=e;return r},[s5]:W8,[l5]:W8},"enrollmentDomain",{}),z8="DEFAULT",Y8="WITHOUT_ORG_UNIT_SELECTED",q8="WITHOUT_PROGRAM_CATEGORY_SELECTED",K8="CATEGORY_OPTION_INVALID_FOR_ORG_UNIT",Q8="newPageDataEntryId",X8={newPageStatus:z8},J8=rc({[vD.NEW_PAGE_DEFAULT_VIEW]:e=>({...e,newPageStatus:z8}),[vD.NEW_PAGE_WITHOUT_ORG_UNIT_SELECTED_VIEW]:e=>({...e,newPageStatus:Y8}),[vD.NEW_PAGE_WITHOUT_PROGRAM_CATEGORY_SELECTED_VIEW]:e=>({...e,newPageStatus:q8}),[vD.NEW_PAGE_CATEGORY_OPTION_INVALID_FOR_ORG_UNIT_VIEW]:e=>({...e,newPageStatus:K8}),[L4]:(e,t)=>{const{uid:r}=t.payload;return{...e,uid:r}},[vD.CLEAN_UP_UID]:e=>{const t={...e};return delete t.uid,{...t}}},"newPage",X8),Z8={isLoading:!1,isUpdating:!1,loadError:!0,teis:[],currentPage:0},e3=[B4,y4,w4,e$,N8,H8,bU,SU,AU,CU,OU,NU,_U,RU,wU,PU,G4,VD,jD,GD,BD,u4,PB,Y5,kB,J8,B5,$5,r4,W5,H5,rc({[bN]:e=>({...e,isLoading:!0,teis:[]}),[SN]:(e,t)=>({...e,isLoading:!1,isUpdating:!1,teis:t.payload.teis,loadError:!1,currentPage:t.payload.currentPage}),[AN]:e=>({...e,isLoading:!1,isUpdating:!1,loadError:!1}),[TN]:e=>({...e,isLoading:!1,isUpdating:!1,loadError:!0,teis:[]}),[CN]:(e,t)=>({...e,isUpdating:!0,currentPage:t.payload.page}),[ON]:e=>({...e,...Z8})},"possibleDuplicates",Z8),q5,K5,c4,QE,ty,JE,ZE,XE,ry,ny,oy,ay,iy,sy,MC,Q5,rc({[NK]:(e,t)=>{const{hasError:r}=t.payload;return{...e,hasError:r}},[RK]:(e,t)=>{const{attributeValues:r,geometry:n=null}=t.payload;return{...e,attributeValues:r,geometry:n}},[wK]:e=>({...e,attributeValues:[],geometry:void 0,hasError:!1})},"trackedEntityInstance",{hasError:!1,attributeValues:[],geometry:void 0}),G5,CB,eG,NB,RB,wB,_B,TB,AB,rc({[Ss.SET_EXTERNAL_ENROLLMENT_STATUS]:(e,t)=>({status:{value:t.payload.status}})},"widgetEnrollment",{status:{value:null}})];var t3=r(36130);const r3=e=>{var t;let{store:r,dataEntryId:a,itemId:o,uid:i,orgUnit:s,fieldData:l,programId:d}=e;const c=r.value,u=yf(a,o),p=c.dataEntries[a].eventId,m=c.events[p],g=(0,it.Nd)(d),h=g instanceof FB.jV?g.stage:null===(t=(0,DR.p)(m))||void 0===t?void 0:t.stage;if(!h)throw Error(n.A.t("stage not found in rules execution"));const E=h.stageForm,y={...E?od(c,E,u,l):{},...E?id(c,o,a,E):{},eventId:p};let v;if(g instanceof FB.rr){const{enrollment:e,attributeValues:t}=c.enrollmentDomain,{apiOtherEvents:r,apiCurrentEventOriginal:n}=e.events.reduce(((e,t)=>(t.event===y.eventId?e.apiCurrentEventOriginal=t:e.apiOtherEvents.push(t),e)),{apiOtherEvents:[]});v=Zl({program:g,stage:h,orgUnit:s,currentEvent:{...y,createdAt:n.createdAt},otherEvents:HB(r),enrollmentData:MB(e),attributeValues:xB(t,g.attributes)})}else v=Jl({program:g,orgUnit:s,currentEvent:y});return(0,Xd.OJ)([ld(v,u),av(a,o,i)],qB)},n3=e=>{var t;return(null===(t=(0,it.he)(null===e||void 0===e?void 0:e.programId))||void 0===t?void 0:t.scopeType)===it.m2.TRACKER_PROGRAM?M.ENROLLMENT_EVENT:M.SINGLE_EVENT};var a3=r(69299);const o3=e=>{var t;return(null===(t=(0,it.he)(null===e||void 0===e?void 0:e.programId))||void 0===t?void 0:t.scopeType)===it.m2.TRACKER_PROGRAM?M.ENROLLMENT_EVENT:M.SINGLE_EVENT};var i3=r(48875);const s3="BatchOpenTeiSearch",l3="relationshipTeiSearch",d3=(e,t)=>`${t}:eq:${$i(e)}`,c3=(e,t)=>{let{id:r}=t;return`${r}:ge:${e.from}:le:${e.to}`},u3=(e,t)=>t.optionSet&&t.type!==it.CO.MULTI_TEXT?d3(e,t.id):((e,t)=>`${t}:like:${$i(e)}`)(e,t.id),p3={[it.CO.TEXT]:u3,[it.CO.MULTI_TEXT]:u3,[it.CO.NUMBER_RANGE]:c3,[it.CO.DATE_RANGE]:c3,[it.CO.DATETIME_RANGE]:c3,[it.CO.TIME_RANGE]:c3};function m3(e,t,r){return e||0===e||!1===e?p3[t]?p3[t](e,r):d3(e,r.id):e}function g3(e,t,r){return e||0===e||!1===e?d3(e,r.id):e}const h3=function(){return{page:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,pageSize:5}},E3=e=>{let{state:t,searchId:r,formId:n,searchGroupId:a,pageNumber:o,resultsPageSize:i,absoluteApiPath:d,querySingleResource:c}=e;const u=t.teiSearch[r],p=t.formsValues[n],{selectedProgramId:m,selectedTrackedEntityTypeId:g,selectedOrgUnit:h,selectedOrgUnitScope:E}=u,y=qP(g,m)[a],v=y.unique?g3:m3,f=y.searchForm.convertValues(p,((e,t,r)=>v(_i(Mi(e,t),t),t,r))),I=Object.keys(f).reduce(((e,t)=>{const r=f[t];return(0,Id.A)(r)?[...e,...r]:[...e,r]}),[]).filter((e=>null!==e&&void 0!==e)),b={filter:I,fields:"attributes,enrollments,trackedEntity,orgUnit",...(A=h,C=E,["ACCESSIBLE","CAPTURE","ALL"].includes(C)?{ouMode:C}:{orgUnit:A&&A.id,ouMode:C}),...(S=m,T=g,S?{program:S}:{trackedEntityType:T}),...h3(o),pageSize:i};var S,T,A,C;const O=m?(0,it.x6)(m).attributes:(0,it.mu)(g).attributes;return(0,ZC.H)(aO(b,O,d,c,m)).pipe((0,s.T)((e=>{let{trackedEntityInstanceContainers:t,pagingData:o}=e;return y.unique&&0===t.length&&b.program?(e=>{let{formId:t,searchGroupId:r,searchId:n,selectedProgramId:a,programQueryArgs:o}=e;return l($P)({formId:t,searchGroupId:r,searchId:n,selectedProgramId:a,programQueryArgs:o})})({selectedProgramId:m,searchId:r,formId:n,searchGroupId:a,programQueryArgs:b}):zP({trackedEntityInstanceContainers:t,currentPage:o.currentPage},n,a,r)})),(0,XC.W)((()=>(0,eO.of)(HP(n,a,r)))))},y3=(e,t)=>`${t}:eq:${$i(e)}`;function v3(e,t){return`${t}:ge:${e.from}:le:${e.to}`}const f3={[it.CO.TEXT]:(e,t)=>`${t}:like:${$i(e)}`,[it.CO.NUMBER_RANGE]:v3,[it.CO.DATE_RANGE]:v3,[it.CO.DATETIME_RANGE]:v3,[it.CO.TIME_RANGE]:v3};function I3(e,t,r){return e||0===e||!1===e?f3[t]?f3[t](e,r.id):y3(e,r.id):e}function b3(e,t,r){return e||0===e||!1===e?y3(e,r.id):e}function S3(e,t,r){return`${e}-${t}-${r}`}const T3=function(){return{page:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,pageSize:5}},A3=e=>{let{state:t,searchId:r,formId:n,searchGroupId:a,pageNumber:o,resultsPageSize:i,absoluteApiPath:d,querySingleResource:c}=e;const u=t.teiSearch[r],p=t.formsValues[n],{selectedProgramId:m,selectedTrackedEntityTypeId:g,selectedOrgUnit:h,selectedOrgUnitScope:E}=u,y=DY(g,m)[a],v=y.unique?b3:I3,f=y.searchForm.convertValues(p,((e,t,r)=>v(_i(Mi(e,t),t),t,r))),I=Object.keys(f).reduce(((e,t)=>{const r=f[t];return(0,Id.A)(r)?[...e,...r]:[...e,r]}),[]).filter((e=>null!==e&&void 0!==e)),b={filter:I,fields:"attributes,enrollments,trackedEntity,orgUnit",...(A=h,C=E,"ACCESSIBLE"!==C?{ou:A&&A.id,ouMode:C}:{ouMode:C}),...(S=m,T=g,S?{program:S}:{trackedEntityType:T}),...T3(o),pageSize:i};var S,T,A,C;const O=m?(0,it.x6)(m).attributes:(0,it.mu)(g).attributes;return(0,ZC.H)(aO(b,O,d,c,m)).pipe((0,s.T)((e=>{let{trackedEntityInstanceContainers:t,pagingData:o}=e;return y.unique&&0===t.length&&b.program?(e=>{let{formId:t,searchGroupId:r,searchId:n,selectedProgramId:a,programQueryArgs:o}=e;return l(wY)({formId:t,searchGroupId:r,searchId:n,selectedProgramId:a,programQueryArgs:o})})({selectedProgramId:m,searchId:r,formId:n,searchGroupId:a,programQueryArgs:b}):PY({trackedEntityInstanceContainers:t,currentPage:o.currentPage},n,a,r)})),(0,XC.W)((()=>(0,eO.of)(_Y(n,a,r)))))},C3="Filter form field org units failed",O3=(e,t)=>e.type===xy.FORM_DATA_ADD&&e.payload.formId===t,N3=(e,t,r)=>(0,oe.default)(e.payload)?e.payload.some((e=>O3(e,t))):O3(e,t)||((e,t,r)=>e.type===Qg&&e.payload.formId===t&&e.payload.elementId===r)(e,t,r),R3="Could not retrieve organisation unit list",w3=(e,t)=>e.type===DP&&e.payload.searchId===t,_3=(e,t)=>(0,oe.default)(e.payload)?e.payload.some((e=>w3(e,t))):w3(e,t)||((e,t)=>e.type===Z_&&e.payload.searchId===t)(e,t),P3={TRACKED_ENTITY_INSTANCE:(e,t)=>{const r=e.trackedEntity,n=(0,it.mu)(r.trackedEntityType),a=r.attributes.reduce(((e,t)=>(e[t.attribute]=t.value,e)),{});return{id:r.trackedEntity,name:Q_(a,n.attributes,n.name),type:"TRACKED_ENTITY_INSTANCE",linkProgramId:t.programId}},PROGRAM_STAGE_INSTANCE:e=>{const t=e.event,r=Nt.Jj.get(t.program);if(!r)return null;const n=r.getStage(t.programStage);return n?{id:t.event,name:`${n.name} event`,type:"PROGRAM_STAGE_INSTANCE"}:null}};async function k3(e,t,r){const n=await r({resource:"tracker/relationships",params:e});return L(U.relationships,n).map((e=>function(e,t){const r=t.find((t=>t.id===e.relationshipType));return r?{id:e.relationship,clientId:e.relationship,relationshipType:{id:r.id,name:r.name},from:P3[r.from.entity](e.from,r.from),to:P3[r.to.entity](e.to,r.to)}:null}(e,t)))}const D3="viewEvent",U3="viewEvent",L3={programStage:"programStage",occurredAt:"eventOccurredAt",scheduledAt:"scheduledAt",status:"status",assignedUser:"assignee"},F3="Program stage",x3="Report date",M3="Scheduled date",V3="Event status",j3="Assigned to",G3={[L3.occurredAt]:"occurredAt",[L3.assignedUser]:"assignedUser"},B3=e=>G3[e]||e,$3=e=>e.toString(),W3={[it.CO.NUMBER]:$3,[it.CO.INTEGER]:$3,[it.CO.INTEGER_POSITIVE]:$3,[it.CO.INTEGER_ZERO_OR_POSITIVE]:$3,[it.CO.INTEGER_NEGATIVE]:$3,[it.CO.DATE]:e=>{const t=$()(e);return t.locale("en"),t.format("YYYY-MM-DD")},[it.CO.BOOLEAN]:e=>e?"true":"false",[it.CO.TRUE_ONLY]:()=>"true"},H3=(e,t)=>({in:e.values.map((e=>W3[t]?W3[t](e):e.toString()))}),z3="TEI",Y3="ABSOLUTE",q3="RELATIVE",K3="programStatus",Q3="enrolledAt",X3="occurredAt",J3="assignee",Z3="followUp",e6="PROVIDED",t6="TEI_WORKING_LISTS",r6="PROGRAM_STAGE_WORKING_LISTS",n6=e=>({ge:e.ge?e.ge.toString():void 0,le:e.le?e.le.toString():void 0}),a6=e=>{const t=$()(e);return t.locale("en"),t.format("YYYY-MM-DD")},o6=e=>({dateFilter:e.type===Mx.RELATIVE?{type:e.type,period:e.period,startBuffer:e.startBuffer,endBuffer:e.endBuffer}:{type:e.type,startDate:e.ge?a6(e.ge):void 0,endDate:e.le?a6(e.le):void 0}}),i6={[ZL.TEXT]:e=>({like:e.value}),[ZL.NUMBER]:n6,[ZL.INTEGER]:n6,[ZL.INTEGER_POSITIVE]:n6,[ZL.INTEGER_NEGATIVE]:n6,[ZL.INTEGER_ZERO_OR_POSITIVE]:n6,[ZL.DATE]:o6,[ZL.BOOLEAN]:e=>({in:e.values.map((e=>e?"true":"false"))}),[ZL.TRUE_ONLY]:()=>({eq:"true"})},s6={[K3]:e=>e.values[0],[Q3]:e=>{var t;return null===(t=o6(e))||void 0===t?void 0:t.dateFilter},[X3]:e=>{var t;return null===(t=o6(e))||void 0===t?void 0:t.dateFilter},[Z3]:e=>Boolean(e.values[0]),[J3]:e=>({assignedUserMode:e.assignedUserMode,assignedUsers:e.assignedUser?[e.assignedUser.id]:void 0}),[L3.status]:e=>e.values[0],[L3.occurredAt]:e=>{var t;return null===(t=o6(e))||void 0===t?void 0:t.dateFilter},[L3.scheduledAt]:e=>{var t;return null===(t=o6(e))||void 0===t?void 0:t.dateFilter}},l6=e=>{let{filters:t,mainFilters:r}=e;return Object.keys(t).reduce(((e,n)=>{const a=t[n],o=r.find((e=>e.id===n));if(!a||!o||!s6[n])return e;const i=s6[n](a);return void 0!==i?n===J3?{...e,...i}:{...e,[n]:i}:e}),{})},d6=e=>{let{filters:t,dataElementsValueFilters:r,mainFilters:n}=e;return Object.keys(t).map((e=>{const a=t[e],o=r.find((t=>t.id===e)),i=n.find((t=>t.id===e));return a&&o&&!i?i6[o.type]?a.usingOptionSet?{...H3(a,o.type),dataItem:e}:{...i6[o.type](a),dataItem:e}:(S().error((0,j.px)("tried to convert a filter to api value, but there was no filter converter or specification found")({filter:a,element:o,key:e})),null):null})).filter((e=>e))},c6=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Object.keys(e).filter((e=>!t.get(e))).flatMap((t=>{const r=e[t];return Array.isArray(r)?r.map((e=>`${t}:${e}`)):`${t}:${r}`}))},u6=function(){const e=c6(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0);return e.length>0?{filter:e}:null},p6=function(){const e=c6(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0);return e.length>0?{filterAttributes:e}:null},m6=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Object.keys(e).filter((e=>t.get(e))).reduce(((r,n)=>{const a=e[n],{transformRecordsFilter:o}=t.get(n)||{};return{...r,...o(a)}}),{})},g6=(e,t)=>{const r={[it.CO.ORGANISATION_UNIT]:async t=>pi(t,e),[it.CO.IMAGE]:e=>e.reduce(((e,t)=>(e[t]=t,e)),{}),[it.CO.FILE_RESOURCE]:async t=>{const r=t.map((async t=>{try{const{id:r,displayName:n}=await e({resource:"fileResources",id:t});return{id:r,name:n}}catch(r){return S().error((0,j.px)("subValue not found")({key:t})),null}}));return(await Promise.all(r)).reduce(((e,t)=>{if(t){const{id:r,name:n}=t;e[r]=n}return e}),{})}},n={[it.CO.IMAGE]:e=>{let{subvalueKey:r,imageUrl:n,previewUrl:a}=e;return{value:r,url:`${t}${n}`,previewUrl:`${t}${a}`}},[it.CO.FILE_RESOURCE]:e=>{let{subvalueKey:r,subvalue:n,fileUrl:a}=e;return{name:n,value:r,url:`${t}${a}`}}};return async(e,t)=>{const a=t.filter((e=>{let{type:t}=e;return r[t]})),o=((e,t)=>t.map((t=>{let{id:r,type:n}=t;const a=e.map((e=>{var t;let{record:n}=e;return null===(t=n[r])||void 0===t?void 0:t.convertedValue})).filter((e=>null!=e));return{type:n,subvalueKeys:a}})).reduce(((e,t)=>{let{type:r,subvalueKeys:n}=t;return n.length>0&&(e[r]=[...e[r]||[],...n]),e}),{}))(e,a),i=await(e=>{const t=Object.keys(e).map((async t=>{const n=e[t],a=[...new Set(n).values()];try{return{type:t,subvalues:await r[t](a)}}catch(o){S().error((0,j.px)("subvalue not found"))}return{type:t,subvalues:{}}}));return Promise.all(t)})(o),s=((e,t,r)=>r.reduce(((e,r)=>{let{id:a,type:o}=r;const{subvalues:i={}}=t.find((e=>{let{type:t}=e;return t===o}))||{};return e.map((e=>{var t;let{id:r,record:s}=e;const l=null===(t=s[a])||void 0===t?void 0:t.convertedValue;if(null==l)return{id:r,record:s};const d=i[l];let c;return null==d?(S().error((0,j.px)("subvalue not found")({subvalueKey:l,id:r,record:s})),c=void 0):c=n[o]?n[o]({subvalueKey:l,subvalue:d,columnId:a,id:r,imageUrl:s[a].imageUrl,previewUrl:s[a].previewUrl,fileUrl:s[a].fileUrl}):d,{id:r,record:{...s,[a]:c}}}))}),e))(e,i,a);return(e=>e.map((e=>{let{id:t,record:r}=e;return{id:t,record:Object.keys(r).reduce(((e,t)=>{var n;return e[t]=void 0!==(null===(n=r[t])||void 0===n?void 0:n.convertedValue)?r[t].convertedValue:r[t],e}),{})}})))(s)}},h6=(0,fg.Mz)((e=>e),((e,t)=>t),((e,t)=>g6(e,t))),E6={sortById:"createdAt",sortByDirection:"desc"},y6=e=>{let{sortById:t,sortByDirection:r,withAPINameConverter:n}=e;if("default"===r)return`${E6.sortById}:${E6.sortByDirection}`;return`${n?B3(t):t}:${r}`},v6={[it.CO.FILE_RESOURCE]:e=>{let{trackedEntity:t,id:r,programId:n}=e;return(0,j.UR)(j.Gv.trackerFileEndpoint)?{fileUrl:`/tracker/trackedEntities/${t}/attributes/${r}/file?program=${n}`}:{fileUrl:`/trackedEntityInstances/${t}/${r}/file`}},[it.CO.IMAGE]:e=>{let{trackedEntity:t,id:r,programId:n}=e;return(0,j.UR)(j.Gv.trackerImageEndpoint)?{imageUrl:`/tracker/trackedEntities/${t}/attributes/${r}/image?program=${n}`,previewUrl:`/tracker/trackedEntities/${t}/attributes/${r}/image?program=${n}&dimension=small`}:{imageUrl:`/trackedEntityInstances/${t}/${r}/image?program=${n}`,previewUrl:`/trackedEntityInstances/${t}/${r}/image?program=${n}&dimension=SMALL`}}},f6={[it.CO.FILE_RESOURCE]:e=>{let{event:t,id:r}=e;return(0,j.UR)(j.Gv.trackerFileEndpoint)?{fileUrl:`/tracker/events/${t}/dataValues/${r}/file`}:{fileUrl:`/events/files?dataElementUid=${r}&eventUid=${t}`}},[it.CO.IMAGE]:e=>{let{event:t,id:r}=e;return(0,j.UR)(j.Gv.trackerImageEndpoint)?{imageUrl:`/tracker/events/${t}/dataValues/${r}/image`,previewUrl:`/tracker/events/${t}/dataValues/${r}/image?dimension=small`}:{imageUrl:`/events/files?dataElementUid=${r}&eventUid=${t}`,previewUrl:`/events/files?dataElementUid=${r}&eventUid=${t}&dimension=SMALL`}}},I6=Object.freeze({event:"event",trackedEntity:"trackedEntity"}),b6=Object.freeze({[I6.trackedEntity]:v6,[I6.event]:f6}),S6=(e,t,r)=>{let{page:n,pageSize:a,programId:o,orgUnitId:i,filters:s,sortById:l,sortByDirection:d}=e;return{...u6(s,r),...m6(s,r),order:y6({sortById:l,sortByDirection:d,withAPINameConverter:!0}),page:n,pageSize:a,orgUnit:i,ouMode:i?"SELECTED":"ACCESSIBLE",program:o,fields:":all,!relationships,programOwners[orgUnit,program]"}},T6=async(e,t)=>{let{columnsMetaForDataFetching:r,filtersOnlyMetaForDataFetching:n,querySingleResource:a,absoluteApiPath:o}=t;const{url:i,queryParams:s}={url:"tracker/trackedEntities",queryParams:S6(e,0,n)},l=await a({resource:i,params:s}),d=L(U.trackedEntities,l),c=[...r.values()],u=((e,t,r)=>e.map((e=>{var n;const a=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((e,t)=>{let{attribute:r,value:n}=t;return e[r]=n,e}),{})}(e.attributes),o=t.map((t=>{let n,{id:o,mainProperty:i,type:s}=t;n=i?e[o]:a[o];const l=b6[I6.trackedEntity][s]?b6[I6.trackedEntity][s]({trackedEntity:e.trackedEntity,id:o,programId:r}):{};return{id:o,value:Et(n,s),...l}})).filter((e=>{let{value:t}=e;return null!=t})).reduce(((e,t)=>{let{id:r,value:n,imageUrl:a,previewUrl:o,fileUrl:i}=t;return e[r]={convertedValue:n,fileUrl:i,...a?{imageUrl:a,previewUrl:o}:{}},e}),{}),i=null===(n=e.programOwners.find((e=>{let{program:t}=e;return t===r})))||void 0===n?void 0:n.orgUnit;return i&&(o.programOwner=i),{id:e.trackedEntity,record:o}})))(d,c,e.programId);return{recordContainers:await h6(a,o)(u,c),request:{url:i,queryParams:s}}},A6=e=>{let{columnsMetaForDataFetching:t,apiEvent:r,dataValuesById:n}=e;return t.map((e=>{let{id:t,mainProperty:a,type:o}=e;const i=a&&t===L3.status,s=a?r[t]:n[t],l=i?((e,t)=>{const r=ys();return gH({status:e,scheduledAt:t})?r.OVERDUE:r[e]})(s,r.scheduledAt):Et(s,o),d=b6[I6.event][o]?b6[I6.event][o]({event:r.event,id:t}):{};return{id:(c=t,L3[c]||c),value:l,...d};var c}))},C6=(e,t)=>e.map((e=>{var r;const n=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((e,t)=>{let{dataElement:r,value:n}=t;return e[r]=n,e}),{})}(e.dataValues),a=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((e,t)=>{let{attribute:r,value:n}=t;return e[r]=n,e}),{})}(null===(r=e.parent)||void 0===r?void 0:r.attributes),o=e.parent,i=A6({columnsMetaForDataFetching:t,apiEvent:e,dataValuesById:n}),s=o?(e=>{let{columnsMetaForDataFetching:t,apiTEI:r,attributeValuesById:n,trackedEntity:a,programId:o}=e;return t.map((e=>{let{id:t,mainProperty:i,type:s}=e;const l=i?r[t]:n[t],d=b6[I6.trackedEntity][s]?b6[I6.trackedEntity][s]({trackedEntity:a,id:t,programId:o}):{};return{id:t,value:Et(l,s),...d}}))})({columnsMetaForDataFetching:t,apiTEI:o,attributeValuesById:a,trackedEntity:e.trackedEntity,programId:e.program}):[],l=[...i,...s].filter((e=>{let{value:t}=e;return null!=t})).reduce(((e,t)=>{let{id:r,value:n,imageUrl:a,previewUrl:o,fileUrl:i}=t;return e[r]={convertedValue:n,fileUrl:i,...a?{imageUrl:a,previewUrl:o}:{}},e}),{});return{id:e.event,record:l}})),O6=(e,t,r)=>{let{page:n,pageSize:a,programId:o,programStageId:i,orgUnitId:s,filters:l,sortById:d,sortByDirection:c}=e;const u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Object.keys(e).reduce(((r,n)=>{var a;return null!==(a=t.get(n))&&void 0!==a&&a.additionalColumn?r.filters[n]=e[n]:r.filterAttributes[n]=e[n],r}),{filters:{},filterAttributes:{}})}(l,t);return(e=>e.status!==Es.SCHEDULE||e.hasOwnProperty("scheduledAfter")?e:{...e,scheduledAfter:xl($()())})({...u6(u.filters,r),...p6(u.filterAttributes,r),...m6(l,r),order:y6({sortById:d,sortByDirection:c,withAPINameConverter:!0}),page:n,pageSize:a,orgUnit:s,ouMode:s?"SELECTED":"ACCESSIBLE",program:o,programStage:i,fields:"*"})},N6=(e,t)=>{let{pageSize:r,programId:n}=e;return{program:n,pageSize:r,trackedEntity:t,fields:"trackedEntity,createdAt,orgUnit,attributes[attribute,value],enrollments[enrollment,status,orgUnit,enrolledAt]"}},R6=async(e,t)=>{let{columnsMetaForDataFetching:r,filtersOnlyMetaForDataFetching:n,querySingleResource:a,absoluteApiPath:o}=t;const{url:i,queryParams:s}={url:"tracker/events",queryParams:O6(e,r,n)},l=await a({resource:i,params:s}),d=L(U.events,l);if(0===d.length)return{recordContainers:[],request:{url:i,queryParams:s}};const c=d.reduce(((e,t)=>{let{trackedEntity:r}=t;return e.includes(r)?e:[...e,r]}),[]).filter((e=>e)).join(";"),{url:u,queryParams:p}={url:"tracker/trackedEntities",queryParams:N6(e,c)},m=await a({resource:u,params:p}),g=L(U.trackedEntities,m),h=(e=>[...e.values()].reduce(((e,t)=>{const r={...t,id:B3(t.id)};return[...e,r]}),[]))(r),E=C6(((e,t)=>e.map((e=>{const r=t.find((t=>t.trackedEntity===e.trackedEntity));if(r){const t=null!==r&&void 0!==r&&r.enrollments&&r.enrollments.length>1?{...r,enrollments:r.enrollments.filter((t=>t.enrollment!==e.enrollment))}:r;return{...e,parent:t}}return e})))(d,g),h);return{recordContainers:await h6(a,o)(E,h),request:{url:i,queryParams:s}}},w6=(e,t)=>{if(e&&e.length>0)return((e,t)=>{const r=new Map(e.map((e=>t.has(e)&&e)).filter((e=>e)).map((e=>[e,{id:e,visible:!0}]))),n=[...t.values()].filter((e=>{let{id:t}=e;return!r.has(t)})).map((e=>{let{id:t}=e;return{id:t,visible:!1}}));return[...r.values(),...n]})(e,t)},_6={[it.CO.NUMBER]:ut,[it.CO.INTEGER]:ut,[it.CO.INTEGER_POSITIVE]:ut,[it.CO.INTEGER_ZERO_OR_POSITIVE]:ut,[it.CO.INTEGER_NEGATIVE]:ut,[it.CO.DATE]:e=>$()(e,"YYYY-MM-DD").toISOString(),[it.CO.BOOLEAN]:e=>"true"===e,[it.CO.TRUE_ONLY]:e=>"true"===e||null},P6=(e,t)=>({usingOptionSet:!0,values:e.in.map((e=>_6[t]?_6[t](e):e))}),k6=e=>{if(e.ge||e.le)return{ge:Number(e.ge),le:Number(e.le)}},D6=e=>"boolean"===typeof e?{values:[e]}:e.in?{values:e.in.map((e=>"true"===e))}:void 0,U6=e=>e.type===q3?e.period?{type:e.type,period:e.period}:rM(e.startBuffer,e.endBuffer)?{type:e.type,startBuffer:e.startBuffer,endBuffer:e.endBuffer}:void 0:e.type===Y3&&(e.startDate||e.endDate)?{type:e.type,ge:$()(e.startDate,"YYYY-MM-DD").toISOString(),le:$()(e.endDate,"YYYY-MM-DD").toISOString()}:void 0,L6=(e,t)=>{if([ZL.BOOLEAN].includes(e)){const e=["true","false"];return t.in.some((t=>!e.includes[t]))}return t.in},F6={[ZL.TEXT]:e=>{const t=e.like;return t?{value:t}:void 0},[ZL.NUMBER]:k6,[ZL.INTEGER]:k6,[ZL.INTEGER_POSITIVE]:k6,[ZL.INTEGER_NEGATIVE]:k6,[ZL.INTEGER_ZERO_OR_POSITIVE]:k6,[ZL.DATE]:e=>{let{dateFilter:t}=e;return U6(t)},[ZL.BOOLEAN]:D6,[ZL.TRUE_ONLY]:()=>({value:!0})},x6=e=>({usingOptionSet:!0,values:[e]}),M6={[K3]:x6,[Q3]:U6,[X3]:U6,[Z3]:D6,[L3.programStage]:x6,[L3.status]:x6,[L3.occurredAt]:U6,[L3.scheduledAt]:U6},V6=(e,t)=>null===e||void 0===e?void 0:e.reduce(((e,r)=>{const n=t.get(r.dataItem);if(!n||!F6[n.type])return e;const a=L6(n.type,r)?P6(r,n.type):F6[n.type](r);return a?{...e,[r.dataItem]:a}:e}),{}),j6=(e,t)=>null===e||void 0===e?void 0:e.reduce(((e,r)=>{const n=t.get(r.attribute);if(!n||!F6[n.type])return e;const a=L6(n.type,r)?P6(r,n.type):F6[n.type](r);return a?{...e,[r.attribute]:a}:e}),{}),G6=e=>Object.entries(e).reduce(((e,t)=>{let[r,n]=t;if(!M6[r]||void 0===n)return e;const a=M6[r](n);return a?{...e,[r]:a}:e}),{}),B6=async(e,t,r)=>{if(!e)return{};const{assignedUserMode:n,assignedUsers:a,attributeValueFilters:o,dataFilters:i,...s}=e,l=await(async(e,t,r)=>{if(e&&e!==e6)return{assignedUserMode:e};if(e&&e===e6&&t){const n=await(async(e,t)=>{const r=e&&e.length>0&&e[0];if(!r)return null;const n=await t({resource:`userLookup/${r}`});if(!n||!n.displayName)return null;const{id:a,displayName:o,username:i}=n;return{id:a,name:o,username:i}})(t,r);if(n)return{assignedUserMode:e,assignedUser:n}}return null})(n,a,r);return{assignee:l,...G6(s),...j6(o,t),...V6(i,t)}},$6=async(e,t,r)=>{var n,a;const{sortById:o,sortByDirection:i}=((e,t)=>{var r;const n=e&&e.split(":");if(!n||n.length<2)return E6;const a=n[0],o=n[1];return null!==t&&void 0!==t&&null!==(r=t.get(a))&&void 0!==r&&r.id?{sortById:a,sortByDirection:o}:E6})(null===e||void 0===e||null===(n=e.criteria)||void 0===n?void 0:n.order,t),s=w6(null===e||void 0===e||null===(a=e.criteria)||void 0===a?void 0:a.displayColumnOrder,t);return{filters:await B6(e.criteria,t,r),customColumnOrder:s,sortById:o,sortByDirection:i,currentPage:1,rowsPerPage:15}},W6=(e,t)=>(async(e,t)=>{const r=await t({resource:"programStageWorkingLists",params:{filter:`program.id:eq:${e}`,fields:"id,displayName,programStage,sortOrder,programStageQueryCriteria,access,externalAccess,publicAccess,user,userAccesses,userGroupAccesses"}});return r&&r.programStageWorkingLists?r.programStageWorkingLists:[]})(e,t).then((t=>{const r=Y6(e);return{templates:[r,...t.map((e=>{let{displayName:t,id:r,access:n,programStage:{id:a},programStageQueryCriteria:{enrollmentStatus:o,enrolledAt:i,enrollmentOccurredAt:s,eventStatus:l,eventScheduledAt:d,eventOccurredAt:c,followUp:u,order:p,attributeValueFilters:m,dataFilters:g,displayColumnOrder:h,assignedUserMode:E,assignedUsers:y}={},externalAccess:v,publicAccess:f,user:I,userAccesses:b,userGroupAccesses:S}=e;return{id:r,name:t,criteria:{programStatus:o,enrolledAt:i,occurredAt:s,programStage:a,eventOccurredAt:c,followUp:u,status:l,scheduledAt:d,dataFilters:g,order:p,displayColumnOrder:h,assignedUserMode:E,assignedUsers:y,attributeValueFilters:m},access:n,externalAccess:v,publicAccess:f,user:I,userAccesses:b,userGroupAccesses:S}}))],defaultTemplateId:r.id,id:r6}})),H6=(e,t)=>(async(e,t)=>{const r=await t({resource:"trackedEntityInstanceFilters",params:{filter:`program.id:eq:${e}`,fields:"id,displayName,sortOrder,entityQueryCriteria,access,externalAccess,publicAccess,user,userAccesses,userGroupAccesses"}});return r&&r.trackedEntityInstanceFilters?r.trackedEntityInstanceFilters:[]})(e,t).then((t=>{const r=Y6(e);return{templates:[r,...t.map((e=>{let{displayName:t,sortOrder:r,id:n,access:a,entityQueryCriteria:{enrollmentStatus:o,enrollmentCreatedDate:i,enrollmentIncidentDate:s,order:l,attributeValueFilters:d,followUp:c,displayColumnOrder:u,assignedUserMode:p,assignedUsers:m}={},externalAccess:g,publicAccess:h,user:E,userAccesses:y,userGroupAccesses:v}=e;return{id:n,name:t,order:r,criteria:{programStatus:o,enrolledAt:i,occurredAt:s,followUp:c,order:l,displayColumnOrder:u,assignedUserMode:p,assignedUsers:m,attributeValueFilters:d},access:a,externalAccess:g,publicAccess:h,user:E,userAccesses:y,userGroupAccesses:v}}))],defaultTemplateId:r.id,id:t6}})),z6=e=>{let{filters:t,filtersOnly:r,programStageFiltersOnly:n,columns:a=[],sortById:o,sortByDirection:i,programId:s,programStageId:l}=e;const d=l6({filters:t,mainFilters:r}),{programStatus:c,occurredAt:u,enrolledAt:p,followUp:m}=d,{assignedUserMode:g,assignedUsers:h,attributesColumns:E,dataFilters:y,status:v,eventOccurredAt:f,scheduledAt:I}=(e=>{let{filters:t,programStageFiltersOnly:r,columns:n,programStageId:a,mainFiltersConverted:o}=e;if(!a)return{assignedUserMode:o.assignedUserMode,assignedUsers:o.assignedUsers,attributesColumns:n,dataFilters:[],status:void 0,eventOccurredAt:void 0,scheduledAt:void 0};const i=l6({filters:t,mainFilters:r}),{status:s,eventOccurredAt:l,scheduledAt:d}=i;return{status:s,eventOccurredAt:l,scheduledAt:d,assignedUserMode:i.assignedUserMode,assignedUsers:i.assignedUsers,attributesColumns:n.filter((e=>!e.additionalColumn)),dataFilters:d6({filters:t,mainFilters:r,dataElementsValueFilters:n.filter((e=>e.additionalColumn))})}})({filters:t,programStageFiltersOnly:n,columns:a,programStageId:l,mainFiltersConverted:d}),b=(e=>{let{filters:t,attributeValueFilters:r}=e;return Object.keys(t).map((e=>{const n=t[e],a=r.find((t=>t.id===e));return n&&a?i6[a.type]?n.usingOptionSet?{...H3(n,a.type),attribute:e}:{...i6[a.type](n),attribute:e}:(S().error((0,j.px)("tried to convert a filter to api value, but there was no filter converter or specification found")({filter:n,element:a,key:e})),null):null})).filter((e=>e))})({filters:t,attributeValueFilters:E}),T=a.filter((e=>{let{visible:t}=e;return t})).map((e=>{let{id:t}=e;return t})),A={programStatus:c,occurredAt:u,enrolledAt:p,assignedUserMode:g,assignedUsers:h,status:v,followUp:m,eventOccurredAt:f,scheduledAt:I,attributeValueFilters:b,dataFilters:y,order:y6({sortById:o,sortByDirection:i}),displayColumnOrder:T,programStage:l};return{data:{program:{id:s},programStage:{id:l},clientId:(0,yc.A)(),sortById:o,sortByDirection:i,filters:t,visibleColumnIds:T},criteria:A}},Y6=e=>({id:`${e}-default`,isDefault:!0,name:"default",access:{update:!1,delete:!1,write:!1,manage:!1},criteria:{order:"createdAt:desc"}}),q6=e=>[{id:"orgUnit",visible:!1,type:it.CO.ORGANISATION_UNIT,header:n.A.t("Organisation unit")},{id:"createdAt",visible:!e,type:it.CO.DATE,header:n.A.t("Registration Date"),filterHidden:!0},{id:"inactive",visible:!1,type:it.CO.BOOLEAN,header:n.A.t("Inactive"),filterHidden:!0}].map((e=>({...e,mainProperty:!0}))),K6=e=>[{id:L3.status,visible:!0,type:it.CO.TEXT,header:n.A.t(V3)},{id:L3.occurredAt,visible:!0,type:it.CO.DATE,header:e.stageForm.getLabel("occurredAt")||n.A.t(x3)},...!1===e.hideDueDate?[{id:L3.scheduledAt,visible:!0,type:it.CO.DATE,header:e.stageForm.getLabel("scheduledAt")||n.A.t(M3)}]:[],...e.enableUserAssignment?[{id:L3.assignedUser,visible:!0,type:it.CO.ASSIGNEE,header:n.A.t(j3)}]:[]].map((e=>({...e,mainProperty:!0,filterHidden:!0,additionalColumn:!0}))),Q6=e=>{const t=e.stageForm,r=t?[...null===t||void 0===t?void 0:t.getElements()]:[];return J6(r)},X6=(e,t)=>e.map((e=>{let{id:r,displayInReports:n,type:a,name:o,formName:i,optionSet:s,searchable:l,unique:d}=e;return{id:r,visible:n,type:a,header:i||o,options:s&&s.options.map((e=>{let{text:t,value:r}=e;return{text:t,value:r}})),multiValueFilter:!!s||a===it.CO.BOOLEAN,filterHidden:!(t||l||d)}})),J6=e=>e.map((e=>{let{id:t,displayInReports:r,type:n,name:a,formName:o,optionSet:i}=e;return{id:t,visible:r,type:n,header:o||a,options:i&&i.options.map((e=>{let{text:t,value:r}=e;return{text:t,value:r}})),multiValueFilter:!!i,additionalColumn:!0}})),Z6=(e,t)=>{let{stages:r}=e;const{hideDueDate:a,occurredAtLabel:o,scheduledAtLabel:i,enableUserAssignment:s}=((e,t)=>(0,y.useMemo)((()=>{const r=e&&t.get(e);return r?{hideDueDate:r.hideDueDate,occurredAtLabel:r.stageForm.getLabel("occurredAt"),scheduledAtLabel:r.stageForm.getLabel("scheduledAt"),enableUserAssignment:r.enableUserAssignment}:{occurredAtLabel:n.A.t(x3),scheduledAtLabel:n.A.t(M3),hideDueDate:void 0,enableUserAssignment:!1}}),[e,t]))(t,r),l=(e=>(0,y.useMemo)((()=>[...e.values()].map((e=>({text:e.name,value:e.id})))),[e]))(r);return(0,y.useMemo)((()=>{const e=ys();return[{id:L3.programStage,type:"TEXT",header:n.A.t(F3),options:l,mainButton:!0,transformRecordsFilter:()=>null},{id:L3.occurredAt,type:"DATE",header:o,disabled:!t,tooltipContent:n.A.t("Choose a program stage to filter by {{label}}",{label:o,interpolation:{escapeValue:!1}}),transformRecordsFilter:e=>{const t={},r=e.split(":"),n=r.indexOf("ge"),a=r.indexOf("le");return-1!==n&&r[n+1]&&(t.occurredAfter=r[n+1]),-1!==a&&r[a+1]&&(t.occurredBefore=r[a+1]),t}},{id:L3.status,type:"TEXT",header:n.A.t(V3),options:[{text:e.ACTIVE,value:Es.ACTIVE},{text:e.SCHEDULE,value:Es.SCHEDULE},{text:e.COMPLETED,value:Es.COMPLETED},{text:e.OVERDUE,value:Es.OVERDUE},{text:e.SKIPPED,value:Es.SKIPPED}],disabled:!t,tooltipContent:n.A.t("Choose a program stage to filter by {{label}}",{label:V3,interpolation:{escapeValue:!1}}),transformRecordsFilter:e=>({status:e.split(":")[1]})},...!1===a?[{id:L3.scheduledAt,type:"DATE",header:i,disabled:!t,tooltipContent:n.A.t("Choose a program stage to filter by {{label}}",{label:i,interpolation:{escapeValue:!1}}),transformRecordsFilter:e=>{const t={},r=e.split(":"),n=r.indexOf("ge"),a=r.indexOf("le");return-1!==n&&r[n+1]&&(t.scheduledAfter=r[n+1]),-1!==a&&r[a+1]&&(t.scheduledBefore=r[a+1]),t}}]:[],...s?[{id:L3.assignedUser,type:it.CO.ASSIGNEE,header:j3,transformRecordsFilter:e=>{const{assignedUser:t,assignedUserMode:r}=e;return{assignedUserMode:r,...t&&{assignedUser:t}}}}]:[]]}),[t,o,i,a,l,s])},e9=(e,t,r,n)=>(0,y.useCallback)(((a,o)=>{const i=new Map(e.map((e=>{const{id:t,type:r,visible:n}=e;return[t,{id:t,type:r,visible:n,mainProperty:e.mainProperty&&"boolean"===typeof e.mainProperty?e.mainProperty:void 0,additionalColumn:e.additionalColumn?e.additionalColumn:void 0}]}))),s=t.map((e=>{let{id:t,type:r,transformRecordsFilter:n}=e;return[t,{id:t,type:r,transformRecordsFilter:n}]})),l=r.map((e=>{let{id:t,type:r,transformRecordsFilter:n}=e;return[t,{id:t,type:r,transformRecordsFilter:n}]})),d=new Map(s.concat(l));n(a,o,{columnsMetaForDataFetching:i,filtersOnlyMetaForDataFetching:d})}),[e,t,r,n]),t9=(e,t,r,n)=>(0,y.useCallback)((a=>{const o=new Map(e.map((e=>{const{id:t,type:r,visible:n}=e;return[t,{id:t,type:r,visible:n,mainProperty:e.mainProperty&&"boolean"===typeof e.mainProperty?e.mainProperty:void 0,additionalColumn:e.additionalColumn?e.additionalColumn:void 0}]}))),i=t.map((e=>{let{id:t,type:r,transformRecordsFilter:n}=e;return[t,{id:t,type:r,transformRecordsFilter:n}]})),s=r.map((e=>{let{id:t,type:r,transformRecordsFilter:n}=e;return[t,{id:t,type:r,transformRecordsFilter:n}]})),l=new Map(i.concat(s));n(a,{columnsMetaForDataFetching:o,filtersOnlyMetaForDataFetching:l},0)}),[e,t,r,n]);function r9(){return r9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r9.apply(this,arguments)}const n9=(e,t)=>(0,y.useMemo)((()=>t&&e.find((e=>e.id===t))||e[0]),[e,t]),a9=e=>{var t;let{program:r,programStageId:a,onUpdateList:o,onLoadView:i,onClearFilters:s,onResetListColumnOrder:l,onPreserveCurrentViewState:d,customColumnOrder:c,records:u,recordsOrder:p,currentTemplateId:m,initialViewConfig:g,filters:h,sortById:E,sortByDirection:v,orgUnitId:f,apiTemplates:I,templates:b,onAddTemplate:S,onUpdateTemplate:T,onDeleteTemplate:A,forceUpdateOnMount:C,customUpdateTrigger:O,bulkActionBarComponent:N,...R}=e;const w=(0,y.useRef)(a),_=(0,y.useRef)(m),P=((e,t,r)=>(0,y.useMemo)((()=>{const{attributes:n,stages:a}=e,o=r&&a.get(r),i=n.some((e=>e.displayInReports)),s=[...q6(i),...X6(n,t)];return r&&o?s.concat([...K6(o),...Q6(o)]):s}),[t,e,r]))(r,f,a),k=UL(c,P),D=((e,t)=>{let{enrollment:{enrollmentDateLabel:r,incidentDateLabel:a,showIncidentDate:o},stages:i}=e;return(0,y.useMemo)((()=>{const e=!t&&Array.from(i.values()).find((e=>e.enableUserAssignment));return[{id:K3,type:it.CO.TEXT,header:n.A.t("Enrollment status"),options:[{text:n.A.t("Active"),value:"ACTIVE"},{text:n.A.t("Completed"),value:"COMPLETED"},{text:n.A.t("Cancelled"),value:"CANCELLED"}],transformRecordsFilter:e=>({programStatus:e.split(":")[1]})},{id:Q3,type:it.CO.DATE,header:r,transformRecordsFilter:e=>{const t={},r=e.split(":"),n=r.indexOf("ge"),a=r.indexOf("le");return-1!==n&&r[n+1]&&(t.enrollmentEnrolledAfter=r[n+1]),-1!==a&&r[a+1]&&(t.enrollmentEnrolledBefore=r[a+1]),t}},...o?[{id:X3,type:it.CO.DATE,header:a,transformRecordsFilter:e=>{const t={},r=e.split(":"),n=r.indexOf("ge"),a=r.indexOf("le");return-1!==n&&r[n+1]&&(t.enrollmentOccurredAfter=r[n+1]),-1!==a&&r[a+1]&&(t.enrollmentOccurredBefore=r[a+1]),t}}]:[],{id:Z3,type:it.CO.BOOLEAN,header:n.A.t("Follow up"),showInMoreFilters:!0,multiValueFilter:!1,transformRecordsFilter:e=>({followUp:e.split(":")[1]})},...e?[{id:J3,type:it.CO.ASSIGNEE,header:n.A.t("Assigned to"),transformRecordsFilter:e=>{const{assignedUser:t,assignedUserMode:r}=e;return{assignedUserMode:r,...t&&{assignedUser:t}}}}]:[]]}),[r,a,o,i,t])})(r,a),U=Z6(r,a),L=(F=null===b||void 0===b?void 0:b.find((e=>e.isDefault&&e.isAltered)),(0,y.useMemo)((()=>[F||{id:"default",isDefault:!0,name:"default",access:{update:!1,delete:!1,write:!1,manage:!1}},{id:"active",name:n.A.t("Active enrollments"),order:1,access:{update:!1,delete:!1,write:!1,manage:!1},criteria:{programStatus:"ACTIVE"}},{id:"complete",name:n.A.t("Completed enrollments"),order:2,access:{update:!1,delete:!1,write:!1,manage:!1},criteria:{programStatus:"COMPLETED"}},{id:"cancelled",name:n.A.t("Cancelled enrollments"),order:3,access:{update:!1,delete:!1,write:!1,manage:!1},criteria:{programStatus:"CANCELLED"}}]),[F]));var F;const x=(null===I||void 0===I?void 0:I.length)>1?I:L,M=jj({initialViewConfig:g,defaultColumns:P,filters:h,columns:k,sortById:E,sortByDirection:v,programStageId:a,isDefaultTemplateAltered:null===b||void 0===b||null===(t=b.find((e=>e.isDefault)))||void 0===t?void 0:t.isAltered});(0,y.useEffect)((()=>{if(M&&a!==w.current){l&&l();const e=`${r.id}-default`;if((e=>{let{currentTemplateId:t,prevTemplateId:r,defaultTemplateId:n,programStageId:a,prevProgramStageId:o}=e;return t!==n&&t===r.current&&(a&&void 0===o.current||void 0===a&&o.current)})({currentTemplateId:m,defaultTemplateId:e,programStageId:a,prevProgramStageId:w,prevTemplateId:_})){const{criteria:t}=z6({filters:h,filtersOnly:D,programStageFiltersOnly:U,columns:k,sortById:E,sortByDirection:v,programId:r.id,programStageId:a});d(e,t)}}_.current=m,w.current=a}),[a,l,M,r,d,h,D,U,k,E,v,m,_]);const V=(0,y.useCallback)((e=>{const{criteria:t,data:n}=z6({filters:h,filtersOnly:D,programStageFiltersOnly:U,columns:k,sortById:E,sortByDirection:v,programId:r.id,programStageId:a});S(e,t,n)}),[S,h,D,U,k,E,v,r.id,a]),j=(0,y.useCallback)((e=>{const{criteria:t,data:n}=z6({filters:h,filtersOnly:D,programStageFiltersOnly:U,columns:k,sortById:E,sortByDirection:v,programId:r.id,programStageId:a});T(e,t,n)}),[T,h,D,U,k,E,v,r.id,a]),G=(0,y.useCallback)((e=>A(e,r.id,a)),[A,r.id,a]);return y.createElement(Vj,r9({},R,{forceUpdateOnMount:C,currentTemplate:n9(x,m),customUpdateTrigger:O,templates:x,columns:k,onAddTemplate:V,onUpdateTemplate:j,onDeleteTemplate:G,filtersOnly:D,additionalFilters:U,dataSource:LL(u,p,k),onLoadView:e9(P,D,U,i),onUpdateList:t9(P,D,U,o),programId:r.id,programStageId:a,rowIdKey:"id",orgUnitId:f,currentViewHasTemplateChanges:M,filters:h,sortById:E,sortByDirection:v,bulkActionBarComponent:N}))},o9=e=>{let{clientConfig:{currentPage:t,rowsPerPage:r,sortById:n,sortByDirection:a,filters:o},context:{programId:i,orgUnitId:s,storeId:l},meta:{columnsMetaForDataFetching:d},filtersOnlyMetaForDataFetching:c}=e;const u=Qj(o,{columns:d,filtersOnly:c,storeId:l,isInit:!0});return{url:"tracker/trackedEntities",queryParams:S6({programId:i,orgUnitId:s,pageSize:r,page:t,sortById:n,sortByDirection:a,filters:u},0,c)}},i9=async e=>{let{dataEngine:t,enrollments:r}=e;return t.mutate({resource:"tracker?async=false&importStrategy=UPDATE&importMode=COMMIT",type:"create",data:()=>({enrollments:r})})},s9=e=>{let{selectedRows:t,programId:r,stages:a,modalIsOpen:o,removeRowsFromSelection:i,onUpdateList:s}=e;const{serverVersion:{minor:l}}=(0,A.UK)(),d=(0,A.ow)(),c=(0,Zo.useQueryClient)(),{show:u}=(0,A.MW)((e=>{let{message:t}=e;return t}),{critical:!0}),p=()=>{c.removeQueries([ei,"WorkingLists","BulkActionBar","CompleteAction","trackedEntities"])},{data:m,isError:g,isLoading:h}=ai(["WorkingLists","BulkActionBar","CompleteAction","trackedEntities",t],{resource:"tracker/trackedEntities",params:()=>{const e=(0,j.L8)(l,j.Gv.newEntityFilterQueryParam);return{program:r,fields:"trackedEntity,enrollments[*,!attributes,!completedBy,!completedAt,!relationships,events[*,!dataValues,!completedAt,!completedBy,!relationships]]",[e?"trackedEntities":"trackedEntity"]:Object.keys(t).join(e?",":";")}}},{enabled:o&&Object.keys(t).length>0,select:e=>{const t=L(U.trackedEntities,e);if(!t)return null;const{activeEnrollments:r,completedEnrollments:n}=t.flatMap((e=>e.enrollments)).reduce(((e,t)=>("ACTIVE"===t.status?e.activeEnrollments.push(t):e.completedEnrollments.push(t),e)),{activeEnrollments:[],completedEnrollments:[]});return{activeEnrollments:r,completedEnrollments:n}}}),{mutate:E,isLoading:v}=(0,Zo.useMutation)((e=>{let{enrollments:t}=e;return i9({dataEngine:d,enrollments:t})}),{onSuccess:()=>{s(),p()},onError:(e,t)=>{p(),u({message:n.A.t("An error occurred when completing the enrollments")}),S().error((0,j.px)("An error occurred when completing enrollments")({serverResponse:e,variables:t}))}}),{mutate:f,isLoading:I,isSuccess:b}=(0,Zo.useMutation)((e=>{let{enrollments:t}=e;return i9({dataEngine:d,enrollments:t})}),{onSuccess:(e,t)=>{let{enrollments:r}=t;const n=r.map((e=>e.trackedEntity));i(n),p(),s(!0)},onError:(e,t)=>{u({message:n.A.t("An error occurred when completing the enrollments")}),S().error((0,j.px)("An error occurred when completing enrollments")({serverResponse:e,variables:t}))}}),{mutate:T,isLoading:C,error:O,reset:N}=(0,Zo.useMutation)((e=>{let{enrollments:t}=e;return(async e=>{let{dataEngine:t,enrollments:r}=e;return t.mutate({resource:"tracker?async=false&importStrategy=UPDATE&importMode=VALIDATE",type:"create",data:()=>({enrollments:r})})})({dataEngine:d,enrollments:t})}),{onSuccess:(e,t)=>{let{enrollments:r}=t;E({enrollments:r})},onError:(e,t)=>{var r,a;let{enrollments:o}=t;const i=null===e||void 0===e||null===(r=e.details)||void 0===r||null===(a=r.validationReport)||void 0===a?void 0:a.errorReports;if(!i)return S().error((0,j.px)("An unknown error occurred when completing enrollments")({serverResponse:e,enrollments:o})),void u({message:n.A.t("An unknown error occurred when completing enrollments")});const s=((e,t)=>{const r=new Set;return t.forEach((t=>{if("ENROLLMENT"===t.trackerType)r.add(t.uid);else if("EVENT"===t.trackerType){const n=e.find((e=>e.events.some((e=>e.event===t.uid))));n&&r.add(n.enrollment)}})),e.filter((e=>!r.has(e.enrollment)))})(o,i);0!==s.length&&f({enrollments:s})}}),R=(0,y.useMemo)((()=>{var e,t,r,n;return{active:null!==(e=null===m||void 0===m||null===(t=m.activeEnrollments)||void 0===t?void 0:t.length)&&void 0!==e?e:0,completed:null!==(r=null===m||void 0===m||null===(n=m.completedEnrollments)||void 0===n?void 0:n.length)&&void 0!==r?r:0}}),[m]);(0,y.useEffect)((()=>{o||N()}),[o,N]);return{completeEnrollments:e=>{let{completeEvents:t}=e;const r=((e,t,r)=>{var n;const a=null!==(n=null===e||void 0===e?void 0:e.activeEnrollments)&&void 0!==n?n:[];let o;return o=t?a.map((e=>({...e,status:"COMPLETED",events:e.events.filter((e=>{var t,n,a;const o=null===(t=r.get(e.programStage))||void 0===t||null===(n=t.access)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.write,i="ACTIVE"===e.status;return o&&i})).map((e=>({...e,status:"COMPLETED"})))}))):a.map((e=>({...e,status:"COMPLETED",events:[]}))),o})(m,t,a);T({completeEvents:t,enrollments:r})},enrollmentCounts:R,isLoading:h,isError:g,validationError:O,isCompleting:v||I||C,hasPartiallyUploadedEnrollments:b}},l9={container:{fontSize:"14px",lineHeight:"19px",color:vn.T.grey900,display:"flex",flexDirection:"column",gap:"8px"},spinner:{display:"flex",justifyContent:"center",margin:"20px 0"},errorContainer:{padding:"0px 20px"}},d9=(0,I.withStyles)(l9)((e=>{let{selectedRows:t,programId:r,stages:a,programDataWriteAccess:o,onUpdateList:i,removeRowsFromSelection:s,classes:l}=e;const[d,c]=(0,y.useState)(!1),[u,p]=(0,y.useState)(!0),[m,g]=(0,y.useState)(!1),{completeEnrollments:h,enrollmentCounts:E,isLoading:v,validationError:f,isCompleting:I,hasPartiallyUploadedEnrollments:b,isError:S}=s9({selectedRows:t,programId:r,modalIsOpen:d,stages:a,onUpdateList:i,removeRowsFromSelection:s}),T=()=>{if(!E||v)return y.createElement("div",{className:l.spinner},y.createElement(C.F,null));if(f){var e,t;const r=null===f||void 0===f||null===(e=f.details)||void 0===e||null===(t=e.validationReport)||void 0===t?void 0:t.errorReports;return y.createElement("div",{className:l.container},y.createElement("span",null,b?n.A.t("Some enrollments were completed successfully, but there was an error while completing the rest. Please see the details below."):n.A.t("There was an error while completing the enrollments. Please see the details below.")),y.createElement(Ib,{open:m,onOpen:()=>g(!0),onClose:()=>g(!1),borderless:!0,header:n.A.t("Details (Advanced)")},y.createElement("span",{className:l.errorContainer},y.createElement("ul",null,r?r.map((e=>y.createElement("li",{key:`${e.uid}-${e.errorCode}`},null===e||void 0===e?void 0:e.message))):y.createElement("li",null,n.A.t("An unknown error occurred."))))))}return S?y.createElement("div",{className:l.container},n.A.t("An unexpected error occurred while fetching the enrollments. Please try again.")):0===E.active?y.createElement("div",{className:l.container},n.A.t("There are currently no active enrollments in the selection. All enrollments are already completed or cancelled.")):y.createElement("div",{className:l.container},n.A.t("This action will complete {{count}} active enrollment in your selection.",{count:E.active,defaultValue:"This action will complete {{count}} active enrollment in your selection.",defaultValue_plural:"This action will complete {{count}} active enrollments in your selection."})," ",E.completed>0&&n.A.t("{{count}} enrollment already marked as completed will not be changed.",{count:E.completed,defaultValue:"{{count}} enrollment already marked as completed will not be changed.",defaultValue_plural:"{{count}} enrollments already marked as completed will not be changed."}),y.createElement(FF.S,{label:n.A.t("Mark all events within enrollments as complete"),checked:u,onChange:()=>p((e=>!e))}))};return y.createElement(y.Fragment,null,y.createElement(aI,{enabled:!o,content:n.A.t("You do not have access to bulk complete enrollments")},y.createElement(ra.$,{small:!0,disabled:!o,onClick:()=>c(!0)},n.A.t("Complete enrollments"))),d&&y.createElement(N.a,{onClose:()=>c(!1),loading:v,dataTest:"bulk-complete-enrollments-dialog"},y.createElement(Ip.w,null,f?n.A.t("Error completing enrollments"):n.A.t("Complete enrollments")),y.createElement(R.$,null,y.createElement(T,null)),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{secondary:!0,onClick:()=>c(!1)},n.A.t("Cancel")),!f&&y.createElement(aI,{enabled:0===(null===E||void 0===E?void 0:E.active),content:n.A.t("No active enrollments to complete")},y.createElement(ra.$,{primary:!0,onClick:()=>h({completeEvents:u}),disabled:v||0===(null===E||void 0===E?void 0:E.active),loading:I,dataTest:"bulk-complete-enrollments-confirm-button"},n.A.t("Complete {{count}} enrollment",{count:E.active,defaultValue:"Complete {{count}} enrollment",defaultValue_plural:"Complete {{count}} enrollments"})))))))})),c9=["WorkingLists","BulkActionBar","DeleteEnrollmentsAction","trackedEntities"],u9=(0,I.withStyles)({checkboxButton:{appearance:"none",background:"none",font:"inherit",cursor:"pointer",outline:"inherit",display:"flex",alignItems:"center",width:"100%",padding:"16px",border:"2px solid #E2E8F0",borderRadius:"6px",marginBottom:"8px",transition:"all 0.2s",textAlign:"left",backgroundColor:"white","&:hover":{backgroundColor:"#F7FAFC"},"&.checked":{borderColor:"#38A169"},"&.disabled":{borderColor:"#E2E8F0",backgroundColor:"#F7FAFC",cursor:"not-allowed"}}})((e=>{let{checked:t,id:r,onChange:n,label:a,disabled:o,dataTest:i,classes:s}=e;return y.createElement("button",{type:"button",onClick:()=>n(r),disabled:o,"data-test":i,className:er()(s.checkboxButton,{checked:t,disabled:o}),"aria-checked":t,role:"checkbox"},y.createElement(FF.S,{checked:t,disabled:o}),a)})),p9=(0,I.withStyles)({modalContent:{display:"flex",flexDirection:"column",gap:"10px",fontSize:"16px"},loadingContainer:{display:"flex",justifyContent:"center"}})((e=>{let{selectedRows:t,programId:r,onUpdateList:a,setIsDeleteDialogOpen:o,classes:i}=e;const{deleteEnrollments:s,isDeletingEnrollments:l,enrollmentCounts:d,isLoadingEnrollments:c,statusToDelete:u,updateStatusToDelete:p,numberOfEnrollmentsToDelete:m,isEnrollmentsError:g}=(e=>{let{selectedRows:t,programId:r,onUpdateList:a,setIsDeleteDialogOpen:o}=e;const{serverVersion:{minor:i}}=(0,A.UK)(),s=(0,Zo.useQueryClient)(),[l,d]=(0,y.useState)({active:!0,completed:!0,cancelled:!0}),c=(0,A.ow)(),{show:u}=(0,A.MW)((e=>{let{message:t}=e;return t}),{critical:!0}),p=(0,y.useCallback)((e=>{d((t=>({...t,[e]:!t[e]})))}),[]),{data:m,isLoading:g,isError:h}=ai([...c9,t],{resource:"tracker/trackedEntities",params:()=>{const e=(0,j.L8)(i,j.Gv.newEntityFilterQueryParam);return{fields:"trackedEntity,enrollments[enrollment,program,status]",[e?"trackedEntities":"trackedEntity"]:Object.keys(t).join(e?",":";"),program:r}}},{enabled:Object.keys(t).length>0,select:e=>{const t=L(U.trackedEntities,e);return t?t.flatMap((e=>e.enrollments)):[]}}),{mutate:E,isLoading:v}=(0,Zo.useMutation)((()=>c.mutate({resource:"tracker?async=false&importStrategy=DELETE",type:"create",data:{enrollments:m.filter((e=>{let{status:t}=e;return t&&l[t.toLowerCase()]})).map((e=>{let{enrollment:t}=e;return{enrollment:t}}))}})),{onError:e=>{S().error((0,j.px)("An error occurred when deleting enrollments")({error:e})),u({message:n.A.t("An error occurred when deleting enrollments")})},onSuccess:()=>{s.removeQueries([ei,...c9]),a(),o(!1)}}),f=(0,y.useMemo)((()=>{if(!m)return null;const{activeEnrollments:e,completedEnrollments:t,cancelledEnrollments:r}=m.reduce(((e,t)=>("ACTIVE"===t.status?e.activeEnrollments+=1:"CANCELLED"===t.status?e.cancelledEnrollments+=1:e.completedEnrollments+=1,e)),{activeEnrollments:0,completedEnrollments:0,cancelledEnrollments:0});return{active:e,completed:t,cancelled:r,total:m.length}}),[m]),I=(0,y.useMemo)((()=>{if(!m||!f)return 0;let e=0;return l.active&&(e+=f.active),l.completed&&(e+=f.completed),l.cancelled&&(e+=f.cancelled),e}),[m,f,l]);return{deleteEnrollments:E,isDeletingEnrollments:v,isLoadingEnrollments:g,isEnrollmentsError:h,enrollmentCounts:f,statusToDelete:l,updateStatusToDelete:p,numberOfEnrollmentsToDelete:I}})({selectedRows:t,programId:r,onUpdateList:a,setIsDeleteDialogOpen:o});return g?y.createElement(N.a,{onClose:()=>o(!1),small:!0},y.createElement(Ip.w,null,n.A.t("Delete selected enrollments")),y.createElement(R.$,null,y.createElement("div",{className:i.modalContent},n.A.t("An error occurred while loading the selected enrollments. Please try again."))),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{secondary:!0,onClick:()=>o(!1)},n.A.t("Cancel"))))):c||!d?y.createElement(N.a,{onClose:()=>o(!1)},y.createElement(Ip.w,null,n.A.t("Delete selected enrollments")),y.createElement(R.$,null,y.createElement("span",{className:i.loadingContainer},y.createElement(C.F,null))),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{secondary:!0,onClick:()=>o(!1)},n.A.t("Cancel"))))):y.createElement(N.a,{onClose:()=>o(!1),dataTest:"bulk-delete-enrollments-dialog"},y.createElement(Ip.w,null,n.A.t("Delete selected enrollments")),y.createElement(R.$,null,y.createElement("div",{className:i.modalContent},y.createElement("div",null,n.A.t("This action will permanently delete the selected enrollments, including all associated data and events.")),y.createElement("div",null,n.A.t("Please select which enrollment statuses you want to delete:")),y.createElement("div",null,y.createElement(u9,{disabled:0===d.active,label:n.A.t("Active enrollments ({{count}})",{count:d.active}),id:"active",checked:0!==d.active&&u.active,onChange:p,dataTest:"bulk-delete-enrollments-active-checkbox"}),y.createElement(u9,{disabled:0===d.completed,label:n.A.t("Completed enrollments ({{count}})",{count:d.completed}),id:"completed",checked:0!==d.completed&&u.completed,onChange:p,dataTest:"bulk-delete-enrollments-completed-checkbox"}),y.createElement(u9,{disabled:0===d.cancelled,label:n.A.t("Cancelled enrollments ({{count}})",{count:d.cancelled}),id:"cancelled",onChange:p,checked:0!==d.cancelled&&u.cancelled,dataTest:"bulk-delete-enrollments-cancelled-checkbox"})))),y.createElement(ta.N,null,y.createElement(Nf.v,null,y.createElement(ra.$,{secondary:!0,onClick:()=>o(!1)},n.A.t("Cancel")),y.createElement(ra.$,{destructive:!0,onClick:s,disabled:l||0===m},n.A.t("Delete {{count}} enrollment",{count:m,defaultValue:"Delete {{count}} enrollment",defaultValue_plural:"Delete {{count}} enrollments"})))))})),m9=e=>{let{selectedRows:t,programDataWriteAccess:r,programId:a,onUpdateList:o}=e;const[i,s]=(0,y.useState)(!1),{hasAuthority:l}=(e=>{let{authority:t}=e;const r={select:e=>{let{authorities:r}=e;return r&&r.some((e=>"ALL"===e||e===t))}},{data:n}=ni(["authorities"],{resource:"me.json",params:{fields:"authorities"}},r);return{hasAuthority:Boolean(n)}})({authority:"F_ENROLLMENT_CASCADE_DELETE"});return l?y.createElement(y.Fragment,null,y.createElement(aI,{enabled:!r,content:n.A.t("You do not have access to delete enrollments")},y.createElement(ra.$,{small:!0,disabled:!r,onClick:()=>s(!0)},n.A.t("Delete enrollments"))),i&&y.createElement(p9,{selectedRows:t,programId:a,onUpdateList:o,setIsDeleteDialogOpen:s})):null},g9=e=>{let{selectedRows:t,programId:r,stages:n,programDataWriteAccess:a,onClearSelection:o,onUpdateList:i,removeRowsFromSelection:s}=e;const l=Object.keys(t).length;return l?y.createElement(FG,{selectedRowsCount:l,onClearSelection:o},y.createElement(d9,{programId:r,programDataWriteAccess:a,selectedRows:t,stages:n,onUpdateList:i,removeRowsFromSelection:s}),y.createElement(m9,{selectedRows:t,programDataWriteAccess:a,programId:r,onUpdateList:i})):null};function h9(){return h9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h9.apply(this,arguments)}const E9=e=>{let{programStageId:t,stages:r,programDataWriteAccess:n,programId:a,...o}=e;if(t){const e=r.get(t);if(!e)throw S().error((0,j.px)("Program stage not found")({programStageId:t,stages:r})),new Error("Program stage not found");return y.createElement(GG,h9({stage:e},o))}return y.createElement(g9,h9({programId:a,stages:r,programDataWriteAccess:n},o))};function y9(){return y9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y9.apply(this,arguments)}const v9=e=>{let{onLoadView:t,onUpdateList:r,storeId:a,program:o,programStageId:i,orgUnitId:s,recordsOrder:l,...d}=e;const[c,u]=(0,y.useState)(),{selectedRows:p,clearSelection:m,selectAllRows:g,selectionInProgress:h,toggleRowSelected:E,allRowsAreSelected:v,removeRowsFromSelection:f}=xG({recordIds:l}),I=(0,j.iT)(j.Gv.trackedEntitiesCSV),b=(0,gs.d4)((e=>{let{workingLists:t}=e;return t[a]&&t[a].currentRequest})),S=(0,A.ow)(),[T,C]=(0,y.useState)(!1),O=(0,y.useMemo)((()=>i||!s?[]:[{key:"downloadData",clickHandler:()=>C(!0),element:n.A.t("Download data...")}]),[C,i,s]),N=(0,y.useCallback)((()=>{C(!1)}),[C]),R=(0,y.useCallback)((async(e,r,n)=>{const{columnsMetaForDataFetching:o,filtersOnlyMetaForDataFetching:i}=n,s=D(S.query.bind(S)),l=await $6(e,o,s),d=o9({clientConfig:l,context:{programId:r.programId,orgUnitId:r.orgUnitId,storeId:a},meta:{columnsMetaForDataFetching:o},filtersOnlyMetaForDataFetching:i});return t(e,{...r,currentRequest:d},n)}),[t,S,a]),w=(0,y.useCallback)(((e,t)=>{const{lastTransaction:n,columnsMetaForDataFetching:o,filtersOnlyMetaForDataFetching:i}=t,s=o9({clientConfig:e,context:{programId:e.programId,orgUnitId:e.orgUnitId,storeId:a},meta:{columnsMetaForDataFetching:o},filtersOnlyMetaForDataFetching:i});return r(e,{...t,currentRequest:s},n)}),[r,a]),_=(0,y.useCallback)((e=>{const t=(0,yc.A)();u(t),!e&&m()}),[m]),P=(0,y.useMemo)((()=>y.createElement(E9,{programId:o.id,programDataWriteAccess:o.access.data.write,programStageId:i,stages:o.stages,selectedRows:p,onClearSelection:m,onUpdateList:_,removeRowsFromSelection:f})),[o,i,p,m,_,f]);return y.createElement(y.Fragment,null,y.createElement(a9,y9({},d,{customUpdateTrigger:c,program:o,orgUnitId:s,recordsOrder:l,programStageId:i,customListViewMenuContents:O,onLoadView:R,onUpdateList:w,selectedRows:p,allRowsAreSelected:v,selectionInProgress:h,onSelectAll:g,onRowSelect:E,bulkActionBarComponent:P})),y.createElement(Zj,{open:T,onClose:N,request:b,hasCSVSupport:I}))};function f9(){return f9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f9.apply(this,arguments)}const I9=e=>{var t,r;let{storeId:n,programId:a,orgUnitId:o,selectedTemplateId:i,onChangeTemplate:s}=e;const l=nJ(a),d=(()=>{const e=(0,gs.d4)((e=>{let{workingListsTemplates:t}=e;return t.teiList}));return e&&e.templates})(),c=(0,T.W6)(),u=Y6(a),{lastTransaction:p,lastTransactionOnListDataRefresh:m,listDataRefreshTimestamp:g,records:h,onSelectTemplate:E,onAddTemplate:v,onDeleteTemplate:f,onUpdateDefaultTemplate:I,programStage:b,currentTemplateId:S,viewPreloaded:A,...C}=kL(n,z3,l),O=(0,gs.wA)(),N=$()().diff($()(g||0),"minutes")>5||p!==m,R=(0,y.useCallback)((()=>{O(hL(a,n,z3,i))}),[O,a,n,i]);(0,y.useEffect)((()=>{i&&i!==S&&!A&&E&&E(i)}),[i,A,S,E]);const w=(0,y.useCallback)((e=>{var t;let{id:r}=e;const n=h[r],i=o||(null===(t=n.orgUnit)||void 0===t?void 0:t.id)||n.programOwner;return b?c.push(`/enrollmentEventEdit?${Is({eventId:r,orgUnitId:i})}`):O(iO({teiId:r,programId:a,orgUnitId:i}))}),[O,o,a,h,b,c]),_=(0,y.useCallback)(((e,t)=>{I({...u,criteria:t,isAltered:!0}),E(e,null===t||void 0===t?void 0:t.programStage),e&&s&&s(e)}),[s,E,I,u]),P=(0,y.useCallback)((e=>{I(u),E(e),e&&s&&s(e)}),[s,E,I,u]),k=(0,y.useCallback)(((e,t,r)=>v(e,t,r,{onChangeTemplate:s})),[v,s]),D=(0,y.useCallback)(((e,t,r)=>f(e,t,r,{onChangeTemplate:s})),[f,s]),U=b?null===(t=Xj[n])||void 0===t?void 0:t.programStageWorkingList:null===(r=Xj[n])||void 0===r?void 0:r.tei;return y.createElement(v9,f9({},C,{forceUpdateOnMount:N,currentTemplateId:S,viewPreloaded:A,templateSharingType:U,onClickListRow:w,onLoadTemplates:R,program:l,programStageId:b,records:h,orgUnitId:o,apiTemplates:d,onSelectTemplate:P,onPreserveCurrentViewState:_,onAddTemplate:k,onDeleteTemplate:D,storeId:n}))};function b9(){return b9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},b9.apply(this,arguments)}const S9=(0,I.withStyles)((()=>({listContainer:{padding:yn.Q.dp16,background:vn.T.white,border:"1px solid",borderColor:vn.T.grey400,borderRadius:3}})))((e=>{let{classes:{listContainer:t},...r}=e;return y.createElement("div",{"data-test":"tei-working-lists"},y.createElement("div",{className:t},y.createElement(I9,b9({storeId:"teiList"},r))))}));var T9=r(80991);var A9=r(56442);const C9=e=>{const{fetchStatus:t}=e.value.enrollmentPage;return t.enrollmentId===Y4},O9=e=>{const{teiId:t,fetchStatus:r}=e.value.enrollmentPage;return t&&r.teiId===Y4},N9=e=>{let{linkMode:t,linkedEventId:r,linkedOrgUnitId:n,history:a}=e;if(t&&r&&t===$k.ENTER_DATA){return{navigate:()=>a.push(`/enrollmentEventEdit?${Is({eventId:r,orgUnitId:n})}`)}}return{}},R9=(0,t3.E)(((e,t)=>e.pipe((0,i.g)(fW),(0,mf.p)((e=>{let{payload:{orgUnitId:r}}=e;return((e,t)=>{if(!t)return!1;const r=td.J.get(t);return!r||!r.organisationUnits||!r.organisationUnits[e]})(r,t.value.currentSelections.programId)})),(0,s.T)((()=>uf())))),((e,t)=>e.pipe((0,i.g)(f4,vD.CATEGORY_OPTION_SET,S4,gD.FROM_URL_CURRENT_SELECTIONS_VALID,uD,pD,mD),(0,mf.p)((()=>{const e=R5();return w5(e.substring(1))})),(0,s.T)((e=>((e,t)=>l(cD)({isComplete:e,triggeringActionType:t}))((e=>{if(!e.orgUnitId||!e.programId||e.categoryCheckInProgress)return!1;const t=e.programId&&td.J.get(e.programId);if(t&&t.categoryCombination&&Array.from(t.categoryCombination.categories.values()).some((t=>!e.categories||!e.categories[t.id])))return!1;return!0})(t.value.currentSelections),e.payload&&e.payload.triggeringActionType||e.type))))),(e=>e.pipe((0,i.g)(g),(0,s.T)((()=>l(c)())))),(e=>e.pipe((0,i.g)(c),(0,s.T)((()=>{return e={headerBarHeight:48},l(h)(e);var e})))),((e,t,r)=>{let{absoluteApiPath:a,querySingleResource:o}=r;return e.pipe((0,i.g)(qU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===mG})),(0,Rc.H)((t=>{const{selectedTemplate:r,columnsMetaForDataFetching:s,categoryCombinationId:l,storeId:d}=t.payload,{programId:c,orgUnitId:u,categories:p,lastTransaction:m,programStageId:g}=t.payload.context,h=(async(e,t,r,a)=>{const{commonQueryData:o,columnsMetaForDataFetching:i,categoryCombinationId:s,storeId:l,lastTransaction:d}=t,c=await bG(e,i,a),{currentPage:u,rowsPerPage:p,sortById:m,sortByDirection:g,filters:h}=c,E={currentPage:u,rowsPerPage:p,sortById:m,sortByDirection:g,filters:Qj(h,{columns:i,storeId:l,isInit:!0}),fields:"dataValues,occurredAt,event,status,orgUnit,program,programType,updatedAt,createdAt,assignedUser,",...o};return mB({queryArgs:E,columnsMetaForDataFetching:i,categoryCombinationId:s,absoluteApiPath:r,querySingleResource:a}).then((e=>{let{eventContainers:t,pagingData:r,request:n}=e;return AL(l,{recordContainers:t,pagingData:r,request:n,config:{...c,selections:{...o,lastTransaction:d}}})})).catch((e=>(S().error((0,j.px)(bB)({error:e})),CL(l,n.A.t("Working list could not be loaded")))))})(r.nextCriteria||r.criteria,{commonQueryData:{programId:c,orgUnitId:u,categories:p,programStageId:g,ouMode:u?"SELECTED":"ACCESSIBLE"},columnsMetaForDataFetching:s,categoryCombinationId:l,storeId:d,lastTransaction:m},a,o);return(0,ZC.H)(h).pipe((0,Y_.Q)(e.pipe((0,i.g)(XU),(0,mf.p)((e=>e.payload.storeId===d)))))})))}),((e,t,r)=>{let{querySingleResource:a,absoluteApiPath:o}=r;return e.pipe((0,i.g)(qU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===z3})),(0,Rc.H)((t=>{const{storeId:r,columnsMetaForDataFetching:s,filtersOnlyMetaForDataFetching:l,selectedTemplate:d}=t.payload,{programId:c,orgUnitId:u}=t.payload.context;return(0,ZC.H)((async e=>{var t;let{programId:r,orgUnitId:a,storeId:o,selectedTemplate:i,columnsMetaForDataFetching:s,filtersOnlyMetaForDataFetching:l,querySingleResource:d,absoluteApiPath:c}=e;const u=await $6(i,s,d),{currentPage:p,rowsPerPage:m,sortById:g,sortByDirection:h,filters:E,customColumnOrder:y}=u,v=Qj(E,{columns:s,filtersOnly:l,storeId:o,isInit:!0}),f={programId:r,orgUnitId:a,pageSize:m,page:p,sortById:g,sortByDirection:h,filters:v},I={columnsMetaForDataFetching:s,filtersOnlyMetaForDataFetching:l,querySingleResource:d,absoluteApiPath:c},b=null===i||void 0===i||null===(t=i.criteria)||void 0===t?void 0:t.programStage;return(b?R6({...f,programStageId:b},I):T6(f,I)).then((e=>{let{recordContainers:t,request:n}=e;return AL(o,{recordContainers:t,pagingData:{rowsPerPage:m,currentPage:p},request:n,config:{sortById:g,sortByDirection:h,filters:E,selections:{programId:r,orgUnitId:a},customColumnOrder:y},context:{programStageId:b}})})).catch((e=>(S().error((0,j.px)("An error occurred when initializing the working list view")({error:e})),CL(o,n.A.t("Working list could not be loaded")))))})({programId:c,orgUnitId:u,storeId:r,selectedTemplate:d,columnsMetaForDataFetching:s,filtersOnlyMetaForDataFetching:l,querySingleResource:a,absoluteApiPath:o})).pipe((0,Y_.Q)(e.pipe((0,i.g)(XU),(0,mf.p)((e=>e.payload.storeId===r)))))})))}),((e,t,r)=>{let{querySingleResource:a,absoluteApiPath:o}=r;return e.pipe((0,i.g)(JU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===z3})),(0,Rc.H)((t=>{const{storeId:r,columnsMetaForDataFetching:s,filtersOnlyMetaForDataFetching:l,queryArgs:d}=t.payload,{currentPage:c,rowsPerPage:u,programId:p,programStageId:m,orgUnitId:g,filters:h,sortById:E,sortByDirection:y}=d;return(0,ZC.H)((e=>{let{page:t,pageSize:r,programId:a,programStageId:o,orgUnitId:i,sortById:s,sortByDirection:l,storeId:d,filters:c,columnsMetaForDataFetching:u,filtersOnlyMetaForDataFetching:p,querySingleResource:m,absoluteApiPath:g}=e;const h={programId:a,orgUnitId:i,pageSize:r,page:t,filters:Qj(c,{columns:u,filtersOnly:p,storeId:d}),sortById:s,sortByDirection:l},E={columnsMetaForDataFetching:u,filtersOnlyMetaForDataFetching:p,querySingleResource:m,absoluteApiPath:g};return(o?R6({...h,programStageId:o},E):T6(h,E)).then((e=>{let{recordContainers:t,request:r}=e;return OL(d,{recordContainers:t,request:r})})).catch((e=>(S().error((0,j.px)("An error occurred when updating the working list records")({error:e})),NL(d,n.A.t("Working list could not be updated")))))})({page:c,pageSize:u,programId:p,programStageId:m,orgUnitId:g,filters:h,sortById:E,sortByDirection:y,storeId:r,columnsMetaForDataFetching:s,filtersOnlyMetaForDataFetching:l,querySingleResource:a,absoluteApiPath:o})).pipe((0,Y_.Q)(e.pipe((0,i.g)(tL),(0,mf.p)((e=>e.payload.storeId===r)))))})))}),(e=>e.pipe((0,i.g)(qH),(0,mf.p)((e=>e.payload.findMode&&"TEI_SEARCH"===e.payload.findMode)),(0,s.T)((e=>{const{relationshipConstraint:t}=e.payload,{trackedEntityTypeId:r,programId:n}=t,a=n||r,o=qP(r,n),i=o?o.map(((e,t)=>My(Oq(Nq,a,t.toString()),{}))):[];return(0,Xd.OJ)([...i,WP(Nq,n,r)],KH)})))),(e=>e.pipe((0,i.g)(qH),(0,mf.p)((e=>e.payload.findMode&&e.payload.findMode===G_)),(0,JC.n)((e=>{const{relationshipConstraint:t,orgUnit:r}=e.payload,{programId:a}=t;let o;if(a)try{o=function(e){let t;try{const r=(0,it.x6)(e);r.access.data.write&&(t=r)}catch(r){throw S().error((0,j.px)("tracker program for id not found")({suggestedProgramId:e,error:r})),Error((0,n.A)("Metadata error. see log for details"))}return t}(a)}catch(i){return Promise.resolve((e=>l(Iq)({errorMessage:e}))(i))}return r?(0,eO.of)(bq(a,r)):Promise.resolve(bq(o&&o.id))})))),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(JU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===mG})),(0,Rc.H)((t=>{const{queryArgs:r,columnsMetaForDataFetching:o,categoryCombinationId:s,storeId:l,queryArgs:{programId:d,orgUnitId:c,programStageId:u,categories:p}}=t.payload;(null===r||void 0===r||!r.orgUnitId)&&(r.ouMode="ACCESSIBLE");const m=((e,t,r,n)=>{let{columnsMetaForDataFetching:a,categoryCombinationId:o,storeId:i,commonQueryData:s}=t;const l={...e,fields:"dataValues,occurredAt,event,status,orgUnit,program,programType,updatedAt,createdAt,assignedUser",filters:Qj(e.filters,{columns:a,storeId:i}),...s};return mB({queryArgs:l,columnsMetaForDataFetching:a,categoryCombinationId:o,absoluteApiPath:r,querySingleResource:n}).then((e=>{let{eventContainers:t,pagingData:r,request:n}=e;return OL(i,{recordContainers:t,pagingData:r,request:n})})).catch((e=>(S().error((0,j.px)(SB)({error:e})),NL(i,SB))))})(r,{commonQueryData:{programId:d,orgUnitId:c,categories:p,programStageId:u,ouMode:c?"SELECTED":"ACCESSIBLE"},columnsMetaForDataFetching:o,categoryCombinationId:s,storeId:l},n,a);return(0,ZC.H)(m).pipe((0,Y_.Q)(e.pipe((0,i.g)(tL),(0,mf.p)((e=>e.payload.storeId===l)))),(0,Y_.Q)(e.pipe((0,i.g)(XU),(0,mf.p)((e=>e.payload.storeId===l)))))})))}),((e,t,r)=>{let{querySingleResource:a}=r;return e.pipe((0,i.g)(DU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===mG})),(0,Rc.H)((t=>{let{payload:{storeId:r,programId:o}}=t;const s=((e,t)=>(async(e,t)=>{const r=await t({resource:"eventFilters",params:{filter:`program:eq:${e}`,fields:"id,displayName,eventQueryCriteria,access,externalAccess,publicAccess,user[id,username],userAccesses[id,access],userGroupAccesses[id,access]"}});return(r&&r.eventFilters?r.eventFilters:[]).map((e=>{let{id:t,displayName:r,eventQueryCriteria:n,access:a,externalAccess:o,publicAccess:i,user:s,userAccesses:l,userGroupAccesses:d}=e;return{id:t,name:r,eventQueryCriteria:n,access:a,externalAccess:o,publicAccess:i,user:s,userAccesses:l,userGroupAccesses:d}}))})(e,t).then((t=>{const r={id:`${e}-default`,isDefault:!0,name:"default",access:{update:!1,delete:!1,write:!1,manage:!1}};return{templates:[r,...t.map((e=>{const{displayColumnOrder:t,order:r,eventDate:n}=e.eventQueryCriteria,a={...e.eventQueryCriteria,displayColumnOrder:null===t||void 0===t?void 0:t.map((e=>"eventDate"===e?"occurredAt":e)),order:null!==r&&void 0!==r&&r.includes("eventDate")?r.replace("eventDate","occurredAt"):r,occurredAt:n};return{...e,criteria:a,eventQueryCriteria:void 0}}))],defaultTemplateId:r.id}})))(o,a).then((e=>{let{templates:t,defaultTemplateId:n}=e;return EL(t,n,r)})).catch((e=>(S().error((0,j.px)(e)({epic:"retrieveTemplatesEpic"})),yL(n.A.t("an error occurred loading working lists"),r))));return(0,ZC.H)(s).pipe((0,Y_.Q)(e.pipe((0,i.g)(FU),(0,mf.p)((e=>e.payload.storeId===r)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(WU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===mG})),(0,Rc.H)((r=>{let{payload:{template:{id:a,name:o,externalAccess:s,publicAccess:l,user:d,userGroupAccesses:c,userAccesses:u},criteria:p,programId:m,storeId:g}}=r;const h={name:o,program:m,eventQueryCriteria:p,externalAccess:s,publicAccess:l,user:d,userGroupAccesses:c,userAccesses:u},E=n({resource:"eventFilters",id:a,data:h,type:"replace"}).then((()=>{const e=t.value.workingListsTemplates[g].selectedTemplateId===a;return vL(a,p,{storeId:g,isActiveTemplate:e})})).catch((e=>{S().error((0,j.px)("could not update template")({error:e,eventFilterData:h}));const r=t.value.workingListsTemplates[g].selectedTemplateId===a;return fL(a,p,{storeId:g,isActiveTemplate:r})}));return(0,ZC.H)(E).pipe((0,Y_.Q)(e.pipe((0,i.g)(WU),(0,mf.p)((e=>e.payload.template.id===a)))),(0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===g)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(MU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===mG})),(0,Rc.H)((r=>{const{name:a,criteria:o,clientId:s,programId:l,storeId:d}=r.payload,c={name:a,program:l,eventQueryCriteria:o},u=n({resource:"eventFilters",type:"create",data:c}).then((e=>{const r=t.value.workingListsTemplates[d].selectedTemplateId===s;return IL(e.response.uid,s,{storeId:d,isActiveTemplate:r})})).catch((e=>{S().error((0,j.px)("could not add template")({error:e,eventFilterData:c}));const r=t.value.workingListsTemplates[d].selectedTemplateId===s;return bL(s,{storeId:d,isActiveTemplate:r})}));return(0,ZC.H)(u).pipe((0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===d)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(GU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===mG})),(0,Rc.H)((t=>{let{payload:{template:r,storeId:a}}=t;const o=n({resource:"eventFilters",id:r.id,type:"delete"}).then((()=>SL(r,a))).catch((e=>(S().error((0,j.px)("could not delete template")({error:e,template:r})),TL(r,a))));return(0,ZC.H)(o).pipe((0,Y_.Q)(e.pipe((0,i.g)(GU),(0,mf.p)((e=>e.payload.template.id===r.id)))),(0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===a)))))})))}),((e,t,r)=>{let{querySingleResource:a,serverVersion:{minor:o}}=r;return e.pipe((0,i.g)(DU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===z3&&!(0,j.L8)(o,j.Gv.storeProgramStageWorkingList)})),(0,Rc.H)((t=>{let{payload:{storeId:r,programId:o,selectedTemplateId:s}}=t;const l=H6(o,a).then((e=>{let{templates:t,defaultTemplateId:n}=e;return EL(t,s||n,r)})).catch((e=>(S().error((0,j.px)(e)({epic:"retrieveTEITemplatesEpic"})),yL(n.A.t("an error occurred loading Tracked entity instance lists"),r))));return(0,ZC.H)(l).pipe((0,Y_.Q)(e.pipe((0,i.g)(FU),(0,mf.p)((e=>e.payload.storeId===r)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(WU),(0,mf.p)((e=>{let{payload:{workingListsType:t,programStage:r}}=e;return t===z3&&!r.id})),(0,Rc.H)((r=>{const{template:{id:a,name:o,externalAccess:s,publicAccess:l,user:d,userGroupAccesses:c,userAccesses:u},program:p,storeId:m,criteria:g}=r.payload,{programStatus:h,enrolledAt:E,occurredAt:y,attributeValueFilters:v,order:f,displayColumnOrder:I,assignedUserMode:b,assignedUsers:T,followUp:A}=g,C={name:o,program:p,externalAccess:s,publicAccess:l,user:d,userGroupAccesses:c,userAccesses:u,entityQueryCriteria:{displayColumnOrder:I,order:f,...b&&{assignedUserMode:b},...(null===T||void 0===T?void 0:T.length)>0&&{assignedUsers:T},...void 0!==A&&{followUp:JSON.stringify(A)},...h&&{enrollmentStatus:h},...E&&{enrollmentCreatedDate:E},...y&&{enrollmentIncidentDate:y},...(null===v||void 0===v?void 0:v.length)>0&&{attributeValueFilters:v}}},O=n({resource:"trackedEntityInstanceFilters",id:a,type:"replace",data:C}).then((()=>{const e=t.value.workingListsTemplates[m].selectedTemplateId===a;return vL(a,g,{storeId:m,isActiveTemplate:e})})).catch((e=>{S().error((0,j.px)("could not update template")({error:e,trackedEntityInstanceFilters:C}));const r=t.value.workingListsTemplates[m].selectedTemplateId===a;return fL(a,g,{storeId:m,isActiveTemplate:r})}));return(0,ZC.H)(O).pipe((0,Y_.Q)(e.pipe((0,i.g)(WU),(0,mf.p)((e=>e.payload.template.id===a)))),(0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===m)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(MU),(0,mf.p)((e=>{let{payload:{workingListsType:t,programStage:r}}=e;return t===z3&&!r.id})),(0,Rc.H)((r=>{const{name:a,program:o,storeId:s,clientId:l,criteria:{programStatus:d,enrolledAt:c,occurredAt:u,attributeValueFilters:p,order:m,followUp:g,displayColumnOrder:h,assignedUserMode:E,assignedUsers:y},callBacks:{onChangeTemplate:v}}=r.payload,f={name:a,program:o,entityQueryCriteria:{displayColumnOrder:h,order:m,...E&&{assignedUserMode:E},...(null===y||void 0===y?void 0:y.length)>0&&{assignedUsers:y},...d&&{enrollmentStatus:d},...void 0!==g&&{followUp:JSON.stringify(g)},...c&&{enrollmentCreatedDate:c},...u&&{enrollmentIncidentDate:u},...(null===p||void 0===p?void 0:p.length)>0&&{attributeValueFilters:p}}},I=n({resource:"trackedEntityInstanceFilters",type:"create",data:f}).then((e=>{const r=t.value.workingListsTemplates[s].selectedTemplateId===l;return v&&v(e.response.uid),(0,Xd.OJ)([IL(e.response.uid,l,{storeId:s,isActiveTemplate:r}),RL(Y6(o.id),s)],kU)})).catch((e=>{S().error((0,j.px)("could not add template")({error:e,trackedEntityInstanceFilters:f}));const r=t.value.workingListsTemplates[s].selectedTemplateId===l;return bL(l,{storeId:s,isActiveTemplate:r})}));return(0,ZC.H)(I).pipe((0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===s)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(GU),(0,mf.p)((e=>{let{payload:{workingListsType:t,programStageId:r}}=e;return t===z3&&!r})),(0,Rc.H)((t=>{let{payload:{template:r,storeId:a,callBacks:{onChangeTemplate:o}}}=t;const s=n({resource:"trackedEntityInstanceFilters",id:r.id,type:"delete"}).then((()=>{const{programId:e}=fs();return o&&o(`${e}-default`),SL(r,a)})).catch((e=>(S().error((0,j.px)("could not delete template")({error:e,template:r})),TL(r,a))));return(0,ZC.H)(s).pipe((0,Y_.Q)(e.pipe((0,i.g)(GU),(0,mf.p)((e=>e.payload.template.id===r.id)))),(0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===a)))))})))}),((e,t,r)=>{let{querySingleResource:a,serverVersion:{minor:o}}=r;return e.pipe((0,i.g)(DU),(0,mf.p)((e=>{let{payload:{workingListsType:t}}=e;return t===z3&&(0,j.L8)(o,j.Gv.storeProgramStageWorkingList)})),(0,Rc.H)((t=>{let{payload:{storeId:r,programId:o,selectedTemplateId:s}}=t;const l=Promise.all([H6(o,a),W6(o,a)]).then((e=>{const{templates:t,defaultTemplateId:n}=((e,t)=>{const r=(null===e||void 0===e?void 0:e.find((e=>e.id===r6)))||{},n=(null===e||void 0===e?void 0:e.find((e=>e.id===t6)))||{};return{templates:(e=>e.reduce(((e,t)=>t.isDefault&&e.find((e=>e.isDefault))?e:[...e,t]),[]))([...n.templates,...r.templates])||[],defaultTemplateId:t||n.defaultTemplateId||r.defaultTemplateId}})(e,s);return EL(t,n,r)})).catch((e=>(S().error((0,j.px)(e)({epic:"retrieveTemplatesEpic"})),yL(n.A.t("an error occurred loading the working lists"),r))));return(0,ZC.H)(l).pipe((0,Y_.Q)(e.pipe((0,i.g)(FU),(0,mf.p)((e=>e.payload.storeId===r)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(MU),(0,mf.p)((e=>{let{payload:{workingListsType:t,programStage:r}}=e;return t===z3&&r.id})),(0,Rc.H)((r=>{const{name:a,program:o,storeId:s,clientId:l,programStage:d,criteria:{programStatus:c,enrolledAt:u,occurredAt:p,attributeValueFilters:m=[],dataFilters:g=[],order:h,followUp:E,displayColumnOrder:y,assignedUserMode:v,assignedUsers:f,status:I,eventOccurredAt:b,scheduledAt:T},callBacks:{onChangeTemplate:A}}=r.payload,C={name:a,program:o,programStage:d,programStageQueryCriteria:{displayColumnOrder:y,order:h,enrolledAt:u,eventStatus:I,...v&&{assignedUserMode:v},...(null===f||void 0===f?void 0:f.length)>0&&{assignedUsers:f},...void 0!==E&&{followUp:JSON.stringify(E)},...c&&{enrollmentStatus:c},...p&&{enrollmentOccurredAt:p},...b&&{eventOccurredAt:b},...T&&{eventScheduledAt:T},attributeValueFilters:m,dataFilters:g}},O=n({resource:"programStageWorkingLists",type:"create",data:C}).then((e=>{const r=t.value.workingListsTemplates[s].selectedTemplateId===l;return A&&A(e.response.uid),(0,Xd.OJ)([IL(e.response.uid,l,{storeId:s,isActiveTemplate:r}),RL(Y6(o.id),s)],kU)})).catch((e=>{S().error((0,j.px)("could not add template")({error:e,programStageWorkingLists:C}));const r=t.value.workingListsTemplates[s].selectedTemplateId===l;return bL(l,{storeId:s,isActiveTemplate:r})}));return(0,ZC.H)(O).pipe((0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===s)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(WU),(0,mf.p)((e=>{let{payload:{workingListsType:t,programStage:r}}=e;return t===z3&&r.id})),(0,Rc.H)((r=>{const{template:{id:a,name:o,externalAccess:s,publicAccess:l,user:d,userGroupAccesses:c,userAccesses:u},program:p,programStage:m,storeId:g,criteria:h}=r.payload,{programStatus:E,enrolledAt:y,occurredAt:v,attributeValueFilters:f=[],dataFilters:I=[],order:b,followUp:T,displayColumnOrder:A,assignedUserMode:C,assignedUsers:O,status:N,eventOccurredAt:R,scheduledAt:w}=h,_={name:o,program:p,programStage:m,externalAccess:s,publicAccess:l,user:d,userGroupAccesses:c,userAccesses:u,programStageQueryCriteria:{displayColumnOrder:A,order:b,enrolledAt:y,eventStatus:N,...C&&{assignedUserMode:C},...(null===O||void 0===O?void 0:O.length)>0&&{assignedUsers:O},...E&&{enrollmentStatus:E},...v&&{enrollmentOccurredAt:v},...void 0!==T&&{followUp:JSON.stringify(T)},...R&&{eventOccurredAt:R},...w&&{eventScheduledAt:w},attributeValueFilters:f,dataFilters:I}},P=n({resource:"programStageWorkingLists",id:a,type:"replace",data:_}).then((()=>{const e=t.value.workingListsTemplates[g].selectedTemplateId===a;return vL(a,h,{storeId:g,isActiveTemplate:e})})).catch((e=>{S().error((0,j.px)("could not update template")({error:e,programStageWorkingLists:_}));const r=t.value.workingListsTemplates[g].selectedTemplateId===a;return fL(a,h,{storeId:g,isActiveTemplate:r})}));return(0,ZC.H)(P).pipe((0,Y_.Q)(e.pipe((0,i.g)(WU),(0,mf.p)((e=>e.payload.template.id===a)))),(0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===g)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(GU),(0,mf.p)((e=>{let{payload:{workingListsType:t,programStageId:r}}=e;return t===z3&&r})),(0,Rc.H)((t=>{let{payload:{template:r,storeId:a,callBacks:{onChangeTemplate:o}}}=t;const s=n({resource:"programStageWorkingLists",id:r.id,type:"delete"}).then((()=>{const{programId:e}=fs();return o&&o(`${e}-default`),SL(r,a)})).catch((e=>(S().error((0,j.px)("could not delete template")({error:e,template:r})),TL(r,a))));return(0,ZC.H)(s).pipe((0,Y_.Q)(e.pipe((0,i.g)(GU),(0,mf.p)((e=>e.payload.template.id===r.id)))),(0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===a)))))})))}),((e,t,r)=>{let{mutate:n}=r;return e.pipe((0,i.g)(aG),(0,Rc.H)((t=>{const{eventId:r,storeId:a}=t.payload,o=n({resource:"tracker?async=false&importStrategy=DELETE",type:"create",data:()=>({events:[{event:r}]})}).then((()=>((e,t)=>l(tG)({eventId:e,storeId:t}))(r,a))).catch((e=>(S().error((0,j.px)("Could not delete event")({error:e,eventId:r})),l(rG)())));return(0,ZC.H)(o).pipe((0,Y_.Q)(e.pipe((0,i.g)(rL),(0,mf.p)((e=>e.payload.storeId===a)))))})))}),((e,t)=>e.pipe((0,i.g)(cD),(0,mf.p)((()=>{const{app:{page:e}}=t.value;return"new"===e})),(0,mf.p)((e=>{const{programId:r}=t.value.currentSelections;if(!(Nt.Jj.get(r)instanceof it.jV))return!1;const n=e.type,a=e.payload&&e.payload.triggeringActionType;return n!==cD||!!a&&[gD.FROM_URL_CURRENT_SELECTIONS_VALID,vD.CATEGORY_OPTION_SET].includes(a)})),(0,s.T)((()=>t.value.currentSelections.complete?l(hv)():l(Av)())))),(e=>e.pipe((0,i.g)(gv),(0,s.T)((()=>(0,Xd.OJ)(Xk()))))),((e,t)=>e.pipe((0,i.g)(vD.CATEGORY_OPTION_SET,cD),(0,mf.p)((()=>{const{app:{page:e}}=t.value;return"new"===e})),(0,mf.p)((e=>{if(e.type===cD){const t=e.payload&&e.payload.triggeringActionType;if(![gD.FROM_URL_CURRENT_SELECTIONS_VALID].includes(t))return!1}const r=t.value;if(!r.currentSelections.complete)return!1;const n=r.currentSelections.programId;return!((0,it.Ec)(n)instanceof it.rr)})),(0,s.T)((()=>{const e=t.value,r=(0,dD.u)(e.currentSelections.programId),n=[...rD(r.stage),...(a=r.stage.stageForm,a.getElements().map((e=>({id:e.id,visible:e.displayInReports}))))];var a;return((e,t,r,n)=>l(iD)({listId:e,columnOrder:t,meta:r,selections:n}))(YR,n,{sortById:"created",sortByDirection:"desc"},e.currentSelections)})))),((e,t)=>e.pipe((0,i.g)(uv),(0,s.T)((e=>e.payload.find((e=>e.type===Ev)))),(0,s.T)((e=>{const{dataEntryId:r,itemId:n,uid:a,orgUnit:o}=e.payload;return bD(t,r,n,a,o)})))),((e,t)=>e.pipe((0,i.g)(pv),(0,s.T)((e=>e.payload.find((e=>e.type===Ev)))),(0,s.T)((e=>{const{dataEntryId:r,itemId:n,uid:a,orgUnit:o,elementId:i,value:s,uiState:l}=e.payload,d={elementId:i,value:s,valid:l.valid};return bD(t,r,n,a,o,d)})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(yv),(0,s.T)((()=>{const{programId:e,orgUnitId:t}=fs();return n.push(`/?${Is({programId:e,orgUnitId:t})}`),pf()})))}),((e,t,r)=>{let{serverVersion:{minor:n}}=r;return e.pipe((0,i.g)(yv),(0,s.T)((e=>{const r=t.value,a=e.payload,o=yf(a.dataEntryId,a.eventId),i=a.formFoundation,{formClientValues:s,mainDataClientValues:d}=wD(r,o,i);return((e,t,r)=>{const n=vv;return l(n)({selections:r},{offline:{effect:{url:"tracker?async=false",method:oc,data:e},commit:{type:kv,meta:{selections:r,relationshipData:t,triggerAction:n}},rollback:{type:Tv,meta:{selections:r}}}})})(ND(r,i,s,d,n),r.dataEntriesRelationships[o],r.currentSelections)})))}),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(fv),(0,s.T)((()=>{const{programId:e,orgUnitId:t}=fs();return n.push(`/?${Is({programId:e,orgUnitId:t})}`),pf()})))}),((e,t)=>e.pipe((0,i.g)(fv),(0,s.T)((()=>{const e=t.value;if(!e.offline.online)return qv();const r=e.workingListsTemplates.eventList&&e.workingListsTemplates.eventList.currentListId,n=r&&e.workingListsContext[r];if(!n)return Kv();const a=e.currentSelections;if(a.complete&&!of(n,a))return Kv();return Object.keys(e.recentlyAddedEvents).length>0?l(bv)():qv()})))),((e,t,r)=>{let{absoluteApiPath:a,querySingleResource:o}=r;return e.pipe((0,i.g)(HD),(0,JC.n)((e=>{const r=e.payload.eventId,i=e.payload.orgUnit,s=t.value.currentSelections.programId;return oB(r,a,o).then((e=>e?((e,t,r)=>l(zD)({eventContainer:e,orgUnit:t,prevProgramId:r}))(e,i,s):XD(n.A.t("Event could not be loaded. Are you sure it exists?")))).catch((e=>{const{message:t,details:r}=_c(e);return S().error((0,j.px)(t||n.A.t("Event could not be loaded"))(r)),XD(n.A.t("Event could not be loaded. Are you sure it exists?"))}))})))}),((e,t)=>e.pipe((0,i.g)(zB),(0,s.T)((e=>e.payload.find((e=>e.type===XB)))),(0,s.T)((e=>{const{dataEntryId:r,itemId:n,uid:a,orgUnit:o,programId:i}=e.payload;return r3({store:t,dataEntryId:r,itemId:n,uid:a,orgUnit:o,programId:i})})))),((e,t)=>e.pipe((0,i.g)(YB),(0,s.T)((e=>e.payload.find((e=>e.type===XB)))),(0,s.T)((e=>{const{elementId:r,value:n,uiState:a,dataEntryId:o,itemId:i,uid:s,orgUnit:l,programId:d}=e.payload,c={elementId:r,value:n,valid:a.valid};return r3({store:t,dataEntryId:o,itemId:i,uid:s,orgUnit:l,fieldData:c,programId:d})})))),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(Q1),(0,JC.n)((e=>{const r=t.value,a=e.payload,o=r.dataEntries[a.dataEntryId].eventId;return n({resource:"me",params:{fields:"firstName, surname, userName"}}).then((e=>{const{firstName:t,surname:n,userName:i}=e,s=(0,_D.A)(),l={event:o,notes:[{value:a.note}]},d={value:a.note,lastUpdatedBy:{firstName:t,surname:n,uid:s},lastUpdated:$()().toISOString(),storedBy:i,storedAt:$()().toISOString()},c={...d,storedAt:Ii(d.storedAt,it.CO.DATETIME),createdBy:{firstName:t,surname:n,uid:s}},u={dataEntryId:a.dataEntryId,itemId:a.itemId,eventId:o,noteClientId:s};return(0,Xd.OJ)([r2(o,l,r.currentSelections,u),ov(a.dataEntryId,a.itemId,c),JD(o,d)],e2)}))})))}),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(_v),(0,JC.n)((e=>{const t=e.payload;return n({resource:"me",params:{fields:"firstName,surname,userName"}}).then((e=>{const{userName:r,firstName:n,surname:a}=e,o=(0,_D.A)(),i=$()().toISOString(),s={value:t.note,createdBy:{firstName:n,surname:a,uid:o},storedBy:r,storedAt:Ii(i,it.CO.DATETIME),clientId:(0,_D.A)()};return ov(t.dataEntryId,t.itemId,s)}))})))}),(e=>e.pipe((0,i.g)(Z1),(0,s.T)((e=>{const t=e.meta.context;return(0,Xd.OJ)([iv(t.dataEntryId,t.itemId,t.noteClientId),(r=t.eventId,n=t.noteClientId,l(QD)({eventId:r,noteClientId:n}))],t2);var r,n})))),((e,t,r)=>{let{absoluteApiPath:a,querySingleResource:o}=r;return e.pipe((0,i.g)(nG),(0,JC.n)((e=>{let{payload:{eventId:t}}=e;return oB(t,a,o).then((e=>e?XN({orgUnitId:e.event.orgUnitId,onSuccess:t=>((e,t)=>l(aU)({eventContainer:e,orgUnit:t}))(e,t),onError:e=>{const{message:t,details:r}=_c(e);return S().error((0,j.px)(t||n.A.t("Organisation unit could not be loaded"))(r)),IU(n.A.t("Could not get organisation unit"))}}):IU(n.A.t("Event could not be loaded. Are you sure it exists?")))).catch((e=>{const{message:t,details:r}=_c(e);return S().error((0,j.px)(t||n.A.t("Event could not be loaded"))(r)),IU(n.A.t("Event could not be loaded. Are you sure it exists?"))}))})))}),(e=>e.pipe((0,i.g)(i3.OFFLINE_STATUS_CHANGED),(0,s.T)((e=>{return t=e.payload.online,l(z5)({status:t});var t})))),((e,t)=>e.pipe((0,i.g)("Offline/STATUS_CHANGED"),(0,mf.p)((e=>!!e.payload.online)),(0,s.T)((()=>{let e=[l(m4)()];return!!t.value.currentSelections.complete&&(e=[...e,l(g4)()]),(0,Xd.OJ)(e,p4)})))),((e,t)=>e.pipe((0,i.g)(aL),(0,s.T)((e=>{const r=t.value,{storeId:n}=e.payload,a=r.workingListsMeta&&r.workingListsMeta[n]&&r.workingListsMeta[n].filters||{},o=r.workingListsMeta&&r.workingListsMeta[n]&&r.workingListsMeta[n].next&&r.workingListsMeta[n].next.filters||{},i=Object.keys(o).reduce(((e,t)=>(void 0!==o[t]&&(e[t]=o[t]),e)),{}),s={...a,...i},d=Object.keys(s).reduce(((e,t)=>(s[t]&&(e[t]=!0),e)),{});return((e,t)=>l(uL)({includeFilters:e,storeId:t}))(d,n)})))),((e,t,r)=>{let{serverVersion:{minor:n}}=r;return e.pipe((0,i.g)(Cv),(0,s.T)((e=>{const r=t.value,a=e.payload,o=a.formFoundation,i=yf(a.dataEntryId,a.eventId),{formClientValues:s,mainDataClientValues:d}=wD(r,i,o),c=ND(r,o,s,d,n),u={...d,eventId:(0,_D.A)(),programId:r.currentSelections.programId,programStageId:o.id,orgUnitId:r.currentSelections.orgUnitId},p={...s,created:$()().toISOString()},m=r.dataEntriesRelationships[i];return(0,Xd.OJ)([Qv(c,m,r.currentSelections,u.eventId),(g=u,h=p,l(nD)({event:g,eventValues:h})),sD(YR,u.eventId)],gv);var g,h})))}),(e=>e.pipe((0,i.g)(Rv),(0,s.T)((e=>{const t=e.meta.clientId;return lD(YR,t)})))),((e,t)=>e.pipe((0,i.g)(D_),(0,mf.p)((e=>e.payload.findMode&&"TEI_SEARCH"===e.payload.findMode)),(0,s.T)((()=>{const e=t.value.newRelationship.selectedRelationshipType,{programId:r,trackedEntityTypeId:n}=e.to,a=r||n,o=qP(n,r),i=o?o.map(((e,t)=>My(Oq(l3,a,t.toString()),{}))):[];return(0,Xd.OJ)([...i,WP(l3,r,n)],s3)})))),(e=>e.pipe((0,i.g)(UP),(0,mf.p)((e=>e.payload.searchId&&e.payload.searchId===l3)),(0,s.T)((()=>l(U_)({}))))),(e=>e.pipe((0,i.g)(VP,jP),(0,mf.p)((e=>e.payload.searchId&&e.payload.searchId===l3)),(0,s.T)((()=>l(L_)({}))))),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(UP),(0,JC.n)((r=>{const o=t.value,{formId:s,searchGroupId:l,searchId:d,resultsPageSize:c}=r.payload,u=E3({state:o,searchId:d,formId:s,searchGroupId:l,pageNumber:1,resultsPageSize:c,absoluteApiPath:n,querySingleResource:a});return(0,ZC.H)(u).pipe((0,Y_.Q)(e.pipe((0,i.g)(UP,GP))),(0,Y_.Q)(e.pipe((0,mf.p)((e=>(0,Id.A)(e.payload)&&e.payload.some((e=>e.type===DP)))))))})))}),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(GP),(0,JC.n)((r=>{const o=t.value,{pageNumber:s,searchId:l,resultsPageSize:d}=r.payload,c=o.teiSearch[l],u=E3({state:o,searchId:l,formId:c.searchResults.formId,searchGroupId:c.searchResults.searchGroupId,pageNumber:s,resultsPageSize:d,absoluteApiPath:n,querySingleResource:a});return(0,ZC.H)(u).pipe((0,Y_.Q)(e.pipe((0,i.g)(UP,GP))),(0,Y_.Q)(e.pipe((0,mf.p)((e=>(0,Id.A)(e.payload)&&e.payload.some((e=>e.type===DP)))))))})))}),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)($P),(0,JC.n)((e=>{const{selectedProgramId:t,searchId:r,formId:o,searchGroupId:i,programQueryArgs:l}=e.payload,{attributes:d,trackedEntityType:c}=(0,it.x6)(t),{program:u,...p}=l,m={...p,trackedEntityType:c.id};return(0,ZC.H)(aO(m,d,n,a)).pipe((0,s.T)((e=>{let{trackedEntityInstanceContainers:t,pagingData:n}=e;return zP({trackedEntityInstanceContainers:t,currentPage:n.currentPage},o,i,r)}),(0,XC.W)((()=>(0,eO.of)(HP(o,i,r))))))})))}),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(IY),(0,JC.n)((r=>{const o=t.value,{formId:s,searchGroupId:l,searchId:d,resultsPageSize:c}=r.payload,u=A3({state:o,searchId:d,formId:s,searchGroupId:l,pageNumber:1,resultsPageSize:c,absoluteApiPath:n,querySingleResource:a});return(0,ZC.H)(u).pipe((0,Y_.Q)(e.pipe((0,i.g)(IY,NY))),(0,Y_.Q)(e.pipe((0,mf.p)((e=>(0,Id.A)(e.payload)&&e.payload.some((e=>e.type===fY)))))))})))}),((e,t)=>e.pipe((0,i.g)(gY),(0,s.T)((e=>{const r=t.value,n=e.payload.searchId,a=e.payload.programId;let o=r.teiSearch[n].selectedTrackedEntityTypeId;const i=a||o;if(a){o=(0,it.x6)(a).trackedEntityType.id}let s=[];o&&(s=DY(o,a));const l=s?s.map(((e,t)=>My(S3(n,i,t.toString()),{}))):[];return(0,Xd.OJ)([...l,kY(n,a,o)],yY)})))),((e,t)=>e.pipe((0,i.g)(CY),(0,s.T)((e=>{const r=t.value,n=e.payload.searchId,a=r.teiSearch[n],o=a.selectedProgramId||a.selectedTrackedEntityTypeId,i=DY(a.selectedTrackedEntityTypeId,a.selectedProgramId),s=i?i.map(((e,t)=>My(S3(n,o,t.toString()),{}))):[];return(0,Xd.OJ)([...s],vY)})))),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(NY),(0,JC.n)((r=>{const o=t.value,{pageNumber:s,searchId:l,resultsPageSize:d}=r.payload,c=o.teiSearch[l],u=A3({state:o,searchId:l,formId:c.searchResults.formId,searchGroupId:c.searchResults.searchGroupId,pageNumber:s,resultsPageSize:d,absoluteApiPath:n,querySingleResource:a});return(0,ZC.H)(u).pipe((0,Y_.Q)(e.pipe((0,i.g)(IY,NY))),(0,Y_.Q)(e.pipe((0,mf.p)((e=>(0,Id.A)(e.payload)&&e.payload.some((e=>e.type===fY)))))))})))}),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(wY),(0,JC.n)((e=>{const{selectedProgramId:t,searchId:r,formId:o,searchGroupId:i,programQueryArgs:l}=e.payload,{attributes:d,trackedEntityType:c}=(0,it.x6)(t),{program:u,...p}=l,m={...p,trackedEntityType:c.id};return(0,ZC.H)(aO(m,d,n,a)).pipe((0,s.T)((e=>{let{trackedEntityInstanceContainers:t,pagingData:n}=e;return PY({trackedEntityInstanceContainers:t,currentPage:n.currentPage},o,i,r)}),(0,XC.W)((()=>(0,eO.of)(_Y(o,i,r))))))})))}),((e,t)=>e.pipe((0,i.g)(CP),(0,s.T)((e=>{const r=t.value,n=e.payload.searchId,a=e.payload.programId;let o=r.teiSearch[n].selectedTrackedEntityTypeId;const i=a||o;if(a){o=(0,it.x6)(a).trackedEntityType.id}let s=[];o&&(s=qP(o,a));const l=s?s.map(((e,t)=>My(Oq(n,i,t.toString()),{}))):[];return(0,Xd.OJ)([...l,YP(n,a,o)],PP)})))),((e,t)=>e.pipe((0,i.g)(VP),(0,s.T)((e=>{const r=t.value,n=e.payload.searchId,a=r.teiSearch[n],o=a.selectedProgramId||a.selectedTrackedEntityTypeId,i=qP(a.selectedTrackedEntityTypeId,a.selectedProgramId),s=i?i.map(((e,t)=>My(Oq(n,o,t.toString()),{}))):[];return(0,Xd.OJ)([...s],kP)})))),(e=>e.pipe((0,i.g)(Pv),(0,s.T)((()=>F_())))),((e,t)=>e.pipe((0,i.g)(tf),(0,s.T)((e=>{const r=t.value,a=r.dataEntriesRelationships[LD]||[],o=e.payload,i=o.entity,s=i.id?i:J_(i.dataEntryId,i.itemId,r),d=!i.id?{dataEntryId:i.dataEntryId}:null,c={clientId:(0,_D.A)(),from:{id:"newEvent",name:n.A.t("This event"),type:"PROGRAM_STAGE_INSTANCE"},to:{...s,type:o.entityType},relationshipType:{...o.relationshipType}};if(a.some((e=>e.relationshipType.id===c.relationshipType.id&&e.to.id&&e.to.id===c.to.id))){const e=n.A.t("Relationship of type {{relationshipTypeName}} to {{entityName}} already exists",{entityName:c.to.name,relationshipTypeName:c.relationshipType.name,interpolation:{escapeValue:!1}});return((e,t,r)=>l(Zy)({dataEntryId:e,itemId:t,message:r}))(DD,UD,e)}return(0,Xd.OJ)([(u=c.clientId,l(rf)({relationshipId:u})),lv(DD,UD,c,d)],nf);var u})))),(e=>e.pipe((0,i.g)(kv),(0,s.T)((e=>{var t;const r=e.meta;if(null!==(t=r.relationshipData)&&void 0!==t&&t.length){const t=e.payload.bundleReport.typeReportMap.EVENT.objectReports[0].uid,r=e.meta.relationshipData.map((e=>({...e,from:{...e.from,id:t}})));return FD(r,e.meta.selections,e.meta.triggerAction)}return r.triggerAction===vv?zv(r.selections):r.triggerAction===Ov?Xv(r.selections):r.triggerAction===Bv?Jv(r.selections):null})))),(e=>e.pipe((0,i.g)(Uv,Lv,Vv),(0,s.T)((e=>{const t=e.meta;return t.triggerAction===vv?zv(t.selections):t.triggerAction===Ov?Xv(t.selections):t.triggerAction===Bv?Jv(t.selections):null})))),((e,t)=>e.pipe((0,i.g)(hT),(0,s.T)((e=>e.payload.find((e=>e.type===pT)))),(0,s.T)((e=>{const{innerPayload:r,searchActions:n,uid:a,programId:o,orgUnit:i,stage:s,formFoundation:l}=e.payload,{dataEntryId:d,itemId:c,elementId:u,value:p,uiState:m}=r,g={elementId:u,value:p,valid:m.valid};return wA(t,{programId:o,orgUnit:i,dataEntryId:d,itemId:c,uid:a,stage:s,formFoundation:l},g,n)})))),((e,t)=>e.pipe((0,i.g)(ET),(0,s.T)((e=>e.payload.find((e=>e.type===pT)))),(0,s.T)((e=>{const{uid:r,programId:n,orgUnit:a,innerPayload:o,stage:i,formFoundation:s}=e.payload,{dataEntryId:l,itemId:d}=o;return wA(t,{dataEntryId:l,itemId:d,uid:r,programId:n,orgUnit:a,stage:i,formFoundation:s})})))),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(Qg),(0,Rc.H)((t=>{const{formId:r,elementId:a,searchText:o}=t.payload;return(0,ZC.H)(n({resource:"organisationUnits",params:{fields:["id,displayName,path,publicAccess,access,lastUpdated","children[id,displayName,publicAccess,access,path,children::isNotEmpty]"].join(","),paging:!1,withinUserSearchHierarchy:!0,query:o}}).then((e=>({orgUnitArray:e.toArray(),searchText:o,formId:r,elementId:a}))).catch((e=>({error:e,formId:r,elementId:a})))).pipe((0,Y_.Q)(e.pipe((0,mf.p)((e=>N3(e,r,a))))))})),(0,s.T)((e=>{if(e.error)return S().error((0,j.px)(C3)({error:e.error,method:"FilterOrgUnitRootsEpic"})),((e,t,r)=>l(Jg)({formId:e,elementId:t,errorMessage:r}))(e.formId,e.elementId,C3);const{orgUnitArray:t,formId:r,elementId:n}=e;return((e,t,r)=>l(Xg)({formId:e,elementId:t,roots:r}))(r,n,t.map((e=>({id:e.id,path:e.path,displayName:e.displayName}))))})))}),(e=>e.pipe((0,i.g)(Ic),(0,Rc.H)((e=>{const t=e.payload,{elementId:r,formBuilderId:a,formId:o,callback:i,uid:s,onSuccess:d,onError:c}=t,u={valid:!0,touched:!0,errorMessage:null};return i().then((e=>{const t=((e,t,r,n,a,o)=>l(bc)({value:e,uiState:t,elementId:r,formBuilderId:n,formId:a,uid:o}))(e,u,r,a,o,s);return d?d(t):t})).catch((e=>{const{message:t}=_c(e),i=n.A.t("Async field update failed");S().error((0,j.px)(t||i)({error:e}));const d=((e,t,r,n,a,o)=>l(Sc)({message:e,uiState:t,elementId:r,formBuilderId:n,formId:a,uid:o}))(i,u,r,a,o,s);return c?c(d):d}))})))),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(Z_),(0,Rc.H)((t=>{const r=t.payload.searchText,a=t.payload.searchId;return(0,ZC.H)(n({resource:"organisationUnits",params:{fields:["id,displayName,path,publicAccess,access,lastUpdated","children[id,displayName,publicAccess,access,path,children::isNotEmpty]"].join(","),paging:!0,withinUserSearchHierarchy:!0,query:r,pageSize:15}}).then((e=>{let{organisationUnits:t}=e;return{regUnitArray:t,searchText:r,searchId:a}})).catch((e=>({error:e,searchId:a})))).pipe((0,Y_.Q)(e.pipe((0,mf.p)((e=>_3(e,a))))))})),(0,s.T)((e=>{if(e.error)return S().error((0,j.px)(R3)({error:e.error,method:"searchRegisteringUnitListEpic"})),((e,t)=>l(rP)({searchId:e,error:t}))(e.searchId,R3);const t=e.regUnitArray.map((e=>({id:e.id,path:e.path,displayName:e.displayName})));return((e,t,r)=>l(tP)({searchId:e,roots:t,searchText:r}))(e.searchId,t,e.searchText)})))}),((e,t,r)=>{let{absoluteApiPath:a,querySingleResource:o}=r;return e.pipe((0,i.g)(ZD),(0,JC.n)((e=>{const r=e.payload.eventId,i=t.value.currentSelections.programId;return oB(r,a,o).then((e=>e?async function(e,t){var r;const n=null===(r=e.attributeCategoryOptions)||void 0===r?void 0:r.replace(/;/g,",");if(!n)return null;const a=(0,it.Ec)(e.programId),o=null===a||void 0===a?void 0:a.categoryCombination;if(!o)return null;const i=[...o.categories.values()];let s=await(async(e,t)=>t({resource:"categoryOptions",params:{fields:"id,displayName,categories~pluck,access",filter:`id:in:[${e}]`}}).then((e=>null===e||void 0===e?void 0:e.categoryOptions)))(n,t);return s?i.map((e=>{const t=s.find((t=>t.categories.includes(e.id)));return t?(s=s.filter((e=>e!==t)),{categoryId:e.id,categoryOption:{id:t.id,name:t.displayName,writeAccess:t.access.data.write}}):(S().error((0,j.px)("option not found for category")({category:e})),{categoryId:e.id,categoryOption:{id:void 0,name:void 0,writeAccess:void 0}})})):null}(e.event,o).then((t=>((e,t,r)=>l(eU)({eventContainer:e,prevProgramId:t,categoriesData:r}))(e,i,t))):yU(n.A.t("Event could not be loaded. Are you sure it exists?")))).catch((e=>{const{message:t,details:r}=_c(e);return S().error((0,j.px)(t||n.A.t("Event could not be loaded"))(r)),yU(n.A.t("Event could not be loaded. Are you sure it exists?"))}))})))}),(e=>e.pipe((0,i.g)(eU),(0,s.T)((e=>{const t=e.payload.eventContainer;return XN({orgUnitId:t.event.orgUnitId,onSuccess:e=>((e,t)=>l(rU)({orgUnit:e,eventContainer:t}))(e,t),onError:e=>{const{message:r,details:a}=_c(e);return S().error((0,j.px)(r||n.A.t("Organisation unit could not be loaded"))(a)),(e=>l(nU)({eventContainer:e}))(t)}})})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(nG),(0,s.T)((e=>{let{payload:{eventId:t}}=e;return n.push(`/viewEvent?viewEventId=${t}`),pf()})))}),((e,t)=>e.pipe((0,i.g)(dU),(0,s.T)((()=>{const e=t.value;if(!e.offline.online)return vU();const r=e.workingListsTemplates.eventList&&e.workingListsTemplates.eventList.currentListId,n=r&&e.workingListsContext[r];if(!n)return fU();const a=e.currentSelections;return a.complete&&!of(n,a)?fU():e.viewEventPage.eventHasChanged?l(sU)():e.viewEventPage.saveInProgress?l(uU)():vU()})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(dU),(0,JC.n)((()=>{const e=t.value,r=e.currentSelections.programId,a=e.currentSelections.orgUnitId;return e.currentSelections.showaccessible&&!a?(n.push(`/?programId=${r}&all`),new Promise((e=>{setTimeout((()=>e(pf())),0)}))):(n.push(`/?${Is({programId:r,orgUnitId:a})}`),new Promise((e=>{setTimeout((()=>e(pf())),0)})))})))}),(e=>e.pipe((0,i.g)(cU),(0,s.T)((()=>F_())))),((e,t)=>e.pipe((0,i.g)(i$),(0,s.T)((e=>{const r=t.value,a=r.viewEventPage.eventId,o=r.dataEntriesRelationships[D3]||[],i=e.payload,s=i.entity,d=s.id?s:J_(s.dataEntryId,s.itemId,r),c=(0,_D.A)(),u={clientId:c,from:{id:a,name:n.A.t("This event"),type:"PROGRAM_STAGE_INSTANCE"},to:{...d,type:i.entityType},relationshipType:{...i.relationshipType}};if(o.some((e=>e.relationshipType.id===u.relationshipType.id&&e.to.id&&e.to.id===u.to.id))){return(e=>l(c$)({message:e}))(n.A.t("Relationship of type {{relationshipTypeName}} to {{entityName}} already exists",{entityName:u.from.name,relationshipTypeName:u.relationshipType.name}))}let p;if(d.data)m=u,g=r.currentSelections,h=c,p=l(h$)({selections:g},{offline:{effect:{url:"tracker?async=false",method:oc,data:{trackedEntities:[m.to.data]},clientId:h},commit:{type:E$,meta:{clientData:m,selections:g,clientId:h}},rollback:{type:y$,meta:{clientData:m,selections:g,clientId:h}}}});else{const e={relationships:[kD(u)]};p=v$(e,r.currentSelections,c)}var m,g,h;return(0,Xd.OJ)([l4(D3,u),p],r$)})))),(e=>e.pipe((0,i.g)(d$),(0,s.T)((e=>d4(D3,e.meta.clientId))))),((e,t)=>e.pipe((0,i.g)(l$),(0,s.T)((e=>{const r={...t.value.relationships[D3].find((t=>t.clientId===e.meta.clientId)),id:e.payload.bundleReport.typeReportMap.RELATIONSHIP.objectReports[0].uid};return((e,t)=>l(o4)({key:e,updatedRelationship:t}))(D3,r)})))),((e,t)=>e.pipe((0,i.g)(g$),(0,s.T)((e=>{const r=e.payload.clientId,n=t.value,a={relationships:[{relationship:n.relationships.viewEvent.find((e=>e.clientId===r)).id}]};return(0,Xd.OJ)([d4(D3,r),I$(a,r,n.currentSelections)],n$)})))),(e=>e.pipe((0,i.g)(E$),(0,s.T)((e=>{const t=e.payload.bundleReport.typeReportMap.TRACKED_ENTITY.objectReports[0].uid,{clientData:r,selections:n,clientId:a}=e.meta,o=r.to;o.data=null,o.id=t;const i={relationships:[kD(r)]};return v$(i,n,a)})))),(e=>e.pipe((0,i.g)(y$),(0,s.T)((e=>d4(D3,e.meta.clientId))))),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(X$),(0,JC.n)((e=>{const r=t.value,a=e.payload,o=r.viewEventPage.eventId;return n({resource:"me",params:{fields:"userName,firstName,surname"}}).then((e=>{const{userName:t,firstName:n,surname:i}=e,s=(0,_D.A)(),l={event:o,notes:[{value:a.note}]},d={value:a.note,createdBy:{firstName:n,surname:i,uid:s},storedBy:t,storedDate:Ii($()().toISOString(),it.CO.DATETIME),clientId:(0,_D.A)()};return(0,Xd.OJ)([rW(o,l,r.currentSelections,d.clientId),t4(U3,d)],K$)}))})))}),(e=>e.pipe((0,i.g)(Z$),(0,s.T)((e=>((e,t)=>l(Z5)({key:e,noteClientId:t}))(U3,e.meta.clientId))))),(e=>e.pipe((0,i.g)(rU,nU,aU),(0,s.T)((e=>{const t=e.payload.eventContainer,r=(t&&t.event&&t.event.notes||[]).map((e=>({...e,storedDate:Ii(e.storedAt,it.CO.DATETIME)})));return(0,Xd.OJ)([l(Q$)(),e4(U3,r)],q$)})))),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(rU,nU,aU),(0,JC.n)((e=>{const t=e.payload.eventContainer.event;return function(e,t,r,n){const a=(0,it.Nd)(t),o=a instanceof it.jV?a.stage:a.getStage(r);return k3({event:e,fields:["from,to,relationshipType,relationship,createdAt"]},(null===o||void 0===o?void 0:o.relationshipTypes)||[],n)}(t.eventId,t.programId,t.programStageId,n).then((e=>(0,Xd.OJ)([l(a$)(),s4(D3,e||[])],t$)))})))}),((e,t,r)=>{let{serverVersion:{minor:n}}=r;return e.pipe((0,i.g)(rU,nU,aU,N$),(0,mf.p)((e=>((e,t,r)=>e.type!==t||(0,oe.default)(e.payload)&&e.payload.some((e=>e.type===r)))(e,N$))),(0,s.T)((e=>((e,t,r)=>e.type===t&&(0,oe.default)(e.payload)?e.payload.find((e=>e.type===r)):e)(e,N$))),(0,mf.p)((e=>{const r=e.payload.eventContainer.id,n=t.value.viewEventPage||{};return n.eventId===r&&!n.showEditEvent})),(0,JC.n)((r=>{var a;const o=t.value,d=r.payload.eventContainer,c=r.payload.orgUnit,u=(0,it.ei)(d.event);if(u.error)return(0,eO.of)((p=u.error,l(C$)(p)));var p;const m=u.stage.stageForm,g=u.program,{enrollment:h,attributeValues:E}=o.enrollmentDomain,y={eventContainer:d,orgUnit:c,foundation:m,program:g,enrollment:h,attributeValues:E,dataEntryId:o3(d.event),dataEntryKey:(v=null===(a=d.event)||void 0===a?void 0:a.status,v===Es.SCHEDULE||v===Es.OVERDUE?V.EDIT:V.VIEW),onCategoriesQuery:null,serverMinorVersion:n};var v;return d.event=TD(d.event,n),!h&&g instanceof FB.rr?e.pipe((0,i.g)(Ss.COMMON_ENROLLMENT_SITE_DATA_SET),(0,a3.s)(1),(0,JC.n)((e=>{let{payload:t}=e;return y.enrollment=t.enrollment,y.attributeValues=t.attributeValues,(0,ZC.H)(O$(y)).pipe((0,s.T)((e=>(0,Xd.OJ)(e))))}))):(0,ZC.H)(O$(y)).pipe((0,s.T)((e=>(0,Xd.OJ)(e))))})))}),((e,t)=>e.pipe((0,i.g)(b$,nW),(0,s.T)((e=>{const r=t.value,n=r.viewEventPage.loadedValues,a=n.eventContainer,o=(0,it.ei)(a.event);if(o.error)return z$(o.error);const i=o.program,s=o.stage.stageForm,{orgUnit:d,programCategory:c}=e.payload,{enrollment:u,attributeValues:p}=r.enrollmentDomain;return(0,Xd.OJ)([l(S$)(),...JB({loadedValues:n,orgUnit:d,foundation:s,program:i,enrollment:u,attributeValues:p,dataEntryId:n3(a.event),dataEntryKey:V.EDIT,programCategory:c})])})))),((e,t,r)=>{let{serverVersion:{minor:n}}=r;return e.pipe((0,i.g)(_$),(0,s.T)((e=>{const{dataEntryId:r,itemId:a,formFoundation:o}=e.payload,i=t.value,s=yf(r,a),l=i.dataEntries[r].eventId,d=i.formsValues[s],c=i.dataEntriesFieldsValue[s],u=i.dataEntriesFieldsMeta[s],p=i.viewEventPage.loadedValues.eventContainer.event,{formClientValues:m,dataEntryClientValues:g}=SD(o,d,c,u),h={...p,...g,notes:[]},E=o.convertValues(m,_i),y=CD(h,n),{eventContainer:v}=i.viewEventPage.loadedValues,f={...v,event:{...v.event,...g},values:{...m}},I={events:[{...y,attributeOptionCombo:void 0,dataValues:o.getElements().map((e=>{let{id:t}=e;return{dataElement:t,value:E[t]||null}}))}]},b=(0,it.ei)(f.event);if(b.error)return z$(b.error);return b.program instanceof FB.rr?(0,Xd.OJ)([Ts(l,I.events[0]),H$(l,I,Ss.COMMIT_ENROLLMENT_EVENT,Ss.ROLLBACK_ENROLLMENT_EVENT)],N$):(0,Xd.OJ)([H$(l,I)],N$)})))}),((e,t,r)=>{let{serverVersion:{minor:n}}=r;return e.pipe((0,i.g)(D$),(0,mf.p)((e=>{const r=t.value.viewEventPage||{};return r.eventId&&r.eventId===e.meta.eventId})),(0,s.T)((e=>{const r=t.value,a=e.meta,o=r.viewEventPage.loadedValues.eventContainer;o.event&&o.event.attributeCategoryOptions&&(o.event.attributeCategoryOptions=Pi(o.event.attributeCategoryOptions,n));let i=[];return a.triggerAction===Ss.ROLLBACK_ENROLLMENT_EVENT?i=[As(o.event.eventId)]:a.triggerAction===c5&&(i=[_s()]),(0,Xd.OJ)(i,R$)})))}),(e=>e.pipe((0,i.g)(k$),(0,mf.p)((e=>{const{meta:{triggerAction:t}}=e;return t===Ss.COMMIT_ENROLLMENT_EVENT||t===d5})),(0,s.T)((e=>{const t=e.meta;return t.triggerAction===d5?Ps():Cs(t.eventId)})))),((e,t)=>e.pipe((0,i.g)(D_),(0,mf.p)((e=>e.payload.findMode&&e.payload.findMode===G_)),(0,JC.n)((()=>{const e=t.value,r=e.newRelationship.selectedRelationshipType,{programId:a}=r.to,{orgUnitId:o}=e.currentSelections;let i;if(a)try{i=function(e){let t;try{const r=(0,it.x6)(e);r.access.data.write&&(t=r)}catch(r){throw S().error((0,j.px)("tracker program for id not found")({suggestedProgramId:e,error:r})),Error((0,n.A)("Metadata error. see log for details"))}return t}(a)}catch(c){return Promise.resolve((e=>l(M_)({errorMessage:e}))(c))}const s=function(e,t){let r;return r=t?t.organisationUnits[e]?e:null:e,r}(o,i);if(!s)return Promise.resolve(V_(i&&i.id));const d=e.organisationUnits[s];return(0,eO.of)(V_(a,d))})))),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(bN,CN),(0,JC.n)((r=>{let{payload:{page:o,pageSize:d,selectedScopeId:c,scopeType:u,dataEntryId:p}}=r;const{formsValues:m,dataEntries:g}=t.value,h=m[yf(p,g[p].itemId)];try{const t=(function(e){if(!e)return null;const t=(0,it.WB)(e);return t instanceof it.jV?null:t instanceof it.rr?t.enrollment.inputSearchGroups&&t.enrollment.inputSearchGroups[0].searchFoundation.getElements():t instanceof it.UC?t.teiRegistration.inputSearchGroups&&t.teiRegistration.inputSearchGroups[0].searchFoundation.getElements():null}(c)||[]).map((e=>{const t=h[e.id];if(!t&&0!==t&&!1!==t)return null;const r=e.convertValue(t,(0,j.Fs)(Mi,_i)),n=e.optionSet&&e.type!==it.CO.MULTI_TEXT;return`${e.id}:${n?"eq":"like"}:${$i(r)}`})).filter((e=>e));if(0===t.length)return Promise.resolve(l(AN)());const r={ouMode:"ACCESSIBLE",pageSize:d,page:o,filter:t,...u===it.m2.TRACKER_PROGRAM?{program:c}:{trackedEntityType:c}},p=(0,VO.Nn)(c),m=u===it.m2.TRACKER_PROGRAM?c:null;return(0,ZC.H)(aO(r,p,n,a,m)).pipe((0,s.T)((e=>{let{trackedEntityInstanceContainers:t,pagingData:r}=e;return n=t,a=r.currentPage,l(SN)({teis:n,currentPage:a});var n,a})),(0,Y_.Q)(e.pipe((0,i.g)(ON))),(0,XC.W)((()=>(0,eO.of)(NN()))))}catch(E){return Promise.resolve(NN())}})))}),(e=>e.pipe((0,i.g)(Mv),(0,s.T)((e=>{const t=e.payload.bundleReport.typeReportMap.TRACKED_ENTITY.objectReports[0].uid,{relationshipData:r,relationshipClientId:n,selections:a,triggerAction:o}=e.meta,i=r.find((e=>e.clientId===n));return i.to.id=t,i.to.data=null,FD(r,a,o)})))),(e=>e.pipe((0,i.g)(gD.FROM_URL_UPDATE_COMPLETE,gD.FETCH_ORG_UNIT_SUCCESS,gD.EMPTY_ORG_UNIT_SET),(0,mf.p)((()=>{const e=R5();return w5(e.substring(1))})),(0,s.T)((()=>{const{programId:e,orgUnitId:t}=fs();if(e){const r=Nt.Jj.get(e);if(!r)return ED(n.A.t("Program doesn't exist"));if(t&&!r.organisationUnits[t])return ED(n.A.t("Selected program is invalid for selected organisation unit"))}return l(gD.FROM_URL_CURRENT_SELECTIONS_VALID)()})))),((e,t)=>e.pipe((0,i.g)(gD.FROM_URL_UPDATE),(0,mf.p)((e=>e.payload.nextProps.orgUnitId)),(0,Rc.H)((e=>{const{organisationUnits:r}=t.value,{orgUnitId:a}=e.payload.nextProps;return r[a]?(0,eO.of)(l(gD.FROM_URL_UPDATE_COMPLETE)()):(0,eO.of)(l(gD.LOADING_START)(),XN({orgUnitId:a,onSuccess:yD,onError:()=>{return e=n.A.t("Could not get organisation unit"),l(gD.FETCH_ORG_UNIT_ERROR)({error:e});var e}}))})))),(e=>e.pipe((0,i.g)(gD.FROM_URL_UPDATE),(0,mf.p)((e=>!e.payload.nextProps.orgUnitId)),(0,s.T)((()=>l(gD.EMPTY_ORG_UNIT_SET)())))),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(eC),(0,KC.q)((e=>{let{payload:{formId:r,programId:o}}=e;const{formsValues:i}=t.value,s={filter:gO(i[r]),program:o,pageNumber:1,ouMode:"ACCESSIBLE"},{attributes:l,trackedEntityType:d}=(0,it.x6)(o);return hO({queryArgs:s,attributes:l,programId:o,absoluteApiPath:n,querySingleResource:a,formId:r,programTETId:d.id})})))}),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(tC),(0,KC.q)((e=>{let{payload:{formId:r,trackedEntityTypeId:o}}=e;const{formsValues:i}=t.value,s={filter:gO(i[r]),trackedEntityType:o,pageNumber:1,ouMode:"ACCESSIBLE",fields:"trackedEntity,trackedEntityType,orgUnit,attributes,enrollments"},l=(0,it.mu)(o).attributes;return hO({queryArgs:s,attributes:l,absoluteApiPath:n,querySingleResource:a})})))}),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(rC),(0,KC.q)((e=>{let{payload:{formId:r,programId:o,page:i,triggeredFrom:s}}=e;const{formsValues:l}=t.value,d=(0,it.x6)(o).attributes,c={filter:EO(l[r],d),fields:"attributes,enrollments,trackedEntity,orgUnit",program:o,page:i,pageSize:5,ouMode:"ACCESSIBLE"};return vO({queryArgs:c,attributes:d,triggeredFrom:s,absoluteApiPath:n,querySingleResource:a,programId:o})})))}),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(nC),(0,KC.q)((e=>{let{payload:{formId:r,trackedEntityTypeId:o,page:i,triggeredFrom:s}}=e;const{formsValues:l}=t.value,d=(0,it.mu)(o).attributes,c={filter:EO(l[r],d),trackedEntityType:o,page:i,pageSize:5,ouMode:"ACCESSIBLE"};return vO({queryArgs:c,attributes:d,triggeredFrom:s,absoluteApiPath:n,querySingleResource:a})})))}),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(h4),(0,JC.n)((()=>{const{currentSelections:{programId:e,orgUnitId:r}}=t.value;return n.push(`/?${Is({programId:e,orgUnitId:r})}`),new Promise((e=>{setTimeout((()=>e(pf())),0)}))})))}),((e,t)=>e.pipe((0,i.g)(pC),(0,KC.q)((e=>{let{payload:{programId:r,pageSize:n,page:a}}=e;const o=(0,it.x6)(r);if(o.trackedEntityType){const{id:e,searchGroups:r}=o.trackedEntityType,i=r.find((e=>!e.unique));if(i){const{minAttributesRequiredToSearch:r,searchForm:o}=i,{searchDomain:s}=t.value,d=s.currentSearchInfo.currentSearchTerms,c=o.getElements(),{searchableValuesCount:u,fallbackFormValues:p}=d.reduce(((e,t)=>(c.find((e=>{let{id:r}=e;return r===t.id}))&&(e.searchableValuesCount+=1),e.fallbackFormValues[t.id]=t.value,e)),{searchableValuesCount:0,fallbackFormValues:{}});return r||u?u>=r?(0,eO.of)((e=>{let{fallbackFormValues:t,trackedEntityTypeId:r,pageSize:n,page:a=1}=e;return l(mC)({fallbackFormValues:t,trackedEntityTypeId:r,pageSize:n,page:a})})({trackedEntityTypeId:e,fallbackFormValues:p,page:a,pageSize:n})):(0,eO.of)(NC({searchableFields:c,minAttributesRequiredToSearch:r})):(0,eO.of)(NC({searchableFields:c,minAttributesRequiredToSearch:1}))}return(0,eO.of)(TC())}return(0,tO.I)()})))),((e,t,r)=>{let{absoluteApiPath:n,querySingleResource:a}=r;return e.pipe((0,i.g)(mC),(0,KC.q)((e=>{let{payload:{fallbackFormValues:t,trackedEntityTypeId:r,pageSize:o,page:i}}=e;const d=(0,it.mu)(r).attributes,c=EO(t,d).filter((e=>e)),u={filter:c,trackedEntityType:r,page:i,pageSize:o,ouMode:"ACCESSIBLE",fields:"trackedEntity,trackedEntityType,orgUnit,attributes,enrollments,"};return(0,ZC.H)(aO(u,d,n,a)).pipe((0,s.T)((e=>{let{trackedEntityInstanceContainers:t,pagingData:r}=e;return t.length?(n=t,a=r.currentPage,l(sC)({otherResults:n,otherCurrentPage:a})):CC();var n,a})),(0,XC.W)(yO))})))}),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(hC),(0,JC.n)((e=>{let{payload:{orgUnitId:t,trackedEntityTypeId:r}}=e;return n.push(`/search?${Is({orgUnitId:t,trackedEntityTypeId:r})}`),tO.w})))}),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(fO),(0,s.T)((e=>{let{payload:{trackedEntityTypeId:r}}=e;const{currentSelections:{orgUnitId:a},app:{page:o}}=t.value;return n.push(`/${o}?${Is({trackedEntityTypeId:r,orgUnitId:a})}`),pf()})))}),((e,t,r)=>{let{querySingleResource:a}=r;return e.pipe((0,i.g)(uR),(0,T9.E)("payload"),(0,JC.n)((e=>{let{selectedOrgUnitId:t,selectedScopeId:r,dataEntryId:o,formFoundation:i,formValues:s}=e;if(t){try{(0,VO.mu)(r)}catch(l){return S().error((0,j.px)("TET for id not found")({TETypeId:r,error:l})),Promise.resolve(z_(n.A.t("Metadata error. see log for details")))}const e=qA({foundation:i,orgUnit:{id:t},dataEntryId:o,querySingleResource:a,formValues:s});return(0,ZC.H)(e)}return(0,tO.I)()})))}),(e=>e.pipe((0,i.g)(WN),(0,T9.E)("payload"),(0,JC.n)((e=>{let{selectedOrgUnit:t,selectedScopeId:r,dataEntryId:a,formValues:o,clientValues:i,programCategory:s,firstStage:l,formFoundation:d}=e;if(t){let e;try{e=(0,VO.x6)(r)}catch(c){return S().error((0,j.px)("tracker program for id not found")({programId:r,error:c})),Promise.resolve(z_(n.A.t("Metadata error. see log for details")))}const u=RA({program:e,orgUnit:t,dataEntryId:a,formValues:o,clientValues:i,firstStage:l,programCategory:s,formFoundation:d});return(0,ZC.H)(u)}return(0,tO.I)()})))),(e=>e.pipe((0,i.g)(P4),(0,s.T)((e=>{const{teiPayload:t}=e.payload;return r={trackedEntities:[t]},l(k4)({...r},{offline:{effect:{url:"tracker?async=false",method:oc,data:r},commit:{type:D4},rollback:{type:U4}}});var r})))),((e,t)=>e.pipe((0,i.g)(L4),(0,s.T)((e=>{var r;const{currentSelections:{programId:n}}=t.value,{enrollmentPayload:a,uid:o}=e.payload,{stages:i,useFirstStageDuringRegistration:s}=(0,it.x6)(n),{stageWithOpenAfterEnrollment:d,redirectTo:c}=((e,t)=>{const r=[...e.values()],[n]=r.filter((e=>{let{openAfterEnrollment:t}=e;return t})),a=n?t&&r[0].id===n.id||r.find((e=>e.autoGenerateEvent&&e.id===n.id))?iR:oR:sR;return{stageWithOpenAfterEnrollment:n,redirectTo:a}})(i,s);return(e=>{let{candidateForRegistration:t,redirectTo:r,uid:n,stageId:a,eventIndex:o}=e;return l(F4)({...t},{offline:{effect:{url:"tracker?async=false",method:oc,data:t},commit:{type:x4,meta:{redirectTo:r,stageId:a,uid:n,eventIndex:o}},rollback:{type:M4}}})})({candidateForRegistration:{trackedEntities:[a]},redirectTo:c,eventIndex:null===(r=a.enrollments[0])||void 0===r?void 0:r.events.findIndex((e=>e.programStage===(null===d||void 0===d?void 0:d.id))),stageId:null===d||void 0===d?void 0:d.id,uid:o})})))),((e,t)=>e.pipe((0,i.g)(D4),(0,KC.q)((e=>{let{payload:{bundleReport:{typeReportMap:r}}}=e;const{currentSelections:{orgUnitId:n}}=t.value;return(0,eO.of)(iO({teiId:r.TRACKED_ENTITY.objectReports[0].uid,orgUnitId:n}))})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(x4),(0,KC.q)((e=>{var r,a;const{payload:{bundleReport:{typeReportMap:o}},meta:{uid:i,redirectTo:s,stageId:l,eventIndex:d}}=e,{currentSelections:{orgUnitId:c,programId:u},newPage:p}=t.value,{uid:m}=p||{},g=o.TRACKED_ENTITY.objectReports[0].uid,h=o.ENROLLMENT.objectReports[0].uid,E=null===(r=o.EVENT.objectReports)||void 0===r||null===(a=r[d])||void 0===a?void 0:a.uid;return m!==i?tO.w:s===oR?(n.push(`/${s}?${Is({programId:u,orgUnitId:c,teiId:g,enrollmentId:h,stageId:l})}`),tO.w):s===iR?(n.push(`/${s}?${Is({eventId:E,orgUnitId:c,initMode:V.EDIT})}`),tO.w):(0,eO.of)(iO({teiId:g,orgUnitId:c,programId:u}))})))}),(e=>e.pipe((0,i.g)(M4),(0,s.T)((()=>ID())))),((e,t)=>e.pipe((0,i.g)(E5.PROCESS_ENROLLMENT_ID),(0,mf.p)((e=>{let{payload:r}=e;return r&&"AUTO"!==r?!((e,t)=>t&&t.some((t=>t.enrollment===e)))(r,t.value.enrollmentPage.enrollments):t.value.enrollmentPage.enrollmentId})),(0,s.T)((e=>{let{payload:t}=e;if(!t||"AUTO"===t){const{programId:e,teiId:t}=fs();return r={programId:e,teiId:t},l(E5.RESET_ENROLLMENT_ID)(r)}var r;return(e=>l(E5.FETCH_ENROLLMENT_ID)({enrollmentId:e}))(t)})))),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(E5.FETCH_ENROLLMENT_ID),(0,Rc.H)((e=>{let{payload:{enrollmentId:t}}=e;return n((e=>({resource:"tracker/enrollments",id:e,params:{fields:["trackedEntity","program"]}}))(t)).then((e=>(e=>{let{enrollmentId:t,trackedEntity:r,program:n}=e;return l(E5.VERIFY_ENROLLMENT_ID_SUCCESS)({enrollmentId:t,teiId:r,programId:n})})({enrollmentId:t,...e}))).catch((()=>(e=>l(E5.FETCH_ENROLLMENT_ID_ERROR)({enrollmentId:e}))(t)))})))}),((e,t)=>e.pipe((0,i.g)(E5.VERIFY_ENROLLMENT_ID_SUCCESS),(0,mf.p)((e=>{let{payload:r}=e;return r.enrollmentId===t.value.enrollmentPage.enrollmentId})),(0,s.T)((e=>{let{payload:t}=e;return(e=>l(E5.FETCH_ENROLLMENT_ID_SUCCESS)(e))(t)})))),(e=>e.pipe((0,i.g)(E5.FETCH_ENROLLMENT_ID_ERROR),(0,s.T)((e=>{let{payload:{enrollmentId:t}}=e;return f5({error:n.A.t('Enrollment with id "{{enrollmentId}}" does not exist',{enrollmentId:t})})})))),((e,t)=>e.pipe((0,i.g)(E5.PROCESS_TEI_ID,E5.FETCH_ENROLLMENT_ID_SUCCESS,E5.RESET_ENROLLMENT_ID),(0,mf.p)((e=>{let{payload:{teiId:r}}=e;return C9(t)&&r&&t.value.enrollmentPage.teiId!==r})),(0,s.T)((e=>{let{payload:t}=e;return(e=>l(E5.FETCH_TEI)(e))(t)})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(E5.RESET_TEI_ID),(0,mf.p)((()=>(e=>{let{fetchStatus:t}=e;return t.enrollmentId!==K4&&t.teiId!==K4&&(e=>{const{programId:t,orgUnitId:r}=fs();return e.push(`/?${Is({programId:t,orgUnitId:r})}`),!1})(n)})(t.value.enrollmentPage))))}),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(E5.FETCH_TEI),(0,Rc.H)((e=>{let{payload:{teiId:t,programId:r}}=e;return(0,ZC.H)(n((a=t,{resource:"tracker/trackedEntities",id:a,params:{fields:["attributes","trackedEntityType"]}})).then((e=>{let{attributes:n,trackedEntityType:a}=e;const o=sW(n,a,t);return i={teiDisplayName:o,tetId:a,teiId:t,programId:r},l(E5.VERIFY_FETCH_TEI_SUCCESS)(i);var i})).catch((()=>(e=>l(E5.FETCH_TEI_ERROR)({teiId:e}))(t))));var a})))}),((e,t)=>e.pipe((0,i.g)(E5.VERIFY_FETCH_TEI_SUCCESS),(0,mf.p)((()=>C9(t))),(0,s.T)((e=>{let{payload:t}=e;return(e=>l(E5.FETCH_TEI_SUCCESS)(e))(t)})))),(e=>e.pipe((0,i.g)(E5.FETCH_TEI_ERROR),(0,s.T)((e=>{let{payload:{teiId:t}}=e;return f5({error:n.A.t('Tracked entity instance with id "{{teiId}}" does not exist',{teiId:t})})})))),((e,t)=>e.pipe((0,i.g)(E5.PROCESS_PROGRAM_ID,E5.FETCH_ENROLLMENT_ID_SUCCESS,E5.RESET_ENROLLMENT_ID),(0,mf.p)((e=>{let{payload:{programId:r}}=e;return C9(t)&&t.value.enrollmentPage.programId!==r})),(0,s.T)((e=>{let{payload:{programId:t}}=e;const{scopeType:r}=(0,it.he)(t);return r===A9.m.TRACKER_PROGRAM?(e=>l(E5.COMMIT_TRACKER_PROGRAM_ID)({programId:e}))(t):t&&r!==A9.m.EVENT_PROGRAM?(e=>l(E5.PROGRAM_ID_ERROR)({programId:e}))(t):(e=>l(E5.COMMIT_NON_TRACKER_PROGRAM_ID)({programId:e}))(t)})))),(e=>e.pipe((0,i.g)(E5.PROGRAM_ID_ERROR),(0,s.T)((e=>{let{payload:{programId:t}}=e;return f5({error:n.A.t('Program with id "{{programId}}" does not exist',{programId:t})})})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(E5.FETCH_TEI_SUCCESS,E5.COMMIT_TRACKER_PROGRAM_ID,E5.COMMIT_NON_TRACKER_PROGRAM_ID),(0,mf.p)((()=>t.value.enrollmentPage.pageOpen)),(0,s.T)((()=>{const{teiId:e,programId:r}=t.value.enrollmentPage;return n.push(`/enrollment?${Is({...fs(),teiId:e,programId:r})}`),O9(t)&&(e=>{const{fetchStatus:t}=e.value.enrollmentPage;return t.programId===Y4})(t)?y5():C9(t)&&O9(t)?v5({accessLevel:Z4}):null})),(0,mf.p)((e=>e)))}),((e,t,r)=>{let{querySingleResource:a}=r;return e.pipe((0,i.g)(E5.FETCH_ENROLLMENTS),(0,Rc.H)((()=>{const{teiId:e,programId:r}=t.value.enrollmentPage;return(0,ZC.H)(a(((e,t)=>({resource:"tracker/trackedEntities",id:e,params:{program:t,fields:["enrollments"]}}))(e,r))).pipe((0,s.T)((e=>{let{enrollments:t}=e;const n=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).sort(((e,t)=>$().utc(t.enrolledAt).diff($().utc(e.enrolledAt))))}(t.filter((e=>e.program===r)));return(e=>{let{enrollments:t}=e;return l(E5.FETCH_ENROLLMENTS_SUCCESS)({enrollments:t})})({enrollments:n})})),(0,XC.W)((e=>{if(e.message){if(e.message.includes(e8))return(0,eO.of)(v5({accessLevel:X4}));if(e.message.includes(t8))return(0,eO.of)(v5({accessLevel:X4}));if(e.message.includes(r8))return(0,eO.of)(v5({accessLevel:J4}));if(e.message.includes(n8))return(0,eO.of)(v5({accessLevel:J4}))}const t=n.A.t("An error occurred while fetching enrollments. Please enter a valid url.");return(0,eO.of)(f5({error:t}))})),(0,s.T)((t=>(e=>{let{teiId:t,programId:r,action:n}=e;return l(E5.VERIFY_FETCHED_ENROLLMENTS)({teiId:t,programId:r,action:n})})({teiId:e,programId:r,action:t}))))})))}),((e,t)=>e.pipe((0,i.g)(E5.VERIFY_FETCHED_ENROLLMENTS),(0,mf.p)((()=>C9(t))),(0,mf.p)((e=>{let{payload:{teiId:r,programId:n}}=e;const{teiId:a,programId:o}=t.value.enrollmentPage;return r===a&&n===o})),(0,s.T)((e=>{let{payload:{action:t}}=e;return t})))),((e,t,r)=>{let{querySingleResource:n,history:a}=r;return e.pipe((0,i.g)(E5.FETCH_ENROLLMENTS),(0,s.T)((()=>(e=>{let{teiId:t,programId:r}=e;return{teiId:t,programId:r}})(t.value.enrollmentPage))),(0,Rc.H)((e=>{let{teiId:r,programId:o}=e;return(0,ZC.H)(n(((e,t)=>({resource:"tracker/trackedEntities",id:e,params:{program:t,fields:["programOwners[program,orgUnit]"]}}))(r,o))).pipe((0,s.T)((e=>{let{programOwners:t}=e;return t.find((e=>e.program===o))})),(0,mf.p)((e=>e)),(0,Rc.H)((e=>{return(0,ZC.H)(n((r=e.orgUnit,{resource:"organisationUnits",params:{query:r,withinUserHierarchy:!0,fields:"id"}}))).pipe((0,Rc.H)((r=>{let{organisationUnits:n}=r;if(n.length>0&&t.value.enrollmentPage.pageOpen){const{orgUnitId:t,...r}=fs();a.push(`/enrollment?${Is({...r,orgUnitId:e.orgUnit})}`)}return tO.w})),(0,XC.W)((()=>tO.w)));var r})),(0,XC.W)((()=>tO.w)))})))}),((e,t)=>e.pipe((0,i.g)(E5.RESET_ENROLLMENT_ID,E5.FETCH_ENROLLMENT_ID,E5.FETCH_TEI,E5.COMMIT_TRACKER_PROGRAM_ID),(0,mf.p)((()=>t.value.activePage.selectionsError)),(0,mf.p)((()=>{const e=t.value.enrollmentPage.fetchStatus;return e.enrollmentId!==q4&&e.programId!==q4&&e.teiId!==q4})),(0,s.T)((()=>l(E5.CLEAR_ERROR_VIEW)())))),((e,t,r)=>{let{history:n,serverVersion:{minor:a}}=r;return e.pipe((0,i.g)(Gv),(0,s.T)((e=>{const r=t.value,{dataEntryId:n,eventId:o,formFoundation:i,completed:s}=e.payload,d=yf(n,o),{formClientValues:c,mainDataClientValues:u}=wD(r,d,i),p=((e,t,r,n,a,o,i)=>{const s=t.convertValues(r,_i),l=CD(n,i),{teiId:d,enrollmentId:c,programId:u,orgUnitId:p}=fs();return l.status||(l.status=o?"ACTIVE":"COMPLETED"),{events:[{...l,program:u,programStage:t.id,orgUnit:p,trackedEntity:d,enrollment:c,...OD(e.currentSelections.categories,i),dataValues:Object.keys(s).map((e=>({dataElement:e,value:s[e]})))}]}})(r,i,c,u,0,s,a);return((e,t,r)=>{const n=Bv;return l(Bv)({selections:r},{offline:{effect:{url:"events",method:oc,data:e},commit:{type:kv,meta:{selections:r,relationshipData:t,triggerAction:n}},rollback:{type:$v,meta:{selections:r}}}})})(p,r.dataEntriesRelationships[d],r.currentSelections)})))}),(e=>e.pipe((0,i.g)($v),(0,s.T)((e=>{const t=e.meta.clientId;return lD(YR,t)})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(Gv),(0,s.T)((()=>{const{enrollmentId:e,programId:t,orgUnitId:r,teiId:a}=fs();return n.push(`/enrollment?${Is({programId:t,orgUnitId:r,teiId:a,enrollmentId:e})}`),pf()})))}),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(xJ),(0,s.T)((e=>e.payload.find((e=>e.type===jJ)))),(0,s.T)((e=>{const{dataEntryId:r,itemId:n,uid:a,orgUnit:o,rulesExecutionDependenciesClientFormatted:i}=e.payload;return zJ(t,r,n,a,o,0,i)})))}),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(MJ),(0,s.T)((e=>e.payload.find((e=>e.type===jJ)))),(0,s.T)((e=>{const{dataEntryId:r,itemId:n,uid:a,elementId:o,value:i,uiState:s,orgUnit:l,rulesExecutionDependenciesClientFormatted:d}=e.payload,c={elementId:o,value:i,valid:s.valid};return zJ(t,r,n,a,l,0,d,c)})))}),(e=>e.pipe((0,i.g)(CZ),(0,s.T)((e=>e.payload.find((e=>e.type===OZ)))),(0,s.T)((e=>{var t;const{relationship:r,serverData:n,linkMode:a,onSaveExternal:o,onSaveSuccessActionType:i,onSaveErrorActionType:s}=e.payload,d=null!==(t=n.events)&&void 0!==t?t:n.enrollments[0].events;return o&&o({linkMode:a,events:d,relationships:r?[r]:[],...n}),(e=>{let{serverData:t,onSaveErrorActionType:r,onSaveSuccessActionType:n}=e;return l(NZ)({},{offline:{effect:{url:"tracker?async=false",method:oc,data:t},commit:n&&{type:n,meta:{serverData:t}},rollback:r&&{type:r,meta:{serverData:t}}}})})({serverData:n,onSaveSuccessActionType:i,onSaveErrorActionType:s,...e.payload})})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(A0,O0),(0,s.T)((e=>{const r=[],{enrollmentDomain:a}=t.value,o=e.payload.bundleReport.typeReportMap.EVENT.objectReports,{serverData:{events:i,enrollments:s}}=e.meta,d=null!==i&&void 0!==i?i:s[0].events,c=a.enrollment.events,{eventsToCommit:u,eventsToAdd:p}=d.reduce(((e,t)=>{const r=c.find((e=>e.event===t.event));if(r){if(r.pendingApiResponse){const r=o.find((e=>e.uid===t.event));e.eventsToCommit.push(r)}}else e.eventsToAdd.push(t);return e}),{eventsToCommit:[],eventsToAdd:[]});if(p.length>0&&r.push(Ds({events:p})),u.length>0&&r.push((e=>{let{events:t}=e;return l(Ss.COMMIT_ENROLLMENT_EVENTS)({events:t})})({events:u})),a.eventSaveInProgress){const{linkMode:e,requestEventId:t,linkedEventId:r,linkedOrgUnitId:i}=a.eventSaveInProgress;if(o.find((e=>e.uid===t))){const{navigate:t}=N9({linkMode:e,linkedEventId:r,linkedOrgUnitId:i,history:n});t&&t()}}return(0,Xd.OJ)(r)})))}),(e=>e.pipe((0,i.g)(C0,N0),(0,s.T)((e=>{const{serverData:{events:t,enrollments:r}}=e.meta,n=null!==t&&void 0!==t?t:r[0].events;return(0,Xd.OJ)([Ns(),Os({events:n})])})))),(e=>e.pipe((0,i.g)(V$),(0,s.T)((e=>{const{eventId:t}=e.meta;return Cs(t)})))),(e=>e.pipe((0,i.g)(j$),(0,s.T)((e=>{const{eventId:t}=e.meta;return(0,Xd.OJ)([Ns(),As(t)])})))),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(GJ),(0,JC.n)((e=>{const t=e.payload;return n({resource:"me",params:{fields:"firstName,surname,username"}}).then((e=>{const r=$()().toISOString(),{userName:n,firstName:a,surname:o}=e,i=(0,_D.A)(),s={value:t.note,createdBy:{firstName:a,surname:o,uid:i},storedBy:n,storedAt:Ii(r,it.CO.DATETIME),clientId:(0,_D.A)()};return ov(t.dataEntryId,t.itemId,s)}))})))}),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(Uq),(0,JC.n)((e=>{const r=t.value,{enrollmentId:a,note:o}=e.payload;return n({resource:"me",params:{fields:"firstName, surname, userName"}}).then((e=>{const{firstName:t,surname:n,userName:i}=e,s=(0,_D.A)(),l={notes:[{value:o}]},d={value:o,createdBy:{firstName:t,surname:n,uid:s},updatedAt:$()().toISOString(),storedBy:i,storedAt:$()().toISOString()},c={enrollmentId:a,noteClientId:s};return(0,Xd.OJ)([jq(a,l,r.currentSelections,c),Gq(a,d)],Vq)}))})))}),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(oO.NAVIGATE_TO_ENROLLMENT_OVERVIEW),(0,JC.n)((e=>{var t;const{teiId:r,programId:a,orgUnitId:o}=e.payload,i=a&&((null===(t=e.payload)||void 0===t?void 0:t.enrollmentId)||"AUTO");return n.push(`/enrollment?${Is({teiId:r,programId:a,orgUnitId:o,enrollmentId:i})}`),tO.w})))}),((e,t,r)=>{let{serverVersion:{minor:n}}=r;return e.pipe((0,i.g)(JZ),(0,s.T)((e=>{const r=(0,yc.A)(),{scheduleDate:a,notes:o,programId:i,orgUnitId:s,stageId:d,teiId:c,enrollmentId:u,eventId:p=rR(),categoryOptions:m,onSaveExternal:g,onSaveSuccessActionType:h,onSaveErrorActionType:E,assignedUser:y}=e.payload,{events:v}=t.value,f=v[p]&&[Es.SCHEDULE,Es.OVERDUE].includes(v[p].status),I=m&&Pi(m,n);let b={events:[{scheduledAt:a,dataValues:[],trackedEntity:c,event:p,orgUnit:s,enrollment:u,program:i,programStage:d,status:"SCHEDULE",notes:null!==o&&void 0!==o?o:[],assignedUser:y}]};return I&&(b={events:[{...b.events[0],attributeCategoryOptions:I}]}),f?(g&&g(b.events[0]),((e,t,r,n)=>l(e0)({},{offline:{effect:{url:"tracker?async=false&importStrategy=UPDATE",method:oc,data:e},commit:r&&{type:r,meta:{eventId:t,serverData:e}},rollback:n&&{type:n,meta:{eventId:t,serverData:e}}}}))(b,p,h,E)):(g&&g(b,r),((e,t,r,n)=>l(ZZ)({},{offline:{effect:{url:"tracker?async=false",method:oc,data:e},commit:r&&{type:r,meta:{serverData:e,uid:t}},rollback:n&&{type:n,meta:{serverData:e,uid:t}}}}))(b,r,h,E))})))}),(e=>e.pipe((0,i.g)(gW),(0,s.T)((e=>{let{payload:{orgUnitId:t}}=e;return XN({orgUnitId:t,onSuccess:e=>(e=>l(hW)(e))(e),onError:yW})})))),((e,t,r)=>{let{querySingleResource:n}=r;return e.pipe((0,i.g)(KN),(0,Rc.H)((e=>{const{organisationUnits:r}=t.value,a=e.payload;return r[a.orgUnitId]?(0,eO.of)(a.onSuccess(r[a.orgUnitId])):(0,ZC.H)(async function(e,t){return Promise.all([t({resource:`organisationUnits/${e}`,params:{fields:"displayName,code,path"}}),qN(e)]).then((t=>{let[r,n]=t;return{id:e,name:r.displayName,code:r.code,path:r.path,groups:n}}))}(a.orgUnitId,n)).pipe((0,tR.Z)((e=>(0,eO.of)(JN(e),a.onSuccess(e)))),(0,XC.W)((e=>a.onError?(0,eO.of)(a.onError(e)):(0,eO.of)({}))))})))}),((e,t)=>e.pipe((0,i.g)(AK),(0,s.T)((e=>{const r=(0,yc.A)(),{formsValues:n}=t.value,{dataEntryId:a,itemId:o,orgUnitId:i,trackedEntityTypeId:s,trackedEntityInstanceId:d,formFoundation:c,onSaveExternal:u,onSaveSuccessActionType:p,onSaveErrorActionType:m}=e.payload,g=n[`${a}-${o}`],h=null===c||void 0===c?void 0:c.convertValues(g,oQ),E={trackedEntities:[{attributes:sQ(h),geometry:lQ(g),trackedEntity:d,trackedEntityType:s,orgUnit:i}]};return u&&u(E,r),(e=>{let{serverData:t,onSaveSuccessActionType:r,onSaveErrorActionType:n,uid:a}=e;return l(TK)({},{offline:{effect:{url:"tracker?async=false",method:oc,data:t},commit:{type:r,meta:{serverData:t,uid:a}},rollback:{type:n,meta:{serverData:t,uid:a}}}})})({serverData:E,onSaveSuccessActionType:p,onSaveErrorActionType:m,uid:r})})))),(e=>e.pipe((0,i.g)(CK),(0,s.T)((e=>{var t,r;const n=(null===(t=e.meta)||void 0===t||null===(r=t.serverData)||void 0===r?void 0:r.trackedEntities[0])||{},{attributes:a=[],geometry:o}=n;return(0,Xd.OJ)([kK(a,o)])})))),(e=>e.pipe((0,i.g)(OK),(0,s.T)((()=>PK(!0))))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(fC),(0,JC.n)((()=>{const{currentSelections:{programId:e,orgUnitId:r,trackedEntityTypeId:a}}=t.value;return n.push(`/new?${Is({programId:e,orgUnitId:r,trackedEntityTypeId:a})}`),tO.w})))}),((e,t,r)=>e.pipe((0,i.g)(L$),(0,s.T)((e=>{const{eventId:t,enrollmentId:n}=e.payload,a={enrollmentId:n},o={events:[{event:t}]};return r.history.push(`/enrollment?${Is(a)}`),((e,t,r)=>l(F$)({eventId:t},{offline:{effect:{url:"tracker?async=false&importStrategy=delete",method:oc,data:e},commit:{type:M$,meta:{eventId:t,params:r}},rollback:{type:x$,meta:{eventId:t,params:r}}}}))(o,t,a)})))),((e,t,r)=>{let{history:n}=r;return e.pipe((0,i.g)(G$,RZ),(0,KC.q)((e=>{const{isCreateNew:t,enrollmentId:r,orgUnitId:a,programId:o,teiId:i,availableProgramStages:s}=e.payload,l={enrollmentId:r,orgUnitId:a,programId:o,teiId:i};if(t){const e=1===s.length?{...l,stageId:s[0].id}:l;return setTimeout((()=>{n.push(`/enrollmentEventNew?${Is(e)}`)}),0),tO.w}return n.push(`/enrollment?${Is(l)}`),tO.w})))}),((e,t,r)=>{let{serverVersion:{minor:n}}=r;return e.pipe((0,i.g)(B$),(0,s.T)((e=>{const{itemId:r,dataEntryId:a,formFoundation:o,onSaveAndCompleteEnrollmentExternal:i,onSaveAndCompleteEnrollmentSuccessActionType:s,onSaveAndCompleteEnrollmentErrorActionType:l,enrollment:d}=e.payload,c=t.value,u=yf(a,r),p=c.dataEntries[a].eventId,m=c.formsValues[u],g=c.dataEntriesFieldsValue[u],h=c.dataEntriesFieldsMeta[u],E=c.viewEventPage.loadedValues.eventContainer.event,{formClientValues:y,dataEntryClientValues:v}=SD(o,m,g,h),f={...E,...v,notes:[]},I=o.convertValues(y,_i),b={...CD(f,n),attributeOptionCombo:void 0,dataValues:o.getElements().map((e=>{let{id:t}=e;return{dataElement:t,value:I[t]||null}}))},S=d.events?{...d,events:[b,...d.events]}:{...d,events:[b]},T={enrollments:[S]};return i&&i(S),(0,Xd.OJ)([H$(p,T,s,l)])})))}));function w9(e,t,r){const n=function(e){return e.reduce(((e,t)=>(e[t.name]=tc(t),e)),{})}(e3),a=(0,qd.combineReducers)({...n}),{middleware:o,enhanceReducer:i,enhanceStore:s}=(0,nc.mo)({...ac.default,discard:hc,effect:lc(t.mutate),persistCallback:r,queue:uc,persistOptions:{storage:Ec(),whitelist:["offline","networkStatus"]}}),l=(0,Kd.C)({dependencies:{...t,history:e}}),d=[l,o];"production"!==F.prod&&d.push((0,Jd.createLogger)({collapsed:!0,diff:!0}));const c=(0,qd.createStore)((0,Xd.yF)(i(a)),(0,Qd.tY)((0,qd.compose)(s,(0,qd.applyMiddleware)(...d))));return l.run(R9),c}const _9=e=>{const{onRunApp:t,onCacheExpired:r}=e,[n,a]=y.useState(null),{querySingleResource:o,mutate:i,absoluteApiPath:s,serverVersion:l}=(()=>{const e=(0,A.ow)(),{serverVersion:t}=(0,A.UK)();return(0,y.useMemo)((()=>({querySingleResource:D(e.query.bind(e)),mutate:e.mutate.bind(e),absoluteApiPath:(0,j.c$)(e.link.config.baseUrl,e.link.versionedApiPath),serverVersion:t})),[e,t])})(),d=(0,T.W6)(),c=(0,y.useCallback)((e=>{e instanceof Error?S().error(e.toString()):e&&S().error(JSON.stringify(e))}),[]),u=(0,y.useCallback)((async()=>{try{(0,G.An)(l),await Yd(r,o,l.minor);const e=w9(d,{querySingleResource:o,mutate:i,absoluteApiPath:s,serverVersion:l},(()=>t(e)))}catch(e){let t="The application could not be loaded.";e&&e instanceof k?(c(e.innerError),t+=` ${e.toString()}`):(c(e),"production"!==F.prod?t+=" Please verify that the server is running.":t+=" Please see log for details."),a(t)}}),[c,r,t,o,i,s,d,l]);return(0,y.useEffect)((()=>{u()}),[u]),n||y.createElement(O,null)};var P9=r(99473),k9=r(1872),D9=r(33666);const U9=(0,I.withStyles)((()=>({closeButton:{marginTop:"5px"},actionContainer:{paddingRight:2}})))((e=>{let{feedback:t={},onClose:r}=e;const{message:a,displayType:o}=t,i="string"===typeof a&&!o,s="object"===typeof a&&"dialog"===o;return y.createElement(y.Fragment,null,y.createElement(k9.Z,null,i&&y.createElement(D9.A,{duration:5e3},a)),s&&y.createElement(N.a,{hide:!s},y.createElement(Ip.w,null,(null===a||void 0===a?void 0:a.title)||""),y.createElement(R.$,null,(null===a||void 0===a?void 0:a.content)||""),y.createElement(ta.N,null,y.createElement(ra.$,{onClick:r,primary:!0},n.A.t("Close")))))})),L9=(0,gs.Ng)((e=>({feedback:e.feedbacks&&e.feedbacks[0]?e.feedbacks[0]:void 0})),(e=>({onClose:()=>{e(l(_4)())}})))(U9);function F9(){return F9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},F9.apply(this,arguments)}const x9=(e,t)=>class r extends y.Component{static getValueFromParam(e,t){let r=null;if(e&&e.length>0){const n=new RegExp(`${t}=`,"i");r=e[e.length-1].replace(n,"").trim()||null}return r}static getNextProps(e,t){return Object.keys(e).reduce(((r,n)=>(r[(t.find((e=>e.urlParameterName===n))||{}).urlParameterName||n]=e[n],r)),{})}componentDidMount(){this.triggerSyncCallback()}componentDidUpdate(){this.triggerSyncCallback()}update(e){this.props.onUpdate(e)}noUpdateRequired(){this.props.onNoUpdateRequired&&this.props.onNoUpdateRequired()}triggerSyncCallback(){this.queuedUpdate?(this.update({nextProps:this.queuedUpdate.nextProps,prevProps:this.props.stateParams||{},nextPage:this.props.urlPage,prevPage:this.props.statePage}),this.queuedUpdate=null):this.noUpdateRequired()}paramsNeedsUpdate(e,t){return e.some((e=>t[e.urlParameterName]!==(this.props.stateParams&&this.props.stateParams[e.urlParameterName]||void 0)))}isOutOfSync(){const e=t(this.props),{history:{location:n},statePage:a,urlPage:o}=this.props,i=(0,O5.parse)(n&&n.search),s=this.paramsNeedsUpdate(e,i);if(o!==a||s){const t=r.getNextProps(i,e);return this.queuedUpdate={nextProps:t},!0}return!1}render(){const{onUpdate:t,urlParams:r,stateParams:n,urlPage:a,statePage:o,...i}=this.props;return this.isOutOfSync()&&w5(a)?y.createElement(e,F9({urlOutOfSync:!0},i)):y.createElement(e,i)}};var M9=r(95114);function V9(){return V9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V9.apply(this,arguments)}const j9=(0,I.withStyles)((()=>({container:{flexGrow:2,flexBasis:0},dataEntryContent:{display:"flex",gap:yn.Q.dp8},dataEntryContainer:{flexGrow:1},headerContainer:{display:"flex",width:"100%",alignItems:"center",justifyContent:"space-between"},actionsContainer:{flexShrink:0,display:"flex",gap:yn.Q.dp4},button:{whiteSpace:"nowrap"},editButtonContainer:{}})))((e=>{const{classes:t,eventId:r,onOpenEditEvent:a,showEditEvent:o,programStage:i,eventAccess:s,onBackToAllEvents:l,programId:d,...c}=e,u=(0,gs.d4)((e=>{var t,r;let{viewEventPage:n}=e;return null===(t=n.loadedValues)||void 0===t||null===(r=t.orgUnit)||void 0===r?void 0:r.id})),{formFoundation:p}=JR({programId:d}),{orgUnit:m,error:g}=ZN(u),{programCategory:h,isLoading:E}=RS(d),v=(0,Zo.useQueryClient)(),f=(0,j.iT)(j.Gv.changelogs),[I,b]=(0,y.useState)(!1),[S,T]=(0,y.useState)(!1),A=()=>{const e=[ei,"changelog",gQ.EVENT,r];v.removeQueries(e),l()};if(g)return g.errorComponent;return m&&p&&!E?y.createElement("div",{className:t.container},y.createElement(Ww,{header:y.createElement("div",{className:t.headerContainer},y.createElement(zw,{text:n.A.t("Event details"),icon:M9.A}),(()=>{const e=s.write;return y.createElement("div",{className:t.actionsContainer},!o&&!E&&y.createElement("div",{className:t.editButtonContainer},y.createElement(aI,{content:n.A.t("You don't have access to edit this event"),enabled:!e},y.createElement(ra.$,{className:t.button,onClick:()=>a(m,h),disabled:!e,secondary:!0,small:!0},n.A.t("Edit event")))),f&&y.createElement(wI,{open:S,onClick:()=>T((e=>!e)),secondary:!0,small:!0,icon:y.createElement(DH.A,null),component:y.createElement(AI.n,{dense:!0},y.createElement(bh.D,{label:n.A.t("View changelog"),onClick:()=>{b(!0),T(!1)}}))}))})())},y.createElement("div",{className:t.dataEntryContainer},y.createElement("div",{className:t.dataEntryContainer},o?y.createElement(I1,V9({dataEntryId:M.SINGLE_EVENT,formFoundation:p,orgUnit:m,onSaveExternal:A,programId:d},c)):y.createElement($1,V9({dataEntryId:M.SINGLE_EVENT,formFoundation:p,programId:d},c)))),o&&y.createElement(iH,{formId:`${M.SINGLE_EVENT}-${V.EDIT}`})),f&&I&&y.createElement(H1,{isOpen:!0,setIsOpen:b,eventId:r,formFoundation:i.stageForm})):null})),G9=(0,gs.Ng)((e=>({showEditEvent:e.viewEventPage.eventDetailsSection&&e.viewEventPage.eventDetailsSection.showEditEvent,eventId:e.viewEventPage.eventId,programId:e.currentSelections.programId})),(e=>({onOpenEditEvent:(t,r)=>{e(((e,t)=>l(b$)({orgUnit:e,programCategory:t}))(t,r))}})))(j9),B9=(0,gs.Ng)((()=>{const e=t_();return(t,r)=>{const n=t.rulesEffectsGeneralErrors[r.dataEntryKey];return{errors:e({messagesContainer:n,containerPropNameMain:"error",containerPropNameOnComplete:"errorOnComplete",showOnComplete:!0})}}}),(()=>({})))(Qw),$9=(0,gs.Ng)((()=>{const e=t_();return(t,r)=>{const n=t.rulesEffectsGeneralWarnings[r.dataEntryKey];return{warnings:e({messagesContainer:n,containerPropNameMain:"warning",containerPropNameOnComplete:"warningOnComplete",showOnComplete:!0})}}}),(()=>({})))(i_),W9=e=>{let{name:t,id:r,orgUnitId:n,linkProgramId:a}=e;const o=(0,y.useCallback)((()=>`/#/enrollment?${Is({teiId:r,programId:a,orgUnitId:n,enrollmentId:"AUTO"})}`),[r,n,a]);return y.createElement("a",{href:o(),target:"_blank",rel:"noopener noreferrer"},t)},H9="TRACKED_ENTITY_INSTANCE",z9=e=>{const{type:t,...r}=e;return t!==H9?y.createElement(y.Fragment,null,e.name):y.createElement(W9,r)};function Y9(){return Y9=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Y9.apply(this,arguments)}function q9(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const K9=Dp(null,(e=>({style:e.loadingIndicatorStyle})))(fI),Q9={height:36,width:36},X9=n.A.t("Relationships");class J9 extends y.Component{constructor(){super(...arguments),q9(this,"renderHeader",(()=>{const{classes:e,relationships:t,ready:r}=this.props;let n=t?t.length:0;return n=r?n:null,y.createElement(zw,{icon:nz.A,text:X9,badgeClass:e.badge,badgeCount:n})})),q9(this,"handleOpenAddRelationship",(()=>{this.props.onOpenAddRelationship()})),q9(this,"handleRemoveRelationship",(e=>{this.props.onDeleteRelationship(e)})),q9(this,"renderItems",(e=>e.map((e=>y.createElement("div",{className:this.props.classes.relationship},e))))),q9(this,"renderConnectedEntity",(e=>{const{orgUnitId:t}=this.props;return y.createElement(z9,Y9({orgUnitId:t},e))}))}render(){const{programStage:e,eventId:t,relationships:r,ready:n,eventAccess:a}=this.props,o=(e.relationshipTypes||[]).length>0,i=e.relationshipTypesWhereStageIsFrom.filter((e=>e.access.data.write));return o&&y.createElement(Ww,{collapsable:!0,header:this.renderHeader()},y.createElement(K9,{loadingIndicatorStyle:Q9,ready:n,relationships:r,writableRelationshipTypes:i,onOpenAddRelationship:this.handleOpenAddRelationship,onRemoveRelationship:this.handleRemoveRelationship,currentEntityId:t,entityAccess:a,smallMainButton:!0,onRenderConnectedEntity:this.renderConnectedEntity}))}}const Z9=(0,I.withStyles)((e=>({badge:{backgroundColor:e.palette.grey.light},relationship:{marginTop:e.typography.pxToRem(5),marginBottom:e.typography.pxToRem(5),padding:e.typography.pxToRem(10),borderRadius:e.typography.pxToRem(4),backgroundColor:e.palette.grey.lighter}})))(J9),e7=(0,gs.Ng)((e=>{const t=e.viewEventPage.relationshipsSection||{};return{eventId:e.viewEventPage.eventId,ready:!t.isLoading,relationships:e.relationships.viewEvent||[],orgUnitId:e.currentSelections.orgUnitId}}),(e=>({onOpenAddRelationship:()=>{e(l(cU)())},onDeleteRelationship:t=>{e((e=>l(g$)({clientId:e}))(t))}})))(Z9);var t7=r(26073);function r7(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const n7=Dp(null,(e=>({style:e.loadingIndicatorStyle})))(lI),a7={height:36,width:36},o7=n.A.t("Notes");class i7 extends y.Component{constructor(){super(...arguments),r7(this,"renderHeader",(()=>{const{classes:e,notes:t,ready:r}=this.props;let n=t?t.length:0;return n=r?n:null,y.createElement(zw,{icon:t7.A,text:o7,badgeClass:e.badge,badgeCount:n})}))}render(){const{notes:e,fieldValue:t,onAddNote:r,ready:n,programStage:a,eventAccess:o}=this.props;return y.createElement(Ww,{collapsable:!0,header:this.renderHeader()},y.createElement(n7,{loadingIndicatorStyle:a7,ready:n,notes:e,entityAccess:o,addNotAllowed:!a.stageForm.access.data.write,onAddNote:r,onBlur:this.props.onUpdateNoteField,value:t,smallMainButton:!0}))}}const s7=(0,I.withStyles)((e=>({badge:{backgroundColor:e.palette.grey.light},note:{marginTop:e.typography.pxToRem(5),marginBottom:e.typography.pxToRem(5),padding:e.typography.pxToRem(10),borderRadius:e.typography.pxToRem(4),backgroundColor:e.palette.grey.lighter}})))(i7),l7=(0,gs.Ng)((e=>{const t=e.viewEventPage.notesSection||{};return{notes:e.notes.viewEvent||[],ready:!t.isLoading,fieldValue:t.fieldValue}}),(e=>({onAddNote:t=>{e((e=>l(X$)({note:e}))(t))},onUpdateNoteField:t=>{e((e=>l(tW)({value:e}))(t))}})))(s7);function d7(){return d7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d7.apply(this,arguments)}function c7(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const u7=[{id:"ErrorsSection",Component:B9},{id:"WarningsSection",Component:$9},{id:"FeedbacksSection",Component:m_},{id:"IndicatorsSection",Component:f_},{id:"AssigneeSection",Component:e=>{let{assignee:t,programStage:r,getAssignedUserSaveContext:n,eventAccess:a,onSaveAssignee:o,onSaveAssigneeError:i}=e;return y.createElement(c2,{enabled:(null===r||void 0===r?void 0:r.enableUserAssignment)||!1,assignee:t,getSaveContext:n,writeAccess:(null===a||void 0===a?void 0:a.write)||!1,onSave:o,onSaveError:i})}},{id:"RelationshipsSection",Component:e7},{id:"NotesSection",Component:l7}];class p7 extends y.Component{constructor(){super(...arguments),c7(this,"renderComponent",((e,t)=>y.createElement(e.Component,d7({key:e.id},t))))}render(){const{classes:e,...t}=this.props;return y.createElement("div",{className:this.props.classes.container},u7.map((e=>this.renderComponent(e,t))))}}const m7=(0,I.withStyles)((e=>({container:{display:"flex",flexDirection:"column",flexBasis:e.typography.pxToRem(0),flexGrow:1,minWidth:e.typography.pxToRem(300),gap:yn.Q.dp16}})))(p7);function g7(){return g7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g7.apply(this,arguments)}const h7=Object.freeze({MAIN_PAGE:"mainPage",VIEW_EVENT:"viewEvent",EDIT_EVENT:"editEvent"}),E7=(0,I.withStyles)({container:{display:"flex",alignItems:"center"}})((e=>{let{page:t,programId:r,userInteractionInProgress:a,onBackToMainPage:o,classes:i}=e;const[s,l]=(0,y.useState)(null),{label:d}=(e=>{let{programId:t}=e;const r=(0,gs.d4)((e=>{let{workingListsTemplates:t}=e;return null===t||void 0===t?void 0:t.eventList})),a=(0,gs.d4)((e=>{var t;let{workingListsContext:r}=e;return null===r||void 0===r||null===(t=r.eventList)||void 0===t?void 0:t.programIdView})),{selectedTemplateId:o,templates:i,loading:s}=null!==r&&void 0!==r?r:{},l=null===i||void 0===i?void 0:i.find((e=>{let{id:t}=e;return t===o})),d=null===l||void 0===l?void 0:l.isDefault,c=a===t;return{label:(0,y.useMemo)((()=>s?"...":c&&!d&&l?l.name:n.A.t("Event list")),[d,c,s,l])}})({programId:r}),c=(0,y.useCallback)(((e,t)=>{a?l(t):e&&e()}),[a]),u=(0,y.useMemo)((()=>[{key:h7.MAIN_PAGE,onClick:()=>c(o,h7.MAIN_PAGE),label:d,selected:t===h7.MAIN_PAGE,condition:!0},{key:h7.VIEW_EVENT,onClick:()=>c(null,h7.VIEW_EVENT),label:n.A.t("View event"),selected:t===h7.VIEW_EVENT,condition:t===h7.VIEW_EVENT||t===h7.EDIT_EVENT},{key:h7.EDIT_EVENT,onClick:()=>{},label:n.A.t("Edit event"),selected:t===h7.EDIT_EVENT,condition:t===h7.EDIT_EVENT}].filter((e=>!1!==e.condition))),[d,c,o,t]);return y.createElement("div",{className:i.container},u.map(((e,t)=>y.createElement(y.Fragment,{key:e.key},y.createElement(J2,{label:e.label,onClick:e.onClick,selected:e.selected,classes:i}),t<u.length-1&&y.createElement(K2.A,{color:vn.T.grey800})))),y.createElement(Rf,g7({open:s===h7.MAIN_PAGE,onCancel:()=>l(null),onDestroy:o},wf)))}));function y7(){return y7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y7.apply(this,arguments)}function v7(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class f7 extends y.Component{constructor(e){super(e),v7(this,"handleGoBackToAllEvents",(()=>{const{isUserInteractionInProgress:e,onBackToAllEvents:t}=this.props;e?this.setState({warningOpen:!0}):t()})),this.state={warningOpen:!1}}render(){const{classes:e,programId:t,programStage:r,showEditEvent:a,onBackToViewEvent:o,isUserInteractionInProgress:i,currentDataEntryKey:s,eventAccess:l,assignee:d,getAssignedUserSaveContext:c,onSaveAssignee:u,onSaveAssigneeError:p,onBackToAllEvents:m}=this.props;return y.createElement("div",{className:e.container},y.createElement(E7,{programId:t,page:a?h7.EDIT_EVENT:h7.VIEW_EVENT,userInteractionInProgress:i,onBackToViewEvent:o,onBackToMainPage:m}),y.createElement("div",null,y.createElement(ra.$,{className:e.showAllEvents,onClick:this.handleGoBackToAllEvents,small:!0,icon:y.createElement(RO.A,null)},n.A.t("Show all events")),y.createElement("div",{className:e.contentContainer},y.createElement(G9,{eventAccess:l,programStage:r,onBackToAllEvents:m}),y.createElement(m7,{eventAccess:l,programStage:r,dataEntryKey:s,assignee:d,getAssignedUserSaveContext:c,onSaveAssignee:u,onSaveAssigneeError:p}))),y.createElement(Rf,y7({},wf,{onCancel:()=>{this.setState({warningOpen:!1})},onDestroy:()=>this.props.onBackToAllEvents(),open:this.state.warningOpen})))}}const I7=(0,I.withStyles)((e=>({container:{display:"flex",flexDirection:"column",gap:yn.Q.dp12,padding:e.typography.pxToRem(24),paddingTop:e.typography.pxToRem(10)},dataEntryPaper:{marginBottom:e.typography.pxToRem(10),padding:e.typography.pxToRem(10)},showAllEvents:{marginBottom:yn.Q.dp12},header:{...e.typography.title,fontSize:18,padding:e.typography.pxToRem(10),borderBottom:`1px solid ${e.palette.grey.blueGrey}`},contentContainer:{display:"flex",flexWrap:"wrap",gap:yn.Q.dp16}})))(f7),b7=e=>e.currentSelections.programId,S7=e=>e.currentSelections.categoriesMeta,T7=e=>{var t;return null===(t=e.viewEventPage.loadedValues)||void 0===t?void 0:t.eventContainer},A7=(0,gs.Ng)(((e,t)=>{const r=(0,fg.Mz)(b7,(e=>(0,it.n$)(e).stage)),n=(0,fg.Mz)(b7,S7,((e,t)=>(0,it.xv)(e,t))),a=(o=t.serverMinorVersion,(0,fg.Mz)(T7,(e=>{const{event:t,values:r}=e,n=(0,it.n$)(t.programId).stage.stageForm.convertValues(r,_i),a={...CD(t,o),dataValues:Object.keys(n).map((e=>({dataElement:e,value:n[e]})))};return{event:a}})));var o;return e=>{var t;const o=e.viewEventPage.eventDetailsSection||{},i=o.showEditEvent?yf(M.SINGLE_EVENT,V.EDIT):yf(M.SINGLE_EVENT,V.VIEW),s=Df(e,i);return{programStage:r(e),eventAccess:n(e),error:e.viewEventPage.loadError,currentDataEntryKey:i,isUserInteractionInProgress:s,assignee:null===(t=e.viewEventPage.loadedValues)||void 0===t?void 0:t.eventContainer.event.assignee,getAssignedUserSaveContext:()=>a(e),eventId:e.viewEventPage.eventId,showEditEvent:o.showEditEvent}}}),(e=>({onBackToAllEvents:()=>{e(l(dU)())},dispatch:e})),((e,t,r)=>{const n={onSaveAssignee:r=>{var n,a;t.dispatch((n=r,a=e.eventId,l(gU)({assignee:n,eventId:a})))},onSaveAssigneeError:r=>{var n,a;t.dispatch((n=r,a=e.eventId,l(hU)({assignee:n,eventId:a})))}};return Object.assign({},r,e,t,n)}))(qm()(I7));function C7(){return C7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},C7.apply(this,arguments)}function O7(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class N7 extends y.Component{constructor(e){super(e),O7(this,"handleDiscard",(()=>{this.setState({discardDialogOpen:!0})})),O7(this,"handleCancelDiscard",(()=>{this.setState({discardDialogOpen:!1})})),O7(this,"renderHeader",(()=>y.createElement("div",{className:this.props.classes.headerContainer},y.createElement("div",{className:this.props.classes.header},n.A.t("New event relationship"))))),this.state={discardDialogOpen:!1}}render(){const{classes:e,onCancel:t,...r}=this.props;return y.createElement("div",{className:e.container},y.createElement("div",{className:e.backToEventContainer},y.createElement("span",null,n.A.t("Adding relationship to event.")),y.createElement(Mg,{className:e.backToEventButton,onClick:this.handleDiscard},n.A.t("Go back to event without saving relationship"))),y.createElement(vR.Z,{className:e.newRelationshipPaper},y.createElement(vk,C7({header:n.A.t("New event relationship"),onCancel:t},r))),y.createElement(Rf,{header:n.A.t("Discard unsaved changes?"),text:n.A.t("Leaving this page will discard any selections you made for a new relationship"),destructiveText:n.A.t("Yes, discard changes"),cancelText:n.A.t("No, cancel"),onDestroy:t,open:!!this.state.discardDialogOpen,onCancel:this.handleCancelDiscard}))}}const R7=(0,fp.default)((e=>({container:{padding:`${e.typography.pxToRem(10)} ${e.typography.pxToRem(24)}`},headerContainer:{display:"flex",justifyContent:"space-between",alignItems:"center"},header:{flexGrow:1,...e.typography.title,fontSize:18,fontWeight:500,paddingLeft:8},newRelationshipPaper:{marginBottom:e.typography.pxToRem(10),padding:e.typography.pxToRem(10)},backToEventContainer:{padding:8,borderRadius:4,display:"inline-block",marginBottom:10,backgroundColor:"#E9EEF4",color:"#494949",fontSize:14},backToEventButton:{backgroundColor:"inherit",fontSize:"inherit",color:"inherit"}})))(N7),w7=e=>e.currentSelections.programId,_7=(0,gs.Ng)((()=>{const e=(0,fg.Mz)(w7,(e=>(0,it.n$)(e).stage.relationshipTypesWhereStageIsFrom.filter((e=>"TRACKED_ENTITY_INSTANCE"===e.to.entity))));return t=>({relationshipTypes:e(t)})}),(e=>({onCancel:()=>{e(l(o$)({}))},onAddRelationship:(t,r,n)=>{e(((e,t,r)=>l(i$)({relationshipType:e,entity:t,entityType:r}))(t,r,n))}})))(R7),P7=e=>{let{programId:t,orgUnitId:r,selectedCategories:n,isUserInteractionInProgress:a,formIsOpen:o}=e;const i=(0,gs.wA)(),{resetViewEventId:s}=(()=>{const e=(0,T.W6)(),{pathname:t}=(0,T.zy)();return{resetViewEventId:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.push(`${r}?${Is({...n})}`)}}})(),{reset:d}=_W(),c=(0,y.useCallback)(((e,t)=>{i(((e,t)=>l(S4)({categoryId:e,categoryOption:t}))(t,e))}),[i]),u=(0,y.useCallback)((e=>{i((e=>l(T4)({categoryId:e}))(e))}),[i]),p=(0,y.useCallback)((()=>{i(l(A4)())}),[i]);return y.createElement(XW,{selectedProgramId:t,selectedOrgUnitId:r,selectedCategories:n,onResetProgramId:()=>s("/",{orgUnitId:r}),onResetOrgUnitId:()=>s("/",{programId:t}),onSetCategoryOption:c,onResetAllCategoryOptions:p,onResetCategoryOption:u,isUserInteractionInProgress:a,formIsOpen:o,onStartAgain:()=>d()},y.createElement(aH,{selectedProgramId:t,selectedOrgUnitId:r,isUserInteractionInProgress:a}))},k7=(0,gs.Ng)((e=>{const t=e.viewEventPage.eventDetailsSection||{},r=!(!e.currentSelections.complete||!t.showEditEvent)&&Df(e,`${M.SINGLE_EVENT}-${V.EDIT}`);return{error:e.activePage.viewEventLoadError&&e.activePage.viewEventLoadError.error,ready:!e.activePage.lockedSelectorLoads,isUserInteractionInProgress:r,showAddRelationship:e.viewEventPage.showAddRelationship}}))(Dp()(qm()((e=>{let{isUserInteractionInProgress:t,showAddRelationship:r}=e;const{serverVersion:{minor:n}}=(0,A.UK)();(0,y.useEffect)((()=>Fg.clear),[]);const{selectedCategories:a,programId:o,orgUnitId:i}=(0,gs.d4)((e=>{let{currentSelections:t}=e;return{selectedCategories:t.categoriesMeta,programId:t.programId,orgUnitId:t.orgUnitId}}));return y.createElement("div",null,y.createElement(P7,{programId:o,orgUnitId:i,selectedCategories:a,isUserInteractionInProgress:t,formIsOpen:!0}),y.createElement(vW,{orgUnitId:i},r?y.createElement(_7,null):y.createElement(A7,{programId:o,serverMinorVersion:n})))})))),D7=(0,I.withStyles)((()=>({container:{background:vn.T.white,border:"1px solid",borderColor:vn.T.grey400,borderRadius:3,padding:yn.Q.dp16},headerContainer:{marginBottom:yn.Q.dp16},title:{fontSize:16,color:vn.T.grey800,fontWeight:500}})))((e=>{let{children:t,classes:{container:r,headerContainer:a,listContainer:o,title:i}}=e;return y.createElement("div",{className:r},y.createElement("div",{className:a},y.createElement("span",{className:i},n.A.t("Registered events"))),y.createElement("div",{className:o},t))}));function U7(){return U7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},U7.apply(this,arguments)}const L7=kR(),F7=e=>{let{eventRecords:t,columns:r,recordsOrder:n,...a}=e;const o=!!n;return y.createElement(L7,U7({},a,{hasData:o,dataSource:LL(t,n,r),columns:r,rowIdKey:"id"}))};function x7(){return x7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},x7.apply(this,arguments)}const M7=e=>{let{program:t,customColumnOrder:r,...n}=e;const a=t.stage,o=sG(a),i=UL(r,o),s=(0,y.useMemo)((()=>i.filter((e=>e.visible))),[i]);return y.createElement(F7,x7({},n,{columns:s}))};function V7(){return V7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V7.apply(this,arguments)}const j7=e=>{let{storeId:t}=e;const r=(0,gs.d4)((e=>{let{currentSelections:t}=e;return t.programId})),n=(0,y.useMemo)((()=>(0,it.n$)(r)),[r]);return y.createElement(M7,V7({},DL(t),{program:n}))},G7=e=>{let{storeId:t}=e;return y.createElement(j7,{storeId:t})};function B7(){return B7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},B7.apply(this,arguments)}const $7=Dp()(IB),W7=e=>{let{mutationInProgress:t,...r}=e;return y.createElement($7,B7({},r,{ready:!t}))};function H7(){return H7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},H7.apply(this,arguments)}const z7=e=>{let{isOnline:t,storeId:r,...n}=e;return y.createElement(D7,null,t?y.createElement(W7,H7({},n,{storeId:r})):y.createElement(G7,{storeId:r}))};function Y7(){return Y7=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Y7.apply(this,arguments)}const q7=e=>{let{...t}=e;const r=(0,gs.d4)((e=>{let{offline:{online:t},app:{goingOnlineInProgress:r}}=e;return!!t&&!r})),n=(0,gs.d4)((e=>{let{offline:{outbox:t}}=e;return t&&t.length>0}));return y.createElement(z7,Y7({},t,{storeId:"eventList",isOnline:r,mutationInProgress:n}))},K7=e=>{let{programId:t,orgUnitId:r,selectedTemplateId:n,onChangeTemplate:a}=e;const{programType:o}=dW(t);return o===it.S2.EVENT_PROGRAM?y.createElement(q7,{programId:t,orgUnitId:r}):o===it.S2.TRACKER_PROGRAM?y.createElement(y.Fragment,null,y.createElement(S9,{programId:t,orgUnitId:r,selectedTemplateId:n,onChangeTemplate:a})):null},Q7=Object.freeze({DEFAULT:"DEFAULT",WITHOUT_ORG_UNIT_SELECTED:"WITHOUT_ORG_UNIT_SELECTED",WITHOUT_PROGRAM_CATEGORY_SELECTED:"WITHOUT_PROGRAM_CATEGORY_SELECTED",CATEGORY_OPTION_INVALID_FOR_ORG_UNIT:"CATEGORY_OPTION_INVALID_FOR_ORG_UNIT",SHOW_WORKING_LIST:"SHOW_WORKING_LIST"}),X7={incompleteMessageContainer:{marginTop:"10px"},incompleteMessageContent:{display:"flex",flexDirection:"column",gap:"4px",textAlign:"center"},incompleteMessageButton:{background:"none",color:"inherit",border:"none",padding:0,font:"inherit",cursor:"pointer",outline:"inherit",textDecoration:"underline","&:hover":{color:vn.T.grey900}}},J7=(0,I.withStyles)(X7)((e=>{let{programId:t,setShowAccessible:r,classes:a}=e;const{program:o,programType:i}=dW(t),s=o&&o.name,l=(0,y.useMemo)((()=>i===it.S2.TRACKER_PROGRAM?n.A.t("Or see all records accessible to you in {{program}} ",{program:s,interpolation:{escapeValue:!1}}):n.A.t("Or see all events accessible to you in {{program}}",{program:s,interpolation:{escapeValue:!1}})),[s,i]);return y.createElement("div",{className:a.incompleteMessageContainer,"data-test":"without-orgunit-selected-message"},y.createElement(OO,null,y.createElement("div",{className:a.incompleteMessageContent},y.createElement("span",null,n.A.t("Please select an organisation unit.")),y.createElement("button",{className:a.incompleteMessageButton,onClick:()=>r(),"data-test":"show-accessible-button"},l))))})),Z7="Missing or invalid category options",eee="An error has occured. See log for details",tee=(0,I.withStyles)({incompleteMessageContainer:{marginTop:"10px"},incompleteMessageContent:{display:"flex",flexDirection:"column",gap:"4px",textAlign:"center"}})((e=>{let{programId:t,classes:r}=e;const{program:a}=dW(t),{categories:o}=(0,gs.d4)((e=>{let{currentSelections:t}=e;return{categories:t.categories}}),gs.bN);if(null===a||void 0===a||!a.categoryCombination)throw S().error((0,j.px)(Z7)({programId:t})),Error(n.A.t(eee));const i=[...a.categoryCombination.categories.values()].filter((e=>!o||!o[e.id]))[0].name;return y.createElement("div",{className:r.incompleteMessageContainer,"data-test":"without-category-selected-message"},y.createElement(OO,null,y.createElement("div",{className:r.incompleteMessageContent},y.createElement("span",null,n.A.t("Please select {{category}}.",{category:i,interpolation:{escapeValue:!1}})))))})),ree=e=>{const{template:t,onSelectTemplate:r}=e,{displayName:n}=t,a=(0,y.useCallback)((()=>{r(t)}),[r,t]),o=n.length>30?`${n.substring(0,27)}...`:n;return y.createElement(Aj,{content:n,placement:"top",openDelay:800,enabled:n.length>30,onClick:a},y.createElement(Fp.v,{marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,dataTest:"workinglist-template-selector-chip"},o))},nee=(0,I.withStyles)((()=>({configsContainer:{display:"flex",flexWrap:"wrap",padding:0,gap:"4px",marginBottom:yn.Q.dp8},chipContainer:{padding:0},innerContainer:{margin:`0 ${yn.Q.dp16} ${yn.Q.dp16}`,"&.empty":{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"}},text:{color:vn.T.grey700,fontSize:"14px",lineHeight:"19px","&:first-of-type":{marginBottom:0}},icon:{width:yn.Q.dp32,height:yn.Q.dp32}})))((e=>{const{templates:t,onSelectTemplate:r,onCreateTemplate:a,classes:o}=e,[i,s]=(0,y.useState)(!0),l=(0,y.useMemo)((()=>[...t].sort(((e,t)=>{let r,{sortOrder:n,displayName:a}=e,{sortOrder:o,displayName:i}=t;return r=n&&o?n-o:n?1:o?-1:Zh(a,i),r}))),[t]),d=l.map((e=>{const{id:t}=e;return y.createElement("div",{className:o.chipContainer,key:t},y.createElement(ree,{template:e,onSelectTemplate:r}))}));return y.createElement(Ib,{header:n.A.t("Saved lists in this program"),open:i,onClose:()=>s(!1),onOpen:()=>s(!0)},y.createElement("div",{className:er()(o.innerContainer,{empty:!l.length})},l.length>0?y.createElement("div",{className:o.configsContainer},d):y.createElement(y.Fragment,null,y.createElement(gn,{className:o.icon}),y.createElement("p",{className:o.text},n.A.t("Saved lists offer quick access to your most used views in a program.")),y.createElement("p",{className:o.text},n.A.t("There are no saved lists in this program yet, create one using the button below."))),y.createElement(ra.$,{small:!0,onClick:a,color:"secondary",dataTest:"template-selector-create-list"},n.A.t("Create saved list"))))})),aee=()=>{const e=(0,T.W6)(),{programId:t,orgUnitId:r}=vs(),{TEITemplates:n,loading:a}=(e=>{var t;const{error:r,loading:n,data:a,refetch:o}=(0,A.iO)((0,y.useMemo)((()=>({templates:{resource:"trackedEntityInstanceFilters",params:e=>{let{variables:t}=e;return{filter:`program.id:eq:${t.programId}`,fields:"id,displayName,access,sortOrder"}}}})),[]),{lazy:!0});return(0,y.useEffect)((()=>{o({variables:{programId:e}})}),[o,e]),{error:r,loading:n,TEITemplates:null!==a&&void 0!==a&&null!==(t=a.templates)&&void 0!==t&&t.trackedEntityInstanceFilters?a.templates.trackedEntityInstanceFilters:[]}})(t),{programStageTemplates:o,loading:i}=(e=>{var t;const r=(0,j.iT)(j.Gv.storeProgramStageWorkingList),{error:n,loading:a,data:o,refetch:i}=(0,A.iO)((0,y.useMemo)((()=>({templates:{resource:"programStageWorkingLists",params:e=>{let{variables:t}=e;return{filter:`program.id:eq:${t.programId}`,fields:"id,displayName,access,sortOrder"}}}})),[]),{lazy:!0});return(0,y.useEffect)((()=>{r&&i({variables:{programId:e}})}),[i,e,r]),{error:n,loading:a,programStageTemplates:null!==o&&void 0!==o&&null!==(t=o.templates)&&void 0!==t&&t.programStageWorkingLists?o.templates.programStageWorkingLists:[]}})(t);return!t||a||i?null:y.createElement(nee,{templates:[...n,...o],onSelectTemplate:n=>e.push(`/?${Is({orgUnitId:r,programId:t,selectedTemplateId:n.id})}`),onCreateTemplate:()=>e.push(`/?${Is({orgUnitId:r,programId:t,selectedTemplateId:`${t}-default`})}`)})},oee=(0,I.withStyles)({incompleteMessageContainer:{marginTop:"10px"}})((e=>{let{classes:t}=e;return y.createElement("div",{className:t.incompleteMessageContainer},y.createElement(OO,null,n.A.t("The category option is not valid for the selected organisation unit. Please select a valid combination.")))})),iee=(0,qd.compose)(Dp(),qm(),(0,I.withStyles)((()=>({listContainer:{padding:24},container:{display:"flex",flexWrap:"wrap",gap:yn.Q.dp16,padding:yn.Q.dp16},half:{flex:1},quarter:{flex:.4},searchBoxWrapper:{padding:yn.Q.dp16,background:vn.T.white,border:"1px solid",borderColor:vn.T.grey400,borderRadius:3}}))))((e=>{let{programId:t,orgUnitId:r,trackedEntityTypeId:n,displayFrontPageList:a,selectedTemplateId:o,MainPageStatus:i,setShowAccessible:s,classes:l,onChangeTemplate:d}=e;const c=(0,y.useMemo)((()=>!t||!r||!n||a||o),[t,r,n,a,o]);return y.createElement(y.Fragment,null,c?y.createElement(y.Fragment,null,i===Q7.WITHOUT_ORG_UNIT_SELECTED&&y.createElement(J7,{programId:t,setShowAccessible:s}),i===Q7.CATEGORY_OPTION_INVALID_FOR_ORG_UNIT&&y.createElement(oee,null),i===Q7.WITHOUT_PROGRAM_CATEGORY_SELECTED&&y.createElement(tee,{programId:t}),i===Q7.SHOW_WORKING_LIST&&y.createElement("div",{className:l.listContainer,"data-test":"main-page-working-list"},y.createElement(K7,{programId:t,orgUnitId:r,selectedTemplateId:o,onChangeTemplate:d}))):y.createElement("div",{className:l.container},y.createElement("div",{className:`${l.half} ${l.searchBoxWrapper}`},y.createElement(zO,{programId:t})),y.createElement("div",{className:l.quarter},y.createElement(aee,null))))})),see=e=>{let{selectedOrgUnitId:t}=e;const{categories:r,complete:n}=(0,gs.d4)((e=>{let{currentSelections:t}=e;return{categories:t.categories,complete:t.complete}}),gs.bN),a=r&&Object.values(r),{data:o,isLoading:i,isError:s}=ri(["categoryOptions",a],(()=>{return e=a,ve().getAll(z.CATEGORY_OPTIONS,{predicate:t=>{let{id:r,organisationUnits:n}=t;return e.includes(r)&&n}});var e}),{enabled:n&&t&&!!a&&a.length>0});return{categoryOptionIsInvalidForOrgUnit:(0,y.useMemo)((()=>!(!o||!o.length)&&o.every((e=>{let{organisationUnits:r}=e;return!r[t]}))),[o,t]),isLoading:i,isError:s}},lee=e=>{let{programId:t,orgUnitId:r,selectedCategories:n}=e;const a=(0,gs.wA)(),{setProgramId:o}=bW(),{setOrgUnitId:i}=SW(),{resetProgramIdAndSelectedTemplateId:s}=AW(),{resetOrgUnitId:d}=CW(),{reset:c}=_W(),u=(0,y.useCallback)(((e,t)=>{a(((e,t)=>l(f4)({categoryId:e,categoryOption:t}))(t,e))}),[a]),p=(0,y.useCallback)((e=>{a((e=>l(I4)({categoryId:e}))(e))}),[a]),m=(0,y.useCallback)((()=>{a(l(b4)())}),[a]),g=(0,y.useCallback)((e=>{i(e),a((e=>l(fW)({orgUnitId:e}))(e))}),[a,i]);return y.createElement(XW,{selectedProgramId:t,selectedOrgUnitId:r,selectedCategories:n,onSetProgramId:e=>o(e),onSetOrgUnit:e=>g(e),onResetProgramId:()=>s(),onResetOrgUnitId:()=>d(),onSetCategoryOption:u,onResetAllCategoryOptions:m,onResetCategoryOption:p,onStartAgain:()=>c()},y.createElement(aH,{selectedProgramId:t,selectedOrgUnitId:r}))},dee=e=>{let{programId:t,orgUnitId:r,selectedTemplateId:n,showAllAccessible:a,history:o}=e;r&&(n?o.push(`/?${Is({orgUnitId:r,programId:t,selectedTemplateId:n})}`):o.push(`/?${Is({orgUnitId:r,programId:t})}`)),a&&(n?o.push(`/?${Is({programId:t,selectedTemplateId:n})}&all`):o.push(`/?${Is({programId:t})}&all`))},cee=(0,gs.Ng)((e=>({error:e.activePage.selectionsError&&e.activePage.selectionsError.error,ready:!e.activePage.lockedSelectorLoads})))(Dp()((()=>{var e;const t=(0,gs.wA)(),r=(0,T.W6)(),{all:n,programId:a,orgUnitId:o,selectedTemplateId:i}=vs(),s=void 0!==n,{categories:d,selectedCategories:c,reduxSelectedTemplateId:u,workingListProgramId:p,error:m,ready:g}=(0,gs.d4)((e=>{var t,r;let{currentSelections:n,activePage:a,workingListsTemplates:o,workingListsContext:i}=e;return{categories:n.categories,selectedCategories:n.categoriesMeta,reduxSelectedTemplateId:null===(t=o.teiList)||void 0===t?void 0:t.selectedTemplateId,workingListProgramId:null===(r=i.teiList)||void 0===r?void 0:r.programIdView,ready:!a.isLoading&&!a.lockedSelectorLoads,error:a.selectionsError&&a.selectionsError.error}}),gs.bN),{categoryOptionIsInvalidForOrgUnit:h}=see({selectedOrgUnitId:o}),E=td.J.get(a),v=null===E||void 0===E||null===(e=E.trackedEntityType)||void 0===e?void 0:e.id,f=v&&(null===E||void 0===E?void 0:E.displayFrontPageList),I=(e=>{let{programId:t,selectedProgram:r,categories:n,orgUnitId:a,showAllAccessible:o,categoryOptionIsInvalidForOrgUnit:i}=e;const s=(0,y.useMemo)((()=>!a&&!o),[a,o]);return(0,y.useMemo)((()=>{if(!t)return Q7.DEFAULT;if(null!==r&&void 0!==r&&r.categoryCombination){if(!n)return Q7.WITHOUT_PROGRAM_CATEGORY_SELECTED;const e=Array.from(r.categoryCombination.categories.values());return e.some((e=>!n||!n[e.id]))?Q7.WITHOUT_PROGRAM_CATEGORY_SELECTED:s?Q7.WITHOUT_ORG_UNIT_SELECTED:e&&i?Q7.CATEGORY_OPTION_INVALID_FOR_ORG_UNIT:Q7.SHOW_WORKING_LIST}return s?Q7.WITHOUT_ORG_UNIT_SELECTED:Q7.SHOW_WORKING_LIST}),[t,r,s,n,i])})({programId:a,selectedProgram:E,categories:d,orgUnitId:o,showAllAccessible:s,categoryOptionIsInvalidForOrgUnit:h}),{onChangeTemplate:b,onSetShowAccessible:S}=(e=>{let{orgUnitId:t,programId:r,showAllAccessible:n,history:a}=e;return{onChangeTemplate:(0,y.useCallback)((e=>dee({programId:r,orgUnitId:t,selectedTemplateId:e,showAllAccessible:n,history:a})),[a,t,r,n]),onSetShowAccessible:(0,y.useCallback)((()=>a.push(`/?${Is({programId:r})}&all`)),[a,r])}})({orgUnitId:o,programId:a,showAllAccessible:s,history:r,dispatch:t});return(0,y.useEffect)((()=>{var e;t((e=s,l(mD)({newStatus:e})))}),[s,t]),(0,y.useEffect)((()=>{if(a&&v&&void 0===i){if(u&&p===a)return void dee({programId:a,orgUnitId:o,selectedTemplateId:u,showAllAccessible:s,history:r});if(!f)return;dee({programId:a,orgUnitId:o,selectedTemplateId:`${a}-default`,showAllAccessible:s,history:r})}}),[i,o,a,s,v,f,r,u,p]),y.createElement(vW,{orgUnitId:o,error:m},y.createElement(lee,{programId:a,orgUnitId:o,selectedCategories:c}),y.createElement(iee,{MainPageStatus:I,programId:a,orgUnitId:o,trackedEntityTypeId:v,selectedTemplateId:i,setShowAccessible:S,onChangeTemplate:b,error:m,ready:g,displayFrontPageList:f}))}))),uee=e=>{let{programId:t,orgUnitId:r}=e;const{setProgramId:n}=bW(),{setOrgUnitId:a}=SW(),{resetProgramId:o}=AW(),{resetOrgUnitId:i}=CW(),{reset:s}=_W();return y.createElement(XW,{selectedProgramId:t,selectedOrgUnitId:r,onSetProgramId:e=>n(e),onSetOrgUnit:e=>a(e),onResetProgramId:()=>o(),onResetOrgUnitId:()=>i(),onStartAgain:()=>s()},y.createElement(aH,{selectedProgramId:t,selectedOrgUnitId:r}))},pee=(0,qd.compose)((0,I.withStyles)((()=>({backButton:{margin:yn.Q.dp16,padding:"0"},container:{display:"flex",flexWrap:"wrap",margin:`0 ${yn.Q.dp16} 0`,gap:yn.Q.dp16},half:{flex:1},quarter:{flex:.4},searchBoxWrapper:{padding:yn.Q.dp16,background:vn.T.white,border:"1px solid",borderColor:vn.T.grey400,borderRadius:3}}))))((e=>{let{programId:t,orgUnitId:r,onNavigateToMainPage:a,classes:o}=e;return y.createElement(y.Fragment,null,y.createElement(uee,{programId:t,orgUnitId:r}),y.createElement(ra.$,{icon:y.createElement(RO.A,null),dataTest:"back-button",className:o.backButton,onClick:a},n.A.t("Back")),y.createElement("div",{className:o.container},y.createElement("div",{className:`${o.half} ${o.searchBoxWrapper}`},y.createElement(zO,{programId:t})),y.createElement("div",{className:o.quarter},y.createElement(aee,null))))})),mee=()=>{const e=(0,gs.wA)(),{programId:t,orgUnitId:r}=vs(),n=(0,y.useCallback)((()=>{e(l(h4)())}),[e]),a=(e=>{const t=ls();return(0,y.useMemo)((()=>{const{programId:r}=Object.values(t).map((t=>{let{programs:r}=t;return r.find((t=>{let{programId:r}=t;return r===e}))})).filter((e=>e))[0]||{};return r}),[e,t])})(t);return(0,y.useEffect)((()=>{t&&t!==a&&n()}),[t,a,n]),(0,y.useEffect)((()=>{e(l(E4)())}),[e]),y.createElement(WC.Provider,{value:{resultsPageSize:5}},y.createElement(pee,{programId:t,orgUnitId:r,onNavigateToMainPage:n}))},gee=e=>{const t=(0,gs.wA)();return(0,y.useEffect)((()=>()=>{t(ID())}),[t]),y.createElement(cR,e)},hee=e=>{let{onCancel:t,onSave:r}=e;return y.createElement(y.Fragment,null,y.createElement(ra.$,{onClick:t,secondary:!0},n.A.t("Cancel")),r&&y.createElement("div",{style:{marginLeft:8}},y.createElement(ra.$,{dataTest:"create-as-new-person",onClick:r,primary:!0},n.A.t("Save as new"))))},Eee=e=>{let{teiId:t,orgUnitId:r}=e;const a=(0,gs.wA)(),{programId:o}=vs();return y.createElement(ra.$,{small:!0,dataTest:"view-dashboard-button",onClick:()=>a(iO({teiId:t,orgUnitId:r,programId:o}))},n.A.t("View dashboard"))},yee=(0,I.withStyles)((e=>{let{typography:t}=e;return{container:{marginBottom:yn.Q.dp12,padding:yn.Q.dp16,background:vn.T.white,border:"1px solid",borderColor:vn.T.grey400,borderRadius:3},title:{padding:"8px 0 0px 8px",fontWeight:500,marginBottom:yn.Q.dp16},tetypeContainer:{marginTop:t.pxToRem(16)},registrationContainer:{marginLeft:t.pxToRem(8),marginRight:t.pxToRem(8)},marginBottom:{marginBottom:yn.Q.dp16},flexContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap"},flexItem:{flex:1,minWidth:"500px"},dataEntryReadyItem:{minWidth:"300px"}}}))((e=>{let{classes:t,setScopeId:r,selectedScopeId:a,dataEntryId:o,onSaveWithoutEnrollment:i,onSaveWithEnrollment:s,dataEntryIsReady:l,teiId:d,trackedEntityInstanceAttributes:c}=e;const{push:u}=(0,T.W6)(),{resultsPageSize:p}=(0,y.useContext)(WC),{scopeType:m,programName:g,trackedEntityName:h}=es(a),E=md(a),v=IN(),f=(0,y.useCallback)((()=>{let e;return e=m===it.m2.TRACKER_PROGRAM?Is({programId:a,orgUnitId:v}):Is({orgUnitId:v}),u(`/?${e}`)}),[v,u,m,a]),I=e=>{r(e)},b=(0,y.useCallback)(((e,t)=>y.createElement(hee,{onCancel:e,onSave:t})),[]),S=(0,y.useCallback)((e=>{let{item:t}=e;return y.createElement(Eee,{teiId:t.id,orgUnitId:t.tei.orgUnit})}),[]),A=(0,y.useCallback)((e=>{let{teiId:t}=e;const r=(0,gs.wA)(),{programId:a,orgUnitId:o}=vs();return y.createElement(ra.$,{dataTest:"existing-unique-value-link-tei-button",primary:!0,onClick:()=>r(iO({teiId:t,orgUnitId:o,programId:a}))},n.A.t("View dashboard"))}),[]);return y.createElement(y.Fragment,null,!m&&y.createElement("div",{className:t.container},y.createElement("div",{className:t.title},n.A.t("New")),y.createElement("div",{className:t.tetypeContainer},y.createElement(TO,{onSelect:I,headerText:n.A.t("Create for"),footerText:n.A.t("You can also choose a program from the top bar and create in that program"),accessNeeded:"write"}))),m===it.m2.TRACKER_PROGRAM&&y.createElement("div",{className:t.container},y.createElement("div",{className:t.title},d?n.A.t("New Enrollment in program{{escape}} {{programName}}",{escape:":",programName:g,interpolation:{escapeValue:!1}}):n.A.t("New {{titleText}}",{titleText:E,interpolation:{escapeValue:!1}})),y.createElement("div",{className:t.flexContainer},y.createElement("div",{className:t.flexItem},y.createElement(gee,{id:o,orgUnitId:v,teiId:d,selectedScopeId:a,onSave:s,onCancel:f,saveButtonText:e=>n.A.t("Save {{trackedEntityTypeName}}",{trackedEntityTypeName:e,interpolation:{escapeValue:!1}}),duplicatesReviewPageSize:p,renderDuplicatesDialogActions:b,renderDuplicatesCardActions:S,ExistingUniqueValueDialogActions:A,trackedEntityInstanceAttributes:c})),l&&y.createElement("div",{className:t.dataEntryReadyItem},y.createElement(C_,{selectedScopeId:a,dataEntryId:o})))),m===it.m2.TRACKED_ENTITY_TYPE&&y.createElement("div",{className:t.container},y.createElement("div",{className:t.title},n.A.t("New {{titleText}}",{titleText:E,interpolation:{escapeValue:!1}})),y.createElement("div",{className:t.tetypeContainer},y.createElement(TO,{onSelect:I,headerText:n.A.t("Create for"),footerText:n.A.t("You can also choose a program from the top bar and create in that program"),accessNeeded:"write"})),y.createElement("div",{className:t.flexContainer},y.createElement("div",{className:t.flexItem},y.createElement(yR,{id:o,selectedScopeId:a,orgUnitId:v,onCancel:f,saveButtonText:n.A.t("Save {{trackedEntityName}}",{trackedEntityName:h,interpolation:{escapeValue:!1}}),onSave:i,duplicatesReviewPageSize:p,renderDuplicatesDialogActions:b,renderDuplicatesCardActions:S,ExistingUniqueValueDialogActions:A})),l&&y.createElement("div",{className:t.dataEntryReadyItem},y.createElement(C_,{selectedScopeId:a,dataEntryId:o})))),m===it.m2.EVENT_PROGRAM&&y.createElement(xk,{id:"singleEvent",selectedScopeId:a}))})),vee=e=>{let{selectedScopeId:t,dataEntryId:r,setScopeId:n,trackedEntityInstanceAttributes:a}=e;const o=(0,gs.wA)(),{teiId:i}=vs(),s=(0,y.useCallback)((e=>{o((e=>l(P4)({teiPayload:e}))(e))}),[o]),d=(0,y.useCallback)((e=>{const t=(0,yc.A)();o(((e,t)=>l(L4)({enrollmentPayload:e,uid:t}))(e,t))}),[o]),c=(0,gs.d4)((e=>{let{dataEntries:t}=e;return!!t[r]}));return(0,y.useEffect)((()=>(o(l(vD.NEW_PAGE_OPEN)()),()=>{o(fD(Q8)),o(fD("singleEvent")),o(fD("relationship"))})),[o]),y.createElement(yee,{dataEntryId:r,selectedScopeId:t,setScopeId:n,dataEntryIsReady:c,onSaveWithoutEnrollment:s,onSaveWithEnrollment:d,teiId:i,trackedEntityInstanceAttributes:a})},fee=(0,qd.compose)(Dp(),qm(),(0,fp.default)((()=>({container:{padding:"24px 24px 16px 24px"}}))))((e=>{let{showMessageToSelectOrgUnitOnNewPage:t,showMessageToSelectProgramCategoryOnNewPage:r,showMessageThatCategoryOptionIsInvalidForOrgUnit:a,showDefaultViewOnNewPage:o,handleMainPageNavigation:i,classes:s,currentScopeId:l,newPageStatus:d,writeAccess:c,programCategorySelectionIncomplete:u,categoryOptionIsInvalidForOrgUnit:p,missingCategoriesInProgramSelection:m,orgUnitSelectionIncomplete:g,trackedEntityName:h,trackedEntityInstanceAttributes:E}=e;const{scopeType:v}=es(l),[f,I]=(0,y.useState)(l);(0,y.useEffect)((()=>{I(l)}),[v,l]),(0,y.useEffect)((()=>{g?t():u?r():p?a():o()}),[u,g,t,r,o,p,a]);const b=(0,gs.d4)((e=>{let{currentSelections:t}=e;return t.orgUnitId}));return y.createElement("div",{"data-test":"registration-page-content",className:s.container},c?y.createElement(vW,{orgUnitId:b},d===z8&&y.createElement(vee,{dataEntryId:Q8,selectedScopeId:f,setScopeId:I,trackedEntityInstanceAttributes:E}),d===Y8&&y.createElement(y.Fragment,null,y.createElement(OO,null,n.A.t("Choose an organisation unit to start reporting")),y.createElement(ra.$,{dataTest:"new-page-cancel-button",onClick:i},n.A.t("Cancel"))),d===q8&&(()=>{const e=m.reduce(((e,t,r)=>{let{name:n}=t;return r+1===m.length?`${e} ${n} ${m.length>1?"categories":"category"}`:`${e} ${n},`}),"");return y.createElement(OO,null,n.A.t("Choose the {{missingCategories}} to start reporting",{missingCategories:e,interpolation:{escapeValue:!1}}))})(),d===K8&&y.createElement(OO,null,n.A.t("The category option is not valid for the selected organisation unit. Please select a valid combination."))):y.createElement(Ck,{message:n.A.t("You don't have access to create a {{trackedEntityName}} in the current selections",{trackedEntityName:h,interpolation:{escapeValue:!1}})}))})),Iee=()=>{const{programId:e}=vs(),{categoriesMeta:t={},programId:r,complete:n}=(0,gs.d4)((e=>{let{currentSelections:t}=e;return{categoriesMeta:t.categoriesMeta,programId:t.programId,complete:t.complete}}),gs.bN),a=e||r,o=a&&Nt.Jj.get(a);if(o&&o.categoryCombination&&!n){return{missingCategories:Array.from(o.categoryCombination.categories.values()).map((e=>{let{id:t,name:r}=e;return{id:t,name:r}})).filter((e=>{let{id:r}=e;return!Object.keys(t).some((e=>e===r))})),programSelectionIsIncomplete:!0}}return{missingCategories:[],programSelectionIsIncomplete:!1}},bee=e=>{let{programId:t,orgUnitId:r,teiId:n,isUserInteractionInProgress:a,trackedEntityName:o="",teiDisplayName:i="",formIsOpen:s}=e;const d=(0,gs.wA)(),{setProgramId:c}=bW(),{setOrgUnitId:u}=SW(),{resetProgramIdAndTeiId:p}=AW(),{resetOrgUnitId:m}=CW(),{resetTeiId:g}=OW(),{reset:h}=_W(),{selectedCategories:E}=(0,gs.d4)((e=>{let{currentSelections:t}=e;return{selectedCategories:t.categoriesMeta}})),v=(0,y.useCallback)(((e,t)=>{d(((e,t)=>l(vD.CATEGORY_OPTION_SET)({categoryId:e,categoryOption:t}))(t,e))}),[d]),f=(0,y.useCallback)((e=>{d((e=>l(vD.CATEGORY_OPTION_RESET)({categoryId:e}))(e))}),[d]),I=(0,y.useCallback)((()=>{d(l(vD.ALL_CATEGORY_OPTIONS_RESET)())}),[d]);return y.createElement(XW,{selectedProgramId:t,selectedOrgUnitId:r,selectedCategories:E,onSetProgramId:e=>c(e),onSetOrgUnit:e=>u(e),onSetCategoryOption:v,onResetAllCategoryOptions:I,onResetCategoryOption:f,onResetProgramId:()=>p(),onResetOrgUnitId:()=>m(),isUserInteractionInProgress:a,onStartAgain:()=>h(),formIsOpen:s},n?y.createElement(ZW,{displayOnly:!0,ready:Boolean(o&&i),onClear:()=>g(),options:[{label:i,value:"alwaysPreselected"}],selectedValue:"alwaysPreselected",title:o,isUserInteractionInProgress:a}):y.createElement(y.Fragment,null),y.createElement(aH,{selectedProgramId:t,selectedOrgUnitId:r,isUserInteractionInProgress:a}))},See=()=>{const e=(0,gs.wA)(),t=(0,T.W6)(),{orgUnitId:r,programId:n,teiId:a}=vs(),o=n&&td.J.get(n),{categoryOptionIsInvalidForOrgUnit:i}=see({selectedOrgUnitId:r}),{trackedEntityInstanceAttributes:s}=((e,t)=>{const{loading:r,data:n,refetch:a}=(0,A.iO)((0,y.useMemo)((()=>({trackedEntityInstance:{resource:"tracker/trackedEntities",id:e=>{let{variables:{id:t}}=e;return t},params:{program:t,fields:["attributes"]}}})),[t]));return(0,y.useEffect)((()=>{e&&a({variables:{id:e}})}),[a,e]),{trackedEntityInstanceAttributes:e?!r&&(null===n||void 0===n?void 0:n.trackedEntityInstance.attributes):void 0}})(a,n),d=null===o||void 0===o?void 0:o.trackedEntityType,c=s&&sW(s,(null===d||void 0===d?void 0:d.id)||"",a),u=(0,y.useCallback)((()=>{e(l(vD.NEW_PAGE_WITHOUT_ORG_UNIT_SELECTED_VIEW)())}),[e]),p=(0,y.useCallback)((()=>{e(l(vD.NEW_PAGE_CATEGORY_OPTION_INVALID_FOR_ORG_UNIT_VIEW)())}),[e]),m=(0,y.useCallback)((()=>{e(l(vD.NEW_PAGE_WITHOUT_PROGRAM_CATEGORY_SELECTED_VIEW)())}),[e]),g=(0,y.useCallback)((()=>{e(l(vD.NEW_PAGE_DEFAULT_VIEW)())}),[e]),h=(0,gs.d4)((e=>{let{activePage:t}=e;return t.selectionsError&&t.selectionsError.error})),E=(0,gs.d4)((e=>{let{activePage:t}=e;return!t.isDataEntryLoading})),v=(0,gs.d4)((e=>{let{currentSelections:t}=e;return t.programId||t.trackedEntityTypeId})),{missingCategories:f,programSelectionIsIncomplete:I}=Iee(),b=(0,gs.d4)((e=>{let{currentSelections:t}=e;return!t.orgUnitId&&!t.complete})),S=(0,gs.d4)((e=>{let{newPage:t}=e;return t.newPageStatus})),C=(e=>{const t=(0,it.WB)(e);if(e&&!t)return!1;try{if(t instanceof it.rr){const{access:e,trackedEntityType:{access:r}}=t,n=e&&e.data&&e.data.write,a=r&&r.data&&r.data.write;return n&&a}if(t instanceof it.UC){const{access:e}=t;return e&&e.data&&e.data.write}return!0}catch(r){return!1}})(v),O=(0,gs.d4)((e=>Df(e,"singleEvent-newEvent")||Df(e,"relationship-newTei")||Df(e,"relationship-newEvent")||Df(e,"newPageDataEntryId-newEnrollment")||Df(e,"newPageDataEntryId-newTei")));return y.createElement(y.Fragment,null,y.createElement(bee,{orgUnitId:r,programId:n,isUserInteractionInProgress:O,teiId:a,trackedEntityName:null===d||void 0===d?void 0:d.name,teiDisplayName:c,formIsOpen:S===z8}),y.createElement(fee,{showMessageToSelectOrgUnitOnNewPage:u,showMessageToSelectProgramCategoryOnNewPage:m,showDefaultViewOnNewPage:g,showMessageThatCategoryOptionIsInvalidForOrgUnit:p,handleMainPageNavigation:()=>{t.push(`/?${Is({orgUnitId:r,programId:n})}`)},currentScopeId:v,orgUnitSelectionIncomplete:b,programCategorySelectionIncomplete:I,missingCategoriesInProgramSelection:f,categoryOptionIsInvalidForOrgUnit:i,writeAccess:C,newPageStatus:S,error:h,ready:E,trackedEntityInstanceAttributes:s,trackedEntityName:null===d||void 0===d?void 0:d.name}))};var Tee=r(36516);const Aee=n.A.t("This program is protected"),Cee=n.A.t("Reason to check for enrollments"),Oee=n.A.t("Describe the reason you are checking for enrollments in this protected program"),Nee=(0,I.withStyles)((e=>{let{typography:t}=e;return{title:{...t.title},background:{maxWidth:"1000px"},wrapper:{padding:`0 ${yn.U.dp16}px ${yn.U.dp16}px ${yn.U.dp16}px`}}}))((e=>{let{onBreakingTheGlass:t,onCancel:r,classes:a}=e;const[o,i]=(0,y.useState)(""),s=(0,y.useCallback)((e=>{let{value:t}=e;i(t)}),[i]);return y.createElement("div",{"data-test":"breaking-the-glass-widget",className:a.background},y.createElement(Ib,{noncollapsible:!0,borderless:!0,header:y.createElement(y.Fragment,null)},y.createElement("div",{className:a.wrapper},y.createElement("div",{className:a.title},n.A.t("Check for enrollments")),y.createElement("br",null),y.createElement(zm.I,{title:Aee,warning:!0},n.A.t("You must provide a reason to check for enrollments in this protected program. All activity will be logged.")),y.createElement("br",null),y.createElement(Tee.l,{label:Cee,placeholder:Oee,onChange:s,value:o,inputWidth:"680px"}),y.createElement("br",null),y.createElement(Nf.v,null,y.createElement(ra.$,{onClick:()=>t(o)},n.A.t("Check for enrollments")),y.createElement(ra.$,{secondary:!0,onClick:r},n.A.t("Cancel"))))))})),Ree={resource:"tracker/ownership/override",type:"create",params:e=>{let{tei:t,program:r,reason:n}=e;return{trackedEntityInstance:t,program:r,reason:n}}},wee=e=>{let{teiId:t,programId:r,onBreakingTheGlass:n,onCancel:a}=e;const[o]=(0,A.r8)(Ree),i=(0,y.useCallback)((async e=>{await o({tei:t,program:r,reason:e}),n()}),[n,o,t,r]);return y.createElement(Nee,{onBreakingTheGlass:i,onCancel:a})},_ee=(e,t,r)=>{var n;const{enrollments:a,tetId:o}=(0,gs.d4)((e=>{let{enrollmentPage:t}=e;return t})),i=a&&a.length>0,s=i&&a.some((e=>{let{status:t}=e;return"ACTIVE"===t})),l=a&&a.some((t=>{let{enrollment:r}=t;return e===r})),d=t&&(null===(n=Nt.Jj.get(t))||void 0===n?void 0:n.onlyEnrollOnce),c=a&&a.filter((e=>{let{program:r}=e;return r===t})),u="AUTO"===e&&((e,t)=>{if(!e)return;if(t&&(e=e.filter((e=>e.trackedEntity===t))),!e.length)return;if(1===e.length)return e[0].enrollment;const r=e.filter((e=>"ACTIVE"===e.status));return r.length?r[0].enrollment:void 0})(c,r);return{programHasEnrollments:i,programHasActiveEnrollments:s,enrollmentsOnProgramContainEnrollmentId:l,onlyEnrollOnce:d,tetId:o,autoEnrollmentId:u}},Pee="TRACKER_PROGRAM_WITH_ZERO_ENROLLMENTS_SELECTED",kee="TRACKER_PROGRAM_OF_DIFFERENT_TYPE_SELECTED",Dee="PROTECTED_PROGRAM_WITH_BREAKING_THE_GLASS",Uee="RESTRICTED_PROGRAM_NO_ACCESS",Lee="EVENT_PROGRAM_SELECTED",Fee="MISSING_ENROLLMENT_SELECTION",xee="MISSING_ENROLLMENT_SELECTION_ADD_NEW",Mee="MISSING_PROGRAM_CATEGORIES_SELECTION",Vee="MISSING_PROGRAM_SELECTION",jee=(0,I.withStyles)((()=>({lineHeight:{lineHeight:1.8},link:{background:"transparent",padding:0}})))((e=>{let{classes:t}=e;const r=(0,gs.wA)(),{navigateToTrackerProgramRegistrationPage:a,navigateToEventProgramRegistrationPage:o,navigateToEventWorkingList:i}=(()=>{const e=(0,T.W6)(),{tetId:t}=(0,gs.d4)((e=>{let{enrollmentPage:t}=e;return t})),{programId:r,orgUnitId:n,teiId:a}=vs();return{navigateToTrackerProgramRegistrationPage:()=>e.push(`/new?${Is({programId:r,orgUnitId:n,teiId:a})}`),navigateToEventProgramRegistrationPage:()=>e.push(`/new?${Is({programId:r,orgUnitId:n})}`),navigateToEventWorkingList:()=>e.push(`/?${Is({programId:r,orgUnitId:n})}`),navigateToTetRegistrationPage:()=>e.push(`/new?${Is({programId:r,orgUnitId:n,trackedEntityTypeId:t})}`)}})(),{missingStatus:s}=(()=>{const[e,t]=(0,y.useState)(null),{programId:r,enrollmentId:n,teiId:a}=vs(),{scopeType:o,tetId:i}=es(r),{programSelectionIsIncomplete:s}=Iee(),{programHasEnrollments:l,programHasActiveEnrollments:d,enrollmentsOnProgramContainEnrollmentId:c,onlyEnrollOnce:u,tetId:p}=_ee(n,r,a),{enrollmentAccessLevel:m}=(0,gs.d4)((e=>{let{enrollmentPage:t}=e;return t})),g=i!==p;return(0,y.useEffect)((()=>{const e=r&&o===A9.m.TRACKER_PROGRAM,n=r&&o===A9.m.EVENT_PROGRAM;t(m===X4?Dee:m===J4?Uee:e&&s?Mee:e&&g?kee:e&&l&&!c?d||u?Fee:xee:e&&!l&&m!==Z4?Pee:n?Lee:Vee)}),[r,s,l,d,c,g,o,m,u]),{missingStatus:e}})(),{resetProgramIdAndEnrollmentContext:l}=AW(),{teiDisplayName:d,tetId:c}=(0,gs.d4)((e=>{let{enrollmentPage:t}=e;return t})),{programId:u,teiId:p,enrollmentId:m}=vs(),{trackedEntityName:g}=es(c),{programName:h,trackedEntityName:E}=es(u);return y.createElement(y.Fragment,null,s===Vee&&y.createElement(OO,null,n.A.t("Choose a program to add new or see existing enrollments for {{teiDisplayName}}",{teiDisplayName:d,interpolation:{escapeValue:!1}})),s===Mee&&y.createElement(OO,null,n.A.t("{{programName}} has categories. Choose all categories to view dashboard.",{programName:h,interpolation:{escapeValue:!1}})),s===Fee&&y.createElement(OO,null,m?n.A.t("Invalid enrollment id {{enrollmentId}}.",{enrollmentId:m,interpolation:{escapeValue:!1}}):n.A.t("Choose an enrollment to view the dashboard.")),s===xee&&y.createElement(OO,null,y.createElement("div",{className:t.lineHeight},n.A.t("There are no active enrollments."),y.createElement("div",null,y.createElement(Mg,{className:t.link,onClick:a},n.A.t("Add new enrollment for {{teiDisplayName}} in this program.",{teiDisplayName:d}))))),s===Dee&&y.createElement(wee,{teiId:p,programId:u,onBreakingTheGlass:()=>r(y5()),onCancel:l}),s===Uee&&y.createElement(OO,null,n.A.t("You do not have permissions to access to this program, registering unit or record, contact your administrator for more information.")),s===Pee&&y.createElement(OO,null,y.createElement("div",{className:t.lineHeight},n.A.t("{{teiDisplayName}} is not enrolled in this program.",{teiDisplayName:d,interpolation:{escapeValue:!1}}),y.createElement("div",null,y.createElement(Mg,{className:t.link,onClick:a},n.A.t("Enroll {{teiDisplayName}} in this program.",{teiDisplayName:d}))))),s===kee&&y.createElement(OO,null,y.createElement("div",{className:t.lineHeight},n.A.t("{{teiDisplayName}} is a {{tetName}} and cannot be enrolled in the {{programName}}. Choose another program that allows {{tetName}} enrollment. ",{teiDisplayName:d,programName:h,tetName:g,interpolation:{escapeValue:!1}}),y.createElement("div",null,y.createElement(Mg,{className:t.link,onClick:a},n.A.t("Enroll a new {{selectedTetName}} in this program.",{selectedTetName:E,interpolation:{escapeValue:!1}}))))),s===Lee&&y.createElement(OO,null,y.createElement("div",{className:t.lineHeight},n.A.t("{{programName}} is an event program and does not have enrollments.",{programName:h,interpolation:{escapeValue:!1}}),y.createElement("div",null,y.createElement(Mg,{className:t.link,onClick:o},n.A.t("Create a new event in this program."))),y.createElement("div",null,y.createElement(Mg,{className:t.link,onClick:i},n.A.t("View working list in this program."))))))})),Gee=Object.freeze({QuickActions:T2,StagesAndEvents:A2,EnrollmentNote:_2,...V2}),Bee=Object.freeze({leftColumn:[{type:j2.COMPONENT,name:"QuickActions"},{type:j2.COMPONENT,name:"StagesAndEvents"}],rightColumn:[{type:j2.COMPONENT,name:"ErrorWidget"},{type:j2.COMPONENT,name:"WarningWidget"},{type:j2.COMPONENT,name:"EnrollmentNote"},{type:j2.COMPONENT,name:"FeedbackWidget"},{type:j2.COMPONENT,name:"IndicatorWidget"},{type:j2.COMPONENT,name:"TrackedEntityRelationship"},{type:j2.COMPONENT,name:"ProfileWidget",settings:{readOnlyMode:!1}},{type:j2.COMPONENT,name:"EnrollmentWidget",settings:{readOnlyMode:!1}}]}),$ee=()=>{const e=(0,T.W6)(),t=(0,gs.wA)(),{fromClientDate:r}=(0,A.Bp)(),{status:a}=(0,gs.d4)((e=>{let{widgetEnrollment:t}=e;return t})),{enrollmentId:o,programId:i,teiId:s,orgUnitId:d}=vs(),{orgUnit:c,error:u}=ZN(d),{onLinkedRecordClick:p}=C5(),{pageLayout:m,isLoading:g}=x5({selectedScopeId:i,defaultPageLayout:Bee,dataStoreKey:G2.ENROLLMENT_OVERVIEW}),h=nJ(i),{error:E,enrollment:v,attributeValues:f}=Us(s,o,i),{error:I,programMetadata:b}=g5(i),C=((e,t)=>(0,y.useMemo)((()=>{const r=[];return e&&t?(e.stages.forEach((e=>{const{id:a,name:o,icon:i,stageForm:s}=e,{hideDueDate:l,programStageDataElements:d,repeatable:c,enableUserAssignment:u,dataAccess:p}=t.find((e=>e.id===a))||{};d?r.push({id:a,name:o,icon:i,hideDueDate:l,repeatable:c,enableUserAssignment:u,description:s.description,dataAccess:p,dataElements:null===d||void 0===d?void 0:d.reduce(((e,t)=>{const{displayInReports:r,dataElement:n}=t;if(r){var a;const t=n.optionSet?null===(a=n.optionSet.options)||void 0===a?void 0:a.reduce(((e,t)=>(e[t.code]=t.name,e)),{}):void 0;e.push({id:n.id,name:n.displayName,formName:n.displayFormName,type:n.valueType,options:t,optionSet:n.optionSet})}return e}),[])}):S().error((0,j.px)(n.A.t("Program stage not found"))(a))})),r):r}),[e,t]))(h,null===b||void 0===b?void 0:b.programStages);(I||E)&&S().error((0,j.px)("Enrollment page could not be loaded")({programMetaDataError:I,enrollmentsError:E}));const N=ud({orgUnit:c,program:h,apiEnrollment:v,apiAttributeValues:f}),R=(w=N,(0,y.useMemo)((()=>{let e=[],t=[],r=[],n=[];const a=Object.freeze({SHOWWARNING:"SHOWWARNING",SHOWERROR:"SHOWERROR",DISPLAYKEYVALUEPAIRS:"DISPLAYKEYVALUEPAIRS",DISPLAYTEXT:"DISPLAYTEXT"}),o=Object.freeze({general:"general",feedback:"feedback",indicators:"indicators"});return null===w||void 0===w||w.forEach((i=>{if(i.id===o.general)switch(i.type){case a.SHOWWARNING:e=[...e,i.warning];break;case a.SHOWERROR:t=[...t,i.error]}else i.id===o.feedback?r=[...r,(null===i||void 0===i?void 0:i.displayText)||(null===i||void 0===i?void 0:i.displayKeyValuePair)]:i.id===o.indicators&&(n=[...n,(null===i||void 0===i?void 0:i.displayText)||(null===i||void 0===i?void 0:i.displayKeyValuePair)])})),{warnings:e,errors:t,feedbacks:r,indicators:n}}),[w]));var w;const _=h5(h.programRules),P=(0,y.useCallback)((()=>{e.push(`/?${Is({orgUnitId:d,programId:i})}`)}),[e,d,i]),k=(0,y.useCallback)(((e,r)=>{t((e=>l(Ss.UPDATE_ENROLLMENT_ATTRIBUTE_VALUES)({attributeValues:e}))(e.map((e=>{let{attribute:t,value:r}=e;return{id:t,value:r}})))),t((e=>l(E5.UPDATE_TEI_DISPLAY_NAME)({teiDisplayName:e}))(r))}),[t]),D=(0,y.useCallback)((e=>{t((e=>l(Ss.UPDATE_ENROLLMENT_DATE)({enrollmentDate:e}))(e)),t((e=>{let{enrollmentId:t,enrollmentDate:r}=e;return l(E5.UPDATE_ENROLLMENT_DATE)({enrollmentId:t,enrollmentDate:r})})({enrollmentId:o,enrollmentDate:e}))}),[t,o]),U=(0,y.useCallback)((e=>{t((e=>l(Ss.UPDATE_INCIDENT_DATE)({incidentDate:e}))(e))}),[t]),L=(0,y.useCallback)((e=>{t((e=>l(Ss.DELETE_ENROLLMENT_EVENT)({eventId:e}))(e))}),[t]),F=(0,y.useCallback)((e=>{t(Ds({events:[e]}))}),[t]),x=(0,y.useCallback)(((e,n)=>{const a=r(new Date),o=new Date(a.getServerZonedISOString()),i=$()(o).format("YYYY-MM-DDTHH:mm:ss");t(((e,t,r)=>l(Ss.UPDATE_ENROLLMENT_EVENT_STATUS)({eventId:e,status:t,updatedAt:r}))(e,n,i))}),[t,r]),M=(0,y.useCallback)((e=>t(ws(e))),[t]),V=(0,y.useCallback)((e=>{t(_s()),t(Rs({message:e}))}),[t]),G=(0,y.useCallback)((()=>{t(Ps())}),[t]),B=(0,y.useCallback)((()=>{e.push(`/?${Is({orgUnitId:d,programId:i})}`)}),[e,d,i]);return g?y.createElement(O,null):u?null===u||void 0===u?void 0:u.errorComponent:y.createElement(a5,{pageLayout:m,currentPage:M2.OVERVIEW,availableWidgets:Gee,teiId:s,orgUnitId:d,program:h,stages:C,events:null===v||void 0===v?void 0:v.events,enrollmentId:o,onAddNew:()=>{e.push(`/new?${Is({orgUnitId:d,programId:i,teiId:s})}`)},onDelete:()=>{e.push(`/enrollment?${Is({orgUnitId:d,programId:i,teiId:s})}`),t(I5({enrollmentId:o}))},onDeleteTrackedEntitySuccess:P,onViewAll:t=>{e.push(`/enrollment/stageEvents?${Is({orgUnitId:d,programId:i,stageId:t})}`)},onBackToMainPage:B,trackedEntityName:h.trackedEntityType.name,onCreateNew:t=>{e.push(`/enrollmentEventNew?${Is({orgUnitId:d,programId:i,teiId:s,enrollmentId:o,stageId:t})}`)},widgetEffects:R,hideWidgets:_,onEventClick:t=>{e.push(`/enrollmentEventEdit?${Is({orgUnitId:d,eventId:t})}`)},onDeleteEvent:L,onUpdateEventStatus:x,onRollbackDeleteEvent:F,onLinkedRecordClick:p,onUpdateTeiAttributeValues:k,onUpdateEnrollmentDate:D,onUpdateIncidentDate:U,onEnrollmentError:e=>t(Rs({message:e})),onUpdateEnrollmentStatus:M,onUpdateEnrollmentStatusSuccess:G,onUpdateEnrollmentStatusError:V,ruleEffects:N,widgetEnrollmentStatus:a,onAccessLostFromTransfer:()=>{e.push(`/?${Is({orgUnitId:d,programId:i})}`)},feedbackEmptyText:n.A.t("No feedback for this enrollment yet"),indicatorEmptyText:n.A.t("No indicator output for this enrollment yet")})},Wee=(0,qd.compose)(qm(),(0,fp.default)((e=>{let{typography:t}=e;return{loadingMask:{height:"100vh"},title:{...t.title}}})))((e=>{let{classes:t,enrollmentPageStatus:r}=e;return y.createElement("div",{"data-test":"enrollment-page-content"},r===z4&&y.createElement(jee,null),r===$4&&y.createElement($ee,null),r===W4&&y.createElement("div",{className:t.loadingMask},y.createElement(O,null)))})),Hee=e=>{let{programId:t,orgUnitId:r,enrollmentId:a,trackedEntityName:o,teiDisplayName:i,enrollmentsAsOptions:s}=e;const{setProgramIdAndResetEnrollmentContext:l}=bW(),{setOrgUnitId:d}=SW(),{setEnrollmentId:c}=TW(),{resetProgramIdAndEnrollmentContext:u}=AW(),{resetOrgUnitId:p}=CW(),{resetEnrollmentId:m}=NW(),{resetTeiId:g}=OW(),{reset:h}=_W();return y.createElement(XW,{selectedProgramId:t,selectedOrgUnitId:r,onSetProgramId:e=>l(e),onSetOrgUnit:e=>d(e),onResetProgramId:()=>u(),onResetOrgUnitId:()=>p(),onStartAgain:()=>h()},o?y.createElement(ZW,{ready:Boolean(o&&i),onClear:()=>g("/"),options:[{label:i,value:"alwaysPreselected"}],selectedValue:"alwaysPreselected",title:o,displayOnly:!0}):y.createElement(y.Fragment,null),(null===s||void 0===s?void 0:s.length)>0?y.createElement(ZW,{ready:!0,onClear:()=>m(),onSelect:e=>c({enrollmentId:e}),options:s,selectedValue:a,title:n.A.t("Enrollment")}):y.createElement(y.Fragment,null),y.createElement(aH,{selectedProgramId:t,selectedOrgUnitId:r}))},zee=()=>{const e=(0,gs.wA)(),{teiId:t,programId:r,enrollmentId:n}=vs(),{scopeType:a}=es(r),{setEnrollmentId:o}=TW(),{enrollmentPageStatus:i,programId:s}=(0,gs.d4)((e=>{let{enrollmentPage:t}=e;return t})),{programHasEnrollments:d,enrollmentsOnProgramContainEnrollmentId:c,autoEnrollmentId:u}=_ee(n,r,t);(0,y.useEffect)((()=>{const t=r&&a===A9.m.TRACKER_PROGRAM;"AUTO"===n&&u?o({enrollmentId:u,shouldReplaceHistory:!0}):e(t&&d&&c?l(E5.DEFAULT_VIEW)():r===s&&i!==W4?l(E5.MISSING_MESSAGE_VIEW)():l(E5.LOADING_VIEW)())}),[e,r,c,d,a,n,u,i,s]),(0,y.useEffect)((()=>()=>e(l(E5.PAGE_CLOSE)())),[e])},Yee=()=>{const{enrollmentPageStatus:e,programId:t}=(0,gs.d4)((e=>{let{enrollmentPage:t}=e;return t})),{teiId:r,programId:n,enrollmentId:a}=vs(),{scopeType:o}=es(n);return(0,y.useMemo)((()=>o===A9.m.EVENT_PROGRAM?z4:e!==$4||n&&r&&a&&n===t?e:W4),[o,e,a,r,n,t])},qee=()=>{zee();const e=(0,gs.wA)(),{programId:t,orgUnitId:r,enrollmentId:n,teiId:a}=vs(),{tetId:o,enrollments:i,teiDisplayName:s}=(0,gs.d4)((e=>{let{enrollmentPage:t}=e;return t})),{trackedEntityName:d}=(0,it.he)(o),c=eH(i,t);(0,y.useEffect)((()=>{e(l(E5.PAGE_OPEN)())}),[e]),(0,y.useEffect)((()=>{e((e=>l(E5.PROCESS_ENROLLMENT_ID)(e))(n))}),[e,n]),(0,y.useEffect)((()=>{var t;e(a?(t={teiId:a},l(E5.PROCESS_TEI_ID)(t)):l(E5.RESET_TEI_ID)())}),[e,a]),(0,y.useEffect)((()=>{var r;e((r={programId:t},l(E5.PROCESS_PROGRAM_ID)(r)))}),[e,t]);const u=(0,gs.d4)((e=>{let{activePage:t}=e;return t.selectionsError&&t.selectionsError.error}));return y.createElement(y.Fragment,null,y.createElement(Hee,{orgUnitId:r,programId:t,trackedEntityName:d,teiDisplayName:s,enrollmentsAsOptions:c,enrollmentId:n}),y.createElement(Wee,{error:u,programId:t,orgUnitId:r,enrollmentId:n,teiDisplayName:s,trackedEntityName:d,enrollmentsAsOptions:c,enrollmentPageStatus:Yee()}))},Kee=(0,fp.default)((()=>({wrapper:{display:"flex"},icon:{paddingRight:yn.U.dp8},title:{color:vn.T.grey900,fontSize:yn.U.dp16,fontWeight:500}})))((e=>{let{icon:t,title:r,events:a,classes:o}=e;return y.createElement(y.Fragment,null,y.createElement("div",{"data-test":"stage-event-header",className:o.wrapper},y.createElement("div",{className:o.icon},t&&y.createElement("div",{className:o.icon},y.createElement(Tm,{name:t.name,color:t.color,width:20,height:20,cornerRadius:2}))),y.createElement("div",{className:o.title},r,a.length>0&&y.createElement("span",null," :",a.length," ",a.length>1?n.A.t("events"):n.A.t("event")))))})),Qee=(0,fp.default)((()=>({})))((e=>{let{stage:t,programId:r,...n}=e;const{programType:a}=dW(r),o={storeId:"stageEvents",programId:r,programStageId:t.id,...n};return y.createElement(y.Fragment,null,y.createElement("div",{"data-test":"stage-event-list"},y.createElement(Ib,{noncollapsible:!0,header:y.createElement(Kee,{title:null===t||void 0===t?void 0:t.name,icon:null===t||void 0===t?void 0:t.icon,events:[]})},a===it.S2.EVENT_PROGRAM&&y.createElement(IB,o),a===it.S2.TRACKER_PROGRAM&&y.createElement(S9,o))))}));function Xee(){return Xee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xee.apply(this,arguments)}const Jee=(0,qd.compose)(qm(),(0,fp.default)((()=>({container:{padding:`${yn.U.dp16}px ${yn.U.dp24}px`}}))))((e=>{let{classes:t,programStage:r,...n}=e;return y.createElement(y.Fragment,null,y.createElement("div",{"data-test":"stage-event-list-page-content",className:t.container},y.createElement(Qee,Xee({stage:r},n))))})),Zee=()=>{const{stageId:e,programId:t,orgUnitId:r}=vs(),{program:n}=dW(t),a=(null===n||void 0===n?void 0:n.stages)&&n.stages.get(e);return a?y.createElement(Jee,{programStage:a,programId:t,orgUnitId:r}):(S().error((0,j.px)("Could not find stage")({program:t,programStage:e})),null)},ete=e=>{let{programId:t,orgUnitId:r,enrollmentId:a,teiDisplayName:o,trackedEntityName:i,stageName:s,stageIcon:l,eventDateLabel:d,onSetOrgUnitId:c,onResetOrgUnitId:u,onResetProgramId:p,onResetTeiId:m,onResetEnrollmentId:g,onResetStageId:h,onResetEventId:E,userInteractionInProgress:v,enrollmentsAsOptions:f}=e;const{reset:I}=_W();return y.createElement(XW,{selectedProgramId:t,selectedOrgUnitId:r,onSetOrgUnit:e=>c(e),onResetProgramId:()=>p(),onResetOrgUnitId:()=>u(),isUserInteractionInProgress:v,onStartAgain:()=>I()},y.createElement(ZW,{displayOnly:!0,ready:Boolean(o&&i),onClear:()=>m(),options:[{label:o||"",value:"alwaysPreselected"}],selectedValue:"alwaysPreselected",title:i||"",isUserInteractionInProgress:v}),y.createElement(ZW,{ready:Boolean(f),onClear:()=>g(),options:f||[],selectedValue:a,title:n.A.t("Enrollment"),isUserInteractionInProgress:v}),s&&y.createElement(y.Fragment,null,y.createElement(ZW,{displayOnly:!0,ready:!0,onClear:()=>h(),options:[{label:s,value:"alwaysPreselected",icon:l}],selectedValue:"alwaysPreselected",title:n.A.t("Stage"),isUserInteractionInProgress:v}),y.createElement(ZW,{displayOnly:!0,ready:!0,onClear:()=>E(),options:[{label:"-",value:"alwaysPreselected"}],selectedValue:"alwaysPreselected",title:d||"",isUserInteractionInProgress:v})),y.createElement(aH,{selectedProgramId:t,selectedOrgUnitId:r,isUserInteractionInProgress:v}))},tte=Object.freeze({NewEventWorkspace:k2,...V2}),rte=Object.freeze({leftColumn:[{type:j2.COMPONENT,name:"NewEventWorkspace"}],rightColumn:[{type:j2.COMPONENT,name:"TrackedEntityRelationship"},{type:j2.COMPONENT,name:"ErrorWidget"},{type:j2.COMPONENT,name:"WarningWidget"},{type:j2.COMPONENT,name:"FeedbackWidget"},{type:j2.COMPONENT,name:"IndicatorWidget"},{type:j2.COMPONENT,name:"ProfileWidget",settings:{readOnlyMode:!0}},{type:j2.COMPONENT,name:"EnrollmentWidget",settings:{readOnlyMode:!0}}]});function nte(){return nte=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nte.apply(this,arguments)}const ate=(0,fp.default)((e=>{let{typography:t}=e;return{container:{padding:"16px 24px 16px 24px"},columns:{display:"flex"},leftColumn:{flexGrow:3,flexShrink:1,width:872},rightColumn:{flexGrow:1,flexShrink:1,paddingLeft:yn.U.dp16,width:360,display:"flex",flexDirection:"column",gap:"12px"},title:{...t.title,margin:`${yn.U.dp16}px 0`}}}))((e=>{let{pageLayout:t,availableWidgets:r,program:a,stageId:o,orgUnitId:i,teiId:s,enrollmentId:l,widgetEffects:d,hideWidgets:c,onDelete:u,onAddNew:p,onEnrollmentError:m,onEnrollmentSuccess:g,pageFailure:h,ready:E,onAccessLostFromTransfer:v,classes:f,...I}=e;return h?y.createElement("div",null,n.A.t("There was an error loading the page")):i?E?y.createElement("div",null,y.createElement(a5,nte({},I,{currentPage:M2.NEW_EVENT,program:a,pageLayout:t,stageId:o,availableWidgets:r,orgUnitId:i,teiId:s,enrollmentId:l,widgetEffects:d,hideWidgets:c,onDelete:u,onAddNew:p,onEnrollmentError:m,onEnrollmentSuccess:g,onAccessLostFromTransfer:v,feedbackEmptyText:n.A.t("No feedback for this event yet"),indicatorEmptyText:n.A.t("No indicator output for this event yet")}))):null:y.createElement(OO,null,n.A.t("Choose an organisation unit to start reporting"))})),ote=e=>{var t,r,a,o;let{pageLayout:i,enrollment:s,attributeValues:d,commonDataError:c}=e;const{programId:u,stageId:p,orgUnitId:m,teiId:g,enrollmentId:h}=vs(),E=(0,T.W6)(),v=(0,gs.wA)(),{fromClientDate:f}=(0,A.Bp)(),{serverVersion:{minor:I}}=(0,A.UK)(),b=(0,y.useCallback)((()=>{E.push(`enrollment?${Is({programId:u,orgUnitId:m,teiId:g,enrollmentId:h})}`)}),[E,u,m,g,h]),S=(0,y.useCallback)((()=>{E.push(`/?${Is({orgUnitId:m,programId:u})}`)}),[E,m,u]),C=(0,y.useCallback)((()=>{E.push(`/?${Is({orgUnitId:m,programId:u})}`)}),[E,m,u]),O=(0,y.useCallback)((e=>{v(ws(e))}),[v]),N=(0,y.useCallback)((e=>{v(_s()),v(Rs({message:e}))}),[v]),R=(0,y.useCallback)((e=>{let{redirect:t}=e;v(Ps()),t&&E.push(`enrollment?${Is({programId:u,orgUnitId:m,teiId:g,enrollmentId:h})}`)}),[v,E,u,m,g,h]),w=(0,y.useCallback)((e=>{let{enrollments:t,events:r,linkMode:n}=e;if(n&&n===$k.ENTER_DATA)return;const a=f(new Date),o=new Date(a.getServerZonedISOString()),i=$()(o).format("YYYY-MM-DDTHH:mm:ss"),s=r.map((e=>({...TD(e,I),updatedAt:i})));t?(v(ks(t[0].status)),v(ws(t[0]))):r&&v((e=>{let{events:t}=e;return l(Ss.UPDATE_OR_ADD_ENROLLMENT_EVENTS)({events:t})})({events:s})),E.push(`enrollment?${Is({programId:u,orgUnitId:m,teiId:g,enrollmentId:h})}`)}),[f,E,u,m,g,h,I,v]),_=(0,y.useCallback)((()=>{E.push(`/new?${Is({programId:u,orgUnitId:m,teiId:g})}`)}),[E,u,m,g]),P=(0,y.useCallback)((()=>{v(I5({enrollmentId:h})),E.push(`enrollment?${Is({programId:u,orgUnitId:m,teiId:g})}`)}),[v,h,E,u,m,g]),k="enrollmentEvent-newEvent",D=(0,gs.d4)((e=>Df(e,k))),{program:U}=dW(u),L=[...null!==(t=null===U||void 0===U?void 0:U.stages.values())&&void 0!==t?t:[]].find((e=>e.id===p)),F=p5(k),x=h5(null===U||void 0===U?void 0:U.programRules.concat(null!==(r=null===L||void 0===L?void 0:L.programRules)&&void 0!==r?r:[])),M=null!==(a=null===U||void 0===U||null===(o=U.trackedEntityType)||void 0===o?void 0:o.name)&&void 0!==a?a:"",V=(0,y.useMemo)((()=>({events:null===s||void 0===s?void 0:s.events,attributeValues:d,enrollmentData:{enrolledAt:null===s||void 0===s?void 0:s.enrolledAt,occurredAt:null===s||void 0===s?void 0:s.occurredAt,enrollmentId:null===s||void 0===s?void 0:s.enrollment}})),[s,d]),{handleSetOrgUnitId:j,handleResetOrgUnitId:G,handleResetProgramId:B,handleResetEnrollmentId:W,handleResetTeiId:H,handleResetStageId:z,handleResetEventId:Y,teiDisplayName:q,enrollmentsAsOptions:K,teiSelectorFailure:Q,userInteractionInProgress:X}=((e,t,r)=>{const{setOrgUnitId:n}=SW(),{resetOrgUnitId:a}=CW(),{resetProgramIdAndEnrollmentContext:o}=AW(),{resetEnrollmentId:i}=NW(),{resetTeiId:s}=OW(),{resetStageId:l}=RW(),{resetEventId:d}=wW(),c=(0,gs.d4)((e=>Df(e,"enrollmentEvent-newEvent"))),u=(0,y.useCallback)((()=>o("enrollment")),[o]),p=(0,y.useCallback)((()=>i("enrollment")),[i]),m=(0,y.useCallback)((()=>s("/")),[s]),g=(0,y.useCallback)((()=>l("enrollmentEventNew")),[l]),h=(0,y.useCallback)((()=>d("enrollmentEventNew")),[d]),{teiDisplayName:E,error:v}=lW(e,t);return{handleSetOrgUnitId:n,handleResetOrgUnitId:a,handleResetProgramId:u,handleResetEnrollmentId:p,handleResetTeiId:m,handleResetStageId:g,handleResetEventId:h,teiDisplayName:E,enrollmentsAsOptions:eH([r||{}],t),teiSelectorFailure:Boolean(v),userInteractionInProgress:c}})(g,u,s);return p&&!L?y.createElement(zm.I,{error:!0,title:"An error has occurred"},n.A.t("Program stage is invalid")):y.createElement(y.Fragment,null,y.createElement(ete,{programId:u,orgUnitId:m,enrollmentId:h,teiDisplayName:q,trackedEntityName:M,stageName:null===L||void 0===L?void 0:L.stageForm.name,stageIcon:null===L||void 0===L?void 0:L.icon,eventDateLabel:null===L||void 0===L?void 0:L.stageForm.getLabel("occurredAt"),enrollmentsAsOptions:K,onSetOrgUnitId:j,onResetOrgUnitId:G,onResetProgramId:B,onResetEnrollmentId:W,onResetTeiId:H,onResetStageId:z,onResetEventId:Y,userInteractionInProgress:X,teiSelectorFailure:Q,enrollmentSelectorFailure:c}),y.createElement(ate,{pageLayout:i,availableWidgets:tte,program:U,stageId:p,orgUnitId:m,teiId:g,enrollmentId:h,onBackToMainPage:C,onBackToDashboard:b,trackedEntityName:M,userInteractionInProgress:X,onSave:w,onCancel:b,onDelete:P,onDeleteTrackedEntitySuccess:S,onAddNew:_,widgetEffects:F,hideWidgets:x,widgetReducerName:k,pageFailure:c,rulesExecutionDependencies:V,dataEntryHasChanges:D,ready:Boolean(s),onEnrollmentError:e=>v(Rs({message:e})),onEnrollmentSuccess:()=>v(y5()),events:null===s||void 0===s?void 0:s.events,onUpdateEnrollmentStatusSuccess:R,onUpdateEnrollmentStatus:O,onUpdateEnrollmentStatusError:N,onAccessLostFromTransfer:()=>{E.push(`/?${Is({orgUnitId:m,programId:u})}`)}}))},ite=Object.freeze({PROGRAM_ID:"programId",ORG_UNIT_ID:"orgUnitId"}),ste=e=>{var t,r;let{programId:n,orgUnitId:a}=e;const[o,i]=(0,y.useState)({[ite.PROGRAM_ID]:void 0,[ite.ORG_UNIT_ID]:void 0}),[s,l]=(0,y.useState)(),d=(0,y.useCallback)((()=>{const e=[];n&&e.push(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return ve().contains(e,t).then((e=>({response:e,...r})))}(z.PROGRAMS,n,{id:n,type:ite.PROGRAM_ID,convert:e=>e})),a&&e.push(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return ve().get(e,t).then((e=>({response:e,...r})))}(z.ORGANISATION_UNITS_BY_PROGRAM,n,{id:a,type:ite.ORG_UNIT_ID,convert:e=>!(null===e||void 0===e||!e.organisationUnits[a])})),Promise.all(e).then((e=>{const t=e.reduce(((e,t)=>{let{id:r,type:n,convert:a,response:o}=t;return e={...e,[n]:{id:r,valid:a&&a(o),type:n}}}),{});i(t)})).catch((e=>{l(e)}))}),[n,a]);(0,y.useEffect)((()=>{d()}),[n,a,d]);return{...n===(null===(t=o[ite.PROGRAM_ID])||void 0===t?void 0:t.id)&&a===(null===(r=o[ite.ORG_UNIT_ID])||void 0===r?void 0:r.id)?{valid:o,loading:!1,error:s}:{valid:{[ite.PROGRAM_ID]:void 0,[ite.ORG_UNIT_ID]:void 0},loading:!0,error:void 0}}},lte=Object.freeze({DEFAULT:"DEFAULT",MISSING_REQUIRED_VALUES:"MISSING_REQUIRED_VALUES",PAGE_INVALID:"PAGE_INVALID",LOADING:"LOADING",ORG_UNIT_INVALID:"ORG_UNIT_INVALID",PROGRAM_INVALID:"PROGRAM_INVALID"}),dte={informativeMessage:{marginLeft:yn.U.dp16,marginTop:yn.U.dp24,marginRight:yn.U.dp16}},cte=(0,fp.default)(dte)((e=>{var t,r;let{classes:a}=e;const o=(0,T.W6)(),{teiId:i,programId:s,orgUnitId:l,enrollmentId:d}=vs(),{valid:c,loading:u,error:p}=ste({programId:s,orgUnitId:l}),{enrollment:m,attributeValues:g,error:h}=Us(i,d,s),{pageLayout:E,isLoading:v}=x5({selectedScopeId:null===(t=c[ite.PROGRAM_ID])||void 0===t?void 0:t.id,dataStoreKey:G2.ENROLLMENT_EVENT_NEW,defaultPageLayout:rte}),f=!u&&!(null!==(r=Object.values(c))&&void 0!==r&&r.every((e=>null===e||void 0===e?void 0:e.valid)))||h||p,I=(0,y.useMemo)((()=>{var e,t,r;return s&&d&&i?!f||null===(e=c[ite.PROGRAM_ID])||void 0===e||!e.valid||null!==(t=c[ite.ORG_UNIT_ID])&&void 0!==t&&t.valid?!f||null!==(r=c[ite.PROGRAM_ID])&&void 0!==r&&r.valid?f?lte.PAGE_INVALID:u||v?lte.LOADING:lte.DEFAULT:lte.PROGRAM_INVALID:lte.ORG_UNIT_INVALID:lte.MISSING_REQUIRED_VALUES}),[d,v,u,f,s,i,c]);return(0,y.useEffect)((()=>{I===lte.PROGRAM_INVALID&&o.push(`/enrollment?${Is({orgUnitId:l,teiId:i,enrollmentId:d})}`)}),[I,l,i,d,o]),I===lte.LOADING?y.createElement(O,null):I===lte.DEFAULT?y.createElement(ote,{pageLayout:E,enrollment:m,attributeValues:g,commonDataError:Boolean(h)}):y.createElement("div",{className:a.informativeMessage},y.createElement(zm.I,{error:!0,title:"An error has occurred"},I===lte.MISSING_REQUIRED_VALUES&&n.A.t("Page is missing required values from URL"),I===lte.ORG_UNIT_INVALID&&n.A.t("Org unit is not valid with current program"),I===lte.PAGE_INVALID&&n.A.t("There was an error opening the Page")))}));var ute=r(62332);const pte=(0,qd.compose)(T.y,Km((e=>e.app.initDone),null,!0),(e=>{class t extends y.Component{constructor(){super(...arguments),P5(this,"handleUpdate",(e=>{this.props.onUpdateFromUrl(this.page,e)}))}getSyncSpecification(){const e=this.page||k5.MAIN;return L5[e]||[]}setPageAndParams(){const{location:e}=this.props;this.page=e.pathname.substring(1),this.params=(0,O5.parse)(e&&e.search)}render(){const{location:t,onUpdateFromUrl:r,locationSwitchInProgress:n,params:a,page:o,...i}=this.props;return n?y.createElement(O,null):(this.setPageAndParams(),y.createElement(e,_5({statePage:o||k5.MAIN,urlPage:this.page,urlParams:this.params,onUpdate:this.handleUpdate,syncSpecification:this.getSyncSpecification(),stateParams:a},i)))}}return(0,gs.Ng)((e=>({params:N5(e),page:e.app.page,locationSwitchInProgress:e.app.locationSwitchInProgress})),(e=>({onUpdateFromUrl:(t,r)=>{w5(t)&&null!=t&&e(F5[t](r))}})))(t)}),(mte=e=>e.syncSpecification,e=>x9(e,mte)),Km(((e,t)=>!t.urlOutOfSync),null,!0),Km((e=>!e.app.goingOnline),null,!0))((()=>y.createElement(y.Fragment,null,y.createElement(ute.ReactQueryDevtools,null),y.createElement(T.dO,null,y.createElement(T.qh,{path:"/viewEvent",component:k7}),y.createElement(T.qh,{path:"/search",component:mee}),y.createElement(T.qh,{path:"/new",component:See}),y.createElement(T.qh,{path:"/enrollment/stageEvents",component:Zee}),y.createElement(T.qh,{path:"/enrollmentEventEdit",component:M5}),y.createElement(T.qh,{path:"/enrollmentEventNew",component:cte}),y.createElement(T.qh,{path:"/enrollment",component:qee}),y.createElement(T.qh,{path:"/:keys",component:cee}),y.createElement(T.qh,{path:"/",component:cee})))));var mte;pte.displayName="AppPagesLoader";const gte=e=>{let{classes:t}=e;return y.createElement("div",{className:t.app,dir:Nt.sI.get().dir},y.createElement(pte,null),y.createElement(L9,null))};gte.displayName="AppContents";const hte=(0,I.withStyles)((e=>({app:{fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(16)}})))((0,y.memo)(gte)),Ete=e=>{let{children:t}=e;return(()=>{const{verbose:e}=vs(),t=e=>{Hl.setFlags({...Hl.getFlags(),...e})};(0,y.useLayoutEffect)((()=>{t("true"===e?{verbose:!0}:{verbose:!1})}),[e])})(),t},yte=()=>{const[e,t]=(0,y.useState)(!1),r=(0,T.W6)(),n=vs(),{data:a,isLoading:o}=ri(["programIds","data-read"],(()=>ve().getAll(z.PROGRAMS,{predicate:e=>{let{access:t}=e;return t.data.read},project:e=>{let{id:t}=e;return{id:t}}})),{staleTime:1/0,cacheTime:1/0,enabled:0===Object.keys(n).length&&!e}),i={enabled:0===Object.keys(n).length&&!e},{isLoading:s,data:l}=oi(i),d=(0,y.useCallback)((()=>{const e={programId:null,orgUnitId:null};a&&1===a.length&&(e.programId=a[0].id),l&&1===l.length&&(e.orgUnitId=l[0].id),Object.keys(e).length&&r.push(`?${Is({...e})}`)}),[r,a,l]);return(0,y.useEffect)((()=>{e||(Object.keys(n).length>0||"/"!==r.location.pathname?t(!0):o||s||(d(),t(!0)))}),[a,r,o,e,n,s,l,d]),{isReady:e}},vte=e=>{let{children:t}=e;const{isReady:r}=yte();return r?t:y.createElement(O,null)},fte=e=>{let{store:t}=e;return y.createElement(y.Fragment,null,y.createElement(gs.Kq,{store:t},y.createElement(P9.A,null,y.createElement(vte,null,y.createElement(Ete,null,y.createElement(hte,null))))))},Ite="CleanUpEventListInLoading";function bte(e){return e.workingListsUI.main&&e.workingListsUI.main.isLoading?l(Ite)():null}function Ste(e){window.addEventListener("beforeunload",(async t=>{if((e=>{const t=[bte(e.getState())].filter((e=>e));t.length>0&&e.dispatch((0,Xd.OJ)(t))})(e),e.getState().offline.outbox.length>0){const e="Unsaved events!";return t.returnValue=e,e}}))}const Tte=()=>y.createElement("div",null,n.A.t("You opened another version of the Capture App in the same domain. Currently, the Capture App only supports running one version concurrently (in the same domain). Please refresh this page if you would like to use this version again, but be aware that this will close other versions."));var Ate=r(13542),Cte=r(46009);const Ote=document.createElement("noscript");Ote.setAttribute("id","jss-insertion-point"),document.head.appendChild(Ote);const Nte=(0,I.createGenerateClassName)(),Rte=(0,Cte.vt)((0,I.jssPreset)());Rte.options.insertionPoint=Ote;const wte=e=>{let{children:t}=e;return y.createElement(Ate.GL,{jss:Rte,generateId:Nte},t)},_te={main:"#1976D2",dark:"#004BA0",light:vn.T.blue600,lightest:"#EAF4FF"},Pte=(0,I.createMuiTheme)({overrides:{MuiDialog:{paperWidthLg:{width:800}},MuiSvgIcon:{colorAction:{color:"#494949"}},MuiCircularProgress:{colorPrimary:{color:vn.T.blue600}}},typography:{useNextVariants:!0},palette:{primary:_te,secondary:{main:vn.T.teal600,dark:"#004C40",light:"#48A999",lightest:vn.T.teal200},error:{red200:vn.T.red200,lighter:"#FBEAE5",light:vn.T.red300,main:"#E53935",dark:vn.T.red500},warning:{lighter:"#FFF9C4",light:"#FFF176",main:"#F19C02",dark:"#F57F17"},success:{main:"#3D9305",green600:vn.T.green600},green:{},info:{main:"#EAF4FF"},grey:{main:"#9E9E9E",light:"#E0E0E0",lighter:"#F6F6F6",lightest:"#FBFBFB",dark:"#494949",blueGrey:"#ECEFF1",snow:"#F4F6F8",black:"#000000"}}});Pte.typography.formFieldTitle={fontSize:Pte.typography.pxToRem(12)},Pte.palette={...Pte.palette,accent:{lighter:vn.T.blue100,light:"#BBDEFB",main:"#64b5F6",dark:vn.T.blue500,contrastText:"#000000"},input:{bottomLine:"rgba(0, 0, 0, 0.42)"},dividerForm:"#f2f4f5",dividerDarker:"rgba(0, 0, 0, 1)",dividerLighter:"rgba(224, 224, 224, 1)",required:vn.T.red400};const kte=()=>{const[e,t]=(0,y.useState)(!1),[r,n]=(0,y.useState)(!1),a=(0,y.useRef)(),o=(0,y.useCallback)((e=>{a.current=e,t(!0),e.dispatch(l(g)()),Ste(e)}),[t,a]),i=(0,y.useCallback)((()=>{n(!0)}),[n]);return r?y.createElement(Tte,null):y.createElement(y.Fragment,null,y.createElement(f.A,null),y.createElement(wte,null,y.createElement(I.MuiThemeProvider,{theme:Pte},y.createElement(v.I9,null,e?y.createElement(fte,{store:a.current}):y.createElement(_9,{onRunApp:o,onCacheExpired:i})))))};var Dte=r(25642),Ute=r(8056),Lte=r(50272),Fte=r(36505),xte=r(99471),Mte=r(53667),Vte=r(26657),jte=r(59565),Gte=r(63572),Bte=r(98668),$te=r(85056),Wte=r(36984),Hte=r(89104),zte=r(60527),Yte=r(36220),qte={container:"App_container__KkHQY",sidebar:"App_sidebar__EbNVl",content:"App_content__MxC6Z",corelytics_sidebar:"App_corelytics_sidebar__UQ+q2","ant-menu-item":"App_ant-menu-item__XNXWL",heading:"App_heading__21opY"};const{Sider:Kte,Content:Qte}=Wte.A,Xte={me:{resource:"me"}};var Jte=()=>{const[e,t]=(0,y.useState)(!1),{error:r,loading:n}=(0,A.iO)(Xte);if(r)return y.createElement("span",null,o.t("ERROR"));if(n)return y.createElement("span",null,o.t("Loading..."));const a=y.createElement(Hte.A,null,y.createElement(Hte.A.Item,{key:"profile-settings",icon:y.createElement(Dte.A,null)},y.createElement("a",{href:"/corelytics-web-user-profile/#/profile"},"Settings")),y.createElement(Hte.A.Item,{key:"account",icon:y.createElement(Ute.A,null)},y.createElement("a",{href:"/corelytics-web-user-profile/#/account"},"Account")),y.createElement(Hte.A.Item,{key:"logout",icon:y.createElement(Lte.A,null)},y.createElement("a",{href:"/dhis-web-commons-security/logout.action"},"Logout")));return y.createElement(Wte.A,{style:{minHeight:"100vh"}},y.createElement(Kte,{trigger:null,collapsible:!0,collapsed:e,className:qte.sidebar,style:{position:"fixed",height:"98vh",overflow:"hidden",width:e?"80px":"200px",transition:"width 0.2s",backgroundColor:"#ffffff",borderRight:"2px solid #d9d9d9"}},y.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"}},y.createElement("img",{src:"https://res.cloudinary.com/diaxcqxfp/image/upload/v1730971091/prescott-logo.png",alt:"Cloudinary Icon",style:{width:"50px",height:"55px"}}),y.createElement(zte.Ay,{type:"text",icon:e?y.createElement(Fte.A,{fontSize:"medium"}):y.createElement(xte.A,{fontSize:"medium"}),onClick:()=>t(!e),style:{fontSize:"50px",width:"64px",height:"64px"}})),y.createElement(Hte.A,{mode:"inline",defaultSelectedKeys:["4"],style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px 0"}},y.createElement(Hte.A.Item,{key:"1",icon:y.createElement(Mte.A,null)},y.createElement("a",{href:"/corelytics-web-usage-analytics/"},"Home")),y.createElement(Hte.A.Item,{key:"2",icon:y.createElement(Vte.A,null)},y.createElement("a",{href:"/corelytics-web-dashboard/"},"Visualization")),y.createElement(Hte.A.Item,{key:"3",icon:y.createElement(jte.A,null)},y.createElement("a",{href:"/corelytics-web-maintenance/"},"Admin Toolkit")),y.createElement(Hte.A.Item,{key:"4",icon:y.createElement(Gte.A,null)},y.createElement("a",{href:"/corelytics-web-capture/"},"Forms Hub")),y.createElement(Hte.A.Item,{key:"5",icon:y.createElement(Bte.A,null)},y.createElement("a",{href:"/corelytics-web-aggregate-data-entry/"},"Bulk Data Entry")),y.createElement(Hte.A.Item,{key:"6",icon:y.createElement($te.A,null)},y.createElement("a",{href:"/corelytics-web-import-export/"},"Data Import/Export")),y.createElement(Hte.A.Item,{key:"7",icon:y.createElement(Ute.A,null)},y.createElement("a",{href:"/corelytics-web-user/"},"User Management")),y.createElement(Hte.A.Item,{key:"8",icon:y.createElement(Dte.A,null)},y.createElement("a",{href:"/corelytics-web-settings/"},"System Settings")))),y.createElement(Wte.A,{style:{marginLeft:e?"85px":"205px",transition:"margin-left 0.2s"}},y.createElement("div",{className:qte.titBar,style:{height:"30px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px"}},y.createElement("h4",{className:qte.heading},"Forms Hub")),y.createElement(Qte,{style:{margin:"15px",padding:15,minHeight:280,background:"#fff",borderRadius:"8px",border:"1px solid #D7D7D7"}},y.createElement(kte,null))),y.createElement(Yte.A,{overlay:a,trigger:["click"],placement:"topLeft",arrow:!0},y.createElement("div",{style:{position:"fixed",bottom:"20px",left:"20px",zIndex:1e3}},y.createElement(zte.Ay,{type:"primary",shape:"circle",size:"large",style:{backgroundColor:"#1890ff",color:"#fff",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",border:"none"},icon:y.createElement(Ute.A,null)}))))}},96092:function(e,t,r){"use strict";r.d(t,{p:function(){return n}});const n=e=>t=>({...t,message:e})},65016:function(){Object.defineProperty(Array.prototype,"toHashMap",{enumerable:!1,value:function(e){return this.reduce(((t,r)=>(t[r[e]]=r,t)),{})}})},20579:function(){Object.defineProperty(Array.prototype,"asyncForEach",{enumerable:!1,value:async function(e,t,r){for(let n=0;n<this.length;n++)await e(this[n],n,this)}})},51079:function(e,t,r){"use strict";r.d(t,{Gv:function(){return n},UR:function(){return u},L8:function(){return o},An:function(){return c},iT:function(){return l}});const n=Object.freeze({storeProgramStageWorkingList:"storeProgramStageWorkingList",multiText:"multiText",customIcons:"customIcons",newTransferQueryParam:"newTransferQueryParam",exportablePayload:"exportablePayload",changelogs:"changelogs",trackerImageEndpoint:"trackerImageEndpoint",trackerFileEndpoint:"trackerFileEndpoint",trackedEntitiesCSV:"trackedEntitiesCSV",newAocApiSeparator:"newAocApiSeparator",newEntityFilterQueryParam:"newEntityFilterQueryParam"}),a=Object.freeze({[n.storeProgramStageWorkingList]:40,[n.multiText]:41,[n.customIcons]:41,[n.exportablePayload]:41,[n.trackerImageEndpoint]:41,[n.trackerFileEndpoint]:41,[n.newTransferQueryParam]:41,[n.changelogs]:41,[n.trackedEntitiesCSV]:40,[n.newAocApiSeparator]:41,[n.newEntityFilterQueryParam]:41}),o=(e,t)=>a[t]<=Number(e)||!1;var i=r(50016),s=r(60898);const l=e=>{const{serverVersion:{minor:t}}=(0,s.UK)();return(0,i.useMemo)((()=>o(t,e)),[t,e])};let d="";const c=e=>{d=e.minor},u=e=>o(d,e)},5947:function(e,t,r){"use strict";r.d(t,{Gv:function(){return l.Gv},c$:function(){return o},iv:function(){return s},px:function(){return n.p},UR:function(){return l.UR},L8:function(){return l.L8},gI:function(){return i},Fs:function(){return a},iT:function(){return l.iT}});var n=r(96092);const a=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return t.reduce(((e,t)=>t(e,...n)),e)}},o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.map((e=>e.replace(/(^\/)|(\/$)/,""))).join("/")},i=e=>{let t=!1;return{promise:new Promise(((r,n)=>{e.then((e=>t?n({isCanceled:!0}):r(e)),(e=>n(t?{isCanceled:!0}:e)))})),cancel:()=>{t=!0}}};function s(e,t){if(!e||0===e.length)return[];if(!t||t<1)return[e];return function(e,t,r){const n=[];for(let a=0,o=0;a<e;a+=1,o+=r)n[a]=t.slice(o,o+r);return n}(Math.ceil(e.length/t),e,t)}var l=r(51079)},68449:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{y:function(){return D2CustomForm}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(50016),loglevel__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26517),loglevel__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(loglevel__WEBPACK_IMPORTED_MODULE_1__),react_transform_tree__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2040),capture_core_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5947),_metaData__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(661);function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}class D2CustomForm extends react__WEBPACK_IMPORTED_MODULE_0__.Component{static getEventListenersForCurrentNode(e){return Object.keys(e).filter((e=>e.startsWith("on")))}static getEventListenerSpecsForCurrentNode(e,t,r){return e.map((e=>{const n=t[e],a=e.replace(/^on/,"");return{id:r,type:a,handler:n}}))}static renderField(e,t,r){return r({...e,props:{...e.props,customFormElementProps:t}})}constructor(e){super(e),this.preProcessSourceTree()}componentDidMount(){this.addScripts(),this.addEventListeners()}componentWillUnmount(){this.removeEventListeners()}preProcessSourceTree(){const{specs:e}=this.props,t=e.data.elements;let r=1,n=[],a=[];try{a=(0,react_transform_tree__WEBPACK_IMPORTED_MODULE_2__.GG)(t,{[react_transform_tree__WEBPACK_IMPORTED_MODULE_2__.EZ.DOM_ELEMENT]:e=>{const{node:t}=e,{props:a}=t;if(a){const o=D2CustomForm.getEventListenersForCurrentNode(a);if(o.length>0){const i=D2CustomForm.getEventListenerSpecsForCurrentNode(o,a,r);n=[...n,...i];const s=Object.keys(a).reduce(((e,t)=>(o.includes(t)||(e[t]=a[t]),e)),{}),l=react__WEBPACK_IMPORTED_MODULE_0__.cloneElement(t,{...s,"data-custom-form-id":r},...e.walkChildren());return r+=1,l}}return react__WEBPACK_IMPORTED_MODULE_0__.cloneElement(t,t.props,...e.walkChildren())}})}catch(o){loglevel__WEBPACK_IMPORTED_MODULE_1___default().error((0,capture_core_utils__WEBPACK_IMPORTED_MODULE_3__.px)(D2CustomForm.errorMessages.PRE_PROCESS_FAILED)({sourceTree:t,error:o})),n=[],a=[]}this.eventListenerSpecs=n,this.preProcessedSourceTree=a}addScripts(){this.props.specs.data.scripts.forEach((e=>{const t=document.createElement("script");t.type="text/javascript",t.async=!0,t.innerHTML=e,document.body.appendChild(t)}))}addEventListeners(){const eventListenerSpecs=this.eventListenerSpecs,specsWithHandlerRef=eventListenerSpecs.map((spec=>{const handlerRef=()=>{eval(spec.handler)};return document.querySelector(`[data-custom-form-id="${spec.id}"]`).addEventListener(spec.type,handlerRef),{...spec,handlerRef:handlerRef}}));this.eventListenerSpecs=specsWithHandlerRef}removeEventListeners(){this.eventListenerSpecs.forEach((e=>{document.querySelector(`[data-custom-form-id="${e.id}"]`).removeEventListener(e.type,e.handlerRef)}))}transform(){const{fields:e,onRenderField:t}=this.props,r=this.preProcessedSourceTree;return(0,react_transform_tree__WEBPACK_IMPORTED_MODULE_2__.GG)(r,{[react_transform_tree__WEBPACK_IMPORTED_MODULE_2__.EZ.DOM_ELEMENT]:r=>{const{node:n}=r;if("FormField"===n.type){const r=n.props.id,a=e.find((e=>e.id===r));return a?D2CustomForm.renderField(a,n.props.customFormElementProps,t):null}return r.defaultHandler()}})}render(){const e=this.transform();return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",null,e)}}_defineProperty(D2CustomForm,"errorMessages",{PRE_PROCESS_FAILED:"Could not pre process custom form source tree"})},10234:function(e,t,r){"use strict";r.d(t,{fq:function(){return c},H:function(){return g},Ew:function(){return E},CO:function(){return d},AA:function(){return h}});var n=r(26517),a=r.n(n),o=r(53685),i=r(61964),s=r(5947),l=r(75876);const d={TEXT:"TEXT",MULTI_TEXT:"MULTI_TEXT",LONG_TEXT:"LONG_TEXT",NUMBER:"NUMBER",NUMBER_RANGE:"NUMBER_RANGE",INTEGER:"INTEGER",INTEGER_RANGE:"INTEGER_RANGE",INTEGER_POSITIVE:"INTEGER_POSITIVE",INTEGER_POSITIVE_RANGE:"INTEGER_POSITIVE_RANGE",INTEGER_NEGATIVE:"INTEGER_NEGATIVE",INTEGER_NEGATIVE_RANGE:"INTEGER_NEGATIVE_RANGE",INTEGER_ZERO_OR_POSITIVE:"INTEGER_ZERO_OR_POSITIVE",INTEGER_ZERO_OR_POSITIVE_RANGE:"INTEGER_ZERO_OR_POSITIVE_RANGE",PERCENTAGE:"PERCENTAGE",DATE:"DATE",DATE_RANGE:"DATE_RANGE",DATETIME:"DATETIME",DATETIME_RANGE:"DATETIME_RANGE",TIME:"TIME",TIME_RANGE:"TIME_RANGE",TRUE_ONLY:"TRUE_ONLY",BOOLEAN:"BOOLEAN",PHONE_NUMBER:"PHONE_NUMBER",EMAIL:"EMAIL",FILE_RESOURCE:"FILE_RESOURCE",URL:"URL",ORGANISATION_UNIT:"ORGANISATION_UNIT",IMAGE:"IMAGE",AGE:"AGE",COORDINATE:"COORDINATE",POLYGON:"POLYGON",USERNAME:"USERNAME",ASSIGNEE:"ASSIGNEE",STATUS:"STATUS",UNKNOWN:"UNKNOWN"};class c{constructor(e){this._displayInReports=!0,this._displayInForms=!0,this.disabled=!1,this.compulsory=!1,e&&(0,o.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}set name(e){this._name=e}get name(){return this._name}set section(e){this._section=e}get section(){return this._section}set code(e){this._code=e}get code(){return this._code}set shortName(e){this._shortName=e}get shortName(){return this._shortName}set formName(e){this._formName=e}get formName(){return this._formName}set displayInForms(e){this._displayInForms=null==e||e}set displayInReports(e){this._displayInReports=null==e||e}get displayInReports(){return this._displayInReports}set disabled(e){this._disabled=!!e}get disabled(){return this._disabled}set compulsory(e){this._compulsory=!!e}get compulsory(){return this._compulsory}set description(e){this._description=e}get description(){return this._description}set type(e){d[e]?this._type=e:(a().warn((0,s.px)(c.errorMessages.TYPE_NOT_FOUND)({dataElement:this,type:e})),this._type=d.UNKNOWN)}get type(){return this._type}set optionSet(e){this._optionSet=e}get optionSet(){return this._optionSet}set icon(e){this._icon=e}get icon(){return this._icon}set unique(e){this._unique=e}get unique(){return this._unique}get inherit(){return this._inherit}set inherit(e){this._inherit=e}set searchable(e){this._searchable=e}get searchable(){return this._searchable}set url(e){this._url=e}get url(){return this._url}get attributeValues(){return this._attributeValues}set attributeValues(e){this._attributeValues=e}*getPropertyNames(){const e=["getPropertyNames","constructor","copyPropertiesTo","getConvertedOptionSet","convertValue"];for(const t of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))e.includes(t)||(yield t)}copyPropertiesTo(e){for(const t of this.getPropertyNames())e[t]=this[t];return e}getConvertedOptionSet(e){if(this.optionSet){const t=this.optionSet.options.map((e=>e.clone())),r=new l.G(this.optionSet.id,t,null,this,e,this.optionSet.attributeValues);return r.inputType=this.optionSet.inputType,r.viewType=this.optionSet.viewType,r.emptyText=this.optionSet.emptyText,r}return null}convertValue(e,t){return(0,i.default)(e)?e.map((e=>t(e,this.type,this))):t(e,this.type,this)}}var u,p,m;u=c,m={TYPE_NOT_FOUND:"type not supported"},(p=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(p="errorMessages"))in u?Object.defineProperty(u,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):u[p]=m;class g extends c{constructor(e){super(),this._allowFutureDate=!0,e&&e(this)}set allowFutureDate(e){this._allowFutureDate=!!e}get allowFutureDate(){return this._allowFutureDate}}const h={ENTIRE_SYSTEM:"entireSystem",ORGANISATION_UNIT:"organisationUnit"};class E{constructor(e){this._scope=h.ENTIRE_SYSTEM,this._generatable=!1,e&&e(this)}set generatable(e){this._generatable=e}get generatable(){return this._generatable}set scope(e){this._scope=e}get scope(){return this._scope}set onValidate(e){this._onValidate=e}get onValidate(){return this._onValidate}}},35236:function(e,t,r){"use strict";r.d(t,{g:function(){return a}});var n=r(53685);r(10234);class a{constructor(e){e&&(0,n.A)(e)&&e(this)}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get fields(){return this._fields}set fields(e){this._fields=e}get pluginSource(){return this._pluginSource}get customAttributes(){return this._customAttributes}set customAttributes(e){this._customAttributes=e}set pluginSource(e){this._pluginSource=e}addField(e,t){this.fields.has(e)||this.fields.set(e,t)}}},41554:function(e,t,r){"use strict";r.d(t,{c:function(){return a}});var n=r(53685);class a{constructor(e){e&&(0,n.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}get code(){return this._code}set code(e){this._code=e}set value(e){this._value=e}get value(){return this._value}set text(e){this._text=e}get text(){return this._text}set description(e){this._description=e}get description(){return this._description}set icon(e){this._icon=e}get icon(){return this._icon}get attributeValues(){return this._attributeValues}set attributeValues(e){this._attributeValues=e}clone(){return new a((e=>{Object.getOwnPropertyNames(this).forEach((t=>{"_icon"===t&&this[t]?e.icon=this.icon.clone():e[t]=this[t]}))}))}}},69983:function(e,t,r){"use strict";r.d(t,{z:function(){return a}});var n=r(53685);class a{constructor(e){e&&(0,n.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}set optionIds(e){this._optionIds=e}get optionIds(){return this._optionIds}}},75876:function(e,t,r){"use strict";r.d(t,{G:function(){return d}});var n=r(26517),a=r.n(n),o=r(61964),i=r(5947),s=r(40145);function l(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class d{constructor(e,t,r,n,a,o){this._options=t?t.reduce(((e,t)=>(t.value||!1===t.value||0===t.value?(t.value=a&&n?a(t.value,n.type,n):t.value,e.push(t)):this._emptyText=t.text,e)),[]):[],this._optionGroups=r||new Map,this._id=e,this._dataElement=n,this._attributeValues=o||[],this._inputType=s.UB.DROPDOWN}set id(e){this._id=e}get id(){return this._id}set inputType(e){e&&(s.zf.includes(e)?this._inputType=e:a().warn((0,i.px)(d.errorMessages.UNSUPPORTED_INPUTTYPE)({optionSet:this,inputType:e})))}get inputType(){return this._inputType}set viewType(e){e&&(s.fz[e]?this._viewType=e:a().warn((0,i.px)(d.errorMessages.UNSUPPORTED_VIEWTYPE)({optionSet:this,viewType:e})))}get viewType(){return this._viewType}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e}get attributeValues(){return this._attributeValues}set attributeValues(e){this._attributeValues=e}get options(){return this._options}get optionGroups(){return this._optionGroups}set optionGroups(e){this._optionGroups=e}get dataElement(){return this._dataElement}addOption(e){e.value||!1===e.value||0===e.value?this._options.push(e):this._emptyText=e.text}getOptionThrowIfNotFound(e){const t=this.options.find((t=>t.value===e));if(!t)throw new Error((0,i.px)(d.errorMessages.OPTION_NOT_FOUND)({OptionSet:this,value:e}));return t}getOption(e){const t=this.options.find((t=>t.value===e));return t||a().warn((0,i.px)(d.errorMessages.OPTION_NOT_FOUND)({OptionSet:this,value:e})),t}getOptionsThrowIfNotFound(e){return e.map((e=>{const t=this.options.find((t=>t.value===e));if(!t)throw new Error((0,i.px)(d.errorMessages.OPTION_NOT_FOUND)({OptionSet:this,value:e}));return t}))}getOptions(e){return e.reduce(((e,t)=>{const r=this.options.find((e=>e.value===t));return r?e.push(r):a().warn((0,i.px)(d.errorMessages.OPTION_NOT_FOUND)({OptionSet:this,value:t})),e}),[])}getOptionText(e){const t=this.getOption(e);return t&&t.text}getOptionsText(e){return this.getOptions(e).map((e=>e.text))}getMultiOptionsText(e){return e.split(d.multiOptionsValuesSeparator).reduce(((e,t)=>{const r=this.options.find((e=>e.value===t));return r?e.push(r.text):a().warn((0,i.px)(d.errorMessages.OPTION_NOT_FOUND)({OptionSet:this,code:t})),e}),[]).join(`${d.multiOptionsValuesSeparator} `)}getOptionsTextAsString(e){return this.getOptionsText(e).toString()}resolveTextsAsString(e){return(0,o.default)(e)?this.getOptionsTextAsString(e):this.getOptionText(e)}}l(d,"errorMessages",{OPTION_NOT_FOUND:"Option not found",UNSUPPORTED_VIEWTYPE:"Tried to set an unsupported viewType",UNSUPPORTED_INPUTTYPE:"Tried to set an unsuported inputType"}),l(d,"multiOptionsValuesSeparator",",")},40145:function(e,t,r){"use strict";r.d(t,{UB:function(){return n},fz:function(){return o},zf:function(){return a}});const n={DROPDOWN:"dropdown",VERTICAL_RADIOBUTTONS:"verticalRadiobuttons",HORIZONTAL_RADIOBUTTONS:"horizontalRadiobuttons"},a=Object.keys(n).map((e=>n[e])),o={ICON:"ICON",ICON_WITH_COLOR:"ICON_WITH_COLOR"}},68557:function(e,t,r){"use strict";r.d(t,{RQ:function(){return E},jV:function(){return c},BN:function(){return d},rr:function(){return u}});var n=r(53685);let a;a=Symbol.iterator;class o{constructor(e){this.programRules=[],this.programRuleVariables=[],this.organisationUnits={},this._stages=new Map,this._organisationUnits={},e&&(0,n.A)(e)&&e(this)}*[a](){for(const e of this._stages.values())yield e}set id(e){this._id=e}get id(){return this._id}set access(e){this._access=e}get access(){return this._access}set name(e){this._name=e}get name(){return this._name}set shortName(e){this._shortName=e}get shortName(){return this._shortName}set organisationUnits(e){this._organisationUnits=e||{}}get organisationUnits(){return this._organisationUnits}set categoryCombination(e){this._categoryCombination=e}get categoryCombination(){return this._categoryCombination}set programRules(e){this._programRules=e}get programRules(){return this._programRules}set programRuleVariables(e){this._programRuleVariables=e}get programRuleVariables(){return this._programRuleVariables}set icon(e){this._icon=e}get icon(){return this._icon}set displayFrontPageList(e){this._displayFrontPageList=e}get displayFrontPageList(){return this._displayFrontPageList}set useFirstStageDuringRegistration(e){this._useFirstStageDuringRegistration=e}get useFirstStageDuringRegistration(){return this._useFirstStageDuringRegistration}set onlyEnrollOnce(e){this._onlyEnrollOnce=e}get onlyEnrollOnce(){return this._onlyEnrollOnce}get stages(){return this._stages}addStage(e){this.stages.set(e.id,e)}getStage(e){return this.stages.get(e)}addProgramRuleVariables(e){this.programRuleVariables=[...this.programRuleVariables,...e]}addProgramRules(e){this.programRules=[...this.programRules,...e]}}var i,s,l;i=o,l={STAGE_NOT_FOUND:"Stage was not found",STAGE_INDEX_NOT_FOUND:"No stage found on index"},(s=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(s="errorMessages"))in i?Object.defineProperty(i,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[s]=l;class d{constructor(e){this.programRules=[],e&&(0,n.A)(e)&&e(this)}get stageForm(){return this._stageForm}set stageForm(e){this._stageForm=e}get blockEntryForm(){return this._blockEntryForm}set blockEntryForm(e){this._blockEntryForm=e}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get access(){return this._access}set access(e){this._access=e}get untranslatedName(){return this._untranslatedName}set untranslatedName(e){this._untranslatedName=e}set icon(e){this._icon=e}get icon(){return this._icon}get relationshipTypes(){return this._relationshipTypes}get relationshipTypesWhereStageIsFrom(){return this._relationshipTypes?this._relationshipTypes.filter((e=>e.from.programStageId&&e.from.programStageId===this.id)):[]}set relationshipTypes(e){this._relationshipTypes=e}get enableUserAssignment(){return this._enableUserAssignment}set enableUserAssignment(e){this._enableUserAssignment=e}get autoGenerateEvent(){return this._autoGenerateEvent}set autoGenerateEvent(e){this._autoGenerateEvent=e}get allowGenerateNextVisit(){return this._allowGenerateNextVisit}set allowGenerateNextVisit(e){this._allowGenerateNextVisit=e}get askCompleteEnrollmentOnEventComplete(){return this._askCompleteEnrollmentOnEventComplete}set askCompleteEnrollmentOnEventComplete(e){this._askCompleteEnrollmentOnEventComplete=e}get hideDueDate(){return this._hideDueDate}set hideDueDate(e){this._hideDueDate=e}get generatedByEnrollmentDate(){return this._generatedByEnrollmentDate}set generatedByEnrollmentDate(e){this._generatedByEnrollmentDate=e}get openAfterEnrollment(){return this._openAfterEnrollment}set openAfterEnrollment(e){this._openAfterEnrollment=e}get reportDateToUse(){return this._reportDateToUse}set reportDateToUse(e){void 0===e&&(e="enrolledAt"),this._reportDateToUse="false"===e?"enrolledAt":e}get minDaysFromStart(){return this._minDaysFromStart}set minDaysFromStart(e){void 0===e&&(e=0),this._minDaysFromStart=e}set programRules(e){this._programRules=e}get programRules(){return this._programRules}set repeatable(e){this._repeatable=e}get repeatable(){return this._repeatable}}class c extends o{constructor(e){super(),e&&(0,n.A)(e)&&e(this)}set stage(e){this._stages.set(c.EVENT_PROGRAM_STAGE_KEY,e)}get stage(){return this._stages.get(c.EVENT_PROGRAM_STAGE_KEY)}getStage(){return this._stages.get(c.EVENT_PROGRAM_STAGE_KEY)}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(c,"EVENT_PROGRAM_STAGE_KEY","EventProgramStage");class u extends o{constructor(e){super(),this._attributes=[],e&&(0,n.A)(e)&&e(this)}get searchGroups(){return this._searchGroups}set searchGroups(e){this._searchGroups=e}get trackedEntityType(){return this._trackedEntityType}set trackedEntityType(e){this._trackedEntityType=e}get enrollment(){return this._enrollment}set enrollment(e){this._enrollment=e}get attributes(){return this._attributes}set attributes(e){this._attributes=e}}const p="occurredAt",m="enrolledAt",g="Incident date",h="Enrollment date";class E{constructor(e){this._labels={[p]:g,[m]:h},this._optionFlags={allowFutureEnrollmentDate:!1,allowFutureIncidentDate:!1,showIncidentDate:!0},e&&(0,n.A)(e)&&e(this)}set enrollmentForm(e){this._enrollmentForm=e}get enrollmentForm(){return this._enrollmentForm}set incidentDateLabel(e){this._labels[p]=e}get incidentDateLabel(){return this._labels[p]}set enrollmentDateLabel(e){this._labels[m]=e}get enrollmentDateLabel(){return this._labels[m]}set allowFutureEnrollmentDate(e){this._optionFlags.allowFutureEnrollmentDate=e}get allowFutureEnrollmentDate(){return this._optionFlags.allowFutureEnrollmentDate}set allowFutureIncidentDate(e){this._optionFlags.allowFutureIncidentDate=e}get allowFutureIncidentDate(){return this._optionFlags.allowFutureIncidentDate}set showIncidentDate(e){this._optionFlags.showIncidentDate=e}get showIncidentDate(){return this._optionFlags.showIncidentDate}set inputSearchGroups(e){this._inputSearchGroups=e}get inputSearchGroups(){return this._inputSearchGroups}set trackedEntityType(e){this._trackedEntityType=e}get trackedEntityType(){return this._trackedEntityType}}},38085:function(e,t,r){"use strict";r.d(t,{T:function(){return n},w:function(){return a}});const n={NONE:"none",ON_UPDATE_AND_INSERT:"onUpdateAndInsert",ON_COMPLETE:"onComplete"},a=Object.keys(n).map((e=>n[e]))},40524:function(e,t,r){"use strict";r.d(t,{k:function(){return o},U:function(){return a}});var n=r(53685);class a{constructor(e){this._attributes=[],e&&(0,n.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}set access(e){this._access=e}get access(){return this._access}set name(e){this._name=e}get name(){return this._name}set teiRegistration(e){this._teiRegistration=e}get teiRegistration(){return this._teiRegistration}set searchGroups(e){this._searchGroups=e}get searchGroups(){return this._searchGroups}set attributes(e){this._attributes=e}get attributes(){return this._attributes}}class o{constructor(e){e&&(0,n.A)(e)&&e(this)}set form(e){this._form=e}get form(){return this._form}set inputSearchGroups(e){this._inputSearchGroups=e}get inputSearchGroups(){return this._inputSearchGroups}set trackedEntityType(e){this._trackedEntityType=e}get trackedEntityType(){return this._trackedEntityType}}},64859:function(e,t,r){"use strict";r.d(t,{u:function(){return d}});var n=r(26517),a=r.n(n),o=r(77852),i=r(5947),s=r(40701);const l={PROGRAM_NOT_FOUND:"Program not found",STAGE_NOT_FOUND:"Stage not found",GENERIC_ERROR:"An error has occured. See log for details"};function d(e){const t=s.J.get(e);if(!t)return a().error((0,i.px)(l.PROGRAM_NOT_FOUND)({programId:e})),{error:o.A.t(l.GENERIC_ERROR),stage:null};const r=t.stage;return r?{stage:r,error:null}:(a().error((0,i.px)(l.STAGE_NOT_FOUND)({programId:e})),{error:o.A.t(l.GENERIC_ERROR),stage:null})}},56442:function(e,t,r){"use strict";r.d(t,{S:function(){return n},m:function(){return a}});const n={EVENT_PROGRAM:"EVENT_PROGRAM",TRACKER_PROGRAM:"TRACKER_PROGRAM"},a={...n,TRACKED_ENTITY_TYPE:"TRACKED_ENTITY_TYPE"}},34508:function(e,t,r){"use strict";r.d(t,{W:function(){return i}});var n=r(68557),a=r(40524),o=r(52417);function i(e){if(!e)return null;const t=o.Jj.get(e)||o.zK.get(e);return t instanceof n.jV||t instanceof n.rr||t instanceof a.U?t:null}},12813:function(e,t,r){"use strict";r.d(t,{h:function(){return s},q:function(){return l}});var n=r(68557),a=r(40524),o=r(34508),i=r(56442);const s=e=>{const t=(0,o.W)(e);return l(t)},l=e=>{if(e instanceof n.jV){return{trackedEntityName:"",programName:e.name,scopeType:i.m.EVENT_PROGRAM,tetId:null}}if(e instanceof n.rr){return{trackedEntityName:e.trackedEntityType?e.trackedEntityType.name.toLowerCase():"",programName:e.name,scopeType:i.m.TRACKER_PROGRAM,tetId:e.trackedEntityType.id}}if(e instanceof a.U){return{trackedEntityName:e.name.toLowerCase(),programName:"",scopeType:i.m.TRACKED_ENTITY_TYPE,tetId:e.id}}return{programName:"",scopeType:"",trackedEntityName:"",tetId:""}}},41519:function(e,t,r){"use strict";r.d(t,{p:function(){return d}});var n=r(26517),a=r.n(n),o=r(77852),i=r(5947),s=r(40701);const l={PROGRAM_NOT_FOUND:"Program not found",STAGE_NOT_FOUND:"Stage not found",GENERIC_ERROR:"An error has occured. See log for details"};function d(e){const t=e.eventId,r=s.J.get(e.programId);if(!r)return a().error((0,i.px)(l.PROGRAM_NOT_FOUND)({eventId:t,event:e})),{error:o.A.t(l.GENERIC_ERROR),stage:null};const n=r.getStage(e.programStageId);return n?{stage:n,error:null}:(a().error((0,i.px)(l.STAGE_NOT_FOUND)({eventId:t,event:e})),{error:o.A.t(l.GENERIC_ERROR),stage:null})}},60196:function(e,t,r){"use strict";r.d(t,{Li:function(){return C},Nn:function(){return w},xv:function(){return m},n$:function(){return u},RE:function(){return D},ei:function(){return y},$j:function(){return P},Ec:function(){return f},Nd:function(){return L},WB:function(){return O.W},he:function(){return _.h},uJ:function(){return n.u},mu:function(){return b},x6:function(){return h},S2:function(){return N.S},m2:function(){return N.m}});var n=r(64859),a=r(26517),o=r.n(a),i=r(77852),s=r(5947),l=r(52417),d=r(68557);const c={PROGRAM_NOT_FOUND:"Program not found or program not an event program",GENERIC_ERROR:"An error has occured. See log for details"};function u(e){const t=l.Jj.get(e);if(!t||!(t instanceof d.jV))throw o().error((0,s.px)(c.PROGRAM_NOT_FOUND)({programId:e})),Error(i.A.t(c.GENERIC_ERROR));return t}var p=r(40701);function m(e,t){const r=u(e).stage,n={read:r.stageForm.access.data.read,write:r.stageForm.access.data.write};return t&&n.write&&(n.write=Object.keys(t).every((e=>t[e].writeAccess))),n}const g={PROGRAM_NOT_FOUND:"Program not found",PROGRAM_NOT_FOUND_DISPLAY:i.A.t("Program not found"),NOT_TRACKER_PROGRAM:"Program is not a tracker program",NOT_TRACKER_PROGRAM_DISPLAY:i.A.t("Program is not a tracker program")};function h(e){const t=l.Jj.get(e);if(!t)throw o().error((0,s.px)(g.PROGRAM_NOT_FOUND)({programId:e})),Error(g.PROGRAM_NOT_FOUND_DISPLAY);if(!(t instanceof d.rr))throw o().error((0,s.px)(g.NOT_TRACKER_PROGRAM)({programId:e})),Error(g.NOT_TRACKER_PROGRAM_DISPLAY);return t}const E={PROGRAM_NOT_FOUND:"Program not found",STAGE_NOT_FOUND:"Stage not found",GENERIC_ERROR:"An error has occured. See log for details"};function y(e){const t=e.eventId,r=l.Jj.get(e.programId);if(!r)return o().error((0,s.px)(E.PROGRAM_NOT_FOUND)({eventId:t,event:e})),{error:i.A.t(E.GENERIC_ERROR),stage:null,program:null};const n=r.getStage(e.programStageId);return n?{stage:n,program:r,error:null}:(o().error((0,s.px)(E.STAGE_NOT_FOUND)({eventId:t,event:e})),{error:i.A.t(E.GENERIC_ERROR),stage:null,program:null})}r(41519);const v={PROGRAM_NOT_FOUND:"Program not found",GENERIC_ERROR:"An error has occured. See log for details"};function f(e){const t=l.Jj.get(e);if(!t)throw o().error((0,s.px)(v.PROGRAM_NOT_FOUND)({programId:e})),Error(i.A.t(v.GENERIC_ERROR));return t}const I={TRACKED_ENTITY_TYPE_NOT_FOUND:"Tracked entity type not found",GENERIC_ERROR:"An error has occured. See log for details"};function b(e){const t=l.zK.get(e);if(!t)throw o().error((0,s.px)(I.TRACKED_ENTITY_TYPE_NOT_FOUND)({trackedEntityTypeId:e})),Error(i.A.t(I.GENERIC_ERROR));return t}var S=r(61964),T=r(2086);const A={CONVERT_VALUES_STRUCTURE:"Values can not be converted, data is neither an array or an object"};function C(e,t,r){if(e){const n=function(e){return e.toHashMap("id")}(t);if((0,S.default)(e))return function(e,t,r){return e.map((e=>this.convertObjectValues(e,t,r)))}(e,n,r);if((0,T.A)(e))return function(e,t,r){return Object.keys(e).reduce(((n,a)=>{const o=t[a],i=e[a];return{...n,[a]:o?o.convertValue(i,r):i}}),{})}(e,n,r);o().error((0,s.px)(A.CONVERT_VALUES_STRUCTURE)({values:e}))}return e}var O=r(34508),N=r(56442),R=r(40524);const w=e=>{const t=(0,O.W)(e);return t instanceof d.rr||t instanceof R.U?[...t.attributes.values()]:[]};var _=r(12813);function P(e,t,r){const n=f(e);let a;if(n instanceof d.jV?a=n.stage:t&&(a=null===n||void 0===n?void 0:n.getStage(t)),!a)return o().error((0,s.px)("stage not found")({programId:e,programStageId:t})),null;const i={read:a.stageForm.access.data.read,write:a.stageForm.access.data.write};return r&&i.write&&(i.write=Object.keys(r).every((e=>r[e].writeAccess))),i}const k={PROGRAM_NOT_FOUND:"Program not found",STAGE_NOT_FOUND:"Stage not found",GENERIC_ERROR:"An error has occured. See log for details"};function D(e,t){const r=p.J.get(e);if(!r)return o().error((0,s.px)(k.PROGRAM_NOT_FOUND)({programId:e})),{error:i.A.t(k.GENERIC_ERROR),stage:null,program:null};const n=r instanceof d.jV?r.stage:r.getStage(t);return n?{stage:n,program:r,error:null}:(o().error((0,s.px)(k.STAGE_NOT_FOUND)({program:r,programId:e})),{error:i.A.t(k.GENERIC_ERROR),stage:null,program:null})}const U={PROGRAM_NOT_FOUND:"Program not found",GENERIC_ERROR:"An error has occured. See log for details"};function L(e){const t=l.Jj.get(e);if(!t||!(t instanceof d.rr||t instanceof d.jV))throw o().error((0,s.px)(U.PROGRAM_NOT_FOUND)({programId:e})),Error(i.A.t(U.GENERIC_ERROR));return t}},661:function(e,t,r){"use strict";r.d(t,{b7:function(){return s},C:function(){return l},ii:function(){return N},fq:function(){return d.fq},Ow:function(){return d.Ew},H:function(){return d.H},RQ:function(){return g.RQ},jV:function(){return g.jV},In:function(){return c},Me:function(){return w},c$:function(){return p.c},G2:function(){return u.G},BN:function(){return g.BN},FF:function(){return h},k3:function(){return C},UZ:function(){return R},wn:function(){return S},Xl:function(){return P},kR:function(){return _.k},UC:function(){return _.U},rr:function(){return g.rr},Li:function(){return T.Li},CO:function(){return d.CO},w$:function(){return d.AA},xv:function(){return T.xv},n$:function(){return T.n$},RE:function(){return T.RE},ei:function(){return T.ei},$j:function(){return T.$j},Ec:function(){return T.Ec},Nd:function(){return T.Nd},WB:function(){return T.WB},he:function(){return T.he},uJ:function(){return T.uJ},mu:function(){return T.mu},x6:function(){return T.x6},P$:function(){return m.UB},S2:function(){return T.S2},m2:function(){return T.m2}});var n,a,o,i=r(53685);class s{constructor(e){this.name="",this.id="",e&&(0,i.A)(e)&&e(this)}get name(){return this._name}set name(e){this._name=e}get id(){return this._id}set id(e){this._id=e}}n=s,o={CATEGORY_OPTION_NOT_FOUND:"Category option was not found"},(a=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(a="errorMessages"))in n?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o;class l{constructor(e){this.name="",this.id="",this.categories=new Map,e&&(0,i.A)(e)&&e(this)}get name(){return this._name}set name(e){this._name=e}get id(){return this._id}set id(e){this._id=e}get categories(){return this._categories}set categories(e){this._categories=e}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(l,"errorMessages",{CATEGORY_NOT_FOUND:"Category was not found"});var d=r(10234);class c{constructor(e){this.color="white",e&&(0,i.A)(e)&&e(this)}set color(e){this._color=e}get color(){return this._color}set name(e){this._name=e}get name(){return this._name}clone(){return new c((e=>{Object.getOwnPropertyNames(this).forEach((t=>{e[t]=this[t]}))}))}}var u=r(75876),p=r(41554),m=(r(69983),r(40145)),g=r(68557);class h{constructor(e){e&&(0,i.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}set name(e){this._name=e}get name(){return this._name}set access(e){this._access=e}set referral(e){this._referral=e}get referral(){return this._referral}get access(){return this._access}set from(e){this._from=e}get from(){return this._from}set to(e){this._to=e}get to(){return this._to}get fromToName(){return this._fromToName}set fromToName(e){this._fromToName=e}get toFromName(){return this._toFromName}set toFromName(e){this._toFromName=e}}var E=r(26517),y=r.n(E),v=r(5947),f=r(38085),I=r(43348);function b(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class S{constructor(e){this._visible=!0,this._open=!0,this._collapsible=!1,this._elements=new Map,this._showContainer=!0,e&&(0,i.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}set name(e){this._name=e}get name(){return this._name}set displayDescription(e){this._displayDescription=e}get displayDescription(){return this._displayDescription}set open(e){this._open=!(0,I.A)(e)||e}get open(){return this._open}set visible(e){this._visible=!(0,I.A)(e)||e}get visible(){return this._visible}set customForm(e){this._customForm=e}get customForm(){return this._customForm}set showContainer(e){this._showContainer=!(0,I.A)(e)||e}get showContainer(){return this._showContainer}get elements(){return this._elements}set group(e){this._group=e}get group(){return this._group}addElement(e){this.elements.has(e.id)||this.elements.set(e.id,e)}*getPropertyNames(){const e=["getPropertyNames","constructor","copyPropertiesTo"];for(const t of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))e.includes(t)||(yield t)}copyPropertiesTo(e){for(const t of this.getPropertyNames())e[t]=this[t];return e}}b(S,"MAIN_SECTION_ID","#MAIN#"),b(S,"errorMessages",{DATA_ELEMENT_NOT_FOUND:"Data element was not found"}),b(S,"groups",{ENROLLMENT:"ENROLLMENT",EVENT:"EVENT"});var T=r(60196),A=r(35236);class C{constructor(e){this._sections=new Map,this._labels={},this._validationStrategy=f.T.ON_UPDATE_AND_INSERT,e&&(0,i.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}set access(e){this._access=e}get access(){return this._access}set name(e){this._name=e}get name(){return this._name}set description(e){this._description=e}get description(){return this._description}set programId(e){this._programId=e}get programId(){return this._programId}get sections(){return this._sections}set featureType(e){this._featureType=e}get featureType(){return this._featureType}set validationStrategy(e){e&&(f.w.includes(e)?this._validationStrategy=e:y().warn((0,v.px)(C.errorMessages.UNSUPPORTED_VALIDATION_STRATEGY)({renderFoundation:this,strategy:e})))}get validationStrategy(){return this._validationStrategy}addLabel(e){let{id:t,label:r}=e;this._labels[t]=r}getLabel(e){return this._labels[e]}getLabels(){return this._labels}addSection(e){this._sections.set(e.id,e)}getSection(e){return this._sections.get(e)}getElement(e){return this.getElementsById()[e]}getElements(){return Array.from(this.sections.entries()).map((e=>e[1])).reduce(((e,t)=>[...e,...Array.from(t.elements.entries()).reduce(((e,t)=>{const r=t[1];return r instanceof A.g?e.push(...Array.from(r.fields.entries()).map((e=>e[1]))):r instanceof d.fq&&e.push(r),e}),[])]),[])}getElementsById(){return Array.from(this.sections.entries()).map((e=>e[1])).reduce(((e,t)=>({...e,...Array.from(t.elements.entries()).reduce(((e,t)=>{const r=t[1];return r instanceof A.g?e[r.id]=Array.from(r.fields.entries()).reduce(((e,t)=>{const r=t[1];return e[r.id]=r,e}),{}):r instanceof d.fq&&(e[t[0]]=r),e}),{})})),{})}convertValues(e,t){const r=this.getElements();return(0,T.Li)(e,r,t)}convertAndGroupBySection(e,t){const r=[...this.getElements().values()];return Object.keys(e).reduce(((n,a)=>{var o;const i=r.find((e=>e.id===a)),s=e[a],l=i?i.convertValue(s,t):s,d=null===i||void 0===i||null===(o=i.section)||void 0===o?void 0:o.group;return d?(n[d]={...n[d],[a]:l},n):{...n,[a]:l}}),{})}}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(C,"errorMessages",{UNSUPPORTED_VALIDATION_STRATEGY:"Tried to set an unsupported validation strategy"});var O=r(28582);class N{constructor(e){this._id="",e&&e(this)}set id(e){this._id=e}get id(){return this._id}setData(e,t){this._data=(0,O.Z)(e,{onTransform:t,allowScript:!0})}get data(){return this._data}}class R{constructor(e){this._minAttributesRequiredToSearch=0,this._unique=!1,e&&(0,i.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}set minAttributesRequiredToSearch(e){this._minAttributesRequiredToSearch=e}get minAttributesRequiredToSearch(){return this._minAttributesRequiredToSearch}set searchForm(e){this._searchForm=e}get searchForm(){return this._searchForm}set unique(e){this._unique=e}get unique(){return this._unique}}class w{constructor(e){this._minAttributesRequiredToSearch=0,e&&(0,i.A)(e)&&e(this)}set id(e){this._id=e}get id(){return this._id}set minAttributesRequiredToSearch(e){this._minAttributesRequiredToSearch=e}get minAttributesRequiredToSearch(){return this._minAttributesRequiredToSearch}set searchFoundation(e){this._searchFoundation=e}get searchFoundation(){return this._searchFoundation}set onSearch(e){this._onSearch=e}get onSearch(){return this._onSearch}}var _=r(40524);class P{}},61554:function(e,t,r){"use strict";r.d(t,{n:function(){return n}});const n=new class{set(e){this._constants=e}get(){return this._constants}}},52417:function(e,t,r){"use strict";r.d(t,{Jj:function(){return n.J},sI:function(){return o},zK:function(){return a}});var n=r(40701);const a=new Map;r(13612),r(61554);const o=new class{set(e){this._systemSettings=e}get(){return this._systemSettings}}},13612:function(e,t,r){"use strict";r.d(t,{t:function(){return n}});const n=new class{constructor(){this._optionSets={}}set(e){e.forEach(((e,t)=>{this._optionSets[t]=e}))}get(){return this._optionSets}}},40701:function(e,t,r){"use strict";r.d(t,{J:function(){return n}});const n=new Map},45455:function(e,t,r){var n={"./_lib/build_formatting_tokens_reg_exp/index.js":[1566],"./ar/build_distance_in_words_locale/index.js":[96526,4145],"./ar/build_format_locale/index.js":[62888,2888],"./ar/index.js":[87038,7038],"./be/build_distance_in_words_locale/index.js":[80772,772],"./be/build_format_locale/index.js":[38710,8710],"./be/index.js":[55144,5144],"./bg/build_distance_in_words_locale/index.js":[22226,2226],"./bg/build_format_locale/index.js":[42084,2084],"./bg/index.js":[12554,2554],"./ca/build_distance_in_words_locale/index.js":[76095,6095],"./ca/build_format_locale/index.js":[21731,1731],"./ca/index.js":[13209,3209],"./cs/build_distance_in_words_locale/index.js":[58161,8161],"./cs/build_format_locale/index.js":[48029,8029],"./cs/index.js":[95671,5671],"./da/build_distance_in_words_locale/index.js":[60050,50],"./da/build_format_locale/index.js":[22500,2500],"./da/index.js":[25130,5130],"./de/build_distance_in_words_locale/index.js":[68038,8038],"./de/build_format_locale/index.js":[80448,448],"./de/index.js":[39254,9254],"./el/build_distance_in_words_locale/index.js":[4128,4128],"./el/build_format_locale/index.js":[84266,4266],"./el/index.js":[8444,8444],"./en/build_distance_in_words_locale/index.js":[49550],"./en/build_format_locale/index.js":[33160],"./en/index.js":[5566],"./eo/build_distance_in_words_locale/index.js":[85155,5155],"./eo/build_format_locale/index.js":[19071,9071],"./eo/index.js":[82661,2661],"./es/build_distance_in_words_locale/index.js":[27303,7303],"./es/build_format_locale/index.js":[89963,9963],"./es/index.js":[21441,1441],"./fi/build_distance_in_words_locale/index.js":[28420,8420],"./fi/build_format_locale/index.js":[68726,6345],"./fi/index.js":[21352,1352],"./fil/build_distance_in_words_locale/index.js":[7384,7384],"./fil/build_format_locale/index.js":[2,2],"./fil/index.js":[6676,6676],"./fr/build_distance_in_words_locale/index.js":[80271,271],"./fr/build_format_locale/index.js":[16499,6499],"./fr/index.js":[38985,8985],"./hr/build_distance_in_words_locale/index.js":[55485,5485],"./hr/build_format_locale/index.js":[18769,8769],"./hr/index.js":[44939,4939],"./hu/build_distance_in_words_locale/index.js":[71426,1426],"./hu/build_format_locale/index.js":[62708,2708],"./hu/index.js":[85722,5722],"./id/build_distance_in_words_locale/index.js":[41172,1172],"./id/build_format_locale/index.js":[64358,4358],"./id/index.js":[1867,4248],"./is/build_distance_in_words_locale/index.js":[85115,5115],"./is/build_format_locale/index.js":[99063,9063],"./is/index.js":[4125,4125],"./it/build_distance_in_words_locale/index.js":[50596,596],"./it/build_format_locale/index.js":[90390,390],"./it/index.js":[54760,4760],"./ja/build_distance_in_words_locale/index.js":[61744,1744],"./ja/build_format_locale/index.js":[93466,3466],"./ja/index.js":[15135,7516],"./ko/build_distance_in_words_locale/index.js":[10709,709],"./ko/build_format_locale/index.js":[77225,7225],"./ko/index.js":[76003,6003],"./mk/build_distance_in_words_locale/index.js":[4055,4055],"./mk/build_format_locale/index.js":[75963,5963],"./mk/index.js":[94353,6734],"./nb/build_distance_in_words_locale/index.js":[67415,7415],"./nb/build_format_locale/index.js":[37339,7339],"./nb/index.js":[75441,5441],"./nl/build_distance_in_words_locale/index.js":[21973,1973],"./nl/build_format_locale/index.js":[97193,7193],"./nl/index.js":[34147,4147],"./pl/build_distance_in_words_locale/index.js":[96007,6007],"./pl/build_format_locale/index.js":[22475,2475],"./pl/index.js":[12097,2097],"./pt/build_distance_in_words_locale/index.js":[75567,5567],"./pt/build_format_locale/index.js":[44595,4595],"./pt/index.js":[11817,1817],"./ro/build_distance_in_words_locale/index.js":[85626,5626],"./ro/build_format_locale/index.js":[58348,8348],"./ro/index.js":[87122,7122],"./ru/build_distance_in_words_locale/index.js":[77508,7508],"./ru/build_format_locale/index.js":[14006,1625],"./ru/index.js":[3112,3112],"./sk/build_distance_in_words_locale/index.js":[21625,35],"./sk/build_format_locale/index.js":[84485,4485],"./sk/index.js":[62943,2943],"./sl/build_distance_in_words_locale/index.js":[1622,1622],"./sl/build_format_locale/index.js":[77520,7520],"./sl/index.js":[24006,4006],"./sr/build_distance_in_words_locale/index.js":[24508,4508],"./sr/build_format_locale/index.js":[60846,846],"./sr/index.js":[57856,7856],"./sv/build_distance_in_words_locale/index.js":[18512,8512],"./sv/build_format_locale/index.js":[9242,9242],"./sv/index.js":[50412,412],"./th/build_distance_in_words_locale/index.js":[68463,8463],"./th/build_format_locale/index.js":[37619,7619],"./th/index.js":[36041,6041],"./tr/build_distance_in_words_locale/index.js":[83049,3049],"./tr/build_format_locale/index.js":[89749,9749],"./tr/index.js":[98255,8255],"./zh_cn/build_distance_in_words_locale/index.js":[3139,3139],"./zh_cn/build_format_locale/index.js":[79071,1452],"./zh_cn/index.js":[12517,2517],"./zh_tw/build_distance_in_words_locale/index.js":[1399,1399],"./zh_tw/build_format_locale/index.js":[99035,9035],"./zh_tw/index.js":[23889,3889]};function a(e){if(!r.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],a=t[0];return Promise.all(t.slice(1).map(r.e)).then((function(){return r.t(a,23)}))}a.keys=function(){return Object.keys(n)},a.id=45455,e.exports=a},97535:function(e,t,r){var n={"./af":[26541,4553],"./af.js":[26541,4553],"./ar":[29889,8813],"./ar-dz":[18788,8892],"./ar-dz.js":[18788,8892],"./ar-kw":[67688,4752],"./ar-kw.js":[67688,4752],"./ar-ly":[23861,335],"./ar-ly.js":[23861,335],"./ar-ma":[67124,2608],"./ar-ma.js":[67124,2608],"./ar-ps":[28783,8617],"./ar-ps.js":[28783,8617],"./ar-sa":[91718,6206],"./ar-sa.js":[91718,6206],"./ar-tn":[83032,1640],"./ar-tn.js":[83032,1640],"./ar.js":[29889,8813],"./az":[13657,6837],"./az.js":[13657,6837],"./be":[32115,3127],"./be.js":[32115,3127],"./bg":[30709,5925],"./bg.js":[30709,5925],"./bm":[571,9711],"./bm.js":[571,9711],"./bn":[15422,3508],"./bn-bd":[34185,4655],"./bn-bd.js":[34185,4655],"./bn.js":[15422,3508],"./bo":[64989,7901],"./bo.js":[64989,7901],"./br":[98010,2664],"./br.js":[98010,2664],"./bs":[28873,5473],"./bs.js":[28873,5473],"./ca":[54246,6172],"./ca.js":[54246,6172],"./cs":[61516,3230],"./cs.js":[61516,3230],"./cv":[66487,3219],"./cv.js":[66487,3219],"./cy":[76222,8004],"./cy.js":[76222,8004],"./da":[27269,4353],"./da.js":[27269,4353],"./de":[11305,3365],"./de-at":[5555,4561],"./de-at.js":[5555,4561],"./de-ch":[45749,1687],"./de-ch.js":[45749,1687],"./de.js":[11305,3365],"./dv":[96288,7614],"./dv.js":[96288,7614],"./el":[15871,7679],"./el.js":[15871,7679],"./en-au":[80036,9360],"./en-au.js":[80036,9360],"./en-ca":[2934,3406],"./en-ca.js":[2934,3406],"./en-gb":[15495,5641],"./en-gb.js":[15495,5641],"./en-ie":[78412,5896],"./en-ie.js":[78412,5896],"./en-il":[54971,6873],"./en-il.js":[54971,6873],"./en-in":[19389,4075],"./en-in.js":[19389,4075],"./en-nz":[46974,4210],"./en-nz.js":[46974,4210],"./en-sg":[99600,984],"./en-sg.js":[99600,984],"./eo":[35109,1476],"./eo.js":[35109,1476],"./es":[43302,9048],"./es-do":[25674,2398],"./es-do.js":[25674,2398],"./es-mx":[6894,7838],"./es-mx.js":[6894,7838],"./es-us":[6187,5317],"./es-us.js":[6187,5317],"./es.js":[43302,9048],"./et":[14567,8071],"./et.js":[14567,8071],"./eu":[57168,5262],"./eu.js":[57168,5262],"./fa":[62299,5863],"./fa.js":[62299,5863],"./fi":[51315,4031],"./fi.js":[51315,4031],"./fil":[50351,2865],"./fil.js":[50351,2865],"./fo":[44057,7817],"./fo.js":[44057,7817],"./fr":[23982,7292],"./fr-ca":[48711,6977],"./fr-ca.js":[48711,6977],"./fr-ch":[49752,752],"./fr-ch.js":[49752,752],"./fr.js":[23982,7292],"./fy":[13955,3887],"./fy.js":[13955,3887],"./ga":[19818,1216],"./ga.js":[19818,1216],"./gd":[38997,6845],"./gd.js":[38997,6845],"./gl":[98397,6453],"./gl.js":[98397,6453],"./gom-deva":[96320,3806],"./gom-deva.js":[96320,3806],"./gom-latn":[48475,6751],"./gom-latn.js":[48475,6751],"./gu":[15974,5476],"./gu.js":[15974,5476],"./he":[32341,6942],"./he.js":[32341,6942],"./hi":[42721,5549],"./hi.js":[42721,5549],"./hr":[22672,6526],"./hr.js":[22672,6526],"./hu":[5349,3121],"./hu.js":[5349,3121],"./hy-am":[70991,6040],"./hy-am.js":[70991,6040],"./id":[52227,6371],"./id.js":[52227,6371],"./is":[85898,620],"./is.js":[85898,620],"./it":[5939,7811],"./it-ch":[21303,3989],"./it-ch.js":[21303,3989],"./it.js":[5939,7811],"./ja":[73743,4555],"./ja.js":[73743,4555],"./jv":[89054,8804],"./jv.js":[89054,8804],"./ka":[35806,7892],"./ka.js":[35806,7892],"./kk":[4748,3118],"./kk.js":[4748,3118],"./km":[67146,8488],"./km.js":[67146,8488],"./kn":[9719,4691],"./kn.js":[9719,4691],"./ko":[2e4,4106],"./ko.js":[2e4,4106],"./ku":[81538,5216],"./ku-kmr":[70745,6225],"./ku-kmr.js":[70745,6225],"./ku.js":[81538,5216],"./ky":[97478,6060],"./ky.js":[97478,6060],"./lb":[52884,6658],"./lb.js":[52884,6658],"./lo":[38295,1895],"./lo.js":[38295,1895],"./lt":[1058,2420],"./lt.js":[1058,2420],"./lv":[28440,4230],"./lv.js":[28440,4230],"./me":[52216,8726],"./me.js":[52216,8726],"./mi":[17916,1546],"./mi.js":[17916,1546],"./mk":[79910,4344],"./mk.js":[79910,4344],"./ml":[99591,3367],"./ml.js":[99591,3367],"./mn":[8393,7749],"./mn.js":[8393,7749],"./mr":[85629,6761],"./mr.js":[85629,6761],"./ms":[1886,3952],"./ms-my":[70821,8127],"./ms-my.js":[70821,8127],"./ms.js":[1886,3952],"./mt":[895,2975],"./mt.js":[895,2975],"./my":[87180,2986],"./my.js":[87180,2986],"./nb":[42870,5860],"./nb.js":[42870,5860],"./ne":[17751,3051],"./ne.js":[17751,3051],"./nl":[15176,2074],"./nl-be":[2748,7012],"./nl-be.js":[2748,7012],"./nl.js":[15176,2074],"./nn":[466,4872],"./nn.js":[466,4872],"./oc-lnc":[77838,5776],"./oc-lnc.js":[77838,5776],"./pa-in":[52173,891],"./pa-in.js":[52173,891],"./pl":[11238,5608],"./pl.js":[11238,5608],"./pt":[67390,3632],"./pt-br":[99731,2597],"./pt-br.js":[99731,2597],"./pt.js":[67390,3632],"./ro":[5453,4701],"./ro.js":[5453,4701],"./ru":[99827,1367],"./ru.js":[99827,1367],"./sd":[39321,7889],"./sd.js":[39321,7889],"./se":[69066,5080],"./se.js":[69066,5080],"./si":[29886,6068],"./si.js":[29886,6068],"./sk":[41684,9462],"./sk.js":[41684,9462],"./sl":[55553,6057],"./sl.js":[55553,6057],"./sq":[71110,4236],"./sq.js":[71110,4236],"./sr":[92867,9015],"./sr-cyrl":[30894,3626],"./sr-cyrl.js":[30894,3626],"./sr.js":[92867,9015],"./ss":[11228,9854],"./ss.js":[11228,9854],"./sv":[42375,9843],"./sv.js":[42375,9843],"./sw":[35504,7194],"./sw.js":[35504,7194],"./ta":[58293,8625],"./ta.js":[58293,8625],"./te":[35545,2869],"./te.js":[35545,2869],"./tet":[10985,331],"./tet.js":[10985,331],"./tg":[4983,4839],"./tg.js":[4983,4839],"./th":[14718,7632],"./th.js":[14718,7632],"./tk":[34555,7643],"./tk.js":[34555,7643],"./tl-ph":[63787,198],"./tl-ph.js":[63787,198],"./tlh":[92448,6820],"./tlh.js":[92448,6820],"./tr":[30748,1578],"./tr.js":[30748,1578],"./tzl":[43082,4538],"./tzl.js":[43082,4538],"./tzm":[13337,3539],"./tzm-latn":[92107,9851],"./tzm-latn.js":[92107,9851],"./tzm.js":[13337,3539],"./ug-cn":[38818,934],"./ug-cn.js":[38818,934],"./uk":[68974,3984],"./uk.js":[68974,3984],"./ur":[11253,65],"./ur.js":[11253,65],"./uz":[22237,8233],"./uz-latn":[18215,7393],"./uz-latn.js":[18215,7393],"./uz.js":[22237,8233],"./vi":[9795,1951],"./vi.js":[9795,1951],"./x-pseudo":[17687,671],"./x-pseudo.js":[17687,671],"./yo":[36350,896],"./yo.js":[36350,896],"./zh-cn":[4444,7808],"./zh-cn.js":[4444,7808],"./zh-hk":[17276,3496],"./zh-hk.js":[17276,3496],"./zh-mo":[45649,1147],"./zh-mo.js":[45649,1147],"./zh-tw":[25532,5664],"./zh-tw.js":[25532,5664]};function a(e){if(!r.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],a=t[0];return r.e(t[1]).then((function(){return r.t(a,23)}))}a.keys=function(){return Object.keys(n)},a.id=97535,e.exports=a},44597:function(){}}]);